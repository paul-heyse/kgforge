{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://kgfoundry.dev/schema/tools/navmap-document.json",
  "title": "NavmapDocument",
  "description": "Schema for navmap documents emitted by navmap builders, checkers, and repair utilities.",
  "type": "object",
  "additionalProperties": false,
  "required": [
    "schemaVersion",
    "schemaId",
    "generatedAt"
  ],
  "properties": {
    "schemaVersion": {
      "description": "Semantic version of this schema.",
      "type": "string",
      "const": "1.0.0"
    },
    "schemaId": {
      "description": "Canonical identifier for this schema.",
      "type": "string",
      "const": "https://kgfoundry.dev/schema/tools/navmap-document.json"
    },
    "generatedAt": {
      "description": "ISO 8601 timestamp (UTC) for when the navmap was generated.",
      "type": "string",
      "format": "date-time"
    },
    "commit": {
      "description": "Git commit hash (or 'HEAD' if unavailable) used to generate this navmap.",
      "type": "string"
    },
    "policyVersion": {
      "description": "Version of the navmap policy used to generate this document.",
      "type": "string"
    },
    "linkMode": {
      "description": "Link generation mode used (editor|github|both).",
      "type": "string",
      "enum": ["editor", "github", "both"]
    },
    "modules": {
      "description": "Dictionary of module entries keyed by dotted module name.",
      "type": "object",
      "additionalProperties": {
        "$ref": "#/$defs/ModuleEntry"
      }
    }
  },
  "$defs": {
    "ModuleEntry": {
      "description": "Entry for a single module in the navmap.",
      "type": "object",
      "additionalProperties": false,
      "required": [
        "path",
        "exports",
        "sections",
        "sectionLines",
        "anchors",
        "links",
        "meta",
        "moduleMeta",
        "tags",
        "synopsis",
        "seeAlso",
        "deps"
      ],
      "properties": {
        "path": {
          "description": "Relative path to the module file.",
          "type": "string"
        },
        "exports": {
          "description": "List of exported symbol names.",
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "sections": {
          "description": "List of navigation sections.",
          "type": "array",
          "items": {
            "$ref": "#/$defs/NavSection"
          }
        },
        "sectionLines": {
          "description": "Mapping of section IDs to line numbers.",
          "type": "object",
          "additionalProperties": {
            "type": "integer",
            "minimum": 1
          }
        },
        "anchors": {
          "description": "Mapping of symbol names to anchor line numbers.",
          "type": "object",
          "additionalProperties": {
            "type": "integer",
            "minimum": 1
          }
        },
        "links": {
          "description": "Mapping of link types to URLs.",
          "type": "object",
          "additionalProperties": {
            "type": "string"
          }
        },
        "meta": {
          "description": "Symbol metadata keyed by symbol name.",
          "type": "object",
          "additionalProperties": {
            "$ref": "#/$defs/SymbolMeta"
          }
        },
        "moduleMeta": {
          "description": "Module-level metadata defaults.",
          "$ref": "#/$defs/ModuleMeta"
        },
        "tags": {
          "description": "List of module tags.",
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "synopsis": {
          "description": "Module synopsis string.",
          "type": "string"
        },
        "seeAlso": {
          "description": "List of related module references.",
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "deps": {
          "description": "List of module dependencies.",
          "type": "array",
          "items": {
            "type": "string"
          }
        }
      }
    },
    "NavSection": {
      "description": "A navigation section grouping symbols.",
      "type": "object",
      "additionalProperties": false,
      "required": ["id", "symbols"],
      "properties": {
        "id": {
          "description": "Section identifier (kebab-case).",
          "type": "string",
          "pattern": "^[a-z0-9]+(?:-[a-z0-9]+)*$"
        },
        "symbols": {
          "description": "List of symbol names in this section.",
          "type": "array",
          "items": {
            "type": "string"
          }
        }
      }
    },
    "SymbolMeta": {
      "description": "Metadata for a single symbol.",
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "owner": {
          "description": "Symbol owner (e.g., team or individual).",
          "type": "string"
        },
        "stability": {
          "description": "Stability level (e.g., 'stable', 'experimental', 'deprecated').",
          "type": "string"
        },
        "since": {
          "description": "Version when this symbol was introduced.",
          "type": "string"
        },
        "deprecatedIn": {
          "description": "Version when this symbol was deprecated.",
          "type": "string"
        }
      }
    },
    "ModuleMeta": {
      "description": "Module-level metadata defaults.",
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "owner": {
          "description": "Default owner for symbols in this module.",
          "type": "string"
        },
        "stability": {
          "description": "Default stability level for symbols in this module.",
          "type": "string"
        },
        "since": {
          "description": "Version when this module was introduced.",
          "type": "string"
        },
        "deprecatedIn": {
          "description": "Version when this module was deprecated.",
          "type": "string"
        }
      }
    }
  }
}

