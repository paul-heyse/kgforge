{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://kgfoundry.dev/schema/docs/symbol-delta.schema.json",
  "title": "Symbol Delta",
  "description": "Schema describing the docs/_build/symbols.delta.json payload",
  "type": "object",
  "required": ["base_sha", "head_sha", "added", "removed", "changed"],
  "additionalProperties": false,
  "properties": {
    "base_sha": {
      "type": ["string", "null"],
      "pattern": "^[0-9a-fA-F]{7,40}$"
    },
    "head_sha": {
      "type": ["string", "null"],
      "pattern": "^[0-9a-fA-F]{7,40}$"
    },
    "added": {
      "type": "array",
      "items": {
        "type": "string",
        "minLength": 1
      },
      "uniqueItems": true
    },
    "removed": {
      "type": "array",
      "items": {
        "type": "string",
        "minLength": 1
      },
      "uniqueItems": true
    },
    "changed": {
      "type": "array",
      "items": {
        "$ref": "#/$defs/changeEntry"
      }
    }
  },
  "$defs": {
    "jsonValue": {
      "description": "Generic JSON value used for before/after subsets",
      "oneOf": [
        {"type": "string"},
        {"type": "number"},
        {"type": "integer"},
        {"type": "boolean"},
        {"type": "null"},
        {
          "type": "array",
          "items": {"$ref": "#/$defs/jsonValue"}
        },
        {
          "type": "object",
          "additionalProperties": {"$ref": "#/$defs/jsonValue"}
        }
      ]
    },
    "changeEntry": {
      "type": "object",
      "required": ["path", "before", "after", "reasons"],
      "additionalProperties": false,
      "properties": {
        "path": {
          "type": "string",
          "minLength": 1
        },
        "before": {
          "type": "object",
          "additionalProperties": {"$ref": "#/$defs/jsonValue"}
        },
        "after": {
          "type": "object",
          "additionalProperties": {"$ref": "#/$defs/jsonValue"}
        },
        "reasons": {
          "type": "array",
          "items": {
            "type": "string",
            "minLength": 1
          },
          "minItems": 1,
          "uniqueItems": true
        }
      }
    }
  }
}

