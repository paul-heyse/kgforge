{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://kgfoundry.dev/schema/search/catalog_cli.json",
  "title": "AgentCatalogCLIEnvelope",
  "description": "CLI output envelope for agent catalog commands. Extends the base CLI envelope with search-specific payloads.",
  "type": "object",
  "allOf": [
    {
      "$ref": "../tools/cli_envelope.json"
    },
    {
      "type": "object",
      "properties": {
        "payload": {
          "description": "Search-specific payload (present when command is 'search' or 'explain').",
          "oneOf": [
            {
              "$ref": "#/$defs/SearchPayload"
            },
            {
              "$ref": "#/$defs/ExplainPayload"
            }
          ]
        },
        "correlation_id": {
          "description": "Correlation ID for tracking this operation across logs.",
          "type": "string",
          "format": "uuid"
        }
      }
    }
  ],
  "$defs": {
    "SearchPayload": {
      "description": "Payload for search command results.",
      "type": "object",
      "additionalProperties": false,
      "required": [
        "query",
        "results",
        "total",
        "took_ms"
      ],
      "properties": {
        "query": {
          "description": "Original search query text.",
          "type": "string",
          "minLength": 1
        },
        "results": {
          "description": "List of search results.",
          "type": "array",
          "items": {
            "$ref": "../search/search_response.json#/$defs/VectorSearchResult"
          },
          "minItems": 0
        },
        "total": {
          "description": "Total number of results.",
          "type": "integer",
          "minimum": 0
        },
        "took_ms": {
          "description": "Query execution time in milliseconds.",
          "type": "integer",
          "minimum": 0
        },
        "metadata": {
          "description": "Search metadata (alpha, backend, etc.).",
          "type": "object",
          "additionalProperties": true
        }
      }
    },
    "ExplainPayload": {
      "description": "Payload for explain command results.",
      "type": "object",
      "additionalProperties": false,
      "required": [
        "symbol_id",
        "explanation"
      ],
      "properties": {
        "symbol_id": {
          "description": "Symbol identifier being explained.",
          "type": "string",
          "pattern": "^py:[a-zA-Z0-9_.]+$"
        },
        "explanation": {
          "description": "Detailed explanation of the symbol.",
          "type": "object",
          "additionalProperties": true,
          "properties": {
            "docstring": {
              "description": "Full docstring for the symbol.",
              "type": ["string", "null"]
            },
            "summary": {
              "description": "One-line summary.",
              "type": ["string", "null"]
            },
            "examples": {
              "description": "Code examples from docstring.",
              "type": "array",
              "items": {
                "type": "string"
              }
            },
            "metadata": {
              "description": "Additional metadata (stability, deprecated, etc.).",
              "type": "object",
              "additionalProperties": true
            }
          }
        }
      }
    }
  },
  "examples": [
    {
      "schemaVersion": "1.0.0",
      "schemaId": "https://kgfoundry.dev/schema/cli-envelope.json",
      "generatedAt": "2024-01-15T10:30:00Z",
      "status": "success",
      "command": "agent_catalog",
      "subcommand": "search",
      "durationSeconds": 0.042,
      "correlation_id": "550e8400-e29b-41d4-a716-446655440000",
      "payload": {
        "query": "vector store",
        "results": [
          {
            "symbol_id": "py:search_api.types.FaissIndexProtocol",
            "score": 0.95,
            "lexical_score": 0.8,
            "vector_score": 0.9,
            "package": "search_api",
            "module": "types",
            "qname": "FaissIndexProtocol",
            "kind": "protocol",
            "anchor": {
              "start_line": 78,
              "end_line": 156
            },
            "metadata": {
              "stability": "stable",
              "deprecated": false
            }
          }
        ],
        "total": 1,
        "took_ms": 42,
        "metadata": {
          "alpha": 0.7,
          "backend": "faiss"
        }
      },
      "files": [],
      "errors": []
    }
  ]
}

