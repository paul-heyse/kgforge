{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://kgfoundry.dev/schemas/agent_catalog/search_document.v1.json",
  "title": "SearchDocument",
  "description": "Intermediate representation for agent catalog symbols, used to build or query the semantic index. Produced by the make_search_document helper factory; contains normalized text, tokens, and metadata for hybrid lexical-vector search.",
  "type": "object",
  "additionalProperties": false,
  "required": [
    "symbol_id",
    "package",
    "module",
    "qname",
    "kind",
    "text",
    "tokens"
  ],
  "properties": {
    "symbol_id": {
      "description": "Fully qualified symbol identifier (e.g., 'py:kgfoundry.agent_catalog.search.find_similar').",
      "type": "string",
      "pattern": "^py:[a-zA-Z0-9_.]+$",
      "examples": ["py:kgfoundry.agent_catalog.search.find_similar", "py:search_api.Client"]
    },
    "package": {
      "description": "Top-level package containing the symbol.",
      "type": "string",
      "minLength": 1,
      "examples": ["kgfoundry", "search_api", "orchestration"]
    },
    "module": {
      "description": "Fully qualified module path containing the symbol.",
      "type": "string",
      "minLength": 1,
      "examples": ["kgfoundry.agent_catalog.search", "search_api.client"]
    },
    "qname": {
      "description": "Qualified name of the symbol within its module (e.g., class name, function name, or fully nested path for nested classes/methods).",
      "type": "string",
      "minLength": 1,
      "examples": ["find_similar", "SearchClient", "SearchClient.search"]
    },
    "kind": {
      "description": "Symbol kind for categorization and filtering.",
      "type": "string",
      "enum": ["class", "function", "module", "method", "property", "attribute", "type", "protocol"],
      "examples": ["class", "function"]
    },
    "stability": {
      "description": "API stability level indicating maturity and support guarantees.",
      "type": ["string", "null"],
      "enum": ["stable", "experimental", "deprecated", null],
      "default": null,
      "examples": ["stable", "experimental"]
    },
    "deprecated": {
      "description": "Whether this symbol is deprecated and scheduled for removal.",
      "type": "boolean",
      "default": false
    },
    "summary": {
      "description": "One-line summary extracted from the docstring or metadata.",
      "type": ["string", "null"],
      "default": null,
      "examples": ["Find semantically similar symbols in the catalog", "HTTP client for agent catalog search"]
    },
    "docstring": {
      "description": "Full docstring or longer description, normalized (whitespace stripped).",
      "type": ["string", "null"],
      "default": null
    },
    "text": {
      "description": "Normalized combined text field (qname + module + package + summary + docstring), used for lexical indexing.",
      "type": "string",
      "minLength": 1
    },
    "tokens": {
      "description": "Lexical tokens (as Counter-like object in Python; serialized as object with token -> count mappings for JSON schema validation).",
      "type": "object",
      "additionalProperties": {
        "type": "integer",
        "minimum": 1
      },
      "examples": [
        {"find": 2, "similar": 1, "symbols": 1, "catalog": 1},
        {"search": 3, "client": 1, "http": 1}
      ]
    },
    "anchor_start": {
      "description": "Starting line number in source code (1-indexed), or null if not available.",
      "type": ["integer", "null"],
      "minimum": 1,
      "default": null,
      "examples": [42, 100]
    },
    "anchor_end": {
      "description": "Ending line number in source code (1-indexed), or null if not available.",
      "type": ["integer", "null"],
      "minimum": 1,
      "default": null,
      "examples": [67, 125]
    },
    "row": {
      "description": "Row index or database identifier for the symbol. Default -1 indicates unknown/unset.",
      "type": "integer",
      "default": -1,
      "examples": [-1, 0, 42]
    }
  },
  "$defs": {
    "SearchDocumentExample": {
      "description": "Example SearchDocument produced by make_search_document helper.",
      "type": "object",
      "properties": {
        "symbol_id": "py:kgfoundry.agent_catalog.search.find_similar",
        "package": "kgfoundry",
        "module": "kgfoundry.agent_catalog.search",
        "qname": "find_similar",
        "kind": "function",
        "stability": "stable",
        "deprecated": false,
        "summary": "Find semantically similar symbols in the catalog.",
        "docstring": "Uses hybrid lexical-vector search to locate symbols with similar semantics.",
        "text": "find_similar kgfoundry.agent_catalog.search kgfoundry Find semantically similar symbols in the catalog. Uses hybrid lexical-vector search to locate symbols with similar semantics.",
        "tokens": {
          "find": 2,
          "similar": 2,
          "symbols": 1,
          "catalog": 2,
          "hybrid": 1,
          "lexical": 1,
          "vector": 1,
          "search": 2
        },
        "anchor_start": 42,
        "anchor_end": 89,
        "row": 0
      }
    }
  },
  "examples": [
    {
      "symbol_id": "py:kgfoundry.agent_catalog.search.find_similar",
      "package": "kgfoundry",
      "module": "kgfoundry.agent_catalog.search",
      "qname": "find_similar",
      "kind": "function",
      "stability": "stable",
      "deprecated": false,
      "summary": "Find semantically similar symbols in the catalog.",
      "docstring": "Uses hybrid lexical-vector search to locate symbols with similar semantics.",
      "text": "find_similar kgfoundry.agent_catalog.search kgfoundry Find semantically similar symbols in the catalog. Uses hybrid lexical-vector search to locate symbols with similar semantics.",
      "tokens": {
        "find": 2,
        "similar": 2,
        "symbols": 1,
        "catalog": 2,
        "hybrid": 1,
        "lexical": 1,
        "vector": 1,
        "search": 2
      },
      "anchor_start": 42,
      "anchor_end": 89,
      "row": 0
    },
    {
      "symbol_id": "py:kgfoundry.agent_catalog.client.SearchClient",
      "package": "kgfoundry",
      "module": "kgfoundry.agent_catalog.client",
      "qname": "SearchClient",
      "kind": "class",
      "stability": "experimental",
      "deprecated": false,
      "summary": "HTTP client for querying the agent catalog.",
      "docstring": null,
      "text": "SearchClient kgfoundry.agent_catalog.client kgfoundry HTTP client for querying the agent catalog.",
      "tokens": {
        "SearchClient": 1,
        "HTTP": 1,
        "client": 1,
        "querying": 1,
        "catalog": 1
      },
      "anchor_start": 10,
      "anchor_end": 35,
      "row": 1
    }
  ],
  "x-version": "1.0.0",
  "x-compatibility-notes": "Initial version. Produced by make_search_document helper factory. Tokens serialized as object with term -> count mappings. anchor_start/anchor_end are 1-indexed. row defaults to -1 for unknown rows."
}
