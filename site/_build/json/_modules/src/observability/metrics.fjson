{"parents": [{"link": "../../../", "title": "Module code"}], "title": "src.observability.metrics", "body": "<h1>Source code for src.observability.metrics</h1><div class=\"highlight\"><pre>\n<span></span><span class=\"linenos\"> 1</span><span class=\"sd\">&quot;&quot;&quot;Module for observability.metrics.&quot;&quot;&quot;</span>\n<span class=\"linenos\"> 2</span>\n<span class=\"linenos\"> 3</span><span class=\"kn\">from</span><span class=\"w\"> </span><span class=\"nn\">typing</span><span class=\"w\"> </span><span class=\"kn\">import</span> <span class=\"n\">Dict</span>\n<span class=\"linenos\"> 4</span>\n<span class=\"linenos\"> 5</span><span class=\"k\">try</span><span class=\"p\">:</span>\n<span class=\"linenos\"> 6</span>    <span class=\"kn\">from</span><span class=\"w\"> </span><span class=\"nn\">prometheus_client</span><span class=\"w\"> </span><span class=\"kn\">import</span> <span class=\"n\">Counter</span><span class=\"p\">,</span> <span class=\"n\">Histogram</span><span class=\"p\">,</span> <span class=\"n\">Gauge</span>  <span class=\"c1\"># type: ignore</span>\n<span class=\"linenos\"> 7</span><span class=\"k\">except</span> <span class=\"ne\">Exception</span><span class=\"p\">:</span>  <span class=\"c1\"># pragma: no cover - minimal no-op fallbacks</span>\n<span class=\"linenos\"> 8</span>    <span class=\"k\">class</span><span class=\"w\"> </span><span class=\"nc\">_Noop</span><span class=\"p\">:</span>\n<span class=\"linenos\"> 9</span><span class=\"w\">        </span><span class=\"sd\">&quot;&quot;&quot;Minimal stand-in when Prometheus client is unavailable.&quot;&quot;&quot;</span>\n<span class=\"linenos\">10</span>\n<span class=\"linenos\">11</span>        <span class=\"k\">def</span><span class=\"w\"> </span><span class=\"nf\">labels</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"o\">*</span><span class=\"n\">args</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"n\">kwargs</span><span class=\"p\">):</span>\n<span class=\"linenos\">12</span><span class=\"w\">            </span><span class=\"sd\">&quot;&quot;&quot;Return self to mimic the Prometheus API.&quot;&quot;&quot;</span>\n<span class=\"linenos\">13</span>            <span class=\"k\">return</span> <span class=\"bp\">self</span>\n<span class=\"linenos\">14</span>\n<span class=\"linenos\">15</span>        <span class=\"k\">def</span><span class=\"w\"> </span><span class=\"nf\">observe</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"o\">*</span><span class=\"n\">args</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"n\">kwargs</span><span class=\"p\">):</span>\n<span class=\"linenos\">16</span><span class=\"w\">            </span><span class=\"sd\">&quot;&quot;&quot;Ignore observation calls.&quot;&quot;&quot;</span>\n<span class=\"linenos\">17</span>\n<span class=\"linenos\">18</span>            <span class=\"k\">return</span> <span class=\"kc\">None</span>\n<span class=\"linenos\">19</span>\n<span class=\"linenos\">20</span>        <span class=\"k\">def</span><span class=\"w\"> </span><span class=\"nf\">inc</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"o\">*</span><span class=\"n\">args</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"n\">kwargs</span><span class=\"p\">):</span>\n<span class=\"linenos\">21</span><span class=\"w\">            </span><span class=\"sd\">&quot;&quot;&quot;Ignore counter increments.&quot;&quot;&quot;</span>\n<span class=\"linenos\">22</span>\n<span class=\"linenos\">23</span>            <span class=\"k\">return</span> <span class=\"kc\">None</span>\n<span class=\"linenos\">24</span>\n<span class=\"linenos\">25</span>        <span class=\"k\">def</span><span class=\"w\"> </span><span class=\"nf\">set</span><span class=\"p\">(</span><span class=\"bp\">self</span><span class=\"p\">,</span> <span class=\"o\">*</span><span class=\"n\">args</span><span class=\"p\">,</span> <span class=\"o\">**</span><span class=\"n\">kwargs</span><span class=\"p\">):</span>\n<span class=\"linenos\">26</span><span class=\"w\">            </span><span class=\"sd\">&quot;&quot;&quot;Ignore gauge updates.&quot;&quot;&quot;</span>\n<span class=\"linenos\">27</span>\n<span class=\"linenos\">28</span>            <span class=\"k\">return</span> <span class=\"kc\">None</span>\n<span class=\"linenos\">29</span>\n<span class=\"linenos\">30</span>    <span class=\"n\">Counter</span> <span class=\"o\">=</span> <span class=\"n\">Histogram</span> <span class=\"o\">=</span> <span class=\"n\">Gauge</span> <span class=\"o\">=</span> <span class=\"n\">_Noop</span>  <span class=\"c1\"># type: ignore</span>\n<span class=\"linenos\">31</span>\n<div class=\"viewcode-block\" id=\"pdf_download_success_total\">\n<a class=\"viewcode-back\" href=\"../../../../autoapi/src/observability/metrics/#src.observability.metrics.pdf_download_success_total\">[docs]</a>\n<span class=\"linenos\">32</span><span class=\"n\">pdf_download_success_total</span> <span class=\"o\">=</span> <span class=\"n\">Counter</span><span class=\"p\">(</span><span class=\"s1\">&#39;pdf_download_success_total&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;Successful OA PDF downloads&#39;</span><span class=\"p\">)</span></div>\n\n<div class=\"viewcode-block\" id=\"pdf_download_failure_total\">\n<a class=\"viewcode-back\" href=\"../../../../autoapi/src/observability/metrics/#src.observability.metrics.pdf_download_failure_total\">[docs]</a>\n<span class=\"linenos\">33</span><span class=\"n\">pdf_download_failure_total</span> <span class=\"o\">=</span> <span class=\"n\">Counter</span><span class=\"p\">(</span><span class=\"s1\">&#39;pdf_download_failure_total&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;Failed OA PDF downloads&#39;</span><span class=\"p\">,</span> <span class=\"p\">[</span><span class=\"s1\">&#39;reason&#39;</span><span class=\"p\">])</span></div>\n\n<div class=\"viewcode-block\" id=\"search_total_latency_ms\">\n<a class=\"viewcode-back\" href=\"../../../../autoapi/src/observability/metrics/#src.observability.metrics.search_total_latency_ms\">[docs]</a>\n<span class=\"linenos\">34</span><span class=\"n\">search_total_latency_ms</span> <span class=\"o\">=</span> <span class=\"n\">Histogram</span><span class=\"p\">(</span><span class=\"s1\">&#39;search_total_latency_ms&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;End-to-end /search latency (ms)&#39;</span><span class=\"p\">)</span></div>\n\n<div class=\"viewcode-block\" id=\"faiss_search_latency_ms\">\n<a class=\"viewcode-back\" href=\"../../../../autoapi/src/observability/metrics/#src.observability.metrics.faiss_search_latency_ms\">[docs]</a>\n<span class=\"linenos\">35</span><span class=\"n\">faiss_search_latency_ms</span> <span class=\"o\">=</span> <span class=\"n\">Histogram</span><span class=\"p\">(</span><span class=\"s1\">&#39;faiss_search_latency_ms&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;FAISS search latency (ms)&#39;</span><span class=\"p\">)</span></div>\n\n<div class=\"viewcode-block\" id=\"bm25_queries_total\">\n<a class=\"viewcode-back\" href=\"../../../../autoapi/src/observability/metrics/#src.observability.metrics.bm25_queries_total\">[docs]</a>\n<span class=\"linenos\">36</span><span class=\"n\">bm25_queries_total</span> <span class=\"o\">=</span> <span class=\"n\">Counter</span><span class=\"p\">(</span><span class=\"s1\">&#39;bm25_queries_total&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;BM25 queries issued&#39;</span><span class=\"p\">)</span></div>\n\n<div class=\"viewcode-block\" id=\"splade_queries_total\">\n<a class=\"viewcode-back\" href=\"../../../../autoapi/src/observability/metrics/#src.observability.metrics.splade_queries_total\">[docs]</a>\n<span class=\"linenos\">37</span><span class=\"n\">splade_queries_total</span> <span class=\"o\">=</span> <span class=\"n\">Counter</span><span class=\"p\">(</span><span class=\"s1\">&#39;splade_queries_total&#39;</span><span class=\"p\">,</span> <span class=\"s1\">&#39;SPLADE queries issued&#39;</span><span class=\"p\">)</span></div>\n\n</pre></div>", "current_page_name": "_modules/src/observability/metrics", "sidebars": ["sidebar-nav-bs.html"], "alabaster_version": "0.7.16", "alabaster_version_info": [0, 7, 16], "theme_show_toc_level": 1, "generate_toctree_html": "<functools._lru_cache_wrapper object at 0x71d6eb04f320>", "generate_toc_html": "<functools._lru_cache_wrapper object at 0x71d6eb04fe20>", "theme_version": "0.16.1", "theme_logo": {"image_relative": {}}}