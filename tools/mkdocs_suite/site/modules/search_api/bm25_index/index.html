<!DOCTYPE html><html class="no-js" lang="en"><head>
<meta charset="utf-8">
<meta content="width=device-width,initial-scale=1" name="viewport">
<link href="https://docs.kgfoundry.dev/modules/search_api/bm25_index/" rel="canonical">
<link href="../../../assets/images/favicon.png" rel="icon">
<meta content="mkdocs-1.6.1, mkdocs-material-9.6.23" name="generator">
<title>search_api.bm25_index - KgFoundry MkDocs Suite</title>
<link href="../../../assets/stylesheets/main.84d31ad4.min.css" rel="stylesheet">
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect">
<link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet">
<style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
<link href="../../../assets/_mkdocstrings.css" rel="stylesheet">
<link href="../../../assets/stylesheets/mkdocs_d2_plugin.css" rel="stylesheet">
<link href="../../../assets/mkdocs_puml/puml.css" rel="stylesheet">
<link href="../../../assets/mkdocs_puml/interaction.css" rel="stylesheet">
<script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
<link href="../../../assets/stylesheets/glightbox.min.css" rel="stylesheet"><script src="../../../assets/javascripts/glightbox.min.js"></script><style id="glightbox-style">
            html.glightbox-open { overflow: initial; height: 100%; }
            .gslide-title { margin-top: 0px; user-select: text; }
            .gslide-desc { color: #666; user-select: text; }
            .gslide-image img { background: white; }
            .gscrollbar-fixer { padding-right: 15px; }
            .gdesc-inner { font-size: 0.75rem; }
            body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color); }
            body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color); }
            body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color); }
        </style></head>
<body dir="ltr">
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox">
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox">
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#search_apibm25_index">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header md-header--shadow" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="KgFoundry MkDocs Suite" class="md-header__button md-logo" data-md-component="logo" href="../../.." title="KgFoundry MkDocs Suite">
<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            KgFoundry MkDocs Suite
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              search_api.bm25_index
            
          </span>
</div>
</div>
</div>
<script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
<label class="md-header__button md-icon" for="__search">
<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Search" required="" spellcheck="false" type="text">
<label class="md-search__icon md-icon" for="__search">
<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
</label>
<nav aria-label="Search" class="md-search__options">
<button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" title="Clear" type="reset">
<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>
</button>
</nav>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="" tabindex="0">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list" role="presentation"></ol>
</div>
</div>
</div>
</div>
</div>
<div class="md-header__source">
<a class="md-source" data-md-component="source" href="https://github.com/kgfoundry/kgfoundry" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewBox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"></path></svg>
</div>
<div class="md-source__repository">
    GitHub
  </div>
</a>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="KgFoundry MkDocs Suite" class="md-nav__button md-logo" data-md-component="logo" href="../../.." title="KgFoundry MkDocs Suite">
<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg>
</a>
    KgFoundry MkDocs Suite
  </label>
<div class="md-nav__source">
<a class="md-source" data-md-component="source" href="https://github.com/kgfoundry/kgfoundry" title="Go to repository">
<div class="md-source__icon md-icon">
<svg viewBox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"></path></svg>
</div>
<div class="md-source__repository">
    GitHub
  </div>
</a>
</div>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../..">
<span class="md-ellipsis">
    Overview
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../architecture/">
<span class="md-ellipsis">
    Architecture
    
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--section md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_3" type="checkbox">
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../../api/">
<span class="md-ellipsis">
    API
    
  </span>
</a>
<label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="false" aria-labelledby="__nav_3_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_3">
<span class="md-nav__icon md-icon"></span>
            API
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../api/openapi-cli/">
<span class="md-ellipsis">
    CLI Spec
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../api/interfaces/">
<span class="md-ellipsis">
    Interface Catalog
    
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../">
<span class="md-ellipsis">
    Modules
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../diagrams/">
<span class="md-ellipsis">
    Diagrams
    
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../cli/">
<span class="md-ellipsis">
    CLI
    
  </span>
</a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#sections">
<span class="md-ellipsis">
      Sections
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#contents">
<span class="md-ellipsis">
      Contents
    </span>
</a>
<nav aria-label="Contents" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#search_apibm25_indexbm25doc">
<span class="md-ellipsis">
      search_api.bm25_index.BM25Doc
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#search_api.bm25_index.BM25Doc">
<span class="md-ellipsis">
      BM25Doc
    </span>
</a>
<nav aria-label="BM25Doc" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#search_api.bm25_index.BM25Doc.chunk_id">
<span class="md-ellipsis">
      chunk_id
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#search_api.bm25_index.BM25Doc.dl">
<span class="md-ellipsis">
      dl
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#search_api.bm25_index.BM25Doc.doc_id">
<span class="md-ellipsis">
      doc_id
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#search_api.bm25_index.BM25Doc.section">
<span class="md-ellipsis">
      section
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#search_api.bm25_index.BM25Doc.tf">
<span class="md-ellipsis">
      tf
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#search_api.bm25_index.BM25Doc.title">
<span class="md-ellipsis">
      title
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#search_apibm25_indexbm25index">
<span class="md-ellipsis">
      search_api.bm25_index.BM25Index
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#search_api.bm25_index.BM25Index">
<span class="md-ellipsis">
      BM25Index
    </span>
</a>
<nav aria-label="BM25Index" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#search_api.bm25_index.BM25Index.build_from_duckdb">
<span class="md-ellipsis">
      build_from_duckdb
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#search_api.bm25_index.BM25Index.doc">
<span class="md-ellipsis">
      doc
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#search_api.bm25_index.BM25Index.from_parquet">
<span class="md-ellipsis">
      from_parquet
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#search_api.bm25_index.BM25Index.load">
<span class="md-ellipsis">
      load
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#search_api.bm25_index.BM25Index.save">
<span class="md-ellipsis">
      save
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#search_api.bm25_index.BM25Index.search">
<span class="md-ellipsis">
      search
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#search_apibm25_index_as_str">
<span class="md-ellipsis">
      search_api.bm25_index._as_str
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#search_api.bm25_index._as_str">
<span class="md-ellipsis">
      _as_str
    </span>
</a>
<nav aria-label="_as_str" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#search_apibm25_index_validate_parquet_path">
<span class="md-ellipsis">
      search_api.bm25_index._validate_parquet_path
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#search_api.bm25_index._validate_parquet_path">
<span class="md-ellipsis">
      _validate_parquet_path
    </span>
</a>
<nav aria-label="_validate_parquet_path" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#search_apibm25_indextoks">
<span class="md-ellipsis">
      search_api.bm25_index.toks
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#search_api.bm25_index.toks">
<span class="md-ellipsis">
      toks
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#relationships">
<span class="md-ellipsis">
      Relationships
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#autorefs-examples">
<span class="md-ellipsis">
      Autorefs Examples
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#inheritance">
<span class="md-ellipsis">
      Inheritance
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#neighborhood">
<span class="md-ellipsis">
      Neighborhood
    </span>
</a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<h1 id="search_apibm25_index">search_api.bm25_index<a class="headerlink" href="#search_apibm25_index" title="Permanent link">¶</a></h1>
<p>FastAPI service exposing search endpoints, aggregation helpers, and Problem Details responses.</p>
<p><a href="https://github.com/kgfoundry/kgfoundry/blob/main/src/search_api/bm25_index.py">View source on GitHub</a></p>
<h2 id="sections">Sections<a class="headerlink" href="#sections" title="Permanent link">¶</a></h2>
<ul>
<li><strong>Public API</strong></li>
</ul>
<h2 id="contents">Contents<a class="headerlink" href="#contents" title="Permanent link">¶</a></h2>
<h3 id="search_apibm25_indexbm25doc">search_api.bm25_index.BM25Doc<a class="headerlink" href="#search_apibm25_indexbm25doc" title="Permanent link">¶</a></h3>
<div class="doc doc-object doc-class">
<h2 class="doc doc-heading" id="search_api.bm25_index.BM25Doc">
<code>search_api.bm25_index.BM25Doc</code>
<span class="doc doc-labels">
<small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
</span>
<a class="headerlink" href="#search_api.bm25_index.BM25Doc" title="Permanent link">¶</a></h2>
<div class="doc doc-contents first">
<p>Document representation for BM25 indexing and retrieval.</p>
<p>Stores term frequency statistics and document metadata for a single
document chunk. Inline attribute docstrings describe alias usage.</p>
<details class="see-also" open="">
<summary>See Also</summary>
<p>BM25Index : BM25 index using these document representations.</p>
</details>
<details class="quote">
<summary>Source code in <code>src/search_api/bm25_index.py</code></summary>
<div class="highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">BM25Doc</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Document representation for BM25 indexing and retrieval.</span>

<span class="sd">    Stores term frequency statistics and document metadata for a single</span>
<span class="sd">    document chunk. Inline attribute docstrings describe alias usage.</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    BM25Index : BM25 index using these document representations.</span>
<span class="sd">    """</span>

    <span class="n">chunk_id</span><span class="p">:</span> <span class="nb">str</span>
<span class="w">    </span><span class="sd">"""Unique identifier for the chunk. Alias: none; name ``chunk_id``."""</span>
    <span class="n">doc_id</span><span class="p">:</span> <span class="nb">str</span>
<span class="w">    </span><span class="sd">"""Parent document identifier. Alias: none; name ``doc_id``."""</span>
    <span class="n">title</span><span class="p">:</span> <span class="nb">str</span>
<span class="w">    </span><span class="sd">"""Document title used for term weighting. Alias: none; name ``title``."""</span>
    <span class="n">section</span><span class="p">:</span> <span class="nb">str</span>
<span class="w">    </span><span class="sd">"""Section label where the chunk appears. Alias: none; name ``section``."""</span>
    <span class="n">tf</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span>
<span class="w">    </span><span class="sd">"""Term frequency mapping per token. Alias: none; name ``tf``."""</span>
    <span class="n">dl</span><span class="p">:</span> <span class="nb">float</span>
<span class="w">    </span><span class="sd">"""BM25 document length (sum of term frequencies). Alias: none; name ``dl``."""</span>
</code></pre></div></td></tr></tbody></table></div>
</details>
<div class="doc doc-children">
<div class="doc doc-object doc-attribute">
<h3 class="doc doc-heading" id="search_api.bm25_index.BM25Doc.chunk_id">
<code class="highlight language-python"><span class="n">chunk_id</span></code>
<span class="doc doc-labels">
<small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
</span>
<a class="headerlink" href="#search_api.bm25_index.BM25Doc.chunk_id" title="Permanent link">¶</a></h3>
<div class="doc doc-contents">
<p>Unique identifier for the chunk. Alias: none; name <code>chunk_id</code>.</p>
</div>
</div>
<div class="doc doc-object doc-attribute">
<h3 class="doc doc-heading" id="search_api.bm25_index.BM25Doc.dl">
<code class="highlight language-python"><span class="n">dl</span></code>
<span class="doc doc-labels">
<small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
</span>
<a class="headerlink" href="#search_api.bm25_index.BM25Doc.dl" title="Permanent link">¶</a></h3>
<div class="doc doc-contents">
<p>BM25 document length (sum of term frequencies). Alias: none; name <code>dl</code>.</p>
</div>
</div>
<div class="doc doc-object doc-attribute">
<h3 class="doc doc-heading" id="search_api.bm25_index.BM25Doc.doc_id">
<code class="highlight language-python"><span class="n">doc_id</span></code>
<span class="doc doc-labels">
<small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
</span>
<a class="headerlink" href="#search_api.bm25_index.BM25Doc.doc_id" title="Permanent link">¶</a></h3>
<div class="doc doc-contents">
<p>Parent document identifier. Alias: none; name <code>doc_id</code>.</p>
</div>
</div>
<div class="doc doc-object doc-attribute">
<h3 class="doc doc-heading" id="search_api.bm25_index.BM25Doc.section">
<code class="highlight language-python"><span class="n">section</span></code>
<span class="doc doc-labels">
<small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
</span>
<a class="headerlink" href="#search_api.bm25_index.BM25Doc.section" title="Permanent link">¶</a></h3>
<div class="doc doc-contents">
<p>Section label where the chunk appears. Alias: none; name <code>section</code>.</p>
</div>
</div>
<div class="doc doc-object doc-attribute">
<h3 class="doc doc-heading" id="search_api.bm25_index.BM25Doc.tf">
<code class="highlight language-python"><span class="n">tf</span></code>
<span class="doc doc-labels">
<small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
</span>
<a class="headerlink" href="#search_api.bm25_index.BM25Doc.tf" title="Permanent link">¶</a></h3>
<div class="doc doc-contents">
<p>Term frequency mapping per token. Alias: none; name <code>tf</code>.</p>
</div>
</div>
<div class="doc doc-object doc-attribute">
<h3 class="doc doc-heading" id="search_api.bm25_index.BM25Doc.title">
<code class="highlight language-python"><span class="n">title</span></code>
<span class="doc doc-labels">
<small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
</span>
<a class="headerlink" href="#search_api.bm25_index.BM25Doc.title" title="Permanent link">¶</a></h3>
<div class="doc doc-contents">
<p>Document title used for term weighting. Alias: none; name <code>title</code>.</p>
</div>
</div>
</div>
</div>
</div><h3 id="search_apibm25_indexbm25index">search_api.bm25_index.BM25Index<a class="headerlink" href="#search_apibm25_indexbm25index" title="Permanent link">¶</a></h3>
<div class="doc doc-object doc-class">
<h2 class="doc doc-heading" id="search_api.bm25_index.BM25Index">
<code>search_api.bm25_index.BM25Index</code>
<a class="headerlink" href="#search_api.bm25_index.BM25Index" title="Permanent link">¶</a></h2>
<div class="doc doc-contents first">
<p>BM25 ranking function implementation for text search.</p>
<p>Implements the Best Matching 25 (BM25) ranking algorithm for document
retrieval. BM25 computes relevance scores based on term frequency (TF),
inverse document frequency (IDF), and document length normalization.</p>
<p><span class="doc-section-title">Parameters:</span></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td>
<code>k1</code>
</td>
<td>
<code><span title="float">float</span></code>
</td>
<td>
<div class="doc-md-description">
<p>Term frequency saturation parameter. Controls how quickly term frequency
saturates. Higher values allow more influence from repeated terms.
Defaults to 0.9.</p>
</div>
</td>
<td>
<code>0.9</code>
</td>
</tr>
<tr class="doc-section-item">
<td>
<code>b</code>
</td>
<td>
<code><span title="float">float</span></code>
</td>
<td>
<div class="doc-md-description">
<p>Document length normalization parameter. Controls the degree of length
normalization. Values closer to 1.0 normalize more aggressively.
Defaults to 0.4.</p>
</div>
</td>
<td>
<code>0.4</code>
</td>
</tr>
</tbody>
</table>
<details class="note" open="">
<summary>Notes</summary>
<p>BM25 scoring formula:
:math:<code>score(D, Q) = \sum_{t \in Q} IDF(t) \cdot \frac{TF(t, D) \cdot (k1 + 1)}{TF(t, D) + k1 \cdot (1 - b + b \cdot \frac{|D|}{avgdl})}</code></p>
<p>Where:
- :math:<code>TF(t, D)</code> is the term frequency of term :math:<code>t</code> in document :math:<code>D</code>
- :math:<code>IDF(t)</code> is the inverse document frequency of term :math:<code>t</code>
- :math:<code>|D|</code> is the document length
- :math:<code>avgdl</code> is the average document length</p>
</details>
<details class="see-also" open="">
<summary>See Also</summary>
<p>BM25Doc : Document representation used by this index.
toks : Tokenization function used for indexing and queries.</p>
</details>
<details class="quote">
<summary>Source code in <code>src/search_api/bm25_index.py</code></summary>
<div class="highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">BM25Index</span><span class="p">:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">"""BM25 ranking function implementation for text search.</span>

<span class="sd">    Implements the Best Matching 25 (BM25) ranking algorithm for document</span>
<span class="sd">    retrieval. BM25 computes relevance scores based on term frequency (TF),</span>
<span class="sd">    inverse document frequency (IDF), and document length normalization.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    k1 : float, optional</span>
<span class="sd">        Term frequency saturation parameter. Controls how quickly term frequency</span>
<span class="sd">        saturates. Higher values allow more influence from repeated terms.</span>
<span class="sd">        Defaults to 0.9.</span>
<span class="sd">    b : float, optional</span>
<span class="sd">        Document length normalization parameter. Controls the degree of length</span>
<span class="sd">        normalization. Values closer to 1.0 normalize more aggressively.</span>
<span class="sd">        Defaults to 0.4.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    BM25 scoring formula:</span>
<span class="sd">    :math:`score(D, Q) = \sum_{t \in Q} IDF(t) \cdot \frac{TF(t, D) \cdot (k1 + 1)}{TF(t, D) + k1 \cdot (1 - b + b \cdot \frac{|D|}{avgdl})}`</span>

<span class="sd">    Where:</span>
<span class="sd">    - :math:`TF(t, D)` is the term frequency of term :math:`t` in document :math:`D`</span>
<span class="sd">    - :math:`IDF(t)` is the inverse document frequency of term :math:`t`</span>
<span class="sd">    - :math:`|D|` is the document length</span>
<span class="sd">    - :math:`avgdl` is the average document length</span>

<span class="sd">    See Also</span>
<span class="sd">    --------</span>
<span class="sd">    BM25Doc : Document representation used by this index.</span>
<span class="sd">    toks : Tokenization function used for indexing and queries.</span>
<span class="sd">    """</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k1</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.9</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.4</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">k1</span> <span class="o">=</span> <span class="n">k1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">b</span> <span class="o">=</span> <span class="n">b</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">docs</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">BM25Doc</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">avgdl</span> <span class="o">=</span> <span class="mf">0.0</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">build_from_duckdb</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">db_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BM25Index</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Build BM25 index from DuckDB database.</span>

<span class="sd">        Queries a DuckDB database for the most recent chunks dataset and</span>
<span class="sd">        builds a BM25 index from the parquet files. Reads chunk text, document</span>
<span class="sd">        titles, and sections, then computes term frequencies and document</span>
<span class="sd">        frequencies.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        db_path : str</span>
<span class="sd">            Path to DuckDB database file containing datasets and documents tables.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        BM25Index</span>
<span class="sd">            Initialized BM25 index with documents loaded from DuckDB.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        TypeError</span>
<span class="sd">            If parquet_root value in the database is not a string.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        The method queries for the most recent chunks dataset ordered by</span>
<span class="sd">        created_at. If no dataset is found, returns an empty index. Path</span>
<span class="sd">        validation prevents path traversal attacks by ensuring resolved paths</span>
<span class="sd">        are within allowed directories. Errors raised by</span>
<span class="sd">        :func:`_validate_parquet_path` propagate unchanged.</span>
<span class="sd">        """</span>
        <span class="n">index</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">()</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">duckdb</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">db_path</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">dataset</span> <span class="o">=</span> <span class="n">fetch_one</span><span class="p">(</span>
                <span class="n">con</span><span class="p">,</span>
                <span class="s2">"SELECT parquet_root FROM datasets "</span>
                <span class="s2">"WHERE kind='chunks' ORDER BY created_at DESC LIMIT 1"</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">dataset</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">index</span>
            <span class="n">root_obj</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">root_obj</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"Invalid parquet_root type: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">root_obj</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="c1"># Validate and resolve path to prevent path traversal</span>
            <span class="c1"># For pattern matching, we validate the root directory exists</span>
            <span class="n">root_path</span> <span class="o">=</span> <span class="n">_validate_parquet_path</span><span class="p">(</span><span class="n">root_obj</span><span class="p">,</span> <span class="n">must_exist</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">parquet_pattern</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">root_path</span> <span class="o">/</span> <span class="s2">"*"</span> <span class="o">/</span> <span class="s2">"*.parquet"</span><span class="p">)</span>
            <span class="n">sql</span> <span class="o">=</span> <span class="s2">"""</span>
<span class="s2">                SELECT c.chunk_id, c.doc_id, coalesce(c.section,''), c.text, coalesce(d.title,'')</span>
<span class="s2">                FROM read_parquet(?, union_by_name=true) AS c</span>
<span class="s2">                LEFT JOIN documents d ON c.doc_id = d.doc_id</span>
<span class="s2">            """</span>
            <span class="n">raw_rows</span> <span class="o">=</span> <span class="n">fetch_all</span><span class="p">(</span><span class="n">con</span><span class="p">,</span> <span class="n">sql</span><span class="p">,</span> <span class="p">[</span><span class="n">parquet_pattern</span><span class="p">])</span>
            <span class="n">typed_rows</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span>
                <span class="p">(</span>
                    <span class="n">_as_str</span><span class="p">(</span><span class="n">chunk_id_val</span><span class="p">),</span>
                    <span class="n">_as_str</span><span class="p">(</span><span class="n">doc_id_val</span><span class="p">),</span>
                    <span class="n">_as_str</span><span class="p">(</span><span class="n">section_val</span><span class="p">),</span>
                    <span class="n">_as_str</span><span class="p">(</span><span class="n">text_val</span><span class="p">),</span>
                    <span class="n">_as_str</span><span class="p">(</span><span class="n">title_val</span><span class="p">),</span>
                <span class="p">)</span>
                <span class="k">for</span> <span class="n">chunk_id_val</span><span class="p">,</span> <span class="n">doc_id_val</span><span class="p">,</span> <span class="n">section_val</span><span class="p">,</span> <span class="n">text_val</span><span class="p">,</span> <span class="n">title_val</span> <span class="ow">in</span> <span class="n">raw_rows</span>
            <span class="p">]</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">con</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">index</span><span class="o">.</span><span class="n">_build</span><span class="p">(</span><span class="n">typed_rows</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">index</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_build</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rows</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Build index from document rows.</span>

<span class="sd">        Processes an iterable of document rows, tokenizes text fields, computes</span>
<span class="sd">        term frequencies with weighted scoring (title 2.0, section 1.2, body</span>
<span class="sd">        1.0), and updates document frequency statistics.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        rows : Iterable[tuple[str, str, str, str, str]]</span>
<span class="sd">            Iterable of tuples containing (chunk_id, doc_id, section, body, title).</span>
<span class="sd">            Each tuple represents one document chunk to index.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        This method clears existing index state before building. Term frequencies</span>
<span class="sd">        are computed separately for title, section, and body fields with different</span>
<span class="sd">        weights. The average document length (avgdl) is computed after processing</span>
<span class="sd">        all rows.</span>
<span class="sd">        """</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">docs</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="n">dl_sum</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">for</span> <span class="n">chunk_id</span><span class="p">,</span> <span class="n">doc_id</span><span class="p">,</span> <span class="n">section</span><span class="p">,</span> <span class="n">body</span><span class="p">,</span> <span class="n">title</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">:</span>
            <span class="n">tf</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">term</span> <span class="ow">in</span> <span class="n">toks</span><span class="p">(</span><span class="n">body</span> <span class="ow">or</span> <span class="s2">""</span><span class="p">):</span>
                <span class="n">tf</span><span class="p">[</span><span class="n">term</span><span class="p">]</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">term</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1.0</span>
            <span class="k">for</span> <span class="n">term</span> <span class="ow">in</span> <span class="n">toks</span><span class="p">(</span><span class="n">title</span> <span class="ow">or</span> <span class="s2">""</span><span class="p">):</span>
                <span class="n">tf</span><span class="p">[</span><span class="n">term</span><span class="p">]</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">term</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span> <span class="o">+</span> <span class="mf">2.0</span>
            <span class="k">for</span> <span class="n">term</span> <span class="ow">in</span> <span class="n">toks</span><span class="p">(</span><span class="n">section</span> <span class="ow">or</span> <span class="s2">""</span><span class="p">):</span>
                <span class="n">tf</span><span class="p">[</span><span class="n">term</span><span class="p">]</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">term</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1.2</span>
            <span class="n">dl</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">docs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">BM25Doc</span><span class="p">(</span>
                    <span class="n">chunk_id</span><span class="o">=</span><span class="n">chunk_id</span><span class="p">,</span>
                    <span class="n">doc_id</span><span class="o">=</span><span class="n">doc_id</span> <span class="ow">or</span> <span class="s2">"urn:doc:fixture"</span><span class="p">,</span>
                    <span class="n">title</span><span class="o">=</span><span class="n">title</span> <span class="ow">or</span> <span class="s2">"Fixture"</span><span class="p">,</span>
                    <span class="n">section</span><span class="o">=</span><span class="n">section</span> <span class="ow">or</span> <span class="s2">""</span><span class="p">,</span>
                    <span class="n">tf</span><span class="o">=</span><span class="n">tf</span><span class="p">,</span>
                    <span class="n">dl</span><span class="o">=</span><span class="n">dl</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="n">dl_sum</span> <span class="o">+=</span> <span class="n">dl</span>
            <span class="k">for</span> <span class="n">term</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">[</span><span class="n">term</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">term</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">docs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">avgdl</span> <span class="o">=</span> <span class="p">(</span><span class="n">dl_sum</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mf">0.0</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_parquet</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">k1</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.9</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.4</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BM25Index</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Build BM25 index from a single parquet file.</span>

<span class="sd">        Creates a BM25 index by reading document chunks from a parquet file.</span>
<span class="sd">        Uses DuckDB to read the parquet file and extracts chunk_id, doc_id,</span>
<span class="sd">        section, and text fields for indexing.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        path : str</span>
<span class="sd">            Path to parquet file containing document chunks. Must exist and be</span>
<span class="sd">            within allowed directories (validated to prevent path traversal).</span>
<span class="sd">        k1 : float, optional</span>
<span class="sd">            Term frequency saturation parameter. Defaults to 0.9.</span>
<span class="sd">        b : float, optional</span>
<span class="sd">            Document length normalization parameter. Defaults to 0.4.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        BM25Index</span>
<span class="sd">            Initialized BM25 index with documents loaded from parquet file.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Path validation prevents path traversal attacks. The method uses an</span>
<span class="sd">        in-memory DuckDB connection to read the parquet file. Title fields are</span>
<span class="sd">        not included from parquet (defaults to empty string). Errors raised by</span>
<span class="sd">        :func:`_validate_parquet_path` propagate unchanged.</span>
<span class="sd">        """</span>
        <span class="n">index</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="n">k1</span><span class="o">=</span><span class="n">k1</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="n">b</span><span class="p">)</span>
        <span class="n">con</span> <span class="o">=</span> <span class="n">duckdb</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">database</span><span class="o">=</span><span class="s2">":memory:"</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Validate and resolve path to prevent path traversal</span>
            <span class="n">resolved_path</span> <span class="o">=</span> <span class="n">_validate_parquet_path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
            <span class="n">sql</span> <span class="o">=</span> <span class="s2">"""</span>
<span class="s2">                SELECT chunk_id,</span>
<span class="s2">                       coalesce(doc_id, chunk_id) AS doc_id,</span>
<span class="s2">                       coalesce(section,'') AS section,</span>
<span class="s2">                       text,</span>
<span class="s2">                       '' AS title</span>
<span class="s2">                FROM read_parquet(?, union_by_name=true)</span>
<span class="s2">            """</span>
            <span class="n">rows</span> <span class="o">=</span> <span class="n">fetch_all</span><span class="p">(</span><span class="n">con</span><span class="p">,</span> <span class="n">sql</span><span class="p">,</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">resolved_path</span><span class="p">)])</span>
            <span class="n">typed_rows</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span>
                <span class="p">(</span>
                    <span class="n">_as_str</span><span class="p">(</span><span class="n">chunk_id_val</span><span class="p">),</span>
                    <span class="n">_as_str</span><span class="p">(</span><span class="n">doc_id_val</span><span class="p">),</span>
                    <span class="n">_as_str</span><span class="p">(</span><span class="n">section_val</span><span class="p">),</span>
                    <span class="n">_as_str</span><span class="p">(</span><span class="n">text_val</span><span class="p">),</span>
                    <span class="s2">""</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="k">for</span> <span class="n">chunk_id_val</span><span class="p">,</span> <span class="n">doc_id_val</span><span class="p">,</span> <span class="n">section_val</span><span class="p">,</span> <span class="n">text_val</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span> <span class="ow">in</span> <span class="n">rows</span>
            <span class="p">]</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">con</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">index</span><span class="o">.</span><span class="n">_build</span><span class="p">(</span><span class="n">typed_rows</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">index</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Save BM25 index metadata to JSON with schema validation and checksum.</span>

<span class="sd">        Serializes index metadata (parameters, document frequencies, and document</span>
<span class="sd">        list) to JSON format, validates it against the BM25 metadata schema, and</span>
<span class="sd">        writes a SHA256 checksum file for integrity verification.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        path : str</span>
<span class="sd">            Output file path for JSON metadata. A `.sha256` checksum file will</span>
<span class="sd">            be written alongside it.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        The serialized payload includes: k1, b, N (document count), avgdl (average</span>
<span class="sd">        document length), df (document frequency dictionary), and docs (list of</span>
<span class="sd">        BM25Doc data dictionaries). Exceptions raised by :func:`serialize_json`</span>
<span class="sd">        propagate unchanged.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; index = BM25Index(k1=0.9, b=0.4)</span>
<span class="sd">        &gt;&gt;&gt; index.N = 100</span>
<span class="sd">        &gt;&gt;&gt; index.save("/tmp/index.json")</span>
<span class="sd">        """</span>
        <span class="n">path_obj</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="n">schema_path</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">"schema"</span> <span class="o">/</span> <span class="s2">"models"</span> <span class="o">/</span> <span class="s2">"bm25_metadata.v1.json"</span>
        <span class="p">)</span>
        <span class="c1"># Convert docs to JSON-serializable format</span>
        <span class="n">docs_data</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="s2">"chunk_id"</span><span class="p">:</span> <span class="n">doc</span><span class="o">.</span><span class="n">chunk_id</span><span class="p">,</span>
                <span class="s2">"doc_id"</span><span class="p">:</span> <span class="n">doc</span><span class="o">.</span><span class="n">doc_id</span><span class="p">,</span>
                <span class="s2">"title"</span><span class="p">:</span> <span class="n">doc</span><span class="o">.</span><span class="n">title</span><span class="p">,</span>
                <span class="s2">"section"</span><span class="p">:</span> <span class="n">doc</span><span class="o">.</span><span class="n">section</span><span class="p">,</span>
                <span class="s2">"tf"</span><span class="p">:</span> <span class="n">doc</span><span class="o">.</span><span class="n">tf</span><span class="p">,</span>
                <span class="s2">"dl"</span><span class="p">:</span> <span class="n">doc</span><span class="o">.</span><span class="n">dl</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">docs</span>
        <span class="p">]</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">"k1"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">k1</span><span class="p">,</span>
            <span class="s2">"b"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="p">,</span>
            <span class="s2">"N"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">,</span>
            <span class="s2">"avgdl"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">avgdl</span><span class="p">,</span>
            <span class="s2">"df"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">,</span>
            <span class="s2">"docs"</span><span class="p">:</span> <span class="n">docs_data</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">serialize_json</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="n">schema_path</span><span class="p">,</span> <span class="n">path_obj</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">load</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BM25Index</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Load BM25 index metadata from JSON with schema validation and checksum verification.</span>

<span class="sd">        Deserializes index metadata from JSON, verifies the SHA256 checksum (if</span>
<span class="sd">        present), validates against the BM25 metadata schema, and reconstructs</span>
<span class="sd">        the index instance. Supports legacy pickle format as fallback.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        path : str</span>
<span class="sd">            Path to JSON metadata file. A `.sha256` checksum file will be</span>
<span class="sd">            verified if present.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        BM25Index</span>
<span class="sd">            Reconstructed BM25 index instance with all metadata loaded.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        The method attempts to load from JSON first. If the file has a `.pkl`</span>
<span class="sd">        extension and JSON loading fails, it falls back to legacy pickle format</span>
<span class="sd">        (with validation). All document frequencies, term frequencies, and</span>
<span class="sd">        document metadata are reconstructed from the payload. Exceptions raised</span>
<span class="sd">        by :func:`deserialize_json` or legacy payload loaders propagate</span>
<span class="sd">        unchanged.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; index = BM25Index.load("/tmp/index.json")</span>
<span class="sd">        &gt;&gt;&gt; assert index.N &gt; 0</span>
<span class="sd">        """</span>
        <span class="n">path_obj</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="n">schema_path</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">"schema"</span> <span class="o">/</span> <span class="s2">"models"</span> <span class="o">/</span> <span class="s2">"bm25_metadata.v1.json"</span>
        <span class="p">)</span>
        <span class="n">payload</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_load_payload</span><span class="p">(</span><span class="n">path_obj</span><span class="p">,</span> <span class="n">schema_path</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_index_from_payload</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_coerce_payload</span><span class="p">(</span><span class="n">raw</span><span class="p">:</span> <span class="nb">object</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">JsonValue</span><span class="p">]:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">raw</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">{}</span>
        <span class="k">return</span> <span class="n">cast</span><span class="p">(</span><span class="s2">"dict[str, JsonValue]"</span><span class="p">,</span> <span class="n">raw</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_load_payload</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">metadata_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">schema_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">JsonValue</span><span class="p">]:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_coerce_payload</span><span class="p">(</span><span class="n">deserialize_json</span><span class="p">(</span><span class="n">metadata_path</span><span class="p">,</span> <span class="n">schema_path</span><span class="p">))</span>
        <span class="k">except</span> <span class="n">DeserializationError</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">metadata_path</span><span class="o">.</span><span class="n">suffix</span> <span class="o">!=</span> <span class="s2">".pkl"</span><span class="p">:</span>
                <span class="k">raise</span>
            <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_load_legacy_payload</span><span class="p">(</span><span class="n">metadata_path</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_load_legacy_payload</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">metadata_path</span><span class="p">:</span> <span class="n">Path</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">JsonValue</span><span class="p">]:</span>
        <span class="k">with</span> <span class="n">metadata_path</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">"rb"</span><span class="p">)</span> <span class="k">as</span> <span class="n">handle</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">legacy_payload_raw</span><span class="p">:</span> <span class="nb">object</span> <span class="o">=</span> <span class="n">load_unsigned_legacy</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">UnsafeSerializationError</span> <span class="k">as</span> <span class="n">legacy_exc</span><span class="p">:</span>
                <span class="n">message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"Legacy BM25 pickle failed validation: </span><span class="si">{</span><span class="n">legacy_exc</span><span class="si">}</span><span class="s2">"</span>
                <span class="k">raise</span> <span class="n">DeserializationError</span><span class="p">(</span><span class="n">message</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">legacy_exc</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_coerce_payload</span><span class="p">(</span><span class="n">legacy_payload_raw</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_index_from_payload</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">payload</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">JsonValue</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">BM25Index</span><span class="p">:</span>
        <span class="n">k1_val</span> <span class="o">=</span> <span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"k1"</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">)</span>
        <span class="n">b_val</span> <span class="o">=</span> <span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"b"</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">)</span>
        <span class="n">index</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span>
            <span class="n">k1</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">k1_val</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">k1_val</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">))</span> <span class="k">else</span> <span class="mf">0.9</span><span class="p">,</span>
            <span class="n">b</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="n">b_val</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">b_val</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">))</span> <span class="k">else</span> <span class="mf">0.4</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">n_val</span> <span class="o">=</span> <span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"N"</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">avgdl_val</span> <span class="o">=</span> <span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"avgdl"</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
        <span class="n">index</span><span class="o">.</span><span class="n">N</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">n_val</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">n_val</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">))</span> <span class="k">else</span> <span class="mi">0</span>
        <span class="n">index</span><span class="o">.</span><span class="n">avgdl</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">avgdl_val</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">avgdl_val</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">))</span> <span class="k">else</span> <span class="mf">0.0</span>

        <span class="n">df_val</span> <span class="o">=</span> <span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"df"</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">index</span><span class="o">.</span><span class="n">df</span> <span class="o">=</span> <span class="p">(</span>
            <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">))</span> <span class="k">else</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">df_val</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">df_val</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span>
            <span class="k">else</span> <span class="p">{}</span>
        <span class="p">)</span>

        <span class="n">index</span><span class="o">.</span><span class="n">docs</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_docs_from_payload</span><span class="p">(</span><span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"docs"</span><span class="p">,</span> <span class="p">[]))</span>
        <span class="k">return</span> <span class="n">index</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_docs_from_payload</span><span class="p">(</span><span class="n">raw_docs</span><span class="p">:</span> <span class="nb">object</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">BM25Doc</span><span class="p">]:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">raw_docs</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">return</span> <span class="p">[]</span>

        <span class="n">docs</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">BM25Doc</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">raw_docs</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">entry</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="n">chunk_id</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"chunk_id"</span><span class="p">,</span> <span class="s2">""</span><span class="p">)</span>
            <span class="n">doc_id</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"doc_id"</span><span class="p">,</span> <span class="s2">""</span><span class="p">)</span>
            <span class="n">title</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"title"</span><span class="p">,</span> <span class="s2">""</span><span class="p">)</span>
            <span class="n">section</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"section"</span><span class="p">,</span> <span class="s2">""</span><span class="p">)</span>
            <span class="n">tf_value</span><span class="p">:</span> <span class="nb">object</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"tf"</span><span class="p">,</span> <span class="p">{})</span>
            <span class="n">doc_length</span> <span class="o">=</span> <span class="n">entry</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">"dl"</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
            <span class="n">docs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">BM25Doc</span><span class="p">(</span>
                    <span class="n">chunk_id</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">chunk_id</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">chunk_id</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="s2">""</span><span class="p">,</span>
                    <span class="n">doc_id</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">doc_id</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">doc_id</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="s2">""</span><span class="p">,</span>
                    <span class="n">title</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">title</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="s2">""</span><span class="p">,</span>
                    <span class="n">section</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">section</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">section</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="s2">""</span><span class="p">,</span>
                    <span class="n">tf</span><span class="o">=</span><span class="p">(</span><span class="n">cast</span><span class="p">(</span><span class="s2">"dict[str, float]"</span><span class="p">,</span> <span class="n">tf_value</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tf_value</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">else</span> <span class="p">{}),</span>
                    <span class="n">dl</span><span class="o">=</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">doc_length</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">doc_length</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">))</span> <span class="k">else</span> <span class="mf">0.0</span><span class="p">),</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">docs</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_idf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">term</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Compute inverse document frequency (IDF) for a term.</span>

<span class="sd">        Calculates IDF using the formula: log((N - df + 0.5) / (df + 0.5) + 1.0)</span>
<span class="sd">        where N is the total number of documents and df is the document frequency.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        term : str</span>
<span class="sd">            Token string to compute IDF for.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        float</span>
<span class="sd">            IDF score for the term. Returns 0.0 if term is not in any document</span>
<span class="sd">            or if the index is empty.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Uses the standard BM25 IDF formula with smoothing to avoid division by</span>
<span class="sd">        zero. The 0.5 smoothing factor prevents negative IDF values for terms</span>
<span class="sd">        appearing in all documents.</span>
<span class="sd">        """</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">term</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">df</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="mf">0.0</span>
        <span class="k">return</span> <span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">-</span> <span class="n">df</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">df</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1.0</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">search</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">"""Search index and return top-k results ranked by BM25 score.</span>

<span class="sd">        Tokenizes the query, computes BM25 relevance scores for all documents,</span>
<span class="sd">        and returns the top-k results sorted by score in descending order.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        query : str</span>
<span class="sd">            Search query string to tokenize and match against documents.</span>
<span class="sd">        k : int, optional</span>
<span class="sd">            Maximum number of results to return. Defaults to 10.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list[tuple[str, float]]</span>
<span class="sd">            List of (chunk_id, score) tuples sorted by score descending. Only</span>
<span class="sd">            includes documents with score &gt; 0.0. Returns empty list if index is</span>
<span class="sd">            empty or no documents match.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        BM25 scoring combines term frequency (TF), inverse document frequency</span>
<span class="sd">        (IDF), and document length normalization. Documents with higher scores</span>
<span class="sd">        are more relevant to the query.</span>
<span class="sd">        """</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>
        <span class="n">terms</span> <span class="o">=</span> <span class="n">toks</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
        <span class="n">scores</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">doc</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">docs</span><span class="p">):</span>
            <span class="n">score</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">for</span> <span class="n">term</span> <span class="ow">in</span> <span class="n">terms</span><span class="p">:</span>
                <span class="n">tf</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">tf</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">term</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">tf</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">idf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_idf</span><span class="p">(</span><span class="n">term</span><span class="p">)</span>
                <span class="n">denom</span> <span class="o">=</span> <span class="n">tf</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">k1</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span> <span class="o">*</span> <span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">dl</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">avgdl</span> <span class="ow">or</span> <span class="mf">1.0</span><span class="p">)))</span>
                <span class="n">score</span> <span class="o">+=</span> <span class="n">idf</span> <span class="o">*</span> <span class="p">((</span><span class="n">tf</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">k1</span> <span class="o">+</span> <span class="mf">1.0</span><span class="p">))</span> <span class="o">/</span> <span class="n">denom</span><span class="p">)</span>
            <span class="n">scores</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">score</span>

        <span class="c1"># Explicitly type sorted callable to avoid Any</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">key_func</span><span class="p">(</span><span class="n">item</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">            </span><span class="sd">"""Extract score from (index, score) tuple for sorting.</span>

<span class="sd">            Parameters</span>
<span class="sd">            ----------</span>
<span class="sd">            item : tuple[int, float]</span>
<span class="sd">                Tuple of (index, score).</span>

<span class="sd">            Returns</span>
<span class="sd">            -------</span>
<span class="sd">            float</span>
<span class="sd">                Score value.</span>
<span class="sd">            """</span>
            <span class="k">return</span> <span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">ranked</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">enumerate</span><span class="p">(</span><span class="n">scores</span><span class="p">),</span> <span class="n">key</span><span class="o">=</span><span class="n">key_func</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">docs</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">chunk_id</span><span class="p">,</span> <span class="n">score</span><span class="p">)</span> <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">score</span> <span class="ow">in</span> <span class="n">ranked</span><span class="p">[:</span><span class="n">k</span><span class="p">]</span> <span class="k">if</span> <span class="n">score</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">doc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BM25Doc</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Get document at the specified index.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        index : int</span>
<span class="sd">            Zero-based index of the document to retrieve.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        BM25Doc</span>
<span class="sd">            Document at the specified index.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        IndexError</span>
<span class="sd">            If index is out of range (negative or &gt;= len(docs)).</span>
<span class="sd">        """</span>
        <span class="k">if</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">index</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">docs</span><span class="p">):</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"Document index </span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s2"> out of range for </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">docs</span><span class="p">)</span><span class="si">}</span><span class="s2"> documents"</span>
            <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">docs</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
</code></pre></div></td></tr></tbody></table></div>
</details>
<div class="doc doc-children">
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="search_api.bm25_index.BM25Index.build_from_duckdb">
<code class="highlight language-python"><span class="n">build_from_duckdb</span><span class="p">(</span><span class="n">db_path</span><span class="p">)</span></code>
<span class="doc doc-labels">
<small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
</span>
<a class="headerlink" href="#search_api.bm25_index.BM25Index.build_from_duckdb" title="Permanent link">¶</a></h3>
<div class="doc doc-contents">
<p>Build BM25 index from DuckDB database.</p>
<p>Queries a DuckDB database for the most recent chunks dataset and
builds a BM25 index from the parquet files. Reads chunk text, document
titles, and sections, then computes term frequencies and document
frequencies.</p>
<p><span class="doc-section-title">Parameters:</span></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td>
<code>db_path</code>
</td>
<td>
<code><span title="str">str</span></code>
</td>
<td>
<div class="doc-md-description">
<p>Path to DuckDB database file containing datasets and documents tables.</p>
</div>
</td>
<td>
<em>required</em>
</td>
</tr>
</tbody>
</table>
<p><span class="doc-section-title">Returns:</span></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td>
<code><a class="autorefs autorefs-internal" href="#search_api.bm25_index.BM25Index" title="search_api.bm25_index.BM25Index">BM25Index</a></code>
</td>
<td>
<div class="doc-md-description">
<p>Initialized BM25 index with documents loaded from DuckDB.</p>
</div>
</td>
</tr>
</tbody>
</table>
<p><span class="doc-section-title">Raises:</span></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td>
<code><span title="TypeError">TypeError</span></code>
</td>
<td>
<div class="doc-md-description">
<p>If parquet_root value in the database is not a string.</p>
</div>
</td>
</tr>
</tbody>
</table>
<details class="note" open="">
<summary>Notes</summary>
<p>The method queries for the most recent chunks dataset ordered by
created_at. If no dataset is found, returns an empty index. Path
validation prevents path traversal attacks by ensuring resolved paths
are within allowed directories. Errors raised by
:func:<code>_validate_parquet_path</code> propagate unchanged.</p>
</details>
<details class="quote">
<summary>Source code in <code>src/search_api/bm25_index.py</code></summary>
<div class="highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">build_from_duckdb</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">db_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BM25Index</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Build BM25 index from DuckDB database.</span>

<span class="sd">    Queries a DuckDB database for the most recent chunks dataset and</span>
<span class="sd">    builds a BM25 index from the parquet files. Reads chunk text, document</span>
<span class="sd">    titles, and sections, then computes term frequencies and document</span>
<span class="sd">    frequencies.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    db_path : str</span>
<span class="sd">        Path to DuckDB database file containing datasets and documents tables.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    BM25Index</span>
<span class="sd">        Initialized BM25 index with documents loaded from DuckDB.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    TypeError</span>
<span class="sd">        If parquet_root value in the database is not a string.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The method queries for the most recent chunks dataset ordered by</span>
<span class="sd">    created_at. If no dataset is found, returns an empty index. Path</span>
<span class="sd">    validation prevents path traversal attacks by ensuring resolved paths</span>
<span class="sd">    are within allowed directories. Errors raised by</span>
<span class="sd">    :func:`_validate_parquet_path` propagate unchanged.</span>
<span class="sd">    """</span>
    <span class="n">index</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">()</span>
    <span class="n">con</span> <span class="o">=</span> <span class="n">duckdb</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">db_path</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">dataset</span> <span class="o">=</span> <span class="n">fetch_one</span><span class="p">(</span>
            <span class="n">con</span><span class="p">,</span>
            <span class="s2">"SELECT parquet_root FROM datasets "</span>
            <span class="s2">"WHERE kind='chunks' ORDER BY created_at DESC LIMIT 1"</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">dataset</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">index</span>
        <span class="n">root_obj</span> <span class="o">=</span> <span class="n">dataset</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">root_obj</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"Invalid parquet_root type: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">root_obj</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="c1"># Validate and resolve path to prevent path traversal</span>
        <span class="c1"># For pattern matching, we validate the root directory exists</span>
        <span class="n">root_path</span> <span class="o">=</span> <span class="n">_validate_parquet_path</span><span class="p">(</span><span class="n">root_obj</span><span class="p">,</span> <span class="n">must_exist</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">parquet_pattern</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">root_path</span> <span class="o">/</span> <span class="s2">"*"</span> <span class="o">/</span> <span class="s2">"*.parquet"</span><span class="p">)</span>
        <span class="n">sql</span> <span class="o">=</span> <span class="s2">"""</span>
<span class="s2">            SELECT c.chunk_id, c.doc_id, coalesce(c.section,''), c.text, coalesce(d.title,'')</span>
<span class="s2">            FROM read_parquet(?, union_by_name=true) AS c</span>
<span class="s2">            LEFT JOIN documents d ON c.doc_id = d.doc_id</span>
<span class="s2">        """</span>
        <span class="n">raw_rows</span> <span class="o">=</span> <span class="n">fetch_all</span><span class="p">(</span><span class="n">con</span><span class="p">,</span> <span class="n">sql</span><span class="p">,</span> <span class="p">[</span><span class="n">parquet_pattern</span><span class="p">])</span>
        <span class="n">typed_rows</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span>
                <span class="n">_as_str</span><span class="p">(</span><span class="n">chunk_id_val</span><span class="p">),</span>
                <span class="n">_as_str</span><span class="p">(</span><span class="n">doc_id_val</span><span class="p">),</span>
                <span class="n">_as_str</span><span class="p">(</span><span class="n">section_val</span><span class="p">),</span>
                <span class="n">_as_str</span><span class="p">(</span><span class="n">text_val</span><span class="p">),</span>
                <span class="n">_as_str</span><span class="p">(</span><span class="n">title_val</span><span class="p">),</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">chunk_id_val</span><span class="p">,</span> <span class="n">doc_id_val</span><span class="p">,</span> <span class="n">section_val</span><span class="p">,</span> <span class="n">text_val</span><span class="p">,</span> <span class="n">title_val</span> <span class="ow">in</span> <span class="n">raw_rows</span>
        <span class="p">]</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">con</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="n">index</span><span class="o">.</span><span class="n">_build</span><span class="p">(</span><span class="n">typed_rows</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">index</span>
</code></pre></div></td></tr></tbody></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="search_api.bm25_index.BM25Index.doc">
<code class="highlight language-python"><span class="n">doc</span><span class="p">(</span><span class="n">index</span><span class="p">)</span></code>
<a class="headerlink" href="#search_api.bm25_index.BM25Index.doc" title="Permanent link">¶</a></h3>
<div class="doc doc-contents">
<p>Get document at the specified index.</p>
<p><span class="doc-section-title">Parameters:</span></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td>
<code>index</code>
</td>
<td>
<code><span title="int">int</span></code>
</td>
<td>
<div class="doc-md-description">
<p>Zero-based index of the document to retrieve.</p>
</div>
</td>
<td>
<em>required</em>
</td>
</tr>
</tbody>
</table>
<p><span class="doc-section-title">Returns:</span></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td>
<code><a class="autorefs autorefs-internal" href="#search_api.bm25_index.BM25Doc" title="search_api.bm25_index.BM25Doc


  
      dataclass
  ">BM25Doc</a></code>
</td>
<td>
<div class="doc-md-description">
<p>Document at the specified index.</p>
</div>
</td>
</tr>
</tbody>
</table>
<p><span class="doc-section-title">Raises:</span></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td>
<code><span title="IndexError">IndexError</span></code>
</td>
<td>
<div class="doc-md-description">
<p>If index is out of range (negative or &gt;= len(docs)).</p>
</div>
</td>
</tr>
</tbody>
</table>
<details class="quote">
<summary>Source code in <code>src/search_api/bm25_index.py</code></summary>
<div class="highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">doc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BM25Doc</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Get document at the specified index.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    index : int</span>
<span class="sd">        Zero-based index of the document to retrieve.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    BM25Doc</span>
<span class="sd">        Document at the specified index.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    IndexError</span>
<span class="sd">        If index is out of range (negative or &gt;= len(docs)).</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">index</span> <span class="o">&gt;=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">docs</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"Document index </span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s2"> out of range for </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">docs</span><span class="p">)</span><span class="si">}</span><span class="s2"> documents"</span>
        <span class="k">raise</span> <span class="ne">IndexError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">docs</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
</code></pre></div></td></tr></tbody></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="search_api.bm25_index.BM25Index.from_parquet">
<code class="highlight language-python"><span class="n">from_parquet</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">k1</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span></code>
<span class="doc doc-labels">
<small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
</span>
<a class="headerlink" href="#search_api.bm25_index.BM25Index.from_parquet" title="Permanent link">¶</a></h3>
<div class="doc doc-contents">
<p>Build BM25 index from a single parquet file.</p>
<p>Creates a BM25 index by reading document chunks from a parquet file.
Uses DuckDB to read the parquet file and extracts chunk_id, doc_id,
section, and text fields for indexing.</p>
<p><span class="doc-section-title">Parameters:</span></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td>
<code>path</code>
</td>
<td>
<code><span title="str">str</span></code>
</td>
<td>
<div class="doc-md-description">
<p>Path to parquet file containing document chunks. Must exist and be
within allowed directories (validated to prevent path traversal).</p>
</div>
</td>
<td>
<em>required</em>
</td>
</tr>
<tr class="doc-section-item">
<td>
<code>k1</code>
</td>
<td>
<code><span title="float">float</span></code>
</td>
<td>
<div class="doc-md-description">
<p>Term frequency saturation parameter. Defaults to 0.9.</p>
</div>
</td>
<td>
<code>0.9</code>
</td>
</tr>
<tr class="doc-section-item">
<td>
<code>b</code>
</td>
<td>
<code><span title="float">float</span></code>
</td>
<td>
<div class="doc-md-description">
<p>Document length normalization parameter. Defaults to 0.4.</p>
</div>
</td>
<td>
<code>0.4</code>
</td>
</tr>
</tbody>
</table>
<p><span class="doc-section-title">Returns:</span></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td>
<code><a class="autorefs autorefs-internal" href="#search_api.bm25_index.BM25Index" title="search_api.bm25_index.BM25Index">BM25Index</a></code>
</td>
<td>
<div class="doc-md-description">
<p>Initialized BM25 index with documents loaded from parquet file.</p>
</div>
</td>
</tr>
</tbody>
</table>
<details class="note" open="">
<summary>Notes</summary>
<p>Path validation prevents path traversal attacks. The method uses an
in-memory DuckDB connection to read the parquet file. Title fields are
not included from parquet (defaults to empty string). Errors raised by
:func:<code>_validate_parquet_path</code> propagate unchanged.</p>
</details>
<details class="quote">
<summary>Source code in <code>src/search_api/bm25_index.py</code></summary>
<div class="highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">from_parquet</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">k1</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.9</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.4</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BM25Index</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Build BM25 index from a single parquet file.</span>

<span class="sd">    Creates a BM25 index by reading document chunks from a parquet file.</span>
<span class="sd">    Uses DuckDB to read the parquet file and extracts chunk_id, doc_id,</span>
<span class="sd">    section, and text fields for indexing.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    path : str</span>
<span class="sd">        Path to parquet file containing document chunks. Must exist and be</span>
<span class="sd">        within allowed directories (validated to prevent path traversal).</span>
<span class="sd">    k1 : float, optional</span>
<span class="sd">        Term frequency saturation parameter. Defaults to 0.9.</span>
<span class="sd">    b : float, optional</span>
<span class="sd">        Document length normalization parameter. Defaults to 0.4.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    BM25Index</span>
<span class="sd">        Initialized BM25 index with documents loaded from parquet file.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    Path validation prevents path traversal attacks. The method uses an</span>
<span class="sd">    in-memory DuckDB connection to read the parquet file. Title fields are</span>
<span class="sd">    not included from parquet (defaults to empty string). Errors raised by</span>
<span class="sd">    :func:`_validate_parquet_path` propagate unchanged.</span>
<span class="sd">    """</span>
    <span class="n">index</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="n">k1</span><span class="o">=</span><span class="n">k1</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="n">b</span><span class="p">)</span>
    <span class="n">con</span> <span class="o">=</span> <span class="n">duckdb</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">database</span><span class="o">=</span><span class="s2">":memory:"</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Validate and resolve path to prevent path traversal</span>
        <span class="n">resolved_path</span> <span class="o">=</span> <span class="n">_validate_parquet_path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="n">sql</span> <span class="o">=</span> <span class="s2">"""</span>
<span class="s2">            SELECT chunk_id,</span>
<span class="s2">                   coalesce(doc_id, chunk_id) AS doc_id,</span>
<span class="s2">                   coalesce(section,'') AS section,</span>
<span class="s2">                   text,</span>
<span class="s2">                   '' AS title</span>
<span class="s2">            FROM read_parquet(?, union_by_name=true)</span>
<span class="s2">        """</span>
        <span class="n">rows</span> <span class="o">=</span> <span class="n">fetch_all</span><span class="p">(</span><span class="n">con</span><span class="p">,</span> <span class="n">sql</span><span class="p">,</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">resolved_path</span><span class="p">)])</span>
        <span class="n">typed_rows</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span>
                <span class="n">_as_str</span><span class="p">(</span><span class="n">chunk_id_val</span><span class="p">),</span>
                <span class="n">_as_str</span><span class="p">(</span><span class="n">doc_id_val</span><span class="p">),</span>
                <span class="n">_as_str</span><span class="p">(</span><span class="n">section_val</span><span class="p">),</span>
                <span class="n">_as_str</span><span class="p">(</span><span class="n">text_val</span><span class="p">),</span>
                <span class="s2">""</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">chunk_id_val</span><span class="p">,</span> <span class="n">doc_id_val</span><span class="p">,</span> <span class="n">section_val</span><span class="p">,</span> <span class="n">text_val</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span> <span class="ow">in</span> <span class="n">rows</span>
        <span class="p">]</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">con</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="n">index</span><span class="o">.</span><span class="n">_build</span><span class="p">(</span><span class="n">typed_rows</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">index</span>
</code></pre></div></td></tr></tbody></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="search_api.bm25_index.BM25Index.load">
<code class="highlight language-python"><span class="n">load</span><span class="p">(</span><span class="n">path</span><span class="p">)</span></code>
<span class="doc doc-labels">
<small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
</span>
<a class="headerlink" href="#search_api.bm25_index.BM25Index.load" title="Permanent link">¶</a></h3>
<div class="doc doc-contents">
<p>Load BM25 index metadata from JSON with schema validation and checksum verification.</p>
<p>Deserializes index metadata from JSON, verifies the SHA256 checksum (if
present), validates against the BM25 metadata schema, and reconstructs
the index instance. Supports legacy pickle format as fallback.</p>
<p><span class="doc-section-title">Parameters:</span></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td>
<code>path</code>
</td>
<td>
<code><span title="str">str</span></code>
</td>
<td>
<div class="doc-md-description">
<p>Path to JSON metadata file. A <code>.sha256</code> checksum file will be
verified if present.</p>
</div>
</td>
<td>
<em>required</em>
</td>
</tr>
</tbody>
</table>
<p><span class="doc-section-title">Returns:</span></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td>
<code><a class="autorefs autorefs-internal" href="#search_api.bm25_index.BM25Index" title="search_api.bm25_index.BM25Index">BM25Index</a></code>
</td>
<td>
<div class="doc-md-description">
<p>Reconstructed BM25 index instance with all metadata loaded.</p>
</div>
</td>
</tr>
</tbody>
</table>
<details class="note" open="">
<summary>Notes</summary>
<p>The method attempts to load from JSON first. If the file has a <code>.pkl</code>
extension and JSON loading fails, it falls back to legacy pickle format
(with validation). All document frequencies, term frequencies, and
document metadata are reconstructed from the payload. Exceptions raised
by :func:<code>deserialize_json</code> or legacy payload loaders propagate
unchanged.</p>
</details>
<p><span class="doc-section-title">Examples:</span></p>
<div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">index</span> <span class="o">=</span> <span class="n">BM25Index</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">"/tmp/index.json"</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">index</span><span class="o">.</span><span class="n">N</span> <span class="o">&gt;</span> <span class="mi">0</span>
</code></pre></div>
<details class="quote">
<summary>Source code in <code>src/search_api/bm25_index.py</code></summary>
<div class="highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">load</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BM25Index</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Load BM25 index metadata from JSON with schema validation and checksum verification.</span>

<span class="sd">    Deserializes index metadata from JSON, verifies the SHA256 checksum (if</span>
<span class="sd">    present), validates against the BM25 metadata schema, and reconstructs</span>
<span class="sd">    the index instance. Supports legacy pickle format as fallback.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    path : str</span>
<span class="sd">        Path to JSON metadata file. A `.sha256` checksum file will be</span>
<span class="sd">        verified if present.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    BM25Index</span>
<span class="sd">        Reconstructed BM25 index instance with all metadata loaded.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The method attempts to load from JSON first. If the file has a `.pkl`</span>
<span class="sd">    extension and JSON loading fails, it falls back to legacy pickle format</span>
<span class="sd">    (with validation). All document frequencies, term frequencies, and</span>
<span class="sd">    document metadata are reconstructed from the payload. Exceptions raised</span>
<span class="sd">    by :func:`deserialize_json` or legacy payload loaders propagate</span>
<span class="sd">    unchanged.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; index = BM25Index.load("/tmp/index.json")</span>
<span class="sd">    &gt;&gt;&gt; assert index.N &gt; 0</span>
<span class="sd">    """</span>
    <span class="n">path_obj</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="n">schema_path</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">"schema"</span> <span class="o">/</span> <span class="s2">"models"</span> <span class="o">/</span> <span class="s2">"bm25_metadata.v1.json"</span>
    <span class="p">)</span>
    <span class="n">payload</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_load_payload</span><span class="p">(</span><span class="n">path_obj</span><span class="p">,</span> <span class="n">schema_path</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_index_from_payload</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
</code></pre></div></td></tr></tbody></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="search_api.bm25_index.BM25Index.save">
<code class="highlight language-python"><span class="n">save</span><span class="p">(</span><span class="n">path</span><span class="p">)</span></code>
<a class="headerlink" href="#search_api.bm25_index.BM25Index.save" title="Permanent link">¶</a></h3>
<div class="doc doc-contents">
<p>Save BM25 index metadata to JSON with schema validation and checksum.</p>
<p>Serializes index metadata (parameters, document frequencies, and document
list) to JSON format, validates it against the BM25 metadata schema, and
writes a SHA256 checksum file for integrity verification.</p>
<p><span class="doc-section-title">Parameters:</span></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td>
<code>path</code>
</td>
<td>
<code><span title="str">str</span></code>
</td>
<td>
<div class="doc-md-description">
<p>Output file path for JSON metadata. A <code>.sha256</code> checksum file will
be written alongside it.</p>
</div>
</td>
<td>
<em>required</em>
</td>
</tr>
</tbody>
</table>
<details class="note" open="">
<summary>Notes</summary>
<p>The serialized payload includes: k1, b, N (document count), avgdl (average
document length), df (document frequency dictionary), and docs (list of
BM25Doc data dictionaries). Exceptions raised by :func:<code>serialize_json</code>
propagate unchanged.</p>
</details>
<p><span class="doc-section-title">Examples:</span></p>
<div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">index</span> <span class="o">=</span> <span class="n">BM25Index</span><span class="p">(</span><span class="n">k1</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">index</span><span class="o">.</span><span class="n">N</span> <span class="o">=</span> <span class="mi">100</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">index</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">"/tmp/index.json"</span><span class="p">)</span>
</code></pre></div>
<details class="quote">
<summary>Source code in <code>src/search_api/bm25_index.py</code></summary>
<div class="highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Save BM25 index metadata to JSON with schema validation and checksum.</span>

<span class="sd">    Serializes index metadata (parameters, document frequencies, and document</span>
<span class="sd">    list) to JSON format, validates it against the BM25 metadata schema, and</span>
<span class="sd">    writes a SHA256 checksum file for integrity verification.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    path : str</span>
<span class="sd">        Output file path for JSON metadata. A `.sha256` checksum file will</span>
<span class="sd">        be written alongside it.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    The serialized payload includes: k1, b, N (document count), avgdl (average</span>
<span class="sd">    document length), df (document frequency dictionary), and docs (list of</span>
<span class="sd">    BM25Doc data dictionaries). Exceptions raised by :func:`serialize_json`</span>
<span class="sd">    propagate unchanged.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; index = BM25Index(k1=0.9, b=0.4)</span>
<span class="sd">    &gt;&gt;&gt; index.N = 100</span>
<span class="sd">    &gt;&gt;&gt; index.save("/tmp/index.json")</span>
<span class="sd">    """</span>
    <span class="n">path_obj</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="n">schema_path</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s2">"schema"</span> <span class="o">/</span> <span class="s2">"models"</span> <span class="o">/</span> <span class="s2">"bm25_metadata.v1.json"</span>
    <span class="p">)</span>
    <span class="c1"># Convert docs to JSON-serializable format</span>
    <span class="n">docs_data</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s2">"chunk_id"</span><span class="p">:</span> <span class="n">doc</span><span class="o">.</span><span class="n">chunk_id</span><span class="p">,</span>
            <span class="s2">"doc_id"</span><span class="p">:</span> <span class="n">doc</span><span class="o">.</span><span class="n">doc_id</span><span class="p">,</span>
            <span class="s2">"title"</span><span class="p">:</span> <span class="n">doc</span><span class="o">.</span><span class="n">title</span><span class="p">,</span>
            <span class="s2">"section"</span><span class="p">:</span> <span class="n">doc</span><span class="o">.</span><span class="n">section</span><span class="p">,</span>
            <span class="s2">"tf"</span><span class="p">:</span> <span class="n">doc</span><span class="o">.</span><span class="n">tf</span><span class="p">,</span>
            <span class="s2">"dl"</span><span class="p">:</span> <span class="n">doc</span><span class="o">.</span><span class="n">dl</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="k">for</span> <span class="n">doc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">docs</span>
    <span class="p">]</span>
    <span class="n">payload</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">"k1"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">k1</span><span class="p">,</span>
        <span class="s2">"b"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="p">,</span>
        <span class="s2">"N"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">,</span>
        <span class="s2">"avgdl"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">avgdl</span><span class="p">,</span>
        <span class="s2">"df"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">,</span>
        <span class="s2">"docs"</span><span class="p">:</span> <span class="n">docs_data</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">serialize_json</span><span class="p">(</span><span class="n">payload</span><span class="p">,</span> <span class="n">schema_path</span><span class="p">,</span> <span class="n">path_obj</span><span class="p">)</span>
</code></pre></div></td></tr></tbody></table></div>
</details>
</div>
</div>
<div class="doc doc-object doc-function">
<h3 class="doc doc-heading" id="search_api.bm25_index.BM25Index.search">
<code class="highlight language-python"><span class="n">search</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span></code>
<a class="headerlink" href="#search_api.bm25_index.BM25Index.search" title="Permanent link">¶</a></h3>
<div class="doc doc-contents">
<p>Search index and return top-k results ranked by BM25 score.</p>
<p>Tokenizes the query, computes BM25 relevance scores for all documents,
and returns the top-k results sorted by score in descending order.</p>
<p><span class="doc-section-title">Parameters:</span></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td>
<code>query</code>
</td>
<td>
<code><span title="str">str</span></code>
</td>
<td>
<div class="doc-md-description">
<p>Search query string to tokenize and match against documents.</p>
</div>
</td>
<td>
<em>required</em>
</td>
</tr>
<tr class="doc-section-item">
<td>
<code>k</code>
</td>
<td>
<code><span title="int">int</span></code>
</td>
<td>
<div class="doc-md-description">
<p>Maximum number of results to return. Defaults to 10.</p>
</div>
</td>
<td>
<code>10</code>
</td>
</tr>
</tbody>
</table>
<p><span class="doc-section-title">Returns:</span></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td>
<code><span title="list">list</span>[<span title="tuple">tuple</span>[<span title="str">str</span>, <span title="float">float</span>]]</code>
</td>
<td>
<div class="doc-md-description">
<p>List of (chunk_id, score) tuples sorted by score descending. Only
includes documents with score &gt; 0.0. Returns empty list if index is
empty or no documents match.</p>
</div>
</td>
</tr>
</tbody>
</table>
<details class="note" open="">
<summary>Notes</summary>
<p>BM25 scoring combines term frequency (TF), inverse document frequency
(IDF), and document length normalization. Documents with higher scores
are more relevant to the query.</p>
</details>
<details class="quote">
<summary>Source code in <code>src/search_api/bm25_index.py</code></summary>
<div class="highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">search</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">k</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">"""Search index and return top-k results ranked by BM25 score.</span>

<span class="sd">    Tokenizes the query, computes BM25 relevance scores for all documents,</span>
<span class="sd">    and returns the top-k results sorted by score in descending order.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    query : str</span>
<span class="sd">        Search query string to tokenize and match against documents.</span>
<span class="sd">    k : int, optional</span>
<span class="sd">        Maximum number of results to return. Defaults to 10.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    list[tuple[str, float]]</span>
<span class="sd">        List of (chunk_id, score) tuples sorted by score descending. Only</span>
<span class="sd">        includes documents with score &gt; 0.0. Returns empty list if index is</span>
<span class="sd">        empty or no documents match.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    BM25 scoring combines term frequency (TF), inverse document frequency</span>
<span class="sd">    (IDF), and document length normalization. Documents with higher scores</span>
<span class="sd">    are more relevant to the query.</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[]</span>
    <span class="n">terms</span> <span class="o">=</span> <span class="n">toks</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
    <span class="n">scores</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">N</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">doc</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">docs</span><span class="p">):</span>
        <span class="n">score</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">for</span> <span class="n">term</span> <span class="ow">in</span> <span class="n">terms</span><span class="p">:</span>
            <span class="n">tf</span> <span class="o">=</span> <span class="n">doc</span><span class="o">.</span><span class="n">tf</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">term</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">tf</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">idf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_idf</span><span class="p">(</span><span class="n">term</span><span class="p">)</span>
            <span class="n">denom</span> <span class="o">=</span> <span class="n">tf</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">k1</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span> <span class="o">*</span> <span class="p">(</span><span class="n">doc</span><span class="o">.</span><span class="n">dl</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">avgdl</span> <span class="ow">or</span> <span class="mf">1.0</span><span class="p">)))</span>
            <span class="n">score</span> <span class="o">+=</span> <span class="n">idf</span> <span class="o">*</span> <span class="p">((</span><span class="n">tf</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">k1</span> <span class="o">+</span> <span class="mf">1.0</span><span class="p">))</span> <span class="o">/</span> <span class="n">denom</span><span class="p">)</span>
        <span class="n">scores</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">score</span>

    <span class="c1"># Explicitly type sorted callable to avoid Any</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">key_func</span><span class="p">(</span><span class="n">item</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">"""Extract score from (index, score) tuple for sorting.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        item : tuple[int, float]</span>
<span class="sd">            Tuple of (index, score).</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        float</span>
<span class="sd">            Score value.</span>
<span class="sd">        """</span>
        <span class="k">return</span> <span class="n">item</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">ranked</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">enumerate</span><span class="p">(</span><span class="n">scores</span><span class="p">),</span> <span class="n">key</span><span class="o">=</span><span class="n">key_func</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">docs</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">chunk_id</span><span class="p">,</span> <span class="n">score</span><span class="p">)</span> <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">score</span> <span class="ow">in</span> <span class="n">ranked</span><span class="p">[:</span><span class="n">k</span><span class="p">]</span> <span class="k">if</span> <span class="n">score</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">]</span>
</code></pre></div></td></tr></tbody></table></div>
</details>
</div>
</div>
</div>
</div>
</div><h3 id="search_apibm25_index_as_str">search_api.bm25_index._as_str<a class="headerlink" href="#search_apibm25_index_as_str" title="Permanent link">¶</a></h3>
<div class="doc doc-object doc-function">
<h2 class="doc doc-heading" id="search_api.bm25_index._as_str">
<code class="highlight language-python"><span class="n">search_api</span><span class="o">.</span><span class="n">bm25_index</span><span class="o">.</span><span class="n">_as_str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span></code>
<a class="headerlink" href="#search_api.bm25_index._as_str" title="Permanent link">¶</a></h2>
<div class="doc doc-contents first">
<details class="quote">
<summary>Source code in <code>src/search_api/bm25_index.py</code></summary>
<div class="highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_as_str</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="nb">object</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">value</span>
    <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">""</span>
    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</code></pre></div></td></tr></tbody></table></div>
</details>
</div>
</div><h3 id="search_apibm25_index_validate_parquet_path">search_api.bm25_index._validate_parquet_path<a class="headerlink" href="#search_apibm25_index_validate_parquet_path" title="Permanent link">¶</a></h3>
<div class="doc doc-object doc-function">
<h2 class="doc doc-heading" id="search_api.bm25_index._validate_parquet_path">
<code class="highlight language-python"><span class="n">search_api</span><span class="o">.</span><span class="n">bm25_index</span><span class="o">.</span><span class="n">_validate_parquet_path</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">allowed_roots</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">must_exist</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>
<a class="headerlink" href="#search_api.bm25_index._validate_parquet_path" title="Permanent link">¶</a></h2>
<div class="doc doc-contents first">
<p>Validate and resolve parquet path against allowlist to prevent path traversal.</p>
<p><span class="doc-section-title">Parameters:</span></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td>
<code>path</code>
</td>
<td>
<code><span title="str">str</span> | <span title="pathlib.Path">Path</span></code>
</td>
<td>
<div class="doc-md-description">
<p>Path to validate (may be relative or absolute).</p>
</div>
</td>
<td>
<em>required</em>
</td>
</tr>
<tr class="doc-section-item">
<td>
<code>allowed_roots</code>
</td>
<td>
<code><span title="list">list</span>[<span title="pathlib.Path">Path</span>] | None</code>
</td>
<td>
<div class="doc-md-description">
<p>List of allowed root directories. If None, uses environment variable
PARQUET_ROOT or default /data/parquet.</p>
</div>
</td>
<td>
<code>None</code>
</td>
</tr>
<tr class="doc-section-item">
<td>
<code>must_exist</code>
</td>
<td>
<code><span title="bool">bool</span></code>
</td>
<td>
<div class="doc-md-description">
<p>If True, require path to exist. If False, only validate it's within
allowed directory. Defaults to True.</p>
</div>
</td>
<td>
<code>True</code>
</td>
</tr>
</tbody>
</table>
<p><span class="doc-section-title">Returns:</span></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td>
<code><span title="pathlib.Path">Path</span></code>
</td>
<td>
<div class="doc-md-description">
<p>Resolved absolute path that is within an allowed directory.</p>
</div>
</td>
</tr>
</tbody>
</table>
<p><span class="doc-section-title">Raises:</span></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td>
<code><a class="autorefs autorefs-internal" href="../../kgfoundry_common/errors/exceptions/#kgfoundry_common.errors.exceptions.ConfigurationError" title="kgfoundry_common.errors.exceptions.ConfigurationError (kgfoundry_common.errors.ConfigurationError)">ConfigurationError</a></code>
</td>
<td>
<div class="doc-md-description">
<p>If path resolves outside allowed directories or contains invalid characters.</p>
</div>
</td>
</tr>
<tr class="doc-section-item">
<td>
<code><span title="ValueError">ValueError</span></code>
</td>
<td>
<div class="doc-md-description">
<p>If path cannot be resolved or (when must_exist=True) is not accessible.</p>
</div>
</td>
</tr>
</tbody>
</table>
<details class="note" open="">
<summary>Notes</summary>
<p>This function prevents path traversal attacks by:
1. Resolving paths to absolute paths using Path.resolve()
2. Checking resolved path is within allowed root directories
3. Validating path exists and is accessible (when must_exist=True)
4. Rejecting paths with unsafe patterns (.., symlinks outside allowed roots)</p>
</details>
<p><span class="doc-section-title">Examples:</span></p>
<div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">_validate_parquet_path</span><span class="p">(</span><span class="s2">"/data/parquet/chunks"</span><span class="p">,</span> <span class="n">allowed_roots</span><span class="o">=</span><span class="p">[</span><span class="n">Path</span><span class="p">(</span><span class="s2">"/data/parquet"</span><span class="p">)])</span>
<span class="go">Path('/data/parquet/chunks')</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">_validate_parquet_path</span><span class="p">(</span><span class="s2">"../../../etc/passwd"</span><span class="p">,</span> <span class="n">allowed_roots</span><span class="o">=</span><span class="p">[</span><span class="n">Path</span><span class="p">(</span><span class="s2">"/data/parquet"</span><span class="p">)])</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="w">    </span><span class="o">...</span>
<span class="gr">ConfigurationError</span>: <span class="n">Path resolves outside allowed directories</span>
</code></pre></div>
<details class="quote">
<summary>Source code in <code>src/search_api/bm25_index.py</code></summary>
<div class="highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_validate_parquet_path</span><span class="p">(</span>
    <span class="n">path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">allowed_roots</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Path</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">must_exist</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Path</span><span class="p">:</span>
<span class="w">    </span><span class="sd">"""Validate and resolve parquet path against allowlist to prevent path traversal.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    path : str | Path</span>
<span class="sd">        Path to validate (may be relative or absolute).</span>
<span class="sd">    allowed_roots : list[Path] | None, optional</span>
<span class="sd">        List of allowed root directories. If None, uses environment variable</span>
<span class="sd">        PARQUET_ROOT or default /data/parquet.</span>
<span class="sd">    must_exist : bool, optional</span>
<span class="sd">        If True, require path to exist. If False, only validate it's within</span>
<span class="sd">        allowed directory. Defaults to True.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    Path</span>
<span class="sd">        Resolved absolute path that is within an allowed directory.</span>

<span class="sd">    Raises</span>
<span class="sd">    ------</span>
<span class="sd">    ConfigurationError</span>
<span class="sd">        If path resolves outside allowed directories or contains invalid characters.</span>
<span class="sd">    ValueError</span>
<span class="sd">        If path cannot be resolved or (when must_exist=True) is not accessible.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>
<span class="sd">    This function prevents path traversal attacks by:</span>
<span class="sd">    1. Resolving paths to absolute paths using Path.resolve()</span>
<span class="sd">    2. Checking resolved path is within allowed root directories</span>
<span class="sd">    3. Validating path exists and is accessible (when must_exist=True)</span>
<span class="sd">    4. Rejecting paths with unsafe patterns (.., symlinks outside allowed roots)</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; from pathlib import Path</span>
<span class="sd">    &gt;&gt;&gt; _validate_parquet_path("/data/parquet/chunks", allowed_roots=[Path("/data/parquet")])</span>
<span class="sd">    Path('/data/parquet/chunks')</span>

<span class="sd">    &gt;&gt;&gt; _validate_parquet_path("../../../etc/passwd", allowed_roots=[Path("/data/parquet")])</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">        ...</span>
<span class="sd">    ConfigurationError: Path resolves outside allowed directories</span>
<span class="sd">    """</span>
    <span class="n">candidate</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">expanduser</span><span class="p">()</span>

    <span class="c1"># Resolve to absolute path to prevent path traversal</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">resolved</span> <span class="o">=</span> <span class="n">candidate</span><span class="o">.</span><span class="n">resolve</span><span class="p">(</span><span class="n">strict</span><span class="o">=</span><span class="n">must_exist</span><span class="p">)</span>
    <span class="k">except</span> <span class="p">(</span><span class="ne">OSError</span><span class="p">,</span> <span class="ne">RuntimeError</span><span class="p">)</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"Invalid parquet path: </span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2">"</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">exc</span>

    <span class="c1"># Determine allowed roots</span>
    <span class="k">if</span> <span class="n">allowed_roots</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">parquet_root_env</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">"PARQUET_ROOT"</span><span class="p">,</span> <span class="s2">"/data/parquet"</span><span class="p">)</span>
        <span class="n">allowed_roots</span> <span class="o">=</span> <span class="p">[</span><span class="n">Path</span><span class="p">(</span><span class="n">parquet_root_env</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()]</span>

    <span class="c1"># Validate path is within allowed directory</span>
    <span class="n">is_allowed</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">for</span> <span class="n">allowed_root</span> <span class="ow">in</span> <span class="n">allowed_roots</span><span class="p">:</span>
        <span class="n">allowed_resolved</span> <span class="o">=</span> <span class="n">allowed_root</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Check if resolved path is within allowed root</span>
            <span class="n">resolved</span><span class="o">.</span><span class="n">relative_to</span><span class="p">(</span><span class="n">allowed_resolved</span><span class="p">)</span>
            <span class="n">is_allowed</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">break</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="c1"># Path is not relative to this allowed root, continue checking</span>
            <span class="k">continue</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">is_allowed</span><span class="p">:</span>
        <span class="n">allowed_str</span> <span class="o">=</span> <span class="s2">", "</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">root</span><span class="p">)</span> <span class="k">for</span> <span class="n">root</span> <span class="ow">in</span> <span class="n">allowed_roots</span><span class="p">)</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">"Path resolves outside allowed directories. "</span>
            <span class="sa">f</span><span class="s2">"Resolved: </span><span class="si">{</span><span class="n">resolved</span><span class="si">}</span><span class="s2">, Allowed roots: </span><span class="si">{</span><span class="n">allowed_str</span><span class="si">}</span><span class="s2">"</span>
        <span class="p">)</span>
        <span class="k">raise</span> <span class="n">ConfigurationError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="c1"># Verify path exists and is accessible (if required)</span>
    <span class="k">if</span> <span class="n">must_exist</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">resolved</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"Parquet path does not exist: </span><span class="si">{</span><span class="n">resolved</span><span class="si">}</span><span class="s2">"</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">resolved</span>
</code></pre></div></td></tr></tbody></table></div>
</details>
</div>
</div><h3 id="search_apibm25_indextoks">search_api.bm25_index.toks<a class="headerlink" href="#search_apibm25_indextoks" title="Permanent link">¶</a></h3>
<div class="doc doc-object doc-function">
<h2 class="doc doc-heading" id="search_api.bm25_index.toks">
<code class="highlight language-python"><span class="n">search_api</span><span class="o">.</span><span class="n">bm25_index</span><span class="o">.</span><span class="n">toks</span><span class="p">(</span><span class="n">text</span><span class="p">)</span></code>
<a class="headerlink" href="#search_api.bm25_index.toks" title="Permanent link">¶</a></h2>
<div class="doc doc-contents first">
<p>Extract tokens from text using word boundary regex.</p>
<p>Tokenizes input text by finding all sequences of alphanumeric characters
(using regex pattern <code>[A-Za-z0-9]+</code>) and converting them to lowercase.
Used for BM25 indexing and query processing.</p>
<p><span class="doc-section-title">Parameters:</span></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td>
<code>text</code>
</td>
<td>
<code><span title="str">str</span></code>
</td>
<td>
<div class="doc-md-description">
<p>Input text to tokenize. May be empty or None (treated as empty).</p>
</div>
</td>
<td>
<em>required</em>
</td>
</tr>
</tbody>
</table>
<p><span class="doc-section-title">Returns:</span></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="doc-section-item">
<td>
<code><span title="list">list</span>[<span title="str">str</span>]</code>
</td>
<td>
<div class="doc-md-description">
<p>List of lowercase tokens extracted from the text. Empty list if input
is empty or contains no alphanumeric sequences.</p>
</div>
</td>
</tr>
</tbody>
</table>
<p><span class="doc-section-title">Examples:</span></p>
<div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">toks</span><span class="p">(</span><span class="s2">"Hello World 123"</span><span class="p">)</span>
<span class="go">['hello', 'world', '123']</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">toks</span><span class="p">(</span><span class="s2">""</span><span class="p">)</span>
<span class="go">[]</span>
</code></pre></div>
<details class="quote">
<summary>Source code in <code>src/search_api/bm25_index.py</code></summary>
<div class="highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">toks</span><span class="p">(</span><span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">"""Extract tokens from text using word boundary regex.</span>

<span class="sd">    Tokenizes input text by finding all sequences of alphanumeric characters</span>
<span class="sd">    (using regex pattern ``[A-Za-z0-9]+``) and converting them to lowercase.</span>
<span class="sd">    Used for BM25 indexing and query processing.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    text : str</span>
<span class="sd">        Input text to tokenize. May be empty or None (treated as empty).</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    list[str]</span>
<span class="sd">        List of lowercase tokens extracted from the text. Empty list if input</span>
<span class="sd">        is empty or contains no alphanumeric sequences.</span>

<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; toks("Hello World 123")</span>
<span class="sd">    ['hello', 'world', '123']</span>
<span class="sd">    &gt;&gt;&gt; toks("")</span>
<span class="sd">    []</span>
<span class="sd">    """</span>
    <span class="c1"># re.findall returns list[str] when pattern has no groups</span>
    <span class="n">matches</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">TOKEN_RE</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">text</span> <span class="ow">or</span> <span class="s2">""</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">token</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">token</span> <span class="ow">in</span> <span class="n">matches</span><span class="p">]</span>
</code></pre></div></td></tr></tbody></table></div>
</details>
</div>
</div><h2 id="relationships">Relationships<a class="headerlink" href="#relationships" title="Permanent link">¶</a></h2>
<p><strong>Imports:</strong> <code>__future__.annotations</code>, <code>collections.abc.Iterable</code>, <code>dataclasses.dataclass</code>, <code>duckdb</code>, <code>kgfoundry_common.errors.ConfigurationError</code>, <code>kgfoundry_common.errors.DeserializationError</code>, <code>kgfoundry_common.navmap_loader.load_nav_metadata</code>, <code>kgfoundry_common.problem_details.JsonValue</code>, <code>kgfoundry_common.safe_pickle_v2.UnsafeSerializationError</code>, <code>kgfoundry_common.safe_pickle_v2.load_unsigned_legacy</code>, <code>kgfoundry_common.serialization.deserialize_json</code>, <code>kgfoundry_common.serialization.serialize_json</code>, <code>math</code>, <code>os</code>, <code>pathlib.Path</code>, <code>re</code>, <code>registry.duckdb_helpers.fetch_all</code>, <code>registry.duckdb_helpers.fetch_one</code>, <code>typing.TYPE_CHECKING</code>, <code>typing.cast</code></p>
<p><strong>Imported by:</strong> <a href="../">search_api</a></p>
<h2 id="autorefs-examples">Autorefs Examples<a class="headerlink" href="#autorefs-examples" title="Permanent link">¶</a></h2>
<ul>
<li><a class="autorefs autorefs-internal" href="#search_api.bm25_index.BM25Doc" title="search_api.bm25_index.BM25Doc


  
      dataclass
  ">search_api.bm25_index.BM25Doc</a></li>
<li><a class="autorefs autorefs-internal" href="#search_api.bm25_index.BM25Index">search_api.bm25_index.BM25Index</a></li>
<li><a class="autorefs autorefs-internal" href="#search_api.bm25_index._as_str" title="search_api.bm25_index._as_str(value)">search_api.bm25_index._as_str</a></li>
<li><a class="autorefs autorefs-internal" href="#search_api.bm25_index._validate_parquet_path" title="search_api.bm25_index._validate_parquet_path(path, *, allowed_roots=None, must_exist=True)">search_api.bm25_index._validate_parquet_path</a></li>
<li><a class="autorefs autorefs-internal" href="#search_api.bm25_index.toks" title="search_api.bm25_index.toks(text)">search_api.bm25_index.toks</a></li>
</ul>
<h2 id="inheritance">Inheritance<a class="headerlink" href="#inheritance" title="Permanent link">¶</a></h2>
<pre class="mermaid"><code>classDiagram
    class BM25Doc
    class BM25Index
</code></pre>
<h2 id="neighborhood">Neighborhood<a class="headerlink" href="#neighborhood" title="Permanent link">¶</a></h2>
<div class="d2"><svg aria-label="Diagram" data-d2-version="v0.7.1" preserveAspectRatio="xMinYMin meet" role="img" viewBox="0 0 1217 2788" xmlns:ns0="http://www.w3.org/1999/xlink"><svg class="d2-7f44ae4d85cc452ca889a75c26371bde d2-svg" height="2788" viewBox="-101 -101 1217 2788" width="1217"><rect class="fill-N7" fill="#FFFFFF" height="2788.000000" rx="0.000000" stroke-width="0" width="1217.000000" x="-101.000000" y="-101.000000"></rect><style type="text/css">
.appendix-icon {
	filter: drop-shadow(0px 0px 32px rgba(31, 36, 58, 0.1));
}
.d2-7f44ae4d85cc452ca889a75c26371bde .text-bold {
	font-family: "d2-7f44ae4d85cc452ca889a75c26371bde-font-bold";
}
@font-face {
	font-family: d2-7f44ae4d85cc452ca889a75c26371bde-font-bold;
	src: url("data:application/font-woff;base64,d09GRgABAAAAABFwAAoAAAAAGjwAAguFAAAAAAAAAAAAAAAAAAAAAAAAAABPUy8yAAAA9AAAAGAAAABgXxHXrmNtYXAAAAFUAAAAvgAAAQYFugaZZ2x5ZgAAAhQAAAprAAAOJN7XCt5oZWFkAAAMgAAAADYAAAA2G38e1GhoZWEAAAy4AAAAJAAAACQKfwXzaG10eAAADNwAAAC/AAAA0GOHB91sb2NhAAANnAAAAGoAAABqYUZdxm1heHAAAA4IAAAAIAAAACAATAD3bmFtZQAADigAAAMoAAAIKgjwVkFwb3N0AAARUAAAAB0AAAAg/9EAMgADAioCvAAFAAACigJYAAAASwKKAlgAAAFeADIBKQAAAgsHAwMEAwICBGAAAvcAAAADAAAAAAAAAABBREJPACAAIP//Au7/BgAAA9gBESAAAZ8AAAAAAfAClAAAACAAA3ichM3JKkVxHMDxz7n3mK95no9rnu4h2dhKFkpKKSt5A1lIHgo7iXgFr+AdFNn81D/7+11/6otMVYaa3C/qCrmKQkNpx649B44cO3Hm3IUrN+4i+Dfbyew7TOY0mUvXbiPiM0IWP/EdX/Eeb/EaL/EcT/ERj/EQ9+ncrMymLavWrNvQUFGVa9GqTbsOnbrUdOvRq0+p34BBQ4aNGDVm3IRJU6bNmFWYUzdvwaIly1b4AwAA//8BAAD//xojLjkAAHicbFd9bBvlGX/e147dOJcP+3w+2/H3xXe2kzixz+fLt+PUcdrUzmeTfuWLqOsKTdtA0yVAEEgg0JhLAXddQVthqBPbBJtQNwnYwjRExyqYxFQY0sRH2dAG/AGBeRsbyd10ZydtOv5I3uj0vu/ze57f7/c8b6AMhgDwLD4DGiiHajABBcAbvUY/z3GMXuRFkaE1IoeM+iFskn50gQtqg0FtyHPOfcf0NMpO4TPrcweys7P/mm5vl86/8KJ0Cp14EQBBWC7gZnwOagHKfCwrxOJxPmqh9SzL+HQ6ymzho3GR1qHJkQdHx06NJA56B2wi07CzfnxHIGEdGCEy3z0699gw75uindGpnoPzdbaJGcCQBcAZnANDESkftVgos07HcHw0HhdiLMsw2ecPPjo8dHqm0dEyGg6PtjhwLnV6fv7RvsXAxMDAPj8o+LIA6DOcgwo1X8pL8RRDeaksOid99d57qBrnlu+98+wybOSSwufA/XW5lFIRGIE36nTo6L5HxvY8vKfvkCdrawllZiYOmFli7lPfraWEYt4pi2t+9uC8wTC/JL3pDRex4LENLDzFC7yRMTLGbP6DM2c+wLmvvlpfQDXS6gZuuIpzoFH3GrN5nFtfAAQ1cgFdxDmoAaB9LCdaFFSCkTeadbq/9B/yHTQ12wLBfMMk0d7e7/VEkuhpKZs43FW6E8/hHBDFO3mS15CMRk9l89qXn7r08Q+fyOCc9E9UIa1JS4g8+PONMwoPpHqGpHmWFRTcGo6xWCgq+72fdmu1VTllKavEOenXD8fuafvb+gLqfSi+3PZ3gBKXzWpc8xYuGcrIR4WYQuXVHSfT6YXe4R1L3R0pnOMmBjOzTe+ikcN8CNR6MHIBG/A5CKncbOQdYzkujP+PKJouRkDm7ruju5nxQLiRrx/zdrDtN6da5kO7PN0c29ga2t2ebjtGNIe/4WJ9TrfTVFfVlG6K7401hCZttW6Hy2X0WXf3xidaAIENAJM4B3olA0bwUozx9YvovxdxzfLy+moR4065gAdxDowqRpWUa+yggbvvP9Mmih0P3UucvYCmpPxMJjODjkpPXTgLSP4PAOZxDioBeA1PWiw0H4+LJK956dL3B6rpam2VtSp79hWck94QDsXjhwTUrOhB/hIAUzgH1QC8oOHp0kGR11Arl863VdkrtVWOyvbHL32ELpz197Jsr/+sNPGRyktILqA30RrYgFHVJMTiolpCPacWlDIyHKPTiYrsVS+/lBq6L4+ZoLu7Tmg60jZ9aMmgdfdts/nJgQ43sScxsLfay1mpm5x1x26TPuQdzG00ucdQ77TSarykXMAWvALmksM4Rs8YeUqvBlMJ4xROGZ+eslhQr3e7U0ucyGudKV/H3qaO6b1sfLwhaA4QXo+AV57J2J1dt2bGbk8spTP3N75mqlI5qJMLaAWtgf1GD1+zMK3TIVvv8eSOb6XCfY5exiMkEs3WMNnmHyc6T46MLnS66GlnJtmdpapnPLWgYufkAlrDK0CCZ6NW6sWcYobNKm0I8IuJ4+3TsWCLTZdfMmjtaWzlTGS9mYk3Ed+5ffhkl8Oa+cn69oidWTLbXjNVbe/b2QtYxf4BWgPrDR1IKY3eqyhewa7hY0oU5O67rWf7XHvfZJMWS28b0hEhHmGnHr/INfjiRNfCyPBCInEkRfrL47x3n92F2oJCU1GnVgC0gC8rq6Jl8Qb/KC3SuL+np25ouztWU1tpJ2pd+/ahu46W1QrjMUI3V1bmZV0npHsBNOCTG7EerUETtEO/WhlWiCmFUMQkbKRA8xRTMr2PU3lQ5GXW6TSqiYtFI4t/Mz5W3fJF21RLH1nrsdqDbVNCg/eXg/ry2F7R6Tb5gkMTN6WW+50c53RyXDDazfl5m5eo7bxib2noCGgrA+7aaI3WlKrvGAwQRyp85tb+OkO1hTS1b+eHw+hyKMgFA4FgSMrX2egajcZqcziLtUkqZKsaVXu0fsMIRhWl3pjM6x27osM7806PI2DFK8/ss9UfmZReR954wEZLz4EsgwgA7+IrmIUIAOghCg8CyLL8B7kD3le/86Xvuc2YLryy2ZdFXk8ynJ5Kntb+4Mmf/eqJ+QRekY5del1657d9dyj75QIy4RXF8/R1fUYRx+8z7XljeZleZyL8xIFdmFl/mzYhdLRMX4yjcaI18KpxlD6hsL4lQ/3mmlS8nY4ISdLbHxnalXd6/M3Krya02u1urA/4IhtpN0vPlZaN+qG1Uv1KMa6v35JB68luFhCtJlyNW+pX9IGqqeobXhXXWkRJMciSOJ5KHU8kjqVSxxKN4XBjuLGx5OHOhdGRk52L2e5kRrFysf/swBa0BiS4AOhr6FRZshxNkdfaj4LTuZPbf7hjOu7psJcNsvHx+pA58Dz+ccTOfPvE2FKi1jb4CKrbbD5q7ug0WgPTlvoWXVXMvDbDUg6DtdJW4+g0o9U90UhZ2d1abTAqXQUElFxAT6A14LbM9hjLFmfc5mXKhHNhyqy7Evkm2+NLuL0uZ9juag/cPNa6x91jj9lbW1lPZ/AwwbonbLU0abSQBqKuNdg7zln3mi2c1VZVwbSGt08WNW+UC+gYXgC6OLcERhBFXn0oXWuYMDGYyhjvWFxknITNQJMiccv45aO6++478WrIr9Me0RHFuzrkAvoSrSr8b9GmsdQm/zS8M+/yOFhLfqlC4+4njkyimPS+ELQ70Q6pptffAEjxAZLRamkWXjfSLj59pttAGrTlpCF56im0+ok/y3FZ/ydSjRpbIaGAVpVZzZPcdQf1NMOxrBJer686d/p8g8Fi0G4zbfOde/ix880ETWjLzeUcwp8OUfUUVU8NyZ+PUA0UVW8ZUe4l5C60jlYVNV7jRRS3QKvCSxZvtV1v2uYPGPS/OdNXYTJotxnLO049Q7cMvqzTzqOyOqcd/fUtX9rP9DFvSRVdY6W3DQuAfoFWoVyZ4aTyuNDwFPvGC2j+jbcHUfjEgPTHE8q+NAD6M75T7RPK2BHicVFpUukHF2M7fHOLi+j4AYPDvL62WLzXBYA+xA+AQ9nfhYu2Kc12VfVKd+Mp//Bd6UjQJ1qHmmZTiSmhfSJm7bDcszt7182NTRHOPhjlowc6hePH45qyZeVei1xA7+MHIHijThlhw5wbLwizTjGTEusf2aNMypkONLU4+nvHuwOsT3T1N8y2zd4u8mJf8ggRDUw66rg6R9ByuIn1+l32/Wz9gdFI2qKtyXa1j9YXc6LlArqK71Qm5JbYakzSSzH6zez+PTDH9jhTgUhbS4PD7+wxocMfV3hZ8UBL8hYi5p+0+6OR5miVKYSSy4vVoT2p9MGYGqNTLsBn8KzyTi9O+mImZ1meZ1meJwQuIAgBTlB6vboXfY45aARAKdApq6qZBfSR/KryfqcFL0Wgd3Kjo4CgUp5Bcfw79TvJayovz1x+UnNo7fFS/4A30erGmz+ZR6tSDSD5WdwKo/iKgsd4HR5/OOz3h8O4NcQwIeVHsY0yY95Cq1/7/0GdO1htN5AGJ533ZF/ZppvTaLkg+lwi4/tF+B8AAAD//wEAAP//J8wDgQAAAQAAAAILhTageWlfDzz1AAED6AAAAADYXaCEAAAAAN1mLzb+N/7ECG0D8QABAAMAAgAAAAAAAAABAAAD2P7vAAAImP43/jcIbQABAAAAAAAAAAAAAAAAAAAANHicHM2xLsdQHEfx8/tKJKJ/rqSKpQM3JFxdSbTDb2liuIkEgxfwEhLewN7VbrF6AQOTVzEwyBUdznaSj1644A000umOrEjWPZ2eyHZMtl+CbsmayLoiK7GnxI4mzpXKjxblW+scasDtk6iBAy0T7ZptNezqDLeaE2vKhyJuLb50g6vHdTT/bo+4vbJpD2zolF6rVBJrWqGyd/YVGBVoFWgU2LLEMPdFZZcsrMahPP8bfwAAAP//AQAA//9qdyGvAAAAACwALABYAHwAkgDCANgA5AECARwBPgFgAaABsgHQAewCCgJCAnQCoALSAwYDLAOUA7YDwgPOA+YEAgQ0BFYEggSyBNIFDgU0BVYFcgWeBc4F4gX6BiYGZAaWBqwGuAbEBtIG3gb0BxIAAAABAAAANACQAAwAYwAHAAEAAAAAAAAAAAAAAAAABAADeJyclM9uG1UUxn9ObNMKwQJFVbqJ7oJFkejYVEnVNiuH1IpFFAePC0JCSBPP+I8ynhl5Jg7hCVjzFrxFVzwEz4FYo/l87NgF0SaKknx37vnznXO+c4Ed/mabSvUh8Ec9MVxhr35ueIsH9RPD27TrW4arPKn9abhGWJsbrvN5rWf4I95WfzP8gP3qT4YfslttG/6YZ9Udw59sO/4y/Cn7vF3gCrzgV8MVdskMb7HDj4a3eYTFrFR5RNNwjc/YM1xnD+gzoSBmQsIIx5AJI66YEZHjEzFjwpCIEEeHFjGFviYEQo7Rf34N8CmYESjimAJHjE9MQM7YIv4ir5RzZRzqNLO7FgVjAi7kcUlAgiNlREpCxKXiFBRkvKJBg5yB+GYU5HjkTIjxSJkxokGXNqf0GTMhx9FWpJKZT8qQgmsC5XdmUXZmQERCbqyuSAjF04lfJO8Opzi6ZLJdj3y6EeFLHN/Ju+SWyvYrPP26NWabeZdsAubqZ6yuxLq51gTHui3ztvhWuOAV7l792WTy/h6F+l8o8gVXmn+oSSVikuDcLi18Kch3j3Ec6dzBV0e+p0OfE7q8oa9zix49WpzRp8Nr+Xbp4fiaLmccy6MjvLhrSzFn/IDjGzqyKWNH1p/FxCJ+JjN15+I4Ux1TMvW8ZO6p1kgV3n3C5Q6lG+rI5TPQHpWWTvNLtGcBI1NFJoZT9XKpjdz6F5oipqqlnO3tfbkNc9u95RbfkGqHS7UuOJWTWzB631S9dzRzrR+PgJCUC1kMSJnSoOBGvM8JuCLGcazunWhLClornzLPjVQSMRWDDonizMj0NzDd+MZ9sKF7Z29JKP+S6eWqqvtkcerV7YzeqHvLO9+6HK1NoGFTTdfUNBDXxLQfaafW+fvyzfW6pTzliJSY8F8vwDM8muxzwCFjZRjoZm6vQ1MvRJOXHKr6SyJZDaXnyCIc4PGcAw54yfN3+rhk4oyLW3FZz93imCO6HH5QFQv7Lke8Xn37/6y/i2lTtTierk4v7j3FJ3dQ6xfas9v3sqeJlZOYW7TbrTgjYFpycbvrNbnHeP8AAAD//wEAAP//9LdPUXicYmBmAIP/5xiMGLAAAAAAAP//AQAA//8vAQIDAAAA");
}</style><style type="text/css">.shape {
  shape-rendering: geometricPrecision;
  stroke-linejoin: round;
}
.connection {
  stroke-linecap: round;
  stroke-linejoin: round;
}
.blend {
  mix-blend-mode: multiply;
  opacity: 0.5;
}

		.d2-7f44ae4d85cc452ca889a75c26371bde .fill-N1{fill:#0A0F25;}
		.d2-7f44ae4d85cc452ca889a75c26371bde .fill-N2{fill:#676C7E;}
		.d2-7f44ae4d85cc452ca889a75c26371bde .fill-N3{fill:#9499AB;}
		.d2-7f44ae4d85cc452ca889a75c26371bde .fill-N4{fill:#CFD2DD;}
		.d2-7f44ae4d85cc452ca889a75c26371bde .fill-N5{fill:#DEE1EB;}
		.d2-7f44ae4d85cc452ca889a75c26371bde .fill-N6{fill:#EEF1F8;}
		.d2-7f44ae4d85cc452ca889a75c26371bde .fill-N7{fill:#FFFFFF;}
		.d2-7f44ae4d85cc452ca889a75c26371bde .fill-B1{fill:#0D32B2;}
		.d2-7f44ae4d85cc452ca889a75c26371bde .fill-B2{fill:#0D32B2;}
		.d2-7f44ae4d85cc452ca889a75c26371bde .fill-B3{fill:#E3E9FD;}
		.d2-7f44ae4d85cc452ca889a75c26371bde .fill-B4{fill:#E3E9FD;}
		.d2-7f44ae4d85cc452ca889a75c26371bde .fill-B5{fill:#EDF0FD;}
		.d2-7f44ae4d85cc452ca889a75c26371bde .fill-B6{fill:#F7F8FE;}
		.d2-7f44ae4d85cc452ca889a75c26371bde .fill-AA2{fill:#4A6FF3;}
		.d2-7f44ae4d85cc452ca889a75c26371bde .fill-AA4{fill:#EDF0FD;}
		.d2-7f44ae4d85cc452ca889a75c26371bde .fill-AA5{fill:#F7F8FE;}
		.d2-7f44ae4d85cc452ca889a75c26371bde .fill-AB4{fill:#EDF0FD;}
		.d2-7f44ae4d85cc452ca889a75c26371bde .fill-AB5{fill:#F7F8FE;}
		.d2-7f44ae4d85cc452ca889a75c26371bde .stroke-N1{stroke:#0A0F25;}
		.d2-7f44ae4d85cc452ca889a75c26371bde .stroke-N2{stroke:#676C7E;}
		.d2-7f44ae4d85cc452ca889a75c26371bde .stroke-N3{stroke:#9499AB;}
		.d2-7f44ae4d85cc452ca889a75c26371bde .stroke-N4{stroke:#CFD2DD;}
		.d2-7f44ae4d85cc452ca889a75c26371bde .stroke-N5{stroke:#DEE1EB;}
		.d2-7f44ae4d85cc452ca889a75c26371bde .stroke-N6{stroke:#EEF1F8;}
		.d2-7f44ae4d85cc452ca889a75c26371bde .stroke-N7{stroke:#FFFFFF;}
		.d2-7f44ae4d85cc452ca889a75c26371bde .stroke-B1{stroke:#0D32B2;}
		.d2-7f44ae4d85cc452ca889a75c26371bde .stroke-B2{stroke:#0D32B2;}
		.d2-7f44ae4d85cc452ca889a75c26371bde .stroke-B3{stroke:#E3E9FD;}
		.d2-7f44ae4d85cc452ca889a75c26371bde .stroke-B4{stroke:#E3E9FD;}
		.d2-7f44ae4d85cc452ca889a75c26371bde .stroke-B5{stroke:#EDF0FD;}
		.d2-7f44ae4d85cc452ca889a75c26371bde .stroke-B6{stroke:#F7F8FE;}
		.d2-7f44ae4d85cc452ca889a75c26371bde .stroke-AA2{stroke:#4A6FF3;}
		.d2-7f44ae4d85cc452ca889a75c26371bde .stroke-AA4{stroke:#EDF0FD;}
		.d2-7f44ae4d85cc452ca889a75c26371bde .stroke-AA5{stroke:#F7F8FE;}
		.d2-7f44ae4d85cc452ca889a75c26371bde .stroke-AB4{stroke:#EDF0FD;}
		.d2-7f44ae4d85cc452ca889a75c26371bde .stroke-AB5{stroke:#F7F8FE;}
		.d2-7f44ae4d85cc452ca889a75c26371bde .background-color-N1{background-color:#0A0F25;}
		.d2-7f44ae4d85cc452ca889a75c26371bde .background-color-N2{background-color:#676C7E;}
		.d2-7f44ae4d85cc452ca889a75c26371bde .background-color-N3{background-color:#9499AB;}
		.d2-7f44ae4d85cc452ca889a75c26371bde .background-color-N4{background-color:#CFD2DD;}
		.d2-7f44ae4d85cc452ca889a75c26371bde .background-color-N5{background-color:#DEE1EB;}
		.d2-7f44ae4d85cc452ca889a75c26371bde .background-color-N6{background-color:#EEF1F8;}
		.d2-7f44ae4d85cc452ca889a75c26371bde .background-color-N7{background-color:#FFFFFF;}
		.d2-7f44ae4d85cc452ca889a75c26371bde .background-color-B1{background-color:#0D32B2;}
		.d2-7f44ae4d85cc452ca889a75c26371bde .background-color-B2{background-color:#0D32B2;}
		.d2-7f44ae4d85cc452ca889a75c26371bde .background-color-B3{background-color:#E3E9FD;}
		.d2-7f44ae4d85cc452ca889a75c26371bde .background-color-B4{background-color:#E3E9FD;}
		.d2-7f44ae4d85cc452ca889a75c26371bde .background-color-B5{background-color:#EDF0FD;}
		.d2-7f44ae4d85cc452ca889a75c26371bde .background-color-B6{background-color:#F7F8FE;}
		.d2-7f44ae4d85cc452ca889a75c26371bde .background-color-AA2{background-color:#4A6FF3;}
		.d2-7f44ae4d85cc452ca889a75c26371bde .background-color-AA4{background-color:#EDF0FD;}
		.d2-7f44ae4d85cc452ca889a75c26371bde .background-color-AA5{background-color:#F7F8FE;}
		.d2-7f44ae4d85cc452ca889a75c26371bde .background-color-AB4{background-color:#EDF0FD;}
		.d2-7f44ae4d85cc452ca889a75c26371bde .background-color-AB5{background-color:#F7F8FE;}
		.d2-7f44ae4d85cc452ca889a75c26371bde .color-N1{color:#0A0F25;}
		.d2-7f44ae4d85cc452ca889a75c26371bde .color-N2{color:#676C7E;}
		.d2-7f44ae4d85cc452ca889a75c26371bde .color-N3{color:#9499AB;}
		.d2-7f44ae4d85cc452ca889a75c26371bde .color-N4{color:#CFD2DD;}
		.d2-7f44ae4d85cc452ca889a75c26371bde .color-N5{color:#DEE1EB;}
		.d2-7f44ae4d85cc452ca889a75c26371bde .color-N6{color:#EEF1F8;}
		.d2-7f44ae4d85cc452ca889a75c26371bde .color-N7{color:#FFFFFF;}
		.d2-7f44ae4d85cc452ca889a75c26371bde .color-B1{color:#0D32B2;}
		.d2-7f44ae4d85cc452ca889a75c26371bde .color-B2{color:#0D32B2;}
		.d2-7f44ae4d85cc452ca889a75c26371bde .color-B3{color:#E3E9FD;}
		.d2-7f44ae4d85cc452ca889a75c26371bde .color-B4{color:#E3E9FD;}
		.d2-7f44ae4d85cc452ca889a75c26371bde .color-B5{color:#EDF0FD;}
		.d2-7f44ae4d85cc452ca889a75c26371bde .color-B6{color:#F7F8FE;}
		.d2-7f44ae4d85cc452ca889a75c26371bde .color-AA2{color:#4A6FF3;}
		.d2-7f44ae4d85cc452ca889a75c26371bde .color-AA4{color:#EDF0FD;}
		.d2-7f44ae4d85cc452ca889a75c26371bde .color-AA5{color:#F7F8FE;}
		.d2-7f44ae4d85cc452ca889a75c26371bde .color-AB4{color:#EDF0FD;}
		.d2-7f44ae4d85cc452ca889a75c26371bde .color-AB5{color:#F7F8FE;}.appendix text.text{fill:#0A0F25}.md{--color-fg-default:#0A0F25;--color-fg-muted:#676C7E;--color-fg-subtle:#9499AB;--color-canvas-default:#FFFFFF;--color-canvas-subtle:#EEF1F8;--color-border-default:#0D32B2;--color-border-muted:#0D32B2;--color-neutral-muted:#EEF1F8;--color-accent-fg:#0D32B2;--color-accent-emphasis:#0D32B2;--color-attention-subtle:#676C7E;--color-danger-fg:red;}.sketch-overlay-B1{fill:url(#streaks-darker-d2-7f44ae4d85cc452ca889a75c26371bde);mix-blend-mode:lighten}.sketch-overlay-B2{fill:url(#streaks-darker-d2-7f44ae4d85cc452ca889a75c26371bde);mix-blend-mode:lighten}.sketch-overlay-B3{fill:url(#streaks-bright-d2-7f44ae4d85cc452ca889a75c26371bde);mix-blend-mode:darken}.sketch-overlay-B4{fill:url(#streaks-bright-d2-7f44ae4d85cc452ca889a75c26371bde);mix-blend-mode:darken}.sketch-overlay-B5{fill:url(#streaks-bright-d2-7f44ae4d85cc452ca889a75c26371bde);mix-blend-mode:darken}.sketch-overlay-B6{fill:url(#streaks-bright-d2-7f44ae4d85cc452ca889a75c26371bde);mix-blend-mode:darken}.sketch-overlay-AA2{fill:url(#streaks-dark-d2-7f44ae4d85cc452ca889a75c26371bde);mix-blend-mode:overlay}.sketch-overlay-AA4{fill:url(#streaks-bright-d2-7f44ae4d85cc452ca889a75c26371bde);mix-blend-mode:darken}.sketch-overlay-AA5{fill:url(#streaks-bright-d2-7f44ae4d85cc452ca889a75c26371bde);mix-blend-mode:darken}.sketch-overlay-AB4{fill:url(#streaks-bright-d2-7f44ae4d85cc452ca889a75c26371bde);mix-blend-mode:darken}.sketch-overlay-AB5{fill:url(#streaks-bright-d2-7f44ae4d85cc452ca889a75c26371bde);mix-blend-mode:darken}.sketch-overlay-N1{fill:url(#streaks-darker-d2-7f44ae4d85cc452ca889a75c26371bde);mix-blend-mode:lighten}.sketch-overlay-N2{fill:url(#streaks-dark-d2-7f44ae4d85cc452ca889a75c26371bde);mix-blend-mode:overlay}.sketch-overlay-N3{fill:url(#streaks-normal-d2-7f44ae4d85cc452ca889a75c26371bde);mix-blend-mode:color-burn}.sketch-overlay-N4{fill:url(#streaks-normal-d2-7f44ae4d85cc452ca889a75c26371bde);mix-blend-mode:color-burn}.sketch-overlay-N5{fill:url(#streaks-bright-d2-7f44ae4d85cc452ca889a75c26371bde);mix-blend-mode:darken}.sketch-overlay-N6{fill:url(#streaks-bright-d2-7f44ae4d85cc452ca889a75c26371bde);mix-blend-mode:darken}.sketch-overlay-N7{fill:url(#streaks-bright-d2-7f44ae4d85cc452ca889a75c26371bde);mix-blend-mode:darken}.light-code{display: block}.dark-code{display: none}</style><a href="./search_api/bm25_index.md" ns0:href="./search_api/bm25_index.md"><g class="JiMzNDtzZWFyY2hfYXBpLmJtMjVfaW5kZXgmIzM0Ow=="><g class="shape"><rect class="stroke-B1 fill-B6" fill="#F7F8FE" height="66.000000" stroke="#0D32B2" style="stroke-width:2;" width="214.000000" x="222.000000" y="1260.000000"></rect></g><text class="text-bold fill-N1" fill="#0A0F25" style="text-anchor:middle;font-size:16px" x="329.000000" y="1298.500000">search_api.bm25_index</text></g></a><g class="JiMzNDtfX2Z1dHVyZV9fLmFubm90YXRpb25zJiMzNDs="><g class="shape"><rect class="stroke-B1 fill-B6" fill="#F7F8FE" height="66.000000" stroke="#0D32B2" style="stroke-width:2;" width="212.000000" x="670.000000" y="0.000000"></rect></g><text class="text-bold fill-N1" fill="#0A0F25" style="text-anchor:middle;font-size:16px" x="776.000000" y="38.500000">__future__.annotations</text></g><g class="JiMzNDtjb2xsZWN0aW9ucy5hYmMuSXRlcmFibGUmIzM0Ow=="><g class="shape"><rect class="stroke-B1 fill-B6" fill="#F7F8FE" height="66.000000" stroke="#0D32B2" style="stroke-width:2;" width="213.000000" x="669.000000" y="126.000000"></rect></g><text class="text-bold fill-N1" fill="#0A0F25" style="text-anchor:middle;font-size:16px" x="775.500000" y="164.500000">collections.abc.Iterable</text></g><g class="JiMzNDtkYXRhY2xhc3Nlcy5kYXRhY2xhc3MmIzM0Ow=="><g class="shape"><rect class="stroke-B1 fill-B6" fill="#F7F8FE" height="66.000000" stroke="#0D32B2" style="stroke-width:2;" width="199.000000" x="676.000000" y="252.000000"></rect></g><text class="text-bold fill-N1" fill="#0A0F25" style="text-anchor:middle;font-size:16px" x="775.500000" y="290.500000">dataclasses.dataclass</text></g><g class="ZHVja2Ri"><g class="shape"><rect class="stroke-B1 fill-B6" fill="#F7F8FE" height="66.000000" stroke="#0D32B2" style="stroke-width:2;" width="98.000000" x="727.000000" y="378.000000"></rect></g><text class="text-bold fill-N1" fill="#0A0F25" style="text-anchor:middle;font-size:16px" x="776.000000" y="416.500000">duckdb</text></g><g class="JiMzNDtrZ2ZvdW5kcnlfY29tbW9uLmVycm9ycy5Db25maWd1cmF0aW9uRXJyb3ImIzM0Ow=="><g class="shape"><rect class="stroke-B1 fill-B6" fill="#F7F8FE" height="66.000000" stroke="#0D32B2" style="stroke-width:2;" width="377.000000" x="587.000000" y="504.000000"></rect></g><text class="text-bold fill-N1" fill="#0A0F25" style="text-anchor:middle;font-size:16px" x="775.500000" y="542.500000">kgfoundry_common.errors.ConfigurationError</text></g><g class="JiMzNDtrZ2ZvdW5kcnlfY29tbW9uLmVycm9ycy5EZXNlcmlhbGl6YXRpb25FcnJvciYjMzQ7"><g class="shape"><rect class="stroke-B1 fill-B6" fill="#F7F8FE" height="66.000000" stroke="#0D32B2" style="stroke-width:2;" width="385.000000" x="583.000000" y="630.000000"></rect></g><text class="text-bold fill-N1" fill="#0A0F25" style="text-anchor:middle;font-size:16px" x="775.500000" y="668.500000">kgfoundry_common.errors.DeserializationError</text></g><g class="JiMzNDtrZ2ZvdW5kcnlfY29tbW9uLm5hdm1hcF9sb2FkZXIubG9hZF9uYXZfbWV0YWRhdGEmIzM0Ow=="><g class="shape"><rect class="stroke-B1 fill-B6" fill="#F7F8FE" height="66.000000" stroke="#0D32B2" style="stroke-width:2;" width="450.000000" x="551.000000" y="756.000000"></rect></g><text class="text-bold fill-N1" fill="#0A0F25" style="text-anchor:middle;font-size:16px" x="776.000000" y="794.500000">kgfoundry_common.navmap_loader.load_nav_metadata</text></g><g class="JiMzNDtrZ2ZvdW5kcnlfY29tbW9uLnByb2JsZW1fZGV0YWlscy5Kc29uVmFsdWUmIzM0Ow=="><g class="shape"><rect class="stroke-B1 fill-B6" fill="#F7F8FE" height="66.000000" stroke="#0D32B2" style="stroke-width:2;" width="386.000000" x="583.000000" y="882.000000"></rect></g><text class="text-bold fill-N1" fill="#0A0F25" style="text-anchor:middle;font-size:16px" x="776.000000" y="920.500000">kgfoundry_common.problem_details.JsonValue</text></g><g class="JiMzNDtrZ2ZvdW5kcnlfY29tbW9uLnNhZmVfcGlja2xlX3YyLlVuc2FmZVNlcmlhbGl6YXRpb25FcnJvciYjMzQ7"><g class="shape"><rect class="stroke-B1 fill-B6" fill="#F7F8FE" height="66.000000" stroke="#0D32B2" style="stroke-width:2;" width="479.000000" x="536.000000" y="1008.000000"></rect></g><text class="text-bold fill-N1" fill="#0A0F25" style="text-anchor:middle;font-size:16px" x="775.500000" y="1046.500000">kgfoundry_common.safe_pickle_v2.UnsafeSerializationError</text></g><g class="JiMzNDtrZ2ZvdW5kcnlfY29tbW9uLnNhZmVfcGlja2xlX3YyLmxvYWRfdW5zaWduZWRfbGVnYWN5JiMzNDs="><g class="shape"><rect class="stroke-B1 fill-B6" fill="#F7F8FE" height="66.000000" stroke="#0D32B2" style="stroke-width:2;" width="461.000000" x="545.000000" y="1134.000000"></rect></g><text class="text-bold fill-N1" fill="#0A0F25" style="text-anchor:middle;font-size:16px" x="775.500000" y="1172.500000">kgfoundry_common.safe_pickle_v2.load_unsigned_legacy</text></g><g class="JiMzNDtrZ2ZvdW5kcnlfY29tbW9uLnNlcmlhbGl6YXRpb24uZGVzZXJpYWxpemVfanNvbiYjMzQ7"><g class="shape"><rect class="stroke-B1 fill-B6" fill="#F7F8FE" height="66.000000" stroke="#0D32B2" style="stroke-width:2;" width="400.000000" x="576.000000" y="1260.000000"></rect></g><text class="text-bold fill-N1" fill="#0A0F25" style="text-anchor:middle;font-size:16px" x="776.000000" y="1298.500000">kgfoundry_common.serialization.deserialize_json</text></g><g class="JiMzNDtrZ2ZvdW5kcnlfY29tbW9uLnNlcmlhbGl6YXRpb24uc2VyaWFsaXplX2pzb24mIzM0Ow=="><g class="shape"><rect class="stroke-B1 fill-B6" fill="#F7F8FE" height="66.000000" stroke="#0D32B2" style="stroke-width:2;" width="382.000000" x="585.000000" y="1386.000000"></rect></g><text class="text-bold fill-N1" fill="#0A0F25" style="text-anchor:middle;font-size:16px" x="776.000000" y="1424.500000">kgfoundry_common.serialization.serialize_json</text></g><g class="bWF0aA=="><g class="shape"><rect class="stroke-B1 fill-B6" fill="#F7F8FE" height="66.000000" stroke="#0D32B2" style="stroke-width:2;" width="82.000000" x="735.000000" y="1512.000000"></rect></g><text class="text-bold fill-N1" fill="#0A0F25" style="text-anchor:middle;font-size:16px" x="776.000000" y="1550.500000">math</text></g><g class="b3M="><g class="shape"><rect class="stroke-B1 fill-B6" fill="#F7F8FE" height="66.000000" stroke="#0D32B2" style="stroke-width:2;" width="61.000000" x="745.000000" y="1638.000000"></rect></g><text class="text-bold fill-N1" fill="#0A0F25" style="text-anchor:middle;font-size:16px" x="775.500000" y="1676.500000">os</text></g><g class="JiMzNDtwYXRobGliLlBhdGgmIzM0Ow=="><g class="shape"><rect class="stroke-B1 fill-B6" fill="#F7F8FE" height="66.000000" stroke="#0D32B2" style="stroke-width:2;" width="133.000000" x="709.000000" y="1764.000000"></rect></g><text class="text-bold fill-N1" fill="#0A0F25" style="text-anchor:middle;font-size:16px" x="775.500000" y="1802.500000">pathlib.Path</text></g><g class="cmU="><g class="shape"><rect class="stroke-B1 fill-B6" fill="#F7F8FE" height="66.000000" stroke="#0D32B2" style="stroke-width:2;" width="59.000000" x="746.000000" y="1890.000000"></rect></g><text class="text-bold fill-N1" fill="#0A0F25" style="text-anchor:middle;font-size:16px" x="775.500000" y="1928.500000">re</text></g><g class="JiMzNDtyZWdpc3RyeS5kdWNrZGJfaGVscGVycy5mZXRjaF9hbGwmIzM0Ow=="><g class="shape"><rect class="stroke-B1 fill-B6" fill="#F7F8FE" height="66.000000" stroke="#0D32B2" style="stroke-width:2;" width="286.000000" x="633.000000" y="2016.000000"></rect></g><text class="text-bold fill-N1" fill="#0A0F25" style="text-anchor:middle;font-size:16px" x="776.000000" y="2054.500000">registry.duckdb_helpers.fetch_all</text></g><g class="JiMzNDtyZWdpc3RyeS5kdWNrZGJfaGVscGVycy5mZXRjaF9vbmUmIzM0Ow=="><g class="shape"><rect class="stroke-B1 fill-B6" fill="#F7F8FE" height="66.000000" stroke="#0D32B2" style="stroke-width:2;" width="294.000000" x="629.000000" y="2142.000000"></rect></g><text class="text-bold fill-N1" fill="#0A0F25" style="text-anchor:middle;font-size:16px" x="776.000000" y="2180.500000">registry.duckdb_helpers.fetch_one</text></g><g class="JiMzNDt0eXBpbmcuVFlQRV9DSEVDS0lORyYjMzQ7"><g class="shape"><rect class="stroke-B1 fill-B6" fill="#F7F8FE" height="66.000000" stroke="#0D32B2" style="stroke-width:2;" width="213.000000" x="669.000000" y="2268.000000"></rect></g><text class="text-bold fill-N1" fill="#0A0F25" style="text-anchor:middle;font-size:16px" x="775.500000" y="2306.500000">typing.TYPE_CHECKING</text></g><g class="JiMzNDt0eXBpbmcuY2FzdCYjMzQ7"><g class="shape"><rect class="stroke-B1 fill-B6" fill="#F7F8FE" height="66.000000" stroke="#0D32B2" style="stroke-width:2;" width="125.000000" x="713.000000" y="2394.000000"></rect></g><text class="text-bold fill-N1" fill="#0A0F25" style="text-anchor:middle;font-size:16px" x="775.500000" y="2432.500000">typing.cast</text></g><a href="./search_api.md" ns0:href="./search_api.md"><g class="c2VhcmNoX2FwaQ=="><g class="shape"><rect class="stroke-B1 fill-B6" fill="#F7F8FE" height="66.000000" stroke="#0D32B2" style="stroke-width:2;" width="122.000000" x="0.000000" y="1260.000000"></rect></g><text class="text-bold fill-N1" fill="#0A0F25" style="text-anchor:middle;font-size:16px" x="61.000000" y="1298.500000">search_api</text></g></a><a href="https://github.com/kgfoundry/kgfoundry/blob/main/src/search_api/bm25_index.py" ns0:href="https://github.com/kgfoundry/kgfoundry/blob/main/src/search_api/bm25_index.py"><g class="JiMzNDtzZWFyY2hfYXBpLmJtMjVfaW5kZXhfY29kZSYjMzQ7"><g class="shape"><rect class="stroke-B1 fill-B6" fill="#F7F8FE" height="66.000000" stroke="#0D32B2" style="stroke-width:2;" width="251.000000" x="650.000000" y="2520.000000"></rect></g><text class="text-bold fill-N1" fill="#0A0F25" style="text-anchor:middle;font-size:16px" x="775.500000" y="2558.500000">search_api.bm25_index code</text></g></a><g class="KCYjMzQ7c2VhcmNoX2FwaS5ibTI1X2luZGV4JiMzNDsgLSZndDsgJiMzNDtfX2Z1dHVyZV9fLmFubm90YXRpb25zJiMzNDspWzBd"><marker id="mk-d2-7f44ae4d85cc452ca889a75c26371bde-3488378134" markerHeight="12.000000" markerUnits="userSpaceOnUse" markerWidth="10.000000" orient="auto" refX="7.000000" refY="6.000000" viewBox="0.000000 0.000000 10.000000 12.000000"> <polygon class="connection fill-B1" fill="#0D32B2" points="0.000000,0.000000 10.000000,6.000000 0.000000,12.000000" stroke-width="2"></polygon> </marker><path class="connection stroke-B1" d="M 333.247472 1258.015370 C 455.399994 278.399994 522.700012 33.000000 665.500000 33.000000" fill="none" marker-end="url(#mk-d2-7f44ae4d85cc452ca889a75c26371bde-3488378134)" mask="url(#d2-7f44ae4d85cc452ca889a75c26371bde)" stroke="#0D32B2" style="stroke-width:2;"></path></g><g class="KCYjMzQ7c2VhcmNoX2FwaS5ibTI1X2luZGV4JiMzNDsgLSZndDsgJiMzNDtjb2xsZWN0aW9ucy5hYmMuSXRlcmFibGUmIzM0OylbMF0="><path class="connection stroke-B1" d="M 334.273518 1258.018791 C 455.600006 379.199005 522.599976 159.000000 665.000000 159.000000" fill="none" marker-end="url(#mk-d2-7f44ae4d85cc452ca889a75c26371bde-3488378134)" mask="url(#d2-7f44ae4d85cc452ca889a75c26371bde)" stroke="#0D32B2" style="stroke-width:2;"></path></g><g class="KCYjMzQ7c2VhcmNoX2FwaS5ibTI1X2luZGV4JiMzNDsgLSZndDsgJiMzNDtkYXRhY2xhc3Nlcy5kYXRhY2xhc3MmIzM0OylbMF0="><path class="connection stroke-B1" d="M 334.308074 1258.023870 C 455.600006 480.000000 524.000000 285.000000 672.000000 285.000000" fill="none" marker-end="url(#mk-d2-7f44ae4d85cc452ca889a75c26371bde-3488378134)" mask="url(#d2-7f44ae4d85cc452ca889a75c26371bde)" stroke="#0D32B2" style="stroke-width:2;"></path></g><g class="KCYjMzQ7c2VhcmNoX2FwaS5ibTI1X2luZGV4JiMzNDsgLSZndDsgZHVja2RiKVswXQ=="><path class="connection stroke-B1" d="M 335.350217 1258.030902 C 455.799988 580.799988 534.099976 411.000000 722.500000 411.000000" fill="none" marker-end="url(#mk-d2-7f44ae4d85cc452ca889a75c26371bde-3488378134)" mask="url(#d2-7f44ae4d85cc452ca889a75c26371bde)" stroke="#0D32B2" style="stroke-width:2;"></path></g><g class="KCYjMzQ7c2VhcmNoX2FwaS5ibTI1X2luZGV4JiMzNDsgLSZndDsgJiMzNDtrZ2ZvdW5kcnlfY29tbW9uLmVycm9ycy5Db25maWd1cmF0aW9uRXJyb3ImIzM0OylbMF0="><path class="connection stroke-B1" d="M 336.406286 1258.041702 C 456.000000 681.599976 506.200012 537.000000 583.000000 537.000000" fill="none" marker-end="url(#mk-d2-7f44ae4d85cc452ca889a75c26371bde-3488378134)" mask="url(#d2-7f44ae4d85cc452ca889a75c26371bde)" stroke="#0D32B2" style="stroke-width:2;"></path></g><g class="KCYjMzQ7c2VhcmNoX2FwaS5ibTI1X2luZGV4JiMzNDsgLSZndDsgJiMzNDtrZ2ZvdW5kcnlfY29tbW9uLmVycm9ycy5EZXNlcmlhbGl6YXRpb25FcnJvciYjMzQ7KVswXQ=="><path class="connection stroke-B1" d="M 337.484306 1258.059524 C 456.200012 782.400024 505.399994 663.000000 579.000000 663.000000" fill="none" marker-end="url(#mk-d2-7f44ae4d85cc452ca889a75c26371bde-3488378134)" mask="url(#d2-7f44ae4d85cc452ca889a75c26371bde)" stroke="#0D32B2" style="stroke-width:2;"></path></g><g class="KCYjMzQ7c2VhcmNoX2FwaS5ibTI1X2luZGV4JiMzNDsgLSZndDsgJiMzNDtrZ2ZvdW5kcnlfY29tbW9uLm5hdm1hcF9sb2FkZXIubG9hZF9uYXZfbWV0YWRhdGEmIzM0OylbMF0="><path class="connection stroke-B1" d="M 339.595858 1258.090824 C 456.600006 883.200012 498.899994 789.000000 546.500000 789.000000" fill="none" marker-end="url(#mk-d2-7f44ae4d85cc452ca889a75c26371bde-3488378134)" mask="url(#d2-7f44ae4d85cc452ca889a75c26371bde)" stroke="#0D32B2" style="stroke-width:2;"></path></g><g class="KCYjMzQ7c2VhcmNoX2FwaS5ibTI1X2luZGV4JiMzNDsgLSZndDsgJiMzNDtrZ2ZvdW5kcnlfY29tbW9uLnByb2JsZW1fZGV0YWlscy5Kc29uVmFsdWUmIzM0OylbMF0="><path class="connection stroke-B1" d="M 343.765807 1258.152423 C 457.399994 984.000000 505.299988 915.000000 578.500000 915.000000" fill="none" marker-end="url(#mk-d2-7f44ae4d85cc452ca889a75c26371bde-3488378134)" mask="url(#d2-7f44ae4d85cc452ca889a75c26371bde)" stroke="#0D32B2" style="stroke-width:2;"></path></g><g class="KCYjMzQ7c2VhcmNoX2FwaS5ibTI1X2luZGV4JiMzNDsgLSZndDsgJiMzNDtrZ2ZvdW5kcnlfY29tbW9uLnNhZmVfcGlja2xlX3YyLlVuc2FmZVNlcmlhbGl6YXRpb25FcnJvciYjMzQ7KVswXQ=="><path class="connection stroke-B1" d="M 351.055112 1258.300960 C 458.799988 1084.800049 496.000000 1041.000000 532.000000 1041.000000" fill="none" marker-end="url(#mk-d2-7f44ae4d85cc452ca889a75c26371bde-3488378134)" mask="url(#d2-7f44ae4d85cc452ca889a75c26371bde)" stroke="#0D32B2" style="stroke-width:2;"></path></g><g class="KCYjMzQ7c2VhcmNoX2FwaS5ibTI1X2luZGV4JiMzNDsgLSZndDsgJiMzNDtrZ2ZvdW5kcnlfY29tbW9uLnNhZmVfcGlja2xlX3YyLmxvYWRfdW5zaWduZWRfbGVnYWN5JiMzNDspWzBd"><path class="connection stroke-B1" d="M 371.560424 1258.748970 C 462.799988 1185.599976 497.799988 1167.000000 541.000000 1167.000000" fill="none" marker-end="url(#mk-d2-7f44ae4d85cc452ca889a75c26371bde-3488378134)" mask="url(#d2-7f44ae4d85cc452ca889a75c26371bde)" stroke="#0D32B2" style="stroke-width:2;"></path></g><g class="KCYjMzQ7c2VhcmNoX2FwaS5ibTI1X2luZGV4JiMzNDsgLSZndDsgJiMzNDtrZ2ZvdW5kcnlfY29tbW9uLnNlcmlhbGl6YXRpb24uZGVzZXJpYWxpemVfanNvbiYjMzQ7KVswXQ=="><path class="connection stroke-B1" d="M 438.000000 1293.000000 C 476.000000 1293.000000 503.899994 1293.000000 571.500000 1293.000000" fill="none" marker-end="url(#mk-d2-7f44ae4d85cc452ca889a75c26371bde-3488378134)" mask="url(#d2-7f44ae4d85cc452ca889a75c26371bde)" stroke="#0D32B2" style="stroke-width:2;"></path></g><g class="KCYjMzQ7c2VhcmNoX2FwaS5ibTI1X2luZGV4JiMzNDsgLSZndDsgJiMzNDtrZ2ZvdW5kcnlfY29tbW9uLnNlcmlhbGl6YXRpb24uc2VyaWFsaXplX2pzb24mIzM0OylbMF0="><path class="connection stroke-B1" d="M 371.560424 1327.251030 C 462.799988 1400.400024 505.700012 1419.000000 580.500000 1419.000000" fill="none" marker-end="url(#mk-d2-7f44ae4d85cc452ca889a75c26371bde-3488378134)" mask="url(#d2-7f44ae4d85cc452ca889a75c26371bde)" stroke="#0D32B2" style="stroke-width:2;"></path></g><g class="KCYjMzQ7c2VhcmNoX2FwaS5ibTI1X2luZGV4JiMzNDsgLSZndDsgbWF0aClbMF0="><path class="connection stroke-B1" d="M 351.055112 1327.699040 C 458.799988 1501.199951 535.700012 1545.000000 730.500000 1545.000000" fill="none" marker-end="url(#mk-d2-7f44ae4d85cc452ca889a75c26371bde-3488378134)" mask="url(#d2-7f44ae4d85cc452ca889a75c26371bde)" stroke="#0D32B2" style="stroke-width:2;"></path></g><g class="KCYjMzQ7c2VhcmNoX2FwaS5ibTI1X2luZGV4JiMzNDsgLSZndDsgb3MpWzBd"><path class="connection stroke-B1" d="M 343.765807 1327.847577 C 457.399994 1602.000000 537.799988 1671.000000 741.000000 1671.000000" fill="none" marker-end="url(#mk-d2-7f44ae4d85cc452ca889a75c26371bde-3488378134)" mask="url(#d2-7f44ae4d85cc452ca889a75c26371bde)" stroke="#0D32B2" style="stroke-width:2;"></path></g><g class="KCYjMzQ7c2VhcmNoX2FwaS5ibTI1X2luZGV4JiMzNDsgLSZndDsgJiMzNDtwYXRobGliLlBhdGgmIzM0OylbMF0="><path class="connection stroke-B1" d="M 339.595858 1327.909176 C 456.600006 1702.800049 530.599976 1797.000000 705.000000 1797.000000" fill="none" marker-end="url(#mk-d2-7f44ae4d85cc452ca889a75c26371bde-3488378134)" mask="url(#d2-7f44ae4d85cc452ca889a75c26371bde)" stroke="#0D32B2" style="stroke-width:2;"></path></g><g class="KCYjMzQ7c2VhcmNoX2FwaS5ibTI1X2luZGV4JiMzNDsgLSZndDsgcmUpWzBd"><path class="connection stroke-B1" d="M 337.484306 1327.940476 C 456.200012 1803.599976 538.000000 1923.000000 742.000000 1923.000000" fill="none" marker-end="url(#mk-d2-7f44ae4d85cc452ca889a75c26371bde-3488378134)" mask="url(#d2-7f44ae4d85cc452ca889a75c26371bde)" stroke="#0D32B2" style="stroke-width:2;"></path></g><g class="KCYjMzQ7c2VhcmNoX2FwaS5ibTI1X2luZGV4JiMzNDsgLSZndDsgJiMzNDtyZWdpc3RyeS5kdWNrZGJfaGVscGVycy5mZXRjaF9hbGwmIzM0OylbMF0="><path class="connection stroke-B1" d="M 336.406286 1327.958298 C 456.000000 1904.400024 515.299011 2049.000000 628.500000 2049.000000" fill="none" marker-end="url(#mk-d2-7f44ae4d85cc452ca889a75c26371bde-3488378134)" mask="url(#d2-7f44ae4d85cc452ca889a75c26371bde)" stroke="#0D32B2" style="stroke-width:2;"></path></g><g class="KCYjMzQ7c2VhcmNoX2FwaS5ibTI1X2luZGV4JiMzNDsgLSZndDsgJiMzNDtyZWdpc3RyeS5kdWNrZGJfaGVscGVycy5mZXRjaF9vbmUmIzM0OylbMF0="><path class="connection stroke-B1" d="M 335.350217 1327.969098 C 455.799988 2005.199951 514.500000 2175.000000 624.500000 2175.000000" fill="none" marker-end="url(#mk-d2-7f44ae4d85cc452ca889a75c26371bde-3488378134)" mask="url(#d2-7f44ae4d85cc452ca889a75c26371bde)" stroke="#0D32B2" style="stroke-width:2;"></path></g><g class="KCYjMzQ7c2VhcmNoX2FwaS5ibTI1X2luZGV4JiMzNDsgLSZndDsgJiMzNDt0eXBpbmcuVFlQRV9DSEVDS0lORyYjMzQ7KVswXQ=="><path class="connection stroke-B1" d="M 334.308074 1327.976130 C 455.600006 2106.000000 522.599976 2301.000000 665.000000 2301.000000" fill="none" marker-end="url(#mk-d2-7f44ae4d85cc452ca889a75c26371bde-3488378134)" mask="url(#d2-7f44ae4d85cc452ca889a75c26371bde)" stroke="#0D32B2" style="stroke-width:2;"></path></g><g class="KCYjMzQ7c2VhcmNoX2FwaS5ibTI1X2luZGV4JiMzNDsgLSZndDsgJiMzNDt0eXBpbmcuY2FzdCYjMzQ7KVswXQ=="><path class="connection stroke-B1" d="M 334.273518 1327.981209 C 455.600006 2206.800049 531.400024 2427.000000 709.000000 2427.000000" fill="none" marker-end="url(#mk-d2-7f44ae4d85cc452ca889a75c26371bde-3488378134)" mask="url(#d2-7f44ae4d85cc452ca889a75c26371bde)" stroke="#0D32B2" style="stroke-width:2;"></path></g><g class="KHNlYXJjaF9hcGkgLSZndDsgJiMzNDtzZWFyY2hfYXBpLmJtMjVfaW5kZXgmIzM0OylbMF0="><path class="connection stroke-B1" d="M 124.000000 1293.000000 C 162.000000 1293.000000 182.000000 1293.000000 218.000000 1293.000000" fill="none" marker-end="url(#mk-d2-7f44ae4d85cc452ca889a75c26371bde-3488378134)" mask="url(#d2-7f44ae4d85cc452ca889a75c26371bde)" stroke="#0D32B2" style="stroke-width:2;"></path></g><g class="KCYjMzQ7c2VhcmNoX2FwaS5ibTI1X2luZGV4JiMzNDsgLSZndDsgJiMzNDtzZWFyY2hfYXBpLmJtMjVfaW5kZXhfY29kZSYjMzQ7KVswXQ=="><path class="connection stroke-B1" d="M 333.247472 1327.984630 C 455.399994 2307.600098 518.799011 2553.000000 646.000000 2553.000000" fill="none" marker-end="url(#mk-d2-7f44ae4d85cc452ca889a75c26371bde-3488378134)" mask="url(#d2-7f44ae4d85cc452ca889a75c26371bde)" stroke="#0D32B2" style="stroke-width:2;"></path></g><g class="appendix-icon" transform="translate(420 1244)"><svg fill="none" height="32" viewBox="0 0 32 32" width="32">
<g clip-path="url(#clip0_3440_35088111-d2-7f44ae4d85cc452ca889a75c26371bde-EJZWKYLSMNUF6YLQNEXGE3JSGVPWS3TEMV4CE)">
<path d="M16 31.1109C24.3456 31.1109 31.1111 24.3454 31.1111 15.9998C31.1111 7.65415 24.3456 0.888672 16 0.888672C7.65436 0.888672 0.888885 7.65415 0.888885 15.9998C0.888885 24.3454 7.65436 31.1109 16 31.1109Z" fill="white" stroke="#DEE1EB"></path>
<path d="M14.3909 16.7965C14.7364 17.2584 15.1772 17.6406 15.6834 17.9171C16.1896 18.1938 16.7494 18.3582 17.3248 18.3993C17.9001 18.4405 18.4777 18.3575 19.0181 18.1559C19.5586 17.9543 20.0492 17.6389 20.4571 17.2309L22.8708 14.8173C23.6036 14.0586 24.0089 13.0425 23.9998 11.9877C23.9906 10.933 23.5676 9.92404 22.8217 9.17821C22.0759 8.43237 21.067 8.00931 20.0123 8.00015C18.9575 7.99098 17.9413 8.39644 17.1827 9.1292L15.7988 10.505" stroke="#2E3346" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></path>
<path d="M17.609 15.1874C17.2635 14.7255 16.8227 14.3433 16.3165 14.0667C15.8103 13.7902 15.2505 13.6257 14.6752 13.5845C14.0998 13.5433 13.5223 13.6263 12.9819 13.8279C12.4414 14.0295 11.9506 14.345 11.5428 14.753L9.1292 17.1666C8.39644 17.9252 7.99098 18.9414 8.00015 19.9962C8.00931 21.0509 8.43237 22.0598 9.17821 22.8056C9.92405 23.5515 10.933 23.9745 11.9877 23.9837C13.0425 23.9928 14.0586 23.5875 14.8173 22.8547L16.193 21.4788" stroke="#2E3346" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></path>
</g>
<defs>
<clipPath id="clip0_3440_35088111-d2-7f44ae4d85cc452ca889a75c26371bde-EJZWKYLSMNUF6YLQNEXGE3JSGVPWS3TEMV4CE">
<rect fill="white" height="32" width="32"></rect>
</clipPath>
</defs>
</svg>
</g><g class="appendix-icon" transform="translate(106 1244)"><svg fill="none" height="32" viewBox="0 0 32 32" width="32">
<g clip-path="url(#clip0_3440_35088111-d2-7f44ae4d85cc452ca889a75c26371bde-ONSWC4TDNBPWC4DJ)">
<path d="M16 31.1109C24.3456 31.1109 31.1111 24.3454 31.1111 15.9998C31.1111 7.65415 24.3456 0.888672 16 0.888672C7.65436 0.888672 0.888885 7.65415 0.888885 15.9998C0.888885 24.3454 7.65436 31.1109 16 31.1109Z" fill="white" stroke="#DEE1EB"></path>
<path d="M14.3909 16.7965C14.7364 17.2584 15.1772 17.6406 15.6834 17.9171C16.1896 18.1938 16.7494 18.3582 17.3248 18.3993C17.9001 18.4405 18.4777 18.3575 19.0181 18.1559C19.5586 17.9543 20.0492 17.6389 20.4571 17.2309L22.8708 14.8173C23.6036 14.0586 24.0089 13.0425 23.9998 11.9877C23.9906 10.933 23.5676 9.92404 22.8217 9.17821C22.0759 8.43237 21.067 8.00931 20.0123 8.00015C18.9575 7.99098 17.9413 8.39644 17.1827 9.1292L15.7988 10.505" stroke="#2E3346" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></path>
<path d="M17.609 15.1874C17.2635 14.7255 16.8227 14.3433 16.3165 14.0667C15.8103 13.7902 15.2505 13.6257 14.6752 13.5845C14.0998 13.5433 13.5223 13.6263 12.9819 13.8279C12.4414 14.0295 11.9506 14.345 11.5428 14.753L9.1292 17.1666C8.39644 17.9252 7.99098 18.9414 8.00015 19.9962C8.00931 21.0509 8.43237 22.0598 9.17821 22.8056C9.92405 23.5515 10.933 23.9745 11.9877 23.9837C13.0425 23.9928 14.0586 23.5875 14.8173 22.8547L16.193 21.4788" stroke="#2E3346" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></path>
</g>
<defs>
<clipPath id="clip0_3440_35088111-d2-7f44ae4d85cc452ca889a75c26371bde-ONSWC4TDNBPWC4DJ">
<rect fill="white" height="32" width="32"></rect>
</clipPath>
</defs>
</svg>
</g><g class="appendix-icon" transform="translate(885 2504)"><svg fill="none" height="32" viewBox="0 0 32 32" width="32">
<g clip-path="url(#clip0_3440_35088111-d2-7f44ae4d85cc452ca889a75c26371bde-EJZWKYLSMNUF6YLQNEXGE3JSGVPWS3TEMV4F6Y3PMRSSE)">
<path d="M16 31.1109C24.3456 31.1109 31.1111 24.3454 31.1111 15.9998C31.1111 7.65415 24.3456 0.888672 16 0.888672C7.65436 0.888672 0.888885 7.65415 0.888885 15.9998C0.888885 24.3454 7.65436 31.1109 16 31.1109Z" fill="white" stroke="#DEE1EB"></path>
<path d="M14.3909 16.7965C14.7364 17.2584 15.1772 17.6406 15.6834 17.9171C16.1896 18.1938 16.7494 18.3582 17.3248 18.3993C17.9001 18.4405 18.4777 18.3575 19.0181 18.1559C19.5586 17.9543 20.0492 17.6389 20.4571 17.2309L22.8708 14.8173C23.6036 14.0586 24.0089 13.0425 23.9998 11.9877C23.9906 10.933 23.5676 9.92404 22.8217 9.17821C22.0759 8.43237 21.067 8.00931 20.0123 8.00015C18.9575 7.99098 17.9413 8.39644 17.1827 9.1292L15.7988 10.505" stroke="#2E3346" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></path>
<path d="M17.609 15.1874C17.2635 14.7255 16.8227 14.3433 16.3165 14.0667C15.8103 13.7902 15.2505 13.6257 14.6752 13.5845C14.0998 13.5433 13.5223 13.6263 12.9819 13.8279C12.4414 14.0295 11.9506 14.345 11.5428 14.753L9.1292 17.1666C8.39644 17.9252 7.99098 18.9414 8.00015 19.9962C8.00931 21.0509 8.43237 22.0598 9.17821 22.8056C9.92405 23.5515 10.933 23.9745 11.9877 23.9837C13.0425 23.9928 14.0586 23.5875 14.8173 22.8547L16.193 21.4788" stroke="#2E3346" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></path>
</g>
<defs>
<clipPath id="clip0_3440_35088111-d2-7f44ae4d85cc452ca889a75c26371bde-EJZWKYLSMNUF6YLQNEXGE3JSGVPWS3TEMV4F6Y3PMRSSE">
<rect fill="white" height="32" width="32"></rect>
</clipPath>
</defs>
</svg>
</g><mask height="2788" id="d2-7f44ae4d85cc452ca889a75c26371bde" maskUnits="userSpaceOnUse" width="1217" x="-101" y="-101">
<rect fill="white" height="2788" width="1217" x="-101" y="-101"></rect>
</mask></svg></svg></div>
<aside class="md-source-file">
<span class="md-source-file__fact">
<span class="md-icon" title="Last update">
<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"></path></svg>
</span>
<span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date" title="November 6, 2025 12:29:01 UTC">November 6, 2025</span>
</span>
</aside>
</article>
</div>
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
</div>
<button class="md-top md-icon" data-md-component="top" hidden="" type="button">
<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"></path></svg>
  Back to top
</button>
</main>
<footer class="md-footer">
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
      Material for MkDocs
    </a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.sections", "navigation.top", "navigation.tracking", "navigation.footer", "content.action.edit", "content.action.view"], "search": "../../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
<script src="../../../assets/javascripts/bundle.f55a23d4.min.js"></script>
<script src="../../../assets/mkdocs_puml/puml.js"></script>
<script src="https://unpkg.com/@panzoom/panzoom@4.5.1/dist/panzoom.min.js"></script>
<script src="../../../assets/mkdocs_puml/interaction.js"></script>
<script type="module">import mermaid from "https://unpkg.com/mermaid@10.4.0/dist/mermaid.esm.min.mjs";
window.mermaidConfig = {default: {
    startOnLoad: false
}};</script><script>document$.subscribe(() => {
            const dark_scheme_name = "slate"
            
            window.scheme = document.body.getAttribute("data-md-color-scheme")
            const options = {
                attributeFilter: ['data-md-color-scheme'],
            };
            function color_scheme_callback(mutations) {
                for (let mutation of mutations) {
                    if (mutation.attributeName === "data-md-color-scheme") {
                        scheme = document.body.getAttribute("data-md-color-scheme")
                        var iframe_list = document.getElementsByClassName("redoc-iframe")
                        for(var i = 0; i < iframe_list.length; i++) {
                            var ele = iframe_list.item(i);
                            if (ele) {
                                if (scheme === dark_scheme_name) {
                                    ele.contentWindow.enable_dark_mode();
                                } else {
                                    ele.contentWindow.disable_dark_mode();
                                }
                            }
                        }
                    }
                }
            }
            observer = new MutationObserver(color_scheme_callback);
            observer.observe(document.body, options);
            })</script>
<script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(()=>{ lightbox.reload(); });
</script></body></html>