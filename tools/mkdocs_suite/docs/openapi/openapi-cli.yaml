openapi: 3.1.0
info:
  title: KgFoundry CLI
  version: 0.0.0-dev
  x-kgf-interface:
    id: orchestration-cli
    module: orchestration
    owner: '@orchestration'
    stability: beta
    binary: kgf
    protocol: openapi-cli
tags:
- name: orchestration
  x-displayName: Orchestration
  description: Commands that orchestrate indexing, ingestion, and flow execution.
- name: api
  description: Commands for api.
- name: e2e
  description: Commands for e2e.
- name: index_bm25
  description: Commands for index_bm25.
- name: index_faiss
  description: Commands for index_faiss.
paths:
  /cli/index-bm25:
    post:
      operationId: cli.index_bm25
      tags:
      - orchestration
      - index_bm25
      summary: Build BM25 index from JSON/Parquet chunks.
      description: 'Invoke the Lucene-backed BM25 indexing flow. Requires chunk metadata
        and optional

        backend selection. Emits structured metrics and Problem Details on failure.

        '
      x-cli:
        bin: kgf
        command: index-bm25
        examples:
        - kgf index-bm25 <chunks_parquet> --backend <backend> --index-dir <index_dir>
        exitCodes:
        - code: 0
          meaning: success
        x-interface: orchestration-cli
        x-handler: orchestration.cli:index_bm25
        x-codeSamples:
        - lang: bash
          source: kgf index-bm25 data/chunks.parquet --backend lucene --index-dir
            ./_indices/bm25
        x-problemDetails:
        - schema/examples/problem_details/tool-execution-error.json
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                chunks_parquet:
                  type: string
                  description: Path to Parquet/JSONL with chunks
                backend:
                  type: string
                  description: lucene|pure
                index_dir:
                  type: string
                  description: Output index directory
              required:
              - chunks_parquet
      responses:
        '200':
          description: CLI result
          content:
            application/json:
              schema:
                type: object
                properties:
                  stdout:
                    type: string
                  stderr:
                    type: string
                  exitCode:
                    type: integer
                  artifacts:
                    type: array
                    items:
                      type: string
                required:
                - exitCode
      x-problemDetails:
      - schema/examples/problem_details/tool-execution-error.json
      - schema/examples/problem_details/tool-execution-error.json
      x-kgf-interface:
        id: orchestration-cli
        owner: '@orchestration'
        module: orchestration
        stability: beta
        binary: kgf
  /cli/index-faiss:
    post:
      operationId: cli.index_faiss
      tags:
      - orchestration
      - index_faiss
      summary: Build FAISS index from dense vectors.
      description: 'Construct a FAISS ANN index from dense vectors. Supports CPU/GPU
        factories and exposes

        detailed diagnostics. Rebuilds existing indices idempotently.

        '
      x-cli:
        bin: kgf
        command: index-faiss
        examples:
        - kgf index-faiss <dense_vectors> --index-path <index_path> --factory <factory>
          --metric <metric>
        exitCodes:
        - code: 0
          meaning: success
        x-interface: orchestration-cli
        x-handler: orchestration.cli:index_faiss
        x-env:
        - KGF_FAISS_RESOURCES
        x-codeSamples:
        - lang: bash
          source: kgf index-faiss vectors.json --factory 'OPQ64,IVF8192,PQ64' --metric
            ip
        x-problemDetails:
        - schema/examples/problem_details/tool-execution-error.json
        - schema/examples/problem_details/faiss-index-build-timeout.json
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                dense_vectors:
                  type: string
                  description: Path to dense vectors JSON (skeleton)
                index_path:
                  type: string
                  description: Output index (CPU .idx)
                factory:
                  type: string
                  description: FAISS factory string
                metric:
                  type: string
                  description: 'Metric: ''ip'' or ''l2'''
              required:
              - dense_vectors
      responses:
        '200':
          description: CLI result
          content:
            application/json:
              schema:
                type: object
                properties:
                  stdout:
                    type: string
                  stderr:
                    type: string
                  exitCode:
                    type: integer
                  artifacts:
                    type: array
                    items:
                      type: string
                required:
                - exitCode
      x-problemDetails:
      - schema/examples/problem_details/tool-execution-error.json
      - schema/examples/problem_details/faiss-index-build-timeout.json
      - schema/examples/problem_details/tool-execution-error.json
      x-kgf-interface:
        id: orchestration-cli
        owner: '@orchestration'
        module: orchestration
        stability: beta
        binary: kgf
  /cli/api:
    post:
      operationId: cli.api
      tags:
      - orchestration
      - api
      summary: Launch FastAPI search service.
      description: 'Start the FastAPI-based search service defined in `search_api.app`.
        Useful for local

        validation and integration testing. Requires uvicorn to be available.

        '
      x-cli:
        bin: kgf
        command: api
        examples:
        - kgf api --port <port>
        exitCodes:
        - code: 0
          meaning: success
        x-interface: orchestration-cli
        x-handler: orchestration.cli:api
        x-env:
        - KGF_SEARCH_CONFIG
        x-codeSamples:
        - lang: bash
          source: kgf api --port 8080
        x-problemDetails:
        - schema/examples/problem_details/public-api-invalid-config.json
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                port:
                  type: integer
      responses:
        '200':
          description: CLI result
          content:
            application/json:
              schema:
                type: object
                properties:
                  stdout:
                    type: string
                  stderr:
                    type: string
                  exitCode:
                    type: integer
                  artifacts:
                    type: array
                    items:
                      type: string
                required:
                - exitCode
      x-problemDetails:
      - schema/examples/problem_details/public-api-invalid-config.json
      - schema/examples/problem_details/tool-execution-error.json
      x-kgf-interface:
        id: orchestration-cli
        owner: '@orchestration'
        module: orchestration
        stability: beta
        binary: kgf
  /cli/e2e:
    post:
      operationId: cli.e2e
      tags:
      - orchestration
      - e2e
      summary: Execute end-to-end orchestration demo.
      description: 'Run the bundled Prefect flow that exercises the full ingestion
        and search pipeline. Serves

        as a smoke test and example workflow.

        '
      x-cli:
        bin: kgf
        command: e2e
        examples:
        - kgf e2e
        exitCodes:
        - code: 0
          meaning: success
        x-interface: orchestration-cli
        x-handler: orchestration.cli:e2e
        x-env:
        - KGF_PROFILE
        x-codeSamples:
        - lang: bash
          source: kgf e2e
        x-problemDetails:
        - schema/examples/problem_details/public-api-invalid-config.json
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              properties: {}
      responses:
        '200':
          description: CLI result
          content:
            application/json:
              schema:
                type: object
                properties:
                  stdout:
                    type: string
                  stderr:
                    type: string
                  exitCode:
                    type: integer
                  artifacts:
                    type: array
                    items:
                      type: string
                required:
                - exitCode
      x-problemDetails:
      - schema/examples/problem_details/public-api-invalid-config.json
      - schema/examples/problem_details/tool-execution-error.json
      x-kgf-interface:
        id: orchestration-cli
        owner: '@orchestration'
        module: orchestration
        stability: beta
        binary: kgf
x-tagGroups:
- name: CLI Suites
  tags:
  - orchestration
