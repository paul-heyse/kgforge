interfaces:
  orchestration-cli:
    type: cli
    module: orchestration
    owner: "@orchestration"
    stability: beta
    entrypoint: orchestration.cli:app
    binary: kgf
    protocol: openapi-cli
    spec: openapi/openapi-cli.yaml
    augment: openapi/_augment_cli.yaml
    tags:
      - orchestration
    description: |
      Typer-powered orchestration command suite covering indexing flows, API bootstrapping,
      and end-to-end demonstrations. Each command maps to a generated OpenAPI operation
      consumed by the MkDocs suite.
    problem_details:
      - schema/examples/problem_details/tool-execution-error.json
    operations:
      index-bm25:
        operation_id: cli.index_bm25
        summary: Build BM25 index from JSON/Parquet chunks.
        description: |
          Invoke the Lucene-backed BM25 indexing flow. Requires chunk metadata and optional
          backend selection. Emits structured metrics and Problem Details on failure.
        handler: orchestration.cli:index_bm25
        tags:
          - orchestration
          - index_bm25
        env: []
        code_samples:
          - lang: bash
            source: "kgf index-bm25 data/chunks.parquet --backend lucene --index-dir ./_indices/bm25"
        problem_details:
          - schema/examples/problem_details/tool-execution-error.json
      index-faiss:
        operation_id: cli.index_faiss
        summary: Build FAISS index from dense vectors.
        description: |
          Construct a FAISS ANN index from dense vectors. Supports CPU/GPU factories and exposes
          detailed diagnostics. Rebuilds existing indices idempotently.
        handler: orchestration.cli:index_faiss
        tags:
          - orchestration
          - index_faiss
        env:
          - KGF_FAISS_RESOURCES
        code_samples:
          - lang: bash
            source: "kgf index-faiss artifacts/vectors.json --factory 'OPQ64,IVF8192,PQ64' --metric ip"
        problem_details:
          - schema/examples/problem_details/tool-execution-error.json
          - schema/examples/problem_details/faiss-index-build-timeout.json
      api:
        operation_id: cli.api
        summary: Launch FastAPI search service.
        description: |
          Start the FastAPI-based search service defined in `search_api.app`. Useful for local
          validation and integration testing. Requires uvicorn to be available.
        handler: orchestration.cli:api
        tags:
          - orchestration
          - api
        env:
          - KGF_SEARCH_CONFIG
        code_samples:
          - lang: bash
            source: "kgf api --port 8080"
        problem_details:
          - schema/examples/problem_details/public-api-invalid-config.json
      e2e:
        operation_id: cli.e2e
        summary: Execute end-to-end orchestration demo.
        description: |
          Run the bundled Prefect flow that exercises the full ingestion and search pipeline. Serves
          as a smoke test and example workflow.
        handler: orchestration.cli:e2e
        tags:
          - orchestration
          - e2e
        env:
          - KGF_PROFILE
        code_samples:
          - lang: bash
            source: "kgf e2e"
        problem_details:
          - schema/examples/problem_details/public-api-invalid-config.json
  download-cli:
    type: cli
    module: download
    owner: "@data-platform"
    stability: experimental
    entrypoint: download.cli:app
    binary: kgf
    protocol: openapi-cli
    spec: openapi/openapi-cli.yaml
    augment: openapi/_augment_cli.yaml
    tags:
      - download
    description: |
      Downloader command suite that sources external corpora (currently OpenAlex) using the shared
      CLI tooling contracts. Emits structured envelopes and metadata so downstream tooling (OpenAPI,
      diagrams, documentation) remains in sync without bespoke glue.
    problem_details:
      - schema/examples/problem_details/tool-execution-error.json
    operations:
      harvest:
        operation_id: cli.download.harvest
        summary: Harvest OpenAlex works for downstream ingestion.
        description: |
          Execute a dry-run compatible harvest of OpenAlex data based on topic and year filters. The
          command routes metadata through the shared CLI tooling facade so downstream consumers can
          rely on typed contracts without custom parsing.
        handler: download.cli:harvest
        tags:
          - download
        env: []
        code_samples:
          - lang: bash
            source: "kgf download harvest 'foundation models' --years '>=2020' --max-works 5000"
        problem_details:
          - schema/examples/problem_details/tool-execution-error.json
  codeintel-indexer:
    type: cli
    module: codeintel
    owner: "@code-intel"
    stability: experimental
    entrypoint: codeintel.cli:app
    binary: kgf-codeintel
    protocol: openapi-cli
    spec: openapi/openapi-cli.yaml
    augment: openapi/_augment_cli.yaml
    tags:
      - codeintel
    description: |
      Tree-sitter powered developer tooling that exposes code-intelligence queries and symbol
      extraction through the shared CLI contracts. The interface integrates with the OpenAPI
      generator, MkDocs diagrams, and documentation lifecycles to keep metadata consistent.
    problem_details:
      - schema/examples/problem_details/tool-execution-error.json
    operations:
      query:
        operation_id: codeintel.indexer.query
        summary: Execute a Tree-sitter query against a source file.
        description: |
          Compile and run a Tree-sitter S-expression query against a source file, returning capture
          metadata as structured JSON. Ideal for debugging grammar updates or building lightweight
          developer tooling.
        handler: codeintel.cli:query
        tags:
          - codeintel
        env: []
        code_samples:
          - lang: bash
            source: "uv run python -m codeintel.cli query src/example.py --language python --query queries/highlights.scm"
        problem_details:
          - schema/examples/problem_details/tool-execution-error.json
  navmap-cli:
    type: cli
    module: tools.navmap
    owner: "@docs"
    stability: experimental
    entrypoint: tools.navmap.build_navmap:main
    binary: tools-navmap
    protocol: openapi-cli
    spec: openapi/openapi-cli.yaml
    augment: openapi/_augment_cli.yaml
    tags:
      - navmap
    description: |
      Documentation tooling CLI that generates the canonical navmap JSON artefact. The command
      scans Python modules, resolves ``__navmap__`` declarations, and emits structured envelopes for
      downstream automation, diagrams, and observability pipelines.
    problem_details:
      - schema/examples/problem_details/tool-execution-error.json
    operations:
      build:
        operation_id: navmap.build
        summary: Build the documentation navmap JSON artefact.
        description: |
          Scan repository modules, merge inline navmap metadata, and emit the canonical navmap JSON
          output along with drift reports when changes are detected.
        handler: tools.navmap.build_navmap:main
        tags:
          - navmap
        env: []
        code_samples:
          - lang: bash
            source: "uv run python -m tools.navmap.build_navmap --write site/_build/navmap/navmap.json"
        problem_details:
          - schema/examples/problem_details/tool-execution-error.json
      check:
        operation_id: navmap.check
        summary: Validate navmap declarations and inline metadata.
        description: |
          Execute the navmap validation suite, ensuring inline anchors, section metadata, and
          generated artefacts stay in sync. Emits structured envelopes and Problem Details when
          discrepancies are detected.
        handler: tools.navmap.check_navmap:main
        tags:
          - navmap
        env: []
        code_samples:
          - lang: bash
            source: "uv run python -m tools.navmap.check_navmap"
        problem_details:
          - schema/examples/problem_details/tool-execution-error.json
  docstring-builder-cli:
    type: cli
    module: tools.docstring_builder
    owner: "@docs"
    stability: beta
    entrypoint: tools.docstring_builder.cli:main
    binary: docstring-builder
    protocol: openapi-cli
    spec: openapi/openapi-cli.yaml
    augment: openapi/_augment_cli.yaml
    tags:
      - docstrings
    description: |
      Command suite powering docstring synchronization, validation, policy enforcement, and
      diagnostics. The CLI integrates with shared tooling metadata so documentation helpers,
      diagrams, and automation emit consistent Problem Details and logging envelopes.
    problem_details:
      - schema/examples/problem_details/tool-execution-error.json
    operations:
      generate:
        operation_id: docstrings.generate
        summary: Regenerate managed docstrings and DocFacts artifacts.
        description: |
          Execute the full docstring builder pipeline, updating managed docstrings in-place and
          refreshing DocFacts manifests. Intended for presubmit workflows and documentation rebuilds.
        handler: tools.docstring_builder.cli:_command_generate
        tags:
          - docstrings
          - docstrings-update
        env: []
        code_samples:
          - lang: bash
            source: "uv run python -m tools.docstring_builder.cli generate"
        problem_details:
          - schema/examples/problem_details/tool-execution-error.json
      fix:
        operation_id: docstrings.fix
        summary: Apply docstring updates while bypassing cache entries.
        description: |
          Force-regenerate docstrings, ignoring cache hints so that all managed symbols are
          re-rendered. Useful after plugin or policy changes when stale cache entries must be
          invalidated.
        handler: tools.docstring_builder.cli:_command_fix
        tags:
          - docstrings
          - docstrings-update
        env: []
        code_samples:
          - lang: bash
            source: "uv run python -m tools.docstring_builder.cli fix"
        problem_details:
          - schema/examples/problem_details/tool-execution-error.json
      fmt:
        operation_id: docstrings.fmt
        summary: Normalize docstring sections without regenerating content.
        description: |
          Tidy managed docstrings by rewriting section headers and spacing without triggering the
          full regeneration pipeline. Leaves content intact while ensuring formatting consistency.
        handler: tools.docstring_builder.cli:_command_fmt
        tags:
          - docstrings
          - docstrings-update
        env: []
        code_samples:
          - lang: bash
            source: "uv run python -m tools.docstring_builder.cli fmt"
        problem_details:
          - schema/examples/problem_details/tool-execution-error.json
      update:
        operation_id: docstrings.update
        summary: Legacy alias for the generate pipeline.
        description: |
          Backwards compatible alias that invokes the same synchronization flow as the `generate`
          subcommand. Maintained for existing automation until callers migrate to the new verbs.
        handler: tools.docstring_builder.cli:_command_update
        tags:
          - docstrings
          - docstrings-update
        env: []
        code_samples:
          - lang: bash
            source: "uv run python -m tools.docstring_builder.cli update"
        problem_details:
          - schema/examples/problem_details/tool-execution-error.json
      check:
        operation_id: docstrings.check
        summary: Validate docstrings without writing updates.
        description: |
          Inspect managed docstrings for drift, policy violations, or missing sections. Emits a
          structured CLI envelope and non-zero exit status when remediation is required.
        handler: tools.docstring_builder.cli:_command_check
        tags:
          - docstrings
          - docstrings-validate
        env: []
        code_samples:
          - lang: bash
            source: "uv run python -m tools.docstring_builder.cli check"
        problem_details:
          - schema/examples/problem_details/tool-execution-error.json
      diff:
        operation_id: docstrings.diff
        summary: Show docstring drift previews without mutating files.
        description: |
          Produce unified diffs for managed docstrings highlighting pending changes. Useful when
          reviewing edits prior to accepting updates or triaging regressions.
        handler: tools.docstring_builder.cli:_command_diff
        tags:
          - docstrings
          - docstrings-validate
        env: []
        code_samples:
          - lang: bash
            source: "uv run python -m tools.docstring_builder.cli diff"
        problem_details:
          - schema/examples/problem_details/tool-execution-error.json
      lint:
        operation_id: docstrings.lint
        summary: Alias for check with optional DocFacts skip.
        description: |
          Run the validation workflow with optional DocFacts reconciliation disabled for speed.
          Mirrors the `check` behavior while supporting quick linting loops.
        handler: tools.docstring_builder.cli:_command_lint
        tags:
          - docstrings
          - docstrings-validate
        env: []
        code_samples:
          - lang: bash
            source: "uv run python -m tools.docstring_builder.cli lint --no-docfacts"
        problem_details:
          - schema/examples/problem_details/tool-execution-error.json
      measure:
        operation_id: docstrings.measure
        summary: Execute validation and emit observability metrics.
        description: |
          Run the validation pipeline and record observability counters, including processed file
          counts and policy outcomes. Designed for CI environments that publish metrics.
        handler: tools.docstring_builder.cli:_command_measure
        tags:
          - docstrings
          - docstrings-observability
        env: []
        code_samples:
          - lang: bash
            source: "uv run python -m tools.docstring_builder.cli measure"
        problem_details:
          - schema/examples/problem_details/tool-execution-error.json
      list:
        operation_id: docstrings.list
        summary: List managed docstring targets detected by the pipeline.
        description: |
          Enumerate symbols managed by the docstring builder, including modules and plugin coverage.
          Helpful when auditing what content is under automation.
        handler: tools.docstring_builder.cli:_command_list
        tags:
          - docstrings
          - docstrings-observability
        env: []
        code_samples:
          - lang: bash
            source: "uv run python -m tools.docstring_builder.cli list"
        problem_details:
          - schema/examples/problem_details/tool-execution-error.json
      harvest:
        operation_id: docstrings.harvest
        summary: Gather docstring metadata without writing changes.
        description: |
          Harvest symbol metadata and DocFacts inputs without applying edits. Supports workflows
          that need intermediate data for analysis or experiment pipelines.
        handler: tools.docstring_builder.cli:_command_harvest
        tags:
          - docstrings
          - docstrings-utilities
        env: []
        code_samples:
          - lang: bash
            source: "uv run python -m tools.docstring_builder.cli harvest"
        problem_details:
          - schema/examples/problem_details/tool-execution-error.json
      schema:
        operation_id: docstrings.schema
        summary: Export the docstring IR schema to disk.
        description: |
          Generate the JSON schema describing the docstring intermediate representation. Intended
          for tooling integration tests and documentation.
        handler: tools.docstring_builder.cli:_command_schema
        tags:
          - docstrings
          - docstrings-utilities
        env: []
        code_samples:
          - lang: bash
            source: "uv run python -m tools.docstring_builder.cli schema --output docs/_build/docstring-schema.json"
        problem_details:
          - schema/examples/problem_details/tool-execution-error.json
      clear-cache:
        operation_id: docstrings.clear_cache
        summary: Remove cached docstring builder artifacts.
        description: |
          Delete the docstring builder cache directory, forcing subsequent runs to recompute state
          from scratch. Useful after structural changes to plugins or configuration.
        handler: tools.docstring_builder.cli:_command_clear_cache
        tags:
          - docstrings
          - docstrings-utilities
        env: []
        code_samples:
          - lang: bash
            source: "uv run python -m tools.docstring_builder.cli clear-cache"
        problem_details:
          - schema/examples/problem_details/tool-execution-error.json
      doctor:
        operation_id: docstrings.doctor
        summary: Diagnose configuration, dependencies, and optional stubs.
        description: |
          Run health checks covering Python version, configuration files, optional dependencies,
          and stub drift. Surfaces actionable guidance with structured Problem Details on failure.
        handler: tools.docstring_builder.cli:_command_doctor
        tags:
          - docstrings
          - docstrings-diagnostics
        env: []
        code_samples:
          - lang: bash
            source: "uv run python -m tools.docstring_builder.cli doctor --stubs"
        problem_details:
          - schema/examples/problem_details/tool-execution-error.json
  docs-symbol-index-cli:
    type: cli
    module: docs.toolchain
    owner: "@docs"
    stability: experimental
    entrypoint: docs.toolchain.build_symbol_index:build_symbol_index
    binary: docs-build-symbol-index
    protocol: openapi-cli
    spec: openapi/openapi-cli.yaml
    augment: openapi/_augment_cli.yaml
    tags:
      - docs
      - docs-symbol-index
    description: |
      Documentation tooling CLI that builds the symbol index, by-file, and by-module artifacts used
      throughout the documentation pipeline. Emits standardized CLI envelopes and Problem Details
      for CI gating and observability.
    problem_details:
      - schema/examples/problem_details/tool-execution-error.json
    operations:
      build:
        operation_id: docs.symbol_index.build
        summary: Build documentation symbol index artifacts.
        description: |
          Generate the symbol index, file-level, and module-level lookup tables by traversing all
          configured packages. Each artifact is validated against its canonical JSON Schema prior
          to being written to disk.
        handler: docs.toolchain.build_symbol_index:build_symbol_index
        tags:
          - docs
          - docs-symbol-index
        env: []
        code_samples:
          - lang: bash
            source: "uv run python -m docs.toolchain.build_symbol_index"
        problem_details:
          - schema/examples/problem_details/tool-execution-error.json
  docs-validate-cli:
    type: cli
    module: docs.toolchain
    owner: "@docs"
    stability: experimental
    entrypoint: docs.toolchain.validate_artifacts:validate_artifacts
    binary: docs-validate-artifacts
    protocol: openapi-cli
    spec: openapi/openapi-cli.yaml
    augment: openapi/_augment_cli.yaml
    tags:
      - docs
      - docs-validation
    description: |
      Documentation tooling CLI that validates generated artifacts (symbol index, delta summaries,
      and reverse lookups) against their canonical JSON Schemas. Emits standardized CLI envelopes
      and Problem Details for CI gating and observability pipelines.
    problem_details:
      - schema/examples/problem_details/tool-execution-error.json
    operations:
      validate:
        operation_id: docs.validate_artifacts
        summary: Validate documentation artifacts against canonical schemas.
        description: |
          Execute the documentation validation suite to ensure generated artifacts remain schema
          compliant before publishing. Intended for automated CI checks and local verification.
        handler: docs.toolchain.validate_artifacts:validate_artifacts
        tags:
          - docs
          - docs-validation
        env: []
        code_samples:
          - lang: bash
            source: "uv run python -m docs._scripts.validate_artifacts --docs-build-dir docs/_build"
        problem_details:
          - schema/examples/problem_details/tool-execution-error.json
      build_graphs:
        operation_id: docs.build_graphs
        summary: Build documentation dependency graphs.
        description: |
          Generate per-package and subsystem dependency graphs (pydeps/pyreverse) with caching and
          policy enforcement. Results feed documentation artifacts and architectural dashboards.
        handler: tools.docs.build_graphs:main
        tags:
          - docs
        env: []
        code_samples:
          - lang: bash
            source: "uv run python -m tools.docs.build_graphs --format svg"
        problem_details:
          - schema/examples/problem_details/tool-execution-error.json
  search-http:
    type: http
    module: search_api
    owner: "@search-api"
    stability: experimental
    entrypoint: search_api.app:create_app
    protocol: openapi
    spec: docs/api/openapi.yaml
    problem_details:
      - schema/examples/problem_details/search-missing-index.json
      - schema/examples/problem_details/search-gpu-unavailable.json
    tags:
      - search
      - http
      - public
    description: |
      FastAPI service exposing search endpoints, aggregation helpers, and Problem Details responses.

