# Topology B â€” Layer 4 pass-through so QUIC/TLS terminate inside Hypercorn.
# Include this file from /etc/nginx/nginx.conf inside the "stream" context.

stream {
    error_log /var/log/nginx/codeintel_stream_error.log warn;

    upstream codeintel_hypercorn_udp {
        server 127.0.0.1:8443;
    }

    server {
        listen 443 udp reuseport;
        proxy_timeout 3600s;
        proxy_pass codeintel_hypercorn_udp;
        # Optional health probe can be enabled with: check interval=5000 rise=2 fall=2 timeout=2000;
    }

    upstream codeintel_hypercorn_tls {
        server 127.0.0.1:8443;
    }

    server {
        listen 443;
        proxy_timeout 3600s;
        proxy_pass codeintel_hypercorn_tls;
        proxy_buffer_size 16k;
    }
}
