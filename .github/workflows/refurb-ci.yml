name: refurb-modernize

on:
  pull_request:
  push:
    branches: [ main ]

jobs:
  refurb:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: "3.13"
      - name: Install refurb
        run: pip install "refurb==2.2.0"
      - name: Run refurb (fail on suggestions)
        run: |
          set -e
          refurb src tools tests > refurb_report.txt || true
          if [ -s refurb_report.txt ]; then
            echo "::warning title=Refurb suggestions found::See refurb_report.txt in artifacts."
            exit 1
          fi
      - name: Upload refurb report
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: refurb-report
          path: refurb_report.txt

