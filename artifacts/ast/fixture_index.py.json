Module(body=[Expr(value=Constant(value='Overview of fixture index.\n\nThis module bundles fixture index logic for the kgfoundry stack. It groups related helpers so\ndownstream packages can import a single cohesive namespace. Refer to the functions and classes below\nfor implementation specifics.\n', lineno=1, col_offset=0, end_lineno=6, end_col_offset=3), lineno=1, col_offset=0, end_lineno=6, end_col_offset=3), ImportFrom(module='__future__', names=[alias(name='annotations', lineno=10, col_offset=23, end_lineno=10, end_col_offset=34)], level=0, lineno=10, col_offset=0, end_lineno=10, end_col_offset=34), Import(names=[alias(name='math', lineno=12, col_offset=7, end_lineno=12, end_col_offset=11)], lineno=12, col_offset=0, end_lineno=12, end_col_offset=11), Import(names=[alias(name='re', lineno=13, col_offset=7, end_lineno=13, end_col_offset=9)], lineno=13, col_offset=0, end_lineno=13, end_col_offset=9), ImportFrom(module='dataclasses', names=[alias(name='dataclass', lineno=14, col_offset=24, end_lineno=14, end_col_offset=33)], level=0, lineno=14, col_offset=0, end_lineno=14, end_col_offset=33), ImportFrom(module='pathlib', names=[alias(name='Path', lineno=15, col_offset=20, end_lineno=15, end_col_offset=24)], level=0, lineno=15, col_offset=0, end_lineno=15, end_col_offset=24), ImportFrom(module='typing', names=[alias(name='TYPE_CHECKING', lineno=16, col_offset=19, end_lineno=16, end_col_offset=32)], level=0, lineno=16, col_offset=0, end_lineno=16, end_col_offset=32), Import(names=[alias(name='duckdb', lineno=18, col_offset=7, end_lineno=18, end_col_offset=13)], lineno=18, col_offset=0, end_lineno=18, end_col_offset=13), ImportFrom(module='kgfoundry_common.navmap_loader', names=[alias(name='load_nav_metadata', lineno=20, col_offset=43, end_lineno=20, end_col_offset=60)], level=0, lineno=20, col_offset=0, end_lineno=20, end_col_offset=60), ImportFrom(module='registry.duckdb_helpers', names=[alias(name='fetch_all', lineno=21, col_offset=36, end_lineno=21, end_col_offset=45), alias(name='fetch_one', lineno=21, col_offset=47, end_lineno=21, end_col_offset=56)], level=0, lineno=21, col_offset=0, end_lineno=21, end_col_offset=56), If(test=Name(id='TYPE_CHECKING', ctx=Load(), lineno=23, col_offset=3, end_lineno=23, end_col_offset=16), body=[ImportFrom(module='collections.abc', names=[alias(name='Iterator', lineno=24, col_offset=32, end_lineno=24, end_col_offset=40), alias(name='Sequence', lineno=24, col_offset=42, end_lineno=24, end_col_offset=50)], level=0, lineno=24, col_offset=4, end_lineno=24, end_col_offset=50)], lineno=23, col_offset=0, end_lineno=24, end_col_offset=50), Assign(targets=[Name(id='__all__', ctx=Store(), lineno=27, col_offset=0, end_lineno=27, end_col_offset=7)], value=List(elts=[Constant(value='FixtureDoc', lineno=28, col_offset=4, end_lineno=28, end_col_offset=16), Constant(value='FixtureIndex', lineno=29, col_offset=4, end_lineno=29, end_col_offset=18), Constant(value='tokenize', lineno=30, col_offset=4, end_lineno=30, end_col_offset=14)], ctx=Load(), lineno=27, col_offset=10, end_lineno=31, end_col_offset=1), lineno=27, col_offset=0, end_lineno=31, end_col_offset=1), Assign(targets=[Name(id='__navmap__', ctx=Store(), lineno=32, col_offset=0, end_lineno=32, end_col_offset=10)], value=Call(func=Name(id='load_nav_metadata', ctx=Load(), lineno=32, col_offset=13, end_lineno=32, end_col_offset=30), args=[Name(id='__name__', ctx=Load(), lineno=32, col_offset=31, end_lineno=32, end_col_offset=39), Call(func=Name(id='tuple', ctx=Load(), lineno=32, col_offset=41, end_lineno=32, end_col_offset=46), args=[Name(id='__all__', ctx=Load(), lineno=32, col_offset=47, end_lineno=32, end_col_offset=54)], lineno=32, col_offset=41, end_lineno=32, end_col_offset=55)], lineno=32, col_offset=13, end_lineno=32, end_col_offset=56), lineno=32, col_offset=0, end_lineno=32, end_col_offset=56), Assign(targets=[Name(id='TOKEN_RE', ctx=Store(), lineno=35, col_offset=0, end_lineno=35, end_col_offset=8)], value=Call(func=Attribute(value=Name(id='re', ctx=Load(), lineno=35, col_offset=11, end_lineno=35, end_col_offset=13), attr='compile', ctx=Load(), lineno=35, col_offset=11, end_lineno=35, end_col_offset=21), args=[Constant(value='[A-Za-z0-9]+', lineno=35, col_offset=22, end_lineno=35, end_col_offset=37)], lineno=35, col_offset=11, end_lineno=35, end_col_offset=38), lineno=35, col_offset=0, end_lineno=35, end_col_offset=38), FunctionDef(name='_as_str', args=arguments(args=[arg(arg='value', annotation=Name(id='object', ctx=Load(), lineno=38, col_offset=19, end_lineno=38, end_col_offset=25), lineno=38, col_offset=12, end_lineno=38, end_col_offset=25)]), body=[If(test=Call(func=Name(id='isinstance', ctx=Load(), lineno=39, col_offset=7, end_lineno=39, end_col_offset=17), args=[Name(id='value', ctx=Load(), lineno=39, col_offset=18, end_lineno=39, end_col_offset=23), Name(id='str', ctx=Load(), lineno=39, col_offset=25, end_lineno=39, end_col_offset=28)], lineno=39, col_offset=7, end_lineno=39, end_col_offset=29), body=[Return(value=Name(id='value', ctx=Load(), lineno=40, col_offset=15, end_lineno=40, end_col_offset=20), lineno=40, col_offset=8, end_lineno=40, end_col_offset=20)], lineno=39, col_offset=4, end_lineno=40, end_col_offset=20), If(test=Compare(left=Name(id='value', ctx=Load(), lineno=41, col_offset=7, end_lineno=41, end_col_offset=12), ops=[Is()], comparators=[Constant(value=None, lineno=41, col_offset=16, end_lineno=41, end_col_offset=20)], lineno=41, col_offset=7, end_lineno=41, end_col_offset=20), body=[Return(value=Constant(value='', lineno=42, col_offset=15, end_lineno=42, end_col_offset=17), lineno=42, col_offset=8, end_lineno=42, end_col_offset=17)], lineno=41, col_offset=4, end_lineno=42, end_col_offset=17), Return(value=Call(func=Name(id='str', ctx=Load(), lineno=43, col_offset=11, end_lineno=43, end_col_offset=14), args=[Name(id='value', ctx=Load(), lineno=43, col_offset=15, end_lineno=43, end_col_offset=20)], lineno=43, col_offset=11, end_lineno=43, end_col_offset=21), lineno=43, col_offset=4, end_lineno=43, end_col_offset=21)], returns=Name(id='str', ctx=Load(), lineno=38, col_offset=30, end_lineno=38, end_col_offset=33), lineno=38, col_offset=0, end_lineno=43, end_col_offset=21), FunctionDef(name='tokenize', args=arguments(args=[arg(arg='text', annotation=Name(id='str', ctx=Load(), lineno=47, col_offset=19, end_lineno=47, end_col_offset=22), lineno=47, col_offset=13, end_lineno=47, end_col_offset=22)]), body=[Expr(value=Constant(value='Tokenize text into lowercase alphanumeric tokens.\n\n    Extracts alphanumeric sequences from the input text and converts them\n    to lowercase. Uses a regex pattern to match alphanumeric characters.\n\n    Parameters\n    ----------\n    text : str\n        Input text to tokenize. Empty strings are handled gracefully.\n\n    Returns\n    -------\n    list[str]\n        List of lowercase alphanumeric tokens extracted from the text.\n    ', lineno=48, col_offset=4, end_lineno=62, end_col_offset=7), lineno=48, col_offset=4, end_lineno=62, end_col_offset=7), AnnAssign(target=Name(id='matches', ctx=Store(), lineno=64, col_offset=4, end_lineno=64, end_col_offset=11), annotation=Subscript(value=Name(id='list', ctx=Load(), lineno=64, col_offset=13, end_lineno=64, end_col_offset=17), slice=Name(id='str', ctx=Load(), lineno=64, col_offset=18, end_lineno=64, end_col_offset=21), ctx=Load(), lineno=64, col_offset=13, end_lineno=64, end_col_offset=22), value=Call(func=Attribute(value=Name(id='TOKEN_RE', ctx=Load(), lineno=64, col_offset=25, end_lineno=64, end_col_offset=33), attr='findall', ctx=Load(), lineno=64, col_offset=25, end_lineno=64, end_col_offset=41), args=[BoolOp(op=Or(), values=[Name(id='text', ctx=Load(), lineno=64, col_offset=42, end_lineno=64, end_col_offset=46), Constant(value='', lineno=64, col_offset=50, end_lineno=64, end_col_offset=52)], lineno=64, col_offset=42, end_lineno=64, end_col_offset=52)], lineno=64, col_offset=25, end_lineno=64, end_col_offset=53), simple=1, lineno=64, col_offset=4, end_lineno=64, end_col_offset=53), Return(value=ListComp(elt=Call(func=Attribute(value=Name(id='token', ctx=Load(), lineno=65, col_offset=12, end_lineno=65, end_col_offset=17), attr='lower', ctx=Load(), lineno=65, col_offset=12, end_lineno=65, end_col_offset=23), lineno=65, col_offset=12, end_lineno=65, end_col_offset=25), generators=[comprehension(target=Name(id='token', ctx=Store(), lineno=65, col_offset=30, end_lineno=65, end_col_offset=35), iter=Name(id='matches', ctx=Load(), lineno=65, col_offset=39, end_lineno=65, end_col_offset=46), is_async=0)], lineno=65, col_offset=11, end_lineno=65, end_col_offset=47), lineno=65, col_offset=4, end_lineno=65, end_col_offset=47)], returns=Subscript(value=Name(id='list', ctx=Load(), lineno=47, col_offset=27, end_lineno=47, end_col_offset=31), slice=Name(id='str', ctx=Load(), lineno=47, col_offset=32, end_lineno=47, end_col_offset=35), ctx=Load(), lineno=47, col_offset=27, end_lineno=47, end_col_offset=36), lineno=47, col_offset=0, end_lineno=65, end_col_offset=47), ClassDef(name='FixtureDoc', body=[Expr(value=Constant(value='Document fixture for test and tutorial use.\n\n    Represents a document chunk loaded from the fixture index. Inline attribute docstrings note\n    alias usage for clarity and mkdocstrings compatibility.\n    ', lineno=71, col_offset=4, end_lineno=75, end_col_offset=7), lineno=71, col_offset=4, end_lineno=75, end_col_offset=7), AnnAssign(target=Name(id='chunk_id', ctx=Store(), lineno=77, col_offset=4, end_lineno=77, end_col_offset=12), annotation=Name(id='str', ctx=Load(), lineno=77, col_offset=14, end_lineno=77, end_col_offset=17), simple=1, lineno=77, col_offset=4, end_lineno=77, end_col_offset=17), Expr(value=Constant(value='Unique chunk identifier.\n\n    Alias: none; name ``chunk_id``.\n    ', lineno=78, col_offset=4, end_lineno=81, end_col_offset=7), lineno=78, col_offset=4, end_lineno=81, end_col_offset=7), AnnAssign(target=Name(id='doc_id', ctx=Store(), lineno=82, col_offset=4, end_lineno=82, end_col_offset=10), annotation=Name(id='str', ctx=Load(), lineno=82, col_offset=12, end_lineno=82, end_col_offset=15), simple=1, lineno=82, col_offset=4, end_lineno=82, end_col_offset=15), Expr(value=Constant(value='Parent document identifier.\n\n    Alias: none; name ``doc_id``.\n    ', lineno=83, col_offset=4, end_lineno=86, end_col_offset=7), lineno=83, col_offset=4, end_lineno=86, end_col_offset=7), AnnAssign(target=Name(id='title', ctx=Store(), lineno=87, col_offset=4, end_lineno=87, end_col_offset=9), annotation=Name(id='str', ctx=Load(), lineno=87, col_offset=11, end_lineno=87, end_col_offset=14), simple=1, lineno=87, col_offset=4, end_lineno=87, end_col_offset=14), Expr(value=Constant(value='Document title.\n\n    Alias: none; name ``title``.\n    ', lineno=88, col_offset=4, end_lineno=91, end_col_offset=7), lineno=88, col_offset=4, end_lineno=91, end_col_offset=7), AnnAssign(target=Name(id='section', ctx=Store(), lineno=92, col_offset=4, end_lineno=92, end_col_offset=11), annotation=Name(id='str', ctx=Load(), lineno=92, col_offset=13, end_lineno=92, end_col_offset=16), simple=1, lineno=92, col_offset=4, end_lineno=92, end_col_offset=16), Expr(value=Constant(value='Optional section heading.\n\n    Alias: none; name ``section``.\n    ', lineno=93, col_offset=4, end_lineno=96, end_col_offset=7), lineno=93, col_offset=4, end_lineno=96, end_col_offset=7), AnnAssign(target=Name(id='text', ctx=Store(), lineno=97, col_offset=4, end_lineno=97, end_col_offset=8), annotation=Name(id='str', ctx=Load(), lineno=97, col_offset=10, end_lineno=97, end_col_offset=13), simple=1, lineno=97, col_offset=4, end_lineno=97, end_col_offset=13), Expr(value=Constant(value='Chunk text content.\n\n    Alias: none; name ``text``.\n    ', lineno=98, col_offset=4, end_lineno=101, end_col_offset=7), lineno=98, col_offset=4, end_lineno=101, end_col_offset=7)], decorator_list=[Call(func=Name(id='dataclass', ctx=Load(), lineno=69, col_offset=1, end_lineno=69, end_col_offset=10), keywords=[keyword(arg='frozen', value=Constant(value=True, lineno=69, col_offset=18, end_lineno=69, end_col_offset=22), lineno=69, col_offset=11, end_lineno=69, end_col_offset=22)], lineno=69, col_offset=1, end_lineno=69, end_col_offset=23)], lineno=70, col_offset=0, end_lineno=101, end_col_offset=7), ClassDef(name='FixtureIndex', body=[Expr(value=Constant(value='In-memory fixture index for tests and tutorials.\n\n    Simple in-memory search index that loads document chunks from a DuckDB\n    catalog and builds term frequency (TF) and document frequency (DF)\n    indexes for basic text search. Used primarily for testing and tutorials.\n\n    Parameters\n    ----------\n    root : str, optional\n        Root directory path for data files. Defaults to "/data".\n    db_path : str, optional\n        Path to DuckDB catalog database file. Defaults to\n        "/data/catalog/catalog.duckdb".\n    ', lineno=106, col_offset=4, end_lineno=119, end_col_offset=7), lineno=106, col_offset=4, end_lineno=119, end_col_offset=7), FunctionDef(name='__init__', args=arguments(args=[arg(arg='self', lineno=121, col_offset=17, end_lineno=121, end_col_offset=21), arg(arg='root', annotation=Name(id='str', ctx=Load(), lineno=121, col_offset=29, end_lineno=121, end_col_offset=32), lineno=121, col_offset=23, end_lineno=121, end_col_offset=32), arg(arg='db_path', annotation=Name(id='str', ctx=Load(), lineno=121, col_offset=53, end_lineno=121, end_col_offset=56), lineno=121, col_offset=44, end_lineno=121, end_col_offset=56)], defaults=[Constant(value='/data', lineno=121, col_offset=35, end_lineno=121, end_col_offset=42), Constant(value='/data/catalog/catalog.duckdb', lineno=121, col_offset=59, end_lineno=121, end_col_offset=89)]), body=[Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=122, col_offset=8, end_lineno=122, end_col_offset=12), attr='root', ctx=Store(), lineno=122, col_offset=8, end_lineno=122, end_col_offset=17)], value=Call(func=Name(id='Path', ctx=Load(), lineno=122, col_offset=20, end_lineno=122, end_col_offset=24), args=[Name(id='root', ctx=Load(), lineno=122, col_offset=25, end_lineno=122, end_col_offset=29)], lineno=122, col_offset=20, end_lineno=122, end_col_offset=30), lineno=122, col_offset=8, end_lineno=122, end_col_offset=30), Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=123, col_offset=8, end_lineno=123, end_col_offset=12), attr='db_path', ctx=Store(), lineno=123, col_offset=8, end_lineno=123, end_col_offset=20)], value=Name(id='db_path', ctx=Load(), lineno=123, col_offset=23, end_lineno=123, end_col_offset=30), lineno=123, col_offset=8, end_lineno=123, end_col_offset=30), AnnAssign(target=Attribute(value=Name(id='self', ctx=Load(), lineno=124, col_offset=8, end_lineno=124, end_col_offset=12), attr='docs', ctx=Store(), lineno=124, col_offset=8, end_lineno=124, end_col_offset=17), annotation=Subscript(value=Name(id='list', ctx=Load(), lineno=124, col_offset=19, end_lineno=124, end_col_offset=23), slice=Name(id='FixtureDoc', ctx=Load(), lineno=124, col_offset=24, end_lineno=124, end_col_offset=34), ctx=Load(), lineno=124, col_offset=19, end_lineno=124, end_col_offset=35), value=List(ctx=Load(), lineno=124, col_offset=38, end_lineno=124, end_col_offset=40), simple=0, lineno=124, col_offset=8, end_lineno=124, end_col_offset=40), AnnAssign(target=Attribute(value=Name(id='self', ctx=Load(), lineno=125, col_offset=8, end_lineno=125, end_col_offset=12), attr='df', ctx=Store(), lineno=125, col_offset=8, end_lineno=125, end_col_offset=15), annotation=Subscript(value=Name(id='dict', ctx=Load(), lineno=125, col_offset=17, end_lineno=125, end_col_offset=21), slice=Tuple(elts=[Name(id='str', ctx=Load(), lineno=125, col_offset=22, end_lineno=125, end_col_offset=25), Name(id='int', ctx=Load(), lineno=125, col_offset=27, end_lineno=125, end_col_offset=30)], ctx=Load(), lineno=125, col_offset=22, end_lineno=125, end_col_offset=30), ctx=Load(), lineno=125, col_offset=17, end_lineno=125, end_col_offset=31), value=Dict(lineno=125, col_offset=34, end_lineno=125, end_col_offset=36), simple=0, lineno=125, col_offset=8, end_lineno=125, end_col_offset=36), AnnAssign(target=Attribute(value=Name(id='self', ctx=Load(), lineno=126, col_offset=8, end_lineno=126, end_col_offset=12), attr='tf', ctx=Store(), lineno=126, col_offset=8, end_lineno=126, end_col_offset=15), annotation=Subscript(value=Name(id='list', ctx=Load(), lineno=126, col_offset=17, end_lineno=126, end_col_offset=21), slice=Subscript(value=Name(id='dict', ctx=Load(), lineno=126, col_offset=22, end_lineno=126, end_col_offset=26), slice=Tuple(elts=[Name(id='str', ctx=Load(), lineno=126, col_offset=27, end_lineno=126, end_col_offset=30), Name(id='int', ctx=Load(), lineno=126, col_offset=32, end_lineno=126, end_col_offset=35)], ctx=Load(), lineno=126, col_offset=27, end_lineno=126, end_col_offset=35), ctx=Load(), lineno=126, col_offset=22, end_lineno=126, end_col_offset=36), ctx=Load(), lineno=126, col_offset=17, end_lineno=126, end_col_offset=37), value=List(ctx=Load(), lineno=126, col_offset=40, end_lineno=126, end_col_offset=42), simple=0, lineno=126, col_offset=8, end_lineno=126, end_col_offset=42), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load(), lineno=127, col_offset=8, end_lineno=127, end_col_offset=12), attr='_load_from_duckdb', ctx=Load(), lineno=127, col_offset=8, end_lineno=127, end_col_offset=30), lineno=127, col_offset=8, end_lineno=127, end_col_offset=32), lineno=127, col_offset=8, end_lineno=127, end_col_offset=32)], returns=Constant(value=None, lineno=121, col_offset=94, end_lineno=121, end_col_offset=98), lineno=121, col_offset=4, end_lineno=127, end_col_offset=32), FunctionDef(name='_load_from_duckdb', args=arguments(args=[arg(arg='self', lineno=129, col_offset=26, end_lineno=129, end_col_offset=30)]), body=[Expr(value=Constant(value='Load documents from DuckDB catalog.\n\n        Connects to the DuckDB database, finds the latest chunks dataset, and loads all document\n        chunks into memory. Then builds the lexical index for search.\n        ', lineno=130, col_offset=8, end_lineno=134, end_col_offset=11), lineno=130, col_offset=8, end_lineno=134, end_col_offset=11), Assign(targets=[Name(id='db_file', ctx=Store(), lineno=135, col_offset=8, end_lineno=135, end_col_offset=15)], value=Call(func=Name(id='Path', ctx=Load(), lineno=135, col_offset=18, end_lineno=135, end_col_offset=22), args=[Attribute(value=Name(id='self', ctx=Load(), lineno=135, col_offset=23, end_lineno=135, end_col_offset=27), attr='db_path', ctx=Load(), lineno=135, col_offset=23, end_lineno=135, end_col_offset=35)], lineno=135, col_offset=18, end_lineno=135, end_col_offset=36), lineno=135, col_offset=8, end_lineno=135, end_col_offset=36), If(test=UnaryOp(op=Not(), operand=Call(func=Attribute(value=Name(id='db_file', ctx=Load(), lineno=136, col_offset=15, end_lineno=136, end_col_offset=22), attr='exists', ctx=Load(), lineno=136, col_offset=15, end_lineno=136, end_col_offset=29), lineno=136, col_offset=15, end_lineno=136, end_col_offset=31), lineno=136, col_offset=11, end_lineno=136, end_col_offset=31), body=[Return(lineno=137, col_offset=12, end_lineno=137, end_col_offset=18)], lineno=136, col_offset=8, end_lineno=137, end_col_offset=18), With(items=[withitem(context_expr=Call(func=Attribute(value=Name(id='duckdb', ctx=Load(), lineno=139, col_offset=13, end_lineno=139, end_col_offset=19), attr='connect', ctx=Load(), lineno=139, col_offset=13, end_lineno=139, end_col_offset=27), args=[Call(func=Name(id='str', ctx=Load(), lineno=139, col_offset=28, end_lineno=139, end_col_offset=31), args=[Name(id='db_file', ctx=Load(), lineno=139, col_offset=32, end_lineno=139, end_col_offset=39)], lineno=139, col_offset=28, end_lineno=139, end_col_offset=40)], lineno=139, col_offset=13, end_lineno=139, end_col_offset=41), optional_vars=Name(id='connection', ctx=Store(), lineno=139, col_offset=45, end_lineno=139, end_col_offset=55))], body=[Assign(targets=[Name(id='root_path', ctx=Store(), lineno=140, col_offset=12, end_lineno=140, end_col_offset=21)], value=Call(func=Attribute(value=Name(id='self', ctx=Load(), lineno=140, col_offset=24, end_lineno=140, end_col_offset=28), attr='_latest_chunks_root', ctx=Load(), lineno=140, col_offset=24, end_lineno=140, end_col_offset=48), args=[Name(id='connection', ctx=Load(), lineno=140, col_offset=49, end_lineno=140, end_col_offset=59)], lineno=140, col_offset=24, end_lineno=140, end_col_offset=60), lineno=140, col_offset=12, end_lineno=140, end_col_offset=60), If(test=Compare(left=Name(id='root_path', ctx=Load(), lineno=141, col_offset=15, end_lineno=141, end_col_offset=24), ops=[Is()], comparators=[Constant(value=None, lineno=141, col_offset=28, end_lineno=141, end_col_offset=32)], lineno=141, col_offset=15, end_lineno=141, end_col_offset=32), body=[Return(lineno=142, col_offset=16, end_lineno=142, end_col_offset=22)], lineno=141, col_offset=12, end_lineno=142, end_col_offset=22), For(target=Name(id='doc', ctx=Store(), lineno=143, col_offset=16, end_lineno=143, end_col_offset=19), iter=Call(func=Attribute(value=Name(id='self', ctx=Load(), lineno=143, col_offset=23, end_lineno=143, end_col_offset=27), attr='_iter_fixture_docs', ctx=Load(), lineno=143, col_offset=23, end_lineno=143, end_col_offset=46), args=[Name(id='connection', ctx=Load(), lineno=143, col_offset=47, end_lineno=143, end_col_offset=57), Name(id='root_path', ctx=Load(), lineno=143, col_offset=59, end_lineno=143, end_col_offset=68)], lineno=143, col_offset=23, end_lineno=143, end_col_offset=69), body=[Expr(value=Call(func=Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=144, col_offset=16, end_lineno=144, end_col_offset=20), attr='docs', ctx=Load(), lineno=144, col_offset=16, end_lineno=144, end_col_offset=25), attr='append', ctx=Load(), lineno=144, col_offset=16, end_lineno=144, end_col_offset=32), args=[Name(id='doc', ctx=Load(), lineno=144, col_offset=33, end_lineno=144, end_col_offset=36)], lineno=144, col_offset=16, end_lineno=144, end_col_offset=37), lineno=144, col_offset=16, end_lineno=144, end_col_offset=37)], lineno=143, col_offset=12, end_lineno=144, end_col_offset=37)], lineno=139, col_offset=8, end_lineno=144, end_col_offset=37), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load(), lineno=146, col_offset=8, end_lineno=146, end_col_offset=12), attr='_build_lex', ctx=Load(), lineno=146, col_offset=8, end_lineno=146, end_col_offset=23), lineno=146, col_offset=8, end_lineno=146, end_col_offset=25), lineno=146, col_offset=8, end_lineno=146, end_col_offset=25)], returns=Constant(value=None, lineno=129, col_offset=35, end_lineno=129, end_col_offset=39), lineno=129, col_offset=4, end_lineno=146, end_col_offset=25), FunctionDef(name='_latest_chunks_root', args=arguments(args=[arg(arg='connection', annotation=Attribute(value=Name(id='duckdb', ctx=Load(), lineno=149, col_offset=40, end_lineno=149, end_col_offset=46), attr='DuckDBPyConnection', ctx=Load(), lineno=149, col_offset=40, end_lineno=149, end_col_offset=65), lineno=149, col_offset=28, end_lineno=149, end_col_offset=65)]), body=[Assign(targets=[Name(id='dataset_row', ctx=Store(), lineno=150, col_offset=8, end_lineno=150, end_col_offset=19)], value=Call(func=Name(id='fetch_one', ctx=Load(), lineno=150, col_offset=22, end_lineno=150, end_col_offset=31), args=[Name(id='connection', ctx=Load(), lineno=151, col_offset=12, end_lineno=151, end_col_offset=22), Constant(value="\n              SELECT parquet_root FROM datasets\n              WHERE kind='chunks'\n              ORDER BY created_at DESC\n              LIMIT 1\n            ", lineno=152, col_offset=12, end_lineno=157, end_col_offset=15)], lineno=150, col_offset=22, end_lineno=158, end_col_offset=9), lineno=150, col_offset=8, end_lineno=158, end_col_offset=9), If(test=Compare(left=Name(id='dataset_row', ctx=Load(), lineno=159, col_offset=11, end_lineno=159, end_col_offset=22), ops=[Is()], comparators=[Constant(value=None, lineno=159, col_offset=26, end_lineno=159, end_col_offset=30)], lineno=159, col_offset=11, end_lineno=159, end_col_offset=30), body=[Return(value=Constant(value=None, lineno=160, col_offset=19, end_lineno=160, end_col_offset=23), lineno=160, col_offset=12, end_lineno=160, end_col_offset=23)], lineno=159, col_offset=8, end_lineno=160, end_col_offset=23), Assign(targets=[Name(id='parquet_root', ctx=Store(), lineno=161, col_offset=8, end_lineno=161, end_col_offset=20)], value=Subscript(value=Name(id='dataset_row', ctx=Load(), lineno=161, col_offset=23, end_lineno=161, end_col_offset=34), slice=Constant(value=0, lineno=161, col_offset=35, end_lineno=161, end_col_offset=36), ctx=Load(), lineno=161, col_offset=23, end_lineno=161, end_col_offset=37), lineno=161, col_offset=8, end_lineno=161, end_col_offset=37), If(test=UnaryOp(op=Not(), operand=Call(func=Name(id='isinstance', ctx=Load(), lineno=162, col_offset=15, end_lineno=162, end_col_offset=25), args=[Name(id='parquet_root', ctx=Load(), lineno=162, col_offset=26, end_lineno=162, end_col_offset=38), Name(id='str', ctx=Load(), lineno=162, col_offset=40, end_lineno=162, end_col_offset=43)], lineno=162, col_offset=15, end_lineno=162, end_col_offset=44), lineno=162, col_offset=11, end_lineno=162, end_col_offset=44), body=[Assign(targets=[Name(id='msg', ctx=Store(), lineno=163, col_offset=12, end_lineno=163, end_col_offset=15)], value=JoinedStr(values=[Constant(value='Invalid parquet_root type: ', lineno=163, col_offset=20, end_lineno=163, end_col_offset=47), FormattedValue(value=Call(func=Name(id='type', ctx=Load(), lineno=163, col_offset=48, end_lineno=163, end_col_offset=52), args=[Name(id='parquet_root', ctx=Load(), lineno=163, col_offset=53, end_lineno=163, end_col_offset=65)], lineno=163, col_offset=48, end_lineno=163, end_col_offset=66), conversion=-1, lineno=163, col_offset=47, end_lineno=163, end_col_offset=67)], lineno=163, col_offset=18, end_lineno=163, end_col_offset=68), lineno=163, col_offset=12, end_lineno=163, end_col_offset=68), Raise(exc=Call(func=Name(id='TypeError', ctx=Load(), lineno=164, col_offset=18, end_lineno=164, end_col_offset=27), args=[Name(id='msg', ctx=Load(), lineno=164, col_offset=28, end_lineno=164, end_col_offset=31)], lineno=164, col_offset=18, end_lineno=164, end_col_offset=32), lineno=164, col_offset=12, end_lineno=164, end_col_offset=32)], lineno=162, col_offset=8, end_lineno=164, end_col_offset=32), Return(value=Call(func=Name(id='Path', ctx=Load(), lineno=165, col_offset=15, end_lineno=165, end_col_offset=19), args=[Name(id='parquet_root', ctx=Load(), lineno=165, col_offset=20, end_lineno=165, end_col_offset=32)], lineno=165, col_offset=15, end_lineno=165, end_col_offset=33), lineno=165, col_offset=8, end_lineno=165, end_col_offset=33)], decorator_list=[Name(id='staticmethod', ctx=Load(), lineno=148, col_offset=5, end_lineno=148, end_col_offset=17)], returns=BinOp(left=Name(id='Path', ctx=Load(), lineno=149, col_offset=70, end_lineno=149, end_col_offset=74), op=BitOr(), right=Constant(value=None, lineno=149, col_offset=77, end_lineno=149, end_col_offset=81), lineno=149, col_offset=70, end_lineno=149, end_col_offset=81), lineno=149, col_offset=4, end_lineno=165, end_col_offset=33), FunctionDef(name='_iter_fixture_docs', args=arguments(args=[arg(arg='connection', annotation=Attribute(value=Name(id='duckdb', ctx=Load(), lineno=169, col_offset=20, end_lineno=169, end_col_offset=26), attr='DuckDBPyConnection', ctx=Load(), lineno=169, col_offset=20, end_lineno=169, end_col_offset=45), lineno=169, col_offset=8, end_lineno=169, end_col_offset=45), arg(arg='root_path', annotation=Name(id='Path', ctx=Load(), lineno=169, col_offset=58, end_lineno=169, end_col_offset=62), lineno=169, col_offset=47, end_lineno=169, end_col_offset=62)]), body=[Assign(targets=[Name(id='parquet_pattern', ctx=Store(), lineno=171, col_offset=8, end_lineno=171, end_col_offset=23)], value=Call(func=Name(id='str', ctx=Load(), lineno=171, col_offset=26, end_lineno=171, end_col_offset=29), args=[BinOp(left=BinOp(left=Name(id='root_path', ctx=Load(), lineno=171, col_offset=30, end_lineno=171, end_col_offset=39), op=Div(), right=Constant(value='*', lineno=171, col_offset=42, end_lineno=171, end_col_offset=45), lineno=171, col_offset=30, end_lineno=171, end_col_offset=45), op=Div(), right=Constant(value='*.parquet', lineno=171, col_offset=48, end_lineno=171, end_col_offset=59), lineno=171, col_offset=30, end_lineno=171, end_col_offset=59)], lineno=171, col_offset=26, end_lineno=171, end_col_offset=60), lineno=171, col_offset=8, end_lineno=171, end_col_offset=60), AnnAssign(target=Name(id='rows', ctx=Store(), lineno=172, col_offset=8, end_lineno=172, end_col_offset=12), annotation=Subscript(value=Name(id='Sequence', ctx=Load(), lineno=172, col_offset=14, end_lineno=172, end_col_offset=22), slice=Subscript(value=Name(id='tuple', ctx=Load(), lineno=172, col_offset=23, end_lineno=172, end_col_offset=28), slice=Tuple(elts=[Name(id='object', ctx=Load(), lineno=172, col_offset=29, end_lineno=172, end_col_offset=35), Constant(value=Ellipsis, lineno=172, col_offset=37, end_lineno=172, end_col_offset=40)], ctx=Load(), lineno=172, col_offset=29, end_lineno=172, end_col_offset=40), ctx=Load(), lineno=172, col_offset=23, end_lineno=172, end_col_offset=41), ctx=Load(), lineno=172, col_offset=14, end_lineno=172, end_col_offset=42), value=Call(func=Name(id='fetch_all', ctx=Load(), lineno=172, col_offset=45, end_lineno=172, end_col_offset=54), args=[Name(id='connection', ctx=Load(), lineno=173, col_offset=12, end_lineno=173, end_col_offset=22), Constant(value="\n                SELECT c.chunk_id, c.doc_id, coalesce(c.section,''), c.text,\n                       coalesce(d.title,'') AS title\n                FROM read_parquet(?, union_by_name=true) AS c\n                LEFT JOIN documents d ON c.doc_id = d.doc_id\n            ", lineno=174, col_offset=12, end_lineno=179, end_col_offset=15), List(elts=[Name(id='parquet_pattern', ctx=Load(), lineno=180, col_offset=13, end_lineno=180, end_col_offset=28)], ctx=Load(), lineno=180, col_offset=12, end_lineno=180, end_col_offset=29)], lineno=172, col_offset=45, end_lineno=181, end_col_offset=9), simple=1, lineno=172, col_offset=8, end_lineno=181, end_col_offset=9), For(target=Tuple(elts=[Name(id='chunk_id_val', ctx=Store(), lineno=182, col_offset=12, end_lineno=182, end_col_offset=24), Name(id='doc_id_val', ctx=Store(), lineno=182, col_offset=26, end_lineno=182, end_col_offset=36), Name(id='section_val', ctx=Store(), lineno=182, col_offset=38, end_lineno=182, end_col_offset=49), Name(id='text_val', ctx=Store(), lineno=182, col_offset=51, end_lineno=182, end_col_offset=59), Name(id='title_val', ctx=Store(), lineno=182, col_offset=61, end_lineno=182, end_col_offset=70)], ctx=Store(), lineno=182, col_offset=12, end_lineno=182, end_col_offset=70), iter=Name(id='rows', ctx=Load(), lineno=182, col_offset=74, end_lineno=182, end_col_offset=78), body=[Assign(targets=[Name(id='chunk_id', ctx=Store(), lineno=183, col_offset=12, end_lineno=183, end_col_offset=20)], value=Call(func=Name(id='_as_str', ctx=Load(), lineno=183, col_offset=23, end_lineno=183, end_col_offset=30), args=[Name(id='chunk_id_val', ctx=Load(), lineno=183, col_offset=31, end_lineno=183, end_col_offset=43)], lineno=183, col_offset=23, end_lineno=183, end_col_offset=44), lineno=183, col_offset=12, end_lineno=183, end_col_offset=44), Assign(targets=[Name(id='doc_id', ctx=Store(), lineno=184, col_offset=12, end_lineno=184, end_col_offset=18)], value=Call(func=Name(id='_as_str', ctx=Load(), lineno=184, col_offset=21, end_lineno=184, end_col_offset=28), args=[Name(id='doc_id_val', ctx=Load(), lineno=184, col_offset=29, end_lineno=184, end_col_offset=39)], lineno=184, col_offset=21, end_lineno=184, end_col_offset=40), lineno=184, col_offset=12, end_lineno=184, end_col_offset=40), Assign(targets=[Name(id='section', ctx=Store(), lineno=185, col_offset=12, end_lineno=185, end_col_offset=19)], value=Call(func=Name(id='_as_str', ctx=Load(), lineno=185, col_offset=22, end_lineno=185, end_col_offset=29), args=[Name(id='section_val', ctx=Load(), lineno=185, col_offset=30, end_lineno=185, end_col_offset=41)], lineno=185, col_offset=22, end_lineno=185, end_col_offset=42), lineno=185, col_offset=12, end_lineno=185, end_col_offset=42), Assign(targets=[Name(id='text', ctx=Store(), lineno=186, col_offset=12, end_lineno=186, end_col_offset=16)], value=Call(func=Name(id='_as_str', ctx=Load(), lineno=186, col_offset=19, end_lineno=186, end_col_offset=26), args=[Name(id='text_val', ctx=Load(), lineno=186, col_offset=27, end_lineno=186, end_col_offset=35)], lineno=186, col_offset=19, end_lineno=186, end_col_offset=36), lineno=186, col_offset=12, end_lineno=186, end_col_offset=36), Assign(targets=[Name(id='title', ctx=Store(), lineno=187, col_offset=12, end_lineno=187, end_col_offset=17)], value=Call(func=Name(id='_as_str', ctx=Load(), lineno=187, col_offset=20, end_lineno=187, end_col_offset=27), args=[Name(id='title_val', ctx=Load(), lineno=187, col_offset=28, end_lineno=187, end_col_offset=37)], lineno=187, col_offset=20, end_lineno=187, end_col_offset=38), lineno=187, col_offset=12, end_lineno=187, end_col_offset=38), Expr(value=Yield(value=Call(func=Name(id='FixtureDoc', ctx=Load(), lineno=188, col_offset=18, end_lineno=188, end_col_offset=28), keywords=[keyword(arg='chunk_id', value=Name(id='chunk_id', ctx=Load(), lineno=189, col_offset=25, end_lineno=189, end_col_offset=33), lineno=189, col_offset=16, end_lineno=189, end_col_offset=33), keyword(arg='doc_id', value=BoolOp(op=Or(), values=[Name(id='doc_id', ctx=Load(), lineno=190, col_offset=23, end_lineno=190, end_col_offset=29), Constant(value='urn:doc:fixture', lineno=190, col_offset=33, end_lineno=190, end_col_offset=50)], lineno=190, col_offset=23, end_lineno=190, end_col_offset=50), lineno=190, col_offset=16, end_lineno=190, end_col_offset=50), keyword(arg='title', value=BoolOp(op=Or(), values=[Name(id='title', ctx=Load(), lineno=191, col_offset=22, end_lineno=191, end_col_offset=27), Constant(value='Fixture', lineno=191, col_offset=31, end_lineno=191, end_col_offset=40)], lineno=191, col_offset=22, end_lineno=191, end_col_offset=40), lineno=191, col_offset=16, end_lineno=191, end_col_offset=40), keyword(arg='section', value=BoolOp(op=Or(), values=[Name(id='section', ctx=Load(), lineno=192, col_offset=24, end_lineno=192, end_col_offset=31), Constant(value='', lineno=192, col_offset=35, end_lineno=192, end_col_offset=37)], lineno=192, col_offset=24, end_lineno=192, end_col_offset=37), lineno=192, col_offset=16, end_lineno=192, end_col_offset=37), keyword(arg='text', value=BoolOp(op=Or(), values=[Name(id='text', ctx=Load(), lineno=193, col_offset=21, end_lineno=193, end_col_offset=25), Constant(value='', lineno=193, col_offset=29, end_lineno=193, end_col_offset=31)], lineno=193, col_offset=21, end_lineno=193, end_col_offset=31), lineno=193, col_offset=16, end_lineno=193, end_col_offset=31)], lineno=188, col_offset=18, end_lineno=194, end_col_offset=13), lineno=188, col_offset=12, end_lineno=194, end_col_offset=13), lineno=188, col_offset=12, end_lineno=194, end_col_offset=13)], lineno=182, col_offset=8, end_lineno=194, end_col_offset=13)], decorator_list=[Name(id='staticmethod', ctx=Load(), lineno=167, col_offset=5, end_lineno=167, end_col_offset=17)], returns=Subscript(value=Name(id='Iterator', ctx=Load(), lineno=170, col_offset=9, end_lineno=170, end_col_offset=17), slice=Name(id='FixtureDoc', ctx=Load(), lineno=170, col_offset=18, end_lineno=170, end_col_offset=28), ctx=Load(), lineno=170, col_offset=9, end_lineno=170, end_col_offset=29), lineno=168, col_offset=4, end_lineno=194, end_col_offset=13), FunctionDef(name='_build_lex', args=arguments(args=[arg(arg='self', lineno=196, col_offset=19, end_lineno=196, end_col_offset=23)]), body=[Expr(value=Constant(value='Build lexical index (TF/DF structures) from loaded documents.\n\n        Computes term frequency (TF) for each document and document frequency (DF) for each token\n        across all documents. Sets self.N to the total number of documents.\n        ', lineno=197, col_offset=8, end_lineno=201, end_col_offset=11), lineno=197, col_offset=8, end_lineno=201, end_col_offset=11), Expr(value=Call(func=Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=202, col_offset=8, end_lineno=202, end_col_offset=12), attr='tf', ctx=Load(), lineno=202, col_offset=8, end_lineno=202, end_col_offset=15), attr='clear', ctx=Load(), lineno=202, col_offset=8, end_lineno=202, end_col_offset=21), lineno=202, col_offset=8, end_lineno=202, end_col_offset=23), lineno=202, col_offset=8, end_lineno=202, end_col_offset=23), Expr(value=Call(func=Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=203, col_offset=8, end_lineno=203, end_col_offset=12), attr='df', ctx=Load(), lineno=203, col_offset=8, end_lineno=203, end_col_offset=15), attr='clear', ctx=Load(), lineno=203, col_offset=8, end_lineno=203, end_col_offset=21), lineno=203, col_offset=8, end_lineno=203, end_col_offset=23), lineno=203, col_offset=8, end_lineno=203, end_col_offset=23), For(target=Name(id='doc', ctx=Store(), lineno=204, col_offset=12, end_lineno=204, end_col_offset=15), iter=Attribute(value=Name(id='self', ctx=Load(), lineno=204, col_offset=19, end_lineno=204, end_col_offset=23), attr='docs', ctx=Load(), lineno=204, col_offset=19, end_lineno=204, end_col_offset=28), body=[Assign(targets=[Name(id='tokens', ctx=Store(), lineno=205, col_offset=12, end_lineno=205, end_col_offset=18)], value=Call(func=Name(id='tokenize', ctx=Load(), lineno=205, col_offset=21, end_lineno=205, end_col_offset=29), args=[Attribute(value=Name(id='doc', ctx=Load(), lineno=205, col_offset=30, end_lineno=205, end_col_offset=33), attr='text', ctx=Load(), lineno=205, col_offset=30, end_lineno=205, end_col_offset=38)], lineno=205, col_offset=21, end_lineno=205, end_col_offset=39), lineno=205, col_offset=12, end_lineno=205, end_col_offset=39), AnnAssign(target=Name(id='tf_counts', ctx=Store(), lineno=206, col_offset=12, end_lineno=206, end_col_offset=21), annotation=Subscript(value=Name(id='dict', ctx=Load(), lineno=206, col_offset=23, end_lineno=206, end_col_offset=27), slice=Tuple(elts=[Name(id='str', ctx=Load(), lineno=206, col_offset=28, end_lineno=206, end_col_offset=31), Name(id='int', ctx=Load(), lineno=206, col_offset=33, end_lineno=206, end_col_offset=36)], ctx=Load(), lineno=206, col_offset=28, end_lineno=206, end_col_offset=36), ctx=Load(), lineno=206, col_offset=23, end_lineno=206, end_col_offset=37), value=Dict(lineno=206, col_offset=40, end_lineno=206, end_col_offset=42), simple=1, lineno=206, col_offset=12, end_lineno=206, end_col_offset=42), For(target=Name(id='token', ctx=Store(), lineno=207, col_offset=16, end_lineno=207, end_col_offset=21), iter=Name(id='tokens', ctx=Load(), lineno=207, col_offset=25, end_lineno=207, end_col_offset=31), body=[Assign(targets=[Subscript(value=Name(id='tf_counts', ctx=Load(), lineno=208, col_offset=16, end_lineno=208, end_col_offset=25), slice=Name(id='token', ctx=Load(), lineno=208, col_offset=26, end_lineno=208, end_col_offset=31), ctx=Store(), lineno=208, col_offset=16, end_lineno=208, end_col_offset=32)], value=BinOp(left=Call(func=Attribute(value=Name(id='tf_counts', ctx=Load(), lineno=208, col_offset=35, end_lineno=208, end_col_offset=44), attr='get', ctx=Load(), lineno=208, col_offset=35, end_lineno=208, end_col_offset=48), args=[Name(id='token', ctx=Load(), lineno=208, col_offset=49, end_lineno=208, end_col_offset=54), Constant(value=0, lineno=208, col_offset=56, end_lineno=208, end_col_offset=57)], lineno=208, col_offset=35, end_lineno=208, end_col_offset=58), op=Add(), right=Constant(value=1, lineno=208, col_offset=61, end_lineno=208, end_col_offset=62), lineno=208, col_offset=35, end_lineno=208, end_col_offset=62), lineno=208, col_offset=16, end_lineno=208, end_col_offset=62)], lineno=207, col_offset=12, end_lineno=208, end_col_offset=62), Expr(value=Call(func=Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=209, col_offset=12, end_lineno=209, end_col_offset=16), attr='tf', ctx=Load(), lineno=209, col_offset=12, end_lineno=209, end_col_offset=19), attr='append', ctx=Load(), lineno=209, col_offset=12, end_lineno=209, end_col_offset=26), args=[Name(id='tf_counts', ctx=Load(), lineno=209, col_offset=27, end_lineno=209, end_col_offset=36)], lineno=209, col_offset=12, end_lineno=209, end_col_offset=37), lineno=209, col_offset=12, end_lineno=209, end_col_offset=37), For(target=Name(id='token', ctx=Store(), lineno=210, col_offset=16, end_lineno=210, end_col_offset=21), iter=Call(func=Name(id='set', ctx=Load(), lineno=210, col_offset=25, end_lineno=210, end_col_offset=28), args=[Name(id='tokens', ctx=Load(), lineno=210, col_offset=29, end_lineno=210, end_col_offset=35)], lineno=210, col_offset=25, end_lineno=210, end_col_offset=36), body=[Assign(targets=[Subscript(value=Attribute(value=Name(id='self', ctx=Load(), lineno=211, col_offset=16, end_lineno=211, end_col_offset=20), attr='df', ctx=Load(), lineno=211, col_offset=16, end_lineno=211, end_col_offset=23), slice=Name(id='token', ctx=Load(), lineno=211, col_offset=24, end_lineno=211, end_col_offset=29), ctx=Store(), lineno=211, col_offset=16, end_lineno=211, end_col_offset=30)], value=BinOp(left=Call(func=Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=211, col_offset=33, end_lineno=211, end_col_offset=37), attr='df', ctx=Load(), lineno=211, col_offset=33, end_lineno=211, end_col_offset=40), attr='get', ctx=Load(), lineno=211, col_offset=33, end_lineno=211, end_col_offset=44), args=[Name(id='token', ctx=Load(), lineno=211, col_offset=45, end_lineno=211, end_col_offset=50), Constant(value=0, lineno=211, col_offset=52, end_lineno=211, end_col_offset=53)], lineno=211, col_offset=33, end_lineno=211, end_col_offset=54), op=Add(), right=Constant(value=1, lineno=211, col_offset=57, end_lineno=211, end_col_offset=58), lineno=211, col_offset=33, end_lineno=211, end_col_offset=58), lineno=211, col_offset=16, end_lineno=211, end_col_offset=58)], lineno=210, col_offset=12, end_lineno=211, end_col_offset=58)], lineno=204, col_offset=8, end_lineno=211, end_col_offset=58), Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=212, col_offset=8, end_lineno=212, end_col_offset=12), attr='N', ctx=Store(), lineno=212, col_offset=8, end_lineno=212, end_col_offset=14)], value=Call(func=Name(id='len', ctx=Load(), lineno=212, col_offset=17, end_lineno=212, end_col_offset=20), args=[Attribute(value=Name(id='self', ctx=Load(), lineno=212, col_offset=21, end_lineno=212, end_col_offset=25), attr='docs', ctx=Load(), lineno=212, col_offset=21, end_lineno=212, end_col_offset=30)], lineno=212, col_offset=17, end_lineno=212, end_col_offset=31), lineno=212, col_offset=8, end_lineno=212, end_col_offset=31)], returns=Constant(value=None, lineno=196, col_offset=28, end_lineno=196, end_col_offset=32), lineno=196, col_offset=4, end_lineno=212, end_col_offset=31), FunctionDef(name='search', args=arguments(args=[arg(arg='self', lineno=214, col_offset=15, end_lineno=214, end_col_offset=19), arg(arg='query', annotation=Name(id='str', ctx=Load(), lineno=214, col_offset=28, end_lineno=214, end_col_offset=31), lineno=214, col_offset=21, end_lineno=214, end_col_offset=31), arg(arg='k', annotation=Name(id='int', ctx=Load(), lineno=214, col_offset=36, end_lineno=214, end_col_offset=39), lineno=214, col_offset=33, end_lineno=214, end_col_offset=39)], defaults=[Constant(value=10, lineno=214, col_offset=42, end_lineno=214, end_col_offset=44)]), body=[Expr(value=Constant(value='Search documents using TF-IDF scoring.\n\n        Tokenizes the query and scores each document using TF-IDF (term\n        frequency-inverse document frequency). Returns top-k results sorted\n        by relevance score.\n\n        Parameters\n        ----------\n        query : str\n            Search query text.\n        k : int, optional\n            Number of top results to return. Defaults to 10.\n\n        Returns\n        -------\n        list[tuple[int, float]]\n            List of (document_index, score) tuples sorted by score descending.\n            Only documents with score > 0 are included.\n        ', lineno=215, col_offset=8, end_lineno=233, end_col_offset=11), lineno=215, col_offset=8, end_lineno=233, end_col_offset=11), If(test=BoolOp(op=Or(), values=[UnaryOp(op=Not(), operand=Call(func=Name(id='hasattr', ctx=Load(), lineno=234, col_offset=15, end_lineno=234, end_col_offset=22), args=[Name(id='self', ctx=Load(), lineno=234, col_offset=23, end_lineno=234, end_col_offset=27), Constant(value='N', lineno=234, col_offset=29, end_lineno=234, end_col_offset=32)], lineno=234, col_offset=15, end_lineno=234, end_col_offset=33), lineno=234, col_offset=11, end_lineno=234, end_col_offset=33), Compare(left=Attribute(value=Name(id='self', ctx=Load(), lineno=234, col_offset=37, end_lineno=234, end_col_offset=41), attr='N', ctx=Load(), lineno=234, col_offset=37, end_lineno=234, end_col_offset=43), ops=[Eq()], comparators=[Constant(value=0, lineno=234, col_offset=47, end_lineno=234, end_col_offset=48)], lineno=234, col_offset=37, end_lineno=234, end_col_offset=48)], lineno=234, col_offset=11, end_lineno=234, end_col_offset=48), body=[Return(value=List(ctx=Load(), lineno=235, col_offset=19, end_lineno=235, end_col_offset=21), lineno=235, col_offset=12, end_lineno=235, end_col_offset=21)], lineno=234, col_offset=8, end_lineno=235, end_col_offset=21), Assign(targets=[Name(id='qtoks', ctx=Store(), lineno=236, col_offset=8, end_lineno=236, end_col_offset=13)], value=Call(func=Name(id='tokenize', ctx=Load(), lineno=236, col_offset=16, end_lineno=236, end_col_offset=24), args=[Name(id='query', ctx=Load(), lineno=236, col_offset=25, end_lineno=236, end_col_offset=30)], lineno=236, col_offset=16, end_lineno=236, end_col_offset=31), lineno=236, col_offset=8, end_lineno=236, end_col_offset=31), If(test=UnaryOp(op=Not(), operand=Name(id='qtoks', ctx=Load(), lineno=237, col_offset=15, end_lineno=237, end_col_offset=20), lineno=237, col_offset=11, end_lineno=237, end_col_offset=20), body=[Return(value=List(ctx=Load(), lineno=238, col_offset=19, end_lineno=238, end_col_offset=21), lineno=238, col_offset=12, end_lineno=238, end_col_offset=21)], lineno=237, col_offset=8, end_lineno=238, end_col_offset=21), Assign(targets=[Name(id='scores', ctx=Store(), lineno=239, col_offset=8, end_lineno=239, end_col_offset=14)], value=BinOp(left=List(elts=[Constant(value=0.0, lineno=239, col_offset=18, end_lineno=239, end_col_offset=21)], ctx=Load(), lineno=239, col_offset=17, end_lineno=239, end_col_offset=22), op=Mult(), right=Attribute(value=Name(id='self', ctx=Load(), lineno=239, col_offset=25, end_lineno=239, end_col_offset=29), attr='N', ctx=Load(), lineno=239, col_offset=25, end_lineno=239, end_col_offset=31), lineno=239, col_offset=17, end_lineno=239, end_col_offset=31), lineno=239, col_offset=8, end_lineno=239, end_col_offset=31), For(target=Tuple(elts=[Name(id='i', ctx=Store(), lineno=240, col_offset=12, end_lineno=240, end_col_offset=13), Name(id='tf', ctx=Store(), lineno=240, col_offset=15, end_lineno=240, end_col_offset=17)], ctx=Store(), lineno=240, col_offset=12, end_lineno=240, end_col_offset=17), iter=Call(func=Name(id='enumerate', ctx=Load(), lineno=240, col_offset=21, end_lineno=240, end_col_offset=30), args=[Attribute(value=Name(id='self', ctx=Load(), lineno=240, col_offset=31, end_lineno=240, end_col_offset=35), attr='tf', ctx=Load(), lineno=240, col_offset=31, end_lineno=240, end_col_offset=38)], lineno=240, col_offset=21, end_lineno=240, end_col_offset=39), body=[Assign(targets=[Name(id='score', ctx=Store(), lineno=241, col_offset=12, end_lineno=241, end_col_offset=17)], value=Constant(value=0.0, lineno=241, col_offset=20, end_lineno=241, end_col_offset=23), lineno=241, col_offset=12, end_lineno=241, end_col_offset=23), For(target=Name(id='token', ctx=Store(), lineno=242, col_offset=16, end_lineno=242, end_col_offset=21), iter=Name(id='qtoks', ctx=Load(), lineno=242, col_offset=25, end_lineno=242, end_col_offset=30), body=[If(test=Compare(left=Name(id='token', ctx=Load(), lineno=243, col_offset=19, end_lineno=243, end_col_offset=24), ops=[NotIn()], comparators=[Attribute(value=Name(id='self', ctx=Load(), lineno=243, col_offset=32, end_lineno=243, end_col_offset=36), attr='df', ctx=Load(), lineno=243, col_offset=32, end_lineno=243, end_col_offset=39)], lineno=243, col_offset=19, end_lineno=243, end_col_offset=39), body=[Continue(lineno=244, col_offset=20, end_lineno=244, end_col_offset=28)], lineno=243, col_offset=16, end_lineno=244, end_col_offset=28), Assign(targets=[Name(id='idf', ctx=Store(), lineno=245, col_offset=16, end_lineno=245, end_col_offset=19)], value=Call(func=Attribute(value=Name(id='math', ctx=Load(), lineno=245, col_offset=22, end_lineno=245, end_col_offset=26), attr='log', ctx=Load(), lineno=245, col_offset=22, end_lineno=245, end_col_offset=30), args=[BinOp(left=BinOp(left=BinOp(left=Attribute(value=Name(id='self', ctx=Load(), lineno=245, col_offset=32, end_lineno=245, end_col_offset=36), attr='N', ctx=Load(), lineno=245, col_offset=32, end_lineno=245, end_col_offset=38), op=Add(), right=Constant(value=1, lineno=245, col_offset=41, end_lineno=245, end_col_offset=42), lineno=245, col_offset=32, end_lineno=245, end_col_offset=42), op=Div(), right=BinOp(left=Subscript(value=Attribute(value=Name(id='self', ctx=Load(), lineno=245, col_offset=47, end_lineno=245, end_col_offset=51), attr='df', ctx=Load(), lineno=245, col_offset=47, end_lineno=245, end_col_offset=54), slice=Name(id='token', ctx=Load(), lineno=245, col_offset=55, end_lineno=245, end_col_offset=60), ctx=Load(), lineno=245, col_offset=47, end_lineno=245, end_col_offset=61), op=Add(), right=Constant(value=0.5, lineno=245, col_offset=64, end_lineno=245, end_col_offset=67), lineno=245, col_offset=47, end_lineno=245, end_col_offset=67), lineno=245, col_offset=31, end_lineno=245, end_col_offset=68), op=Add(), right=Constant(value=1.0, lineno=245, col_offset=71, end_lineno=245, end_col_offset=74), lineno=245, col_offset=31, end_lineno=245, end_col_offset=74)], lineno=245, col_offset=22, end_lineno=245, end_col_offset=75), lineno=245, col_offset=16, end_lineno=245, end_col_offset=75), AugAssign(target=Name(id='score', ctx=Store(), lineno=246, col_offset=16, end_lineno=246, end_col_offset=21), op=Add(), value=BinOp(left=Name(id='idf', ctx=Load(), lineno=246, col_offset=25, end_lineno=246, end_col_offset=28), op=Mult(), right=Call(func=Attribute(value=Name(id='tf', ctx=Load(), lineno=246, col_offset=31, end_lineno=246, end_col_offset=33), attr='get', ctx=Load(), lineno=246, col_offset=31, end_lineno=246, end_col_offset=37), args=[Name(id='token', ctx=Load(), lineno=246, col_offset=38, end_lineno=246, end_col_offset=43), Constant(value=0, lineno=246, col_offset=45, end_lineno=246, end_col_offset=46)], lineno=246, col_offset=31, end_lineno=246, end_col_offset=47), lineno=246, col_offset=25, end_lineno=246, end_col_offset=47), lineno=246, col_offset=16, end_lineno=246, end_col_offset=47)], lineno=242, col_offset=12, end_lineno=246, end_col_offset=47), Assign(targets=[Subscript(value=Name(id='scores', ctx=Load(), lineno=247, col_offset=12, end_lineno=247, end_col_offset=18), slice=Name(id='i', ctx=Load(), lineno=247, col_offset=19, end_lineno=247, end_col_offset=20), ctx=Store(), lineno=247, col_offset=12, end_lineno=247, end_col_offset=21)], value=Name(id='score', ctx=Load(), lineno=247, col_offset=24, end_lineno=247, end_col_offset=29), lineno=247, col_offset=12, end_lineno=247, end_col_offset=29)], lineno=240, col_offset=8, end_lineno=247, end_col_offset=29), FunctionDef(name='key_func', args=arguments(args=[arg(arg='item', annotation=Subscript(value=Name(id='tuple', ctx=Load(), lineno=250, col_offset=27, end_lineno=250, end_col_offset=32), slice=Tuple(elts=[Name(id='int', ctx=Load(), lineno=250, col_offset=33, end_lineno=250, end_col_offset=36), Name(id='float', ctx=Load(), lineno=250, col_offset=38, end_lineno=250, end_col_offset=43)], ctx=Load(), lineno=250, col_offset=33, end_lineno=250, end_col_offset=43), ctx=Load(), lineno=250, col_offset=27, end_lineno=250, end_col_offset=44), lineno=250, col_offset=21, end_lineno=250, end_col_offset=44)]), body=[Expr(value=Constant(value='Extract score from (index, score) tuple for sorting.\n\n            Parameters\n            ----------\n            item : tuple[int, float]\n                Tuple of (index, score).\n\n            Returns\n            -------\n            float\n                Score value.\n            ', lineno=251, col_offset=12, end_lineno=262, end_col_offset=15), lineno=251, col_offset=12, end_lineno=262, end_col_offset=15), Return(value=Subscript(value=Name(id='item', ctx=Load(), lineno=263, col_offset=19, end_lineno=263, end_col_offset=23), slice=Constant(value=1, lineno=263, col_offset=24, end_lineno=263, end_col_offset=25), ctx=Load(), lineno=263, col_offset=19, end_lineno=263, end_col_offset=26), lineno=263, col_offset=12, end_lineno=263, end_col_offset=26)], returns=Name(id='float', ctx=Load(), lineno=250, col_offset=49, end_lineno=250, end_col_offset=54), lineno=250, col_offset=8, end_lineno=263, end_col_offset=26), AnnAssign(target=Name(id='ranked', ctx=Store(), lineno=265, col_offset=8, end_lineno=265, end_col_offset=14), annotation=Subscript(value=Name(id='list', ctx=Load(), lineno=265, col_offset=16, end_lineno=265, end_col_offset=20), slice=Subscript(value=Name(id='tuple', ctx=Load(), lineno=265, col_offset=21, end_lineno=265, end_col_offset=26), slice=Tuple(elts=[Name(id='int', ctx=Load(), lineno=265, col_offset=27, end_lineno=265, end_col_offset=30), Name(id='float', ctx=Load(), lineno=265, col_offset=32, end_lineno=265, end_col_offset=37)], ctx=Load(), lineno=265, col_offset=27, end_lineno=265, end_col_offset=37), ctx=Load(), lineno=265, col_offset=21, end_lineno=265, end_col_offset=38), ctx=Load(), lineno=265, col_offset=16, end_lineno=265, end_col_offset=39), value=Call(func=Name(id='sorted', ctx=Load(), lineno=265, col_offset=42, end_lineno=265, end_col_offset=48), args=[Call(func=Name(id='enumerate', ctx=Load(), lineno=265, col_offset=49, end_lineno=265, end_col_offset=58), args=[Name(id='scores', ctx=Load(), lineno=265, col_offset=59, end_lineno=265, end_col_offset=65)], lineno=265, col_offset=49, end_lineno=265, end_col_offset=66)], keywords=[keyword(arg='key', value=Name(id='key_func', ctx=Load(), lineno=265, col_offset=72, end_lineno=265, end_col_offset=80), lineno=265, col_offset=68, end_lineno=265, end_col_offset=80), keyword(arg='reverse', value=Constant(value=True, lineno=265, col_offset=90, end_lineno=265, end_col_offset=94), lineno=265, col_offset=82, end_lineno=265, end_col_offset=94)], lineno=265, col_offset=42, end_lineno=265, end_col_offset=95), simple=1, lineno=265, col_offset=8, end_lineno=265, end_col_offset=95), Return(value=ListComp(elt=Tuple(elts=[Name(id='index', ctx=Load(), lineno=266, col_offset=17, end_lineno=266, end_col_offset=22), Name(id='score', ctx=Load(), lineno=266, col_offset=24, end_lineno=266, end_col_offset=29)], ctx=Load(), lineno=266, col_offset=16, end_lineno=266, end_col_offset=30), generators=[comprehension(target=Tuple(elts=[Name(id='index', ctx=Store(), lineno=266, col_offset=35, end_lineno=266, end_col_offset=40), Name(id='score', ctx=Store(), lineno=266, col_offset=42, end_lineno=266, end_col_offset=47)], ctx=Store(), lineno=266, col_offset=35, end_lineno=266, end_col_offset=47), iter=Subscript(value=Name(id='ranked', ctx=Load(), lineno=266, col_offset=51, end_lineno=266, end_col_offset=57), slice=Slice(upper=Name(id='k', ctx=Load(), lineno=266, col_offset=59, end_lineno=266, end_col_offset=60), lineno=266, col_offset=58, end_lineno=266, end_col_offset=60), ctx=Load(), lineno=266, col_offset=51, end_lineno=266, end_col_offset=61), ifs=[Compare(left=Name(id='score', ctx=Load(), lineno=266, col_offset=65, end_lineno=266, end_col_offset=70), ops=[Gt()], comparators=[Constant(value=0.0, lineno=266, col_offset=73, end_lineno=266, end_col_offset=76)], lineno=266, col_offset=65, end_lineno=266, end_col_offset=76)], is_async=0)], lineno=266, col_offset=15, end_lineno=266, end_col_offset=77), lineno=266, col_offset=8, end_lineno=266, end_col_offset=77)], returns=Subscript(value=Name(id='list', ctx=Load(), lineno=214, col_offset=49, end_lineno=214, end_col_offset=53), slice=Subscript(value=Name(id='tuple', ctx=Load(), lineno=214, col_offset=54, end_lineno=214, end_col_offset=59), slice=Tuple(elts=[Name(id='int', ctx=Load(), lineno=214, col_offset=60, end_lineno=214, end_col_offset=63), Name(id='float', ctx=Load(), lineno=214, col_offset=65, end_lineno=214, end_col_offset=70)], ctx=Load(), lineno=214, col_offset=60, end_lineno=214, end_col_offset=70), ctx=Load(), lineno=214, col_offset=54, end_lineno=214, end_col_offset=71), ctx=Load(), lineno=214, col_offset=49, end_lineno=214, end_col_offset=72), lineno=214, col_offset=4, end_lineno=266, end_col_offset=77), FunctionDef(name='doc', args=arguments(args=[arg(arg='self', lineno=268, col_offset=12, end_lineno=268, end_col_offset=16), arg(arg='index', annotation=Name(id='int', ctx=Load(), lineno=268, col_offset=25, end_lineno=268, end_col_offset=28), lineno=268, col_offset=18, end_lineno=268, end_col_offset=28)]), body=[Expr(value=Constant(value='Get document by index.\n\n        Retrieves the document at the specified index from the loaded\n        documents list.\n\n        Parameters\n        ----------\n        index : int\n            Document index (0-based).\n\n        Returns\n        -------\n        FixtureDoc\n            Document fixture at the specified index.\n        ', lineno=269, col_offset=8, end_lineno=283, end_col_offset=11), lineno=269, col_offset=8, end_lineno=283, end_col_offset=11), Return(value=Subscript(value=Attribute(value=Name(id='self', ctx=Load(), lineno=284, col_offset=15, end_lineno=284, end_col_offset=19), attr='docs', ctx=Load(), lineno=284, col_offset=15, end_lineno=284, end_col_offset=24), slice=Name(id='index', ctx=Load(), lineno=284, col_offset=25, end_lineno=284, end_col_offset=30), ctx=Load(), lineno=284, col_offset=15, end_lineno=284, end_col_offset=31), lineno=284, col_offset=8, end_lineno=284, end_col_offset=31)], returns=Name(id='FixtureDoc', ctx=Load(), lineno=268, col_offset=33, end_lineno=268, end_col_offset=43), lineno=268, col_offset=4, end_lineno=284, end_col_offset=31)], lineno=105, col_offset=0, end_lineno=284, end_col_offset=31)])