Module(body=[Expr(value=Constant(value='Typed DuckDB helper utilities for parameterized queries and logging.', lineno=1, col_offset=0, end_lineno=1, end_col_offset=74), lineno=1, col_offset=0, end_lineno=1, end_col_offset=74), ImportFrom(module='__future__', names=[alias(name='annotations', lineno=5, col_offset=23, end_lineno=5, end_col_offset=34)], level=0, lineno=5, col_offset=0, end_lineno=5, end_col_offset=34), Import(names=[alias(name='time', lineno=7, col_offset=7, end_lineno=7, end_col_offset=11)], lineno=7, col_offset=0, end_lineno=7, end_col_offset=11), ImportFrom(module='collections.abc', names=[alias(name='Mapping', lineno=8, col_offset=28, end_lineno=8, end_col_offset=35), alias(name='Sequence', lineno=8, col_offset=37, end_lineno=8, end_col_offset=45)], level=0, lineno=8, col_offset=0, end_lineno=8, end_col_offset=45), ImportFrom(module='dataclasses', names=[alias(name='dataclass', lineno=9, col_offset=24, end_lineno=9, end_col_offset=33), alias(name='replace', lineno=9, col_offset=35, end_lineno=9, end_col_offset=42)], level=0, lineno=9, col_offset=0, end_lineno=9, end_col_offset=42), ImportFrom(module='pathlib', names=[alias(name='Path', lineno=10, col_offset=20, end_lineno=10, end_col_offset=24)], level=0, lineno=10, col_offset=0, end_lineno=10, end_col_offset=24), ImportFrom(module='typing', names=[alias(name='TYPE_CHECKING', lineno=11, col_offset=19, end_lineno=11, end_col_offset=32), alias(name='Final', lineno=11, col_offset=34, end_lineno=11, end_col_offset=39), alias(name='cast', lineno=11, col_offset=41, end_lineno=11, end_col_offset=45)], level=0, lineno=11, col_offset=0, end_lineno=11, end_col_offset=45), Import(names=[alias(name='duckdb', lineno=13, col_offset=7, end_lineno=13, end_col_offset=13)], lineno=13, col_offset=0, end_lineno=13, end_col_offset=13), ImportFrom(module='kgfoundry_common.errors', names=[alias(name='RegistryError', lineno=15, col_offset=36, end_lineno=15, end_col_offset=49)], level=0, lineno=15, col_offset=0, end_lineno=15, end_col_offset=49), ImportFrom(module='kgfoundry_common.logging', names=[alias(name='get_logger', lineno=16, col_offset=37, end_lineno=16, end_col_offset=47), alias(name='with_fields', lineno=16, col_offset=49, end_lineno=16, end_col_offset=60)], level=0, lineno=16, col_offset=0, end_lineno=16, end_col_offset=60), ImportFrom(module='kgfoundry_common.navmap_loader', names=[alias(name='load_nav_metadata', lineno=17, col_offset=43, end_lineno=17, end_col_offset=60)], level=0, lineno=17, col_offset=0, end_lineno=17, end_col_offset=60), ImportFrom(module='kgfoundry_common.observability', names=[alias(name='MetricsProvider', lineno=18, col_offset=43, end_lineno=18, end_col_offset=58), alias(name='observe_duration', lineno=18, col_offset=60, end_lineno=18, end_col_offset=76)], level=0, lineno=18, col_offset=0, end_lineno=18, end_col_offset=76), If(test=Name(id='TYPE_CHECKING', ctx=Load(), lineno=20, col_offset=3, end_lineno=20, end_col_offset=16), body=[ImportFrom(module='collections.abc', names=[alias(name='Iterable', lineno=21, col_offset=32, end_lineno=21, end_col_offset=40)], level=0, lineno=21, col_offset=4, end_lineno=21, end_col_offset=40), ImportFrom(module='duckdb', names=[alias(name='DuckDBPyConnection', lineno=23, col_offset=23, end_lineno=23, end_col_offset=41)], level=0, lineno=23, col_offset=4, end_lineno=23, end_col_offset=41)], lineno=20, col_offset=0, end_lineno=23, end_col_offset=41), Assign(targets=[Name(id='Params', ctx=Store(), lineno=25, col_offset=0, end_lineno=25, end_col_offset=6)], value=BinOp(left=BinOp(left=Subscript(value=Name(id='Sequence', ctx=Load(), lineno=25, col_offset=9, end_lineno=25, end_col_offset=17), slice=Name(id='object', ctx=Load(), lineno=25, col_offset=18, end_lineno=25, end_col_offset=24), ctx=Load(), lineno=25, col_offset=9, end_lineno=25, end_col_offset=25), op=BitOr(), right=Subscript(value=Name(id='Mapping', ctx=Load(), lineno=25, col_offset=28, end_lineno=25, end_col_offset=35), slice=Tuple(elts=[Name(id='str', ctx=Load(), lineno=25, col_offset=36, end_lineno=25, end_col_offset=39), Name(id='object', ctx=Load(), lineno=25, col_offset=41, end_lineno=25, end_col_offset=47)], ctx=Load(), lineno=25, col_offset=36, end_lineno=25, end_col_offset=47), ctx=Load(), lineno=25, col_offset=28, end_lineno=25, end_col_offset=48), lineno=25, col_offset=9, end_lineno=25, end_col_offset=48), op=BitOr(), right=Constant(value=None, lineno=25, col_offset=51, end_lineno=25, end_col_offset=55), lineno=25, col_offset=9, end_lineno=25, end_col_offset=55), lineno=25, col_offset=0, end_lineno=25, end_col_offset=55), AnnAssign(target=Name(id='DEFAULT_TIMEOUT_S', ctx=Store(), lineno=28, col_offset=0, end_lineno=28, end_col_offset=17), annotation=Subscript(value=Name(id='Final', ctx=Load(), lineno=28, col_offset=19, end_lineno=28, end_col_offset=24), slice=Name(id='float', ctx=Load(), lineno=28, col_offset=25, end_lineno=28, end_col_offset=30), ctx=Load(), lineno=28, col_offset=19, end_lineno=28, end_col_offset=31), value=Constant(value=5.0, lineno=28, col_offset=34, end_lineno=28, end_col_offset=37), simple=1, lineno=28, col_offset=0, end_lineno=28, end_col_offset=37), AnnAssign(target=Name(id='DEFAULT_SLOW_QUERY_THRESHOLD_S', ctx=Store(), lineno=30, col_offset=0, end_lineno=30, end_col_offset=30), annotation=Subscript(value=Name(id='Final', ctx=Load(), lineno=30, col_offset=32, end_lineno=30, end_col_offset=37), slice=Name(id='float', ctx=Load(), lineno=30, col_offset=38, end_lineno=30, end_col_offset=43), ctx=Load(), lineno=30, col_offset=32, end_lineno=30, end_col_offset=44), value=Constant(value=0.5, lineno=30, col_offset=47, end_lineno=30, end_col_offset=50), simple=1, lineno=30, col_offset=0, end_lineno=30, end_col_offset=50), AnnAssign(target=Name(id='DEFAULT_THREADS', ctx=Store(), lineno=31, col_offset=0, end_lineno=31, end_col_offset=15), annotation=Subscript(value=Name(id='Final', ctx=Load(), lineno=31, col_offset=17, end_lineno=31, end_col_offset=22), slice=Name(id='int', ctx=Load(), lineno=31, col_offset=23, end_lineno=31, end_col_offset=26), ctx=Load(), lineno=31, col_offset=17, end_lineno=31, end_col_offset=27), value=Constant(value=4, lineno=31, col_offset=30, end_lineno=31, end_col_offset=31), simple=1, lineno=31, col_offset=0, end_lineno=31, end_col_offset=31), AnnAssign(target=Name(id='MAX_SQL_PREVIEW_CHARS', ctx=Store(), lineno=32, col_offset=0, end_lineno=32, end_col_offset=21), annotation=Subscript(value=Name(id='Final', ctx=Load(), lineno=32, col_offset=23, end_lineno=32, end_col_offset=28), slice=Name(id='int', ctx=Load(), lineno=32, col_offset=29, end_lineno=32, end_col_offset=32), ctx=Load(), lineno=32, col_offset=23, end_lineno=32, end_col_offset=33), value=Constant(value=160, lineno=32, col_offset=36, end_lineno=32, end_col_offset=39), simple=1, lineno=32, col_offset=0, end_lineno=32, end_col_offset=39), ClassDef(name='DuckDBQueryOptions', body=[Expr(value=Constant(value='Configuration for DuckDB query execution helpers.', lineno=38, col_offset=4, end_lineno=38, end_col_offset=59), lineno=38, col_offset=4, end_lineno=38, end_col_offset=59), AnnAssign(target=Name(id='timeout_s', ctx=Store(), lineno=40, col_offset=4, end_lineno=40, end_col_offset=13), annotation=Name(id='float', ctx=Load(), lineno=40, col_offset=15, end_lineno=40, end_col_offset=20), value=Name(id='DEFAULT_TIMEOUT_S', ctx=Load(), lineno=40, col_offset=23, end_lineno=40, end_col_offset=40), simple=1, lineno=40, col_offset=4, end_lineno=40, end_col_offset=40), AnnAssign(target=Name(id='slow_query_threshold_s', ctx=Store(), lineno=41, col_offset=4, end_lineno=41, end_col_offset=26), annotation=Name(id='float', ctx=Load(), lineno=41, col_offset=28, end_lineno=41, end_col_offset=33), value=Name(id='DEFAULT_SLOW_QUERY_THRESHOLD_S', ctx=Load(), lineno=41, col_offset=36, end_lineno=41, end_col_offset=66), simple=1, lineno=41, col_offset=4, end_lineno=41, end_col_offset=66), AnnAssign(target=Name(id='operation', ctx=Store(), lineno=42, col_offset=4, end_lineno=42, end_col_offset=13), annotation=Name(id='str', ctx=Load(), lineno=42, col_offset=15, end_lineno=42, end_col_offset=18), value=Constant(value='duckdb.execute', lineno=42, col_offset=21, end_lineno=42, end_col_offset=37), simple=1, lineno=42, col_offset=4, end_lineno=42, end_col_offset=37), AnnAssign(target=Name(id='require_parameterized', ctx=Store(), lineno=43, col_offset=4, end_lineno=43, end_col_offset=25), annotation=BinOp(left=Name(id='bool', ctx=Load(), lineno=43, col_offset=27, end_lineno=43, end_col_offset=31), op=BitOr(), right=Constant(value=None, lineno=43, col_offset=34, end_lineno=43, end_col_offset=38), lineno=43, col_offset=27, end_lineno=43, end_col_offset=38), value=Constant(value=None, lineno=43, col_offset=41, end_lineno=43, end_col_offset=45), simple=1, lineno=43, col_offset=4, end_lineno=43, end_col_offset=45)], decorator_list=[Call(func=Name(id='dataclass', ctx=Load(), lineno=35, col_offset=1, end_lineno=35, end_col_offset=10), keywords=[keyword(arg='slots', value=Constant(value=True, lineno=35, col_offset=17, end_lineno=35, end_col_offset=21), lineno=35, col_offset=11, end_lineno=35, end_col_offset=21), keyword(arg='frozen', value=Constant(value=True, lineno=35, col_offset=30, end_lineno=35, end_col_offset=34), lineno=35, col_offset=23, end_lineno=35, end_col_offset=34)], lineno=35, col_offset=1, end_lineno=35, end_col_offset=35)], lineno=37, col_offset=0, end_lineno=43, end_col_offset=45), Assign(targets=[Name(id='__all__', ctx=Store(), lineno=46, col_offset=0, end_lineno=46, end_col_offset=7)], value=List(elts=[Constant(value='DEFAULT_SLOW_QUERY_THRESHOLD_S', lineno=47, col_offset=4, end_lineno=47, end_col_offset=36), Constant(value='DEFAULT_TIMEOUT_S', lineno=48, col_offset=4, end_lineno=48, end_col_offset=23), Constant(value='DuckDBQueryOptions', lineno=49, col_offset=4, end_lineno=49, end_col_offset=24), Constant(value='connect', lineno=50, col_offset=4, end_lineno=50, end_col_offset=13), Constant(value='execute', lineno=51, col_offset=4, end_lineno=51, end_col_offset=13), Constant(value='fetch_all', lineno=52, col_offset=4, end_lineno=52, end_col_offset=15), Constant(value='fetch_one', lineno=53, col_offset=4, end_lineno=53, end_col_offset=15), Constant(value='validate_identifier', lineno=54, col_offset=4, end_lineno=54, end_col_offset=25)], ctx=Load(), lineno=46, col_offset=10, end_lineno=55, end_col_offset=1), lineno=46, col_offset=0, end_lineno=55, end_col_offset=1), Assign(targets=[Name(id='__navmap__', ctx=Store(), lineno=56, col_offset=0, end_lineno=56, end_col_offset=10)], value=Call(func=Name(id='load_nav_metadata', ctx=Load(), lineno=56, col_offset=13, end_lineno=56, end_col_offset=30), args=[Name(id='__name__', ctx=Load(), lineno=56, col_offset=31, end_lineno=56, end_col_offset=39), Call(func=Name(id='tuple', ctx=Load(), lineno=56, col_offset=41, end_lineno=56, end_col_offset=46), args=[Name(id='__all__', ctx=Load(), lineno=56, col_offset=47, end_lineno=56, end_col_offset=54)], lineno=56, col_offset=41, end_lineno=56, end_col_offset=55)], lineno=56, col_offset=13, end_lineno=56, end_col_offset=56), lineno=56, col_offset=0, end_lineno=56, end_col_offset=56), Assign(targets=[Name(id='logger', ctx=Store(), lineno=58, col_offset=0, end_lineno=58, end_col_offset=6)], value=Call(func=Name(id='get_logger', ctx=Load(), lineno=58, col_offset=9, end_lineno=58, end_col_offset=19), args=[Name(id='__name__', ctx=Load(), lineno=58, col_offset=20, end_lineno=58, end_col_offset=28)], lineno=58, col_offset=9, end_lineno=58, end_col_offset=29), lineno=58, col_offset=0, end_lineno=58, end_col_offset=29), Assign(targets=[Name(id='metrics', ctx=Store(), lineno=59, col_offset=0, end_lineno=59, end_col_offset=7)], value=Call(func=Attribute(value=Name(id='MetricsProvider', ctx=Load(), lineno=59, col_offset=10, end_lineno=59, end_col_offset=25), attr='default', ctx=Load(), lineno=59, col_offset=10, end_lineno=59, end_col_offset=33), lineno=59, col_offset=10, end_lineno=59, end_col_offset=35), lineno=59, col_offset=0, end_lineno=59, end_col_offset=35), FunctionDef(name='connect', args=arguments(args=[arg(arg='db_path', annotation=BinOp(left=Name(id='Path', ctx=Load(), lineno=64, col_offset=13, end_lineno=64, end_col_offset=17), op=BitOr(), right=Name(id='str', ctx=Load(), lineno=64, col_offset=20, end_lineno=64, end_col_offset=23), lineno=64, col_offset=13, end_lineno=64, end_col_offset=23), lineno=64, col_offset=4, end_lineno=64, end_col_offset=23)], kwonlyargs=[arg(arg='read_only', annotation=Name(id='bool', ctx=Load(), lineno=66, col_offset=15, end_lineno=66, end_col_offset=19), lineno=66, col_offset=4, end_lineno=66, end_col_offset=19), arg(arg='pragmas', annotation=BinOp(left=Subscript(value=Name(id='Mapping', ctx=Load(), lineno=67, col_offset=13, end_lineno=67, end_col_offset=20), slice=Tuple(elts=[Name(id='str', ctx=Load(), lineno=67, col_offset=21, end_lineno=67, end_col_offset=24), Name(id='object', ctx=Load(), lineno=67, col_offset=26, end_lineno=67, end_col_offset=32)], ctx=Load(), lineno=67, col_offset=21, end_lineno=67, end_col_offset=32), ctx=Load(), lineno=67, col_offset=13, end_lineno=67, end_col_offset=33), op=BitOr(), right=Constant(value=None, lineno=67, col_offset=36, end_lineno=67, end_col_offset=40), lineno=67, col_offset=13, end_lineno=67, end_col_offset=40), lineno=67, col_offset=4, end_lineno=67, end_col_offset=40)], kw_defaults=[Constant(value=False, lineno=66, col_offset=22, end_lineno=66, end_col_offset=27), Constant(value=None, lineno=67, col_offset=43, end_lineno=67, end_col_offset=47)]), body=[Expr(value=Constant(value='Create a DuckDB connection with standard pragmas applied.\n\n    Parameters\n    ----------\n    db_path : Path | str\n        Path to DuckDB database file.\n    read_only : bool, optional\n        Whether to open in read-only mode. Defaults to False.\n    pragmas : Mapping[str, object] | None, optional\n        Additional pragma settings.\n\n    Returns\n    -------\n    DuckDBPyConnection\n        Configured DuckDB connection.\n    ', lineno=69, col_offset=4, end_lineno=84, end_col_offset=7), lineno=69, col_offset=4, end_lineno=84, end_col_offset=7), Assign(targets=[Name(id='database_path', ctx=Store(), lineno=85, col_offset=4, end_lineno=85, end_col_offset=17)], value=Call(func=Name(id='Path', ctx=Load(), lineno=85, col_offset=20, end_lineno=85, end_col_offset=24), args=[Name(id='db_path', ctx=Load(), lineno=85, col_offset=25, end_lineno=85, end_col_offset=32)], lineno=85, col_offset=20, end_lineno=85, end_col_offset=33), lineno=85, col_offset=4, end_lineno=85, end_col_offset=33), If(test=UnaryOp(op=Not(), operand=Name(id='read_only', ctx=Load(), lineno=86, col_offset=11, end_lineno=86, end_col_offset=20), lineno=86, col_offset=7, end_lineno=86, end_col_offset=20), body=[Expr(value=Call(func=Attribute(value=Attribute(value=Name(id='database_path', ctx=Load(), lineno=87, col_offset=8, end_lineno=87, end_col_offset=21), attr='parent', ctx=Load(), lineno=87, col_offset=8, end_lineno=87, end_col_offset=28), attr='mkdir', ctx=Load(), lineno=87, col_offset=8, end_lineno=87, end_col_offset=34), keywords=[keyword(arg='parents', value=Constant(value=True, lineno=87, col_offset=43, end_lineno=87, end_col_offset=47), lineno=87, col_offset=35, end_lineno=87, end_col_offset=47), keyword(arg='exist_ok', value=Constant(value=True, lineno=87, col_offset=58, end_lineno=87, end_col_offset=62), lineno=87, col_offset=49, end_lineno=87, end_col_offset=62)], lineno=87, col_offset=8, end_lineno=87, end_col_offset=63), lineno=87, col_offset=8, end_lineno=87, end_col_offset=63)], lineno=86, col_offset=4, end_lineno=87, end_col_offset=63), Assign(targets=[Name(id='conn', ctx=Store(), lineno=88, col_offset=4, end_lineno=88, end_col_offset=8)], value=Call(func=Attribute(value=Name(id='duckdb', ctx=Load(), lineno=88, col_offset=11, end_lineno=88, end_col_offset=17), attr='connect', ctx=Load(), lineno=88, col_offset=11, end_lineno=88, end_col_offset=25), args=[Call(func=Name(id='str', ctx=Load(), lineno=88, col_offset=26, end_lineno=88, end_col_offset=29), args=[Name(id='database_path', ctx=Load(), lineno=88, col_offset=30, end_lineno=88, end_col_offset=43)], lineno=88, col_offset=26, end_lineno=88, end_col_offset=44)], keywords=[keyword(arg='read_only', value=Name(id='read_only', ctx=Load(), lineno=88, col_offset=56, end_lineno=88, end_col_offset=65), lineno=88, col_offset=46, end_lineno=88, end_col_offset=65)], lineno=88, col_offset=11, end_lineno=88, end_col_offset=66), lineno=88, col_offset=4, end_lineno=88, end_col_offset=66), AnnAssign(target=Name(id='effective_pragmas', ctx=Store(), lineno=89, col_offset=4, end_lineno=89, end_col_offset=21), annotation=Subscript(value=Name(id='dict', ctx=Load(), lineno=89, col_offset=23, end_lineno=89, end_col_offset=27), slice=Tuple(elts=[Name(id='str', ctx=Load(), lineno=89, col_offset=28, end_lineno=89, end_col_offset=31), Name(id='object', ctx=Load(), lineno=89, col_offset=33, end_lineno=89, end_col_offset=39)], ctx=Load(), lineno=89, col_offset=28, end_lineno=89, end_col_offset=39), ctx=Load(), lineno=89, col_offset=23, end_lineno=89, end_col_offset=40), value=Dict(keys=[Constant(value='threads', lineno=89, col_offset=44, end_lineno=89, end_col_offset=53)], values=[Name(id='DEFAULT_THREADS', ctx=Load(), lineno=89, col_offset=55, end_lineno=89, end_col_offset=70)], lineno=89, col_offset=43, end_lineno=89, end_col_offset=71), simple=1, lineno=89, col_offset=4, end_lineno=89, end_col_offset=71), If(test=Name(id='pragmas', ctx=Load(), lineno=90, col_offset=7, end_lineno=90, end_col_offset=14), body=[Expr(value=Call(func=Attribute(value=Name(id='effective_pragmas', ctx=Load(), lineno=91, col_offset=8, end_lineno=91, end_col_offset=25), attr='update', ctx=Load(), lineno=91, col_offset=8, end_lineno=91, end_col_offset=32), args=[DictComp(key=Call(func=Attribute(value=Name(id='key', ctx=Load(), lineno=91, col_offset=34, end_lineno=91, end_col_offset=37), attr='lower', ctx=Load(), lineno=91, col_offset=34, end_lineno=91, end_col_offset=43), lineno=91, col_offset=34, end_lineno=91, end_col_offset=45), value=Name(id='value', ctx=Load(), lineno=91, col_offset=47, end_lineno=91, end_col_offset=52), generators=[comprehension(target=Tuple(elts=[Name(id='key', ctx=Store(), lineno=91, col_offset=57, end_lineno=91, end_col_offset=60), Name(id='value', ctx=Store(), lineno=91, col_offset=62, end_lineno=91, end_col_offset=67)], ctx=Store(), lineno=91, col_offset=57, end_lineno=91, end_col_offset=67), iter=Call(func=Attribute(value=Name(id='pragmas', ctx=Load(), lineno=91, col_offset=71, end_lineno=91, end_col_offset=78), attr='items', ctx=Load(), lineno=91, col_offset=71, end_lineno=91, end_col_offset=84), lineno=91, col_offset=71, end_lineno=91, end_col_offset=86), is_async=0)], lineno=91, col_offset=33, end_lineno=91, end_col_offset=87)], lineno=91, col_offset=8, end_lineno=91, end_col_offset=88), lineno=91, col_offset=8, end_lineno=91, end_col_offset=88)], lineno=90, col_offset=4, end_lineno=91, end_col_offset=88), For(target=Tuple(elts=[Name(id='pragma_key', ctx=Store(), lineno=92, col_offset=8, end_lineno=92, end_col_offset=18), Name(id='value', ctx=Store(), lineno=92, col_offset=20, end_lineno=92, end_col_offset=25)], ctx=Store(), lineno=92, col_offset=8, end_lineno=92, end_col_offset=25), iter=Call(func=Attribute(value=Name(id='effective_pragmas', ctx=Load(), lineno=92, col_offset=29, end_lineno=92, end_col_offset=46), attr='items', ctx=Load(), lineno=92, col_offset=29, end_lineno=92, end_col_offset=52), lineno=92, col_offset=29, end_lineno=92, end_col_offset=54), body=[If(test=Call(func=Name(id='isinstance', ctx=Load(), lineno=93, col_offset=11, end_lineno=93, end_col_offset=21), args=[Name(id='value', ctx=Load(), lineno=93, col_offset=22, end_lineno=93, end_col_offset=27), Name(id='bool', ctx=Load(), lineno=93, col_offset=29, end_lineno=93, end_col_offset=33)], lineno=93, col_offset=11, end_lineno=93, end_col_offset=34), body=[Assign(targets=[Name(id='literal', ctx=Store(), lineno=94, col_offset=12, end_lineno=94, end_col_offset=19)], value=IfExp(test=Name(id='value', ctx=Load(), lineno=94, col_offset=32, end_lineno=94, end_col_offset=37), body=Constant(value='true', lineno=94, col_offset=22, end_lineno=94, end_col_offset=28), orelse=Constant(value='false', lineno=94, col_offset=43, end_lineno=94, end_col_offset=50), lineno=94, col_offset=22, end_lineno=94, end_col_offset=50), lineno=94, col_offset=12, end_lineno=94, end_col_offset=50)], orelse=[If(test=Call(func=Name(id='isinstance', ctx=Load(), lineno=95, col_offset=13, end_lineno=95, end_col_offset=23), args=[Name(id='value', ctx=Load(), lineno=95, col_offset=24, end_lineno=95, end_col_offset=29), Tuple(elts=[Name(id='int', ctx=Load(), lineno=95, col_offset=32, end_lineno=95, end_col_offset=35), Name(id='float', ctx=Load(), lineno=95, col_offset=37, end_lineno=95, end_col_offset=42)], ctx=Load(), lineno=95, col_offset=31, end_lineno=95, end_col_offset=43)], lineno=95, col_offset=13, end_lineno=95, end_col_offset=44), body=[Assign(targets=[Name(id='literal', ctx=Store(), lineno=96, col_offset=12, end_lineno=96, end_col_offset=19)], value=Call(func=Name(id='str', ctx=Load(), lineno=96, col_offset=22, end_lineno=96, end_col_offset=25), args=[Name(id='value', ctx=Load(), lineno=96, col_offset=26, end_lineno=96, end_col_offset=31)], lineno=96, col_offset=22, end_lineno=96, end_col_offset=32), lineno=96, col_offset=12, end_lineno=96, end_col_offset=32)], orelse=[Assign(targets=[Name(id='literal', ctx=Store(), lineno=98, col_offset=12, end_lineno=98, end_col_offset=19)], value=JoinedStr(values=[Constant(value="'", lineno=98, col_offset=24, end_lineno=98, end_col_offset=25), FormattedValue(value=Name(id='value', ctx=Load(), lineno=98, col_offset=26, end_lineno=98, end_col_offset=31), conversion=-1, lineno=98, col_offset=25, end_lineno=98, end_col_offset=32), Constant(value="'", lineno=98, col_offset=32, end_lineno=98, end_col_offset=33)], lineno=98, col_offset=22, end_lineno=98, end_col_offset=34), lineno=98, col_offset=12, end_lineno=98, end_col_offset=34)], lineno=95, col_offset=8, end_lineno=98, end_col_offset=34)], lineno=93, col_offset=8, end_lineno=98, end_col_offset=34), Expr(value=Call(func=Attribute(value=Name(id='conn', ctx=Load(), lineno=99, col_offset=8, end_lineno=99, end_col_offset=12), attr='execute', ctx=Load(), lineno=99, col_offset=8, end_lineno=99, end_col_offset=20), args=[JoinedStr(values=[Constant(value='PRAGMA ', lineno=99, col_offset=23, end_lineno=99, end_col_offset=30), FormattedValue(value=Name(id='pragma_key', ctx=Load(), lineno=99, col_offset=31, end_lineno=99, end_col_offset=41), conversion=-1, lineno=99, col_offset=30, end_lineno=99, end_col_offset=42), Constant(value='=', lineno=99, col_offset=42, end_lineno=99, end_col_offset=43), FormattedValue(value=Name(id='literal', ctx=Load(), lineno=99, col_offset=44, end_lineno=99, end_col_offset=51), conversion=-1, lineno=99, col_offset=43, end_lineno=99, end_col_offset=52)], lineno=99, col_offset=21, end_lineno=99, end_col_offset=53)], lineno=99, col_offset=8, end_lineno=99, end_col_offset=54), lineno=99, col_offset=8, end_lineno=99, end_col_offset=54)], lineno=92, col_offset=4, end_lineno=99, end_col_offset=54), Return(value=Name(id='conn', ctx=Load(), lineno=100, col_offset=11, end_lineno=100, end_col_offset=15), lineno=100, col_offset=4, end_lineno=100, end_col_offset=15)], returns=Name(id='DuckDBPyConnection', ctx=Load(), lineno=68, col_offset=5, end_lineno=68, end_col_offset=23), lineno=63, col_offset=0, end_lineno=100, end_col_offset=15), FunctionDef(name='_format_sql', args=arguments(args=[arg(arg='sql', annotation=Name(id='str', ctx=Load(), lineno=103, col_offset=21, end_lineno=103, end_col_offset=24), lineno=103, col_offset=16, end_lineno=103, end_col_offset=24)]), body=[Expr(value=Constant(value='Format SQL query for logging preview.\n\n    Compacts whitespace and truncates long SQL queries to MAX_SQL_PREVIEW_CHARS\n    for safe logging. Used internally to prevent logging sensitive data or\n    overwhelming logs with very long queries.\n\n    Parameters\n    ----------\n    sql : str\n        SQL query string to format.\n\n    Returns\n    -------\n    str\n        Compacted SQL string, truncated with ellipsis if longer than\n        MAX_SQL_PREVIEW_CHARS.\n    ', lineno=104, col_offset=4, end_lineno=120, end_col_offset=7), lineno=104, col_offset=4, end_lineno=120, end_col_offset=7), Assign(targets=[Name(id='compact', ctx=Store(), lineno=121, col_offset=4, end_lineno=121, end_col_offset=11)], value=Call(func=Attribute(value=Constant(value=' ', lineno=121, col_offset=14, end_lineno=121, end_col_offset=17), attr='join', ctx=Load(), lineno=121, col_offset=14, end_lineno=121, end_col_offset=22), args=[Call(func=Attribute(value=Name(id='sql', ctx=Load(), lineno=121, col_offset=23, end_lineno=121, end_col_offset=26), attr='split', ctx=Load(), lineno=121, col_offset=23, end_lineno=121, end_col_offset=32), lineno=121, col_offset=23, end_lineno=121, end_col_offset=34)], lineno=121, col_offset=14, end_lineno=121, end_col_offset=35), lineno=121, col_offset=4, end_lineno=121, end_col_offset=35), If(test=Compare(left=Call(func=Name(id='len', ctx=Load(), lineno=122, col_offset=7, end_lineno=122, end_col_offset=10), args=[Name(id='compact', ctx=Load(), lineno=122, col_offset=11, end_lineno=122, end_col_offset=18)], lineno=122, col_offset=7, end_lineno=122, end_col_offset=19), ops=[LtE()], comparators=[Name(id='MAX_SQL_PREVIEW_CHARS', ctx=Load(), lineno=122, col_offset=23, end_lineno=122, end_col_offset=44)], lineno=122, col_offset=7, end_lineno=122, end_col_offset=44), body=[Return(value=Name(id='compact', ctx=Load(), lineno=123, col_offset=15, end_lineno=123, end_col_offset=22), lineno=123, col_offset=8, end_lineno=123, end_col_offset=22)], lineno=122, col_offset=4, end_lineno=123, end_col_offset=22), Return(value=JoinedStr(values=[FormattedValue(value=Subscript(value=Name(id='compact', ctx=Load(), lineno=124, col_offset=14, end_lineno=124, end_col_offset=21), slice=Slice(upper=Name(id='MAX_SQL_PREVIEW_CHARS', ctx=Load(), lineno=124, col_offset=23, end_lineno=124, end_col_offset=44), lineno=124, col_offset=22, end_lineno=124, end_col_offset=44), ctx=Load(), lineno=124, col_offset=14, end_lineno=124, end_col_offset=45), conversion=-1, lineno=124, col_offset=13, end_lineno=124, end_col_offset=46), Constant(value='…', lineno=124, col_offset=46, end_lineno=124, end_col_offset=49)], lineno=124, col_offset=11, end_lineno=124, end_col_offset=50), lineno=124, col_offset=4, end_lineno=124, end_col_offset=50)], returns=Name(id='str', ctx=Load(), lineno=103, col_offset=29, end_lineno=103, end_col_offset=32), lineno=103, col_offset=0, end_lineno=124, end_col_offset=50), FunctionDef(name='_truncate_value', args=arguments(args=[arg(arg='value', annotation=Name(id='object', ctx=Load(), lineno=127, col_offset=27, end_lineno=127, end_col_offset=33), lineno=127, col_offset=20, end_lineno=127, end_col_offset=33)]), body=[Expr(value=Constant(value='Truncate string values for logging preview.\n\n    Truncates string values longer than MAX_SQL_PREVIEW_CHARS to prevent\n    logging sensitive data or overwhelming logs. Other types are returned\n    unchanged.\n\n    Parameters\n    ----------\n    value : object\n        Value to truncate (if string).\n\n    Returns\n    -------\n    object\n        Truncated string with ellipsis if longer than MAX_SQL_PREVIEW_CHARS,\n        or original value if not a string.\n    ', lineno=128, col_offset=4, end_lineno=144, end_col_offset=7), lineno=128, col_offset=4, end_lineno=144, end_col_offset=7), If(test=BoolOp(op=And(), values=[Call(func=Name(id='isinstance', ctx=Load(), lineno=145, col_offset=7, end_lineno=145, end_col_offset=17), args=[Name(id='value', ctx=Load(), lineno=145, col_offset=18, end_lineno=145, end_col_offset=23), Name(id='str', ctx=Load(), lineno=145, col_offset=25, end_lineno=145, end_col_offset=28)], lineno=145, col_offset=7, end_lineno=145, end_col_offset=29), Compare(left=Call(func=Name(id='len', ctx=Load(), lineno=145, col_offset=34, end_lineno=145, end_col_offset=37), args=[Name(id='value', ctx=Load(), lineno=145, col_offset=38, end_lineno=145, end_col_offset=43)], lineno=145, col_offset=34, end_lineno=145, end_col_offset=44), ops=[Gt()], comparators=[Name(id='MAX_SQL_PREVIEW_CHARS', ctx=Load(), lineno=145, col_offset=47, end_lineno=145, end_col_offset=68)], lineno=145, col_offset=34, end_lineno=145, end_col_offset=68)], lineno=145, col_offset=7, end_lineno=145, end_col_offset=68), body=[Return(value=BinOp(left=Subscript(value=Name(id='value', ctx=Load(), lineno=146, col_offset=15, end_lineno=146, end_col_offset=20), slice=Slice(upper=Name(id='MAX_SQL_PREVIEW_CHARS', ctx=Load(), lineno=146, col_offset=22, end_lineno=146, end_col_offset=43), lineno=146, col_offset=21, end_lineno=146, end_col_offset=43), ctx=Load(), lineno=146, col_offset=15, end_lineno=146, end_col_offset=44), op=Add(), right=Constant(value='…', lineno=146, col_offset=47, end_lineno=146, end_col_offset=52), lineno=146, col_offset=15, end_lineno=146, end_col_offset=52), lineno=146, col_offset=8, end_lineno=146, end_col_offset=52)], lineno=145, col_offset=4, end_lineno=146, end_col_offset=52), Return(value=Name(id='value', ctx=Load(), lineno=147, col_offset=11, end_lineno=147, end_col_offset=16), lineno=147, col_offset=4, end_lineno=147, end_col_offset=16)], returns=Name(id='object', ctx=Load(), lineno=127, col_offset=38, end_lineno=127, end_col_offset=44), lineno=127, col_offset=0, end_lineno=147, end_col_offset=16), FunctionDef(name='_format_params', args=arguments(args=[arg(arg='params', annotation=Name(id='Params', ctx=Load(), lineno=150, col_offset=27, end_lineno=150, end_col_offset=33), lineno=150, col_offset=19, end_lineno=150, end_col_offset=33)]), body=[Expr(value=Constant(value='Format query parameters for logging preview.\n\n    Formats query parameters for safe logging by truncating string values.\n    Returns a dict for named parameters or a list for positional parameters.\n\n    Parameters\n    ----------\n    params : Params\n        Query parameters (Sequence for positional, Mapping for named, or None).\n\n    Returns\n    -------\n    object\n        Formatted parameters: dict for named params, list for positional params,\n        or empty dict if params is None.\n    ', lineno=151, col_offset=4, end_lineno=166, end_col_offset=7), lineno=151, col_offset=4, end_lineno=166, end_col_offset=7), If(test=Compare(left=Name(id='params', ctx=Load(), lineno=167, col_offset=7, end_lineno=167, end_col_offset=13), ops=[Is()], comparators=[Constant(value=None, lineno=167, col_offset=17, end_lineno=167, end_col_offset=21)], lineno=167, col_offset=7, end_lineno=167, end_col_offset=21), body=[Return(value=Dict(lineno=168, col_offset=15, end_lineno=168, end_col_offset=17), lineno=168, col_offset=8, end_lineno=168, end_col_offset=17)], lineno=167, col_offset=4, end_lineno=168, end_col_offset=17), If(test=Call(func=Name(id='isinstance', ctx=Load(), lineno=169, col_offset=7, end_lineno=169, end_col_offset=17), args=[Name(id='params', ctx=Load(), lineno=169, col_offset=18, end_lineno=169, end_col_offset=24), Name(id='Mapping', ctx=Load(), lineno=169, col_offset=26, end_lineno=169, end_col_offset=33)], lineno=169, col_offset=7, end_lineno=169, end_col_offset=34), body=[Return(value=DictComp(key=Call(func=Name(id='str', ctx=Load(), lineno=170, col_offset=16, end_lineno=170, end_col_offset=19), args=[Name(id='key', ctx=Load(), lineno=170, col_offset=20, end_lineno=170, end_col_offset=23)], lineno=170, col_offset=16, end_lineno=170, end_col_offset=24), value=Call(func=Name(id='_truncate_value', ctx=Load(), lineno=170, col_offset=26, end_lineno=170, end_col_offset=41), args=[Name(id='value', ctx=Load(), lineno=170, col_offset=42, end_lineno=170, end_col_offset=47)], lineno=170, col_offset=26, end_lineno=170, end_col_offset=48), generators=[comprehension(target=Tuple(elts=[Name(id='key', ctx=Store(), lineno=170, col_offset=53, end_lineno=170, end_col_offset=56), Name(id='value', ctx=Store(), lineno=170, col_offset=58, end_lineno=170, end_col_offset=63)], ctx=Store(), lineno=170, col_offset=53, end_lineno=170, end_col_offset=63), iter=Call(func=Attribute(value=Name(id='params', ctx=Load(), lineno=170, col_offset=67, end_lineno=170, end_col_offset=73), attr='items', ctx=Load(), lineno=170, col_offset=67, end_lineno=170, end_col_offset=79), lineno=170, col_offset=67, end_lineno=170, end_col_offset=81), is_async=0)], lineno=170, col_offset=15, end_lineno=170, end_col_offset=82), lineno=170, col_offset=8, end_lineno=170, end_col_offset=82)], lineno=169, col_offset=4, end_lineno=170, end_col_offset=82), Return(value=ListComp(elt=Call(func=Name(id='_truncate_value', ctx=Load(), lineno=171, col_offset=12, end_lineno=171, end_col_offset=27), args=[Name(id='value', ctx=Load(), lineno=171, col_offset=28, end_lineno=171, end_col_offset=33)], lineno=171, col_offset=12, end_lineno=171, end_col_offset=34), generators=[comprehension(target=Name(id='value', ctx=Store(), lineno=171, col_offset=39, end_lineno=171, end_col_offset=44), iter=Name(id='params', ctx=Load(), lineno=171, col_offset=48, end_lineno=171, end_col_offset=54), is_async=0)], lineno=171, col_offset=11, end_lineno=171, end_col_offset=55), lineno=171, col_offset=4, end_lineno=171, end_col_offset=55)], returns=Name(id='object', ctx=Load(), lineno=150, col_offset=38, end_lineno=150, end_col_offset=44), lineno=150, col_offset=0, end_lineno=171, end_col_offset=55), FunctionDef(name='_ensure_parameterized', args=arguments(args=[arg(arg='sql', annotation=Name(id='str', ctx=Load(), lineno=174, col_offset=31, end_lineno=174, end_col_offset=34), lineno=174, col_offset=26, end_lineno=174, end_col_offset=34)], kwonlyargs=[arg(arg='require_parameterized', annotation=Name(id='bool', ctx=Load(), lineno=174, col_offset=62, end_lineno=174, end_col_offset=66), lineno=174, col_offset=39, end_lineno=174, end_col_offset=66)], kw_defaults=[None]), body=[Expr(value=Constant(value='Ensure SQL query uses parameterized placeholders.\n\n    Validates that SQL queries use parameterized placeholders (?, :name, or $n)\n    when required. Raises RegistryError if parameterization is required but\n    missing, preventing SQL injection vulnerabilities.\n\n    Parameters\n    ----------\n    sql : str\n        SQL query string to validate.\n    require_parameterized : bool\n        Whether to require parameterization. If True, query must contain\n        parameter placeholders (?, :name, or $n).\n\n    Raises\n    ------\n    RegistryError\n        If require_parameterized is True but query contains no parameter\n        placeholders.\n    ', lineno=175, col_offset=4, end_lineno=194, end_col_offset=7), lineno=175, col_offset=4, end_lineno=194, end_col_offset=7), If(test=UnaryOp(op=Not(), operand=Name(id='require_parameterized', ctx=Load(), lineno=195, col_offset=11, end_lineno=195, end_col_offset=32), lineno=195, col_offset=7, end_lineno=195, end_col_offset=32), body=[Return(lineno=196, col_offset=8, end_lineno=196, end_col_offset=14)], lineno=195, col_offset=4, end_lineno=196, end_col_offset=14), If(test=BoolOp(op=Or(), values=[Compare(left=Constant(value='?', lineno=197, col_offset=7, end_lineno=197, end_col_offset=10), ops=[In()], comparators=[Name(id='sql', ctx=Load(), lineno=197, col_offset=14, end_lineno=197, end_col_offset=17)], lineno=197, col_offset=7, end_lineno=197, end_col_offset=17), Compare(left=Constant(value=':', lineno=197, col_offset=21, end_lineno=197, end_col_offset=24), ops=[In()], comparators=[Name(id='sql', ctx=Load(), lineno=197, col_offset=28, end_lineno=197, end_col_offset=31)], lineno=197, col_offset=21, end_lineno=197, end_col_offset=31), Compare(left=Constant(value='$', lineno=197, col_offset=35, end_lineno=197, end_col_offset=38), ops=[In()], comparators=[Name(id='sql', ctx=Load(), lineno=197, col_offset=42, end_lineno=197, end_col_offset=45)], lineno=197, col_offset=35, end_lineno=197, end_col_offset=45)], lineno=197, col_offset=7, end_lineno=197, end_col_offset=45), body=[Return(lineno=198, col_offset=8, end_lineno=198, end_col_offset=14)], lineno=197, col_offset=4, end_lineno=198, end_col_offset=14), Assign(targets=[Name(id='error_message', ctx=Store(), lineno=199, col_offset=4, end_lineno=199, end_col_offset=17)], value=Constant(value='DuckDB query must be parameterized', lineno=199, col_offset=20, end_lineno=199, end_col_offset=56), lineno=199, col_offset=4, end_lineno=199, end_col_offset=56), Raise(exc=Call(func=Name(id='RegistryError', ctx=Load(), lineno=200, col_offset=10, end_lineno=200, end_col_offset=23), args=[Name(id='error_message', ctx=Load(), lineno=201, col_offset=8, end_lineno=201, end_col_offset=21)], keywords=[keyword(arg='context', value=Dict(keys=[Constant(value='sql_preview', lineno=202, col_offset=17, end_lineno=202, end_col_offset=30)], values=[Call(func=Name(id='_format_sql', ctx=Load(), lineno=202, col_offset=32, end_lineno=202, end_col_offset=43), args=[Name(id='sql', ctx=Load(), lineno=202, col_offset=44, end_lineno=202, end_col_offset=47)], lineno=202, col_offset=32, end_lineno=202, end_col_offset=48)], lineno=202, col_offset=16, end_lineno=202, end_col_offset=49), lineno=202, col_offset=8, end_lineno=202, end_col_offset=49)], lineno=200, col_offset=10, end_lineno=203, end_col_offset=5), lineno=200, col_offset=4, end_lineno=203, end_col_offset=5)], returns=Constant(value=None, lineno=174, col_offset=71, end_lineno=174, end_col_offset=75), lineno=174, col_offset=0, end_lineno=203, end_col_offset=5), FunctionDef(name='_set_timeout', args=arguments(args=[arg(arg='conn', annotation=Name(id='DuckDBPyConnection', ctx=Load(), lineno=206, col_offset=23, end_lineno=206, end_col_offset=41), lineno=206, col_offset=17, end_lineno=206, end_col_offset=41), arg(arg='timeout_s', annotation=Name(id='float', ctx=Load(), lineno=206, col_offset=54, end_lineno=206, end_col_offset=59), lineno=206, col_offset=43, end_lineno=206, end_col_offset=59)]), body=[Expr(value=Constant(value='Set statement timeout for DuckDB connection.\n\n    Configures the statement_timeout pragma on the connection to limit query\n    execution time. Timeout is set in milliseconds. If timeout_s is <= 0,\n    no timeout is set.\n\n    Parameters\n    ----------\n    conn : DuckDBPyConnection\n        DuckDB connection to configure.\n    timeout_s : float\n        Timeout in seconds. Must be positive to set a timeout.\n    ', lineno=207, col_offset=4, end_lineno=219, end_col_offset=7), lineno=207, col_offset=4, end_lineno=219, end_col_offset=7), If(test=Compare(left=Name(id='timeout_s', ctx=Load(), lineno=220, col_offset=7, end_lineno=220, end_col_offset=16), ops=[LtE()], comparators=[Constant(value=0, lineno=220, col_offset=20, end_lineno=220, end_col_offset=21)], lineno=220, col_offset=7, end_lineno=220, end_col_offset=21), body=[Return(lineno=221, col_offset=8, end_lineno=221, end_col_offset=14)], lineno=220, col_offset=4, end_lineno=221, end_col_offset=14), Assign(targets=[Name(id='timeout_ms', ctx=Store(), lineno=222, col_offset=4, end_lineno=222, end_col_offset=14)], value=Call(func=Name(id='int', ctx=Load(), lineno=222, col_offset=17, end_lineno=222, end_col_offset=20), args=[BinOp(left=Name(id='timeout_s', ctx=Load(), lineno=222, col_offset=21, end_lineno=222, end_col_offset=30), op=Mult(), right=Constant(value=1000, lineno=222, col_offset=33, end_lineno=222, end_col_offset=37), lineno=222, col_offset=21, end_lineno=222, end_col_offset=37)], lineno=222, col_offset=17, end_lineno=222, end_col_offset=38), lineno=222, col_offset=4, end_lineno=222, end_col_offset=38), Expr(value=Call(func=Attribute(value=Name(id='conn', ctx=Load(), lineno=223, col_offset=4, end_lineno=223, end_col_offset=8), attr='execute', ctx=Load(), lineno=223, col_offset=4, end_lineno=223, end_col_offset=16), args=[JoinedStr(values=[Constant(value="PRAGMA statement_timeout='", lineno=223, col_offset=19, end_lineno=223, end_col_offset=45), FormattedValue(value=Name(id='timeout_ms', ctx=Load(), lineno=223, col_offset=46, end_lineno=223, end_col_offset=56), conversion=-1, lineno=223, col_offset=45, end_lineno=223, end_col_offset=57), Constant(value="ms'", lineno=223, col_offset=57, end_lineno=223, end_col_offset=60)], lineno=223, col_offset=17, end_lineno=223, end_col_offset=61)], lineno=223, col_offset=4, end_lineno=223, end_col_offset=62), lineno=223, col_offset=4, end_lineno=223, end_col_offset=62)], returns=Constant(value=None, lineno=206, col_offset=64, end_lineno=206, end_col_offset=68), lineno=206, col_offset=0, end_lineno=223, end_col_offset=62), FunctionDef(name='_coerce_options', args=arguments(args=[arg(arg='options', annotation=BinOp(left=Name(id='DuckDBQueryOptions', ctx=Load(), lineno=227, col_offset=13, end_lineno=227, end_col_offset=31), op=BitOr(), right=Constant(value=None, lineno=227, col_offset=34, end_lineno=227, end_col_offset=38), lineno=227, col_offset=13, end_lineno=227, end_col_offset=38), lineno=227, col_offset=4, end_lineno=227, end_col_offset=38)], kwonlyargs=[arg(arg='operation', annotation=Name(id='str', ctx=Load(), lineno=229, col_offset=15, end_lineno=229, end_col_offset=18), lineno=229, col_offset=4, end_lineno=229, end_col_offset=18)], kw_defaults=[None]), body=[If(test=Compare(left=Name(id='options', ctx=Load(), lineno=231, col_offset=7, end_lineno=231, end_col_offset=14), ops=[Is()], comparators=[Constant(value=None, lineno=231, col_offset=18, end_lineno=231, end_col_offset=22)], lineno=231, col_offset=7, end_lineno=231, end_col_offset=22), body=[Return(value=Call(func=Name(id='DuckDBQueryOptions', ctx=Load(), lineno=232, col_offset=15, end_lineno=232, end_col_offset=33), keywords=[keyword(arg='operation', value=Name(id='operation', ctx=Load(), lineno=232, col_offset=44, end_lineno=232, end_col_offset=53), lineno=232, col_offset=34, end_lineno=232, end_col_offset=53)], lineno=232, col_offset=15, end_lineno=232, end_col_offset=54), lineno=232, col_offset=8, end_lineno=232, end_col_offset=54)], lineno=231, col_offset=4, end_lineno=232, end_col_offset=54), If(test=Compare(left=Attribute(value=Name(id='options', ctx=Load(), lineno=233, col_offset=7, end_lineno=233, end_col_offset=14), attr='operation', ctx=Load(), lineno=233, col_offset=7, end_lineno=233, end_col_offset=24), ops=[Eq()], comparators=[Name(id='operation', ctx=Load(), lineno=233, col_offset=28, end_lineno=233, end_col_offset=37)], lineno=233, col_offset=7, end_lineno=233, end_col_offset=37), body=[Return(value=Name(id='options', ctx=Load(), lineno=234, col_offset=15, end_lineno=234, end_col_offset=22), lineno=234, col_offset=8, end_lineno=234, end_col_offset=22)], lineno=233, col_offset=4, end_lineno=234, end_col_offset=22), Return(value=Call(func=Name(id='replace', ctx=Load(), lineno=235, col_offset=11, end_lineno=235, end_col_offset=18), args=[Name(id='options', ctx=Load(), lineno=235, col_offset=19, end_lineno=235, end_col_offset=26)], keywords=[keyword(arg='operation', value=Name(id='operation', ctx=Load(), lineno=235, col_offset=38, end_lineno=235, end_col_offset=47), lineno=235, col_offset=28, end_lineno=235, end_col_offset=47)], lineno=235, col_offset=11, end_lineno=235, end_col_offset=48), lineno=235, col_offset=4, end_lineno=235, end_col_offset=48)], returns=Name(id='DuckDBQueryOptions', ctx=Load(), lineno=230, col_offset=5, end_lineno=230, end_col_offset=23), lineno=226, col_offset=0, end_lineno=235, end_col_offset=48), FunctionDef(name='execute', args=arguments(args=[arg(arg='conn', annotation=Name(id='DuckDBPyConnection', ctx=Load(), lineno=240, col_offset=10, end_lineno=240, end_col_offset=28), lineno=240, col_offset=4, end_lineno=240, end_col_offset=28), arg(arg='sql', annotation=Name(id='str', ctx=Load(), lineno=241, col_offset=9, end_lineno=241, end_col_offset=12), lineno=241, col_offset=4, end_lineno=241, end_col_offset=12), arg(arg='params', annotation=Name(id='Params', ctx=Load(), lineno=242, col_offset=12, end_lineno=242, end_col_offset=18), lineno=242, col_offset=4, end_lineno=242, end_col_offset=18)], kwonlyargs=[arg(arg='options', annotation=BinOp(left=Name(id='DuckDBQueryOptions', ctx=Load(), lineno=244, col_offset=13, end_lineno=244, end_col_offset=31), op=BitOr(), right=Constant(value=None, lineno=244, col_offset=34, end_lineno=244, end_col_offset=38), lineno=244, col_offset=13, end_lineno=244, end_col_offset=38), lineno=244, col_offset=4, end_lineno=244, end_col_offset=38)], kw_defaults=[Constant(value=None, lineno=244, col_offset=41, end_lineno=244, end_col_offset=45)], defaults=[Constant(value=None, lineno=242, col_offset=21, end_lineno=242, end_col_offset=25)]), body=[Expr(value=Constant(value='Execute a DuckDB query with parameter binding, logging, and metrics.\n\n    Executes a SQL query with optional parameter binding, structured logging,\n    performance metrics, and timeout enforcement. Validates parameterization\n    when required and logs slow queries.\n\n    Parameters\n    ----------\n    conn : DuckDBPyConnection\n        DuckDB connection to execute query on.\n    sql : str\n        SQL query string. Must use parameterized placeholders (?, :name, or $n)\n        if params is provided or require_parameterized is True.\n    params : Params, optional\n        Query parameters (Sequence for positional, Mapping for named).\n        Defaults to None.\n    options : DuckDBQueryOptions | None, optional\n        Query execution options including timeout, logging metadata, and\n        parameter enforcement. Defaults to None (uses module defaults).\n\n    Returns\n    -------\n    DuckDBPyConnection\n        Connection with query result relation (use .fetchall() or .fetchone()\n        to retrieve rows).\n\n    Raises\n    ------\n    RegistryError\n        If query execution fails, parameterization is required but missing,\n        or timeout is exceeded.\n    RuntimeError\n        Raised if query execution completes without returning a relation.\n    ', lineno=246, col_offset=4, end_lineno=279, end_col_offset=7), lineno=246, col_offset=4, end_lineno=279, end_col_offset=7), Assign(targets=[Name(id='opts', ctx=Store(), lineno=280, col_offset=4, end_lineno=280, end_col_offset=8)], value=Call(func=Name(id='_coerce_options', ctx=Load(), lineno=280, col_offset=11, end_lineno=280, end_col_offset=26), args=[Name(id='options', ctx=Load(), lineno=280, col_offset=27, end_lineno=280, end_col_offset=34)], keywords=[keyword(arg='operation', value=Constant(value='duckdb.execute', lineno=280, col_offset=46, end_lineno=280, end_col_offset=62), lineno=280, col_offset=36, end_lineno=280, end_col_offset=62)], lineno=280, col_offset=11, end_lineno=280, end_col_offset=63), lineno=280, col_offset=4, end_lineno=280, end_col_offset=63), Assign(targets=[Name(id='require_flag', ctx=Store(), lineno=281, col_offset=4, end_lineno=281, end_col_offset=16)], value=IfExp(test=Compare(left=Attribute(value=Name(id='opts', ctx=Load(), lineno=282, col_offset=30, end_lineno=282, end_col_offset=34), attr='require_parameterized', ctx=Load(), lineno=282, col_offset=30, end_lineno=282, end_col_offset=56), ops=[Is()], comparators=[Constant(value=None, lineno=282, col_offset=60, end_lineno=282, end_col_offset=64)], lineno=282, col_offset=30, end_lineno=282, end_col_offset=64), body=Compare(left=Name(id='params', ctx=Load(), lineno=282, col_offset=8, end_lineno=282, end_col_offset=14), ops=[IsNot()], comparators=[Constant(value=None, lineno=282, col_offset=22, end_lineno=282, end_col_offset=26)], lineno=282, col_offset=8, end_lineno=282, end_col_offset=26), orelse=Attribute(value=Name(id='opts', ctx=Load(), lineno=282, col_offset=70, end_lineno=282, end_col_offset=74), attr='require_parameterized', ctx=Load(), lineno=282, col_offset=70, end_lineno=282, end_col_offset=96), lineno=282, col_offset=8, end_lineno=282, end_col_offset=96), lineno=281, col_offset=4, end_lineno=283, end_col_offset=5), Expr(value=Call(func=Name(id='_ensure_parameterized', ctx=Load(), lineno=284, col_offset=4, end_lineno=284, end_col_offset=25), args=[Name(id='sql', ctx=Load(), lineno=284, col_offset=26, end_lineno=284, end_col_offset=29)], keywords=[keyword(arg='require_parameterized', value=Name(id='require_flag', ctx=Load(), lineno=284, col_offset=53, end_lineno=284, end_col_offset=65), lineno=284, col_offset=31, end_lineno=284, end_col_offset=65)], lineno=284, col_offset=4, end_lineno=284, end_col_offset=66), lineno=284, col_offset=4, end_lineno=284, end_col_offset=66), Assign(targets=[Name(id='sql_preview', ctx=Store(), lineno=286, col_offset=4, end_lineno=286, end_col_offset=15)], value=Call(func=Name(id='_format_sql', ctx=Load(), lineno=286, col_offset=18, end_lineno=286, end_col_offset=29), args=[Name(id='sql', ctx=Load(), lineno=286, col_offset=30, end_lineno=286, end_col_offset=33)], lineno=286, col_offset=18, end_lineno=286, end_col_offset=34), lineno=286, col_offset=4, end_lineno=286, end_col_offset=34), Assign(targets=[Name(id='query_params', ctx=Store(), lineno=287, col_offset=4, end_lineno=287, end_col_offset=16)], value=Call(func=Name(id='_format_params', ctx=Load(), lineno=287, col_offset=19, end_lineno=287, end_col_offset=33), args=[Name(id='params', ctx=Load(), lineno=287, col_offset=34, end_lineno=287, end_col_offset=40)], lineno=287, col_offset=19, end_lineno=287, end_col_offset=41), lineno=287, col_offset=4, end_lineno=287, end_col_offset=41), With(items=[withitem(context_expr=Call(func=Name(id='with_fields', ctx=Load(), lineno=290, col_offset=8, end_lineno=290, end_col_offset=19), args=[Name(id='logger', ctx=Load(), lineno=291, col_offset=12, end_lineno=291, end_col_offset=18)], keywords=[keyword(arg='component', value=Constant(value='registry', lineno=292, col_offset=22, end_lineno=292, end_col_offset=32), lineno=292, col_offset=12, end_lineno=292, end_col_offset=32), keyword(arg='operation', value=Attribute(value=Name(id='opts', ctx=Load(), lineno=293, col_offset=22, end_lineno=293, end_col_offset=26), attr='operation', ctx=Load(), lineno=293, col_offset=22, end_lineno=293, end_col_offset=36), lineno=293, col_offset=12, end_lineno=293, end_col_offset=36), keyword(arg='sql_preview', value=Name(id='sql_preview', ctx=Load(), lineno=294, col_offset=24, end_lineno=294, end_col_offset=35), lineno=294, col_offset=12, end_lineno=294, end_col_offset=35)], lineno=290, col_offset=8, end_lineno=295, end_col_offset=9), optional_vars=Name(id='log', ctx=Store(), lineno=295, col_offset=13, end_lineno=295, end_col_offset=16)), withitem(context_expr=Call(func=Name(id='observe_duration', ctx=Load(), lineno=296, col_offset=8, end_lineno=296, end_col_offset=24), args=[Name(id='metrics', ctx=Load(), lineno=296, col_offset=25, end_lineno=296, end_col_offset=32), Attribute(value=Name(id='opts', ctx=Load(), lineno=296, col_offset=34, end_lineno=296, end_col_offset=38), attr='operation', ctx=Load(), lineno=296, col_offset=34, end_lineno=296, end_col_offset=48)], keywords=[keyword(arg='component', value=Constant(value='registry', lineno=296, col_offset=60, end_lineno=296, end_col_offset=70), lineno=296, col_offset=50, end_lineno=296, end_col_offset=70)], lineno=296, col_offset=8, end_lineno=296, end_col_offset=71), optional_vars=Name(id='observer', ctx=Store(), lineno=296, col_offset=75, end_lineno=296, end_col_offset=83))], body=[Assign(targets=[Name(id='start', ctx=Store(), lineno=298, col_offset=8, end_lineno=298, end_col_offset=13)], value=Call(func=Attribute(value=Name(id='time', ctx=Load(), lineno=298, col_offset=16, end_lineno=298, end_col_offset=20), attr='perf_counter', ctx=Load(), lineno=298, col_offset=16, end_lineno=298, end_col_offset=33), lineno=298, col_offset=16, end_lineno=298, end_col_offset=35), lineno=298, col_offset=8, end_lineno=298, end_col_offset=35), Try(body=[Expr(value=Call(func=Name(id='_set_timeout', ctx=Load(), lineno=300, col_offset=12, end_lineno=300, end_col_offset=24), args=[Name(id='conn', ctx=Load(), lineno=300, col_offset=25, end_lineno=300, end_col_offset=29), Attribute(value=Name(id='opts', ctx=Load(), lineno=300, col_offset=31, end_lineno=300, end_col_offset=35), attr='timeout_s', ctx=Load(), lineno=300, col_offset=31, end_lineno=300, end_col_offset=45)], lineno=300, col_offset=12, end_lineno=300, end_col_offset=46), lineno=300, col_offset=12, end_lineno=300, end_col_offset=46), Assign(targets=[Name(id='relation', ctx=Store(), lineno=301, col_offset=12, end_lineno=301, end_col_offset=20)], value=IfExp(test=Compare(left=Name(id='params', ctx=Load(), lineno=301, col_offset=44, end_lineno=301, end_col_offset=50), ops=[Is()], comparators=[Constant(value=None, lineno=301, col_offset=54, end_lineno=301, end_col_offset=58)], lineno=301, col_offset=44, end_lineno=301, end_col_offset=58), body=Call(func=Attribute(value=Name(id='conn', ctx=Load(), lineno=301, col_offset=23, end_lineno=301, end_col_offset=27), attr='execute', ctx=Load(), lineno=301, col_offset=23, end_lineno=301, end_col_offset=35), args=[Name(id='sql', ctx=Load(), lineno=301, col_offset=36, end_lineno=301, end_col_offset=39)], lineno=301, col_offset=23, end_lineno=301, end_col_offset=40), orelse=Call(func=Attribute(value=Name(id='conn', ctx=Load(), lineno=301, col_offset=64, end_lineno=301, end_col_offset=68), attr='execute', ctx=Load(), lineno=301, col_offset=64, end_lineno=301, end_col_offset=76), args=[Name(id='sql', ctx=Load(), lineno=301, col_offset=77, end_lineno=301, end_col_offset=80), Name(id='params', ctx=Load(), lineno=301, col_offset=82, end_lineno=301, end_col_offset=88)], lineno=301, col_offset=64, end_lineno=301, end_col_offset=89), lineno=301, col_offset=23, end_lineno=301, end_col_offset=89), lineno=301, col_offset=12, end_lineno=301, end_col_offset=89)], handlers=[ExceptHandler(type=Attribute(value=Name(id='duckdb', ctx=Load(), lineno=302, col_offset=15, end_lineno=302, end_col_offset=21), attr='Error', ctx=Load(), lineno=302, col_offset=15, end_lineno=302, end_col_offset=27), name='exc', body=[Expr(value=Call(func=Attribute(value=Name(id='observer', ctx=Load(), lineno=303, col_offset=12, end_lineno=303, end_col_offset=20), attr='error', ctx=Load(), lineno=303, col_offset=12, end_lineno=303, end_col_offset=26), lineno=303, col_offset=12, end_lineno=303, end_col_offset=28), lineno=303, col_offset=12, end_lineno=303, end_col_offset=28), Expr(value=Call(func=Attribute(value=Name(id='log', ctx=Load(), lineno=304, col_offset=12, end_lineno=304, end_col_offset=15), attr='exception', ctx=Load(), lineno=304, col_offset=12, end_lineno=304, end_col_offset=25), args=[Constant(value='DuckDB query failed', lineno=305, col_offset=16, end_lineno=305, end_col_offset=37)], keywords=[keyword(arg='extra', value=Dict(keys=[Constant(value='params', lineno=306, col_offset=23, end_lineno=306, end_col_offset=31)], values=[Name(id='query_params', ctx=Load(), lineno=306, col_offset=33, end_lineno=306, end_col_offset=45)], lineno=306, col_offset=22, end_lineno=306, end_col_offset=46), lineno=306, col_offset=16, end_lineno=306, end_col_offset=46)], lineno=304, col_offset=12, end_lineno=307, end_col_offset=13), lineno=304, col_offset=12, end_lineno=307, end_col_offset=13), Assign(targets=[Name(id='error_message', ctx=Store(), lineno=308, col_offset=12, end_lineno=308, end_col_offset=25)], value=Constant(value='DuckDB query failed', lineno=308, col_offset=28, end_lineno=308, end_col_offset=49), lineno=308, col_offset=12, end_lineno=308, end_col_offset=49), Raise(exc=Call(func=Name(id='RegistryError', ctx=Load(), lineno=309, col_offset=18, end_lineno=309, end_col_offset=31), args=[Name(id='error_message', ctx=Load(), lineno=310, col_offset=16, end_lineno=310, end_col_offset=29)], keywords=[keyword(arg='cause', value=Name(id='exc', ctx=Load(), lineno=311, col_offset=22, end_lineno=311, end_col_offset=25), lineno=311, col_offset=16, end_lineno=311, end_col_offset=25), keyword(arg='context', value=Dict(keys=[Constant(value='sql_preview', lineno=312, col_offset=25, end_lineno=312, end_col_offset=38), Constant(value='params', lineno=312, col_offset=53, end_lineno=312, end_col_offset=61)], values=[Name(id='sql_preview', ctx=Load(), lineno=312, col_offset=40, end_lineno=312, end_col_offset=51), Name(id='query_params', ctx=Load(), lineno=312, col_offset=63, end_lineno=312, end_col_offset=75)], lineno=312, col_offset=24, end_lineno=312, end_col_offset=76), lineno=312, col_offset=16, end_lineno=312, end_col_offset=76)], lineno=309, col_offset=18, end_lineno=313, end_col_offset=13), cause=Name(id='exc', ctx=Load(), lineno=313, col_offset=19, end_lineno=313, end_col_offset=22), lineno=309, col_offset=12, end_lineno=313, end_col_offset=22)], lineno=302, col_offset=8, end_lineno=313, end_col_offset=22)], orelse=[Expr(value=Call(func=Attribute(value=Name(id='observer', ctx=Load(), lineno=315, col_offset=12, end_lineno=315, end_col_offset=20), attr='success', ctx=Load(), lineno=315, col_offset=12, end_lineno=315, end_col_offset=28), lineno=315, col_offset=12, end_lineno=315, end_col_offset=30), lineno=315, col_offset=12, end_lineno=315, end_col_offset=30), Assign(targets=[Name(id='duration', ctx=Store(), lineno=316, col_offset=12, end_lineno=316, end_col_offset=20)], value=BinOp(left=Call(func=Attribute(value=Name(id='time', ctx=Load(), lineno=316, col_offset=23, end_lineno=316, end_col_offset=27), attr='perf_counter', ctx=Load(), lineno=316, col_offset=23, end_lineno=316, end_col_offset=40), lineno=316, col_offset=23, end_lineno=316, end_col_offset=42), op=Sub(), right=Name(id='start', ctx=Load(), lineno=316, col_offset=45, end_lineno=316, end_col_offset=50), lineno=316, col_offset=23, end_lineno=316, end_col_offset=50), lineno=316, col_offset=12, end_lineno=316, end_col_offset=50), If(test=Compare(left=Name(id='duration', ctx=Load(), lineno=317, col_offset=15, end_lineno=317, end_col_offset=23), ops=[GtE()], comparators=[Attribute(value=Name(id='opts', ctx=Load(), lineno=317, col_offset=27, end_lineno=317, end_col_offset=31), attr='slow_query_threshold_s', ctx=Load(), lineno=317, col_offset=27, end_lineno=317, end_col_offset=54)], lineno=317, col_offset=15, end_lineno=317, end_col_offset=54), body=[Expr(value=Call(func=Attribute(value=Name(id='log', ctx=Load(), lineno=318, col_offset=16, end_lineno=318, end_col_offset=19), attr='warning', ctx=Load(), lineno=318, col_offset=16, end_lineno=318, end_col_offset=27), args=[Constant(value='Slow DuckDB query', lineno=319, col_offset=20, end_lineno=319, end_col_offset=39)], keywords=[keyword(arg='extra', value=Dict(keys=[Constant(value='duration_ms', lineno=321, col_offset=24, end_lineno=321, end_col_offset=37), Constant(value='params', lineno=322, col_offset=24, end_lineno=322, end_col_offset=32)], values=[Call(func=Name(id='round', ctx=Load(), lineno=321, col_offset=39, end_lineno=321, end_col_offset=44), args=[BinOp(left=Name(id='duration', ctx=Load(), lineno=321, col_offset=45, end_lineno=321, end_col_offset=53), op=Mult(), right=Constant(value=1000, lineno=321, col_offset=56, end_lineno=321, end_col_offset=60), lineno=321, col_offset=45, end_lineno=321, end_col_offset=60), Constant(value=2, lineno=321, col_offset=62, end_lineno=321, end_col_offset=63)], lineno=321, col_offset=39, end_lineno=321, end_col_offset=64), Name(id='query_params', ctx=Load(), lineno=322, col_offset=34, end_lineno=322, end_col_offset=46)], lineno=320, col_offset=26, end_lineno=323, end_col_offset=21), lineno=320, col_offset=20, end_lineno=323, end_col_offset=21)], lineno=318, col_offset=16, end_lineno=324, end_col_offset=17), lineno=318, col_offset=16, end_lineno=324, end_col_offset=17)], orelse=[Expr(value=Call(func=Attribute(value=Name(id='log', ctx=Load(), lineno=326, col_offset=16, end_lineno=326, end_col_offset=19), attr='debug', ctx=Load(), lineno=326, col_offset=16, end_lineno=326, end_col_offset=25), args=[Constant(value='DuckDB query executed', lineno=327, col_offset=20, end_lineno=327, end_col_offset=43)], keywords=[keyword(arg='extra', value=Dict(keys=[Constant(value='duration_ms', lineno=328, col_offset=27, end_lineno=328, end_col_offset=40)], values=[Call(func=Name(id='round', ctx=Load(), lineno=328, col_offset=42, end_lineno=328, end_col_offset=47), args=[BinOp(left=Name(id='duration', ctx=Load(), lineno=328, col_offset=48, end_lineno=328, end_col_offset=56), op=Mult(), right=Constant(value=1000, lineno=328, col_offset=59, end_lineno=328, end_col_offset=63), lineno=328, col_offset=48, end_lineno=328, end_col_offset=63), Constant(value=2, lineno=328, col_offset=65, end_lineno=328, end_col_offset=66)], lineno=328, col_offset=42, end_lineno=328, end_col_offset=67)], lineno=328, col_offset=26, end_lineno=328, end_col_offset=68), lineno=328, col_offset=20, end_lineno=328, end_col_offset=68)], lineno=326, col_offset=16, end_lineno=329, end_col_offset=17), lineno=326, col_offset=16, end_lineno=329, end_col_offset=17)], lineno=317, col_offset=12, end_lineno=329, end_col_offset=17), Return(value=Name(id='relation', ctx=Load(), lineno=330, col_offset=19, end_lineno=330, end_col_offset=27), lineno=330, col_offset=12, end_lineno=330, end_col_offset=27)], lineno=299, col_offset=8, end_lineno=330, end_col_offset=27)], lineno=289, col_offset=4, end_lineno=330, end_col_offset=27), Assign(targets=[Name(id='message', ctx=Store(), lineno=331, col_offset=4, end_lineno=331, end_col_offset=11)], value=Constant(value='DuckDB query execution completed without returning a relation', lineno=331, col_offset=14, end_lineno=331, end_col_offset=77), lineno=331, col_offset=4, end_lineno=331, end_col_offset=77), Raise(exc=Call(func=Name(id='RuntimeError', ctx=Load(), lineno=332, col_offset=10, end_lineno=332, end_col_offset=22), args=[Name(id='message', ctx=Load(), lineno=332, col_offset=23, end_lineno=332, end_col_offset=30)], lineno=332, col_offset=10, end_lineno=332, end_col_offset=31), lineno=332, col_offset=4, end_lineno=332, end_col_offset=31)], returns=Name(id='DuckDBPyConnection', ctx=Load(), lineno=245, col_offset=5, end_lineno=245, end_col_offset=23), lineno=239, col_offset=0, end_lineno=332, end_col_offset=31), FunctionDef(name='fetch_all', args=arguments(args=[arg(arg='conn', annotation=Name(id='DuckDBPyConnection', ctx=Load(), lineno=337, col_offset=10, end_lineno=337, end_col_offset=28), lineno=337, col_offset=4, end_lineno=337, end_col_offset=28), arg(arg='sql', annotation=Name(id='str', ctx=Load(), lineno=338, col_offset=9, end_lineno=338, end_col_offset=12), lineno=338, col_offset=4, end_lineno=338, end_col_offset=12), arg(arg='params', annotation=Name(id='Params', ctx=Load(), lineno=339, col_offset=12, end_lineno=339, end_col_offset=18), lineno=339, col_offset=4, end_lineno=339, end_col_offset=18)], kwonlyargs=[arg(arg='options', annotation=BinOp(left=Name(id='DuckDBQueryOptions', ctx=Load(), lineno=341, col_offset=13, end_lineno=341, end_col_offset=31), op=BitOr(), right=Constant(value=None, lineno=341, col_offset=34, end_lineno=341, end_col_offset=38), lineno=341, col_offset=13, end_lineno=341, end_col_offset=38), lineno=341, col_offset=4, end_lineno=341, end_col_offset=38)], kw_defaults=[Constant(value=None, lineno=341, col_offset=41, end_lineno=341, end_col_offset=45)], defaults=[Constant(value=None, lineno=339, col_offset=21, end_lineno=339, end_col_offset=25)]), body=[Expr(value=Constant(value='Execute a query and return all rows as a list of tuples.\n\n    Executes a SQL query and returns all result rows as a list of tuples.\n    Uses execute() internally for logging and metrics.\n\n    Parameters\n    ----------\n    conn : DuckDBPyConnection\n        DuckDB connection to execute query on.\n    sql : str\n        SQL query string. Must use parameterized placeholders if params provided.\n    params : Params, optional\n        Query parameters (Sequence for positional, Mapping for named).\n        Defaults to None.\n    options : DuckDBQueryOptions | None, optional\n        Query execution options forwarded to :func:`execute`.\n        Defaults to None.\n\n    Returns\n    -------\n    list[tuple[object, ...]]\n        List of result rows, each row as a tuple of column values.\n    ', lineno=343, col_offset=4, end_lineno=365, end_col_offset=7), lineno=343, col_offset=4, end_lineno=365, end_col_offset=7), Assign(targets=[Name(id='relation', ctx=Store(), lineno=366, col_offset=4, end_lineno=366, end_col_offset=12)], value=Call(func=Name(id='execute', ctx=Load(), lineno=366, col_offset=15, end_lineno=366, end_col_offset=22), args=[Name(id='conn', ctx=Load(), lineno=367, col_offset=8, end_lineno=367, end_col_offset=12), Name(id='sql', ctx=Load(), lineno=368, col_offset=8, end_lineno=368, end_col_offset=11), Name(id='params', ctx=Load(), lineno=369, col_offset=8, end_lineno=369, end_col_offset=14)], keywords=[keyword(arg='options', value=Call(func=Name(id='_coerce_options', ctx=Load(), lineno=370, col_offset=16, end_lineno=370, end_col_offset=31), args=[Name(id='options', ctx=Load(), lineno=370, col_offset=32, end_lineno=370, end_col_offset=39)], keywords=[keyword(arg='operation', value=Constant(value='duckdb.fetch_all', lineno=370, col_offset=51, end_lineno=370, end_col_offset=69), lineno=370, col_offset=41, end_lineno=370, end_col_offset=69)], lineno=370, col_offset=16, end_lineno=370, end_col_offset=70), lineno=370, col_offset=8, end_lineno=370, end_col_offset=70)], lineno=366, col_offset=15, end_lineno=371, end_col_offset=5), lineno=366, col_offset=4, end_lineno=371, end_col_offset=5), Assign(targets=[Name(id='raw_rows', ctx=Store(), lineno=372, col_offset=4, end_lineno=372, end_col_offset=12)], value=Call(func=Name(id='cast', ctx=Load(), lineno=372, col_offset=15, end_lineno=372, end_col_offset=19), args=[Constant(value='list[tuple[object, ...]]', lineno=372, col_offset=20, end_lineno=372, end_col_offset=46), Call(func=Attribute(value=Name(id='relation', ctx=Load(), lineno=372, col_offset=48, end_lineno=372, end_col_offset=56), attr='fetchall', ctx=Load(), lineno=372, col_offset=48, end_lineno=372, end_col_offset=65), lineno=372, col_offset=48, end_lineno=372, end_col_offset=67)], lineno=372, col_offset=15, end_lineno=372, end_col_offset=68), lineno=372, col_offset=4, end_lineno=372, end_col_offset=68), AnnAssign(target=Name(id='typed_rows', ctx=Store(), lineno=373, col_offset=4, end_lineno=373, end_col_offset=14), annotation=Subscript(value=Name(id='list', ctx=Load(), lineno=373, col_offset=16, end_lineno=373, end_col_offset=20), slice=Subscript(value=Name(id='tuple', ctx=Load(), lineno=373, col_offset=21, end_lineno=373, end_col_offset=26), slice=Tuple(elts=[Name(id='object', ctx=Load(), lineno=373, col_offset=27, end_lineno=373, end_col_offset=33), Constant(value=Ellipsis, lineno=373, col_offset=35, end_lineno=373, end_col_offset=38)], ctx=Load(), lineno=373, col_offset=27, end_lineno=373, end_col_offset=38), ctx=Load(), lineno=373, col_offset=21, end_lineno=373, end_col_offset=39), ctx=Load(), lineno=373, col_offset=16, end_lineno=373, end_col_offset=40), value=ListComp(elt=Call(func=Name(id='tuple', ctx=Load(), lineno=373, col_offset=44, end_lineno=373, end_col_offset=49), args=[Name(id='row', ctx=Load(), lineno=373, col_offset=50, end_lineno=373, end_col_offset=53)], lineno=373, col_offset=44, end_lineno=373, end_col_offset=54), generators=[comprehension(target=Name(id='row', ctx=Store(), lineno=373, col_offset=59, end_lineno=373, end_col_offset=62), iter=Name(id='raw_rows', ctx=Load(), lineno=373, col_offset=66, end_lineno=373, end_col_offset=74), is_async=0)], lineno=373, col_offset=43, end_lineno=373, end_col_offset=75), simple=1, lineno=373, col_offset=4, end_lineno=373, end_col_offset=75), Return(value=Name(id='typed_rows', ctx=Load(), lineno=374, col_offset=11, end_lineno=374, end_col_offset=21), lineno=374, col_offset=4, end_lineno=374, end_col_offset=21)], returns=Subscript(value=Name(id='list', ctx=Load(), lineno=342, col_offset=5, end_lineno=342, end_col_offset=9), slice=Subscript(value=Name(id='tuple', ctx=Load(), lineno=342, col_offset=10, end_lineno=342, end_col_offset=15), slice=Tuple(elts=[Name(id='object', ctx=Load(), lineno=342, col_offset=16, end_lineno=342, end_col_offset=22), Constant(value=Ellipsis, lineno=342, col_offset=24, end_lineno=342, end_col_offset=27)], ctx=Load(), lineno=342, col_offset=16, end_lineno=342, end_col_offset=27), ctx=Load(), lineno=342, col_offset=10, end_lineno=342, end_col_offset=28), ctx=Load(), lineno=342, col_offset=5, end_lineno=342, end_col_offset=29), lineno=336, col_offset=0, end_lineno=374, end_col_offset=21), FunctionDef(name='fetch_one', args=arguments(args=[arg(arg='conn', annotation=Name(id='DuckDBPyConnection', ctx=Load(), lineno=379, col_offset=10, end_lineno=379, end_col_offset=28), lineno=379, col_offset=4, end_lineno=379, end_col_offset=28), arg(arg='sql', annotation=Name(id='str', ctx=Load(), lineno=380, col_offset=9, end_lineno=380, end_col_offset=12), lineno=380, col_offset=4, end_lineno=380, end_col_offset=12), arg(arg='params', annotation=Name(id='Params', ctx=Load(), lineno=381, col_offset=12, end_lineno=381, end_col_offset=18), lineno=381, col_offset=4, end_lineno=381, end_col_offset=18)], kwonlyargs=[arg(arg='options', annotation=BinOp(left=Name(id='DuckDBQueryOptions', ctx=Load(), lineno=383, col_offset=13, end_lineno=383, end_col_offset=31), op=BitOr(), right=Constant(value=None, lineno=383, col_offset=34, end_lineno=383, end_col_offset=38), lineno=383, col_offset=13, end_lineno=383, end_col_offset=38), lineno=383, col_offset=4, end_lineno=383, end_col_offset=38)], kw_defaults=[Constant(value=None, lineno=383, col_offset=41, end_lineno=383, end_col_offset=45)], defaults=[Constant(value=None, lineno=381, col_offset=21, end_lineno=381, end_col_offset=25)]), body=[Expr(value=Constant(value='Execute a query and return the first row or None.\n\n    Executes a SQL query and returns the first result row as a tuple, or None\n    if no rows are returned. Uses execute() internally for logging and metrics.\n\n    Parameters\n    ----------\n    conn : DuckDBPyConnection\n        DuckDB connection to execute query on.\n    sql : str\n        SQL query string. Must use parameterized placeholders if params provided.\n    params : Params, optional\n        Query parameters (Sequence for positional, Mapping for named).\n        Defaults to None.\n    options : DuckDBQueryOptions | None, optional\n        Query execution options forwarded to :func:`execute`.\n        Defaults to None.\n\n    Returns\n    -------\n    tuple[object, ...] | None\n        First result row as a tuple of column values, or None if no rows.\n    ', lineno=385, col_offset=4, end_lineno=407, end_col_offset=7), lineno=385, col_offset=4, end_lineno=407, end_col_offset=7), Assign(targets=[Name(id='relation', ctx=Store(), lineno=408, col_offset=4, end_lineno=408, end_col_offset=12)], value=Call(func=Name(id='execute', ctx=Load(), lineno=408, col_offset=15, end_lineno=408, end_col_offset=22), args=[Name(id='conn', ctx=Load(), lineno=409, col_offset=8, end_lineno=409, end_col_offset=12), Name(id='sql', ctx=Load(), lineno=410, col_offset=8, end_lineno=410, end_col_offset=11), Name(id='params', ctx=Load(), lineno=411, col_offset=8, end_lineno=411, end_col_offset=14)], keywords=[keyword(arg='options', value=Call(func=Name(id='_coerce_options', ctx=Load(), lineno=412, col_offset=16, end_lineno=412, end_col_offset=31), args=[Name(id='options', ctx=Load(), lineno=412, col_offset=32, end_lineno=412, end_col_offset=39)], keywords=[keyword(arg='operation', value=Constant(value='duckdb.fetch_one', lineno=412, col_offset=51, end_lineno=412, end_col_offset=69), lineno=412, col_offset=41, end_lineno=412, end_col_offset=69)], lineno=412, col_offset=16, end_lineno=412, end_col_offset=70), lineno=412, col_offset=8, end_lineno=412, end_col_offset=70)], lineno=408, col_offset=15, end_lineno=413, end_col_offset=5), lineno=408, col_offset=4, end_lineno=413, end_col_offset=5), Assign(targets=[Name(id='raw_row', ctx=Store(), lineno=414, col_offset=4, end_lineno=414, end_col_offset=11)], value=Call(func=Name(id='cast', ctx=Load(), lineno=414, col_offset=14, end_lineno=414, end_col_offset=18), args=[Constant(value='tuple[object, ...] | None', lineno=414, col_offset=19, end_lineno=414, end_col_offset=46), Call(func=Attribute(value=Name(id='relation', ctx=Load(), lineno=414, col_offset=48, end_lineno=414, end_col_offset=56), attr='fetchone', ctx=Load(), lineno=414, col_offset=48, end_lineno=414, end_col_offset=65), lineno=414, col_offset=48, end_lineno=414, end_col_offset=67)], lineno=414, col_offset=14, end_lineno=414, end_col_offset=68), lineno=414, col_offset=4, end_lineno=414, end_col_offset=68), If(test=Compare(left=Name(id='raw_row', ctx=Load(), lineno=415, col_offset=7, end_lineno=415, end_col_offset=14), ops=[Is()], comparators=[Constant(value=None, lineno=415, col_offset=18, end_lineno=415, end_col_offset=22)], lineno=415, col_offset=7, end_lineno=415, end_col_offset=22), body=[Return(value=Constant(value=None, lineno=416, col_offset=15, end_lineno=416, end_col_offset=19), lineno=416, col_offset=8, end_lineno=416, end_col_offset=19)], lineno=415, col_offset=4, end_lineno=416, end_col_offset=19), Return(value=Call(func=Name(id='tuple', ctx=Load(), lineno=417, col_offset=11, end_lineno=417, end_col_offset=16), args=[Name(id='raw_row', ctx=Load(), lineno=417, col_offset=17, end_lineno=417, end_col_offset=24)], lineno=417, col_offset=11, end_lineno=417, end_col_offset=25), lineno=417, col_offset=4, end_lineno=417, end_col_offset=25)], returns=BinOp(left=Subscript(value=Name(id='tuple', ctx=Load(), lineno=384, col_offset=5, end_lineno=384, end_col_offset=10), slice=Tuple(elts=[Name(id='object', ctx=Load(), lineno=384, col_offset=11, end_lineno=384, end_col_offset=17), Constant(value=Ellipsis, lineno=384, col_offset=19, end_lineno=384, end_col_offset=22)], ctx=Load(), lineno=384, col_offset=11, end_lineno=384, end_col_offset=22), ctx=Load(), lineno=384, col_offset=5, end_lineno=384, end_col_offset=23), op=BitOr(), right=Constant(value=None, lineno=384, col_offset=26, end_lineno=384, end_col_offset=30), lineno=384, col_offset=5, end_lineno=384, end_col_offset=30), lineno=378, col_offset=0, end_lineno=417, end_col_offset=25), FunctionDef(name='validate_identifier', args=arguments(args=[arg(arg='identifier', annotation=Name(id='str', ctx=Load(), lineno=422, col_offset=16, end_lineno=422, end_col_offset=19), lineno=422, col_offset=4, end_lineno=422, end_col_offset=19), arg(arg='allowed', annotation=Subscript(value=Name(id='Iterable', ctx=Load(), lineno=423, col_offset=13, end_lineno=423, end_col_offset=21), slice=Name(id='str', ctx=Load(), lineno=423, col_offset=22, end_lineno=423, end_col_offset=25), ctx=Load(), lineno=423, col_offset=13, end_lineno=423, end_col_offset=26), lineno=423, col_offset=4, end_lineno=423, end_col_offset=26)], kwonlyargs=[arg(arg='label', annotation=Name(id='str', ctx=Load(), lineno=425, col_offset=11, end_lineno=425, end_col_offset=14), lineno=425, col_offset=4, end_lineno=425, end_col_offset=14)], kw_defaults=[Constant(value='identifier', lineno=425, col_offset=17, end_lineno=425, end_col_offset=29)]), body=[Expr(value=Constant(value='Validate that an identifier is within an allowed set.\n\n    Validates that an identifier string is present in the allowed set of values.\n    Used for sanitizing table names, column names, or other database identifiers\n    to prevent SQL injection.\n\n    Parameters\n    ----------\n    identifier : str\n        Identifier string to validate.\n    allowed : Iterable[str]\n        Set of allowed identifier values.\n    label : str, optional\n        Human-readable label for error messages (e.g., "table name", "column name").\n        Defaults to "identifier".\n\n    Returns\n    -------\n    str\n        The validated identifier (unchanged).\n\n    Raises\n    ------\n    RegistryError\n        If identifier is not in the allowed set. Error context includes the\n        invalid identifier and sorted list of allowed values.\n    ', lineno=427, col_offset=4, end_lineno=453, end_col_offset=7), lineno=427, col_offset=4, end_lineno=453, end_col_offset=7), Assign(targets=[Name(id='allowed_set', ctx=Store(), lineno=454, col_offset=4, end_lineno=454, end_col_offset=15)], value=Call(func=Name(id='set', ctx=Load(), lineno=454, col_offset=18, end_lineno=454, end_col_offset=21), args=[Name(id='allowed', ctx=Load(), lineno=454, col_offset=22, end_lineno=454, end_col_offset=29)], lineno=454, col_offset=18, end_lineno=454, end_col_offset=30), lineno=454, col_offset=4, end_lineno=454, end_col_offset=30), If(test=Compare(left=Name(id='identifier', ctx=Load(), lineno=455, col_offset=7, end_lineno=455, end_col_offset=17), ops=[In()], comparators=[Name(id='allowed_set', ctx=Load(), lineno=455, col_offset=21, end_lineno=455, end_col_offset=32)], lineno=455, col_offset=7, end_lineno=455, end_col_offset=32), body=[Return(value=Name(id='identifier', ctx=Load(), lineno=456, col_offset=15, end_lineno=456, end_col_offset=25), lineno=456, col_offset=8, end_lineno=456, end_col_offset=25)], lineno=455, col_offset=4, end_lineno=456, end_col_offset=25), Assign(targets=[Name(id='error_message', ctx=Store(), lineno=457, col_offset=4, end_lineno=457, end_col_offset=17)], value=JoinedStr(values=[Constant(value='Invalid ', lineno=457, col_offset=22, end_lineno=457, end_col_offset=30), FormattedValue(value=Name(id='label', ctx=Load(), lineno=457, col_offset=31, end_lineno=457, end_col_offset=36), conversion=-1, lineno=457, col_offset=30, end_lineno=457, end_col_offset=37), Constant(value=': ', lineno=457, col_offset=37, end_lineno=457, end_col_offset=39), FormattedValue(value=Name(id='identifier', ctx=Load(), lineno=457, col_offset=40, end_lineno=457, end_col_offset=50), conversion=-1, lineno=457, col_offset=39, end_lineno=457, end_col_offset=51)], lineno=457, col_offset=20, end_lineno=457, end_col_offset=52), lineno=457, col_offset=4, end_lineno=457, end_col_offset=52), Raise(exc=Call(func=Name(id='RegistryError', ctx=Load(), lineno=458, col_offset=10, end_lineno=458, end_col_offset=23), args=[Name(id='error_message', ctx=Load(), lineno=459, col_offset=8, end_lineno=459, end_col_offset=21)], keywords=[keyword(arg='context', value=Dict(keys=[Name(id='label', ctx=Load(), lineno=460, col_offset=17, end_lineno=460, end_col_offset=22), Constant(value='allowed', lineno=460, col_offset=36, end_lineno=460, end_col_offset=45)], values=[Name(id='identifier', ctx=Load(), lineno=460, col_offset=24, end_lineno=460, end_col_offset=34), Call(func=Name(id='sorted', ctx=Load(), lineno=460, col_offset=47, end_lineno=460, end_col_offset=53), args=[Name(id='allowed_set', ctx=Load(), lineno=460, col_offset=54, end_lineno=460, end_col_offset=65)], lineno=460, col_offset=47, end_lineno=460, end_col_offset=66)], lineno=460, col_offset=16, end_lineno=460, end_col_offset=67), lineno=460, col_offset=8, end_lineno=460, end_col_offset=67)], lineno=458, col_offset=10, end_lineno=461, end_col_offset=5), lineno=458, col_offset=4, end_lineno=461, end_col_offset=5)], returns=Name(id='str', ctx=Load(), lineno=426, col_offset=5, end_lineno=426, end_col_offset=8), lineno=421, col_offset=0, end_lineno=461, end_col_offset=5)])