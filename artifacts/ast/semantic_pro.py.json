Module(body=[Expr(value=Constant(value='Two-stage semantic search (CodeRank → optional WARP → optional reranker).', lineno=1, col_offset=0, end_lineno=1, end_col_offset=83), lineno=1, col_offset=0, end_lineno=1, end_col_offset=83), ImportFrom(module='__future__', names=[alias(name='annotations', lineno=3, col_offset=23, end_lineno=3, end_col_offset=34)], level=0, lineno=3, col_offset=0, end_lineno=3, end_col_offset=34), Import(names=[alias(name='asyncio', lineno=5, col_offset=7, end_lineno=5, end_col_offset=14)], lineno=5, col_offset=0, end_lineno=5, end_col_offset=14), ImportFrom(module='collections.abc', names=[alias(name='Mapping', lineno=6, col_offset=28, end_lineno=6, end_col_offset=35), alias(name='Sequence', lineno=6, col_offset=37, end_lineno=6, end_col_offset=45)], level=0, lineno=6, col_offset=0, end_lineno=6, end_col_offset=45), ImportFrom(module='concurrent.futures', names=[alias(name='Future', lineno=7, col_offset=31, end_lineno=7, end_col_offset=37), alias(name='ThreadPoolExecutor', lineno=7, col_offset=39, end_lineno=7, end_col_offset=57)], level=0, lineno=7, col_offset=0, end_lineno=7, end_col_offset=57), ImportFrom(module='dataclasses', names=[alias(name='dataclass', lineno=8, col_offset=24, end_lineno=8, end_col_offset=33), alias(name='field', lineno=8, col_offset=35, end_lineno=8, end_col_offset=40)], level=0, lineno=8, col_offset=0, end_lineno=8, end_col_offset=40), ImportFrom(module='pathlib', names=[alias(name='Path', lineno=9, col_offset=20, end_lineno=9, end_col_offset=24)], level=0, lineno=9, col_offset=0, end_lineno=9, end_col_offset=24), ImportFrom(module='time', names=[alias(name='perf_counter', lineno=10, col_offset=17, end_lineno=10, end_col_offset=29)], level=0, lineno=10, col_offset=0, end_lineno=10, end_col_offset=29), ImportFrom(module='typing', names=[alias(name='TYPE_CHECKING', lineno=11, col_offset=19, end_lineno=11, end_col_offset=32), alias(name='Any', lineno=11, col_offset=34, end_lineno=11, end_col_offset=37), alias(name='TypedDict', lineno=11, col_offset=39, end_lineno=11, end_col_offset=48), alias(name='cast', lineno=11, col_offset=50, end_lineno=11, end_col_offset=54)], level=0, lineno=11, col_offset=0, end_lineno=11, end_col_offset=54), ImportFrom(module='codeintel_rev.app.middleware', names=[alias(name='get_session_id', lineno=13, col_offset=41, end_lineno=13, end_col_offset=55)], level=0, lineno=13, col_offset=0, end_lineno=13, end_col_offset=55), ImportFrom(module='codeintel_rev.io.hybrid_search', names=[alias(name='ChannelHit', lineno=14, col_offset=43, end_lineno=14, end_col_offset=53)], level=0, lineno=14, col_offset=0, end_lineno=14, end_col_offset=53), ImportFrom(module='codeintel_rev.io.rerank_coderankllm', names=[alias(name='CodeRankListwiseReranker', lineno=15, col_offset=48, end_lineno=15, end_col_offset=72)], level=0, lineno=15, col_offset=0, end_lineno=15, end_col_offset=72), ImportFrom(module='codeintel_rev.io.warp_engine', names=[alias(name='WarpEngine', lineno=16, col_offset=41, end_lineno=16, end_col_offset=51), alias(name='WarpUnavailableError', lineno=16, col_offset=53, end_lineno=16, end_col_offset=73)], level=0, lineno=16, col_offset=0, end_lineno=16, end_col_offset=73), ImportFrom(module='codeintel_rev.mcp_server.common.observability', names=[alias(name='Observation', lineno=17, col_offset=58, end_lineno=17, end_col_offset=69), alias(name='observe_duration', lineno=17, col_offset=71, end_lineno=17, end_col_offset=87)], level=0, lineno=17, col_offset=0, end_lineno=17, end_col_offset=87), ImportFrom(module='codeintel_rev.mcp_server.schemas', names=[alias(name='AnswerEnvelope', lineno=19, col_offset=4, end_lineno=19, end_col_offset=18), alias(name='Finding', lineno=20, col_offset=4, end_lineno=20, end_col_offset=11), alias(name='MethodInfo', lineno=21, col_offset=4, end_lineno=21, end_col_offset=14), alias(name='ScopeIn', lineno=22, col_offset=4, end_lineno=22, end_col_offset=11), alias(name='StageInfo', lineno=23, col_offset=4, end_lineno=23, end_col_offset=13)], level=0, lineno=18, col_offset=0, end_lineno=24, end_col_offset=1), ImportFrom(module='codeintel_rev.mcp_server.scope_utils', names=[alias(name='get_effective_scope', lineno=25, col_offset=49, end_lineno=25, end_col_offset=68)], level=0, lineno=25, col_offset=0, end_lineno=25, end_col_offset=68), ImportFrom(module='codeintel_rev.retrieval.gating', names=[alias(name='StageGateConfig', lineno=26, col_offset=43, end_lineno=26, end_col_offset=58), alias(name='should_run_secondary_stage', lineno=26, col_offset=60, end_lineno=26, end_col_offset=86)], level=0, lineno=26, col_offset=0, end_lineno=26, end_col_offset=86), ImportFrom(module='codeintel_rev.retrieval.telemetry', names=[alias(name='StageTiming', lineno=28, col_offset=4, end_lineno=28, end_col_offset=15), alias(name='record_stage_decision', lineno=29, col_offset=4, end_lineno=29, end_col_offset=25), alias(name='record_stage_metric', lineno=30, col_offset=4, end_lineno=30, end_col_offset=23), alias(name='track_stage', lineno=31, col_offset=4, end_lineno=31, end_col_offset=15)], level=0, lineno=27, col_offset=0, end_lineno=32, end_col_offset=1), ImportFrom(module='codeintel_rev.retrieval.types', names=[alias(name='HybridResultDoc', lineno=34, col_offset=4, end_lineno=34, end_col_offset=19), alias(name='HybridSearchResult', lineno=35, col_offset=4, end_lineno=35, end_col_offset=22), alias(name='StageDecision', lineno=36, col_offset=4, end_lineno=36, end_col_offset=17), alias(name='StageSignals', lineno=37, col_offset=4, end_lineno=37, end_col_offset=16)], level=0, lineno=33, col_offset=0, end_lineno=38, end_col_offset=1), ImportFrom(module='kgfoundry_common.errors', names=[alias(name='EmbeddingError', lineno=39, col_offset=36, end_lineno=39, end_col_offset=50), alias(name='VectorSearchError', lineno=39, col_offset=52, end_lineno=39, end_col_offset=69)], level=0, lineno=39, col_offset=0, end_lineno=39, end_col_offset=69), ImportFrom(module='kgfoundry_common.logging', names=[alias(name='get_logger', lineno=40, col_offset=37, end_lineno=40, end_col_offset=47)], level=0, lineno=40, col_offset=0, end_lineno=40, end_col_offset=47), If(test=Name(id='TYPE_CHECKING', ctx=Load(), lineno=42, col_offset=3, end_lineno=42, end_col_offset=16), body=[ImportFrom(module='codeintel_rev.app.config_context', names=[alias(name='ApplicationContext', lineno=43, col_offset=49, end_lineno=43, end_col_offset=67)], level=0, lineno=43, col_offset=4, end_lineno=43, end_col_offset=67), ImportFrom(module='codeintel_rev.config.settings', names=[alias(name='XTRConfig', lineno=44, col_offset=46, end_lineno=44, end_col_offset=55)], level=0, lineno=44, col_offset=4, end_lineno=44, end_col_offset=55), ImportFrom(module='codeintel_rev.io.xtr_manager', names=[alias(name='XTRIndex', lineno=45, col_offset=45, end_lineno=45, end_col_offset=53)], level=0, lineno=45, col_offset=4, end_lineno=45, end_col_offset=53)], lineno=42, col_offset=0, end_lineno=45, end_col_offset=53), Assign(targets=[Name(id='SNIPPET_PREVIEW_CHARS', ctx=Store(), lineno=47, col_offset=0, end_lineno=47, end_col_offset=21)], value=Constant(value=500, lineno=47, col_offset=24, end_lineno=47, end_col_offset=27), lineno=47, col_offset=0, end_lineno=47, end_col_offset=27), Assign(targets=[Name(id='COMPONENT_NAME', ctx=Store(), lineno=48, col_offset=0, end_lineno=48, end_col_offset=14)], value=Constant(value='codeintel_mcp', lineno=48, col_offset=17, end_lineno=48, end_col_offset=32), lineno=48, col_offset=0, end_lineno=48, end_col_offset=32), Assign(targets=[Name(id='LOGGER', ctx=Store(), lineno=49, col_offset=0, end_lineno=49, end_col_offset=6)], value=Call(func=Name(id='get_logger', ctx=Load(), lineno=49, col_offset=9, end_lineno=49, end_col_offset=19), args=[Name(id='__name__', ctx=Load(), lineno=49, col_offset=20, end_lineno=49, end_col_offset=28)], lineno=49, col_offset=9, end_lineno=49, end_col_offset=29), lineno=49, col_offset=0, end_lineno=49, end_col_offset=29), ClassDef(name='SemanticProOptions', bases=[Name(id='TypedDict', ctx=Load(), lineno=52, col_offset=25, end_lineno=52, end_col_offset=34)], keywords=[keyword(arg='total', value=Constant(value=False, lineno=52, col_offset=42, end_lineno=52, end_col_offset=47), lineno=52, col_offset=36, end_lineno=52, end_col_offset=47)], body=[Expr(value=Constant(value='User-facing options for semantic_pro retrieval.', lineno=53, col_offset=4, end_lineno=53, end_col_offset=57), lineno=53, col_offset=4, end_lineno=53, end_col_offset=57), AnnAssign(target=Name(id='use_coderank', ctx=Store(), lineno=55, col_offset=4, end_lineno=55, end_col_offset=16), annotation=Name(id='bool', ctx=Load(), lineno=55, col_offset=18, end_lineno=55, end_col_offset=22), simple=1, lineno=55, col_offset=4, end_lineno=55, end_col_offset=22), AnnAssign(target=Name(id='use_warp', ctx=Store(), lineno=56, col_offset=4, end_lineno=56, end_col_offset=12), annotation=Name(id='bool', ctx=Load(), lineno=56, col_offset=14, end_lineno=56, end_col_offset=18), simple=1, lineno=56, col_offset=4, end_lineno=56, end_col_offset=18), AnnAssign(target=Name(id='use_reranker', ctx=Store(), lineno=57, col_offset=4, end_lineno=57, end_col_offset=16), annotation=Name(id='bool', ctx=Load(), lineno=57, col_offset=18, end_lineno=57, end_col_offset=22), simple=1, lineno=57, col_offset=4, end_lineno=57, end_col_offset=22), AnnAssign(target=Name(id='stage_weights', ctx=Store(), lineno=58, col_offset=4, end_lineno=58, end_col_offset=17), annotation=Subscript(value=Name(id='dict', ctx=Load(), lineno=58, col_offset=19, end_lineno=58, end_col_offset=23), slice=Tuple(elts=[Name(id='str', ctx=Load(), lineno=58, col_offset=24, end_lineno=58, end_col_offset=27), Name(id='float', ctx=Load(), lineno=58, col_offset=29, end_lineno=58, end_col_offset=34)], ctx=Load(), lineno=58, col_offset=24, end_lineno=58, end_col_offset=34), ctx=Load(), lineno=58, col_offset=19, end_lineno=58, end_col_offset=35), simple=1, lineno=58, col_offset=4, end_lineno=58, end_col_offset=35), AnnAssign(target=Name(id='explain', ctx=Store(), lineno=59, col_offset=4, end_lineno=59, end_col_offset=11), annotation=Name(id='bool', ctx=Load(), lineno=59, col_offset=13, end_lineno=59, end_col_offset=17), simple=1, lineno=59, col_offset=4, end_lineno=59, end_col_offset=17), AnnAssign(target=Name(id='xtr_k', ctx=Store(), lineno=60, col_offset=4, end_lineno=60, end_col_offset=9), annotation=Name(id='int', ctx=Load(), lineno=60, col_offset=11, end_lineno=60, end_col_offset=14), simple=1, lineno=60, col_offset=4, end_lineno=60, end_col_offset=14)], lineno=52, col_offset=0, end_lineno=60, end_col_offset=14), ClassDef(name='SemanticProRuntimeOptions', body=[Expr(value=Constant(value='Internal immutable representation of semantic_pro options.', lineno=65, col_offset=4, end_lineno=65, end_col_offset=68), lineno=65, col_offset=4, end_lineno=65, end_col_offset=68), AnnAssign(target=Name(id='use_coderank', ctx=Store(), lineno=67, col_offset=4, end_lineno=67, end_col_offset=16), annotation=Name(id='bool', ctx=Load(), lineno=67, col_offset=18, end_lineno=67, end_col_offset=22), value=Constant(value=True, lineno=67, col_offset=25, end_lineno=67, end_col_offset=29), simple=1, lineno=67, col_offset=4, end_lineno=67, end_col_offset=29), AnnAssign(target=Name(id='use_warp', ctx=Store(), lineno=68, col_offset=4, end_lineno=68, end_col_offset=12), annotation=Name(id='bool', ctx=Load(), lineno=68, col_offset=14, end_lineno=68, end_col_offset=18), value=Constant(value=True, lineno=68, col_offset=21, end_lineno=68, end_col_offset=25), simple=1, lineno=68, col_offset=4, end_lineno=68, end_col_offset=25), AnnAssign(target=Name(id='use_reranker', ctx=Store(), lineno=69, col_offset=4, end_lineno=69, end_col_offset=16), annotation=Name(id='bool', ctx=Load(), lineno=69, col_offset=18, end_lineno=69, end_col_offset=22), value=Constant(value=False, lineno=69, col_offset=25, end_lineno=69, end_col_offset=30), simple=1, lineno=69, col_offset=4, end_lineno=69, end_col_offset=30), AnnAssign(target=Name(id='stage_weights', ctx=Store(), lineno=70, col_offset=4, end_lineno=70, end_col_offset=17), annotation=Subscript(value=Name(id='dict', ctx=Load(), lineno=70, col_offset=19, end_lineno=70, end_col_offset=23), slice=Tuple(elts=[Name(id='str', ctx=Load(), lineno=70, col_offset=24, end_lineno=70, end_col_offset=27), Name(id='float', ctx=Load(), lineno=70, col_offset=29, end_lineno=70, end_col_offset=34)], ctx=Load(), lineno=70, col_offset=24, end_lineno=70, end_col_offset=34), ctx=Load(), lineno=70, col_offset=19, end_lineno=70, end_col_offset=35), value=Call(func=Name(id='field', ctx=Load(), lineno=70, col_offset=38, end_lineno=70, end_col_offset=43), keywords=[keyword(arg='default_factory', value=Name(id='dict', ctx=Load(), lineno=70, col_offset=60, end_lineno=70, end_col_offset=64), lineno=70, col_offset=44, end_lineno=70, end_col_offset=64)], lineno=70, col_offset=38, end_lineno=70, end_col_offset=65), simple=1, lineno=70, col_offset=4, end_lineno=70, end_col_offset=65), AnnAssign(target=Name(id='explain', ctx=Store(), lineno=71, col_offset=4, end_lineno=71, end_col_offset=11), annotation=Name(id='bool', ctx=Load(), lineno=71, col_offset=13, end_lineno=71, end_col_offset=17), value=Constant(value=True, lineno=71, col_offset=20, end_lineno=71, end_col_offset=24), simple=1, lineno=71, col_offset=4, end_lineno=71, end_col_offset=24), AnnAssign(target=Name(id='xtr_k', ctx=Store(), lineno=72, col_offset=4, end_lineno=72, end_col_offset=9), annotation=BinOp(left=Name(id='int', ctx=Load(), lineno=72, col_offset=11, end_lineno=72, end_col_offset=14), op=BitOr(), right=Constant(value=None, lineno=72, col_offset=17, end_lineno=72, end_col_offset=21), lineno=72, col_offset=11, end_lineno=72, end_col_offset=21), value=Constant(value=None, lineno=72, col_offset=24, end_lineno=72, end_col_offset=28), simple=1, lineno=72, col_offset=4, end_lineno=72, end_col_offset=28)], decorator_list=[Call(func=Name(id='dataclass', ctx=Load(), lineno=63, col_offset=1, end_lineno=63, end_col_offset=10), keywords=[keyword(arg='frozen', value=Constant(value=True, lineno=63, col_offset=18, end_lineno=63, end_col_offset=22), lineno=63, col_offset=11, end_lineno=63, end_col_offset=22)], lineno=63, col_offset=1, end_lineno=63, end_col_offset=23)], lineno=64, col_offset=0, end_lineno=72, end_col_offset=28), Assign(targets=[Name(id='WideSearchHandle', ctx=Store(), lineno=75, col_offset=0, end_lineno=75, end_col_offset=16)], value=Subscript(value=Name(id='tuple', ctx=Load(), lineno=75, col_offset=19, end_lineno=75, end_col_offset=24), slice=Tuple(elts=[Subscript(value=Name(id='Future', ctx=Load(), lineno=75, col_offset=25, end_lineno=75, end_col_offset=31), slice=Constant(value='WarpOutcome', lineno=75, col_offset=32, end_lineno=75, end_col_offset=45), ctx=Load(), lineno=75, col_offset=25, end_lineno=75, end_col_offset=46), Name(id='ThreadPoolExecutor', ctx=Load(), lineno=75, col_offset=48, end_lineno=75, end_col_offset=66)], ctx=Load(), lineno=75, col_offset=25, end_lineno=75, end_col_offset=66), ctx=Load(), lineno=75, col_offset=19, end_lineno=75, end_col_offset=67), lineno=75, col_offset=0, end_lineno=75, end_col_offset=67), ClassDef(name='StageOnePlan', body=[Expr(value=Constant(value='Container for Stage-1 orchestration inputs to reduce argument lists.', lineno=80, col_offset=4, end_lineno=80, end_col_offset=78), lineno=80, col_offset=4, end_lineno=80, end_col_offset=78), AnnAssign(target=Name(id='context', ctx=Store(), lineno=82, col_offset=4, end_lineno=82, end_col_offset=11), annotation=Name(id='ApplicationContext', ctx=Load(), lineno=82, col_offset=13, end_lineno=82, end_col_offset=31), simple=1, lineno=82, col_offset=4, end_lineno=82, end_col_offset=31), AnnAssign(target=Name(id='query', ctx=Store(), lineno=83, col_offset=4, end_lineno=83, end_col_offset=9), annotation=Name(id='str', ctx=Load(), lineno=83, col_offset=11, end_lineno=83, end_col_offset=14), simple=1, lineno=83, col_offset=4, end_lineno=83, end_col_offset=14), AnnAssign(target=Name(id='candidates', ctx=Store(), lineno=84, col_offset=4, end_lineno=84, end_col_offset=14), annotation=Subscript(value=Name(id='Sequence', ctx=Load(), lineno=84, col_offset=16, end_lineno=84, end_col_offset=24), slice=Subscript(value=Name(id='tuple', ctx=Load(), lineno=84, col_offset=25, end_lineno=84, end_col_offset=30), slice=Tuple(elts=[Name(id='int', ctx=Load(), lineno=84, col_offset=31, end_lineno=84, end_col_offset=34), Name(id='float', ctx=Load(), lineno=84, col_offset=36, end_lineno=84, end_col_offset=41)], ctx=Load(), lineno=84, col_offset=31, end_lineno=84, end_col_offset=41), ctx=Load(), lineno=84, col_offset=25, end_lineno=84, end_col_offset=42), ctx=Load(), lineno=84, col_offset=16, end_lineno=84, end_col_offset=43), simple=1, lineno=84, col_offset=4, end_lineno=84, end_col_offset=43), AnnAssign(target=Name(id='options', ctx=Store(), lineno=85, col_offset=4, end_lineno=85, end_col_offset=11), annotation=Name(id='SemanticProRuntimeOptions', ctx=Load(), lineno=85, col_offset=13, end_lineno=85, end_col_offset=38), simple=1, lineno=85, col_offset=4, end_lineno=85, end_col_offset=38), AnnAssign(target=Name(id='coderank_stage', ctx=Store(), lineno=86, col_offset=4, end_lineno=86, end_col_offset=18), annotation=Name(id='StageTiming', ctx=Load(), lineno=86, col_offset=20, end_lineno=86, end_col_offset=31), simple=1, lineno=86, col_offset=4, end_lineno=86, end_col_offset=31), AnnAssign(target=Name(id='wide_handle', ctx=Store(), lineno=87, col_offset=4, end_lineno=87, end_col_offset=15), annotation=BinOp(left=Name(id='WideSearchHandle', ctx=Load(), lineno=87, col_offset=17, end_lineno=87, end_col_offset=33), op=BitOr(), right=Constant(value=None, lineno=87, col_offset=36, end_lineno=87, end_col_offset=40), lineno=87, col_offset=17, end_lineno=87, end_col_offset=40), simple=1, lineno=87, col_offset=4, end_lineno=87, end_col_offset=40)], decorator_list=[Call(func=Name(id='dataclass', ctx=Load(), lineno=78, col_offset=1, end_lineno=78, end_col_offset=10), keywords=[keyword(arg='slots', value=Constant(value=True, lineno=78, col_offset=17, end_lineno=78, end_col_offset=21), lineno=78, col_offset=11, end_lineno=78, end_col_offset=21), keyword(arg='frozen', value=Constant(value=True, lineno=78, col_offset=30, end_lineno=78, end_col_offset=34), lineno=78, col_offset=23, end_lineno=78, end_col_offset=34)], lineno=78, col_offset=1, end_lineno=78, end_col_offset=35)], lineno=79, col_offset=0, end_lineno=87, end_col_offset=40), ClassDef(name='HydrationPlan', body=[Expr(value=Constant(value='Hydration plus rerank inputs passed as a cohesive plan.', lineno=92, col_offset=4, end_lineno=92, end_col_offset=65), lineno=92, col_offset=4, end_lineno=92, end_col_offset=65), AnnAssign(target=Name(id='context', ctx=Store(), lineno=94, col_offset=4, end_lineno=94, end_col_offset=11), annotation=Name(id='ApplicationContext', ctx=Load(), lineno=94, col_offset=13, end_lineno=94, end_col_offset=31), simple=1, lineno=94, col_offset=4, end_lineno=94, end_col_offset=31), AnnAssign(target=Name(id='query', ctx=Store(), lineno=95, col_offset=4, end_lineno=95, end_col_offset=9), annotation=Name(id='str', ctx=Load(), lineno=95, col_offset=11, end_lineno=95, end_col_offset=14), simple=1, lineno=95, col_offset=4, end_lineno=95, end_col_offset=14), AnnAssign(target=Name(id='fused', ctx=Store(), lineno=96, col_offset=4, end_lineno=96, end_col_offset=9), annotation=Name(id='HybridSearchResult', ctx=Load(), lineno=96, col_offset=11, end_lineno=96, end_col_offset=29), simple=1, lineno=96, col_offset=4, end_lineno=96, end_col_offset=29), AnnAssign(target=Name(id='scope', ctx=Store(), lineno=97, col_offset=4, end_lineno=97, end_col_offset=9), annotation=BinOp(left=Name(id='ScopeIn', ctx=Load(), lineno=97, col_offset=11, end_lineno=97, end_col_offset=18), op=BitOr(), right=Constant(value=None, lineno=97, col_offset=21, end_lineno=97, end_col_offset=25), lineno=97, col_offset=11, end_lineno=97, end_col_offset=25), simple=1, lineno=97, col_offset=4, end_lineno=97, end_col_offset=25), AnnAssign(target=Name(id='effective_limit', ctx=Store(), lineno=98, col_offset=4, end_lineno=98, end_col_offset=19), annotation=Name(id='int', ctx=Load(), lineno=98, col_offset=21, end_lineno=98, end_col_offset=24), simple=1, lineno=98, col_offset=4, end_lineno=98, end_col_offset=24), AnnAssign(target=Name(id='options', ctx=Store(), lineno=99, col_offset=4, end_lineno=99, end_col_offset=11), annotation=Name(id='SemanticProRuntimeOptions', ctx=Load(), lineno=99, col_offset=13, end_lineno=99, end_col_offset=38), simple=1, lineno=99, col_offset=4, end_lineno=99, end_col_offset=38), AnnAssign(target=Name(id='observation', ctx=Store(), lineno=100, col_offset=4, end_lineno=100, end_col_offset=15), annotation=Name(id='Observation', ctx=Load(), lineno=100, col_offset=17, end_lineno=100, end_col_offset=28), simple=1, lineno=100, col_offset=4, end_lineno=100, end_col_offset=28)], decorator_list=[Call(func=Name(id='dataclass', ctx=Load(), lineno=90, col_offset=1, end_lineno=90, end_col_offset=10), keywords=[keyword(arg='slots', value=Constant(value=True, lineno=90, col_offset=17, end_lineno=90, end_col_offset=21), lineno=90, col_offset=11, end_lineno=90, end_col_offset=21), keyword(arg='frozen', value=Constant(value=True, lineno=90, col_offset=30, end_lineno=90, end_col_offset=34), lineno=90, col_offset=23, end_lineno=90, end_col_offset=34)], lineno=90, col_offset=1, end_lineno=90, end_col_offset=35)], lineno=91, col_offset=0, end_lineno=100, end_col_offset=28), FunctionDef(name='build_runtime_options', args=arguments(args=[arg(arg='options', annotation=BinOp(left=Name(id='SemanticProOptions', ctx=Load(), lineno=104, col_offset=13, end_lineno=104, end_col_offset=31), op=BitOr(), right=Constant(value=None, lineno=104, col_offset=34, end_lineno=104, end_col_offset=38), lineno=104, col_offset=13, end_lineno=104, end_col_offset=38), lineno=104, col_offset=4, end_lineno=104, end_col_offset=38)]), body=[Expr(value=Constant(value='Normalize user-supplied options into an immutable dataclass.\n\n    Extended Summary\n    ----------------\n    This function converts user-facing TypedDict options into an internal immutable\n    dataclass representation with defaults applied. It serves as the boundary between\n    the MCP server\'s request schema and the internal retrieval pipeline, ensuring\n    type safety and providing sensible defaults for optional configuration. The\n    function is called once per semantic_pro request to prepare runtime options\n    for the two-stage retrieval pipeline (CodeRank → optional WARP → optional reranker).\n\n    Parameters\n    ----------\n    options : SemanticProOptions | None\n        User-supplied options dictionary. May be ``None`` to use all defaults.\n        Keys include: ``use_coderank`` (default True), ``use_warp`` (default True),\n        ``use_reranker`` (default False), ``stage_weights`` (default empty dict),\n        ``explain`` (default True). Missing keys are filled with defaults.\n\n    Returns\n    -------\n    SemanticProRuntimeOptions\n        Immutable dataclass instance with normalized options. All fields have\n        defaults applied, ensuring the returned value is always valid for pipeline\n        execution.\n\n    Notes\n    -----\n    Time complexity O(1). No I/O or side effects. The function performs a shallow\n    copy of stage_weights to ensure immutability of the returned dataclass.\n\n    Examples\n    --------\n    >>> opts = build_runtime_options(None)\n    >>> opts.use_coderank\n    True\n    >>> opts.use_warp\n    True\n    >>> opts.use_reranker\n    False\n    >>> user_opts = {"use_warp": False, "use_reranker": True}\n    >>> opts = build_runtime_options(user_opts)\n    >>> opts.use_warp\n    False\n    >>> opts.use_reranker\n    True\n    ', lineno=106, col_offset=4, end_lineno=152, end_col_offset=7), lineno=106, col_offset=4, end_lineno=152, end_col_offset=7), If(test=Compare(left=Name(id='options', ctx=Load(), lineno=153, col_offset=7, end_lineno=153, end_col_offset=14), ops=[Is()], comparators=[Constant(value=None, lineno=153, col_offset=18, end_lineno=153, end_col_offset=22)], lineno=153, col_offset=7, end_lineno=153, end_col_offset=22), body=[Return(value=Call(func=Name(id='SemanticProRuntimeOptions', ctx=Load(), lineno=154, col_offset=15, end_lineno=154, end_col_offset=40), lineno=154, col_offset=15, end_lineno=154, end_col_offset=42), lineno=154, col_offset=8, end_lineno=154, end_col_offset=42)], lineno=153, col_offset=4, end_lineno=154, end_col_offset=42), Assign(targets=[Name(id='xtr_k_value', ctx=Store(), lineno=155, col_offset=4, end_lineno=155, end_col_offset=15)], value=Call(func=Attribute(value=Name(id='options', ctx=Load(), lineno=155, col_offset=18, end_lineno=155, end_col_offset=25), attr='get', ctx=Load(), lineno=155, col_offset=18, end_lineno=155, end_col_offset=29), args=[Constant(value='xtr_k', lineno=155, col_offset=30, end_lineno=155, end_col_offset=37)], lineno=155, col_offset=18, end_lineno=155, end_col_offset=38), lineno=155, col_offset=4, end_lineno=155, end_col_offset=38), Assign(targets=[Name(id='parsed_xtr_k', ctx=Store(), lineno=156, col_offset=4, end_lineno=156, end_col_offset=16)], value=Constant(value=None, lineno=156, col_offset=19, end_lineno=156, end_col_offset=23), lineno=156, col_offset=4, end_lineno=156, end_col_offset=23), If(test=Compare(left=Name(id='xtr_k_value', ctx=Load(), lineno=157, col_offset=7, end_lineno=157, end_col_offset=18), ops=[IsNot()], comparators=[Constant(value=None, lineno=157, col_offset=26, end_lineno=157, end_col_offset=30)], lineno=157, col_offset=7, end_lineno=157, end_col_offset=30), body=[Try(body=[Assign(targets=[Name(id='parsed_xtr_k', ctx=Store(), lineno=159, col_offset=12, end_lineno=159, end_col_offset=24)], value=Call(func=Name(id='int', ctx=Load(), lineno=159, col_offset=27, end_lineno=159, end_col_offset=30), args=[Name(id='xtr_k_value', ctx=Load(), lineno=159, col_offset=31, end_lineno=159, end_col_offset=42)], lineno=159, col_offset=27, end_lineno=159, end_col_offset=43), lineno=159, col_offset=12, end_lineno=159, end_col_offset=43)], handlers=[ExceptHandler(type=Tuple(elts=[Name(id='TypeError', ctx=Load(), lineno=160, col_offset=16, end_lineno=160, end_col_offset=25), Name(id='ValueError', ctx=Load(), lineno=160, col_offset=27, end_lineno=160, end_col_offset=37)], ctx=Load(), lineno=160, col_offset=15, end_lineno=160, end_col_offset=38), body=[Expr(value=Call(func=Attribute(value=Name(id='LOGGER', ctx=Load(), lineno=161, col_offset=12, end_lineno=161, end_col_offset=18), attr='warning', ctx=Load(), lineno=161, col_offset=12, end_lineno=161, end_col_offset=26), args=[Constant(value='Ignoring non-numeric xtr_k override', lineno=162, col_offset=16, end_lineno=162, end_col_offset=53)], keywords=[keyword(arg='extra', value=Dict(keys=[Constant(value='value', lineno=163, col_offset=23, end_lineno=163, end_col_offset=30)], values=[Name(id='xtr_k_value', ctx=Load(), lineno=163, col_offset=32, end_lineno=163, end_col_offset=43)], lineno=163, col_offset=22, end_lineno=163, end_col_offset=44), lineno=163, col_offset=16, end_lineno=163, end_col_offset=44)], lineno=161, col_offset=12, end_lineno=164, end_col_offset=13), lineno=161, col_offset=12, end_lineno=164, end_col_offset=13)], lineno=160, col_offset=8, end_lineno=164, end_col_offset=13)], lineno=158, col_offset=8, end_lineno=164, end_col_offset=13)], lineno=157, col_offset=4, end_lineno=164, end_col_offset=13), Return(value=Call(func=Name(id='SemanticProRuntimeOptions', ctx=Load(), lineno=165, col_offset=11, end_lineno=165, end_col_offset=36), keywords=[keyword(arg='use_coderank', value=Call(func=Attribute(value=Name(id='options', ctx=Load(), lineno=166, col_offset=21, end_lineno=166, end_col_offset=28), attr='get', ctx=Load(), lineno=166, col_offset=21, end_lineno=166, end_col_offset=32), args=[Constant(value='use_coderank', lineno=166, col_offset=33, end_lineno=166, end_col_offset=47), Constant(value=True, lineno=166, col_offset=49, end_lineno=166, end_col_offset=53)], lineno=166, col_offset=21, end_lineno=166, end_col_offset=54), lineno=166, col_offset=8, end_lineno=166, end_col_offset=54), keyword(arg='use_warp', value=Call(func=Attribute(value=Name(id='options', ctx=Load(), lineno=167, col_offset=17, end_lineno=167, end_col_offset=24), attr='get', ctx=Load(), lineno=167, col_offset=17, end_lineno=167, end_col_offset=28), args=[Constant(value='use_warp', lineno=167, col_offset=29, end_lineno=167, end_col_offset=39), Constant(value=True, lineno=167, col_offset=41, end_lineno=167, end_col_offset=45)], lineno=167, col_offset=17, end_lineno=167, end_col_offset=46), lineno=167, col_offset=8, end_lineno=167, end_col_offset=46), keyword(arg='use_reranker', value=Call(func=Attribute(value=Name(id='options', ctx=Load(), lineno=168, col_offset=21, end_lineno=168, end_col_offset=28), attr='get', ctx=Load(), lineno=168, col_offset=21, end_lineno=168, end_col_offset=32), args=[Constant(value='use_reranker', lineno=168, col_offset=33, end_lineno=168, end_col_offset=47), Constant(value=False, lineno=168, col_offset=49, end_lineno=168, end_col_offset=54)], lineno=168, col_offset=21, end_lineno=168, end_col_offset=55), lineno=168, col_offset=8, end_lineno=168, end_col_offset=55), keyword(arg='stage_weights', value=Call(func=Name(id='dict', ctx=Load(), lineno=169, col_offset=22, end_lineno=169, end_col_offset=26), args=[Call(func=Attribute(value=Name(id='options', ctx=Load(), lineno=169, col_offset=27, end_lineno=169, end_col_offset=34), attr='get', ctx=Load(), lineno=169, col_offset=27, end_lineno=169, end_col_offset=38), args=[Constant(value='stage_weights', lineno=169, col_offset=39, end_lineno=169, end_col_offset=54), Dict(lineno=169, col_offset=56, end_lineno=169, end_col_offset=58)], lineno=169, col_offset=27, end_lineno=169, end_col_offset=59)], lineno=169, col_offset=22, end_lineno=169, end_col_offset=60), lineno=169, col_offset=8, end_lineno=169, end_col_offset=60), keyword(arg='explain', value=Call(func=Attribute(value=Name(id='options', ctx=Load(), lineno=170, col_offset=16, end_lineno=170, end_col_offset=23), attr='get', ctx=Load(), lineno=170, col_offset=16, end_lineno=170, end_col_offset=27), args=[Constant(value='explain', lineno=170, col_offset=28, end_lineno=170, end_col_offset=37), Constant(value=True, lineno=170, col_offset=39, end_lineno=170, end_col_offset=43)], lineno=170, col_offset=16, end_lineno=170, end_col_offset=44), lineno=170, col_offset=8, end_lineno=170, end_col_offset=44), keyword(arg='xtr_k', value=Name(id='parsed_xtr_k', ctx=Load(), lineno=171, col_offset=14, end_lineno=171, end_col_offset=26), lineno=171, col_offset=8, end_lineno=171, end_col_offset=26)], lineno=165, col_offset=11, end_lineno=172, end_col_offset=5), lineno=165, col_offset=4, end_lineno=172, end_col_offset=5)], returns=Name(id='SemanticProRuntimeOptions', ctx=Load(), lineno=105, col_offset=5, end_lineno=105, end_col_offset=30), lineno=103, col_offset=0, end_lineno=172, end_col_offset=5), AsyncFunctionDef(name='semantic_search_pro', args=arguments(args=[arg(arg='context', annotation=Name(id='ApplicationContext', ctx=Load(), lineno=176, col_offset=13, end_lineno=176, end_col_offset=31), lineno=176, col_offset=4, end_lineno=176, end_col_offset=31)], kwonlyargs=[arg(arg='query', annotation=Name(id='str', ctx=Load(), lineno=178, col_offset=11, end_lineno=178, end_col_offset=14), lineno=178, col_offset=4, end_lineno=178, end_col_offset=14), arg(arg='limit', annotation=Name(id='int', ctx=Load(), lineno=179, col_offset=11, end_lineno=179, end_col_offset=14), lineno=179, col_offset=4, end_lineno=179, end_col_offset=14), arg(arg='options', annotation=BinOp(left=Name(id='SemanticProOptions', ctx=Load(), lineno=180, col_offset=13, end_lineno=180, end_col_offset=31), op=BitOr(), right=Constant(value=None, lineno=180, col_offset=34, end_lineno=180, end_col_offset=38), lineno=180, col_offset=13, end_lineno=180, end_col_offset=38), lineno=180, col_offset=4, end_lineno=180, end_col_offset=38)], kw_defaults=[None, None, Constant(value=None, lineno=180, col_offset=41, end_lineno=180, end_col_offset=45)]), body=[Expr(value=Constant(value='Execute the two-stage semantic search pipeline (CodeRank → optional WARP → optional reranker).\n\n    Extended Summary\n    ----------------\n    This async function orchestrates the semantic_pro retrieval pipeline, which combines\n    CodeRank dense vector search with optional WARP late-interaction reranking and optional\n    CodeRankLLM listwise reranking. The function normalizes options, resolves scope filters,\n    executes stages conditionally based on gating logic and user preferences, fuses results\n    using weighted RRF, hydrates metadata from DuckDB, and assembles the final AnswerEnvelope\n    with findings, explanations, and telemetry. It is the primary entry point for semantic\n    code search in the MCP server, providing high-quality ranked results with explainability\n    and performance budgets.\n\n    Parameters\n    ----------\n    context : ApplicationContext\n        Application context containing settings, paths, and initialized components\n        (FAISS managers, embedders, catalog). Must have valid CodeRank FAISS index\n        and catalog configured.\n    query : str\n        Natural language search query. Will be embedded using CodeRank embedder\n        and optionally processed by WARP for late-interaction scoring.\n    limit : int\n        Maximum number of results to return. Will be clamped to the configured\n        max_results limit. Must be positive.\n    options : SemanticProOptions | None, optional\n        User-supplied pipeline options. Controls which stages run (use_coderank,\n        use_warp, use_reranker), fusion weights (stage_weights), and whether to\n        include explanations (explain). Defaults to None (all defaults applied).\n\n    Returns\n    -------\n    AnswerEnvelope\n        Search results envelope containing:\n        - ``answer``: Human-readable summary string\n        - ``findings``: List of Finding objects with location, snippet, score, and optional why\n        - ``method``: Retrieval metadata including channels used, coverage, and stage timings\n        - ``limits``: Optional list of warnings about budget overruns or limit clamping\n        - ``scope``: Optional scope filters that were applied\n        - ``query_kind``: Always "semantic_pro"\n        - ``confidence``: Float between 0.0 and 1.0\n\n    Raises\n    ------\n    VectorSearchError\n        If limit is not positive, CodeRank FAISS index is missing, search fails,\n        or DuckDB hydration fails. All errors include Problem Details context.\n\n    Notes\n    -----\n    Time complexity dominated by I/O: embedding (O(1) queries), FAISS search (O(k log n)\n    where k is fanout and n is index size), WARP reranking (O(m * d) where m is candidates\n    and d is sequence length), fusion (O(n * c) where n is hits and c is channels), DuckDB\n    hydration (O(r) where r is result count), optional reranking (O(r * model_latency)).\n    The function performs extensive I/O (FAISS, DuckDB, optional GPU models) and is not\n    thread-safe (uses context managers and shared state). Performance budgets are tracked\n    per stage and violations are reported in the limits field. The function uses asyncio\n    to offload synchronous work to a thread pool. Note that EmbeddingError may be propagated\n    from downstream functions (e.g., CodeRank embedder failures) but is wrapped as VectorSearchError\n    at the API boundary.\n\n    Examples\n    --------\n    >>> # Minimal example (requires ApplicationContext setup)\n    >>> # from codeintel_rev.app.config_context import ApplicationContext\n    >>> # context = ApplicationContext(...)\n    >>> # results = await semantic_search_pro(context, query="vector store", limit=10)\n    >>> # assert results["query_kind"] == "semantic_pro"\n    >>> # assert len(results["findings"]) <= 10\n    ', lineno=182, col_offset=4, end_lineno=251, end_col_offset=7), lineno=182, col_offset=4, end_lineno=251, end_col_offset=7), If(test=Compare(left=Name(id='limit', ctx=Load(), lineno=252, col_offset=7, end_lineno=252, end_col_offset=12), ops=[LtE()], comparators=[Constant(value=0, lineno=252, col_offset=16, end_lineno=252, end_col_offset=17)], lineno=252, col_offset=7, end_lineno=252, end_col_offset=17), body=[Assign(targets=[Name(id='msg', ctx=Store(), lineno=253, col_offset=8, end_lineno=253, end_col_offset=11)], value=JoinedStr(values=[Constant(value='limit must be positive, got ', lineno=253, col_offset=16, end_lineno=253, end_col_offset=44), FormattedValue(value=Name(id='limit', ctx=Load(), lineno=253, col_offset=45, end_lineno=253, end_col_offset=50), conversion=-1, lineno=253, col_offset=44, end_lineno=253, end_col_offset=51)], lineno=253, col_offset=14, end_lineno=253, end_col_offset=52), lineno=253, col_offset=8, end_lineno=253, end_col_offset=52), Raise(exc=Call(func=Name(id='VectorSearchError', ctx=Load(), lineno=254, col_offset=14, end_lineno=254, end_col_offset=31), args=[Name(id='msg', ctx=Load(), lineno=254, col_offset=32, end_lineno=254, end_col_offset=35)], lineno=254, col_offset=14, end_lineno=254, end_col_offset=36), lineno=254, col_offset=8, end_lineno=254, end_col_offset=36)], lineno=252, col_offset=4, end_lineno=254, end_col_offset=36), Assign(targets=[Name(id='runtime_options', ctx=Store(), lineno=255, col_offset=4, end_lineno=255, end_col_offset=19)], value=Call(func=Name(id='build_runtime_options', ctx=Load(), lineno=255, col_offset=22, end_lineno=255, end_col_offset=43), args=[Name(id='options', ctx=Load(), lineno=255, col_offset=44, end_lineno=255, end_col_offset=51)], lineno=255, col_offset=22, end_lineno=255, end_col_offset=52), lineno=255, col_offset=4, end_lineno=255, end_col_offset=52), Assign(targets=[Name(id='session_id', ctx=Store(), lineno=256, col_offset=4, end_lineno=256, end_col_offset=14)], value=Call(func=Name(id='get_session_id', ctx=Load(), lineno=256, col_offset=17, end_lineno=256, end_col_offset=31), lineno=256, col_offset=17, end_lineno=256, end_col_offset=33), lineno=256, col_offset=4, end_lineno=256, end_col_offset=33), Assign(targets=[Name(id='scope', ctx=Store(), lineno=257, col_offset=4, end_lineno=257, end_col_offset=9)], value=Await(value=Call(func=Name(id='get_effective_scope', ctx=Load(), lineno=257, col_offset=18, end_lineno=257, end_col_offset=37), args=[Name(id='context', ctx=Load(), lineno=257, col_offset=38, end_lineno=257, end_col_offset=45), Name(id='session_id', ctx=Load(), lineno=257, col_offset=47, end_lineno=257, end_col_offset=57)], lineno=257, col_offset=18, end_lineno=257, end_col_offset=58), lineno=257, col_offset=12, end_lineno=257, end_col_offset=58), lineno=257, col_offset=4, end_lineno=257, end_col_offset=58), Return(value=Await(value=Call(func=Attribute(value=Name(id='asyncio', ctx=Load(), lineno=258, col_offset=17, end_lineno=258, end_col_offset=24), attr='to_thread', ctx=Load(), lineno=258, col_offset=17, end_lineno=258, end_col_offset=34), args=[Name(id='_semantic_search_pro_sync', ctx=Load(), lineno=259, col_offset=8, end_lineno=259, end_col_offset=33), Name(id='context', ctx=Load(), lineno=260, col_offset=8, end_lineno=260, end_col_offset=15), Name(id='query', ctx=Load(), lineno=261, col_offset=8, end_lineno=261, end_col_offset=13), Name(id='limit', ctx=Load(), lineno=262, col_offset=8, end_lineno=262, end_col_offset=13), Name(id='scope', ctx=Load(), lineno=263, col_offset=8, end_lineno=263, end_col_offset=13), Name(id='runtime_options', ctx=Load(), lineno=264, col_offset=8, end_lineno=264, end_col_offset=23)], lineno=258, col_offset=17, end_lineno=265, end_col_offset=5), lineno=258, col_offset=11, end_lineno=265, end_col_offset=5), lineno=258, col_offset=4, end_lineno=265, end_col_offset=5)], returns=Name(id='AnswerEnvelope', ctx=Load(), lineno=181, col_offset=5, end_lineno=181, end_col_offset=19), lineno=175, col_offset=0, end_lineno=265, end_col_offset=5), FunctionDef(name='_semantic_search_pro_sync', args=arguments(args=[arg(arg='context', annotation=Name(id='ApplicationContext', ctx=Load(), lineno=269, col_offset=13, end_lineno=269, end_col_offset=31), lineno=269, col_offset=4, end_lineno=269, end_col_offset=31), arg(arg='query', annotation=Name(id='str', ctx=Load(), lineno=270, col_offset=11, end_lineno=270, end_col_offset=14), lineno=270, col_offset=4, end_lineno=270, end_col_offset=14), arg(arg='limit', annotation=Name(id='int', ctx=Load(), lineno=271, col_offset=11, end_lineno=271, end_col_offset=14), lineno=271, col_offset=4, end_lineno=271, end_col_offset=14), arg(arg='scope', annotation=BinOp(left=Name(id='ScopeIn', ctx=Load(), lineno=272, col_offset=11, end_lineno=272, end_col_offset=18), op=BitOr(), right=Constant(value=None, lineno=272, col_offset=21, end_lineno=272, end_col_offset=25), lineno=272, col_offset=11, end_lineno=272, end_col_offset=25), lineno=272, col_offset=4, end_lineno=272, end_col_offset=25), arg(arg='options', annotation=Name(id='SemanticProRuntimeOptions', ctx=Load(), lineno=273, col_offset=13, end_lineno=273, end_col_offset=38), lineno=273, col_offset=4, end_lineno=273, end_col_offset=38)]), body=[If(test=UnaryOp(op=Not(), operand=Attribute(value=Name(id='options', ctx=Load(), lineno=275, col_offset=11, end_lineno=275, end_col_offset=18), attr='use_coderank', ctx=Load(), lineno=275, col_offset=11, end_lineno=275, end_col_offset=31), lineno=275, col_offset=7, end_lineno=275, end_col_offset=31), body=[Assign(targets=[Name(id='msg', ctx=Store(), lineno=276, col_offset=8, end_lineno=276, end_col_offset=11)], value=Constant(value='CodeRank stage must be enabled; disable warp/reranker instead if needed.', lineno=276, col_offset=14, end_lineno=276, end_col_offset=88), lineno=276, col_offset=8, end_lineno=276, end_col_offset=88), Raise(exc=Call(func=Name(id='VectorSearchError', ctx=Load(), lineno=277, col_offset=14, end_lineno=277, end_col_offset=31), args=[Name(id='msg', ctx=Load(), lineno=277, col_offset=32, end_lineno=277, end_col_offset=35)], lineno=277, col_offset=14, end_lineno=277, end_col_offset=36), lineno=277, col_offset=8, end_lineno=277, end_col_offset=36)], lineno=275, col_offset=4, end_lineno=277, end_col_offset=36), Assign(targets=[Name(id='start_time', ctx=Store(), lineno=279, col_offset=4, end_lineno=279, end_col_offset=14)], value=Call(func=Name(id='perf_counter', ctx=Load(), lineno=279, col_offset=17, end_lineno=279, end_col_offset=29), lineno=279, col_offset=17, end_lineno=279, end_col_offset=31), lineno=279, col_offset=4, end_lineno=279, end_col_offset=31), AnnAssign(target=Name(id='stage_timings', ctx=Store(), lineno=280, col_offset=4, end_lineno=280, end_col_offset=17), annotation=Subscript(value=Name(id='list', ctx=Load(), lineno=280, col_offset=19, end_lineno=280, end_col_offset=23), slice=Name(id='StageTiming', ctx=Load(), lineno=280, col_offset=24, end_lineno=280, end_col_offset=35), ctx=Load(), lineno=280, col_offset=19, end_lineno=280, end_col_offset=36), value=List(ctx=Load(), lineno=280, col_offset=39, end_lineno=280, end_col_offset=41), simple=1, lineno=280, col_offset=4, end_lineno=280, end_col_offset=41), AnnAssign(target=Name(id='limits', ctx=Store(), lineno=281, col_offset=4, end_lineno=281, end_col_offset=10), annotation=Subscript(value=Name(id='list', ctx=Load(), lineno=281, col_offset=12, end_lineno=281, end_col_offset=16), slice=Name(id='str', ctx=Load(), lineno=281, col_offset=17, end_lineno=281, end_col_offset=20), ctx=Load(), lineno=281, col_offset=12, end_lineno=281, end_col_offset=21), value=List(ctx=Load(), lineno=281, col_offset=24, end_lineno=281, end_col_offset=26), simple=1, lineno=281, col_offset=4, end_lineno=281, end_col_offset=26), With(items=[withitem(context_expr=Call(func=Name(id='observe_duration', ctx=Load(), lineno=282, col_offset=9, end_lineno=282, end_col_offset=25), args=[Constant(value='semantic_search_pro', lineno=282, col_offset=26, end_lineno=282, end_col_offset=47), Name(id='COMPONENT_NAME', ctx=Load(), lineno=282, col_offset=49, end_lineno=282, end_col_offset=63)], lineno=282, col_offset=9, end_lineno=282, end_col_offset=64), optional_vars=Name(id='observation', ctx=Store(), lineno=282, col_offset=68, end_lineno=282, end_col_offset=79))], body=[Assign(targets=[Name(id='effective_limit', ctx=Store(), lineno=283, col_offset=8, end_lineno=283, end_col_offset=23)], value=Call(func=Name(id='_clamp_limit', ctx=Load(), lineno=283, col_offset=26, end_lineno=283, end_col_offset=38), args=[Name(id='limit', ctx=Load(), lineno=284, col_offset=12, end_lineno=284, end_col_offset=17), Attribute(value=Attribute(value=Attribute(value=Name(id='context', ctx=Load(), lineno=285, col_offset=12, end_lineno=285, end_col_offset=19), attr='settings', ctx=Load(), lineno=285, col_offset=12, end_lineno=285, end_col_offset=28), attr='limits', ctx=Load(), lineno=285, col_offset=12, end_lineno=285, end_col_offset=35), attr='max_results', ctx=Load(), lineno=285, col_offset=12, end_lineno=285, end_col_offset=47), Name(id='limits', ctx=Load(), lineno=286, col_offset=12, end_lineno=286, end_col_offset=18)], lineno=283, col_offset=26, end_lineno=287, end_col_offset=9), lineno=283, col_offset=8, end_lineno=287, end_col_offset=9), Assign(targets=[Name(id='wide_handle', ctx=Store(), lineno=288, col_offset=8, end_lineno=288, end_col_offset=19)], value=Call(func=Name(id='_maybe_schedule_xtr_wide', ctx=Load(), lineno=288, col_offset=22, end_lineno=288, end_col_offset=46), keywords=[keyword(arg='context', value=Name(id='context', ctx=Load(), lineno=289, col_offset=20, end_lineno=289, end_col_offset=27), lineno=289, col_offset=12, end_lineno=289, end_col_offset=27), keyword(arg='query', value=Name(id='query', ctx=Load(), lineno=290, col_offset=18, end_lineno=290, end_col_offset=23), lineno=290, col_offset=12, end_lineno=290, end_col_offset=23), keyword(arg='limit', value=Name(id='effective_limit', ctx=Load(), lineno=291, col_offset=18, end_lineno=291, end_col_offset=33), lineno=291, col_offset=12, end_lineno=291, end_col_offset=33), keyword(arg='options', value=Name(id='options', ctx=Load(), lineno=292, col_offset=20, end_lineno=292, end_col_offset=27), lineno=292, col_offset=12, end_lineno=292, end_col_offset=27)], lineno=288, col_offset=22, end_lineno=293, end_col_offset=9), lineno=288, col_offset=8, end_lineno=293, end_col_offset=9), Assign(targets=[Tuple(elts=[Name(id='coderank_hits', ctx=Store(), lineno=294, col_offset=8, end_lineno=294, end_col_offset=21), Name(id='coderank_stage', ctx=Store(), lineno=294, col_offset=23, end_lineno=294, end_col_offset=37)], ctx=Store(), lineno=294, col_offset=8, end_lineno=294, end_col_offset=37)], value=Call(func=Name(id='_timed_coderank_stage', ctx=Load(), lineno=294, col_offset=40, end_lineno=294, end_col_offset=61), keywords=[keyword(arg='context', value=Name(id='context', ctx=Load(), lineno=295, col_offset=20, end_lineno=295, end_col_offset=27), lineno=295, col_offset=12, end_lineno=295, end_col_offset=27), keyword(arg='query', value=Name(id='query', ctx=Load(), lineno=296, col_offset=18, end_lineno=296, end_col_offset=23), lineno=296, col_offset=12, end_lineno=296, end_col_offset=23), keyword(arg='fanout', value=Call(func=Name(id='max', ctx=Load(), lineno=297, col_offset=19, end_lineno=297, end_col_offset=22), args=[Name(id='effective_limit', ctx=Load(), lineno=298, col_offset=16, end_lineno=298, end_col_offset=31), BinOp(left=Name(id='effective_limit', ctx=Load(), lineno=299, col_offset=16, end_lineno=299, end_col_offset=31), op=Mult(), right=Attribute(value=Attribute(value=Attribute(value=Name(id='context', ctx=Load(), lineno=299, col_offset=34, end_lineno=299, end_col_offset=41), attr='settings', ctx=Load(), lineno=299, col_offset=34, end_lineno=299, end_col_offset=50), attr='limits', ctx=Load(), lineno=299, col_offset=34, end_lineno=299, end_col_offset=57), attr='semantic_overfetch_multiplier', ctx=Load(), lineno=299, col_offset=34, end_lineno=299, end_col_offset=87), lineno=299, col_offset=16, end_lineno=299, end_col_offset=87)], lineno=297, col_offset=19, end_lineno=300, end_col_offset=13), lineno=297, col_offset=12, end_lineno=300, end_col_offset=13), keyword(arg='observation', value=Name(id='observation', ctx=Load(), lineno=301, col_offset=24, end_lineno=301, end_col_offset=35), lineno=301, col_offset=12, end_lineno=301, end_col_offset=35)], lineno=294, col_offset=40, end_lineno=302, end_col_offset=9), lineno=294, col_offset=8, end_lineno=302, end_col_offset=9), Expr(value=Call(func=Attribute(value=Name(id='stage_timings', ctx=Load(), lineno=303, col_offset=8, end_lineno=303, end_col_offset=21), attr='append', ctx=Load(), lineno=303, col_offset=8, end_lineno=303, end_col_offset=28), args=[Name(id='coderank_stage', ctx=Load(), lineno=303, col_offset=29, end_lineno=303, end_col_offset=43)], lineno=303, col_offset=8, end_lineno=303, end_col_offset=44), lineno=303, col_offset=8, end_lineno=303, end_col_offset=44), Assign(targets=[Name(id='warp_outcome', ctx=Store(), lineno=305, col_offset=8, end_lineno=305, end_col_offset=20)], value=Call(func=Name(id='_resolve_stage_one_outcome', ctx=Load(), lineno=305, col_offset=23, end_lineno=305, end_col_offset=49), args=[Call(func=Name(id='StageOnePlan', ctx=Load(), lineno=306, col_offset=12, end_lineno=306, end_col_offset=24), keywords=[keyword(arg='context', value=Name(id='context', ctx=Load(), lineno=307, col_offset=24, end_lineno=307, end_col_offset=31), lineno=307, col_offset=16, end_lineno=307, end_col_offset=31), keyword(arg='query', value=Name(id='query', ctx=Load(), lineno=308, col_offset=22, end_lineno=308, end_col_offset=27), lineno=308, col_offset=16, end_lineno=308, end_col_offset=27), keyword(arg='candidates', value=Call(func=Name(id='tuple', ctx=Load(), lineno=309, col_offset=27, end_lineno=309, end_col_offset=32), args=[Name(id='coderank_hits', ctx=Load(), lineno=309, col_offset=33, end_lineno=309, end_col_offset=46)], lineno=309, col_offset=27, end_lineno=309, end_col_offset=47), lineno=309, col_offset=16, end_lineno=309, end_col_offset=47), keyword(arg='options', value=Name(id='options', ctx=Load(), lineno=310, col_offset=24, end_lineno=310, end_col_offset=31), lineno=310, col_offset=16, end_lineno=310, end_col_offset=31), keyword(arg='coderank_stage', value=Name(id='coderank_stage', ctx=Load(), lineno=311, col_offset=31, end_lineno=311, end_col_offset=45), lineno=311, col_offset=16, end_lineno=311, end_col_offset=45), keyword(arg='wide_handle', value=Name(id='wide_handle', ctx=Load(), lineno=312, col_offset=28, end_lineno=312, end_col_offset=39), lineno=312, col_offset=16, end_lineno=312, end_col_offset=39)], lineno=306, col_offset=12, end_lineno=313, end_col_offset=13)], lineno=305, col_offset=23, end_lineno=314, end_col_offset=9), lineno=305, col_offset=8, end_lineno=314, end_col_offset=9), If(test=Compare(left=Attribute(value=Name(id='warp_outcome', ctx=Load(), lineno=315, col_offset=11, end_lineno=315, end_col_offset=23), attr='timing', ctx=Load(), lineno=315, col_offset=11, end_lineno=315, end_col_offset=30), ops=[IsNot()], comparators=[Constant(value=None, lineno=315, col_offset=38, end_lineno=315, end_col_offset=42)], lineno=315, col_offset=11, end_lineno=315, end_col_offset=42), body=[Expr(value=Call(func=Attribute(value=Name(id='stage_timings', ctx=Load(), lineno=316, col_offset=12, end_lineno=316, end_col_offset=25), attr='append', ctx=Load(), lineno=316, col_offset=12, end_lineno=316, end_col_offset=32), args=[Attribute(value=Name(id='warp_outcome', ctx=Load(), lineno=316, col_offset=33, end_lineno=316, end_col_offset=45), attr='timing', ctx=Load(), lineno=316, col_offset=33, end_lineno=316, end_col_offset=52)], lineno=316, col_offset=12, end_lineno=316, end_col_offset=53), lineno=316, col_offset=12, end_lineno=316, end_col_offset=53)], lineno=315, col_offset=8, end_lineno=316, end_col_offset=53), Assign(targets=[Name(id='fused', ctx=Store(), lineno=318, col_offset=8, end_lineno=318, end_col_offset=13)], value=Call(func=Name(id='_run_fusion_stage', ctx=Load(), lineno=318, col_offset=16, end_lineno=318, end_col_offset=33), keywords=[keyword(arg='context', value=Name(id='context', ctx=Load(), lineno=319, col_offset=20, end_lineno=319, end_col_offset=27), lineno=319, col_offset=12, end_lineno=319, end_col_offset=27), keyword(arg='request', value=Call(func=Name(id='FusionRequest', ctx=Load(), lineno=320, col_offset=20, end_lineno=320, end_col_offset=33), keywords=[keyword(arg='query', value=Name(id='query', ctx=Load(), lineno=321, col_offset=22, end_lineno=321, end_col_offset=27), lineno=321, col_offset=16, end_lineno=321, end_col_offset=27), keyword(arg='coderank_hits', value=Name(id='coderank_hits', ctx=Load(), lineno=322, col_offset=30, end_lineno=322, end_col_offset=43), lineno=322, col_offset=16, end_lineno=322, end_col_offset=43), keyword(arg='warp_hits', value=Attribute(value=Name(id='warp_outcome', ctx=Load(), lineno=323, col_offset=26, end_lineno=323, end_col_offset=38), attr='hits', ctx=Load(), lineno=323, col_offset=26, end_lineno=323, end_col_offset=43), lineno=323, col_offset=16, end_lineno=323, end_col_offset=43), keyword(arg='warp_channel', value=Attribute(value=Name(id='warp_outcome', ctx=Load(), lineno=324, col_offset=29, end_lineno=324, end_col_offset=41), attr='channel', ctx=Load(), lineno=324, col_offset=29, end_lineno=324, end_col_offset=49), lineno=324, col_offset=16, end_lineno=324, end_col_offset=49), keyword(arg='effective_limit', value=Name(id='effective_limit', ctx=Load(), lineno=325, col_offset=32, end_lineno=325, end_col_offset=47), lineno=325, col_offset=16, end_lineno=325, end_col_offset=47), keyword(arg='weights', value=Call(func=Name(id='_merge_rrf_weights', ctx=Load(), lineno=326, col_offset=24, end_lineno=326, end_col_offset=42), args=[Attribute(value=Attribute(value=Attribute(value=Name(id='context', ctx=Load(), lineno=327, col_offset=20, end_lineno=327, end_col_offset=27), attr='settings', ctx=Load(), lineno=327, col_offset=20, end_lineno=327, end_col_offset=36), attr='index', ctx=Load(), lineno=327, col_offset=20, end_lineno=327, end_col_offset=42), attr='rrf_weights', ctx=Load(), lineno=327, col_offset=20, end_lineno=327, end_col_offset=54), Attribute(value=Name(id='options', ctx=Load(), lineno=327, col_offset=56, end_lineno=327, end_col_offset=63), attr='stage_weights', ctx=Load(), lineno=327, col_offset=56, end_lineno=327, end_col_offset=77)], lineno=326, col_offset=24, end_lineno=328, end_col_offset=17), lineno=326, col_offset=16, end_lineno=328, end_col_offset=17)], lineno=320, col_offset=20, end_lineno=329, end_col_offset=13), lineno=320, col_offset=12, end_lineno=329, end_col_offset=13), keyword(arg='stage_timings', value=Name(id='stage_timings', ctx=Load(), lineno=330, col_offset=26, end_lineno=330, end_col_offset=39), lineno=330, col_offset=12, end_lineno=330, end_col_offset=39)], lineno=318, col_offset=16, end_lineno=331, end_col_offset=9), lineno=318, col_offset=8, end_lineno=331, end_col_offset=9), If(test=UnaryOp(op=Not(), operand=Attribute(value=Name(id='fused', ctx=Load(), lineno=333, col_offset=15, end_lineno=333, end_col_offset=20), attr='docs', ctx=Load(), lineno=333, col_offset=15, end_lineno=333, end_col_offset=25), lineno=333, col_offset=11, end_lineno=333, end_col_offset=25), body=[Expr(value=Call(func=Attribute(value=Name(id='observation', ctx=Load(), lineno=334, col_offset=12, end_lineno=334, end_col_offset=23), attr='mark_success', ctx=Load(), lineno=334, col_offset=12, end_lineno=334, end_col_offset=36), lineno=334, col_offset=12, end_lineno=334, end_col_offset=38), lineno=334, col_offset=12, end_lineno=334, end_col_offset=38), Assign(targets=[Name(id='method', ctx=Store(), lineno=335, col_offset=12, end_lineno=335, end_col_offset=18)], value=Call(func=Name(id='_build_method', ctx=Load(), lineno=335, col_offset=21, end_lineno=335, end_col_offset=34), args=[Call(func=Name(id='MethodContext', ctx=Load(), lineno=336, col_offset=16, end_lineno=336, end_col_offset=29), keywords=[keyword(arg='findings_count', value=Constant(value=0, lineno=337, col_offset=35, end_lineno=337, end_col_offset=36), lineno=337, col_offset=20, end_lineno=337, end_col_offset=36), keyword(arg='requested_limit', value=Name(id='limit', ctx=Load(), lineno=338, col_offset=36, end_lineno=338, end_col_offset=41), lineno=338, col_offset=20, end_lineno=338, end_col_offset=41), keyword(arg='effective_limit', value=Name(id='effective_limit', ctx=Load(), lineno=339, col_offset=36, end_lineno=339, end_col_offset=51), lineno=339, col_offset=20, end_lineno=339, end_col_offset=51), keyword(arg='start_time', value=Name(id='start_time', ctx=Load(), lineno=340, col_offset=31, end_lineno=340, end_col_offset=41), lineno=340, col_offset=20, end_lineno=340, end_col_offset=41), keyword(arg='channels', value=Attribute(value=Name(id='fused', ctx=Load(), lineno=341, col_offset=29, end_lineno=341, end_col_offset=34), attr='channels', ctx=Load(), lineno=341, col_offset=29, end_lineno=341, end_col_offset=43), lineno=341, col_offset=20, end_lineno=341, end_col_offset=43), keyword(arg='stages', value=Call(func=Name(id='tuple', ctx=Load(), lineno=342, col_offset=27, end_lineno=342, end_col_offset=32), args=[Name(id='stage_timings', ctx=Load(), lineno=342, col_offset=33, end_lineno=342, end_col_offset=46)], lineno=342, col_offset=27, end_lineno=342, end_col_offset=47), lineno=342, col_offset=20, end_lineno=342, end_col_offset=47), keyword(arg='notes', value=Call(func=Name(id='tuple', ctx=Load(), lineno=343, col_offset=26, end_lineno=343, end_col_offset=31), args=[Attribute(value=Name(id='warp_outcome', ctx=Load(), lineno=343, col_offset=32, end_lineno=343, end_col_offset=44), attr='notes', ctx=Load(), lineno=343, col_offset=32, end_lineno=343, end_col_offset=50)], lineno=343, col_offset=26, end_lineno=343, end_col_offset=51), lineno=343, col_offset=20, end_lineno=343, end_col_offset=51), keyword(arg='explainability', value=Call(func=Name(id='_build_method_explainability', ctx=Load(), lineno=344, col_offset=35, end_lineno=344, end_col_offset=63), args=[Attribute(value=Name(id='warp_outcome', ctx=Load(), lineno=344, col_offset=64, end_lineno=344, end_col_offset=76), attr='explainability', ctx=Load(), lineno=344, col_offset=64, end_lineno=344, end_col_offset=91)], lineno=344, col_offset=35, end_lineno=344, end_col_offset=92), lineno=344, col_offset=20, end_lineno=344, end_col_offset=92)], lineno=336, col_offset=16, end_lineno=345, end_col_offset=17)], lineno=335, col_offset=21, end_lineno=346, end_col_offset=13), lineno=335, col_offset=12, end_lineno=346, end_col_offset=13), Assign(targets=[Name(id='extras', ctx=Store(), lineno=347, col_offset=12, end_lineno=347, end_col_offset=18)], value=Call(func=Name(id='_assemble_extras', ctx=Load(), lineno=347, col_offset=21, end_lineno=347, end_col_offset=37), keywords=[keyword(arg='method', value=Name(id='method', ctx=Load(), lineno=348, col_offset=23, end_lineno=348, end_col_offset=29), lineno=348, col_offset=16, end_lineno=348, end_col_offset=29), keyword(arg='limits', value=BinOp(left=Name(id='limits', ctx=Load(), lineno=349, col_offset=23, end_lineno=349, end_col_offset=29), op=Add(), right=Attribute(value=Name(id='fused', ctx=Load(), lineno=349, col_offset=32, end_lineno=349, end_col_offset=37), attr='warnings', ctx=Load(), lineno=349, col_offset=32, end_lineno=349, end_col_offset=46), lineno=349, col_offset=23, end_lineno=349, end_col_offset=46), lineno=349, col_offset=16, end_lineno=349, end_col_offset=46), keyword(arg='scope', value=Name(id='scope', ctx=Load(), lineno=350, col_offset=22, end_lineno=350, end_col_offset=27), lineno=350, col_offset=16, end_lineno=350, end_col_offset=27)], lineno=347, col_offset=21, end_lineno=351, end_col_offset=13), lineno=347, col_offset=12, end_lineno=351, end_col_offset=13), Return(value=Call(func=Name(id='_make_envelope', ctx=Load(), lineno=352, col_offset=19, end_lineno=352, end_col_offset=33), keywords=[keyword(arg='answer', value=JoinedStr(values=[Constant(value='No results found for: ', lineno=353, col_offset=25, end_lineno=353, end_col_offset=47), FormattedValue(value=Name(id='query', ctx=Load(), lineno=353, col_offset=48, end_lineno=353, end_col_offset=53), conversion=-1, lineno=353, col_offset=47, end_lineno=353, end_col_offset=54)], lineno=353, col_offset=23, end_lineno=353, end_col_offset=55), lineno=353, col_offset=16, end_lineno=353, end_col_offset=55), keyword(arg='findings', value=List(ctx=Load(), lineno=354, col_offset=25, end_lineno=354, end_col_offset=27), lineno=354, col_offset=16, end_lineno=354, end_col_offset=27), keyword(arg='extras', value=Name(id='extras', ctx=Load(), lineno=355, col_offset=23, end_lineno=355, end_col_offset=29), lineno=355, col_offset=16, end_lineno=355, end_col_offset=29)], lineno=352, col_offset=19, end_lineno=356, end_col_offset=13), lineno=352, col_offset=12, end_lineno=356, end_col_offset=13)], lineno=333, col_offset=8, end_lineno=356, end_col_offset=13), Assign(targets=[Tuple(elts=[Name(id='records', ctx=Store(), lineno=358, col_offset=8, end_lineno=358, end_col_offset=15), Name(id='hydration_stages', ctx=Store(), lineno=358, col_offset=17, end_lineno=358, end_col_offset=33)], ctx=Store(), lineno=358, col_offset=8, end_lineno=358, end_col_offset=33)], value=Call(func=Name(id='_hydrate_and_rerank_records', ctx=Load(), lineno=358, col_offset=36, end_lineno=358, end_col_offset=63), args=[Call(func=Name(id='HydrationPlan', ctx=Load(), lineno=359, col_offset=12, end_lineno=359, end_col_offset=25), keywords=[keyword(arg='context', value=Name(id='context', ctx=Load(), lineno=360, col_offset=24, end_lineno=360, end_col_offset=31), lineno=360, col_offset=16, end_lineno=360, end_col_offset=31), keyword(arg='query', value=Name(id='query', ctx=Load(), lineno=361, col_offset=22, end_lineno=361, end_col_offset=27), lineno=361, col_offset=16, end_lineno=361, end_col_offset=27), keyword(arg='fused', value=Name(id='fused', ctx=Load(), lineno=362, col_offset=22, end_lineno=362, end_col_offset=27), lineno=362, col_offset=16, end_lineno=362, end_col_offset=27), keyword(arg='scope', value=Name(id='scope', ctx=Load(), lineno=363, col_offset=22, end_lineno=363, end_col_offset=27), lineno=363, col_offset=16, end_lineno=363, end_col_offset=27), keyword(arg='effective_limit', value=Name(id='effective_limit', ctx=Load(), lineno=364, col_offset=32, end_lineno=364, end_col_offset=47), lineno=364, col_offset=16, end_lineno=364, end_col_offset=47), keyword(arg='options', value=Name(id='options', ctx=Load(), lineno=365, col_offset=24, end_lineno=365, end_col_offset=31), lineno=365, col_offset=16, end_lineno=365, end_col_offset=31), keyword(arg='observation', value=Name(id='observation', ctx=Load(), lineno=366, col_offset=28, end_lineno=366, end_col_offset=39), lineno=366, col_offset=16, end_lineno=366, end_col_offset=39)], lineno=359, col_offset=12, end_lineno=367, end_col_offset=13)], lineno=358, col_offset=36, end_lineno=368, end_col_offset=9), lineno=358, col_offset=8, end_lineno=368, end_col_offset=9), Expr(value=Call(func=Attribute(value=Name(id='stage_timings', ctx=Load(), lineno=369, col_offset=8, end_lineno=369, end_col_offset=21), attr='extend', ctx=Load(), lineno=369, col_offset=8, end_lineno=369, end_col_offset=28), args=[Name(id='hydration_stages', ctx=Load(), lineno=369, col_offset=29, end_lineno=369, end_col_offset=45)], lineno=369, col_offset=8, end_lineno=369, end_col_offset=46), lineno=369, col_offset=8, end_lineno=369, end_col_offset=46), Assign(targets=[Name(id='findings', ctx=Store(), lineno=371, col_offset=8, end_lineno=371, end_col_offset=16)], value=Call(func=Name(id='_build_findings', ctx=Load(), lineno=371, col_offset=19, end_lineno=371, end_col_offset=34), keywords=[keyword(arg='records', value=Name(id='records', ctx=Load(), lineno=372, col_offset=20, end_lineno=372, end_col_offset=27), lineno=372, col_offset=12, end_lineno=372, end_col_offset=27), keyword(arg='docs', value=Attribute(value=Name(id='fused', ctx=Load(), lineno=373, col_offset=17, end_lineno=373, end_col_offset=22), attr='docs', ctx=Load(), lineno=373, col_offset=17, end_lineno=373, end_col_offset=27), lineno=373, col_offset=12, end_lineno=373, end_col_offset=27), keyword(arg='contribution_map', value=Attribute(value=Name(id='fused', ctx=Load(), lineno=374, col_offset=29, end_lineno=374, end_col_offset=34), attr='contributions', ctx=Load(), lineno=374, col_offset=29, end_lineno=374, end_col_offset=48), lineno=374, col_offset=12, end_lineno=374, end_col_offset=48), keyword(arg='explain', value=Attribute(value=Name(id='options', ctx=Load(), lineno=375, col_offset=20, end_lineno=375, end_col_offset=27), attr='explain', ctx=Load(), lineno=375, col_offset=20, end_lineno=375, end_col_offset=35), lineno=375, col_offset=12, end_lineno=375, end_col_offset=35)], lineno=371, col_offset=19, end_lineno=376, end_col_offset=9), lineno=371, col_offset=8, end_lineno=376, end_col_offset=9), Expr(value=Call(func=Name(id='merge_explainability_into_findings', ctx=Load(), lineno=377, col_offset=8, end_lineno=377, end_col_offset=42), args=[Name(id='findings', ctx=Load(), lineno=377, col_offset=43, end_lineno=377, end_col_offset=51), Attribute(value=Name(id='warp_outcome', ctx=Load(), lineno=377, col_offset=53, end_lineno=377, end_col_offset=65), attr='explainability', ctx=Load(), lineno=377, col_offset=53, end_lineno=377, end_col_offset=80)], lineno=377, col_offset=8, end_lineno=377, end_col_offset=81), lineno=377, col_offset=8, end_lineno=377, end_col_offset=81), Expr(value=Call(func=Attribute(value=Name(id='observation', ctx=Load(), lineno=378, col_offset=8, end_lineno=378, end_col_offset=19), attr='mark_success', ctx=Load(), lineno=378, col_offset=8, end_lineno=378, end_col_offset=32), lineno=378, col_offset=8, end_lineno=378, end_col_offset=34), lineno=378, col_offset=8, end_lineno=378, end_col_offset=34), Expr(value=Call(func=Name(id='_append_budget_notes', ctx=Load(), lineno=379, col_offset=8, end_lineno=379, end_col_offset=28), args=[Name(id='COMPONENT_NAME', ctx=Load(), lineno=379, col_offset=29, end_lineno=379, end_col_offset=43), Name(id='stage_timings', ctx=Load(), lineno=379, col_offset=45, end_lineno=379, end_col_offset=58), Name(id='limits', ctx=Load(), lineno=379, col_offset=60, end_lineno=379, end_col_offset=66)], lineno=379, col_offset=8, end_lineno=379, end_col_offset=67), lineno=379, col_offset=8, end_lineno=379, end_col_offset=67), Assign(targets=[Name(id='method', ctx=Store(), lineno=380, col_offset=8, end_lineno=380, end_col_offset=14)], value=Call(func=Name(id='_build_method', ctx=Load(), lineno=380, col_offset=17, end_lineno=380, end_col_offset=30), args=[Call(func=Name(id='MethodContext', ctx=Load(), lineno=381, col_offset=12, end_lineno=381, end_col_offset=25), keywords=[keyword(arg='findings_count', value=Call(func=Name(id='len', ctx=Load(), lineno=382, col_offset=31, end_lineno=382, end_col_offset=34), args=[Name(id='findings', ctx=Load(), lineno=382, col_offset=35, end_lineno=382, end_col_offset=43)], lineno=382, col_offset=31, end_lineno=382, end_col_offset=44), lineno=382, col_offset=16, end_lineno=382, end_col_offset=44), keyword(arg='requested_limit', value=Name(id='limit', ctx=Load(), lineno=383, col_offset=32, end_lineno=383, end_col_offset=37), lineno=383, col_offset=16, end_lineno=383, end_col_offset=37), keyword(arg='effective_limit', value=Name(id='effective_limit', ctx=Load(), lineno=384, col_offset=32, end_lineno=384, end_col_offset=47), lineno=384, col_offset=16, end_lineno=384, end_col_offset=47), keyword(arg='start_time', value=Name(id='start_time', ctx=Load(), lineno=385, col_offset=27, end_lineno=385, end_col_offset=37), lineno=385, col_offset=16, end_lineno=385, end_col_offset=37), keyword(arg='channels', value=Attribute(value=Name(id='fused', ctx=Load(), lineno=386, col_offset=25, end_lineno=386, end_col_offset=30), attr='channels', ctx=Load(), lineno=386, col_offset=25, end_lineno=386, end_col_offset=39), lineno=386, col_offset=16, end_lineno=386, end_col_offset=39), keyword(arg='stages', value=Call(func=Name(id='tuple', ctx=Load(), lineno=387, col_offset=23, end_lineno=387, end_col_offset=28), args=[Name(id='stage_timings', ctx=Load(), lineno=387, col_offset=29, end_lineno=387, end_col_offset=42)], lineno=387, col_offset=23, end_lineno=387, end_col_offset=43), lineno=387, col_offset=16, end_lineno=387, end_col_offset=43), keyword(arg='notes', value=Call(func=Name(id='tuple', ctx=Load(), lineno=388, col_offset=22, end_lineno=388, end_col_offset=27), args=[Attribute(value=Name(id='warp_outcome', ctx=Load(), lineno=388, col_offset=28, end_lineno=388, end_col_offset=40), attr='notes', ctx=Load(), lineno=388, col_offset=28, end_lineno=388, end_col_offset=46)], lineno=388, col_offset=22, end_lineno=388, end_col_offset=47), lineno=388, col_offset=16, end_lineno=388, end_col_offset=47), keyword(arg='explainability', value=Call(func=Name(id='_build_method_explainability', ctx=Load(), lineno=389, col_offset=31, end_lineno=389, end_col_offset=59), args=[Attribute(value=Name(id='warp_outcome', ctx=Load(), lineno=389, col_offset=60, end_lineno=389, end_col_offset=72), attr='explainability', ctx=Load(), lineno=389, col_offset=60, end_lineno=389, end_col_offset=87)], lineno=389, col_offset=31, end_lineno=389, end_col_offset=88), lineno=389, col_offset=16, end_lineno=389, end_col_offset=88)], lineno=381, col_offset=12, end_lineno=390, end_col_offset=13)], lineno=380, col_offset=17, end_lineno=391, end_col_offset=9), lineno=380, col_offset=8, end_lineno=391, end_col_offset=9), Assign(targets=[Name(id='extras', ctx=Store(), lineno=392, col_offset=8, end_lineno=392, end_col_offset=14)], value=Call(func=Name(id='_assemble_extras', ctx=Load(), lineno=392, col_offset=17, end_lineno=392, end_col_offset=33), keywords=[keyword(arg='method', value=Name(id='method', ctx=Load(), lineno=393, col_offset=19, end_lineno=393, end_col_offset=25), lineno=393, col_offset=12, end_lineno=393, end_col_offset=25), keyword(arg='limits', value=BinOp(left=Name(id='limits', ctx=Load(), lineno=394, col_offset=19, end_lineno=394, end_col_offset=25), op=Add(), right=Attribute(value=Name(id='fused', ctx=Load(), lineno=394, col_offset=28, end_lineno=394, end_col_offset=33), attr='warnings', ctx=Load(), lineno=394, col_offset=28, end_lineno=394, end_col_offset=42), lineno=394, col_offset=19, end_lineno=394, end_col_offset=42), lineno=394, col_offset=12, end_lineno=394, end_col_offset=42), keyword(arg='scope', value=Name(id='scope', ctx=Load(), lineno=395, col_offset=18, end_lineno=395, end_col_offset=23), lineno=395, col_offset=12, end_lineno=395, end_col_offset=23)], lineno=392, col_offset=17, end_lineno=396, end_col_offset=9), lineno=392, col_offset=8, end_lineno=396, end_col_offset=9), Return(value=Call(func=Name(id='_make_envelope', ctx=Load(), lineno=398, col_offset=15, end_lineno=398, end_col_offset=29), keywords=[keyword(arg='answer', value=JoinedStr(values=[Constant(value='Found ', lineno=399, col_offset=21, end_lineno=399, end_col_offset=27), FormattedValue(value=Call(func=Name(id='len', ctx=Load(), lineno=399, col_offset=28, end_lineno=399, end_col_offset=31), args=[Name(id='findings', ctx=Load(), lineno=399, col_offset=32, end_lineno=399, end_col_offset=40)], lineno=399, col_offset=28, end_lineno=399, end_col_offset=41), conversion=-1, lineno=399, col_offset=27, end_lineno=399, end_col_offset=42), Constant(value=' semantic_pro results for: ', lineno=399, col_offset=42, end_lineno=399, end_col_offset=69), FormattedValue(value=Name(id='query', ctx=Load(), lineno=399, col_offset=70, end_lineno=399, end_col_offset=75), conversion=-1, lineno=399, col_offset=69, end_lineno=399, end_col_offset=76)], lineno=399, col_offset=19, end_lineno=399, end_col_offset=77), lineno=399, col_offset=12, end_lineno=399, end_col_offset=77), keyword(arg='findings', value=Name(id='findings', ctx=Load(), lineno=400, col_offset=21, end_lineno=400, end_col_offset=29), lineno=400, col_offset=12, end_lineno=400, end_col_offset=29), keyword(arg='extras', value=Name(id='extras', ctx=Load(), lineno=401, col_offset=19, end_lineno=401, end_col_offset=25), lineno=401, col_offset=12, end_lineno=401, end_col_offset=25)], lineno=398, col_offset=15, end_lineno=402, end_col_offset=9), lineno=398, col_offset=8, end_lineno=402, end_col_offset=9)], lineno=282, col_offset=4, end_lineno=402, end_col_offset=9)], returns=Name(id='AnswerEnvelope', ctx=Load(), lineno=274, col_offset=5, end_lineno=274, end_col_offset=19), lineno=268, col_offset=0, end_lineno=402, end_col_offset=9), FunctionDef(name='_run_coderank_stage', args=arguments(kwonlyargs=[arg(arg='context', annotation=Name(id='ApplicationContext', ctx=Load(), lineno=407, col_offset=13, end_lineno=407, end_col_offset=31), lineno=407, col_offset=4, end_lineno=407, end_col_offset=31), arg(arg='query', annotation=Name(id='str', ctx=Load(), lineno=408, col_offset=11, end_lineno=408, end_col_offset=14), lineno=408, col_offset=4, end_lineno=408, end_col_offset=14), arg(arg='fanout', annotation=Name(id='int', ctx=Load(), lineno=409, col_offset=12, end_lineno=409, end_col_offset=15), lineno=409, col_offset=4, end_lineno=409, end_col_offset=15), arg(arg='observation', annotation=Name(id='Observation', ctx=Load(), lineno=410, col_offset=17, end_lineno=410, end_col_offset=28), lineno=410, col_offset=4, end_lineno=410, end_col_offset=28)], kw_defaults=[None, None, None, None]), body=[If(test=UnaryOp(op=Not(), operand=Call(func=Attribute(value=Attribute(value=Attribute(value=Name(id='context', ctx=Load(), lineno=412, col_offset=11, end_lineno=412, end_col_offset=18), attr='paths', ctx=Load(), lineno=412, col_offset=11, end_lineno=412, end_col_offset=24), attr='coderank_faiss_index', ctx=Load(), lineno=412, col_offset=11, end_lineno=412, end_col_offset=45), attr='exists', ctx=Load(), lineno=412, col_offset=11, end_lineno=412, end_col_offset=52), lineno=412, col_offset=11, end_lineno=412, end_col_offset=54), lineno=412, col_offset=7, end_lineno=412, end_col_offset=54), body=[Expr(value=Call(func=Attribute(value=Name(id='observation', ctx=Load(), lineno=413, col_offset=8, end_lineno=413, end_col_offset=19), attr='mark_error', ctx=Load(), lineno=413, col_offset=8, end_lineno=413, end_col_offset=30), lineno=413, col_offset=8, end_lineno=413, end_col_offset=32), lineno=413, col_offset=8, end_lineno=413, end_col_offset=32), Assign(targets=[Name(id='msg', ctx=Store(), lineno=414, col_offset=8, end_lineno=414, end_col_offset=11)], value=Constant(value='CodeRank FAISS index not found; build it via `python coderank.py build-index`.', lineno=414, col_offset=14, end_lineno=414, end_col_offset=94), lineno=414, col_offset=8, end_lineno=414, end_col_offset=94), Raise(exc=Call(func=Name(id='VectorSearchError', ctx=Load(), lineno=415, col_offset=14, end_lineno=415, end_col_offset=31), args=[Name(id='msg', ctx=Load(), lineno=416, col_offset=12, end_lineno=416, end_col_offset=15)], keywords=[keyword(arg='context', value=Dict(keys=[Constant(value='coderank_faiss_index', lineno=417, col_offset=21, end_lineno=417, end_col_offset=43)], values=[Call(func=Name(id='str', ctx=Load(), lineno=417, col_offset=45, end_lineno=417, end_col_offset=48), args=[Attribute(value=Attribute(value=Name(id='context', ctx=Load(), lineno=417, col_offset=49, end_lineno=417, end_col_offset=56), attr='paths', ctx=Load(), lineno=417, col_offset=49, end_lineno=417, end_col_offset=62), attr='coderank_faiss_index', ctx=Load(), lineno=417, col_offset=49, end_lineno=417, end_col_offset=83)], lineno=417, col_offset=45, end_lineno=417, end_col_offset=84)], lineno=417, col_offset=20, end_lineno=417, end_col_offset=85), lineno=417, col_offset=12, end_lineno=417, end_col_offset=85)], lineno=415, col_offset=14, end_lineno=418, end_col_offset=9), lineno=415, col_offset=8, end_lineno=418, end_col_offset=9)], lineno=412, col_offset=4, end_lineno=418, end_col_offset=9), Try(body=[Assign(targets=[Name(id='query_vec', ctx=Store(), lineno=421, col_offset=8, end_lineno=421, end_col_offset=17)], value=Call(func=Attribute(value=Attribute(value=Name(id='context', ctx=Load(), lineno=421, col_offset=20, end_lineno=421, end_col_offset=27), attr='vllm_client', ctx=Load(), lineno=421, col_offset=20, end_lineno=421, end_col_offset=39), attr='embed_batch', ctx=Load(), lineno=421, col_offset=20, end_lineno=421, end_col_offset=51), args=[List(elts=[Name(id='query', ctx=Load(), lineno=421, col_offset=53, end_lineno=421, end_col_offset=58)], ctx=Load(), lineno=421, col_offset=52, end_lineno=421, end_col_offset=59)], lineno=421, col_offset=20, end_lineno=421, end_col_offset=60), lineno=421, col_offset=8, end_lineno=421, end_col_offset=60)], handlers=[ExceptHandler(type=Name(id='Exception', ctx=Load(), lineno=422, col_offset=11, end_lineno=422, end_col_offset=20), name='exc', body=[Expr(value=Call(func=Attribute(value=Name(id='observation', ctx=Load(), lineno=423, col_offset=8, end_lineno=423, end_col_offset=19), attr='mark_error', ctx=Load(), lineno=423, col_offset=8, end_lineno=423, end_col_offset=30), lineno=423, col_offset=8, end_lineno=423, end_col_offset=32), lineno=423, col_offset=8, end_lineno=423, end_col_offset=32), Assign(targets=[Name(id='msg', ctx=Store(), lineno=424, col_offset=8, end_lineno=424, end_col_offset=11)], value=JoinedStr(values=[Constant(value='CodeRank embedding failed: ', lineno=424, col_offset=16, end_lineno=424, end_col_offset=43), FormattedValue(value=Name(id='exc', ctx=Load(), lineno=424, col_offset=44, end_lineno=424, end_col_offset=47), conversion=-1, lineno=424, col_offset=43, end_lineno=424, end_col_offset=48)], lineno=424, col_offset=14, end_lineno=424, end_col_offset=49), lineno=424, col_offset=8, end_lineno=424, end_col_offset=49), Raise(exc=Call(func=Name(id='EmbeddingError', ctx=Load(), lineno=425, col_offset=14, end_lineno=425, end_col_offset=28), args=[Name(id='msg', ctx=Load(), lineno=426, col_offset=12, end_lineno=426, end_col_offset=15)], keywords=[keyword(arg='context', value=Dict(keys=[Constant(value='model_id', lineno=428, col_offset=16, end_lineno=428, end_col_offset=26), Constant(value='mode', lineno=429, col_offset=16, end_lineno=429, end_col_offset=22)], values=[Attribute(value=Attribute(value=Attribute(value=Name(id='context', ctx=Load(), lineno=428, col_offset=28, end_lineno=428, end_col_offset=35), attr='settings', ctx=Load(), lineno=428, col_offset=28, end_lineno=428, end_col_offset=44), attr='vllm', ctx=Load(), lineno=428, col_offset=28, end_lineno=428, end_col_offset=49), attr='model', ctx=Load(), lineno=428, col_offset=28, end_lineno=428, end_col_offset=55), Attribute(value=Attribute(value=Attribute(value=Attribute(value=Name(id='context', ctx=Load(), lineno=429, col_offset=24, end_lineno=429, end_col_offset=31), attr='settings', ctx=Load(), lineno=429, col_offset=24, end_lineno=429, end_col_offset=40), attr='vllm', ctx=Load(), lineno=429, col_offset=24, end_lineno=429, end_col_offset=45), attr='run', ctx=Load(), lineno=429, col_offset=24, end_lineno=429, end_col_offset=49), attr='mode', ctx=Load(), lineno=429, col_offset=24, end_lineno=429, end_col_offset=54)], lineno=427, col_offset=20, end_lineno=430, end_col_offset=13), lineno=427, col_offset=12, end_lineno=430, end_col_offset=13)], lineno=425, col_offset=14, end_lineno=431, end_col_offset=9), cause=Name(id='exc', ctx=Load(), lineno=431, col_offset=15, end_lineno=431, end_col_offset=18), lineno=425, col_offset=8, end_lineno=431, end_col_offset=18)], lineno=422, col_offset=4, end_lineno=431, end_col_offset=18)], lineno=420, col_offset=4, end_lineno=431, end_col_offset=18), Try(body=[Assign(targets=[Name(id='faiss_mgr', ctx=Store(), lineno=434, col_offset=8, end_lineno=434, end_col_offset=17)], value=Call(func=Attribute(value=Name(id='context', ctx=Load(), lineno=434, col_offset=20, end_lineno=434, end_col_offset=27), attr='get_coderank_faiss_manager', ctx=Load(), lineno=434, col_offset=20, end_lineno=434, end_col_offset=54), args=[Subscript(value=Attribute(value=Name(id='query_vec', ctx=Load(), lineno=434, col_offset=55, end_lineno=434, end_col_offset=64), attr='shape', ctx=Load(), lineno=434, col_offset=55, end_lineno=434, end_col_offset=70), slice=Constant(value=1, lineno=434, col_offset=71, end_lineno=434, end_col_offset=72), ctx=Load(), lineno=434, col_offset=55, end_lineno=434, end_col_offset=73)], lineno=434, col_offset=20, end_lineno=434, end_col_offset=74), lineno=434, col_offset=8, end_lineno=434, end_col_offset=74)], handlers=[ExceptHandler(type=Tuple(elts=[Name(id='FileNotFoundError', ctx=Load(), lineno=435, col_offset=12, end_lineno=435, end_col_offset=29), Name(id='RuntimeError', ctx=Load(), lineno=435, col_offset=31, end_lineno=435, end_col_offset=43), Name(id='ValueError', ctx=Load(), lineno=435, col_offset=45, end_lineno=435, end_col_offset=55)], ctx=Load(), lineno=435, col_offset=11, end_lineno=435, end_col_offset=56), name='exc', body=[Expr(value=Call(func=Attribute(value=Name(id='observation', ctx=Load(), lineno=436, col_offset=8, end_lineno=436, end_col_offset=19), attr='mark_error', ctx=Load(), lineno=436, col_offset=8, end_lineno=436, end_col_offset=30), lineno=436, col_offset=8, end_lineno=436, end_col_offset=32), lineno=436, col_offset=8, end_lineno=436, end_col_offset=32), Assign(targets=[Name(id='msg', ctx=Store(), lineno=437, col_offset=8, end_lineno=437, end_col_offset=11)], value=Constant(value='Failed to load CodeRank FAISS index', lineno=437, col_offset=14, end_lineno=437, end_col_offset=51), lineno=437, col_offset=8, end_lineno=437, end_col_offset=51), Raise(exc=Call(func=Name(id='VectorSearchError', ctx=Load(), lineno=438, col_offset=14, end_lineno=438, end_col_offset=31), args=[Name(id='msg', ctx=Load(), lineno=438, col_offset=32, end_lineno=438, end_col_offset=35)], keywords=[keyword(arg='cause', value=Name(id='exc', ctx=Load(), lineno=438, col_offset=43, end_lineno=438, end_col_offset=46), lineno=438, col_offset=37, end_lineno=438, end_col_offset=46)], lineno=438, col_offset=14, end_lineno=438, end_col_offset=47), cause=Name(id='exc', ctx=Load(), lineno=438, col_offset=53, end_lineno=438, end_col_offset=56), lineno=438, col_offset=8, end_lineno=438, end_col_offset=56)], lineno=435, col_offset=4, end_lineno=438, end_col_offset=56)], lineno=433, col_offset=4, end_lineno=438, end_col_offset=56), Try(body=[Assign(targets=[Tuple(elts=[Name(id='distances', ctx=Store(), lineno=441, col_offset=8, end_lineno=441, end_col_offset=17), Name(id='ids', ctx=Store(), lineno=441, col_offset=19, end_lineno=441, end_col_offset=22)], ctx=Store(), lineno=441, col_offset=8, end_lineno=441, end_col_offset=22)], value=Call(func=Attribute(value=Name(id='faiss_mgr', ctx=Load(), lineno=441, col_offset=25, end_lineno=441, end_col_offset=34), attr='search', ctx=Load(), lineno=441, col_offset=25, end_lineno=441, end_col_offset=41), args=[Name(id='query_vec', ctx=Load(), lineno=442, col_offset=12, end_lineno=442, end_col_offset=21)], keywords=[keyword(arg='k', value=Call(func=Name(id='max', ctx=Load(), lineno=443, col_offset=14, end_lineno=443, end_col_offset=17), args=[Constant(value=1, lineno=443, col_offset=18, end_lineno=443, end_col_offset=19), Call(func=Name(id='int', ctx=Load(), lineno=443, col_offset=21, end_lineno=443, end_col_offset=24), args=[Name(id='fanout', ctx=Load(), lineno=443, col_offset=25, end_lineno=443, end_col_offset=31)], lineno=443, col_offset=21, end_lineno=443, end_col_offset=32)], lineno=443, col_offset=14, end_lineno=443, end_col_offset=33), lineno=443, col_offset=12, end_lineno=443, end_col_offset=33), keyword(arg='nprobe', value=Attribute(value=Attribute(value=Attribute(value=Name(id='context', ctx=Load(), lineno=444, col_offset=19, end_lineno=444, end_col_offset=26), attr='settings', ctx=Load(), lineno=444, col_offset=19, end_lineno=444, end_col_offset=35), attr='index', ctx=Load(), lineno=444, col_offset=19, end_lineno=444, end_col_offset=41), attr='faiss_nprobe', ctx=Load(), lineno=444, col_offset=19, end_lineno=444, end_col_offset=54), lineno=444, col_offset=12, end_lineno=444, end_col_offset=54)], lineno=441, col_offset=25, end_lineno=445, end_col_offset=9), lineno=441, col_offset=8, end_lineno=445, end_col_offset=9)], handlers=[ExceptHandler(type=Name(id='RuntimeError', ctx=Load(), lineno=446, col_offset=11, end_lineno=446, end_col_offset=23), name='exc', body=[Expr(value=Call(func=Attribute(value=Name(id='observation', ctx=Load(), lineno=447, col_offset=8, end_lineno=447, end_col_offset=19), attr='mark_error', ctx=Load(), lineno=447, col_offset=8, end_lineno=447, end_col_offset=30), lineno=447, col_offset=8, end_lineno=447, end_col_offset=32), lineno=447, col_offset=8, end_lineno=447, end_col_offset=32), Assign(targets=[Name(id='msg', ctx=Store(), lineno=448, col_offset=8, end_lineno=448, end_col_offset=11)], value=Constant(value='CodeRank FAISS search failed', lineno=448, col_offset=14, end_lineno=448, end_col_offset=44), lineno=448, col_offset=8, end_lineno=448, end_col_offset=44), Raise(exc=Call(func=Name(id='VectorSearchError', ctx=Load(), lineno=449, col_offset=14, end_lineno=449, end_col_offset=31), args=[Name(id='msg', ctx=Load(), lineno=449, col_offset=32, end_lineno=449, end_col_offset=35)], keywords=[keyword(arg='cause', value=Name(id='exc', ctx=Load(), lineno=449, col_offset=43, end_lineno=449, end_col_offset=46), lineno=449, col_offset=37, end_lineno=449, end_col_offset=46)], lineno=449, col_offset=14, end_lineno=449, end_col_offset=47), cause=Name(id='exc', ctx=Load(), lineno=449, col_offset=53, end_lineno=449, end_col_offset=56), lineno=449, col_offset=8, end_lineno=449, end_col_offset=56)], lineno=446, col_offset=4, end_lineno=449, end_col_offset=56)], lineno=440, col_offset=4, end_lineno=449, end_col_offset=56), Assign(targets=[Name(id='chunk_ids', ctx=Store(), lineno=451, col_offset=4, end_lineno=451, end_col_offset=13)], value=Call(func=Attribute(value=Subscript(value=Name(id='ids', ctx=Load(), lineno=451, col_offset=16, end_lineno=451, end_col_offset=19), slice=Constant(value=0, lineno=451, col_offset=20, end_lineno=451, end_col_offset=21), ctx=Load(), lineno=451, col_offset=16, end_lineno=451, end_col_offset=22), attr='tolist', ctx=Load(), lineno=451, col_offset=16, end_lineno=451, end_col_offset=29), lineno=451, col_offset=16, end_lineno=451, end_col_offset=31), lineno=451, col_offset=4, end_lineno=451, end_col_offset=31), Assign(targets=[Name(id='scores', ctx=Store(), lineno=452, col_offset=4, end_lineno=452, end_col_offset=10)], value=Call(func=Attribute(value=Subscript(value=Name(id='distances', ctx=Load(), lineno=452, col_offset=13, end_lineno=452, end_col_offset=22), slice=Constant(value=0, lineno=452, col_offset=23, end_lineno=452, end_col_offset=24), ctx=Load(), lineno=452, col_offset=13, end_lineno=452, end_col_offset=25), attr='tolist', ctx=Load(), lineno=452, col_offset=13, end_lineno=452, end_col_offset=32), lineno=452, col_offset=13, end_lineno=452, end_col_offset=34), lineno=452, col_offset=4, end_lineno=452, end_col_offset=34), AnnAssign(target=Name(id='hits', ctx=Store(), lineno=453, col_offset=4, end_lineno=453, end_col_offset=8), annotation=Subscript(value=Name(id='list', ctx=Load(), lineno=453, col_offset=10, end_lineno=453, end_col_offset=14), slice=Subscript(value=Name(id='tuple', ctx=Load(), lineno=453, col_offset=15, end_lineno=453, end_col_offset=20), slice=Tuple(elts=[Name(id='int', ctx=Load(), lineno=453, col_offset=21, end_lineno=453, end_col_offset=24), Name(id='float', ctx=Load(), lineno=453, col_offset=26, end_lineno=453, end_col_offset=31)], ctx=Load(), lineno=453, col_offset=21, end_lineno=453, end_col_offset=31), ctx=Load(), lineno=453, col_offset=15, end_lineno=453, end_col_offset=32), ctx=Load(), lineno=453, col_offset=10, end_lineno=453, end_col_offset=33), value=ListComp(elt=Tuple(elts=[Call(func=Name(id='int', ctx=Load(), lineno=454, col_offset=9, end_lineno=454, end_col_offset=12), args=[Name(id='chunk_id', ctx=Load(), lineno=454, col_offset=13, end_lineno=454, end_col_offset=21)], lineno=454, col_offset=9, end_lineno=454, end_col_offset=22), Call(func=Name(id='float', ctx=Load(), lineno=454, col_offset=24, end_lineno=454, end_col_offset=29), args=[Name(id='score', ctx=Load(), lineno=454, col_offset=30, end_lineno=454, end_col_offset=35)], lineno=454, col_offset=24, end_lineno=454, end_col_offset=36)], ctx=Load(), lineno=454, col_offset=8, end_lineno=454, end_col_offset=37), generators=[comprehension(target=Tuple(elts=[Name(id='chunk_id', ctx=Store(), lineno=455, col_offset=12, end_lineno=455, end_col_offset=20), Name(id='score', ctx=Store(), lineno=455, col_offset=22, end_lineno=455, end_col_offset=27)], ctx=Store(), lineno=455, col_offset=12, end_lineno=455, end_col_offset=27), iter=Call(func=Name(id='zip', ctx=Load(), lineno=455, col_offset=31, end_lineno=455, end_col_offset=34), args=[Name(id='chunk_ids', ctx=Load(), lineno=455, col_offset=35, end_lineno=455, end_col_offset=44), Name(id='scores', ctx=Load(), lineno=455, col_offset=46, end_lineno=455, end_col_offset=52)], keywords=[keyword(arg='strict', value=Constant(value=False, lineno=455, col_offset=61, end_lineno=455, end_col_offset=66), lineno=455, col_offset=54, end_lineno=455, end_col_offset=66)], lineno=455, col_offset=31, end_lineno=455, end_col_offset=67), ifs=[Compare(left=Name(id='chunk_id', ctx=Load(), lineno=456, col_offset=11, end_lineno=456, end_col_offset=19), ops=[GtE()], comparators=[Constant(value=0, lineno=456, col_offset=23, end_lineno=456, end_col_offset=24)], lineno=456, col_offset=11, end_lineno=456, end_col_offset=24)], is_async=0)], lineno=453, col_offset=36, end_lineno=457, end_col_offset=5), simple=1, lineno=453, col_offset=4, end_lineno=457, end_col_offset=5), Return(value=Name(id='hits', ctx=Load(), lineno=458, col_offset=11, end_lineno=458, end_col_offset=15), lineno=458, col_offset=4, end_lineno=458, end_col_offset=15)], returns=Subscript(value=Name(id='list', ctx=Load(), lineno=411, col_offset=5, end_lineno=411, end_col_offset=9), slice=Subscript(value=Name(id='tuple', ctx=Load(), lineno=411, col_offset=10, end_lineno=411, end_col_offset=15), slice=Tuple(elts=[Name(id='int', ctx=Load(), lineno=411, col_offset=16, end_lineno=411, end_col_offset=19), Name(id='float', ctx=Load(), lineno=411, col_offset=21, end_lineno=411, end_col_offset=26)], ctx=Load(), lineno=411, col_offset=16, end_lineno=411, end_col_offset=26), ctx=Load(), lineno=411, col_offset=10, end_lineno=411, end_col_offset=27), ctx=Load(), lineno=411, col_offset=5, end_lineno=411, end_col_offset=28), lineno=405, col_offset=0, end_lineno=458, end_col_offset=15), FunctionDef(name='_timed_coderank_stage', args=arguments(kwonlyargs=[arg(arg='context', annotation=Name(id='ApplicationContext', ctx=Load(), lineno=463, col_offset=13, end_lineno=463, end_col_offset=31), lineno=463, col_offset=4, end_lineno=463, end_col_offset=31), arg(arg='query', annotation=Name(id='str', ctx=Load(), lineno=464, col_offset=11, end_lineno=464, end_col_offset=14), lineno=464, col_offset=4, end_lineno=464, end_col_offset=14), arg(arg='fanout', annotation=Name(id='int', ctx=Load(), lineno=465, col_offset=12, end_lineno=465, end_col_offset=15), lineno=465, col_offset=4, end_lineno=465, end_col_offset=15), arg(arg='observation', annotation=Name(id='Observation', ctx=Load(), lineno=466, col_offset=17, end_lineno=466, end_col_offset=28), lineno=466, col_offset=4, end_lineno=466, end_col_offset=28)], kw_defaults=[None, None, None, None]), body=[With(items=[withitem(context_expr=Call(func=Name(id='track_stage', ctx=Load(), lineno=468, col_offset=9, end_lineno=468, end_col_offset=20), args=[Constant(value='coderank_ann', lineno=469, col_offset=8, end_lineno=469, end_col_offset=22)], keywords=[keyword(arg='budget_ms', value=Attribute(value=Attribute(value=Attribute(value=Name(id='context', ctx=Load(), lineno=470, col_offset=18, end_lineno=470, end_col_offset=25), attr='settings', ctx=Load(), lineno=470, col_offset=18, end_lineno=470, end_col_offset=34), attr='coderank', ctx=Load(), lineno=470, col_offset=18, end_lineno=470, end_col_offset=43), attr='budget_ms', ctx=Load(), lineno=470, col_offset=18, end_lineno=470, end_col_offset=53), lineno=470, col_offset=8, end_lineno=470, end_col_offset=53)], lineno=468, col_offset=9, end_lineno=471, end_col_offset=5), optional_vars=Name(id='timer', ctx=Store(), lineno=471, col_offset=9, end_lineno=471, end_col_offset=14))], body=[Assign(targets=[Name(id='hits', ctx=Store(), lineno=472, col_offset=8, end_lineno=472, end_col_offset=12)], value=Call(func=Name(id='_run_coderank_stage', ctx=Load(), lineno=472, col_offset=15, end_lineno=472, end_col_offset=34), keywords=[keyword(arg='context', value=Name(id='context', ctx=Load(), lineno=473, col_offset=20, end_lineno=473, end_col_offset=27), lineno=473, col_offset=12, end_lineno=473, end_col_offset=27), keyword(arg='query', value=Name(id='query', ctx=Load(), lineno=474, col_offset=18, end_lineno=474, end_col_offset=23), lineno=474, col_offset=12, end_lineno=474, end_col_offset=23), keyword(arg='fanout', value=Name(id='fanout', ctx=Load(), lineno=475, col_offset=19, end_lineno=475, end_col_offset=25), lineno=475, col_offset=12, end_lineno=475, end_col_offset=25), keyword(arg='observation', value=Name(id='observation', ctx=Load(), lineno=476, col_offset=24, end_lineno=476, end_col_offset=35), lineno=476, col_offset=12, end_lineno=476, end_col_offset=35)], lineno=472, col_offset=15, end_lineno=477, end_col_offset=9), lineno=472, col_offset=8, end_lineno=477, end_col_offset=9)], lineno=468, col_offset=4, end_lineno=477, end_col_offset=9), Return(value=Tuple(elts=[Name(id='hits', ctx=Load(), lineno=478, col_offset=11, end_lineno=478, end_col_offset=15), Call(func=Attribute(value=Name(id='timer', ctx=Load(), lineno=478, col_offset=17, end_lineno=478, end_col_offset=22), attr='snapshot', ctx=Load(), lineno=478, col_offset=17, end_lineno=478, end_col_offset=31), lineno=478, col_offset=17, end_lineno=478, end_col_offset=33)], ctx=Load(), lineno=478, col_offset=11, end_lineno=478, end_col_offset=33), lineno=478, col_offset=4, end_lineno=478, end_col_offset=33)], returns=Subscript(value=Name(id='tuple', ctx=Load(), lineno=467, col_offset=5, end_lineno=467, end_col_offset=10), slice=Tuple(elts=[Subscript(value=Name(id='list', ctx=Load(), lineno=467, col_offset=11, end_lineno=467, end_col_offset=15), slice=Subscript(value=Name(id='tuple', ctx=Load(), lineno=467, col_offset=16, end_lineno=467, end_col_offset=21), slice=Tuple(elts=[Name(id='int', ctx=Load(), lineno=467, col_offset=22, end_lineno=467, end_col_offset=25), Name(id='float', ctx=Load(), lineno=467, col_offset=27, end_lineno=467, end_col_offset=32)], ctx=Load(), lineno=467, col_offset=22, end_lineno=467, end_col_offset=32), ctx=Load(), lineno=467, col_offset=16, end_lineno=467, end_col_offset=33), ctx=Load(), lineno=467, col_offset=11, end_lineno=467, end_col_offset=34), Name(id='StageTiming', ctx=Load(), lineno=467, col_offset=36, end_lineno=467, end_col_offset=47)], ctx=Load(), lineno=467, col_offset=11, end_lineno=467, end_col_offset=47), ctx=Load(), lineno=467, col_offset=5, end_lineno=467, end_col_offset=48), lineno=461, col_offset=0, end_lineno=478, end_col_offset=33), FunctionDef(name='_maybe_run_warp', args=arguments(kwonlyargs=[arg(arg='context', annotation=Name(id='ApplicationContext', ctx=Load(), lineno=483, col_offset=13, end_lineno=483, end_col_offset=31), lineno=483, col_offset=4, end_lineno=483, end_col_offset=31), arg(arg='query', annotation=Name(id='str', ctx=Load(), lineno=484, col_offset=11, end_lineno=484, end_col_offset=14), lineno=484, col_offset=4, end_lineno=484, end_col_offset=14), arg(arg='candidates', annotation=Subscript(value=Name(id='list', ctx=Load(), lineno=485, col_offset=16, end_lineno=485, end_col_offset=20), slice=Subscript(value=Name(id='tuple', ctx=Load(), lineno=485, col_offset=21, end_lineno=485, end_col_offset=26), slice=Tuple(elts=[Name(id='int', ctx=Load(), lineno=485, col_offset=27, end_lineno=485, end_col_offset=30), Name(id='float', ctx=Load(), lineno=485, col_offset=32, end_lineno=485, end_col_offset=37)], ctx=Load(), lineno=485, col_offset=27, end_lineno=485, end_col_offset=37), ctx=Load(), lineno=485, col_offset=21, end_lineno=485, end_col_offset=38), ctx=Load(), lineno=485, col_offset=16, end_lineno=485, end_col_offset=39), lineno=485, col_offset=4, end_lineno=485, end_col_offset=39), arg(arg='options', annotation=Name(id='SemanticProRuntimeOptions', ctx=Load(), lineno=486, col_offset=13, end_lineno=486, end_col_offset=38), lineno=486, col_offset=4, end_lineno=486, end_col_offset=38), arg(arg='coderank_stage', annotation=Name(id='StageTiming', ctx=Load(), lineno=487, col_offset=20, end_lineno=487, end_col_offset=31), lineno=487, col_offset=4, end_lineno=487, end_col_offset=31)], kw_defaults=[None, None, None, None, None]), body=[Assign(targets=[Tuple(elts=[Name(id='should_run', ctx=Store(), lineno=489, col_offset=4, end_lineno=489, end_col_offset=14), Name(id='notes', ctx=Store(), lineno=489, col_offset=16, end_lineno=489, end_col_offset=21)], ctx=Store(), lineno=489, col_offset=4, end_lineno=489, end_col_offset=21)], value=Call(func=Name(id='_should_execute_stage_two', ctx=Load(), lineno=489, col_offset=24, end_lineno=489, end_col_offset=49), keywords=[keyword(arg='context', value=Name(id='context', ctx=Load(), lineno=490, col_offset=16, end_lineno=490, end_col_offset=23), lineno=490, col_offset=8, end_lineno=490, end_col_offset=23), keyword(arg='candidates', value=Name(id='candidates', ctx=Load(), lineno=491, col_offset=19, end_lineno=491, end_col_offset=29), lineno=491, col_offset=8, end_lineno=491, end_col_offset=29), keyword(arg='options', value=Name(id='options', ctx=Load(), lineno=492, col_offset=16, end_lineno=492, end_col_offset=23), lineno=492, col_offset=8, end_lineno=492, end_col_offset=23), keyword(arg='coderank_stage', value=Name(id='coderank_stage', ctx=Load(), lineno=493, col_offset=23, end_lineno=493, end_col_offset=37), lineno=493, col_offset=8, end_lineno=493, end_col_offset=37)], lineno=489, col_offset=24, end_lineno=494, end_col_offset=5), lineno=489, col_offset=4, end_lineno=494, end_col_offset=5), If(test=UnaryOp(op=Not(), operand=Name(id='should_run', ctx=Load(), lineno=495, col_offset=11, end_lineno=495, end_col_offset=21), lineno=495, col_offset=7, end_lineno=495, end_col_offset=21), body=[Return(value=Call(func=Name(id='WarpOutcome', ctx=Load(), lineno=496, col_offset=15, end_lineno=496, end_col_offset=26), keywords=[keyword(arg='hits', value=List(ctx=Load(), lineno=496, col_offset=32, end_lineno=496, end_col_offset=34), lineno=496, col_offset=27, end_lineno=496, end_col_offset=34), keyword(arg='notes', value=Name(id='notes', ctx=Load(), lineno=496, col_offset=42, end_lineno=496, end_col_offset=47), lineno=496, col_offset=36, end_lineno=496, end_col_offset=47), keyword(arg='timing', value=Constant(value=None, lineno=496, col_offset=56, end_lineno=496, end_col_offset=60), lineno=496, col_offset=49, end_lineno=496, end_col_offset=60), keyword(arg='explainability', value=Tuple(ctx=Load(), lineno=496, col_offset=77, end_lineno=496, end_col_offset=79), lineno=496, col_offset=62, end_lineno=496, end_col_offset=79)], lineno=496, col_offset=15, end_lineno=496, end_col_offset=80), lineno=496, col_offset=8, end_lineno=496, end_col_offset=80)], lineno=495, col_offset=4, end_lineno=496, end_col_offset=80), Return(value=Call(func=Name(id='_execute_stage_two', ctx=Load(), lineno=497, col_offset=11, end_lineno=497, end_col_offset=29), keywords=[keyword(arg='context', value=Name(id='context', ctx=Load(), lineno=498, col_offset=16, end_lineno=498, end_col_offset=23), lineno=498, col_offset=8, end_lineno=498, end_col_offset=23), keyword(arg='query', value=Name(id='query', ctx=Load(), lineno=499, col_offset=14, end_lineno=499, end_col_offset=19), lineno=499, col_offset=8, end_lineno=499, end_col_offset=19), keyword(arg='candidates', value=Name(id='candidates', ctx=Load(), lineno=500, col_offset=19, end_lineno=500, end_col_offset=29), lineno=500, col_offset=8, end_lineno=500, end_col_offset=29), keyword(arg='options', value=Name(id='options', ctx=Load(), lineno=501, col_offset=16, end_lineno=501, end_col_offset=23), lineno=501, col_offset=8, end_lineno=501, end_col_offset=23), keyword(arg='base_notes', value=Name(id='notes', ctx=Load(), lineno=502, col_offset=19, end_lineno=502, end_col_offset=24), lineno=502, col_offset=8, end_lineno=502, end_col_offset=24)], lineno=497, col_offset=11, end_lineno=503, end_col_offset=5), lineno=497, col_offset=4, end_lineno=503, end_col_offset=5)], returns=Name(id='WarpOutcome', ctx=Load(), lineno=488, col_offset=5, end_lineno=488, end_col_offset=16), lineno=481, col_offset=0, end_lineno=503, end_col_offset=5), FunctionDef(name='_should_execute_stage_two', args=arguments(kwonlyargs=[arg(arg='context', annotation=Name(id='ApplicationContext', ctx=Load(), lineno=508, col_offset=13, end_lineno=508, end_col_offset=31), lineno=508, col_offset=4, end_lineno=508, end_col_offset=31), arg(arg='candidates', annotation=Subscript(value=Name(id='list', ctx=Load(), lineno=509, col_offset=16, end_lineno=509, end_col_offset=20), slice=Subscript(value=Name(id='tuple', ctx=Load(), lineno=509, col_offset=21, end_lineno=509, end_col_offset=26), slice=Tuple(elts=[Name(id='int', ctx=Load(), lineno=509, col_offset=27, end_lineno=509, end_col_offset=30), Name(id='float', ctx=Load(), lineno=509, col_offset=32, end_lineno=509, end_col_offset=37)], ctx=Load(), lineno=509, col_offset=27, end_lineno=509, end_col_offset=37), ctx=Load(), lineno=509, col_offset=21, end_lineno=509, end_col_offset=38), ctx=Load(), lineno=509, col_offset=16, end_lineno=509, end_col_offset=39), lineno=509, col_offset=4, end_lineno=509, end_col_offset=39), arg(arg='options', annotation=Name(id='SemanticProRuntimeOptions', ctx=Load(), lineno=510, col_offset=13, end_lineno=510, end_col_offset=38), lineno=510, col_offset=4, end_lineno=510, end_col_offset=38), arg(arg='coderank_stage', annotation=Name(id='StageTiming', ctx=Load(), lineno=511, col_offset=20, end_lineno=511, end_col_offset=31), lineno=511, col_offset=4, end_lineno=511, end_col_offset=31)], kw_defaults=[None, None, None, None]), body=[AnnAssign(target=Name(id='notes', ctx=Store(), lineno=513, col_offset=4, end_lineno=513, end_col_offset=9), annotation=Subscript(value=Name(id='list', ctx=Load(), lineno=513, col_offset=11, end_lineno=513, end_col_offset=15), slice=Name(id='str', ctx=Load(), lineno=513, col_offset=16, end_lineno=513, end_col_offset=19), ctx=Load(), lineno=513, col_offset=11, end_lineno=513, end_col_offset=20), value=List(ctx=Load(), lineno=513, col_offset=23, end_lineno=513, end_col_offset=25), simple=1, lineno=513, col_offset=4, end_lineno=513, end_col_offset=25), Assign(targets=[Name(id='stage_name', ctx=Store(), lineno=514, col_offset=4, end_lineno=514, end_col_offset=14)], value=Constant(value='stage_b', lineno=514, col_offset=17, end_lineno=514, end_col_offset=26), lineno=514, col_offset=4, end_lineno=514, end_col_offset=26), If(test=UnaryOp(op=Not(), operand=Name(id='candidates', ctx=Load(), lineno=515, col_offset=11, end_lineno=515, end_col_offset=21), lineno=515, col_offset=7, end_lineno=515, end_col_offset=21), body=[Expr(value=Call(func=Attribute(value=Name(id='notes', ctx=Load(), lineno=516, col_offset=8, end_lineno=516, end_col_offset=13), attr='append', ctx=Load(), lineno=516, col_offset=8, end_lineno=516, end_col_offset=20), args=[Constant(value='No CodeRank candidates; skipping Stage-B.', lineno=516, col_offset=21, end_lineno=516, end_col_offset=64)], lineno=516, col_offset=8, end_lineno=516, end_col_offset=65), lineno=516, col_offset=8, end_lineno=516, end_col_offset=65), Expr(value=Call(func=Name(id='record_stage_decision', ctx=Load(), lineno=517, col_offset=8, end_lineno=517, end_col_offset=29), args=[Name(id='COMPONENT_NAME', ctx=Load(), lineno=518, col_offset=12, end_lineno=518, end_col_offset=26), Name(id='stage_name', ctx=Load(), lineno=519, col_offset=12, end_lineno=519, end_col_offset=22)], keywords=[keyword(arg='decision', value=Call(func=Name(id='StageDecision', ctx=Load(), lineno=520, col_offset=21, end_lineno=520, end_col_offset=34), keywords=[keyword(arg='should_run', value=Constant(value=False, lineno=520, col_offset=46, end_lineno=520, end_col_offset=51), lineno=520, col_offset=35, end_lineno=520, end_col_offset=51), keyword(arg='reason', value=Constant(value='no_candidates', lineno=520, col_offset=60, end_lineno=520, end_col_offset=75), lineno=520, col_offset=53, end_lineno=520, end_col_offset=75)], lineno=520, col_offset=21, end_lineno=520, end_col_offset=76), lineno=520, col_offset=12, end_lineno=520, end_col_offset=76)], lineno=517, col_offset=8, end_lineno=521, end_col_offset=9), lineno=517, col_offset=8, end_lineno=521, end_col_offset=9), Return(value=Tuple(elts=[Constant(value=False, lineno=522, col_offset=15, end_lineno=522, end_col_offset=20), Name(id='notes', ctx=Load(), lineno=522, col_offset=22, end_lineno=522, end_col_offset=27)], ctx=Load(), lineno=522, col_offset=15, end_lineno=522, end_col_offset=27), lineno=522, col_offset=8, end_lineno=522, end_col_offset=27)], lineno=515, col_offset=4, end_lineno=522, end_col_offset=27), If(test=UnaryOp(op=Not(), operand=Attribute(value=Name(id='options', ctx=Load(), lineno=523, col_offset=11, end_lineno=523, end_col_offset=18), attr='use_warp', ctx=Load(), lineno=523, col_offset=11, end_lineno=523, end_col_offset=27), lineno=523, col_offset=7, end_lineno=523, end_col_offset=27), body=[Expr(value=Call(func=Attribute(value=Name(id='notes', ctx=Load(), lineno=524, col_offset=8, end_lineno=524, end_col_offset=13), attr='append', ctx=Load(), lineno=524, col_offset=8, end_lineno=524, end_col_offset=20), args=[Constant(value='Stage-B disabled via request option.', lineno=524, col_offset=21, end_lineno=524, end_col_offset=59)], lineno=524, col_offset=8, end_lineno=524, end_col_offset=60), lineno=524, col_offset=8, end_lineno=524, end_col_offset=60), Expr(value=Call(func=Name(id='record_stage_decision', ctx=Load(), lineno=525, col_offset=8, end_lineno=525, end_col_offset=29), args=[Name(id='COMPONENT_NAME', ctx=Load(), lineno=526, col_offset=12, end_lineno=526, end_col_offset=26), Name(id='stage_name', ctx=Load(), lineno=527, col_offset=12, end_lineno=527, end_col_offset=22)], keywords=[keyword(arg='decision', value=Call(func=Name(id='StageDecision', ctx=Load(), lineno=528, col_offset=21, end_lineno=528, end_col_offset=34), keywords=[keyword(arg='should_run', value=Constant(value=False, lineno=528, col_offset=46, end_lineno=528, end_col_offset=51), lineno=528, col_offset=35, end_lineno=528, end_col_offset=51), keyword(arg='reason', value=Constant(value='disabled_option', lineno=528, col_offset=60, end_lineno=528, end_col_offset=77), lineno=528, col_offset=53, end_lineno=528, end_col_offset=77)], lineno=528, col_offset=21, end_lineno=528, end_col_offset=78), lineno=528, col_offset=12, end_lineno=528, end_col_offset=78)], lineno=525, col_offset=8, end_lineno=529, end_col_offset=9), lineno=525, col_offset=8, end_lineno=529, end_col_offset=9), Return(value=Tuple(elts=[Constant(value=False, lineno=530, col_offset=15, end_lineno=530, end_col_offset=20), Name(id='notes', ctx=Load(), lineno=530, col_offset=22, end_lineno=530, end_col_offset=27)], ctx=Load(), lineno=530, col_offset=15, end_lineno=530, end_col_offset=27), lineno=530, col_offset=8, end_lineno=530, end_col_offset=27)], lineno=523, col_offset=4, end_lineno=530, end_col_offset=27), Assign(targets=[Name(id='stage_available', ctx=Store(), lineno=531, col_offset=4, end_lineno=531, end_col_offset=19)], value=BoolOp(op=Or(), values=[Attribute(value=Attribute(value=Attribute(value=Name(id='context', ctx=Load(), lineno=531, col_offset=22, end_lineno=531, end_col_offset=29), attr='settings', ctx=Load(), lineno=531, col_offset=22, end_lineno=531, end_col_offset=38), attr='warp', ctx=Load(), lineno=531, col_offset=22, end_lineno=531, end_col_offset=43), attr='enabled', ctx=Load(), lineno=531, col_offset=22, end_lineno=531, end_col_offset=51), Attribute(value=Attribute(value=Attribute(value=Name(id='context', ctx=Load(), lineno=531, col_offset=55, end_lineno=531, end_col_offset=62), attr='settings', ctx=Load(), lineno=531, col_offset=55, end_lineno=531, end_col_offset=71), attr='xtr', ctx=Load(), lineno=531, col_offset=55, end_lineno=531, end_col_offset=75), attr='enable', ctx=Load(), lineno=531, col_offset=55, end_lineno=531, end_col_offset=82)], lineno=531, col_offset=22, end_lineno=531, end_col_offset=82), lineno=531, col_offset=4, end_lineno=531, end_col_offset=82), If(test=UnaryOp(op=Not(), operand=Name(id='stage_available', ctx=Load(), lineno=532, col_offset=11, end_lineno=532, end_col_offset=26), lineno=532, col_offset=7, end_lineno=532, end_col_offset=26), body=[Expr(value=Call(func=Attribute(value=Name(id='notes', ctx=Load(), lineno=533, col_offset=8, end_lineno=533, end_col_offset=13), attr='append', ctx=Load(), lineno=533, col_offset=8, end_lineno=533, end_col_offset=20), args=[Constant(value='WARP/XTR disabled via configuration flag.', lineno=533, col_offset=21, end_lineno=533, end_col_offset=64)], lineno=533, col_offset=8, end_lineno=533, end_col_offset=65), lineno=533, col_offset=8, end_lineno=533, end_col_offset=65), Expr(value=Call(func=Name(id='record_stage_decision', ctx=Load(), lineno=534, col_offset=8, end_lineno=534, end_col_offset=29), args=[Name(id='COMPONENT_NAME', ctx=Load(), lineno=535, col_offset=12, end_lineno=535, end_col_offset=26), Name(id='stage_name', ctx=Load(), lineno=536, col_offset=12, end_lineno=536, end_col_offset=22)], keywords=[keyword(arg='decision', value=Call(func=Name(id='StageDecision', ctx=Load(), lineno=537, col_offset=21, end_lineno=537, end_col_offset=34), keywords=[keyword(arg='should_run', value=Constant(value=False, lineno=537, col_offset=46, end_lineno=537, end_col_offset=51), lineno=537, col_offset=35, end_lineno=537, end_col_offset=51), keyword(arg='reason', value=Constant(value='disabled_config', lineno=537, col_offset=60, end_lineno=537, end_col_offset=77), lineno=537, col_offset=53, end_lineno=537, end_col_offset=77)], lineno=537, col_offset=21, end_lineno=537, end_col_offset=78), lineno=537, col_offset=12, end_lineno=537, end_col_offset=78)], lineno=534, col_offset=8, end_lineno=538, end_col_offset=9), lineno=534, col_offset=8, end_lineno=538, end_col_offset=9), Return(value=Tuple(elts=[Constant(value=False, lineno=539, col_offset=15, end_lineno=539, end_col_offset=20), Name(id='notes', ctx=Load(), lineno=539, col_offset=22, end_lineno=539, end_col_offset=27)], ctx=Load(), lineno=539, col_offset=15, end_lineno=539, end_col_offset=27), lineno=539, col_offset=8, end_lineno=539, end_col_offset=27)], lineno=532, col_offset=4, end_lineno=539, end_col_offset=27), Assign(targets=[Name(id='signals', ctx=Store(), lineno=540, col_offset=4, end_lineno=540, end_col_offset=11)], value=Call(func=Name(id='StageSignals', ctx=Load(), lineno=540, col_offset=14, end_lineno=540, end_col_offset=26), keywords=[keyword(arg='candidate_count', value=Call(func=Name(id='len', ctx=Load(), lineno=541, col_offset=24, end_lineno=541, end_col_offset=27), args=[Name(id='candidates', ctx=Load(), lineno=541, col_offset=28, end_lineno=541, end_col_offset=38)], lineno=541, col_offset=24, end_lineno=541, end_col_offset=39), lineno=541, col_offset=8, end_lineno=541, end_col_offset=39), keyword(arg='elapsed_ms', value=Attribute(value=Name(id='coderank_stage', ctx=Load(), lineno=542, col_offset=19, end_lineno=542, end_col_offset=33), attr='duration_ms', ctx=Load(), lineno=542, col_offset=19, end_lineno=542, end_col_offset=45), lineno=542, col_offset=8, end_lineno=542, end_col_offset=45), keyword(arg='best_score', value=IfExp(test=Name(id='candidates', ctx=Load(), lineno=543, col_offset=39, end_lineno=543, end_col_offset=49), body=Subscript(value=Subscript(value=Name(id='candidates', ctx=Load(), lineno=543, col_offset=19, end_lineno=543, end_col_offset=29), slice=Constant(value=0, lineno=543, col_offset=30, end_lineno=543, end_col_offset=31), ctx=Load(), lineno=543, col_offset=19, end_lineno=543, end_col_offset=32), slice=Constant(value=1, lineno=543, col_offset=33, end_lineno=543, end_col_offset=34), ctx=Load(), lineno=543, col_offset=19, end_lineno=543, end_col_offset=35), orelse=Constant(value=None, lineno=543, col_offset=55, end_lineno=543, end_col_offset=59), lineno=543, col_offset=19, end_lineno=543, end_col_offset=59), lineno=543, col_offset=8, end_lineno=543, end_col_offset=59), keyword(arg='second_best_score', value=IfExp(test=Compare(left=Call(func=Name(id='len', ctx=Load(), lineno=544, col_offset=46, end_lineno=544, end_col_offset=49), args=[Name(id='candidates', ctx=Load(), lineno=544, col_offset=50, end_lineno=544, end_col_offset=60)], lineno=544, col_offset=46, end_lineno=544, end_col_offset=61), ops=[Gt()], comparators=[Constant(value=1, lineno=544, col_offset=64, end_lineno=544, end_col_offset=65)], lineno=544, col_offset=46, end_lineno=544, end_col_offset=65), body=Subscript(value=Subscript(value=Name(id='candidates', ctx=Load(), lineno=544, col_offset=26, end_lineno=544, end_col_offset=36), slice=Constant(value=1, lineno=544, col_offset=37, end_lineno=544, end_col_offset=38), ctx=Load(), lineno=544, col_offset=26, end_lineno=544, end_col_offset=39), slice=Constant(value=1, lineno=544, col_offset=40, end_lineno=544, end_col_offset=41), ctx=Load(), lineno=544, col_offset=26, end_lineno=544, end_col_offset=42), orelse=Constant(value=None, lineno=544, col_offset=71, end_lineno=544, end_col_offset=75), lineno=544, col_offset=26, end_lineno=544, end_col_offset=75), lineno=544, col_offset=8, end_lineno=544, end_col_offset=75)], lineno=540, col_offset=14, end_lineno=545, end_col_offset=5), lineno=540, col_offset=4, end_lineno=545, end_col_offset=5), Assign(targets=[Name(id='gate_config', ctx=Store(), lineno=546, col_offset=4, end_lineno=546, end_col_offset=15)], value=Call(func=Name(id='StageGateConfig', ctx=Load(), lineno=546, col_offset=18, end_lineno=546, end_col_offset=33), keywords=[keyword(arg='min_candidates', value=Attribute(value=Attribute(value=Attribute(value=Name(id='context', ctx=Load(), lineno=547, col_offset=23, end_lineno=547, end_col_offset=30), attr='settings', ctx=Load(), lineno=547, col_offset=23, end_lineno=547, end_col_offset=39), attr='coderank', ctx=Load(), lineno=547, col_offset=23, end_lineno=547, end_col_offset=48), attr='min_stage2_candidates', ctx=Load(), lineno=547, col_offset=23, end_lineno=547, end_col_offset=70), lineno=547, col_offset=8, end_lineno=547, end_col_offset=70), keyword(arg='margin_threshold', value=Attribute(value=Attribute(value=Attribute(value=Name(id='context', ctx=Load(), lineno=548, col_offset=25, end_lineno=548, end_col_offset=32), attr='settings', ctx=Load(), lineno=548, col_offset=25, end_lineno=548, end_col_offset=41), attr='coderank', ctx=Load(), lineno=548, col_offset=25, end_lineno=548, end_col_offset=50), attr='min_stage2_margin', ctx=Load(), lineno=548, col_offset=25, end_lineno=548, end_col_offset=68), lineno=548, col_offset=8, end_lineno=548, end_col_offset=68), keyword(arg='budget_ms', value=Attribute(value=Attribute(value=Attribute(value=Name(id='context', ctx=Load(), lineno=549, col_offset=18, end_lineno=549, end_col_offset=25), attr='settings', ctx=Load(), lineno=549, col_offset=18, end_lineno=549, end_col_offset=34), attr='coderank', ctx=Load(), lineno=549, col_offset=18, end_lineno=549, end_col_offset=43), attr='budget_ms', ctx=Load(), lineno=549, col_offset=18, end_lineno=549, end_col_offset=53), lineno=549, col_offset=8, end_lineno=549, end_col_offset=53)], lineno=546, col_offset=18, end_lineno=550, end_col_offset=5), lineno=546, col_offset=4, end_lineno=550, end_col_offset=5), Assign(targets=[Name(id='decision', ctx=Store(), lineno=551, col_offset=4, end_lineno=551, end_col_offset=12)], value=Call(func=Name(id='should_run_secondary_stage', ctx=Load(), lineno=551, col_offset=15, end_lineno=551, end_col_offset=41), args=[Name(id='signals', ctx=Load(), lineno=551, col_offset=42, end_lineno=551, end_col_offset=49), Name(id='gate_config', ctx=Load(), lineno=551, col_offset=51, end_lineno=551, end_col_offset=62)], lineno=551, col_offset=15, end_lineno=551, end_col_offset=63), lineno=551, col_offset=4, end_lineno=551, end_col_offset=63), Expr(value=Call(func=Name(id='record_stage_decision', ctx=Load(), lineno=552, col_offset=4, end_lineno=552, end_col_offset=25), args=[Name(id='COMPONENT_NAME', ctx=Load(), lineno=552, col_offset=26, end_lineno=552, end_col_offset=40), Name(id='stage_name', ctx=Load(), lineno=552, col_offset=42, end_lineno=552, end_col_offset=52)], keywords=[keyword(arg='decision', value=Name(id='decision', ctx=Load(), lineno=552, col_offset=63, end_lineno=552, end_col_offset=71), lineno=552, col_offset=54, end_lineno=552, end_col_offset=71)], lineno=552, col_offset=4, end_lineno=552, end_col_offset=72), lineno=552, col_offset=4, end_lineno=552, end_col_offset=72), If(test=UnaryOp(op=Not(), operand=Attribute(value=Name(id='decision', ctx=Load(), lineno=553, col_offset=11, end_lineno=553, end_col_offset=19), attr='should_run', ctx=Load(), lineno=553, col_offset=11, end_lineno=553, end_col_offset=30), lineno=553, col_offset=7, end_lineno=553, end_col_offset=30), body=[Expr(value=Call(func=Attribute(value=Name(id='notes', ctx=Load(), lineno=554, col_offset=8, end_lineno=554, end_col_offset=13), attr='append', ctx=Load(), lineno=554, col_offset=8, end_lineno=554, end_col_offset=20), args=[JoinedStr(values=[Constant(value='Stage-B gating: ', lineno=554, col_offset=23, end_lineno=554, end_col_offset=39), FormattedValue(value=Attribute(value=Name(id='decision', ctx=Load(), lineno=554, col_offset=40, end_lineno=554, end_col_offset=48), attr='reason', ctx=Load(), lineno=554, col_offset=40, end_lineno=554, end_col_offset=55), conversion=-1, lineno=554, col_offset=39, end_lineno=554, end_col_offset=56)], lineno=554, col_offset=21, end_lineno=554, end_col_offset=57)], lineno=554, col_offset=8, end_lineno=554, end_col_offset=58), lineno=554, col_offset=8, end_lineno=554, end_col_offset=58), Expr(value=Call(func=Attribute(value=Name(id='notes', ctx=Load(), lineno=555, col_offset=8, end_lineno=555, end_col_offset=13), attr='extend', ctx=Load(), lineno=555, col_offset=8, end_lineno=555, end_col_offset=20), args=[Attribute(value=Name(id='decision', ctx=Load(), lineno=555, col_offset=21, end_lineno=555, end_col_offset=29), attr='notes', ctx=Load(), lineno=555, col_offset=21, end_lineno=555, end_col_offset=35)], lineno=555, col_offset=8, end_lineno=555, end_col_offset=36), lineno=555, col_offset=8, end_lineno=555, end_col_offset=36), Return(value=Tuple(elts=[Constant(value=False, lineno=556, col_offset=15, end_lineno=556, end_col_offset=20), Name(id='notes', ctx=Load(), lineno=556, col_offset=22, end_lineno=556, end_col_offset=27)], ctx=Load(), lineno=556, col_offset=15, end_lineno=556, end_col_offset=27), lineno=556, col_offset=8, end_lineno=556, end_col_offset=27)], lineno=553, col_offset=4, end_lineno=556, end_col_offset=27), Return(value=Tuple(elts=[Constant(value=True, lineno=557, col_offset=11, end_lineno=557, end_col_offset=15), Name(id='notes', ctx=Load(), lineno=557, col_offset=17, end_lineno=557, end_col_offset=22)], ctx=Load(), lineno=557, col_offset=11, end_lineno=557, end_col_offset=22), lineno=557, col_offset=4, end_lineno=557, end_col_offset=22)], returns=Subscript(value=Name(id='tuple', ctx=Load(), lineno=512, col_offset=5, end_lineno=512, end_col_offset=10), slice=Tuple(elts=[Name(id='bool', ctx=Load(), lineno=512, col_offset=11, end_lineno=512, end_col_offset=15), Subscript(value=Name(id='list', ctx=Load(), lineno=512, col_offset=17, end_lineno=512, end_col_offset=21), slice=Name(id='str', ctx=Load(), lineno=512, col_offset=22, end_lineno=512, end_col_offset=25), ctx=Load(), lineno=512, col_offset=17, end_lineno=512, end_col_offset=26)], ctx=Load(), lineno=512, col_offset=11, end_lineno=512, end_col_offset=26), ctx=Load(), lineno=512, col_offset=5, end_lineno=512, end_col_offset=27), lineno=506, col_offset=0, end_lineno=557, end_col_offset=22), FunctionDef(name='_execute_stage_two', args=arguments(kwonlyargs=[arg(arg='context', annotation=Name(id='ApplicationContext', ctx=Load(), lineno=562, col_offset=13, end_lineno=562, end_col_offset=31), lineno=562, col_offset=4, end_lineno=562, end_col_offset=31), arg(arg='query', annotation=Name(id='str', ctx=Load(), lineno=563, col_offset=11, end_lineno=563, end_col_offset=14), lineno=563, col_offset=4, end_lineno=563, end_col_offset=14), arg(arg='candidates', annotation=Subscript(value=Name(id='list', ctx=Load(), lineno=564, col_offset=16, end_lineno=564, end_col_offset=20), slice=Subscript(value=Name(id='tuple', ctx=Load(), lineno=564, col_offset=21, end_lineno=564, end_col_offset=26), slice=Tuple(elts=[Name(id='int', ctx=Load(), lineno=564, col_offset=27, end_lineno=564, end_col_offset=30), Name(id='float', ctx=Load(), lineno=564, col_offset=32, end_lineno=564, end_col_offset=37)], ctx=Load(), lineno=564, col_offset=27, end_lineno=564, end_col_offset=37), ctx=Load(), lineno=564, col_offset=21, end_lineno=564, end_col_offset=38), ctx=Load(), lineno=564, col_offset=16, end_lineno=564, end_col_offset=39), lineno=564, col_offset=4, end_lineno=564, end_col_offset=39), arg(arg='options', annotation=Name(id='SemanticProRuntimeOptions', ctx=Load(), lineno=565, col_offset=13, end_lineno=565, end_col_offset=38), lineno=565, col_offset=4, end_lineno=565, end_col_offset=38), arg(arg='base_notes', annotation=Subscript(value=Name(id='list', ctx=Load(), lineno=566, col_offset=16, end_lineno=566, end_col_offset=20), slice=Name(id='str', ctx=Load(), lineno=566, col_offset=21, end_lineno=566, end_col_offset=24), ctx=Load(), lineno=566, col_offset=16, end_lineno=566, end_col_offset=25), lineno=566, col_offset=4, end_lineno=566, end_col_offset=25)], kw_defaults=[None, None, None, None, None]), body=[With(items=[withitem(context_expr=Call(func=Name(id='track_stage', ctx=Load(), lineno=568, col_offset=9, end_lineno=568, end_col_offset=20), args=[Constant(value='warp_late_interaction', lineno=569, col_offset=8, end_lineno=569, end_col_offset=31)], keywords=[keyword(arg='budget_ms', value=Attribute(value=Attribute(value=Attribute(value=Name(id='context', ctx=Load(), lineno=570, col_offset=18, end_lineno=570, end_col_offset=25), attr='settings', ctx=Load(), lineno=570, col_offset=18, end_lineno=570, end_col_offset=34), attr='warp', ctx=Load(), lineno=570, col_offset=18, end_lineno=570, end_col_offset=39), attr='budget_ms', ctx=Load(), lineno=570, col_offset=18, end_lineno=570, end_col_offset=49), lineno=570, col_offset=8, end_lineno=570, end_col_offset=49)], lineno=568, col_offset=9, end_lineno=571, end_col_offset=5), optional_vars=Name(id='warp_timer', ctx=Store(), lineno=571, col_offset=9, end_lineno=571, end_col_offset=19))], body=[Assign(targets=[Tuple(elts=[Name(id='hits', ctx=Store(), lineno=572, col_offset=8, end_lineno=572, end_col_offset=12), Name(id='warp_notes', ctx=Store(), lineno=572, col_offset=14, end_lineno=572, end_col_offset=24), Name(id='explain_payload', ctx=Store(), lineno=572, col_offset=26, end_lineno=572, end_col_offset=41), Name(id='channel', ctx=Store(), lineno=572, col_offset=43, end_lineno=572, end_col_offset=50)], ctx=Store(), lineno=572, col_offset=8, end_lineno=572, end_col_offset=50)], value=Call(func=Name(id='_run_warp_stage', ctx=Load(), lineno=572, col_offset=53, end_lineno=572, end_col_offset=68), keywords=[keyword(arg='context', value=Name(id='context', ctx=Load(), lineno=573, col_offset=20, end_lineno=573, end_col_offset=27), lineno=573, col_offset=12, end_lineno=573, end_col_offset=27), keyword(arg='query', value=Name(id='query', ctx=Load(), lineno=574, col_offset=18, end_lineno=574, end_col_offset=23), lineno=574, col_offset=12, end_lineno=574, end_col_offset=23), keyword(arg='candidates', value=Name(id='candidates', ctx=Load(), lineno=575, col_offset=23, end_lineno=575, end_col_offset=33), lineno=575, col_offset=12, end_lineno=575, end_col_offset=33), keyword(arg='options', value=Name(id='options', ctx=Load(), lineno=576, col_offset=20, end_lineno=576, end_col_offset=27), lineno=576, col_offset=12, end_lineno=576, end_col_offset=27)], lineno=572, col_offset=53, end_lineno=577, end_col_offset=9), lineno=572, col_offset=8, end_lineno=577, end_col_offset=9)], lineno=568, col_offset=4, end_lineno=577, end_col_offset=9), Assign(targets=[Name(id='notes', ctx=Store(), lineno=578, col_offset=4, end_lineno=578, end_col_offset=9)], value=List(elts=[Starred(value=Name(id='base_notes', ctx=Load(), lineno=578, col_offset=14, end_lineno=578, end_col_offset=24), ctx=Load(), lineno=578, col_offset=13, end_lineno=578, end_col_offset=24), Starred(value=Name(id='warp_notes', ctx=Load(), lineno=578, col_offset=27, end_lineno=578, end_col_offset=37), ctx=Load(), lineno=578, col_offset=26, end_lineno=578, end_col_offset=37)], ctx=Load(), lineno=578, col_offset=12, end_lineno=578, end_col_offset=38), lineno=578, col_offset=4, end_lineno=578, end_col_offset=38), Assign(targets=[Name(id='outcome', ctx=Store(), lineno=579, col_offset=4, end_lineno=579, end_col_offset=11)], value=Call(func=Name(id='WarpOutcome', ctx=Load(), lineno=579, col_offset=14, end_lineno=579, end_col_offset=25), keywords=[keyword(arg='hits', value=Name(id='hits', ctx=Load(), lineno=580, col_offset=13, end_lineno=580, end_col_offset=17), lineno=580, col_offset=8, end_lineno=580, end_col_offset=17), keyword(arg='notes', value=Name(id='notes', ctx=Load(), lineno=581, col_offset=14, end_lineno=581, end_col_offset=19), lineno=581, col_offset=8, end_lineno=581, end_col_offset=19), keyword(arg='timing', value=Call(func=Attribute(value=Name(id='warp_timer', ctx=Load(), lineno=582, col_offset=15, end_lineno=582, end_col_offset=25), attr='snapshot', ctx=Load(), lineno=582, col_offset=15, end_lineno=582, end_col_offset=34), lineno=582, col_offset=15, end_lineno=582, end_col_offset=36), lineno=582, col_offset=8, end_lineno=582, end_col_offset=36), keyword(arg='explainability', value=Call(func=Name(id='tuple', ctx=Load(), lineno=583, col_offset=23, end_lineno=583, end_col_offset=28), args=[Name(id='explain_payload', ctx=Load(), lineno=583, col_offset=29, end_lineno=583, end_col_offset=44)], lineno=583, col_offset=23, end_lineno=583, end_col_offset=45), lineno=583, col_offset=8, end_lineno=583, end_col_offset=45), keyword(arg='channel', value=Name(id='channel', ctx=Load(), lineno=584, col_offset=16, end_lineno=584, end_col_offset=23), lineno=584, col_offset=8, end_lineno=584, end_col_offset=23)], lineno=579, col_offset=14, end_lineno=585, end_col_offset=5), lineno=579, col_offset=4, end_lineno=585, end_col_offset=5), Expr(value=Call(func=Name(id='record_stage_decision', ctx=Load(), lineno=586, col_offset=4, end_lineno=586, end_col_offset=25), args=[Name(id='COMPONENT_NAME', ctx=Load(), lineno=587, col_offset=8, end_lineno=587, end_col_offset=22), Name(id='channel', ctx=Load(), lineno=588, col_offset=8, end_lineno=588, end_col_offset=15)], keywords=[keyword(arg='decision', value=Call(func=Name(id='StageDecision', ctx=Load(), lineno=589, col_offset=17, end_lineno=589, end_col_offset=30), keywords=[keyword(arg='should_run', value=Constant(value=True, lineno=589, col_offset=42, end_lineno=589, end_col_offset=46), lineno=589, col_offset=31, end_lineno=589, end_col_offset=46), keyword(arg='reason', value=Constant(value='executed', lineno=589, col_offset=55, end_lineno=589, end_col_offset=65), lineno=589, col_offset=48, end_lineno=589, end_col_offset=65)], lineno=589, col_offset=17, end_lineno=589, end_col_offset=66), lineno=589, col_offset=8, end_lineno=589, end_col_offset=66)], lineno=586, col_offset=4, end_lineno=590, end_col_offset=5), lineno=586, col_offset=4, end_lineno=590, end_col_offset=5), Return(value=Name(id='outcome', ctx=Load(), lineno=591, col_offset=11, end_lineno=591, end_col_offset=18), lineno=591, col_offset=4, end_lineno=591, end_col_offset=18)], returns=Name(id='WarpOutcome', ctx=Load(), lineno=567, col_offset=5, end_lineno=567, end_col_offset=16), lineno=560, col_offset=0, end_lineno=591, end_col_offset=18), FunctionDef(name='_run_fusion_stage', args=arguments(kwonlyargs=[arg(arg='context', annotation=Name(id='ApplicationContext', ctx=Load(), lineno=596, col_offset=13, end_lineno=596, end_col_offset=31), lineno=596, col_offset=4, end_lineno=596, end_col_offset=31), arg(arg='request', annotation=Name(id='FusionRequest', ctx=Load(), lineno=597, col_offset=13, end_lineno=597, end_col_offset=26), lineno=597, col_offset=4, end_lineno=597, end_col_offset=26), arg(arg='stage_timings', annotation=Subscript(value=Name(id='list', ctx=Load(), lineno=598, col_offset=19, end_lineno=598, end_col_offset=23), slice=Name(id='StageTiming', ctx=Load(), lineno=598, col_offset=24, end_lineno=598, end_col_offset=35), ctx=Load(), lineno=598, col_offset=19, end_lineno=598, end_col_offset=36), lineno=598, col_offset=4, end_lineno=598, end_col_offset=36)], kw_defaults=[None, None, None]), body=[Assign(targets=[Name(id='engine', ctx=Store(), lineno=600, col_offset=4, end_lineno=600, end_col_offset=10)], value=Call(func=Attribute(value=Name(id='context', ctx=Load(), lineno=600, col_offset=13, end_lineno=600, end_col_offset=20), attr='get_hybrid_engine', ctx=Load(), lineno=600, col_offset=13, end_lineno=600, end_col_offset=38), lineno=600, col_offset=13, end_lineno=600, end_col_offset=40), lineno=600, col_offset=4, end_lineno=600, end_col_offset=40), Assign(targets=[Name(id='total_limit', ctx=Store(), lineno=601, col_offset=4, end_lineno=601, end_col_offset=15)], value=Call(func=Name(id='max', ctx=Load(), lineno=601, col_offset=18, end_lineno=601, end_col_offset=21), args=[Attribute(value=Name(id='request', ctx=Load(), lineno=602, col_offset=8, end_lineno=602, end_col_offset=15), attr='effective_limit', ctx=Load(), lineno=602, col_offset=8, end_lineno=602, end_col_offset=31), BinOp(left=Attribute(value=Name(id='request', ctx=Load(), lineno=603, col_offset=8, end_lineno=603, end_col_offset=15), attr='effective_limit', ctx=Load(), lineno=603, col_offset=8, end_lineno=603, end_col_offset=31), op=Mult(), right=Attribute(value=Attribute(value=Attribute(value=Name(id='context', ctx=Load(), lineno=603, col_offset=34, end_lineno=603, end_col_offset=41), attr='settings', ctx=Load(), lineno=603, col_offset=34, end_lineno=603, end_col_offset=50), attr='limits', ctx=Load(), lineno=603, col_offset=34, end_lineno=603, end_col_offset=57), attr='semantic_overfetch_multiplier', ctx=Load(), lineno=603, col_offset=34, end_lineno=603, end_col_offset=87), lineno=603, col_offset=8, end_lineno=603, end_col_offset=87)], lineno=601, col_offset=18, end_lineno=604, end_col_offset=5), lineno=601, col_offset=4, end_lineno=604, end_col_offset=5), With(items=[withitem(context_expr=Call(func=Name(id='track_stage', ctx=Load(), lineno=605, col_offset=9, end_lineno=605, end_col_offset=20), args=[Constant(value='fusion_rrf', lineno=605, col_offset=21, end_lineno=605, end_col_offset=33)], lineno=605, col_offset=9, end_lineno=605, end_col_offset=34), optional_vars=Name(id='fusion_timer', ctx=Store(), lineno=605, col_offset=38, end_lineno=605, end_col_offset=50))], body=[Assign(targets=[Name(id='fused', ctx=Store(), lineno=606, col_offset=8, end_lineno=606, end_col_offset=13)], value=Call(func=Attribute(value=Name(id='engine', ctx=Load(), lineno=606, col_offset=16, end_lineno=606, end_col_offset=22), attr='search', ctx=Load(), lineno=606, col_offset=16, end_lineno=606, end_col_offset=29), args=[Attribute(value=Name(id='request', ctx=Load(), lineno=607, col_offset=12, end_lineno=607, end_col_offset=19), attr='query', ctx=Load(), lineno=607, col_offset=12, end_lineno=607, end_col_offset=25)], keywords=[keyword(arg='semantic_hits', value=Attribute(value=Name(id='request', ctx=Load(), lineno=608, col_offset=26, end_lineno=608, end_col_offset=33), attr='coderank_hits', ctx=Load(), lineno=608, col_offset=26, end_lineno=608, end_col_offset=47), lineno=608, col_offset=12, end_lineno=608, end_col_offset=47), keyword(arg='limit', value=Name(id='total_limit', ctx=Load(), lineno=609, col_offset=18, end_lineno=609, end_col_offset=29), lineno=609, col_offset=12, end_lineno=609, end_col_offset=29), keyword(arg='extra_channels', value=Call(func=Name(id='_build_extra_channels', ctx=Load(), lineno=610, col_offset=27, end_lineno=610, end_col_offset=48), args=[Attribute(value=Name(id='request', ctx=Load(), lineno=610, col_offset=49, end_lineno=610, end_col_offset=56), attr='warp_hits', ctx=Load(), lineno=610, col_offset=49, end_lineno=610, end_col_offset=66), Attribute(value=Name(id='request', ctx=Load(), lineno=610, col_offset=68, end_lineno=610, end_col_offset=75), attr='warp_channel', ctx=Load(), lineno=610, col_offset=68, end_lineno=610, end_col_offset=88)], lineno=610, col_offset=27, end_lineno=610, end_col_offset=89), lineno=610, col_offset=12, end_lineno=610, end_col_offset=89), keyword(arg='weights', value=Attribute(value=Name(id='request', ctx=Load(), lineno=611, col_offset=20, end_lineno=611, end_col_offset=27), attr='weights', ctx=Load(), lineno=611, col_offset=20, end_lineno=611, end_col_offset=35), lineno=611, col_offset=12, end_lineno=611, end_col_offset=35)], lineno=606, col_offset=16, end_lineno=612, end_col_offset=9), lineno=606, col_offset=8, end_lineno=612, end_col_offset=9)], lineno=605, col_offset=4, end_lineno=612, end_col_offset=9), Expr(value=Call(func=Attribute(value=Name(id='stage_timings', ctx=Load(), lineno=613, col_offset=4, end_lineno=613, end_col_offset=17), attr='append', ctx=Load(), lineno=613, col_offset=4, end_lineno=613, end_col_offset=24), args=[Call(func=Attribute(value=Name(id='fusion_timer', ctx=Load(), lineno=613, col_offset=25, end_lineno=613, end_col_offset=37), attr='snapshot', ctx=Load(), lineno=613, col_offset=25, end_lineno=613, end_col_offset=46), lineno=613, col_offset=25, end_lineno=613, end_col_offset=48)], lineno=613, col_offset=4, end_lineno=613, end_col_offset=49), lineno=613, col_offset=4, end_lineno=613, end_col_offset=49), Return(value=Name(id='fused', ctx=Load(), lineno=614, col_offset=11, end_lineno=614, end_col_offset=16), lineno=614, col_offset=4, end_lineno=614, end_col_offset=16)], returns=Name(id='HybridSearchResult', ctx=Load(), lineno=599, col_offset=5, end_lineno=599, end_col_offset=23), lineno=594, col_offset=0, end_lineno=614, end_col_offset=16), FunctionDef(name='_maybe_schedule_xtr_wide', args=arguments(kwonlyargs=[arg(arg='context', annotation=Name(id='ApplicationContext', ctx=Load(), lineno=619, col_offset=13, end_lineno=619, end_col_offset=31), lineno=619, col_offset=4, end_lineno=619, end_col_offset=31), arg(arg='query', annotation=Name(id='str', ctx=Load(), lineno=620, col_offset=11, end_lineno=620, end_col_offset=14), lineno=620, col_offset=4, end_lineno=620, end_col_offset=14), arg(arg='limit', annotation=Name(id='int', ctx=Load(), lineno=621, col_offset=11, end_lineno=621, end_col_offset=14), lineno=621, col_offset=4, end_lineno=621, end_col_offset=14), arg(arg='options', annotation=Name(id='SemanticProRuntimeOptions', ctx=Load(), lineno=622, col_offset=13, end_lineno=622, end_col_offset=38), lineno=622, col_offset=4, end_lineno=622, end_col_offset=38)], kw_defaults=[None, None, None, None]), body=[Assign(targets=[Name(id='cfg', ctx=Store(), lineno=624, col_offset=4, end_lineno=624, end_col_offset=7)], value=Attribute(value=Attribute(value=Name(id='context', ctx=Load(), lineno=624, col_offset=10, end_lineno=624, end_col_offset=17), attr='settings', ctx=Load(), lineno=624, col_offset=10, end_lineno=624, end_col_offset=26), attr='xtr', ctx=Load(), lineno=624, col_offset=10, end_lineno=624, end_col_offset=30), lineno=624, col_offset=4, end_lineno=624, end_col_offset=30), If(test=UnaryOp(op=Not(), operand=BoolOp(op=And(), values=[Attribute(value=Name(id='options', ctx=Load(), lineno=625, col_offset=12, end_lineno=625, end_col_offset=19), attr='use_warp', ctx=Load(), lineno=625, col_offset=12, end_lineno=625, end_col_offset=28), Attribute(value=Name(id='cfg', ctx=Load(), lineno=625, col_offset=33, end_lineno=625, end_col_offset=36), attr='enable', ctx=Load(), lineno=625, col_offset=33, end_lineno=625, end_col_offset=43), Compare(left=Call(func=Name(id='getattr', ctx=Load(), lineno=625, col_offset=48, end_lineno=625, end_col_offset=55), args=[Name(id='cfg', ctx=Load(), lineno=625, col_offset=56, end_lineno=625, end_col_offset=59), Constant(value='mode', lineno=625, col_offset=61, end_lineno=625, end_col_offset=67), Constant(value='narrow', lineno=625, col_offset=69, end_lineno=625, end_col_offset=77)], lineno=625, col_offset=48, end_lineno=625, end_col_offset=78), ops=[Eq()], comparators=[Constant(value='wide', lineno=625, col_offset=82, end_lineno=625, end_col_offset=88)], lineno=625, col_offset=48, end_lineno=625, end_col_offset=88)], lineno=625, col_offset=12, end_lineno=625, end_col_offset=88), lineno=625, col_offset=7, end_lineno=625, end_col_offset=89), body=[Return(value=Constant(value=None, lineno=626, col_offset=15, end_lineno=626, end_col_offset=19), lineno=626, col_offset=8, end_lineno=626, end_col_offset=19)], lineno=625, col_offset=4, end_lineno=626, end_col_offset=19), Assign(targets=[Name(id='index', ctx=Store(), lineno=627, col_offset=4, end_lineno=627, end_col_offset=9)], value=Call(func=Attribute(value=Name(id='context', ctx=Load(), lineno=627, col_offset=12, end_lineno=627, end_col_offset=19), attr='get_xtr_index', ctx=Load(), lineno=627, col_offset=12, end_lineno=627, end_col_offset=33), lineno=627, col_offset=12, end_lineno=627, end_col_offset=35), lineno=627, col_offset=4, end_lineno=627, end_col_offset=35), If(test=BoolOp(op=Or(), values=[Compare(left=Name(id='index', ctx=Load(), lineno=628, col_offset=7, end_lineno=628, end_col_offset=12), ops=[Is()], comparators=[Constant(value=None, lineno=628, col_offset=16, end_lineno=628, end_col_offset=20)], lineno=628, col_offset=7, end_lineno=628, end_col_offset=20), UnaryOp(op=Not(), operand=Attribute(value=Name(id='index', ctx=Load(), lineno=628, col_offset=28, end_lineno=628, end_col_offset=33), attr='ready', ctx=Load(), lineno=628, col_offset=28, end_lineno=628, end_col_offset=39), lineno=628, col_offset=24, end_lineno=628, end_col_offset=39)], lineno=628, col_offset=7, end_lineno=628, end_col_offset=39), body=[Return(value=Constant(value=None, lineno=629, col_offset=15, end_lineno=629, end_col_offset=19), lineno=629, col_offset=8, end_lineno=629, end_col_offset=19)], lineno=628, col_offset=4, end_lineno=629, end_col_offset=19), Assign(targets=[Name(id='k', ctx=Store(), lineno=630, col_offset=4, end_lineno=630, end_col_offset=5)], value=Call(func=Name(id='_calculate_xtr_k', ctx=Load(), lineno=630, col_offset=8, end_lineno=630, end_col_offset=24), args=[Name(id='limit', ctx=Load(), lineno=630, col_offset=25, end_lineno=630, end_col_offset=30), Name(id='cfg', ctx=Load(), lineno=630, col_offset=32, end_lineno=630, end_col_offset=35), Name(id='options', ctx=Load(), lineno=630, col_offset=37, end_lineno=630, end_col_offset=44)], lineno=630, col_offset=8, end_lineno=630, end_col_offset=45), lineno=630, col_offset=4, end_lineno=630, end_col_offset=45), Assign(targets=[Name(id='executor', ctx=Store(), lineno=631, col_offset=4, end_lineno=631, end_col_offset=12)], value=Call(func=Name(id='ThreadPoolExecutor', ctx=Load(), lineno=631, col_offset=15, end_lineno=631, end_col_offset=33), keywords=[keyword(arg='max_workers', value=Constant(value=1, lineno=631, col_offset=46, end_lineno=631, end_col_offset=47), lineno=631, col_offset=34, end_lineno=631, end_col_offset=47)], lineno=631, col_offset=15, end_lineno=631, end_col_offset=48), lineno=631, col_offset=4, end_lineno=631, end_col_offset=48), Assign(targets=[Name(id='future', ctx=Store(), lineno=632, col_offset=4, end_lineno=632, end_col_offset=10)], value=Call(func=Attribute(value=Name(id='executor', ctx=Load(), lineno=632, col_offset=13, end_lineno=632, end_col_offset=21), attr='submit', ctx=Load(), lineno=632, col_offset=13, end_lineno=632, end_col_offset=28), args=[Name(id='_run_xtr_wide_stage', ctx=Load(), lineno=633, col_offset=8, end_lineno=633, end_col_offset=27), Name(id='index', ctx=Load(), lineno=634, col_offset=8, end_lineno=634, end_col_offset=13), Name(id='query', ctx=Load(), lineno=635, col_offset=8, end_lineno=635, end_col_offset=13), Name(id='k', ctx=Load(), lineno=636, col_offset=8, end_lineno=636, end_col_offset=9)], keywords=[keyword(arg='explain', value=Attribute(value=Name(id='options', ctx=Load(), lineno=637, col_offset=16, end_lineno=637, end_col_offset=23), attr='explain', ctx=Load(), lineno=637, col_offset=16, end_lineno=637, end_col_offset=31), lineno=637, col_offset=8, end_lineno=637, end_col_offset=31), keyword(arg='budget_ms', value=Attribute(value=Attribute(value=Attribute(value=Name(id='context', ctx=Load(), lineno=638, col_offset=18, end_lineno=638, end_col_offset=25), attr='settings', ctx=Load(), lineno=638, col_offset=18, end_lineno=638, end_col_offset=34), attr='warp', ctx=Load(), lineno=638, col_offset=18, end_lineno=638, end_col_offset=39), attr='budget_ms', ctx=Load(), lineno=638, col_offset=18, end_lineno=638, end_col_offset=49), lineno=638, col_offset=8, end_lineno=638, end_col_offset=49)], lineno=632, col_offset=13, end_lineno=639, end_col_offset=5), lineno=632, col_offset=4, end_lineno=639, end_col_offset=5), Return(value=Tuple(elts=[Name(id='future', ctx=Load(), lineno=640, col_offset=11, end_lineno=640, end_col_offset=17), Name(id='executor', ctx=Load(), lineno=640, col_offset=19, end_lineno=640, end_col_offset=27)], ctx=Load(), lineno=640, col_offset=11, end_lineno=640, end_col_offset=27), lineno=640, col_offset=4, end_lineno=640, end_col_offset=27)], returns=BinOp(left=Name(id='WideSearchHandle', ctx=Load(), lineno=623, col_offset=5, end_lineno=623, end_col_offset=21), op=BitOr(), right=Constant(value=None, lineno=623, col_offset=24, end_lineno=623, end_col_offset=28), lineno=623, col_offset=5, end_lineno=623, end_col_offset=28), lineno=617, col_offset=0, end_lineno=640, end_col_offset=27), FunctionDef(name='_resolve_stage_one_outcome', args=arguments(args=[arg(arg='plan', annotation=Name(id='StageOnePlan', ctx=Load(), lineno=643, col_offset=37, end_lineno=643, end_col_offset=49), lineno=643, col_offset=31, end_lineno=643, end_col_offset=49)]), body=[Expr(value=Constant(value='Resolve Stage-1 orchestration outcome from a StageOnePlan.\n\n    Returns\n    -------\n    WarpOutcome\n        Outcome describing hits, notes, timing, explainability, and channel.\n    ', lineno=644, col_offset=4, end_lineno=650, end_col_offset=7), lineno=644, col_offset=4, end_lineno=650, end_col_offset=7), Assign(targets=[Name(id='context', ctx=Store(), lineno=651, col_offset=4, end_lineno=651, end_col_offset=11)], value=Attribute(value=Name(id='plan', ctx=Load(), lineno=651, col_offset=14, end_lineno=651, end_col_offset=18), attr='context', ctx=Load(), lineno=651, col_offset=14, end_lineno=651, end_col_offset=26), lineno=651, col_offset=4, end_lineno=651, end_col_offset=26), Assign(targets=[Name(id='query', ctx=Store(), lineno=652, col_offset=4, end_lineno=652, end_col_offset=9)], value=Attribute(value=Name(id='plan', ctx=Load(), lineno=652, col_offset=12, end_lineno=652, end_col_offset=16), attr='query', ctx=Load(), lineno=652, col_offset=12, end_lineno=652, end_col_offset=22), lineno=652, col_offset=4, end_lineno=652, end_col_offset=22), Assign(targets=[Name(id='candidates', ctx=Store(), lineno=653, col_offset=4, end_lineno=653, end_col_offset=14)], value=Call(func=Name(id='list', ctx=Load(), lineno=653, col_offset=17, end_lineno=653, end_col_offset=21), args=[Attribute(value=Name(id='plan', ctx=Load(), lineno=653, col_offset=22, end_lineno=653, end_col_offset=26), attr='candidates', ctx=Load(), lineno=653, col_offset=22, end_lineno=653, end_col_offset=37)], lineno=653, col_offset=17, end_lineno=653, end_col_offset=38), lineno=653, col_offset=4, end_lineno=653, end_col_offset=38), Assign(targets=[Name(id='options', ctx=Store(), lineno=654, col_offset=4, end_lineno=654, end_col_offset=11)], value=Attribute(value=Name(id='plan', ctx=Load(), lineno=654, col_offset=14, end_lineno=654, end_col_offset=18), attr='options', ctx=Load(), lineno=654, col_offset=14, end_lineno=654, end_col_offset=26), lineno=654, col_offset=4, end_lineno=654, end_col_offset=26), Assign(targets=[Name(id='coderank_stage', ctx=Store(), lineno=655, col_offset=4, end_lineno=655, end_col_offset=18)], value=Attribute(value=Name(id='plan', ctx=Load(), lineno=655, col_offset=21, end_lineno=655, end_col_offset=25), attr='coderank_stage', ctx=Load(), lineno=655, col_offset=21, end_lineno=655, end_col_offset=40), lineno=655, col_offset=4, end_lineno=655, end_col_offset=40), Assign(targets=[Name(id='wide_handle', ctx=Store(), lineno=656, col_offset=4, end_lineno=656, end_col_offset=15)], value=Attribute(value=Name(id='plan', ctx=Load(), lineno=656, col_offset=18, end_lineno=656, end_col_offset=22), attr='wide_handle', ctx=Load(), lineno=656, col_offset=18, end_lineno=656, end_col_offset=34), lineno=656, col_offset=4, end_lineno=656, end_col_offset=34), Assign(targets=[Name(id='query', ctx=Store(), lineno=657, col_offset=4, end_lineno=657, end_col_offset=9)], value=Attribute(value=Name(id='plan', ctx=Load(), lineno=657, col_offset=12, end_lineno=657, end_col_offset=16), attr='query', ctx=Load(), lineno=657, col_offset=12, end_lineno=657, end_col_offset=22), lineno=657, col_offset=4, end_lineno=657, end_col_offset=22), Assign(targets=[Tuple(elts=[Name(id='should_run', ctx=Store(), lineno=658, col_offset=4, end_lineno=658, end_col_offset=14), Name(id='base_notes', ctx=Store(), lineno=658, col_offset=16, end_lineno=658, end_col_offset=26)], ctx=Store(), lineno=658, col_offset=4, end_lineno=658, end_col_offset=26)], value=Call(func=Name(id='_should_execute_stage_two', ctx=Load(), lineno=658, col_offset=29, end_lineno=658, end_col_offset=54), keywords=[keyword(arg='context', value=Name(id='context', ctx=Load(), lineno=659, col_offset=16, end_lineno=659, end_col_offset=23), lineno=659, col_offset=8, end_lineno=659, end_col_offset=23), keyword(arg='candidates', value=Name(id='candidates', ctx=Load(), lineno=660, col_offset=19, end_lineno=660, end_col_offset=29), lineno=660, col_offset=8, end_lineno=660, end_col_offset=29), keyword(arg='options', value=Name(id='options', ctx=Load(), lineno=661, col_offset=16, end_lineno=661, end_col_offset=23), lineno=661, col_offset=8, end_lineno=661, end_col_offset=23), keyword(arg='coderank_stage', value=Name(id='coderank_stage', ctx=Load(), lineno=662, col_offset=23, end_lineno=662, end_col_offset=37), lineno=662, col_offset=8, end_lineno=662, end_col_offset=37)], lineno=658, col_offset=29, end_lineno=663, end_col_offset=5), lineno=658, col_offset=4, end_lineno=663, end_col_offset=5), If(test=UnaryOp(op=Not(), operand=Name(id='should_run', ctx=Load(), lineno=664, col_offset=11, end_lineno=664, end_col_offset=21), lineno=664, col_offset=7, end_lineno=664, end_col_offset=21), body=[If(test=Compare(left=Name(id='wide_handle', ctx=Load(), lineno=665, col_offset=11, end_lineno=665, end_col_offset=22), ops=[IsNot()], comparators=[Constant(value=None, lineno=665, col_offset=30, end_lineno=665, end_col_offset=34)], lineno=665, col_offset=11, end_lineno=665, end_col_offset=34), body=[Assign(targets=[Tuple(elts=[Name(id='_', ctx=Store(), lineno=666, col_offset=12, end_lineno=666, end_col_offset=13), Name(id='executor', ctx=Store(), lineno=666, col_offset=15, end_lineno=666, end_col_offset=23)], ctx=Store(), lineno=666, col_offset=12, end_lineno=666, end_col_offset=23)], value=Name(id='wide_handle', ctx=Load(), lineno=666, col_offset=26, end_lineno=666, end_col_offset=37), lineno=666, col_offset=12, end_lineno=666, end_col_offset=37), Expr(value=Call(func=Attribute(value=Name(id='executor', ctx=Load(), lineno=667, col_offset=12, end_lineno=667, end_col_offset=20), attr='shutdown', ctx=Load(), lineno=667, col_offset=12, end_lineno=667, end_col_offset=29), keywords=[keyword(arg='wait', value=Constant(value=False, lineno=667, col_offset=35, end_lineno=667, end_col_offset=40), lineno=667, col_offset=30, end_lineno=667, end_col_offset=40)], lineno=667, col_offset=12, end_lineno=667, end_col_offset=41), lineno=667, col_offset=12, end_lineno=667, end_col_offset=41)], lineno=665, col_offset=8, end_lineno=667, end_col_offset=41), Return(value=Call(func=Name(id='WarpOutcome', ctx=Load(), lineno=668, col_offset=15, end_lineno=668, end_col_offset=26), keywords=[keyword(arg='hits', value=List(ctx=Load(), lineno=668, col_offset=32, end_lineno=668, end_col_offset=34), lineno=668, col_offset=27, end_lineno=668, end_col_offset=34), keyword(arg='notes', value=Name(id='base_notes', ctx=Load(), lineno=668, col_offset=42, end_lineno=668, end_col_offset=52), lineno=668, col_offset=36, end_lineno=668, end_col_offset=52), keyword(arg='timing', value=Constant(value=None, lineno=668, col_offset=61, end_lineno=668, end_col_offset=65), lineno=668, col_offset=54, end_lineno=668, end_col_offset=65), keyword(arg='explainability', value=Tuple(ctx=Load(), lineno=668, col_offset=82, end_lineno=668, end_col_offset=84), lineno=668, col_offset=67, end_lineno=668, end_col_offset=84)], lineno=668, col_offset=15, end_lineno=668, end_col_offset=85), lineno=668, col_offset=8, end_lineno=668, end_col_offset=85)], lineno=664, col_offset=4, end_lineno=668, end_col_offset=85), If(test=Compare(left=Name(id='wide_handle', ctx=Load(), lineno=670, col_offset=7, end_lineno=670, end_col_offset=18), ops=[IsNot()], comparators=[Constant(value=None, lineno=670, col_offset=26, end_lineno=670, end_col_offset=30)], lineno=670, col_offset=7, end_lineno=670, end_col_offset=30), body=[Assign(targets=[Tuple(elts=[Name(id='wide_future', ctx=Store(), lineno=671, col_offset=8, end_lineno=671, end_col_offset=19), Name(id='wide_executor', ctx=Store(), lineno=671, col_offset=21, end_lineno=671, end_col_offset=34)], ctx=Store(), lineno=671, col_offset=8, end_lineno=671, end_col_offset=34)], value=Name(id='wide_handle', ctx=Load(), lineno=671, col_offset=37, end_lineno=671, end_col_offset=48), lineno=671, col_offset=8, end_lineno=671, end_col_offset=48), Try(body=[Assign(targets=[Name(id='outcome', ctx=Store(), lineno=673, col_offset=12, end_lineno=673, end_col_offset=19)], value=Call(func=Attribute(value=Name(id='wide_future', ctx=Load(), lineno=673, col_offset=22, end_lineno=673, end_col_offset=33), attr='result', ctx=Load(), lineno=673, col_offset=22, end_lineno=673, end_col_offset=40), lineno=673, col_offset=22, end_lineno=673, end_col_offset=42), lineno=673, col_offset=12, end_lineno=673, end_col_offset=42)], handlers=[ExceptHandler(type=Tuple(elts=[Name(id='RuntimeError', ctx=Load(), lineno=674, col_offset=16, end_lineno=674, end_col_offset=28), Name(id='ValueError', ctx=Load(), lineno=674, col_offset=30, end_lineno=674, end_col_offset=40), Name(id='OSError', ctx=Load(), lineno=674, col_offset=42, end_lineno=674, end_col_offset=49)], ctx=Load(), lineno=674, col_offset=15, end_lineno=674, end_col_offset=50), name='exc', body=[Expr(value=Call(func=Attribute(value=Name(id='LOGGER', ctx=Load(), lineno=675, col_offset=12, end_lineno=675, end_col_offset=18), attr='warning', ctx=Load(), lineno=675, col_offset=12, end_lineno=675, end_col_offset=26), args=[Constant(value='XTR wide search failed; falling back to narrow mode.', lineno=676, col_offset=16, end_lineno=676, end_col_offset=70)], keywords=[keyword(arg='extra', value=Dict(keys=[Constant(value='error', lineno=677, col_offset=23, end_lineno=677, end_col_offset=30)], values=[Call(func=Name(id='str', ctx=Load(), lineno=677, col_offset=32, end_lineno=677, end_col_offset=35), args=[Name(id='exc', ctx=Load(), lineno=677, col_offset=36, end_lineno=677, end_col_offset=39)], lineno=677, col_offset=32, end_lineno=677, end_col_offset=40)], lineno=677, col_offset=22, end_lineno=677, end_col_offset=41), lineno=677, col_offset=16, end_lineno=677, end_col_offset=41)], lineno=675, col_offset=12, end_lineno=678, end_col_offset=13), lineno=675, col_offset=12, end_lineno=678, end_col_offset=13)], lineno=674, col_offset=8, end_lineno=678, end_col_offset=13)], orelse=[Expr(value=Call(func=Attribute(value=Attribute(value=Name(id='outcome', ctx=Load(), lineno=680, col_offset=12, end_lineno=680, end_col_offset=19), attr='notes', ctx=Load(), lineno=680, col_offset=12, end_lineno=680, end_col_offset=25), attr='extend', ctx=Load(), lineno=680, col_offset=12, end_lineno=680, end_col_offset=32), args=[Name(id='base_notes', ctx=Load(), lineno=680, col_offset=33, end_lineno=680, end_col_offset=43)], lineno=680, col_offset=12, end_lineno=680, end_col_offset=44), lineno=680, col_offset=12, end_lineno=680, end_col_offset=44), Return(value=Name(id='outcome', ctx=Load(), lineno=681, col_offset=19, end_lineno=681, end_col_offset=26), lineno=681, col_offset=12, end_lineno=681, end_col_offset=26)], finalbody=[If(test=Compare(left=Name(id='wide_executor', ctx=Load(), lineno=683, col_offset=15, end_lineno=683, end_col_offset=28), ops=[IsNot()], comparators=[Constant(value=None, lineno=683, col_offset=36, end_lineno=683, end_col_offset=40)], lineno=683, col_offset=15, end_lineno=683, end_col_offset=40), body=[Expr(value=Call(func=Attribute(value=Name(id='wide_executor', ctx=Load(), lineno=684, col_offset=16, end_lineno=684, end_col_offset=29), attr='shutdown', ctx=Load(), lineno=684, col_offset=16, end_lineno=684, end_col_offset=38), keywords=[keyword(arg='wait', value=Constant(value=False, lineno=684, col_offset=44, end_lineno=684, end_col_offset=49), lineno=684, col_offset=39, end_lineno=684, end_col_offset=49)], lineno=684, col_offset=16, end_lineno=684, end_col_offset=50), lineno=684, col_offset=16, end_lineno=684, end_col_offset=50)], lineno=683, col_offset=12, end_lineno=684, end_col_offset=50)], lineno=672, col_offset=8, end_lineno=684, end_col_offset=50)], lineno=670, col_offset=4, end_lineno=684, end_col_offset=50), Return(value=Call(func=Name(id='_execute_stage_two', ctx=Load(), lineno=685, col_offset=11, end_lineno=685, end_col_offset=29), keywords=[keyword(arg='context', value=Name(id='context', ctx=Load(), lineno=686, col_offset=16, end_lineno=686, end_col_offset=23), lineno=686, col_offset=8, end_lineno=686, end_col_offset=23), keyword(arg='query', value=Name(id='query', ctx=Load(), lineno=687, col_offset=14, end_lineno=687, end_col_offset=19), lineno=687, col_offset=8, end_lineno=687, end_col_offset=19), keyword(arg='candidates', value=Name(id='candidates', ctx=Load(), lineno=688, col_offset=19, end_lineno=688, end_col_offset=29), lineno=688, col_offset=8, end_lineno=688, end_col_offset=29), keyword(arg='options', value=Name(id='options', ctx=Load(), lineno=689, col_offset=16, end_lineno=689, end_col_offset=23), lineno=689, col_offset=8, end_lineno=689, end_col_offset=23), keyword(arg='base_notes', value=Name(id='base_notes', ctx=Load(), lineno=690, col_offset=19, end_lineno=690, end_col_offset=29), lineno=690, col_offset=8, end_lineno=690, end_col_offset=29)], lineno=685, col_offset=11, end_lineno=691, end_col_offset=5), lineno=685, col_offset=4, end_lineno=691, end_col_offset=5)], returns=Name(id='WarpOutcome', ctx=Load(), lineno=643, col_offset=54, end_lineno=643, end_col_offset=65), lineno=643, col_offset=0, end_lineno=691, end_col_offset=5), FunctionDef(name='_run_xtr_wide_stage', args=arguments(args=[arg(arg='index', annotation=Name(id='XTRIndex', ctx=Load(), lineno=695, col_offset=11, end_lineno=695, end_col_offset=19), lineno=695, col_offset=4, end_lineno=695, end_col_offset=19), arg(arg='query', annotation=Name(id='str', ctx=Load(), lineno=696, col_offset=11, end_lineno=696, end_col_offset=14), lineno=696, col_offset=4, end_lineno=696, end_col_offset=14), arg(arg='k', annotation=Name(id='int', ctx=Load(), lineno=697, col_offset=7, end_lineno=697, end_col_offset=10), lineno=697, col_offset=4, end_lineno=697, end_col_offset=10)], kwonlyargs=[arg(arg='explain', annotation=Name(id='bool', ctx=Load(), lineno=699, col_offset=13, end_lineno=699, end_col_offset=17), lineno=699, col_offset=4, end_lineno=699, end_col_offset=17), arg(arg='budget_ms', annotation=BinOp(left=Name(id='int', ctx=Load(), lineno=700, col_offset=15, end_lineno=700, end_col_offset=18), op=BitOr(), right=Constant(value=None, lineno=700, col_offset=21, end_lineno=700, end_col_offset=25), lineno=700, col_offset=15, end_lineno=700, end_col_offset=25), lineno=700, col_offset=4, end_lineno=700, end_col_offset=25)], kw_defaults=[None, None]), body=[AnnAssign(target=Name(id='notes', ctx=Store(), lineno=702, col_offset=4, end_lineno=702, end_col_offset=9), annotation=Subscript(value=Name(id='list', ctx=Load(), lineno=702, col_offset=11, end_lineno=702, end_col_offset=15), slice=Name(id='str', ctx=Load(), lineno=702, col_offset=16, end_lineno=702, end_col_offset=19), ctx=Load(), lineno=702, col_offset=11, end_lineno=702, end_col_offset=20), value=List(ctx=Load(), lineno=702, col_offset=23, end_lineno=702, end_col_offset=25), simple=1, lineno=702, col_offset=4, end_lineno=702, end_col_offset=25), With(items=[withitem(context_expr=Call(func=Name(id='track_stage', ctx=Load(), lineno=703, col_offset=9, end_lineno=703, end_col_offset=20), args=[Constant(value='xtr_wide_search', lineno=704, col_offset=8, end_lineno=704, end_col_offset=25)], keywords=[keyword(arg='budget_ms', value=Name(id='budget_ms', ctx=Load(), lineno=705, col_offset=18, end_lineno=705, end_col_offset=27), lineno=705, col_offset=8, end_lineno=705, end_col_offset=27)], lineno=703, col_offset=9, end_lineno=706, end_col_offset=5), optional_vars=Name(id='timer', ctx=Store(), lineno=706, col_offset=9, end_lineno=706, end_col_offset=14))], body=[Assign(targets=[Name(id='hits', ctx=Store(), lineno=707, col_offset=8, end_lineno=707, end_col_offset=12)], value=Call(func=Attribute(value=Name(id='index', ctx=Load(), lineno=707, col_offset=15, end_lineno=707, end_col_offset=20), attr='search', ctx=Load(), lineno=707, col_offset=15, end_lineno=707, end_col_offset=27), keywords=[keyword(arg='query', value=Name(id='query', ctx=Load(), lineno=707, col_offset=34, end_lineno=707, end_col_offset=39), lineno=707, col_offset=28, end_lineno=707, end_col_offset=39), keyword(arg='k', value=Name(id='k', ctx=Load(), lineno=707, col_offset=43, end_lineno=707, end_col_offset=44), lineno=707, col_offset=41, end_lineno=707, end_col_offset=44), keyword(arg='explain', value=Name(id='explain', ctx=Load(), lineno=707, col_offset=54, end_lineno=707, end_col_offset=61), lineno=707, col_offset=46, end_lineno=707, end_col_offset=61)], lineno=707, col_offset=15, end_lineno=707, end_col_offset=62), lineno=707, col_offset=8, end_lineno=707, end_col_offset=62)], lineno=703, col_offset=4, end_lineno=707, end_col_offset=62), Assign(targets=[Name(id='explain_payload', ctx=Store(), lineno=708, col_offset=4, end_lineno=708, end_col_offset=19)], value=ListComp(elt=Tuple(elts=[Call(func=Name(id='int', ctx=Load(), lineno=708, col_offset=24, end_lineno=708, end_col_offset=27), args=[Name(id='cid', ctx=Load(), lineno=708, col_offset=28, end_lineno=708, end_col_offset=31)], lineno=708, col_offset=24, end_lineno=708, end_col_offset=32), Name(id='payload', ctx=Load(), lineno=708, col_offset=34, end_lineno=708, end_col_offset=41)], ctx=Load(), lineno=708, col_offset=23, end_lineno=708, end_col_offset=42), generators=[comprehension(target=Tuple(elts=[Name(id='cid', ctx=Store(), lineno=708, col_offset=47, end_lineno=708, end_col_offset=50), Name(id='_score', ctx=Store(), lineno=708, col_offset=52, end_lineno=708, end_col_offset=58), Name(id='payload', ctx=Store(), lineno=708, col_offset=60, end_lineno=708, end_col_offset=67)], ctx=Store(), lineno=708, col_offset=47, end_lineno=708, end_col_offset=67), iter=Name(id='hits', ctx=Load(), lineno=708, col_offset=71, end_lineno=708, end_col_offset=75), ifs=[Name(id='payload', ctx=Load(), lineno=708, col_offset=79, end_lineno=708, end_col_offset=86)], is_async=0)], lineno=708, col_offset=22, end_lineno=708, end_col_offset=87), lineno=708, col_offset=4, end_lineno=708, end_col_offset=87), Assign(targets=[Name(id='scored', ctx=Store(), lineno=709, col_offset=4, end_lineno=709, end_col_offset=10)], value=ListComp(elt=Tuple(elts=[Call(func=Name(id='int', ctx=Load(), lineno=709, col_offset=15, end_lineno=709, end_col_offset=18), args=[Name(id='cid', ctx=Load(), lineno=709, col_offset=19, end_lineno=709, end_col_offset=22)], lineno=709, col_offset=15, end_lineno=709, end_col_offset=23), Call(func=Name(id='float', ctx=Load(), lineno=709, col_offset=25, end_lineno=709, end_col_offset=30), args=[Name(id='score', ctx=Load(), lineno=709, col_offset=31, end_lineno=709, end_col_offset=36)], lineno=709, col_offset=25, end_lineno=709, end_col_offset=37)], ctx=Load(), lineno=709, col_offset=14, end_lineno=709, end_col_offset=38), generators=[comprehension(target=Tuple(elts=[Name(id='cid', ctx=Store(), lineno=709, col_offset=43, end_lineno=709, end_col_offset=46), Name(id='score', ctx=Store(), lineno=709, col_offset=48, end_lineno=709, end_col_offset=53), Name(id='_payload', ctx=Store(), lineno=709, col_offset=55, end_lineno=709, end_col_offset=63)], ctx=Store(), lineno=709, col_offset=43, end_lineno=709, end_col_offset=63), iter=Name(id='hits', ctx=Load(), lineno=709, col_offset=67, end_lineno=709, end_col_offset=71), is_async=0)], lineno=709, col_offset=13, end_lineno=709, end_col_offset=72), lineno=709, col_offset=4, end_lineno=709, end_col_offset=72), Expr(value=Call(func=Attribute(value=Name(id='notes', ctx=Load(), lineno=710, col_offset=4, end_lineno=710, end_col_offset=9), attr='append', ctx=Load(), lineno=710, col_offset=4, end_lineno=710, end_col_offset=16), args=[JoinedStr(values=[Constant(value='XTR wide search returned ', lineno=710, col_offset=19, end_lineno=710, end_col_offset=44), FormattedValue(value=Call(func=Name(id='len', ctx=Load(), lineno=710, col_offset=45, end_lineno=710, end_col_offset=48), args=[Name(id='scored', ctx=Load(), lineno=710, col_offset=49, end_lineno=710, end_col_offset=55)], lineno=710, col_offset=45, end_lineno=710, end_col_offset=56), conversion=-1, lineno=710, col_offset=44, end_lineno=710, end_col_offset=57), Constant(value=' hits (k=', lineno=710, col_offset=57, end_lineno=710, end_col_offset=66), FormattedValue(value=Name(id='k', ctx=Load(), lineno=710, col_offset=67, end_lineno=710, end_col_offset=68), conversion=-1, lineno=710, col_offset=66, end_lineno=710, end_col_offset=69), Constant(value=').', lineno=710, col_offset=69, end_lineno=710, end_col_offset=71)], lineno=710, col_offset=17, end_lineno=710, end_col_offset=72)], lineno=710, col_offset=4, end_lineno=710, end_col_offset=73), lineno=710, col_offset=4, end_lineno=710, end_col_offset=73), Assign(targets=[Name(id='outcome', ctx=Store(), lineno=711, col_offset=4, end_lineno=711, end_col_offset=11)], value=Call(func=Name(id='WarpOutcome', ctx=Load(), lineno=711, col_offset=14, end_lineno=711, end_col_offset=25), keywords=[keyword(arg='hits', value=Name(id='scored', ctx=Load(), lineno=712, col_offset=13, end_lineno=712, end_col_offset=19), lineno=712, col_offset=8, end_lineno=712, end_col_offset=19), keyword(arg='notes', value=Name(id='notes', ctx=Load(), lineno=713, col_offset=14, end_lineno=713, end_col_offset=19), lineno=713, col_offset=8, end_lineno=713, end_col_offset=19), keyword(arg='timing', value=Call(func=Attribute(value=Name(id='timer', ctx=Load(), lineno=714, col_offset=15, end_lineno=714, end_col_offset=20), attr='snapshot', ctx=Load(), lineno=714, col_offset=15, end_lineno=714, end_col_offset=29), lineno=714, col_offset=15, end_lineno=714, end_col_offset=31), lineno=714, col_offset=8, end_lineno=714, end_col_offset=31), keyword(arg='explainability', value=Call(func=Name(id='tuple', ctx=Load(), lineno=715, col_offset=23, end_lineno=715, end_col_offset=28), args=[Name(id='explain_payload', ctx=Load(), lineno=715, col_offset=29, end_lineno=715, end_col_offset=44)], lineno=715, col_offset=23, end_lineno=715, end_col_offset=45), lineno=715, col_offset=8, end_lineno=715, end_col_offset=45), keyword(arg='channel', value=Constant(value='xtr', lineno=716, col_offset=16, end_lineno=716, end_col_offset=21), lineno=716, col_offset=8, end_lineno=716, end_col_offset=21)], lineno=711, col_offset=14, end_lineno=717, end_col_offset=5), lineno=711, col_offset=4, end_lineno=717, end_col_offset=5), Expr(value=Call(func=Name(id='record_stage_decision', ctx=Load(), lineno=718, col_offset=4, end_lineno=718, end_col_offset=25), args=[Name(id='COMPONENT_NAME', ctx=Load(), lineno=719, col_offset=8, end_lineno=719, end_col_offset=22), Constant(value='xtr', lineno=720, col_offset=8, end_lineno=720, end_col_offset=13)], keywords=[keyword(arg='decision', value=Call(func=Name(id='StageDecision', ctx=Load(), lineno=721, col_offset=17, end_lineno=721, end_col_offset=30), keywords=[keyword(arg='should_run', value=Constant(value=True, lineno=721, col_offset=42, end_lineno=721, end_col_offset=46), lineno=721, col_offset=31, end_lineno=721, end_col_offset=46), keyword(arg='reason', value=Constant(value='executed', lineno=721, col_offset=55, end_lineno=721, end_col_offset=65), lineno=721, col_offset=48, end_lineno=721, end_col_offset=65)], lineno=721, col_offset=17, end_lineno=721, end_col_offset=66), lineno=721, col_offset=8, end_lineno=721, end_col_offset=66)], lineno=718, col_offset=4, end_lineno=722, end_col_offset=5), lineno=718, col_offset=4, end_lineno=722, end_col_offset=5), Return(value=Name(id='outcome', ctx=Load(), lineno=723, col_offset=11, end_lineno=723, end_col_offset=18), lineno=723, col_offset=4, end_lineno=723, end_col_offset=18)], returns=Name(id='WarpOutcome', ctx=Load(), lineno=701, col_offset=5, end_lineno=701, end_col_offset=16), lineno=694, col_offset=0, end_lineno=723, end_col_offset=18), FunctionDef(name='_calculate_xtr_k', args=arguments(args=[arg(arg='limit', annotation=Name(id='int', ctx=Load(), lineno=726, col_offset=28, end_lineno=726, end_col_offset=31), lineno=726, col_offset=21, end_lineno=726, end_col_offset=31), arg(arg='cfg', annotation=Name(id='XTRConfig', ctx=Load(), lineno=726, col_offset=38, end_lineno=726, end_col_offset=47), lineno=726, col_offset=33, end_lineno=726, end_col_offset=47), arg(arg='options', annotation=Name(id='SemanticProRuntimeOptions', ctx=Load(), lineno=726, col_offset=58, end_lineno=726, end_col_offset=83), lineno=726, col_offset=49, end_lineno=726, end_col_offset=83)]), body=[Assign(targets=[Name(id='candidate_limits', ctx=Store(), lineno=727, col_offset=4, end_lineno=727, end_col_offset=20)], value=List(elts=[Attribute(value=Name(id='cfg', ctx=Load(), lineno=727, col_offset=24, end_lineno=727, end_col_offset=27), attr='candidate_k', ctx=Load(), lineno=727, col_offset=24, end_lineno=727, end_col_offset=39), Name(id='limit', ctx=Load(), lineno=727, col_offset=41, end_lineno=727, end_col_offset=46)], ctx=Load(), lineno=727, col_offset=23, end_lineno=727, end_col_offset=47), lineno=727, col_offset=4, end_lineno=727, end_col_offset=47), If(test=BoolOp(op=And(), values=[Compare(left=Attribute(value=Name(id='options', ctx=Load(), lineno=728, col_offset=7, end_lineno=728, end_col_offset=14), attr='xtr_k', ctx=Load(), lineno=728, col_offset=7, end_lineno=728, end_col_offset=20), ops=[IsNot()], comparators=[Constant(value=None, lineno=728, col_offset=28, end_lineno=728, end_col_offset=32)], lineno=728, col_offset=7, end_lineno=728, end_col_offset=32), Compare(left=Attribute(value=Name(id='options', ctx=Load(), lineno=728, col_offset=37, end_lineno=728, end_col_offset=44), attr='xtr_k', ctx=Load(), lineno=728, col_offset=37, end_lineno=728, end_col_offset=50), ops=[Gt()], comparators=[Constant(value=0, lineno=728, col_offset=53, end_lineno=728, end_col_offset=54)], lineno=728, col_offset=37, end_lineno=728, end_col_offset=54)], lineno=728, col_offset=7, end_lineno=728, end_col_offset=54), body=[Expr(value=Call(func=Attribute(value=Name(id='candidate_limits', ctx=Load(), lineno=729, col_offset=8, end_lineno=729, end_col_offset=24), attr='append', ctx=Load(), lineno=729, col_offset=8, end_lineno=729, end_col_offset=31), args=[Attribute(value=Name(id='options', ctx=Load(), lineno=729, col_offset=32, end_lineno=729, end_col_offset=39), attr='xtr_k', ctx=Load(), lineno=729, col_offset=32, end_lineno=729, end_col_offset=45)], lineno=729, col_offset=8, end_lineno=729, end_col_offset=46), lineno=729, col_offset=8, end_lineno=729, end_col_offset=46)], lineno=728, col_offset=4, end_lineno=729, end_col_offset=46), Return(value=Call(func=Name(id='max', ctx=Load(), lineno=730, col_offset=11, end_lineno=730, end_col_offset=14), args=[Name(id='candidate_limits', ctx=Load(), lineno=730, col_offset=15, end_lineno=730, end_col_offset=31)], lineno=730, col_offset=11, end_lineno=730, end_col_offset=32), lineno=730, col_offset=4, end_lineno=730, end_col_offset=32)], returns=Name(id='int', ctx=Load(), lineno=726, col_offset=88, end_lineno=726, end_col_offset=91), lineno=726, col_offset=0, end_lineno=730, end_col_offset=32), FunctionDef(name='_build_extra_channels', args=arguments(args=[arg(arg='warp_hits', annotation=Subscript(value=Name(id='list', ctx=Load(), lineno=734, col_offset=15, end_lineno=734, end_col_offset=19), slice=Subscript(value=Name(id='tuple', ctx=Load(), lineno=734, col_offset=20, end_lineno=734, end_col_offset=25), slice=Tuple(elts=[Name(id='int', ctx=Load(), lineno=734, col_offset=26, end_lineno=734, end_col_offset=29), Name(id='float', ctx=Load(), lineno=734, col_offset=31, end_lineno=734, end_col_offset=36)], ctx=Load(), lineno=734, col_offset=26, end_lineno=734, end_col_offset=36), ctx=Load(), lineno=734, col_offset=20, end_lineno=734, end_col_offset=37), ctx=Load(), lineno=734, col_offset=15, end_lineno=734, end_col_offset=38), lineno=734, col_offset=4, end_lineno=734, end_col_offset=38), arg(arg='channel_name', annotation=Name(id='str', ctx=Load(), lineno=735, col_offset=18, end_lineno=735, end_col_offset=21), lineno=735, col_offset=4, end_lineno=735, end_col_offset=21)]), body=[If(test=UnaryOp(op=Not(), operand=Name(id='warp_hits', ctx=Load(), lineno=737, col_offset=11, end_lineno=737, end_col_offset=20), lineno=737, col_offset=7, end_lineno=737, end_col_offset=20), body=[Return(value=Constant(value=None, lineno=738, col_offset=15, end_lineno=738, end_col_offset=19), lineno=738, col_offset=8, end_lineno=738, end_col_offset=19)], lineno=737, col_offset=4, end_lineno=738, end_col_offset=19), Return(value=Dict(keys=[Name(id='channel_name', ctx=Load(), lineno=740, col_offset=8, end_lineno=740, end_col_offset=20)], values=[ListComp(elt=Call(func=Name(id='ChannelHit', ctx=Load(), lineno=741, col_offset=12, end_lineno=741, end_col_offset=22), keywords=[keyword(arg='doc_id', value=Call(func=Name(id='str', ctx=Load(), lineno=741, col_offset=30, end_lineno=741, end_col_offset=33), args=[Name(id='doc_id', ctx=Load(), lineno=741, col_offset=34, end_lineno=741, end_col_offset=40)], lineno=741, col_offset=30, end_lineno=741, end_col_offset=41), lineno=741, col_offset=23, end_lineno=741, end_col_offset=41), keyword(arg='score', value=Call(func=Name(id='float', ctx=Load(), lineno=741, col_offset=49, end_lineno=741, end_col_offset=54), args=[Name(id='score', ctx=Load(), lineno=741, col_offset=55, end_lineno=741, end_col_offset=60)], lineno=741, col_offset=49, end_lineno=741, end_col_offset=61), lineno=741, col_offset=43, end_lineno=741, end_col_offset=61)], lineno=741, col_offset=12, end_lineno=741, end_col_offset=62), generators=[comprehension(target=Tuple(elts=[Name(id='doc_id', ctx=Store(), lineno=741, col_offset=67, end_lineno=741, end_col_offset=73), Name(id='score', ctx=Store(), lineno=741, col_offset=75, end_lineno=741, end_col_offset=80)], ctx=Store(), lineno=741, col_offset=67, end_lineno=741, end_col_offset=80), iter=Name(id='warp_hits', ctx=Load(), lineno=741, col_offset=84, end_lineno=741, end_col_offset=93), is_async=0)], lineno=740, col_offset=22, end_lineno=742, end_col_offset=9)], lineno=739, col_offset=11, end_lineno=743, end_col_offset=5), lineno=739, col_offset=4, end_lineno=743, end_col_offset=5)], returns=BinOp(left=Subscript(value=Name(id='dict', ctx=Load(), lineno=736, col_offset=5, end_lineno=736, end_col_offset=9), slice=Tuple(elts=[Name(id='str', ctx=Load(), lineno=736, col_offset=10, end_lineno=736, end_col_offset=13), Subscript(value=Name(id='list', ctx=Load(), lineno=736, col_offset=15, end_lineno=736, end_col_offset=19), slice=Name(id='ChannelHit', ctx=Load(), lineno=736, col_offset=20, end_lineno=736, end_col_offset=30), ctx=Load(), lineno=736, col_offset=15, end_lineno=736, end_col_offset=31)], ctx=Load(), lineno=736, col_offset=10, end_lineno=736, end_col_offset=31), ctx=Load(), lineno=736, col_offset=5, end_lineno=736, end_col_offset=32), op=BitOr(), right=Constant(value=None, lineno=736, col_offset=35, end_lineno=736, end_col_offset=39), lineno=736, col_offset=5, end_lineno=736, end_col_offset=39), lineno=733, col_offset=0, end_lineno=743, end_col_offset=5), FunctionDef(name='_append_budget_notes', args=arguments(args=[arg(arg='component', annotation=Name(id='str', ctx=Load(), lineno=747, col_offset=15, end_lineno=747, end_col_offset=18), lineno=747, col_offset=4, end_lineno=747, end_col_offset=18), arg(arg='stage_timings', annotation=Subscript(value=Name(id='Sequence', ctx=Load(), lineno=748, col_offset=19, end_lineno=748, end_col_offset=27), slice=Name(id='StageTiming', ctx=Load(), lineno=748, col_offset=28, end_lineno=748, end_col_offset=39), ctx=Load(), lineno=748, col_offset=19, end_lineno=748, end_col_offset=40), lineno=748, col_offset=4, end_lineno=748, end_col_offset=40), arg(arg='limits', annotation=Subscript(value=Name(id='list', ctx=Load(), lineno=749, col_offset=12, end_lineno=749, end_col_offset=16), slice=Name(id='str', ctx=Load(), lineno=749, col_offset=17, end_lineno=749, end_col_offset=20), ctx=Load(), lineno=749, col_offset=12, end_lineno=749, end_col_offset=21), lineno=749, col_offset=4, end_lineno=749, end_col_offset=21)]), body=[For(target=Name(id='timing', ctx=Store(), lineno=751, col_offset=8, end_lineno=751, end_col_offset=14), iter=Name(id='stage_timings', ctx=Load(), lineno=751, col_offset=18, end_lineno=751, end_col_offset=31), body=[Expr(value=Call(func=Name(id='record_stage_metric', ctx=Load(), lineno=752, col_offset=8, end_lineno=752, end_col_offset=27), args=[Name(id='component', ctx=Load(), lineno=752, col_offset=28, end_lineno=752, end_col_offset=37), Name(id='timing', ctx=Load(), lineno=752, col_offset=39, end_lineno=752, end_col_offset=45)], lineno=752, col_offset=8, end_lineno=752, end_col_offset=46), lineno=752, col_offset=8, end_lineno=752, end_col_offset=46), If(test=Compare(left=Attribute(value=Name(id='timing', ctx=Load(), lineno=753, col_offset=11, end_lineno=753, end_col_offset=17), attr='budget_ms', ctx=Load(), lineno=753, col_offset=11, end_lineno=753, end_col_offset=27), ops=[Is()], comparators=[Constant(value=None, lineno=753, col_offset=31, end_lineno=753, end_col_offset=35)], lineno=753, col_offset=11, end_lineno=753, end_col_offset=35), body=[Continue(lineno=754, col_offset=12, end_lineno=754, end_col_offset=20)], lineno=753, col_offset=8, end_lineno=754, end_col_offset=20), If(test=Attribute(value=Name(id='timing', ctx=Load(), lineno=755, col_offset=11, end_lineno=755, end_col_offset=17), attr='exceeded_budget', ctx=Load(), lineno=755, col_offset=11, end_lineno=755, end_col_offset=33), body=[Expr(value=Call(func=Attribute(value=Name(id='limits', ctx=Load(), lineno=756, col_offset=12, end_lineno=756, end_col_offset=18), attr='append', ctx=Load(), lineno=756, col_offset=12, end_lineno=756, end_col_offset=25), args=[JoinedStr(values=[FormattedValue(value=Attribute(value=Name(id='timing', ctx=Load(), lineno=757, col_offset=19, end_lineno=757, end_col_offset=25), attr='name', ctx=Load(), lineno=757, col_offset=19, end_lineno=757, end_col_offset=30), conversion=-1, lineno=757, col_offset=18, end_lineno=757, end_col_offset=31), Constant(value=' exceeded budget (', lineno=757, col_offset=31, end_lineno=757, end_col_offset=49), FormattedValue(value=Attribute(value=Name(id='timing', ctx=Load(), lineno=757, col_offset=50, end_lineno=757, end_col_offset=56), attr='duration_ms', ctx=Load(), lineno=757, col_offset=50, end_lineno=757, end_col_offset=68), conversion=-1, format_spec=JoinedStr(values=[Constant(value='.1f', lineno=757, col_offset=69, end_lineno=757, end_col_offset=72)], lineno=757, col_offset=68, end_lineno=757, end_col_offset=72), lineno=757, col_offset=49, end_lineno=757, end_col_offset=73), Constant(value='ms > ', lineno=757, col_offset=73, end_lineno=757, end_col_offset=78), FormattedValue(value=Attribute(value=Name(id='timing', ctx=Load(), lineno=757, col_offset=79, end_lineno=757, end_col_offset=85), attr='budget_ms', ctx=Load(), lineno=757, col_offset=79, end_lineno=757, end_col_offset=95), conversion=-1, lineno=757, col_offset=78, end_lineno=757, end_col_offset=96), Constant(value='ms)', lineno=757, col_offset=96, end_lineno=757, end_col_offset=99)], lineno=757, col_offset=16, end_lineno=757, end_col_offset=100)], lineno=756, col_offset=12, end_lineno=758, end_col_offset=13), lineno=756, col_offset=12, end_lineno=758, end_col_offset=13)], lineno=755, col_offset=8, end_lineno=758, end_col_offset=13)], lineno=751, col_offset=4, end_lineno=758, end_col_offset=13)], returns=Constant(value=None, lineno=750, col_offset=5, end_lineno=750, end_col_offset=9), lineno=746, col_offset=0, end_lineno=758, end_col_offset=13), FunctionDef(name='_safe_int', args=arguments(args=[arg(arg='value', annotation=Name(id='str', ctx=Load(), lineno=761, col_offset=21, end_lineno=761, end_col_offset=24), lineno=761, col_offset=14, end_lineno=761, end_col_offset=24)]), body=[Try(body=[Return(value=Call(func=Name(id='int', ctx=Load(), lineno=763, col_offset=15, end_lineno=763, end_col_offset=18), args=[Name(id='value', ctx=Load(), lineno=763, col_offset=19, end_lineno=763, end_col_offset=24)], lineno=763, col_offset=15, end_lineno=763, end_col_offset=25), lineno=763, col_offset=8, end_lineno=763, end_col_offset=25)], handlers=[ExceptHandler(type=Tuple(elts=[Name(id='TypeError', ctx=Load(), lineno=764, col_offset=12, end_lineno=764, end_col_offset=21), Name(id='ValueError', ctx=Load(), lineno=764, col_offset=23, end_lineno=764, end_col_offset=33)], ctx=Load(), lineno=764, col_offset=11, end_lineno=764, end_col_offset=34), name='exc', body=[Assign(targets=[Name(id='msg', ctx=Store(), lineno=765, col_offset=8, end_lineno=765, end_col_offset=11)], value=JoinedStr(values=[Constant(value='Expected numeric chunk id, received ', lineno=765, col_offset=16, end_lineno=765, end_col_offset=52), FormattedValue(value=Name(id='value', ctx=Load(), lineno=765, col_offset=53, end_lineno=765, end_col_offset=58), conversion=114, lineno=765, col_offset=52, end_lineno=765, end_col_offset=61)], lineno=765, col_offset=14, end_lineno=765, end_col_offset=62), lineno=765, col_offset=8, end_lineno=765, end_col_offset=62), Raise(exc=Call(func=Name(id='VectorSearchError', ctx=Load(), lineno=766, col_offset=14, end_lineno=766, end_col_offset=31), args=[Name(id='msg', ctx=Load(), lineno=766, col_offset=32, end_lineno=766, end_col_offset=35)], lineno=766, col_offset=14, end_lineno=766, end_col_offset=36), cause=Name(id='exc', ctx=Load(), lineno=766, col_offset=42, end_lineno=766, end_col_offset=45), lineno=766, col_offset=8, end_lineno=766, end_col_offset=45)], lineno=764, col_offset=4, end_lineno=766, end_col_offset=45)], lineno=762, col_offset=4, end_lineno=766, end_col_offset=45)], returns=Name(id='int', ctx=Load(), lineno=761, col_offset=29, end_lineno=761, end_col_offset=32), lineno=761, col_offset=0, end_lineno=766, end_col_offset=45), FunctionDef(name='_merge_rrf_weights', args=arguments(args=[arg(arg='defaults', annotation=Subscript(value=Name(id='Mapping', ctx=Load(), lineno=770, col_offset=14, end_lineno=770, end_col_offset=21), slice=Tuple(elts=[Name(id='str', ctx=Load(), lineno=770, col_offset=22, end_lineno=770, end_col_offset=25), Name(id='float', ctx=Load(), lineno=770, col_offset=27, end_lineno=770, end_col_offset=32)], ctx=Load(), lineno=770, col_offset=22, end_lineno=770, end_col_offset=32), ctx=Load(), lineno=770, col_offset=14, end_lineno=770, end_col_offset=33), lineno=770, col_offset=4, end_lineno=770, end_col_offset=33), arg(arg='overrides', annotation=Subscript(value=Name(id='Mapping', ctx=Load(), lineno=771, col_offset=15, end_lineno=771, end_col_offset=22), slice=Tuple(elts=[Name(id='str', ctx=Load(), lineno=771, col_offset=23, end_lineno=771, end_col_offset=26), Name(id='float', ctx=Load(), lineno=771, col_offset=28, end_lineno=771, end_col_offset=33)], ctx=Load(), lineno=771, col_offset=23, end_lineno=771, end_col_offset=33), ctx=Load(), lineno=771, col_offset=15, end_lineno=771, end_col_offset=34), lineno=771, col_offset=4, end_lineno=771, end_col_offset=34)]), body=[Assign(targets=[Name(id='weights', ctx=Store(), lineno=773, col_offset=4, end_lineno=773, end_col_offset=11)], value=Call(func=Name(id='dict', ctx=Load(), lineno=773, col_offset=14, end_lineno=773, end_col_offset=18), args=[BoolOp(op=Or(), values=[Name(id='defaults', ctx=Load(), lineno=773, col_offset=19, end_lineno=773, end_col_offset=27), Dict(lineno=773, col_offset=31, end_lineno=773, end_col_offset=33)], lineno=773, col_offset=19, end_lineno=773, end_col_offset=33)], lineno=773, col_offset=14, end_lineno=773, end_col_offset=34), lineno=773, col_offset=4, end_lineno=773, end_col_offset=34), For(target=Tuple(elts=[Name(id='channel', ctx=Store(), lineno=774, col_offset=8, end_lineno=774, end_col_offset=15), Name(id='raw_value', ctx=Store(), lineno=774, col_offset=17, end_lineno=774, end_col_offset=26)], ctx=Store(), lineno=774, col_offset=8, end_lineno=774, end_col_offset=26), iter=Call(func=Attribute(value=Name(id='overrides', ctx=Load(), lineno=774, col_offset=30, end_lineno=774, end_col_offset=39), attr='items', ctx=Load(), lineno=774, col_offset=30, end_lineno=774, end_col_offset=45), lineno=774, col_offset=30, end_lineno=774, end_col_offset=47), body=[Try(body=[Assign(targets=[Subscript(value=Name(id='weights', ctx=Load(), lineno=776, col_offset=12, end_lineno=776, end_col_offset=19), slice=Name(id='channel', ctx=Load(), lineno=776, col_offset=20, end_lineno=776, end_col_offset=27), ctx=Store(), lineno=776, col_offset=12, end_lineno=776, end_col_offset=28)], value=Call(func=Name(id='float', ctx=Load(), lineno=776, col_offset=31, end_lineno=776, end_col_offset=36), args=[Name(id='raw_value', ctx=Load(), lineno=776, col_offset=37, end_lineno=776, end_col_offset=46)], lineno=776, col_offset=31, end_lineno=776, end_col_offset=47), lineno=776, col_offset=12, end_lineno=776, end_col_offset=47)], handlers=[ExceptHandler(type=Tuple(elts=[Name(id='TypeError', ctx=Load(), lineno=777, col_offset=16, end_lineno=777, end_col_offset=25), Name(id='ValueError', ctx=Load(), lineno=777, col_offset=27, end_lineno=777, end_col_offset=37)], ctx=Load(), lineno=777, col_offset=15, end_lineno=777, end_col_offset=38), body=[Expr(value=Call(func=Attribute(value=Name(id='LOGGER', ctx=Load(), lineno=778, col_offset=12, end_lineno=778, end_col_offset=18), attr='warning', ctx=Load(), lineno=778, col_offset=12, end_lineno=778, end_col_offset=26), args=[Constant(value='Ignoring non-numeric stage weight override', lineno=779, col_offset=16, end_lineno=779, end_col_offset=60)], keywords=[keyword(arg='extra', value=Dict(keys=[Constant(value='channel', lineno=780, col_offset=23, end_lineno=780, end_col_offset=32), Constant(value='value', lineno=780, col_offset=43, end_lineno=780, end_col_offset=50)], values=[Name(id='channel', ctx=Load(), lineno=780, col_offset=34, end_lineno=780, end_col_offset=41), Name(id='raw_value', ctx=Load(), lineno=780, col_offset=52, end_lineno=780, end_col_offset=61)], lineno=780, col_offset=22, end_lineno=780, end_col_offset=62), lineno=780, col_offset=16, end_lineno=780, end_col_offset=62)], lineno=778, col_offset=12, end_lineno=781, end_col_offset=13), lineno=778, col_offset=12, end_lineno=781, end_col_offset=13)], lineno=777, col_offset=8, end_lineno=781, end_col_offset=13)], lineno=775, col_offset=8, end_lineno=781, end_col_offset=13)], lineno=774, col_offset=4, end_lineno=781, end_col_offset=13), Return(value=Name(id='weights', ctx=Load(), lineno=782, col_offset=11, end_lineno=782, end_col_offset=18), lineno=782, col_offset=4, end_lineno=782, end_col_offset=18)], returns=Subscript(value=Name(id='dict', ctx=Load(), lineno=772, col_offset=5, end_lineno=772, end_col_offset=9), slice=Tuple(elts=[Name(id='str', ctx=Load(), lineno=772, col_offset=10, end_lineno=772, end_col_offset=13), Name(id='float', ctx=Load(), lineno=772, col_offset=15, end_lineno=772, end_col_offset=20)], ctx=Load(), lineno=772, col_offset=10, end_lineno=772, end_col_offset=20), ctx=Load(), lineno=772, col_offset=5, end_lineno=772, end_col_offset=21), lineno=769, col_offset=0, end_lineno=782, end_col_offset=18), FunctionDef(name='_run_warp_stage', args=arguments(kwonlyargs=[arg(arg='context', annotation=Name(id='ApplicationContext', ctx=Load(), lineno=787, col_offset=13, end_lineno=787, end_col_offset=31), lineno=787, col_offset=4, end_lineno=787, end_col_offset=31), arg(arg='query', annotation=Name(id='str', ctx=Load(), lineno=788, col_offset=11, end_lineno=788, end_col_offset=14), lineno=788, col_offset=4, end_lineno=788, end_col_offset=14), arg(arg='candidates', annotation=Subscript(value=Name(id='list', ctx=Load(), lineno=789, col_offset=16, end_lineno=789, end_col_offset=20), slice=Subscript(value=Name(id='tuple', ctx=Load(), lineno=789, col_offset=21, end_lineno=789, end_col_offset=26), slice=Tuple(elts=[Name(id='int', ctx=Load(), lineno=789, col_offset=27, end_lineno=789, end_col_offset=30), Name(id='float', ctx=Load(), lineno=789, col_offset=32, end_lineno=789, end_col_offset=37)], ctx=Load(), lineno=789, col_offset=27, end_lineno=789, end_col_offset=37), ctx=Load(), lineno=789, col_offset=21, end_lineno=789, end_col_offset=38), ctx=Load(), lineno=789, col_offset=16, end_lineno=789, end_col_offset=39), lineno=789, col_offset=4, end_lineno=789, end_col_offset=39), arg(arg='options', annotation=Name(id='SemanticProRuntimeOptions', ctx=Load(), lineno=790, col_offset=13, end_lineno=790, end_col_offset=38), lineno=790, col_offset=4, end_lineno=790, end_col_offset=38)], kw_defaults=[None, None, None, None]), body=[AnnAssign(target=Name(id='notes', ctx=Store(), lineno=792, col_offset=4, end_lineno=792, end_col_offset=9), annotation=Subscript(value=Name(id='list', ctx=Load(), lineno=792, col_offset=11, end_lineno=792, end_col_offset=15), slice=Name(id='str', ctx=Load(), lineno=792, col_offset=16, end_lineno=792, end_col_offset=19), ctx=Load(), lineno=792, col_offset=11, end_lineno=792, end_col_offset=20), value=List(ctx=Load(), lineno=792, col_offset=23, end_lineno=792, end_col_offset=25), simple=1, lineno=792, col_offset=4, end_lineno=792, end_col_offset=25), Assign(targets=[Tuple(elts=[Name(id='warp_hits', ctx=Store(), lineno=793, col_offset=4, end_lineno=793, end_col_offset=13), Name(id='warp_notes', ctx=Store(), lineno=793, col_offset=15, end_lineno=793, end_col_offset=25)], ctx=Store(), lineno=793, col_offset=4, end_lineno=793, end_col_offset=25)], value=Call(func=Name(id='_warp_executor_hits', ctx=Load(), lineno=793, col_offset=28, end_lineno=793, end_col_offset=47), args=[Name(id='context', ctx=Load(), lineno=793, col_offset=48, end_lineno=793, end_col_offset=55), Name(id='query', ctx=Load(), lineno=793, col_offset=57, end_lineno=793, end_col_offset=62), Name(id='candidates', ctx=Load(), lineno=793, col_offset=64, end_lineno=793, end_col_offset=74)], lineno=793, col_offset=28, end_lineno=793, end_col_offset=75), lineno=793, col_offset=4, end_lineno=793, end_col_offset=75), Expr(value=Call(func=Attribute(value=Name(id='notes', ctx=Load(), lineno=794, col_offset=4, end_lineno=794, end_col_offset=9), attr='extend', ctx=Load(), lineno=794, col_offset=4, end_lineno=794, end_col_offset=16), args=[Name(id='warp_notes', ctx=Load(), lineno=794, col_offset=17, end_lineno=794, end_col_offset=27)], lineno=794, col_offset=4, end_lineno=794, end_col_offset=28), lineno=794, col_offset=4, end_lineno=794, end_col_offset=28), If(test=Compare(left=Name(id='warp_hits', ctx=Load(), lineno=795, col_offset=7, end_lineno=795, end_col_offset=16), ops=[IsNot()], comparators=[Constant(value=None, lineno=795, col_offset=24, end_lineno=795, end_col_offset=28)], lineno=795, col_offset=7, end_lineno=795, end_col_offset=28), body=[Return(value=Tuple(elts=[Name(id='warp_hits', ctx=Load(), lineno=796, col_offset=15, end_lineno=796, end_col_offset=24), Name(id='notes', ctx=Load(), lineno=796, col_offset=26, end_lineno=796, end_col_offset=31), List(ctx=Load(), lineno=796, col_offset=33, end_lineno=796, end_col_offset=35), Constant(value='warp', lineno=796, col_offset=37, end_lineno=796, end_col_offset=43)], ctx=Load(), lineno=796, col_offset=15, end_lineno=796, end_col_offset=43), lineno=796, col_offset=8, end_lineno=796, end_col_offset=43)], lineno=795, col_offset=4, end_lineno=796, end_col_offset=43), Assign(targets=[Tuple(elts=[Name(id='xtr_hits', ctx=Store(), lineno=798, col_offset=4, end_lineno=798, end_col_offset=12), Name(id='xtr_notes', ctx=Store(), lineno=798, col_offset=14, end_lineno=798, end_col_offset=23), Name(id='explain_payload', ctx=Store(), lineno=798, col_offset=25, end_lineno=798, end_col_offset=40)], ctx=Store(), lineno=798, col_offset=4, end_lineno=798, end_col_offset=40)], value=Call(func=Name(id='_xtr_rescore_hits', ctx=Load(), lineno=798, col_offset=43, end_lineno=798, end_col_offset=60), keywords=[keyword(arg='context', value=Name(id='context', ctx=Load(), lineno=799, col_offset=16, end_lineno=799, end_col_offset=23), lineno=799, col_offset=8, end_lineno=799, end_col_offset=23), keyword(arg='query', value=Name(id='query', ctx=Load(), lineno=800, col_offset=14, end_lineno=800, end_col_offset=19), lineno=800, col_offset=8, end_lineno=800, end_col_offset=19), keyword(arg='candidates', value=Name(id='candidates', ctx=Load(), lineno=801, col_offset=19, end_lineno=801, end_col_offset=29), lineno=801, col_offset=8, end_lineno=801, end_col_offset=29), keyword(arg='options', value=Name(id='options', ctx=Load(), lineno=802, col_offset=16, end_lineno=802, end_col_offset=23), lineno=802, col_offset=8, end_lineno=802, end_col_offset=23)], lineno=798, col_offset=43, end_lineno=803, end_col_offset=5), lineno=798, col_offset=4, end_lineno=803, end_col_offset=5), Expr(value=Call(func=Attribute(value=Name(id='notes', ctx=Load(), lineno=804, col_offset=4, end_lineno=804, end_col_offset=9), attr='extend', ctx=Load(), lineno=804, col_offset=4, end_lineno=804, end_col_offset=16), args=[Name(id='xtr_notes', ctx=Load(), lineno=804, col_offset=17, end_lineno=804, end_col_offset=26)], lineno=804, col_offset=4, end_lineno=804, end_col_offset=27), lineno=804, col_offset=4, end_lineno=804, end_col_offset=27), Return(value=Tuple(elts=[Name(id='xtr_hits', ctx=Load(), lineno=805, col_offset=11, end_lineno=805, end_col_offset=19), Name(id='notes', ctx=Load(), lineno=805, col_offset=21, end_lineno=805, end_col_offset=26), Name(id='explain_payload', ctx=Load(), lineno=805, col_offset=28, end_lineno=805, end_col_offset=43), Constant(value='xtr', lineno=805, col_offset=45, end_lineno=805, end_col_offset=50)], ctx=Load(), lineno=805, col_offset=11, end_lineno=805, end_col_offset=50), lineno=805, col_offset=4, end_lineno=805, end_col_offset=50)], returns=Subscript(value=Name(id='tuple', ctx=Load(), lineno=791, col_offset=5, end_lineno=791, end_col_offset=10), slice=Tuple(elts=[Subscript(value=Name(id='list', ctx=Load(), lineno=791, col_offset=11, end_lineno=791, end_col_offset=15), slice=Subscript(value=Name(id='tuple', ctx=Load(), lineno=791, col_offset=16, end_lineno=791, end_col_offset=21), slice=Tuple(elts=[Name(id='int', ctx=Load(), lineno=791, col_offset=22, end_lineno=791, end_col_offset=25), Name(id='float', ctx=Load(), lineno=791, col_offset=27, end_lineno=791, end_col_offset=32)], ctx=Load(), lineno=791, col_offset=22, end_lineno=791, end_col_offset=32), ctx=Load(), lineno=791, col_offset=16, end_lineno=791, end_col_offset=33), ctx=Load(), lineno=791, col_offset=11, end_lineno=791, end_col_offset=34), Subscript(value=Name(id='list', ctx=Load(), lineno=791, col_offset=36, end_lineno=791, end_col_offset=40), slice=Name(id='str', ctx=Load(), lineno=791, col_offset=41, end_lineno=791, end_col_offset=44), ctx=Load(), lineno=791, col_offset=36, end_lineno=791, end_col_offset=45), Subscript(value=Name(id='list', ctx=Load(), lineno=791, col_offset=47, end_lineno=791, end_col_offset=51), slice=Subscript(value=Name(id='tuple', ctx=Load(), lineno=791, col_offset=52, end_lineno=791, end_col_offset=57), slice=Tuple(elts=[Name(id='int', ctx=Load(), lineno=791, col_offset=58, end_lineno=791, end_col_offset=61), Subscript(value=Name(id='dict', ctx=Load(), lineno=791, col_offset=63, end_lineno=791, end_col_offset=67), slice=Tuple(elts=[Name(id='str', ctx=Load(), lineno=791, col_offset=68, end_lineno=791, end_col_offset=71), Name(id='Any', ctx=Load(), lineno=791, col_offset=73, end_lineno=791, end_col_offset=76)], ctx=Load(), lineno=791, col_offset=68, end_lineno=791, end_col_offset=76), ctx=Load(), lineno=791, col_offset=63, end_lineno=791, end_col_offset=77)], ctx=Load(), lineno=791, col_offset=58, end_lineno=791, end_col_offset=77), ctx=Load(), lineno=791, col_offset=52, end_lineno=791, end_col_offset=78), ctx=Load(), lineno=791, col_offset=47, end_lineno=791, end_col_offset=79), Name(id='str', ctx=Load(), lineno=791, col_offset=81, end_lineno=791, end_col_offset=84)], ctx=Load(), lineno=791, col_offset=11, end_lineno=791, end_col_offset=84), ctx=Load(), lineno=791, col_offset=5, end_lineno=791, end_col_offset=85), lineno=785, col_offset=0, end_lineno=805, end_col_offset=50), FunctionDef(name='_warp_executor_hits', args=arguments(args=[arg(arg='context', annotation=Name(id='ApplicationContext', ctx=Load(), lineno=809, col_offset=13, end_lineno=809, end_col_offset=31), lineno=809, col_offset=4, end_lineno=809, end_col_offset=31), arg(arg='query', annotation=Name(id='str', ctx=Load(), lineno=810, col_offset=11, end_lineno=810, end_col_offset=14), lineno=810, col_offset=4, end_lineno=810, end_col_offset=14), arg(arg='candidates', annotation=Subscript(value=Name(id='list', ctx=Load(), lineno=811, col_offset=16, end_lineno=811, end_col_offset=20), slice=Subscript(value=Name(id='tuple', ctx=Load(), lineno=811, col_offset=21, end_lineno=811, end_col_offset=26), slice=Tuple(elts=[Name(id='int', ctx=Load(), lineno=811, col_offset=27, end_lineno=811, end_col_offset=30), Name(id='float', ctx=Load(), lineno=811, col_offset=32, end_lineno=811, end_col_offset=37)], ctx=Load(), lineno=811, col_offset=27, end_lineno=811, end_col_offset=37), ctx=Load(), lineno=811, col_offset=21, end_lineno=811, end_col_offset=38), ctx=Load(), lineno=811, col_offset=16, end_lineno=811, end_col_offset=39), lineno=811, col_offset=4, end_lineno=811, end_col_offset=39)]), body=[Assign(targets=[Name(id='cfg', ctx=Store(), lineno=813, col_offset=4, end_lineno=813, end_col_offset=7)], value=Attribute(value=Attribute(value=Name(id='context', ctx=Load(), lineno=813, col_offset=10, end_lineno=813, end_col_offset=17), attr='settings', ctx=Load(), lineno=813, col_offset=10, end_lineno=813, end_col_offset=26), attr='warp', ctx=Load(), lineno=813, col_offset=10, end_lineno=813, end_col_offset=31), lineno=813, col_offset=4, end_lineno=813, end_col_offset=31), AnnAssign(target=Name(id='notes', ctx=Store(), lineno=814, col_offset=4, end_lineno=814, end_col_offset=9), annotation=Subscript(value=Name(id='list', ctx=Load(), lineno=814, col_offset=11, end_lineno=814, end_col_offset=15), slice=Name(id='str', ctx=Load(), lineno=814, col_offset=16, end_lineno=814, end_col_offset=19), ctx=Load(), lineno=814, col_offset=11, end_lineno=814, end_col_offset=20), value=List(ctx=Load(), lineno=814, col_offset=23, end_lineno=814, end_col_offset=25), simple=1, lineno=814, col_offset=4, end_lineno=814, end_col_offset=25), If(test=UnaryOp(op=Not(), operand=Attribute(value=Name(id='cfg', ctx=Load(), lineno=815, col_offset=11, end_lineno=815, end_col_offset=14), attr='enabled', ctx=Load(), lineno=815, col_offset=11, end_lineno=815, end_col_offset=22), lineno=815, col_offset=7, end_lineno=815, end_col_offset=22), body=[Return(value=Tuple(elts=[Constant(value=None, lineno=816, col_offset=15, end_lineno=816, end_col_offset=19), Name(id='notes', ctx=Load(), lineno=816, col_offset=21, end_lineno=816, end_col_offset=26)], ctx=Load(), lineno=816, col_offset=15, end_lineno=816, end_col_offset=26), lineno=816, col_offset=8, end_lineno=816, end_col_offset=26)], lineno=815, col_offset=4, end_lineno=816, end_col_offset=26), Try(body=[Assign(targets=[Name(id='warp_engine', ctx=Store(), lineno=818, col_offset=8, end_lineno=818, end_col_offset=19)], value=Call(func=Name(id='WarpEngine', ctx=Load(), lineno=818, col_offset=22, end_lineno=818, end_col_offset=32), keywords=[keyword(arg='index_dir', value=Attribute(value=Attribute(value=Name(id='context', ctx=Load(), lineno=819, col_offset=22, end_lineno=819, end_col_offset=29), attr='paths', ctx=Load(), lineno=819, col_offset=22, end_lineno=819, end_col_offset=35), attr='warp_index_dir', ctx=Load(), lineno=819, col_offset=22, end_lineno=819, end_col_offset=50), lineno=819, col_offset=12, end_lineno=819, end_col_offset=50), keyword(arg='device', value=Attribute(value=Name(id='cfg', ctx=Load(), lineno=820, col_offset=19, end_lineno=820, end_col_offset=22), attr='device', ctx=Load(), lineno=820, col_offset=19, end_lineno=820, end_col_offset=29), lineno=820, col_offset=12, end_lineno=820, end_col_offset=29)], lineno=818, col_offset=22, end_lineno=821, end_col_offset=9), lineno=818, col_offset=8, end_lineno=821, end_col_offset=9)], handlers=[ExceptHandler(type=Name(id='WarpUnavailableError', ctx=Load(), lineno=822, col_offset=11, end_lineno=822, end_col_offset=31), name='exc', body=[Expr(value=Call(func=Attribute(value=Name(id='notes', ctx=Load(), lineno=823, col_offset=8, end_lineno=823, end_col_offset=13), attr='append', ctx=Load(), lineno=823, col_offset=8, end_lineno=823, end_col_offset=20), args=[Call(func=Name(id='str', ctx=Load(), lineno=823, col_offset=21, end_lineno=823, end_col_offset=24), args=[Name(id='exc', ctx=Load(), lineno=823, col_offset=25, end_lineno=823, end_col_offset=28)], lineno=823, col_offset=21, end_lineno=823, end_col_offset=29)], lineno=823, col_offset=8, end_lineno=823, end_col_offset=30), lineno=823, col_offset=8, end_lineno=823, end_col_offset=30), Return(value=Tuple(elts=[Constant(value=None, lineno=824, col_offset=15, end_lineno=824, end_col_offset=19), Name(id='notes', ctx=Load(), lineno=824, col_offset=21, end_lineno=824, end_col_offset=26)], ctx=Load(), lineno=824, col_offset=15, end_lineno=824, end_col_offset=26), lineno=824, col_offset=8, end_lineno=824, end_col_offset=26)], lineno=822, col_offset=4, end_lineno=824, end_col_offset=26)], lineno=817, col_offset=4, end_lineno=824, end_col_offset=26), Try(body=[Assign(targets=[Name(id='hits', ctx=Store(), lineno=827, col_offset=8, end_lineno=827, end_col_offset=12)], value=Call(func=Attribute(value=Name(id='warp_engine', ctx=Load(), lineno=827, col_offset=15, end_lineno=827, end_col_offset=26), attr='rerank', ctx=Load(), lineno=827, col_offset=15, end_lineno=827, end_col_offset=33), keywords=[keyword(arg='query', value=Name(id='query', ctx=Load(), lineno=828, col_offset=18, end_lineno=828, end_col_offset=23), lineno=828, col_offset=12, end_lineno=828, end_col_offset=23), keyword(arg='candidate_ids', value=ListComp(elt=Name(id='cid', ctx=Load(), lineno=829, col_offset=27, end_lineno=829, end_col_offset=30), generators=[comprehension(target=Tuple(elts=[Name(id='cid', ctx=Store(), lineno=829, col_offset=35, end_lineno=829, end_col_offset=38), Name(id='_', ctx=Store(), lineno=829, col_offset=40, end_lineno=829, end_col_offset=41)], ctx=Store(), lineno=829, col_offset=35, end_lineno=829, end_col_offset=41), iter=Name(id='candidates', ctx=Load(), lineno=829, col_offset=45, end_lineno=829, end_col_offset=55), is_async=0)], lineno=829, col_offset=26, end_lineno=829, end_col_offset=56), lineno=829, col_offset=12, end_lineno=829, end_col_offset=56), keyword(arg='top_k', value=Call(func=Name(id='min', ctx=Load(), lineno=830, col_offset=18, end_lineno=830, end_col_offset=21), args=[Attribute(value=Name(id='cfg', ctx=Load(), lineno=830, col_offset=22, end_lineno=830, end_col_offset=25), attr='top_k', ctx=Load(), lineno=830, col_offset=22, end_lineno=830, end_col_offset=31), Call(func=Name(id='len', ctx=Load(), lineno=830, col_offset=33, end_lineno=830, end_col_offset=36), args=[Name(id='candidates', ctx=Load(), lineno=830, col_offset=37, end_lineno=830, end_col_offset=47)], lineno=830, col_offset=33, end_lineno=830, end_col_offset=48)], lineno=830, col_offset=18, end_lineno=830, end_col_offset=49), lineno=830, col_offset=12, end_lineno=830, end_col_offset=49)], lineno=827, col_offset=15, end_lineno=831, end_col_offset=9), lineno=827, col_offset=8, end_lineno=831, end_col_offset=9)], handlers=[ExceptHandler(type=Name(id='WarpUnavailableError', ctx=Load(), lineno=832, col_offset=11, end_lineno=832, end_col_offset=31), name='exc', body=[Expr(value=Call(func=Attribute(value=Name(id='notes', ctx=Load(), lineno=833, col_offset=8, end_lineno=833, end_col_offset=13), attr='append', ctx=Load(), lineno=833, col_offset=8, end_lineno=833, end_col_offset=20), args=[Call(func=Name(id='str', ctx=Load(), lineno=833, col_offset=21, end_lineno=833, end_col_offset=24), args=[Name(id='exc', ctx=Load(), lineno=833, col_offset=25, end_lineno=833, end_col_offset=28)], lineno=833, col_offset=21, end_lineno=833, end_col_offset=29)], lineno=833, col_offset=8, end_lineno=833, end_col_offset=30), lineno=833, col_offset=8, end_lineno=833, end_col_offset=30), Return(value=Tuple(elts=[Constant(value=None, lineno=834, col_offset=15, end_lineno=834, end_col_offset=19), Name(id='notes', ctx=Load(), lineno=834, col_offset=21, end_lineno=834, end_col_offset=26)], ctx=Load(), lineno=834, col_offset=15, end_lineno=834, end_col_offset=26), lineno=834, col_offset=8, end_lineno=834, end_col_offset=26)], lineno=832, col_offset=4, end_lineno=834, end_col_offset=26)], lineno=826, col_offset=4, end_lineno=834, end_col_offset=26), Expr(value=Call(func=Attribute(value=Name(id='notes', ctx=Load(), lineno=836, col_offset=4, end_lineno=836, end_col_offset=9), attr='append', ctx=Load(), lineno=836, col_offset=4, end_lineno=836, end_col_offset=16), args=[JoinedStr(values=[Constant(value='WARP executor rescored ', lineno=836, col_offset=19, end_lineno=836, end_col_offset=42), FormattedValue(value=Call(func=Name(id='len', ctx=Load(), lineno=836, col_offset=43, end_lineno=836, end_col_offset=46), args=[Name(id='hits', ctx=Load(), lineno=836, col_offset=47, end_lineno=836, end_col_offset=51)], lineno=836, col_offset=43, end_lineno=836, end_col_offset=52), conversion=-1, lineno=836, col_offset=42, end_lineno=836, end_col_offset=53), Constant(value=' candidates.', lineno=836, col_offset=53, end_lineno=836, end_col_offset=65)], lineno=836, col_offset=17, end_lineno=836, end_col_offset=66)], lineno=836, col_offset=4, end_lineno=836, end_col_offset=67), lineno=836, col_offset=4, end_lineno=836, end_col_offset=67), Return(value=Tuple(elts=[Name(id='hits', ctx=Load(), lineno=837, col_offset=11, end_lineno=837, end_col_offset=15), Name(id='notes', ctx=Load(), lineno=837, col_offset=17, end_lineno=837, end_col_offset=22)], ctx=Load(), lineno=837, col_offset=11, end_lineno=837, end_col_offset=22), lineno=837, col_offset=4, end_lineno=837, end_col_offset=22)], returns=Subscript(value=Name(id='tuple', ctx=Load(), lineno=812, col_offset=5, end_lineno=812, end_col_offset=10), slice=Tuple(elts=[BinOp(left=Subscript(value=Name(id='list', ctx=Load(), lineno=812, col_offset=11, end_lineno=812, end_col_offset=15), slice=Subscript(value=Name(id='tuple', ctx=Load(), lineno=812, col_offset=16, end_lineno=812, end_col_offset=21), slice=Tuple(elts=[Name(id='int', ctx=Load(), lineno=812, col_offset=22, end_lineno=812, end_col_offset=25), Name(id='float', ctx=Load(), lineno=812, col_offset=27, end_lineno=812, end_col_offset=32)], ctx=Load(), lineno=812, col_offset=22, end_lineno=812, end_col_offset=32), ctx=Load(), lineno=812, col_offset=16, end_lineno=812, end_col_offset=33), ctx=Load(), lineno=812, col_offset=11, end_lineno=812, end_col_offset=34), op=BitOr(), right=Constant(value=None, lineno=812, col_offset=37, end_lineno=812, end_col_offset=41), lineno=812, col_offset=11, end_lineno=812, end_col_offset=41), Subscript(value=Name(id='list', ctx=Load(), lineno=812, col_offset=43, end_lineno=812, end_col_offset=47), slice=Name(id='str', ctx=Load(), lineno=812, col_offset=48, end_lineno=812, end_col_offset=51), ctx=Load(), lineno=812, col_offset=43, end_lineno=812, end_col_offset=52)], ctx=Load(), lineno=812, col_offset=11, end_lineno=812, end_col_offset=52), ctx=Load(), lineno=812, col_offset=5, end_lineno=812, end_col_offset=53), lineno=808, col_offset=0, end_lineno=837, end_col_offset=22), FunctionDef(name='_xtr_rescore_hits', args=arguments(kwonlyargs=[arg(arg='context', annotation=Name(id='ApplicationContext', ctx=Load(), lineno=842, col_offset=13, end_lineno=842, end_col_offset=31), lineno=842, col_offset=4, end_lineno=842, end_col_offset=31), arg(arg='query', annotation=Name(id='str', ctx=Load(), lineno=843, col_offset=11, end_lineno=843, end_col_offset=14), lineno=843, col_offset=4, end_lineno=843, end_col_offset=14), arg(arg='candidates', annotation=Subscript(value=Name(id='list', ctx=Load(), lineno=844, col_offset=16, end_lineno=844, end_col_offset=20), slice=Subscript(value=Name(id='tuple', ctx=Load(), lineno=844, col_offset=21, end_lineno=844, end_col_offset=26), slice=Tuple(elts=[Name(id='int', ctx=Load(), lineno=844, col_offset=27, end_lineno=844, end_col_offset=30), Name(id='float', ctx=Load(), lineno=844, col_offset=32, end_lineno=844, end_col_offset=37)], ctx=Load(), lineno=844, col_offset=27, end_lineno=844, end_col_offset=37), ctx=Load(), lineno=844, col_offset=21, end_lineno=844, end_col_offset=38), ctx=Load(), lineno=844, col_offset=16, end_lineno=844, end_col_offset=39), lineno=844, col_offset=4, end_lineno=844, end_col_offset=39), arg(arg='options', annotation=Name(id='SemanticProRuntimeOptions', ctx=Load(), lineno=845, col_offset=13, end_lineno=845, end_col_offset=38), lineno=845, col_offset=4, end_lineno=845, end_col_offset=38)], kw_defaults=[None, None, None, None]), body=[AnnAssign(target=Name(id='notes', ctx=Store(), lineno=847, col_offset=4, end_lineno=847, end_col_offset=9), annotation=Subscript(value=Name(id='list', ctx=Load(), lineno=847, col_offset=11, end_lineno=847, end_col_offset=15), slice=Name(id='str', ctx=Load(), lineno=847, col_offset=16, end_lineno=847, end_col_offset=19), ctx=Load(), lineno=847, col_offset=11, end_lineno=847, end_col_offset=20), value=List(ctx=Load(), lineno=847, col_offset=23, end_lineno=847, end_col_offset=25), simple=1, lineno=847, col_offset=4, end_lineno=847, end_col_offset=25), AnnAssign(target=Name(id='explain_payload', ctx=Store(), lineno=848, col_offset=4, end_lineno=848, end_col_offset=19), annotation=Subscript(value=Name(id='list', ctx=Load(), lineno=848, col_offset=21, end_lineno=848, end_col_offset=25), slice=Subscript(value=Name(id='tuple', ctx=Load(), lineno=848, col_offset=26, end_lineno=848, end_col_offset=31), slice=Tuple(elts=[Name(id='int', ctx=Load(), lineno=848, col_offset=32, end_lineno=848, end_col_offset=35), Subscript(value=Name(id='dict', ctx=Load(), lineno=848, col_offset=37, end_lineno=848, end_col_offset=41), slice=Tuple(elts=[Name(id='str', ctx=Load(), lineno=848, col_offset=42, end_lineno=848, end_col_offset=45), Name(id='Any', ctx=Load(), lineno=848, col_offset=47, end_lineno=848, end_col_offset=50)], ctx=Load(), lineno=848, col_offset=42, end_lineno=848, end_col_offset=50), ctx=Load(), lineno=848, col_offset=37, end_lineno=848, end_col_offset=51)], ctx=Load(), lineno=848, col_offset=32, end_lineno=848, end_col_offset=51), ctx=Load(), lineno=848, col_offset=26, end_lineno=848, end_col_offset=52), ctx=Load(), lineno=848, col_offset=21, end_lineno=848, end_col_offset=53), value=List(ctx=Load(), lineno=848, col_offset=56, end_lineno=848, end_col_offset=58), simple=1, lineno=848, col_offset=4, end_lineno=848, end_col_offset=58), If(test=UnaryOp(op=Not(), operand=Attribute(value=Attribute(value=Attribute(value=Name(id='context', ctx=Load(), lineno=849, col_offset=11, end_lineno=849, end_col_offset=18), attr='settings', ctx=Load(), lineno=849, col_offset=11, end_lineno=849, end_col_offset=27), attr='xtr', ctx=Load(), lineno=849, col_offset=11, end_lineno=849, end_col_offset=31), attr='enable', ctx=Load(), lineno=849, col_offset=11, end_lineno=849, end_col_offset=38), lineno=849, col_offset=7, end_lineno=849, end_col_offset=38), body=[Expr(value=Call(func=Attribute(value=Name(id='notes', ctx=Load(), lineno=850, col_offset=8, end_lineno=850, end_col_offset=13), attr='append', ctx=Load(), lineno=850, col_offset=8, end_lineno=850, end_col_offset=20), args=[Constant(value='XTR disabled via configuration flag.', lineno=850, col_offset=21, end_lineno=850, end_col_offset=59)], lineno=850, col_offset=8, end_lineno=850, end_col_offset=60), lineno=850, col_offset=8, end_lineno=850, end_col_offset=60), Return(value=Tuple(elts=[List(ctx=Load(), lineno=851, col_offset=15, end_lineno=851, end_col_offset=17), Name(id='notes', ctx=Load(), lineno=851, col_offset=19, end_lineno=851, end_col_offset=24), Name(id='explain_payload', ctx=Load(), lineno=851, col_offset=26, end_lineno=851, end_col_offset=41)], ctx=Load(), lineno=851, col_offset=15, end_lineno=851, end_col_offset=41), lineno=851, col_offset=8, end_lineno=851, end_col_offset=41)], lineno=849, col_offset=4, end_lineno=851, end_col_offset=41), Assign(targets=[Name(id='xtr_index', ctx=Store(), lineno=853, col_offset=4, end_lineno=853, end_col_offset=13)], value=Call(func=Attribute(value=Name(id='context', ctx=Load(), lineno=853, col_offset=16, end_lineno=853, end_col_offset=23), attr='get_xtr_index', ctx=Load(), lineno=853, col_offset=16, end_lineno=853, end_col_offset=37), lineno=853, col_offset=16, end_lineno=853, end_col_offset=39), lineno=853, col_offset=4, end_lineno=853, end_col_offset=39), If(test=BoolOp(op=Or(), values=[Compare(left=Name(id='xtr_index', ctx=Load(), lineno=854, col_offset=7, end_lineno=854, end_col_offset=16), ops=[Is()], comparators=[Constant(value=None, lineno=854, col_offset=20, end_lineno=854, end_col_offset=24)], lineno=854, col_offset=7, end_lineno=854, end_col_offset=24), UnaryOp(op=Not(), operand=Attribute(value=Name(id='xtr_index', ctx=Load(), lineno=854, col_offset=32, end_lineno=854, end_col_offset=41), attr='ready', ctx=Load(), lineno=854, col_offset=32, end_lineno=854, end_col_offset=47), lineno=854, col_offset=28, end_lineno=854, end_col_offset=47)], lineno=854, col_offset=7, end_lineno=854, end_col_offset=47), body=[Expr(value=Call(func=Attribute(value=Name(id='notes', ctx=Load(), lineno=855, col_offset=8, end_lineno=855, end_col_offset=13), attr='append', ctx=Load(), lineno=855, col_offset=8, end_lineno=855, end_col_offset=20), args=[Constant(value='XTR index unavailable; skipping late interaction.', lineno=855, col_offset=21, end_lineno=855, end_col_offset=72)], lineno=855, col_offset=8, end_lineno=855, end_col_offset=73), lineno=855, col_offset=8, end_lineno=855, end_col_offset=73), Return(value=Tuple(elts=[List(ctx=Load(), lineno=856, col_offset=15, end_lineno=856, end_col_offset=17), Name(id='notes', ctx=Load(), lineno=856, col_offset=19, end_lineno=856, end_col_offset=24), Name(id='explain_payload', ctx=Load(), lineno=856, col_offset=26, end_lineno=856, end_col_offset=41)], ctx=Load(), lineno=856, col_offset=15, end_lineno=856, end_col_offset=41), lineno=856, col_offset=8, end_lineno=856, end_col_offset=41)], lineno=854, col_offset=4, end_lineno=856, end_col_offset=41), Assign(targets=[Name(id='limit', ctx=Store(), lineno=858, col_offset=4, end_lineno=858, end_col_offset=9)], value=BoolOp(op=Or(), values=[Attribute(value=Name(id='options', ctx=Load(), lineno=858, col_offset=12, end_lineno=858, end_col_offset=19), attr='xtr_k', ctx=Load(), lineno=858, col_offset=12, end_lineno=858, end_col_offset=25), Attribute(value=Attribute(value=Attribute(value=Name(id='context', ctx=Load(), lineno=858, col_offset=29, end_lineno=858, end_col_offset=36), attr='settings', ctx=Load(), lineno=858, col_offset=29, end_lineno=858, end_col_offset=45), attr='xtr', ctx=Load(), lineno=858, col_offset=29, end_lineno=858, end_col_offset=49), attr='candidate_k', ctx=Load(), lineno=858, col_offset=29, end_lineno=858, end_col_offset=61)], lineno=858, col_offset=12, end_lineno=858, end_col_offset=61), lineno=858, col_offset=4, end_lineno=858, end_col_offset=61), Assign(targets=[Name(id='candidate_ids', ctx=Store(), lineno=859, col_offset=4, end_lineno=859, end_col_offset=17)], value=Subscript(value=ListComp(elt=Name(id='cid', ctx=Load(), lineno=859, col_offset=21, end_lineno=859, end_col_offset=24), generators=[comprehension(target=Tuple(elts=[Name(id='cid', ctx=Store(), lineno=859, col_offset=29, end_lineno=859, end_col_offset=32), Name(id='_', ctx=Store(), lineno=859, col_offset=34, end_lineno=859, end_col_offset=35)], ctx=Store(), lineno=859, col_offset=29, end_lineno=859, end_col_offset=35), iter=Name(id='candidates', ctx=Load(), lineno=859, col_offset=39, end_lineno=859, end_col_offset=49), is_async=0)], lineno=859, col_offset=20, end_lineno=859, end_col_offset=50), slice=Slice(upper=Name(id='limit', ctx=Load(), lineno=859, col_offset=52, end_lineno=859, end_col_offset=57), lineno=859, col_offset=51, end_lineno=859, end_col_offset=57), ctx=Load(), lineno=859, col_offset=20, end_lineno=859, end_col_offset=58), lineno=859, col_offset=4, end_lineno=859, end_col_offset=58), If(test=UnaryOp(op=Not(), operand=Name(id='candidate_ids', ctx=Load(), lineno=860, col_offset=11, end_lineno=860, end_col_offset=24), lineno=860, col_offset=7, end_lineno=860, end_col_offset=24), body=[Expr(value=Call(func=Attribute(value=Name(id='notes', ctx=Load(), lineno=861, col_offset=8, end_lineno=861, end_col_offset=13), attr='append', ctx=Load(), lineno=861, col_offset=8, end_lineno=861, end_col_offset=20), args=[Constant(value='Insufficient candidates for XTR rescoring.', lineno=861, col_offset=21, end_lineno=861, end_col_offset=65)], lineno=861, col_offset=8, end_lineno=861, end_col_offset=66), lineno=861, col_offset=8, end_lineno=861, end_col_offset=66), Return(value=Tuple(elts=[List(ctx=Load(), lineno=862, col_offset=15, end_lineno=862, end_col_offset=17), Name(id='notes', ctx=Load(), lineno=862, col_offset=19, end_lineno=862, end_col_offset=24), Name(id='explain_payload', ctx=Load(), lineno=862, col_offset=26, end_lineno=862, end_col_offset=41)], ctx=Load(), lineno=862, col_offset=15, end_lineno=862, end_col_offset=41), lineno=862, col_offset=8, end_lineno=862, end_col_offset=41)], lineno=860, col_offset=4, end_lineno=862, end_col_offset=41), Assign(targets=[Name(id='rescored', ctx=Store(), lineno=864, col_offset=4, end_lineno=864, end_col_offset=12)], value=Call(func=Attribute(value=Name(id='xtr_index', ctx=Load(), lineno=864, col_offset=15, end_lineno=864, end_col_offset=24), attr='rescore', ctx=Load(), lineno=864, col_offset=15, end_lineno=864, end_col_offset=32), keywords=[keyword(arg='query', value=Name(id='query', ctx=Load(), lineno=865, col_offset=14, end_lineno=865, end_col_offset=19), lineno=865, col_offset=8, end_lineno=865, end_col_offset=19), keyword(arg='candidate_chunk_ids', value=Name(id='candidate_ids', ctx=Load(), lineno=866, col_offset=28, end_lineno=866, end_col_offset=41), lineno=866, col_offset=8, end_lineno=866, end_col_offset=41), keyword(arg='explain', value=Attribute(value=Name(id='options', ctx=Load(), lineno=867, col_offset=16, end_lineno=867, end_col_offset=23), attr='explain', ctx=Load(), lineno=867, col_offset=16, end_lineno=867, end_col_offset=31), lineno=867, col_offset=8, end_lineno=867, end_col_offset=31)], lineno=864, col_offset=15, end_lineno=868, end_col_offset=5), lineno=864, col_offset=4, end_lineno=868, end_col_offset=5), Assign(targets=[Name(id='hits', ctx=Store(), lineno=869, col_offset=4, end_lineno=869, end_col_offset=8)], value=ListComp(elt=Tuple(elts=[Name(id='chunk_id', ctx=Load(), lineno=869, col_offset=13, end_lineno=869, end_col_offset=21), Name(id='score', ctx=Load(), lineno=869, col_offset=23, end_lineno=869, end_col_offset=28)], ctx=Load(), lineno=869, col_offset=12, end_lineno=869, end_col_offset=29), generators=[comprehension(target=Tuple(elts=[Name(id='chunk_id', ctx=Store(), lineno=869, col_offset=34, end_lineno=869, end_col_offset=42), Name(id='score', ctx=Store(), lineno=869, col_offset=44, end_lineno=869, end_col_offset=49), Name(id='_payload', ctx=Store(), lineno=869, col_offset=51, end_lineno=869, end_col_offset=59)], ctx=Store(), lineno=869, col_offset=34, end_lineno=869, end_col_offset=59), iter=Name(id='rescored', ctx=Load(), lineno=869, col_offset=63, end_lineno=869, end_col_offset=71), is_async=0)], lineno=869, col_offset=11, end_lineno=869, end_col_offset=72), lineno=869, col_offset=4, end_lineno=869, end_col_offset=72), Assign(targets=[Name(id='explain_payload', ctx=Store(), lineno=870, col_offset=4, end_lineno=870, end_col_offset=19)], value=ListComp(elt=Tuple(elts=[Name(id='chunk_id', ctx=Load(), lineno=870, col_offset=24, end_lineno=870, end_col_offset=32), Name(id='payload', ctx=Load(), lineno=870, col_offset=34, end_lineno=870, end_col_offset=41)], ctx=Load(), lineno=870, col_offset=23, end_lineno=870, end_col_offset=42), generators=[comprehension(target=Tuple(elts=[Name(id='chunk_id', ctx=Store(), lineno=870, col_offset=47, end_lineno=870, end_col_offset=55), Name(id='_score', ctx=Store(), lineno=870, col_offset=57, end_lineno=870, end_col_offset=63), Name(id='payload', ctx=Store(), lineno=870, col_offset=65, end_lineno=870, end_col_offset=72)], ctx=Store(), lineno=870, col_offset=47, end_lineno=870, end_col_offset=72), iter=Name(id='rescored', ctx=Load(), lineno=870, col_offset=76, end_lineno=870, end_col_offset=84), ifs=[Name(id='payload', ctx=Load(), lineno=870, col_offset=88, end_lineno=870, end_col_offset=95)], is_async=0)], lineno=870, col_offset=22, end_lineno=870, end_col_offset=96), lineno=870, col_offset=4, end_lineno=870, end_col_offset=96), Expr(value=Call(func=Attribute(value=Name(id='notes', ctx=Load(), lineno=871, col_offset=4, end_lineno=871, end_col_offset=9), attr='append', ctx=Load(), lineno=871, col_offset=4, end_lineno=871, end_col_offset=16), args=[JoinedStr(values=[Constant(value='XTR rescored ', lineno=871, col_offset=19, end_lineno=871, end_col_offset=32), FormattedValue(value=Call(func=Name(id='len', ctx=Load(), lineno=871, col_offset=33, end_lineno=871, end_col_offset=36), args=[Name(id='hits', ctx=Load(), lineno=871, col_offset=37, end_lineno=871, end_col_offset=41)], lineno=871, col_offset=33, end_lineno=871, end_col_offset=42), conversion=-1, lineno=871, col_offset=32, end_lineno=871, end_col_offset=43), Constant(value=' candidates.', lineno=871, col_offset=43, end_lineno=871, end_col_offset=55)], lineno=871, col_offset=17, end_lineno=871, end_col_offset=56)], lineno=871, col_offset=4, end_lineno=871, end_col_offset=57), lineno=871, col_offset=4, end_lineno=871, end_col_offset=57), Return(value=Tuple(elts=[Name(id='hits', ctx=Load(), lineno=872, col_offset=11, end_lineno=872, end_col_offset=15), Name(id='notes', ctx=Load(), lineno=872, col_offset=17, end_lineno=872, end_col_offset=22), Name(id='explain_payload', ctx=Load(), lineno=872, col_offset=24, end_lineno=872, end_col_offset=39)], ctx=Load(), lineno=872, col_offset=11, end_lineno=872, end_col_offset=39), lineno=872, col_offset=4, end_lineno=872, end_col_offset=39)], returns=Subscript(value=Name(id='tuple', ctx=Load(), lineno=846, col_offset=5, end_lineno=846, end_col_offset=10), slice=Tuple(elts=[Subscript(value=Name(id='list', ctx=Load(), lineno=846, col_offset=11, end_lineno=846, end_col_offset=15), slice=Subscript(value=Name(id='tuple', ctx=Load(), lineno=846, col_offset=16, end_lineno=846, end_col_offset=21), slice=Tuple(elts=[Name(id='int', ctx=Load(), lineno=846, col_offset=22, end_lineno=846, end_col_offset=25), Name(id='float', ctx=Load(), lineno=846, col_offset=27, end_lineno=846, end_col_offset=32)], ctx=Load(), lineno=846, col_offset=22, end_lineno=846, end_col_offset=32), ctx=Load(), lineno=846, col_offset=16, end_lineno=846, end_col_offset=33), ctx=Load(), lineno=846, col_offset=11, end_lineno=846, end_col_offset=34), Subscript(value=Name(id='list', ctx=Load(), lineno=846, col_offset=36, end_lineno=846, end_col_offset=40), slice=Name(id='str', ctx=Load(), lineno=846, col_offset=41, end_lineno=846, end_col_offset=44), ctx=Load(), lineno=846, col_offset=36, end_lineno=846, end_col_offset=45), Subscript(value=Name(id='list', ctx=Load(), lineno=846, col_offset=47, end_lineno=846, end_col_offset=51), slice=Subscript(value=Name(id='tuple', ctx=Load(), lineno=846, col_offset=52, end_lineno=846, end_col_offset=57), slice=Tuple(elts=[Name(id='int', ctx=Load(), lineno=846, col_offset=58, end_lineno=846, end_col_offset=61), Subscript(value=Name(id='dict', ctx=Load(), lineno=846, col_offset=63, end_lineno=846, end_col_offset=67), slice=Tuple(elts=[Name(id='str', ctx=Load(), lineno=846, col_offset=68, end_lineno=846, end_col_offset=71), Name(id='Any', ctx=Load(), lineno=846, col_offset=73, end_lineno=846, end_col_offset=76)], ctx=Load(), lineno=846, col_offset=68, end_lineno=846, end_col_offset=76), ctx=Load(), lineno=846, col_offset=63, end_lineno=846, end_col_offset=77)], ctx=Load(), lineno=846, col_offset=58, end_lineno=846, end_col_offset=77), ctx=Load(), lineno=846, col_offset=52, end_lineno=846, end_col_offset=78), ctx=Load(), lineno=846, col_offset=47, end_lineno=846, end_col_offset=79)], ctx=Load(), lineno=846, col_offset=11, end_lineno=846, end_col_offset=79), ctx=Load(), lineno=846, col_offset=5, end_lineno=846, end_col_offset=80), lineno=840, col_offset=0, end_lineno=872, end_col_offset=39), FunctionDef(name='_hydrate_records', args=arguments(kwonlyargs=[arg(arg='context', annotation=Name(id='ApplicationContext', ctx=Load(), lineno=877, col_offset=13, end_lineno=877, end_col_offset=31), lineno=877, col_offset=4, end_lineno=877, end_col_offset=31), arg(arg='chunk_ids', annotation=Subscript(value=Name(id='list', ctx=Load(), lineno=878, col_offset=15, end_lineno=878, end_col_offset=19), slice=Name(id='int', ctx=Load(), lineno=878, col_offset=20, end_lineno=878, end_col_offset=23), ctx=Load(), lineno=878, col_offset=15, end_lineno=878, end_col_offset=24), lineno=878, col_offset=4, end_lineno=878, end_col_offset=24), arg(arg='scope', annotation=BinOp(left=Name(id='ScopeIn', ctx=Load(), lineno=879, col_offset=11, end_lineno=879, end_col_offset=18), op=BitOr(), right=Constant(value=None, lineno=879, col_offset=21, end_lineno=879, end_col_offset=25), lineno=879, col_offset=11, end_lineno=879, end_col_offset=25), lineno=879, col_offset=4, end_lineno=879, end_col_offset=25)], kw_defaults=[None, None, None]), body=[If(test=UnaryOp(op=Not(), operand=Name(id='chunk_ids', ctx=Load(), lineno=881, col_offset=11, end_lineno=881, end_col_offset=20), lineno=881, col_offset=7, end_lineno=881, end_col_offset=20), body=[Return(value=List(ctx=Load(), lineno=882, col_offset=15, end_lineno=882, end_col_offset=17), lineno=882, col_offset=8, end_lineno=882, end_col_offset=17)], lineno=881, col_offset=4, end_lineno=882, end_col_offset=17), With(items=[withitem(context_expr=Call(func=Attribute(value=Name(id='context', ctx=Load(), lineno=884, col_offset=9, end_lineno=884, end_col_offset=16), attr='open_catalog', ctx=Load(), lineno=884, col_offset=9, end_lineno=884, end_col_offset=29), lineno=884, col_offset=9, end_lineno=884, end_col_offset=31), optional_vars=Name(id='catalog', ctx=Store(), lineno=884, col_offset=35, end_lineno=884, end_col_offset=42))], body=[Assign(targets=[Name(id='include_globs', ctx=Store(), lineno=885, col_offset=8, end_lineno=885, end_col_offset=21)], value=IfExp(test=Name(id='scope', ctx=Load(), lineno=885, col_offset=54, end_lineno=885, end_col_offset=59), body=Call(func=Attribute(value=Name(id='scope', ctx=Load(), lineno=885, col_offset=24, end_lineno=885, end_col_offset=29), attr='get', ctx=Load(), lineno=885, col_offset=24, end_lineno=885, end_col_offset=33), args=[Constant(value='include_globs', lineno=885, col_offset=34, end_lineno=885, end_col_offset=49)], lineno=885, col_offset=24, end_lineno=885, end_col_offset=50), orelse=Constant(value=None, lineno=885, col_offset=65, end_lineno=885, end_col_offset=69), lineno=885, col_offset=24, end_lineno=885, end_col_offset=69), lineno=885, col_offset=8, end_lineno=885, end_col_offset=69), Assign(targets=[Name(id='exclude_globs', ctx=Store(), lineno=886, col_offset=8, end_lineno=886, end_col_offset=21)], value=IfExp(test=Name(id='scope', ctx=Load(), lineno=886, col_offset=54, end_lineno=886, end_col_offset=59), body=Call(func=Attribute(value=Name(id='scope', ctx=Load(), lineno=886, col_offset=24, end_lineno=886, end_col_offset=29), attr='get', ctx=Load(), lineno=886, col_offset=24, end_lineno=886, end_col_offset=33), args=[Constant(value='exclude_globs', lineno=886, col_offset=34, end_lineno=886, end_col_offset=49)], lineno=886, col_offset=24, end_lineno=886, end_col_offset=50), orelse=Constant(value=None, lineno=886, col_offset=65, end_lineno=886, end_col_offset=69), lineno=886, col_offset=24, end_lineno=886, end_col_offset=69), lineno=886, col_offset=8, end_lineno=886, end_col_offset=69), Assign(targets=[Name(id='languages', ctx=Store(), lineno=887, col_offset=8, end_lineno=887, end_col_offset=17)], value=IfExp(test=Name(id='scope', ctx=Load(), lineno=887, col_offset=46, end_lineno=887, end_col_offset=51), body=Call(func=Attribute(value=Name(id='scope', ctx=Load(), lineno=887, col_offset=20, end_lineno=887, end_col_offset=25), attr='get', ctx=Load(), lineno=887, col_offset=20, end_lineno=887, end_col_offset=29), args=[Constant(value='languages', lineno=887, col_offset=30, end_lineno=887, end_col_offset=41)], lineno=887, col_offset=20, end_lineno=887, end_col_offset=42), orelse=Constant(value=None, lineno=887, col_offset=57, end_lineno=887, end_col_offset=61), lineno=887, col_offset=20, end_lineno=887, end_col_offset=61), lineno=887, col_offset=8, end_lineno=887, end_col_offset=61), Assign(targets=[Name(id='filters_active', ctx=Store(), lineno=888, col_offset=8, end_lineno=888, end_col_offset=22)], value=Call(func=Name(id='bool', ctx=Load(), lineno=888, col_offset=25, end_lineno=888, end_col_offset=29), args=[BoolOp(op=Or(), values=[Name(id='include_globs', ctx=Load(), lineno=888, col_offset=30, end_lineno=888, end_col_offset=43), Name(id='exclude_globs', ctx=Load(), lineno=888, col_offset=47, end_lineno=888, end_col_offset=60), Name(id='languages', ctx=Load(), lineno=888, col_offset=64, end_lineno=888, end_col_offset=73)], lineno=888, col_offset=30, end_lineno=888, end_col_offset=73)], lineno=888, col_offset=25, end_lineno=888, end_col_offset=74), lineno=888, col_offset=8, end_lineno=888, end_col_offset=74), If(test=Name(id='filters_active', ctx=Load(), lineno=889, col_offset=11, end_lineno=889, end_col_offset=25), body=[Return(value=Call(func=Attribute(value=Name(id='catalog', ctx=Load(), lineno=890, col_offset=19, end_lineno=890, end_col_offset=26), attr='query_by_filters', ctx=Load(), lineno=890, col_offset=19, end_lineno=890, end_col_offset=43), args=[Name(id='chunk_ids', ctx=Load(), lineno=891, col_offset=16, end_lineno=891, end_col_offset=25)], keywords=[keyword(arg='include_globs', value=Name(id='include_globs', ctx=Load(), lineno=892, col_offset=30, end_lineno=892, end_col_offset=43), lineno=892, col_offset=16, end_lineno=892, end_col_offset=43), keyword(arg='exclude_globs', value=Name(id='exclude_globs', ctx=Load(), lineno=893, col_offset=30, end_lineno=893, end_col_offset=43), lineno=893, col_offset=16, end_lineno=893, end_col_offset=43), keyword(arg='languages', value=Name(id='languages', ctx=Load(), lineno=894, col_offset=26, end_lineno=894, end_col_offset=35), lineno=894, col_offset=16, end_lineno=894, end_col_offset=35)], lineno=890, col_offset=19, end_lineno=895, end_col_offset=13), lineno=890, col_offset=12, end_lineno=895, end_col_offset=13)], lineno=889, col_offset=8, end_lineno=895, end_col_offset=13), Return(value=Call(func=Attribute(value=Name(id='catalog', ctx=Load(), lineno=896, col_offset=15, end_lineno=896, end_col_offset=22), attr='query_by_ids', ctx=Load(), lineno=896, col_offset=15, end_lineno=896, end_col_offset=35), args=[Name(id='chunk_ids', ctx=Load(), lineno=896, col_offset=36, end_lineno=896, end_col_offset=45)], lineno=896, col_offset=15, end_lineno=896, end_col_offset=46), lineno=896, col_offset=8, end_lineno=896, end_col_offset=46)], lineno=884, col_offset=4, end_lineno=896, end_col_offset=46)], returns=Subscript(value=Name(id='list', ctx=Load(), lineno=880, col_offset=5, end_lineno=880, end_col_offset=9), slice=Name(id='dict', ctx=Load(), lineno=880, col_offset=10, end_lineno=880, end_col_offset=14), ctx=Load(), lineno=880, col_offset=5, end_lineno=880, end_col_offset=15), lineno=875, col_offset=0, end_lineno=896, end_col_offset=46), FunctionDef(name='_hydrate_and_rerank_records', args=arguments(args=[arg(arg='plan', annotation=Name(id='HydrationPlan', ctx=Load(), lineno=899, col_offset=38, end_lineno=899, end_col_offset=51), lineno=899, col_offset=32, end_lineno=899, end_col_offset=51)]), body=[Expr(value=Constant(value='Hydrate DuckDB records and optionally rerank them using CodeRankLLM.\n\n    Returns\n    -------\n    tuple[list[dict], list[StageTiming]]\n        Hydrated records clipped to ``effective_limit`` and timing snapshots.\n\n    Raises\n    ------\n    VectorSearchError\n        Raised when DuckDB hydration fails even after retries.\n    ', lineno=900, col_offset=4, end_lineno=911, end_col_offset=7), lineno=900, col_offset=4, end_lineno=911, end_col_offset=7), Assign(targets=[Name(id='context', ctx=Store(), lineno=912, col_offset=4, end_lineno=912, end_col_offset=11)], value=Attribute(value=Name(id='plan', ctx=Load(), lineno=912, col_offset=14, end_lineno=912, end_col_offset=18), attr='context', ctx=Load(), lineno=912, col_offset=14, end_lineno=912, end_col_offset=26), lineno=912, col_offset=4, end_lineno=912, end_col_offset=26), Assign(targets=[Name(id='query', ctx=Store(), lineno=913, col_offset=4, end_lineno=913, end_col_offset=9)], value=Attribute(value=Name(id='plan', ctx=Load(), lineno=913, col_offset=12, end_lineno=913, end_col_offset=16), attr='query', ctx=Load(), lineno=913, col_offset=12, end_lineno=913, end_col_offset=22), lineno=913, col_offset=4, end_lineno=913, end_col_offset=22), Assign(targets=[Name(id='fused', ctx=Store(), lineno=914, col_offset=4, end_lineno=914, end_col_offset=9)], value=Attribute(value=Name(id='plan', ctx=Load(), lineno=914, col_offset=12, end_lineno=914, end_col_offset=16), attr='fused', ctx=Load(), lineno=914, col_offset=12, end_lineno=914, end_col_offset=22), lineno=914, col_offset=4, end_lineno=914, end_col_offset=22), Assign(targets=[Name(id='scope', ctx=Store(), lineno=915, col_offset=4, end_lineno=915, end_col_offset=9)], value=Attribute(value=Name(id='plan', ctx=Load(), lineno=915, col_offset=12, end_lineno=915, end_col_offset=16), attr='scope', ctx=Load(), lineno=915, col_offset=12, end_lineno=915, end_col_offset=22), lineno=915, col_offset=4, end_lineno=915, end_col_offset=22), Assign(targets=[Name(id='effective_limit', ctx=Store(), lineno=916, col_offset=4, end_lineno=916, end_col_offset=19)], value=Attribute(value=Name(id='plan', ctx=Load(), lineno=916, col_offset=22, end_lineno=916, end_col_offset=26), attr='effective_limit', ctx=Load(), lineno=916, col_offset=22, end_lineno=916, end_col_offset=42), lineno=916, col_offset=4, end_lineno=916, end_col_offset=42), Assign(targets=[Name(id='options', ctx=Store(), lineno=917, col_offset=4, end_lineno=917, end_col_offset=11)], value=Attribute(value=Name(id='plan', ctx=Load(), lineno=917, col_offset=14, end_lineno=917, end_col_offset=18), attr='options', ctx=Load(), lineno=917, col_offset=14, end_lineno=917, end_col_offset=26), lineno=917, col_offset=4, end_lineno=917, end_col_offset=26), Assign(targets=[Name(id='observation', ctx=Store(), lineno=918, col_offset=4, end_lineno=918, end_col_offset=15)], value=Attribute(value=Name(id='plan', ctx=Load(), lineno=918, col_offset=18, end_lineno=918, end_col_offset=22), attr='observation', ctx=Load(), lineno=918, col_offset=18, end_lineno=918, end_col_offset=34), lineno=918, col_offset=4, end_lineno=918, end_col_offset=34), Assign(targets=[Name(id='ordered_ids', ctx=Store(), lineno=919, col_offset=4, end_lineno=919, end_col_offset=15)], value=Call(func=Name(id='_dedupe_preserve_order', ctx=Load(), lineno=919, col_offset=18, end_lineno=919, end_col_offset=40), args=[ListComp(elt=Call(func=Name(id='_safe_int', ctx=Load(), lineno=919, col_offset=42, end_lineno=919, end_col_offset=51), args=[Attribute(value=Name(id='doc', ctx=Load(), lineno=919, col_offset=52, end_lineno=919, end_col_offset=55), attr='doc_id', ctx=Load(), lineno=919, col_offset=52, end_lineno=919, end_col_offset=62)], lineno=919, col_offset=42, end_lineno=919, end_col_offset=63), generators=[comprehension(target=Name(id='doc', ctx=Store(), lineno=919, col_offset=68, end_lineno=919, end_col_offset=71), iter=Attribute(value=Name(id='fused', ctx=Load(), lineno=919, col_offset=75, end_lineno=919, end_col_offset=80), attr='docs', ctx=Load(), lineno=919, col_offset=75, end_lineno=919, end_col_offset=85), is_async=0)], lineno=919, col_offset=41, end_lineno=919, end_col_offset=86)], lineno=919, col_offset=18, end_lineno=919, end_col_offset=87), lineno=919, col_offset=4, end_lineno=919, end_col_offset=87), Try(body=[With(items=[withitem(context_expr=Call(func=Name(id='track_stage', ctx=Load(), lineno=921, col_offset=13, end_lineno=921, end_col_offset=24), args=[Constant(value='duckdb_hydration', lineno=921, col_offset=25, end_lineno=921, end_col_offset=43)], lineno=921, col_offset=13, end_lineno=921, end_col_offset=44), optional_vars=Name(id='hydration_timer', ctx=Store(), lineno=921, col_offset=48, end_lineno=921, end_col_offset=63))], body=[Assign(targets=[Name(id='records', ctx=Store(), lineno=922, col_offset=12, end_lineno=922, end_col_offset=19)], value=Call(func=Name(id='_hydrate_records', ctx=Load(), lineno=922, col_offset=22, end_lineno=922, end_col_offset=38), keywords=[keyword(arg='context', value=Name(id='context', ctx=Load(), lineno=923, col_offset=24, end_lineno=923, end_col_offset=31), lineno=923, col_offset=16, end_lineno=923, end_col_offset=31), keyword(arg='chunk_ids', value=Subscript(value=Name(id='ordered_ids', ctx=Load(), lineno=924, col_offset=26, end_lineno=924, end_col_offset=37), slice=Slice(upper=Call(func=Name(id='min', ctx=Load(), lineno=925, col_offset=22, end_lineno=925, end_col_offset=25), args=[Call(func=Name(id='len', ctx=Load(), lineno=925, col_offset=26, end_lineno=925, end_col_offset=29), args=[Name(id='ordered_ids', ctx=Load(), lineno=925, col_offset=30, end_lineno=925, end_col_offset=41)], lineno=925, col_offset=26, end_lineno=925, end_col_offset=42), Call(func=Name(id='max', ctx=Load(), lineno=925, col_offset=44, end_lineno=925, end_col_offset=47), args=[BinOp(left=Name(id='effective_limit', ctx=Load(), lineno=925, col_offset=48, end_lineno=925, end_col_offset=63), op=Mult(), right=Constant(value=2, lineno=925, col_offset=66, end_lineno=925, end_col_offset=67), lineno=925, col_offset=48, end_lineno=925, end_col_offset=67), Name(id='effective_limit', ctx=Load(), lineno=925, col_offset=69, end_lineno=925, end_col_offset=84)], lineno=925, col_offset=44, end_lineno=925, end_col_offset=85)], lineno=925, col_offset=22, end_lineno=925, end_col_offset=86), lineno=925, col_offset=20, end_lineno=925, end_col_offset=86), ctx=Load(), lineno=924, col_offset=26, end_lineno=926, end_col_offset=17), lineno=924, col_offset=16, end_lineno=926, end_col_offset=17), keyword(arg='scope', value=Name(id='scope', ctx=Load(), lineno=927, col_offset=22, end_lineno=927, end_col_offset=27), lineno=927, col_offset=16, end_lineno=927, end_col_offset=27)], lineno=922, col_offset=22, end_lineno=928, end_col_offset=13), lineno=922, col_offset=12, end_lineno=928, end_col_offset=13)], lineno=921, col_offset=8, end_lineno=928, end_col_offset=13), Assign(targets=[Name(id='snapshots', ctx=Store(), lineno=929, col_offset=8, end_lineno=929, end_col_offset=17)], value=List(elts=[Call(func=Attribute(value=Name(id='hydration_timer', ctx=Load(), lineno=929, col_offset=21, end_lineno=929, end_col_offset=36), attr='snapshot', ctx=Load(), lineno=929, col_offset=21, end_lineno=929, end_col_offset=45), lineno=929, col_offset=21, end_lineno=929, end_col_offset=47)], ctx=Load(), lineno=929, col_offset=20, end_lineno=929, end_col_offset=48), lineno=929, col_offset=8, end_lineno=929, end_col_offset=48)], handlers=[ExceptHandler(type=Tuple(elts=[Name(id='RuntimeError', ctx=Load(), lineno=930, col_offset=12, end_lineno=930, end_col_offset=24), Name(id='OSError', ctx=Load(), lineno=930, col_offset=26, end_lineno=930, end_col_offset=33)], ctx=Load(), lineno=930, col_offset=11, end_lineno=930, end_col_offset=34), name='exc', body=[Expr(value=Call(func=Attribute(value=Name(id='observation', ctx=Load(), lineno=931, col_offset=8, end_lineno=931, end_col_offset=19), attr='mark_error', ctx=Load(), lineno=931, col_offset=8, end_lineno=931, end_col_offset=30), lineno=931, col_offset=8, end_lineno=931, end_col_offset=32), lineno=931, col_offset=8, end_lineno=931, end_col_offset=32), Assign(targets=[Name(id='msg', ctx=Store(), lineno=932, col_offset=8, end_lineno=932, end_col_offset=11)], value=Constant(value='DuckDB hydration failed', lineno=932, col_offset=14, end_lineno=932, end_col_offset=39), lineno=932, col_offset=8, end_lineno=932, end_col_offset=39), Raise(exc=Call(func=Name(id='VectorSearchError', ctx=Load(), lineno=933, col_offset=14, end_lineno=933, end_col_offset=31), args=[Name(id='msg', ctx=Load(), lineno=933, col_offset=32, end_lineno=933, end_col_offset=35)], keywords=[keyword(arg='cause', value=Name(id='exc', ctx=Load(), lineno=933, col_offset=43, end_lineno=933, end_col_offset=46), lineno=933, col_offset=37, end_lineno=933, end_col_offset=46)], lineno=933, col_offset=14, end_lineno=933, end_col_offset=47), cause=Name(id='exc', ctx=Load(), lineno=933, col_offset=53, end_lineno=933, end_col_offset=56), lineno=933, col_offset=8, end_lineno=933, end_col_offset=56)], lineno=930, col_offset=4, end_lineno=933, end_col_offset=56)], lineno=920, col_offset=4, end_lineno=933, end_col_offset=56), Assign(targets=[Name(id='rerank_cfg', ctx=Store(), lineno=935, col_offset=4, end_lineno=935, end_col_offset=14)], value=Attribute(value=Attribute(value=Name(id='context', ctx=Load(), lineno=935, col_offset=17, end_lineno=935, end_col_offset=24), attr='settings', ctx=Load(), lineno=935, col_offset=17, end_lineno=935, end_col_offset=33), attr='coderank_llm', ctx=Load(), lineno=935, col_offset=17, end_lineno=935, end_col_offset=46), lineno=935, col_offset=4, end_lineno=935, end_col_offset=46), Assign(targets=[Name(id='rerank_stage_name', ctx=Store(), lineno=936, col_offset=4, end_lineno=936, end_col_offset=21)], value=Constant(value='coderank_llm', lineno=936, col_offset=24, end_lineno=936, end_col_offset=38), lineno=936, col_offset=4, end_lineno=936, end_col_offset=38), If(test=UnaryOp(op=Not(), operand=Attribute(value=Name(id='options', ctx=Load(), lineno=937, col_offset=11, end_lineno=937, end_col_offset=18), attr='use_reranker', ctx=Load(), lineno=937, col_offset=11, end_lineno=937, end_col_offset=31), lineno=937, col_offset=7, end_lineno=937, end_col_offset=31), body=[Expr(value=Call(func=Name(id='record_stage_decision', ctx=Load(), lineno=938, col_offset=8, end_lineno=938, end_col_offset=29), args=[Name(id='COMPONENT_NAME', ctx=Load(), lineno=939, col_offset=12, end_lineno=939, end_col_offset=26), Name(id='rerank_stage_name', ctx=Load(), lineno=940, col_offset=12, end_lineno=940, end_col_offset=29)], keywords=[keyword(arg='decision', value=Call(func=Name(id='StageDecision', ctx=Load(), lineno=941, col_offset=21, end_lineno=941, end_col_offset=34), keywords=[keyword(arg='should_run', value=Constant(value=False, lineno=941, col_offset=46, end_lineno=941, end_col_offset=51), lineno=941, col_offset=35, end_lineno=941, end_col_offset=51), keyword(arg='reason', value=Constant(value='disabled_option', lineno=941, col_offset=60, end_lineno=941, end_col_offset=77), lineno=941, col_offset=53, end_lineno=941, end_col_offset=77)], lineno=941, col_offset=21, end_lineno=941, end_col_offset=78), lineno=941, col_offset=12, end_lineno=941, end_col_offset=78)], lineno=938, col_offset=8, end_lineno=942, end_col_offset=9), lineno=938, col_offset=8, end_lineno=942, end_col_offset=9)], orelse=[If(test=UnaryOp(op=Not(), operand=Attribute(value=Name(id='rerank_cfg', ctx=Load(), lineno=943, col_offset=13, end_lineno=943, end_col_offset=23), attr='enabled', ctx=Load(), lineno=943, col_offset=13, end_lineno=943, end_col_offset=31), lineno=943, col_offset=9, end_lineno=943, end_col_offset=31), body=[Expr(value=Call(func=Name(id='record_stage_decision', ctx=Load(), lineno=944, col_offset=8, end_lineno=944, end_col_offset=29), args=[Name(id='COMPONENT_NAME', ctx=Load(), lineno=945, col_offset=12, end_lineno=945, end_col_offset=26), Name(id='rerank_stage_name', ctx=Load(), lineno=946, col_offset=12, end_lineno=946, end_col_offset=29)], keywords=[keyword(arg='decision', value=Call(func=Name(id='StageDecision', ctx=Load(), lineno=947, col_offset=21, end_lineno=947, end_col_offset=34), keywords=[keyword(arg='should_run', value=Constant(value=False, lineno=947, col_offset=46, end_lineno=947, end_col_offset=51), lineno=947, col_offset=35, end_lineno=947, end_col_offset=51), keyword(arg='reason', value=Constant(value='disabled_config', lineno=947, col_offset=60, end_lineno=947, end_col_offset=77), lineno=947, col_offset=53, end_lineno=947, end_col_offset=77)], lineno=947, col_offset=21, end_lineno=947, end_col_offset=78), lineno=947, col_offset=12, end_lineno=947, end_col_offset=78)], lineno=944, col_offset=8, end_lineno=948, end_col_offset=9), lineno=944, col_offset=8, end_lineno=948, end_col_offset=9)], orelse=[If(test=UnaryOp(op=Not(), operand=Name(id='records', ctx=Load(), lineno=949, col_offset=13, end_lineno=949, end_col_offset=20), lineno=949, col_offset=9, end_lineno=949, end_col_offset=20), body=[Expr(value=Call(func=Name(id='record_stage_decision', ctx=Load(), lineno=950, col_offset=8, end_lineno=950, end_col_offset=29), args=[Name(id='COMPONENT_NAME', ctx=Load(), lineno=951, col_offset=12, end_lineno=951, end_col_offset=26), Name(id='rerank_stage_name', ctx=Load(), lineno=952, col_offset=12, end_lineno=952, end_col_offset=29)], keywords=[keyword(arg='decision', value=Call(func=Name(id='StageDecision', ctx=Load(), lineno=953, col_offset=21, end_lineno=953, end_col_offset=34), keywords=[keyword(arg='should_run', value=Constant(value=False, lineno=953, col_offset=46, end_lineno=953, end_col_offset=51), lineno=953, col_offset=35, end_lineno=953, end_col_offset=51), keyword(arg='reason', value=Constant(value='no_candidates', lineno=953, col_offset=60, end_lineno=953, end_col_offset=75), lineno=953, col_offset=53, end_lineno=953, end_col_offset=75)], lineno=953, col_offset=21, end_lineno=953, end_col_offset=76), lineno=953, col_offset=12, end_lineno=953, end_col_offset=76)], lineno=950, col_offset=8, end_lineno=954, end_col_offset=9), lineno=950, col_offset=8, end_lineno=954, end_col_offset=9)], orelse=[With(items=[withitem(context_expr=Call(func=Name(id='track_stage', ctx=Load(), lineno=956, col_offset=13, end_lineno=956, end_col_offset=24), args=[Name(id='rerank_stage_name', ctx=Load(), lineno=957, col_offset=12, end_lineno=957, end_col_offset=29)], keywords=[keyword(arg='budget_ms', value=Attribute(value=Name(id='rerank_cfg', ctx=Load(), lineno=958, col_offset=22, end_lineno=958, end_col_offset=32), attr='budget_ms', ctx=Load(), lineno=958, col_offset=22, end_lineno=958, end_col_offset=42), lineno=958, col_offset=12, end_lineno=958, end_col_offset=42)], lineno=956, col_offset=13, end_lineno=959, end_col_offset=9), optional_vars=Name(id='rerank_timer', ctx=Store(), lineno=959, col_offset=13, end_lineno=959, end_col_offset=25))], body=[Assign(targets=[Name(id='records', ctx=Store(), lineno=960, col_offset=12, end_lineno=960, end_col_offset=19)], value=Call(func=Name(id='_maybe_rerank', ctx=Load(), lineno=960, col_offset=22, end_lineno=960, end_col_offset=35), keywords=[keyword(arg='query', value=Name(id='query', ctx=Load(), lineno=961, col_offset=22, end_lineno=961, end_col_offset=27), lineno=961, col_offset=16, end_lineno=961, end_col_offset=27), keyword(arg='records', value=Name(id='records', ctx=Load(), lineno=962, col_offset=24, end_lineno=962, end_col_offset=31), lineno=962, col_offset=16, end_lineno=962, end_col_offset=31), keyword(arg='context', value=Name(id='context', ctx=Load(), lineno=963, col_offset=24, end_lineno=963, end_col_offset=31), lineno=963, col_offset=16, end_lineno=963, end_col_offset=31), keyword(arg='enabled', value=Constant(value=True, lineno=964, col_offset=24, end_lineno=964, end_col_offset=28), lineno=964, col_offset=16, end_lineno=964, end_col_offset=28)], lineno=960, col_offset=22, end_lineno=965, end_col_offset=13), lineno=960, col_offset=12, end_lineno=965, end_col_offset=13)], lineno=956, col_offset=8, end_lineno=965, end_col_offset=13), Expr(value=Call(func=Attribute(value=Name(id='snapshots', ctx=Load(), lineno=966, col_offset=8, end_lineno=966, end_col_offset=17), attr='append', ctx=Load(), lineno=966, col_offset=8, end_lineno=966, end_col_offset=24), args=[Call(func=Attribute(value=Name(id='rerank_timer', ctx=Load(), lineno=966, col_offset=25, end_lineno=966, end_col_offset=37), attr='snapshot', ctx=Load(), lineno=966, col_offset=25, end_lineno=966, end_col_offset=46), lineno=966, col_offset=25, end_lineno=966, end_col_offset=48)], lineno=966, col_offset=8, end_lineno=966, end_col_offset=49), lineno=966, col_offset=8, end_lineno=966, end_col_offset=49), Expr(value=Call(func=Name(id='record_stage_decision', ctx=Load(), lineno=967, col_offset=8, end_lineno=967, end_col_offset=29), args=[Name(id='COMPONENT_NAME', ctx=Load(), lineno=968, col_offset=12, end_lineno=968, end_col_offset=26), Name(id='rerank_stage_name', ctx=Load(), lineno=969, col_offset=12, end_lineno=969, end_col_offset=29)], keywords=[keyword(arg='decision', value=Call(func=Name(id='StageDecision', ctx=Load(), lineno=970, col_offset=21, end_lineno=970, end_col_offset=34), keywords=[keyword(arg='should_run', value=Constant(value=True, lineno=970, col_offset=46, end_lineno=970, end_col_offset=50), lineno=970, col_offset=35, end_lineno=970, end_col_offset=50), keyword(arg='reason', value=Constant(value='executed', lineno=970, col_offset=59, end_lineno=970, end_col_offset=69), lineno=970, col_offset=52, end_lineno=970, end_col_offset=69)], lineno=970, col_offset=21, end_lineno=970, end_col_offset=70), lineno=970, col_offset=12, end_lineno=970, end_col_offset=70)], lineno=967, col_offset=8, end_lineno=971, end_col_offset=9), lineno=967, col_offset=8, end_lineno=971, end_col_offset=9)], lineno=949, col_offset=4, end_lineno=971, end_col_offset=9)], lineno=943, col_offset=4, end_lineno=971, end_col_offset=9)], lineno=937, col_offset=4, end_lineno=971, end_col_offset=9), Return(value=Tuple(elts=[Subscript(value=Name(id='records', ctx=Load(), lineno=973, col_offset=11, end_lineno=973, end_col_offset=18), slice=Slice(upper=Name(id='effective_limit', ctx=Load(), lineno=973, col_offset=20, end_lineno=973, end_col_offset=35), lineno=973, col_offset=19, end_lineno=973, end_col_offset=35), ctx=Load(), lineno=973, col_offset=11, end_lineno=973, end_col_offset=36), Name(id='snapshots', ctx=Load(), lineno=973, col_offset=38, end_lineno=973, end_col_offset=47)], ctx=Load(), lineno=973, col_offset=11, end_lineno=973, end_col_offset=47), lineno=973, col_offset=4, end_lineno=973, end_col_offset=47)], returns=Subscript(value=Name(id='tuple', ctx=Load(), lineno=899, col_offset=56, end_lineno=899, end_col_offset=61), slice=Tuple(elts=[Subscript(value=Name(id='list', ctx=Load(), lineno=899, col_offset=62, end_lineno=899, end_col_offset=66), slice=Name(id='dict', ctx=Load(), lineno=899, col_offset=67, end_lineno=899, end_col_offset=71), ctx=Load(), lineno=899, col_offset=62, end_lineno=899, end_col_offset=72), Subscript(value=Name(id='list', ctx=Load(), lineno=899, col_offset=74, end_lineno=899, end_col_offset=78), slice=Name(id='StageTiming', ctx=Load(), lineno=899, col_offset=79, end_lineno=899, end_col_offset=90), ctx=Load(), lineno=899, col_offset=74, end_lineno=899, end_col_offset=91)], ctx=Load(), lineno=899, col_offset=62, end_lineno=899, end_col_offset=91), ctx=Load(), lineno=899, col_offset=56, end_lineno=899, end_col_offset=92), lineno=899, col_offset=0, end_lineno=973, end_col_offset=47), FunctionDef(name='_maybe_rerank', args=arguments(kwonlyargs=[arg(arg='query', annotation=Name(id='str', ctx=Load(), lineno=978, col_offset=11, end_lineno=978, end_col_offset=14), lineno=978, col_offset=4, end_lineno=978, end_col_offset=14), arg(arg='records', annotation=Subscript(value=Name(id='list', ctx=Load(), lineno=979, col_offset=13, end_lineno=979, end_col_offset=17), slice=Name(id='dict', ctx=Load(), lineno=979, col_offset=18, end_lineno=979, end_col_offset=22), ctx=Load(), lineno=979, col_offset=13, end_lineno=979, end_col_offset=23), lineno=979, col_offset=4, end_lineno=979, end_col_offset=23), arg(arg='context', annotation=Name(id='ApplicationContext', ctx=Load(), lineno=980, col_offset=13, end_lineno=980, end_col_offset=31), lineno=980, col_offset=4, end_lineno=980, end_col_offset=31), arg(arg='enabled', annotation=Name(id='bool', ctx=Load(), lineno=981, col_offset=13, end_lineno=981, end_col_offset=17), lineno=981, col_offset=4, end_lineno=981, end_col_offset=17)], kw_defaults=[None, None, None, None]), body=[Assign(targets=[Name(id='cfg', ctx=Store(), lineno=983, col_offset=4, end_lineno=983, end_col_offset=7)], value=Attribute(value=Attribute(value=Name(id='context', ctx=Load(), lineno=983, col_offset=10, end_lineno=983, end_col_offset=17), attr='settings', ctx=Load(), lineno=983, col_offset=10, end_lineno=983, end_col_offset=26), attr='coderank_llm', ctx=Load(), lineno=983, col_offset=10, end_lineno=983, end_col_offset=39), lineno=983, col_offset=4, end_lineno=983, end_col_offset=39), If(test=BoolOp(op=Or(), values=[UnaryOp(op=Not(), operand=Name(id='enabled', ctx=Load(), lineno=984, col_offset=11, end_lineno=984, end_col_offset=18), lineno=984, col_offset=7, end_lineno=984, end_col_offset=18), UnaryOp(op=Not(), operand=Attribute(value=Name(id='cfg', ctx=Load(), lineno=984, col_offset=26, end_lineno=984, end_col_offset=29), attr='enabled', ctx=Load(), lineno=984, col_offset=26, end_lineno=984, end_col_offset=37), lineno=984, col_offset=22, end_lineno=984, end_col_offset=37), UnaryOp(op=Not(), operand=Name(id='records', ctx=Load(), lineno=984, col_offset=45, end_lineno=984, end_col_offset=52), lineno=984, col_offset=41, end_lineno=984, end_col_offset=52)], lineno=984, col_offset=7, end_lineno=984, end_col_offset=52), body=[Return(value=Name(id='records', ctx=Load(), lineno=985, col_offset=15, end_lineno=985, end_col_offset=22), lineno=985, col_offset=8, end_lineno=985, end_col_offset=22)], lineno=984, col_offset=4, end_lineno=985, end_col_offset=22), Assign(targets=[Name(id='reranker', ctx=Store(), lineno=987, col_offset=4, end_lineno=987, end_col_offset=12)], value=Call(func=Name(id='CodeRankListwiseReranker', ctx=Load(), lineno=987, col_offset=15, end_lineno=987, end_col_offset=39), keywords=[keyword(arg='model_id', value=Attribute(value=Name(id='cfg', ctx=Load(), lineno=988, col_offset=17, end_lineno=988, end_col_offset=20), attr='model_id', ctx=Load(), lineno=988, col_offset=17, end_lineno=988, end_col_offset=29), lineno=988, col_offset=8, end_lineno=988, end_col_offset=29), keyword(arg='device', value=Attribute(value=Name(id='cfg', ctx=Load(), lineno=989, col_offset=15, end_lineno=989, end_col_offset=18), attr='device', ctx=Load(), lineno=989, col_offset=15, end_lineno=989, end_col_offset=25), lineno=989, col_offset=8, end_lineno=989, end_col_offset=25), keyword(arg='max_new_tokens', value=Attribute(value=Name(id='cfg', ctx=Load(), lineno=990, col_offset=23, end_lineno=990, end_col_offset=26), attr='max_new_tokens', ctx=Load(), lineno=990, col_offset=23, end_lineno=990, end_col_offset=41), lineno=990, col_offset=8, end_lineno=990, end_col_offset=41), keyword(arg='temperature', value=Attribute(value=Name(id='cfg', ctx=Load(), lineno=991, col_offset=20, end_lineno=991, end_col_offset=23), attr='temperature', ctx=Load(), lineno=991, col_offset=20, end_lineno=991, end_col_offset=35), lineno=991, col_offset=8, end_lineno=991, end_col_offset=35), keyword(arg='top_p', value=Attribute(value=Name(id='cfg', ctx=Load(), lineno=992, col_offset=14, end_lineno=992, end_col_offset=17), attr='top_p', ctx=Load(), lineno=992, col_offset=14, end_lineno=992, end_col_offset=23), lineno=992, col_offset=8, end_lineno=992, end_col_offset=23)], lineno=987, col_offset=15, end_lineno=993, end_col_offset=5), lineno=987, col_offset=4, end_lineno=993, end_col_offset=5), Assign(targets=[Name(id='payload', ctx=Store(), lineno=995, col_offset=4, end_lineno=995, end_col_offset=11)], value=ListComp(elt=Tuple(elts=[Call(func=Name(id='int', ctx=Load(), lineno=997, col_offset=12, end_lineno=997, end_col_offset=15), args=[Call(func=Attribute(value=Name(id='record', ctx=Load(), lineno=997, col_offset=16, end_lineno=997, end_col_offset=22), attr='get', ctx=Load(), lineno=997, col_offset=16, end_lineno=997, end_col_offset=26), args=[Constant(value='id', lineno=997, col_offset=27, end_lineno=997, end_col_offset=31), UnaryOp(op=USub(), operand=Constant(value=1, lineno=997, col_offset=34, end_lineno=997, end_col_offset=35), lineno=997, col_offset=33, end_lineno=997, end_col_offset=35)], lineno=997, col_offset=16, end_lineno=997, end_col_offset=36)], lineno=997, col_offset=12, end_lineno=997, end_col_offset=37), BoolOp(op=Or(), values=[Call(func=Attribute(value=Name(id='record', ctx=Load(), lineno=998, col_offset=13, end_lineno=998, end_col_offset=19), attr='get', ctx=Load(), lineno=998, col_offset=13, end_lineno=998, end_col_offset=23), args=[Constant(value='content', lineno=998, col_offset=24, end_lineno=998, end_col_offset=33)], lineno=998, col_offset=13, end_lineno=998, end_col_offset=34), Call(func=Attribute(value=Name(id='record', ctx=Load(), lineno=998, col_offset=38, end_lineno=998, end_col_offset=44), attr='get', ctx=Load(), lineno=998, col_offset=38, end_lineno=998, end_col_offset=48), args=[Constant(value='preview', lineno=998, col_offset=49, end_lineno=998, end_col_offset=58)], lineno=998, col_offset=38, end_lineno=998, end_col_offset=59), Constant(value='', lineno=998, col_offset=63, end_lineno=998, end_col_offset=65)], lineno=998, col_offset=13, end_lineno=998, end_col_offset=65)], ctx=Load(), lineno=996, col_offset=8, end_lineno=999, end_col_offset=9), generators=[comprehension(target=Name(id='record', ctx=Store(), lineno=1000, col_offset=12, end_lineno=1000, end_col_offset=18), iter=Name(id='records', ctx=Load(), lineno=1000, col_offset=22, end_lineno=1000, end_col_offset=29), is_async=0)], lineno=995, col_offset=14, end_lineno=1001, end_col_offset=5), lineno=995, col_offset=4, end_lineno=1001, end_col_offset=5), Assign(targets=[Name(id='payload', ctx=Store(), lineno=1002, col_offset=4, end_lineno=1002, end_col_offset=11)], value=ListComp(elt=Tuple(elts=[Name(id='cid', ctx=Load(), lineno=1002, col_offset=16, end_lineno=1002, end_col_offset=19), Name(id='text', ctx=Load(), lineno=1002, col_offset=21, end_lineno=1002, end_col_offset=25)], ctx=Load(), lineno=1002, col_offset=15, end_lineno=1002, end_col_offset=26), generators=[comprehension(target=Tuple(elts=[Name(id='cid', ctx=Store(), lineno=1002, col_offset=31, end_lineno=1002, end_col_offset=34), Name(id='text', ctx=Store(), lineno=1002, col_offset=36, end_lineno=1002, end_col_offset=40)], ctx=Store(), lineno=1002, col_offset=31, end_lineno=1002, end_col_offset=40), iter=Name(id='payload', ctx=Load(), lineno=1002, col_offset=44, end_lineno=1002, end_col_offset=51), ifs=[Compare(left=Name(id='cid', ctx=Load(), lineno=1002, col_offset=55, end_lineno=1002, end_col_offset=58), ops=[GtE()], comparators=[Constant(value=0, lineno=1002, col_offset=62, end_lineno=1002, end_col_offset=63)], lineno=1002, col_offset=55, end_lineno=1002, end_col_offset=63)], is_async=0)], lineno=1002, col_offset=14, end_lineno=1002, end_col_offset=64), lineno=1002, col_offset=4, end_lineno=1002, end_col_offset=64), If(test=UnaryOp(op=Not(), operand=Name(id='payload', ctx=Load(), lineno=1003, col_offset=11, end_lineno=1003, end_col_offset=18), lineno=1003, col_offset=7, end_lineno=1003, end_col_offset=18), body=[Return(value=Name(id='records', ctx=Load(), lineno=1004, col_offset=15, end_lineno=1004, end_col_offset=22), lineno=1004, col_offset=8, end_lineno=1004, end_col_offset=22)], lineno=1003, col_offset=4, end_lineno=1004, end_col_offset=22), Try(body=[Assign(targets=[Name(id='ordered_ids', ctx=Store(), lineno=1007, col_offset=8, end_lineno=1007, end_col_offset=19)], value=Call(func=Attribute(value=Name(id='reranker', ctx=Load(), lineno=1007, col_offset=22, end_lineno=1007, end_col_offset=30), attr='rerank', ctx=Load(), lineno=1007, col_offset=22, end_lineno=1007, end_col_offset=37), args=[Name(id='query', ctx=Load(), lineno=1007, col_offset=38, end_lineno=1007, end_col_offset=43), Name(id='payload', ctx=Load(), lineno=1007, col_offset=45, end_lineno=1007, end_col_offset=52)], lineno=1007, col_offset=22, end_lineno=1007, end_col_offset=53), lineno=1007, col_offset=8, end_lineno=1007, end_col_offset=53)], handlers=[ExceptHandler(type=Name(id='RuntimeError', ctx=Load(), lineno=1008, col_offset=11, end_lineno=1008, end_col_offset=23), name='exc', body=[Expr(value=Call(func=Attribute(value=Name(id='LOGGER', ctx=Load(), lineno=1009, col_offset=8, end_lineno=1009, end_col_offset=14), attr='warning', ctx=Load(), lineno=1009, col_offset=8, end_lineno=1009, end_col_offset=22), args=[Constant(value='CodeRank reranker failed; continuing without rerank.', lineno=1010, col_offset=12, end_lineno=1010, end_col_offset=66)], keywords=[keyword(arg='extra', value=Dict(keys=[Constant(value='error', lineno=1011, col_offset=19, end_lineno=1011, end_col_offset=26)], values=[Call(func=Name(id='str', ctx=Load(), lineno=1011, col_offset=28, end_lineno=1011, end_col_offset=31), args=[Name(id='exc', ctx=Load(), lineno=1011, col_offset=32, end_lineno=1011, end_col_offset=35)], lineno=1011, col_offset=28, end_lineno=1011, end_col_offset=36)], lineno=1011, col_offset=18, end_lineno=1011, end_col_offset=37), lineno=1011, col_offset=12, end_lineno=1011, end_col_offset=37)], lineno=1009, col_offset=8, end_lineno=1012, end_col_offset=9), lineno=1009, col_offset=8, end_lineno=1012, end_col_offset=9), Return(value=Name(id='records', ctx=Load(), lineno=1013, col_offset=15, end_lineno=1013, end_col_offset=22), lineno=1013, col_offset=8, end_lineno=1013, end_col_offset=22)], lineno=1008, col_offset=4, end_lineno=1013, end_col_offset=22)], lineno=1006, col_offset=4, end_lineno=1013, end_col_offset=22), Assign(targets=[Name(id='by_id', ctx=Store(), lineno=1015, col_offset=4, end_lineno=1015, end_col_offset=9)], value=DictComp(key=Call(func=Name(id='int', ctx=Load(), lineno=1015, col_offset=13, end_lineno=1015, end_col_offset=16), args=[Subscript(value=Name(id='record', ctx=Load(), lineno=1015, col_offset=17, end_lineno=1015, end_col_offset=23), slice=Constant(value='id', lineno=1015, col_offset=24, end_lineno=1015, end_col_offset=28), ctx=Load(), lineno=1015, col_offset=17, end_lineno=1015, end_col_offset=29)], lineno=1015, col_offset=13, end_lineno=1015, end_col_offset=30), value=Name(id='record', ctx=Load(), lineno=1015, col_offset=32, end_lineno=1015, end_col_offset=38), generators=[comprehension(target=Name(id='record', ctx=Store(), lineno=1015, col_offset=43, end_lineno=1015, end_col_offset=49), iter=Name(id='records', ctx=Load(), lineno=1015, col_offset=53, end_lineno=1015, end_col_offset=60), ifs=[Compare(left=Constant(value='id', lineno=1015, col_offset=64, end_lineno=1015, end_col_offset=68), ops=[In()], comparators=[Name(id='record', ctx=Load(), lineno=1015, col_offset=72, end_lineno=1015, end_col_offset=78)], lineno=1015, col_offset=64, end_lineno=1015, end_col_offset=78)], is_async=0)], lineno=1015, col_offset=12, end_lineno=1015, end_col_offset=79), lineno=1015, col_offset=4, end_lineno=1015, end_col_offset=79), Assign(targets=[Name(id='reordered', ctx=Store(), lineno=1016, col_offset=4, end_lineno=1016, end_col_offset=13)], value=ListComp(elt=Subscript(value=Name(id='by_id', ctx=Load(), lineno=1016, col_offset=17, end_lineno=1016, end_col_offset=22), slice=Name(id='cid', ctx=Load(), lineno=1016, col_offset=23, end_lineno=1016, end_col_offset=26), ctx=Load(), lineno=1016, col_offset=17, end_lineno=1016, end_col_offset=27), generators=[comprehension(target=Name(id='cid', ctx=Store(), lineno=1016, col_offset=32, end_lineno=1016, end_col_offset=35), iter=Name(id='ordered_ids', ctx=Load(), lineno=1016, col_offset=39, end_lineno=1016, end_col_offset=50), ifs=[Compare(left=Name(id='cid', ctx=Load(), lineno=1016, col_offset=54, end_lineno=1016, end_col_offset=57), ops=[In()], comparators=[Name(id='by_id', ctx=Load(), lineno=1016, col_offset=61, end_lineno=1016, end_col_offset=66)], lineno=1016, col_offset=54, end_lineno=1016, end_col_offset=66)], is_async=0)], lineno=1016, col_offset=16, end_lineno=1016, end_col_offset=67), lineno=1016, col_offset=4, end_lineno=1016, end_col_offset=67), Assign(targets=[Name(id='remaining', ctx=Store(), lineno=1017, col_offset=4, end_lineno=1017, end_col_offset=13)], value=ListComp(elt=Name(id='record', ctx=Load(), lineno=1017, col_offset=17, end_lineno=1017, end_col_offset=23), generators=[comprehension(target=Name(id='record', ctx=Store(), lineno=1017, col_offset=28, end_lineno=1017, end_col_offset=34), iter=Name(id='records', ctx=Load(), lineno=1017, col_offset=38, end_lineno=1017, end_col_offset=45), ifs=[Compare(left=Call(func=Name(id='int', ctx=Load(), lineno=1017, col_offset=49, end_lineno=1017, end_col_offset=52), args=[Call(func=Attribute(value=Name(id='record', ctx=Load(), lineno=1017, col_offset=53, end_lineno=1017, end_col_offset=59), attr='get', ctx=Load(), lineno=1017, col_offset=53, end_lineno=1017, end_col_offset=63), args=[Constant(value='id', lineno=1017, col_offset=64, end_lineno=1017, end_col_offset=68), UnaryOp(op=USub(), operand=Constant(value=1, lineno=1017, col_offset=71, end_lineno=1017, end_col_offset=72), lineno=1017, col_offset=70, end_lineno=1017, end_col_offset=72)], lineno=1017, col_offset=53, end_lineno=1017, end_col_offset=73)], lineno=1017, col_offset=49, end_lineno=1017, end_col_offset=74), ops=[NotIn()], comparators=[Name(id='ordered_ids', ctx=Load(), lineno=1017, col_offset=82, end_lineno=1017, end_col_offset=93)], lineno=1017, col_offset=49, end_lineno=1017, end_col_offset=93)], is_async=0)], lineno=1017, col_offset=16, end_lineno=1017, end_col_offset=94), lineno=1017, col_offset=4, end_lineno=1017, end_col_offset=94), Return(value=BinOp(left=Name(id='reordered', ctx=Load(), lineno=1018, col_offset=11, end_lineno=1018, end_col_offset=20), op=Add(), right=Name(id='remaining', ctx=Load(), lineno=1018, col_offset=23, end_lineno=1018, end_col_offset=32), lineno=1018, col_offset=11, end_lineno=1018, end_col_offset=32), lineno=1018, col_offset=4, end_lineno=1018, end_col_offset=32)], returns=Subscript(value=Name(id='list', ctx=Load(), lineno=982, col_offset=5, end_lineno=982, end_col_offset=9), slice=Name(id='dict', ctx=Load(), lineno=982, col_offset=10, end_lineno=982, end_col_offset=14), ctx=Load(), lineno=982, col_offset=5, end_lineno=982, end_col_offset=15), lineno=976, col_offset=0, end_lineno=1018, end_col_offset=32), FunctionDef(name='_build_findings', args=arguments(kwonlyargs=[arg(arg='records', annotation=Subscript(value=Name(id='list', ctx=Load(), lineno=1023, col_offset=13, end_lineno=1023, end_col_offset=17), slice=Name(id='dict', ctx=Load(), lineno=1023, col_offset=18, end_lineno=1023, end_col_offset=22), ctx=Load(), lineno=1023, col_offset=13, end_lineno=1023, end_col_offset=23), lineno=1023, col_offset=4, end_lineno=1023, end_col_offset=23), arg(arg='docs', annotation=Subscript(value=Name(id='Sequence', ctx=Load(), lineno=1024, col_offset=10, end_lineno=1024, end_col_offset=18), slice=Name(id='HybridResultDoc', ctx=Load(), lineno=1024, col_offset=19, end_lineno=1024, end_col_offset=34), ctx=Load(), lineno=1024, col_offset=10, end_lineno=1024, end_col_offset=35), lineno=1024, col_offset=4, end_lineno=1024, end_col_offset=35), arg(arg='contribution_map', annotation=Subscript(value=Name(id='Mapping', ctx=Load(), lineno=1025, col_offset=22, end_lineno=1025, end_col_offset=29), slice=Tuple(elts=[Name(id='str', ctx=Load(), lineno=1025, col_offset=30, end_lineno=1025, end_col_offset=33), Subscript(value=Name(id='list', ctx=Load(), lineno=1025, col_offset=35, end_lineno=1025, end_col_offset=39), slice=Subscript(value=Name(id='tuple', ctx=Load(), lineno=1025, col_offset=40, end_lineno=1025, end_col_offset=45), slice=Tuple(elts=[Name(id='str', ctx=Load(), lineno=1025, col_offset=46, end_lineno=1025, end_col_offset=49), Name(id='int', ctx=Load(), lineno=1025, col_offset=51, end_lineno=1025, end_col_offset=54), Name(id='float', ctx=Load(), lineno=1025, col_offset=56, end_lineno=1025, end_col_offset=61)], ctx=Load(), lineno=1025, col_offset=46, end_lineno=1025, end_col_offset=61), ctx=Load(), lineno=1025, col_offset=40, end_lineno=1025, end_col_offset=62), ctx=Load(), lineno=1025, col_offset=35, end_lineno=1025, end_col_offset=63)], ctx=Load(), lineno=1025, col_offset=30, end_lineno=1025, end_col_offset=63), ctx=Load(), lineno=1025, col_offset=22, end_lineno=1025, end_col_offset=64), lineno=1025, col_offset=4, end_lineno=1025, end_col_offset=64), arg(arg='explain', annotation=Name(id='bool', ctx=Load(), lineno=1026, col_offset=13, end_lineno=1026, end_col_offset=17), lineno=1026, col_offset=4, end_lineno=1026, end_col_offset=17)], kw_defaults=[None, None, None, None]), body=[Assign(targets=[Name(id='score_map', ctx=Store(), lineno=1028, col_offset=4, end_lineno=1028, end_col_offset=13)], value=DictComp(key=Call(func=Name(id='_safe_int', ctx=Load(), lineno=1028, col_offset=17, end_lineno=1028, end_col_offset=26), args=[Attribute(value=Name(id='doc', ctx=Load(), lineno=1028, col_offset=27, end_lineno=1028, end_col_offset=30), attr='doc_id', ctx=Load(), lineno=1028, col_offset=27, end_lineno=1028, end_col_offset=37)], lineno=1028, col_offset=17, end_lineno=1028, end_col_offset=38), value=Call(func=Name(id='float', ctx=Load(), lineno=1028, col_offset=40, end_lineno=1028, end_col_offset=45), args=[Attribute(value=Name(id='doc', ctx=Load(), lineno=1028, col_offset=46, end_lineno=1028, end_col_offset=49), attr='score', ctx=Load(), lineno=1028, col_offset=46, end_lineno=1028, end_col_offset=55)], lineno=1028, col_offset=40, end_lineno=1028, end_col_offset=56), generators=[comprehension(target=Name(id='doc', ctx=Store(), lineno=1028, col_offset=61, end_lineno=1028, end_col_offset=64), iter=Name(id='docs', ctx=Load(), lineno=1028, col_offset=68, end_lineno=1028, end_col_offset=72), is_async=0)], lineno=1028, col_offset=16, end_lineno=1028, end_col_offset=73), lineno=1028, col_offset=4, end_lineno=1028, end_col_offset=73), AnnAssign(target=Name(id='findings', ctx=Store(), lineno=1029, col_offset=4, end_lineno=1029, end_col_offset=12), annotation=Subscript(value=Name(id='list', ctx=Load(), lineno=1029, col_offset=14, end_lineno=1029, end_col_offset=18), slice=Name(id='Finding', ctx=Load(), lineno=1029, col_offset=19, end_lineno=1029, end_col_offset=26), ctx=Load(), lineno=1029, col_offset=14, end_lineno=1029, end_col_offset=27), value=List(ctx=Load(), lineno=1029, col_offset=30, end_lineno=1029, end_col_offset=32), simple=1, lineno=1029, col_offset=4, end_lineno=1029, end_col_offset=32), For(target=Name(id='record', ctx=Store(), lineno=1030, col_offset=8, end_lineno=1030, end_col_offset=14), iter=Name(id='records', ctx=Load(), lineno=1030, col_offset=18, end_lineno=1030, end_col_offset=25), body=[Assign(targets=[Name(id='chunk_id', ctx=Store(), lineno=1031, col_offset=8, end_lineno=1031, end_col_offset=16)], value=Call(func=Name(id='int', ctx=Load(), lineno=1031, col_offset=19, end_lineno=1031, end_col_offset=22), args=[Call(func=Attribute(value=Name(id='record', ctx=Load(), lineno=1031, col_offset=23, end_lineno=1031, end_col_offset=29), attr='get', ctx=Load(), lineno=1031, col_offset=23, end_lineno=1031, end_col_offset=33), args=[Constant(value='id', lineno=1031, col_offset=34, end_lineno=1031, end_col_offset=38), UnaryOp(op=USub(), operand=Constant(value=1, lineno=1031, col_offset=41, end_lineno=1031, end_col_offset=42), lineno=1031, col_offset=40, end_lineno=1031, end_col_offset=42)], lineno=1031, col_offset=23, end_lineno=1031, end_col_offset=43)], lineno=1031, col_offset=19, end_lineno=1031, end_col_offset=44), lineno=1031, col_offset=8, end_lineno=1031, end_col_offset=44), If(test=Compare(left=Name(id='chunk_id', ctx=Load(), lineno=1032, col_offset=11, end_lineno=1032, end_col_offset=19), ops=[Lt()], comparators=[Constant(value=0, lineno=1032, col_offset=22, end_lineno=1032, end_col_offset=23)], lineno=1032, col_offset=11, end_lineno=1032, end_col_offset=23), body=[Continue(lineno=1033, col_offset=12, end_lineno=1033, end_col_offset=20)], lineno=1032, col_offset=8, end_lineno=1033, end_col_offset=20), Assign(targets=[Name(id='uri', ctx=Store(), lineno=1034, col_offset=8, end_lineno=1034, end_col_offset=11)], value=Call(func=Name(id='str', ctx=Load(), lineno=1034, col_offset=14, end_lineno=1034, end_col_offset=17), args=[Call(func=Attribute(value=Name(id='record', ctx=Load(), lineno=1034, col_offset=18, end_lineno=1034, end_col_offset=24), attr='get', ctx=Load(), lineno=1034, col_offset=18, end_lineno=1034, end_col_offset=28), args=[Constant(value='uri', lineno=1034, col_offset=29, end_lineno=1034, end_col_offset=34), Constant(value='', lineno=1034, col_offset=36, end_lineno=1034, end_col_offset=38)], lineno=1034, col_offset=18, end_lineno=1034, end_col_offset=39)], lineno=1034, col_offset=14, end_lineno=1034, end_col_offset=40), lineno=1034, col_offset=8, end_lineno=1034, end_col_offset=40), Assign(targets=[Name(id='preview', ctx=Store(), lineno=1035, col_offset=8, end_lineno=1035, end_col_offset=15)], value=Subscript(value=BoolOp(op=Or(), values=[Call(func=Attribute(value=Name(id='record', ctx=Load(), lineno=1035, col_offset=19, end_lineno=1035, end_col_offset=25), attr='get', ctx=Load(), lineno=1035, col_offset=19, end_lineno=1035, end_col_offset=29), args=[Constant(value='content', lineno=1035, col_offset=30, end_lineno=1035, end_col_offset=39)], lineno=1035, col_offset=19, end_lineno=1035, end_col_offset=40), Call(func=Attribute(value=Name(id='record', ctx=Load(), lineno=1035, col_offset=44, end_lineno=1035, end_col_offset=50), attr='get', ctx=Load(), lineno=1035, col_offset=44, end_lineno=1035, end_col_offset=54), args=[Constant(value='preview', lineno=1035, col_offset=55, end_lineno=1035, end_col_offset=64)], lineno=1035, col_offset=44, end_lineno=1035, end_col_offset=65), Constant(value='', lineno=1035, col_offset=69, end_lineno=1035, end_col_offset=71)], lineno=1035, col_offset=19, end_lineno=1035, end_col_offset=71), slice=Slice(upper=Name(id='SNIPPET_PREVIEW_CHARS', ctx=Load(), lineno=1035, col_offset=74, end_lineno=1035, end_col_offset=95), lineno=1035, col_offset=73, end_lineno=1035, end_col_offset=95), ctx=Load(), lineno=1035, col_offset=18, end_lineno=1035, end_col_offset=96), lineno=1035, col_offset=8, end_lineno=1035, end_col_offset=96), Assign(targets=[Name(id='title', ctx=Store(), lineno=1036, col_offset=8, end_lineno=1036, end_col_offset=13)], value=BoolOp(op=Or(), values=[Attribute(value=Call(func=Name(id='Path', ctx=Load(), lineno=1036, col_offset=16, end_lineno=1036, end_col_offset=20), args=[Name(id='uri', ctx=Load(), lineno=1036, col_offset=21, end_lineno=1036, end_col_offset=24)], lineno=1036, col_offset=16, end_lineno=1036, end_col_offset=25), attr='name', ctx=Load(), lineno=1036, col_offset=16, end_lineno=1036, end_col_offset=30), Name(id='uri', ctx=Load(), lineno=1036, col_offset=34, end_lineno=1036, end_col_offset=37)], lineno=1036, col_offset=16, end_lineno=1036, end_col_offset=37), lineno=1036, col_offset=8, end_lineno=1036, end_col_offset=37), AnnAssign(target=Name(id='finding', ctx=Store(), lineno=1037, col_offset=8, end_lineno=1037, end_col_offset=15), annotation=Name(id='Finding', ctx=Load(), lineno=1037, col_offset=17, end_lineno=1037, end_col_offset=24), value=Dict(keys=[Constant(value='type', lineno=1038, col_offset=12, end_lineno=1038, end_col_offset=18), Constant(value='title', lineno=1039, col_offset=12, end_lineno=1039, end_col_offset=19), Constant(value='location', lineno=1040, col_offset=12, end_lineno=1040, end_col_offset=22), Constant(value='snippet', lineno=1047, col_offset=12, end_lineno=1047, end_col_offset=21), Constant(value='score', lineno=1048, col_offset=12, end_lineno=1048, end_col_offset=19), Constant(value='chunk_id', lineno=1049, col_offset=12, end_lineno=1049, end_col_offset=22)], values=[Constant(value='usage', lineno=1038, col_offset=20, end_lineno=1038, end_col_offset=27), Name(id='title', ctx=Load(), lineno=1039, col_offset=21, end_lineno=1039, end_col_offset=26), Dict(keys=[Constant(value='uri', lineno=1041, col_offset=16, end_lineno=1041, end_col_offset=21), Constant(value='start_line', lineno=1042, col_offset=16, end_lineno=1042, end_col_offset=28), Constant(value='start_column', lineno=1043, col_offset=16, end_lineno=1043, end_col_offset=30), Constant(value='end_line', lineno=1044, col_offset=16, end_lineno=1044, end_col_offset=26), Constant(value='end_column', lineno=1045, col_offset=16, end_lineno=1045, end_col_offset=28)], values=[Name(id='uri', ctx=Load(), lineno=1041, col_offset=23, end_lineno=1041, end_col_offset=26), Call(func=Name(id='int', ctx=Load(), lineno=1042, col_offset=30, end_lineno=1042, end_col_offset=33), args=[BoolOp(op=Or(), values=[Call(func=Attribute(value=Name(id='record', ctx=Load(), lineno=1042, col_offset=34, end_lineno=1042, end_col_offset=40), attr='get', ctx=Load(), lineno=1042, col_offset=34, end_lineno=1042, end_col_offset=44), args=[Constant(value='start_line', lineno=1042, col_offset=45, end_lineno=1042, end_col_offset=57)], lineno=1042, col_offset=34, end_lineno=1042, end_col_offset=58), Constant(value=0, lineno=1042, col_offset=62, end_lineno=1042, end_col_offset=63)], lineno=1042, col_offset=34, end_lineno=1042, end_col_offset=63)], lineno=1042, col_offset=30, end_lineno=1042, end_col_offset=64), Constant(value=0, lineno=1043, col_offset=32, end_lineno=1043, end_col_offset=33), Call(func=Name(id='int', ctx=Load(), lineno=1044, col_offset=28, end_lineno=1044, end_col_offset=31), args=[BoolOp(op=Or(), values=[Call(func=Attribute(value=Name(id='record', ctx=Load(), lineno=1044, col_offset=32, end_lineno=1044, end_col_offset=38), attr='get', ctx=Load(), lineno=1044, col_offset=32, end_lineno=1044, end_col_offset=42), args=[Constant(value='end_line', lineno=1044, col_offset=43, end_lineno=1044, end_col_offset=53)], lineno=1044, col_offset=32, end_lineno=1044, end_col_offset=54), Constant(value=0, lineno=1044, col_offset=58, end_lineno=1044, end_col_offset=59)], lineno=1044, col_offset=32, end_lineno=1044, end_col_offset=59)], lineno=1044, col_offset=28, end_lineno=1044, end_col_offset=60), Constant(value=0, lineno=1045, col_offset=30, end_lineno=1045, end_col_offset=31)], lineno=1040, col_offset=24, end_lineno=1046, end_col_offset=13), Name(id='preview', ctx=Load(), lineno=1047, col_offset=23, end_lineno=1047, end_col_offset=30), Call(func=Name(id='float', ctx=Load(), lineno=1048, col_offset=21, end_lineno=1048, end_col_offset=26), args=[Call(func=Attribute(value=Name(id='score_map', ctx=Load(), lineno=1048, col_offset=27, end_lineno=1048, end_col_offset=36), attr='get', ctx=Load(), lineno=1048, col_offset=27, end_lineno=1048, end_col_offset=40), args=[Name(id='chunk_id', ctx=Load(), lineno=1048, col_offset=41, end_lineno=1048, end_col_offset=49), Constant(value=0.0, lineno=1048, col_offset=51, end_lineno=1048, end_col_offset=54)], lineno=1048, col_offset=27, end_lineno=1048, end_col_offset=55)], lineno=1048, col_offset=21, end_lineno=1048, end_col_offset=56), Name(id='chunk_id', ctx=Load(), lineno=1049, col_offset=24, end_lineno=1049, end_col_offset=32)], lineno=1037, col_offset=27, end_lineno=1050, end_col_offset=9), simple=1, lineno=1037, col_offset=8, end_lineno=1050, end_col_offset=9), Assign(targets=[Name(id='doc_key', ctx=Store(), lineno=1051, col_offset=8, end_lineno=1051, end_col_offset=15)], value=Call(func=Name(id='str', ctx=Load(), lineno=1051, col_offset=18, end_lineno=1051, end_col_offset=21), args=[Name(id='chunk_id', ctx=Load(), lineno=1051, col_offset=22, end_lineno=1051, end_col_offset=30)], lineno=1051, col_offset=18, end_lineno=1051, end_col_offset=31), lineno=1051, col_offset=8, end_lineno=1051, end_col_offset=31), If(test=BoolOp(op=And(), values=[Name(id='explain', ctx=Load(), lineno=1052, col_offset=11, end_lineno=1052, end_col_offset=18), Compare(left=Name(id='doc_key', ctx=Load(), lineno=1052, col_offset=23, end_lineno=1052, end_col_offset=30), ops=[In()], comparators=[Name(id='contribution_map', ctx=Load(), lineno=1052, col_offset=34, end_lineno=1052, end_col_offset=50)], lineno=1052, col_offset=23, end_lineno=1052, end_col_offset=50)], lineno=1052, col_offset=11, end_lineno=1052, end_col_offset=50), body=[Assign(targets=[Name(id='parts', ctx=Store(), lineno=1053, col_offset=12, end_lineno=1053, end_col_offset=17)], value=ListComp(elt=JoinedStr(values=[FormattedValue(value=Name(id='channel', ctx=Load(), lineno=1054, col_offset=19, end_lineno=1054, end_col_offset=26), conversion=-1, lineno=1054, col_offset=18, end_lineno=1054, end_col_offset=27), Constant(value=' rank=', lineno=1054, col_offset=27, end_lineno=1054, end_col_offset=33), FormattedValue(value=Name(id='rank', ctx=Load(), lineno=1054, col_offset=34, end_lineno=1054, end_col_offset=38), conversion=-1, lineno=1054, col_offset=33, end_lineno=1054, end_col_offset=39)], lineno=1054, col_offset=16, end_lineno=1054, end_col_offset=40), generators=[comprehension(target=Tuple(elts=[Name(id='channel', ctx=Store(), lineno=1054, col_offset=45, end_lineno=1054, end_col_offset=52), Name(id='rank', ctx=Store(), lineno=1054, col_offset=54, end_lineno=1054, end_col_offset=58), Name(id='_score', ctx=Store(), lineno=1054, col_offset=60, end_lineno=1054, end_col_offset=66)], ctx=Store(), lineno=1054, col_offset=45, end_lineno=1054, end_col_offset=66), iter=Subscript(value=Name(id='contribution_map', ctx=Load(), lineno=1054, col_offset=70, end_lineno=1054, end_col_offset=86), slice=Name(id='doc_key', ctx=Load(), lineno=1054, col_offset=87, end_lineno=1054, end_col_offset=94), ctx=Load(), lineno=1054, col_offset=70, end_lineno=1054, end_col_offset=95), is_async=0)], lineno=1053, col_offset=20, end_lineno=1055, end_col_offset=13), lineno=1053, col_offset=12, end_lineno=1055, end_col_offset=13), Assign(targets=[Subscript(value=Name(id='finding', ctx=Load(), lineno=1056, col_offset=12, end_lineno=1056, end_col_offset=19), slice=Constant(value='why', lineno=1056, col_offset=20, end_lineno=1056, end_col_offset=25), ctx=Store(), lineno=1056, col_offset=12, end_lineno=1056, end_col_offset=26)], value=JoinedStr(values=[Constant(value='Fusion weights: ', lineno=1056, col_offset=31, end_lineno=1056, end_col_offset=47), FormattedValue(value=Call(func=Attribute(value=Constant(value=', ', lineno=1056, col_offset=48, end_lineno=1056, end_col_offset=52), attr='join', ctx=Load(), lineno=1056, col_offset=48, end_lineno=1056, end_col_offset=57), args=[Name(id='parts', ctx=Load(), lineno=1056, col_offset=58, end_lineno=1056, end_col_offset=63)], lineno=1056, col_offset=48, end_lineno=1056, end_col_offset=64), conversion=-1, lineno=1056, col_offset=47, end_lineno=1056, end_col_offset=65)], lineno=1056, col_offset=29, end_lineno=1056, end_col_offset=66), lineno=1056, col_offset=12, end_lineno=1056, end_col_offset=66)], lineno=1052, col_offset=8, end_lineno=1056, end_col_offset=66), Expr(value=Call(func=Attribute(value=Name(id='findings', ctx=Load(), lineno=1057, col_offset=8, end_lineno=1057, end_col_offset=16), attr='append', ctx=Load(), lineno=1057, col_offset=8, end_lineno=1057, end_col_offset=23), args=[Name(id='finding', ctx=Load(), lineno=1057, col_offset=24, end_lineno=1057, end_col_offset=31)], lineno=1057, col_offset=8, end_lineno=1057, end_col_offset=32), lineno=1057, col_offset=8, end_lineno=1057, end_col_offset=32)], lineno=1030, col_offset=4, end_lineno=1057, end_col_offset=32), Return(value=Name(id='findings', ctx=Load(), lineno=1058, col_offset=11, end_lineno=1058, end_col_offset=19), lineno=1058, col_offset=4, end_lineno=1058, end_col_offset=19)], returns=Subscript(value=Name(id='list', ctx=Load(), lineno=1027, col_offset=5, end_lineno=1027, end_col_offset=9), slice=Name(id='Finding', ctx=Load(), lineno=1027, col_offset=10, end_lineno=1027, end_col_offset=17), ctx=Load(), lineno=1027, col_offset=5, end_lineno=1027, end_col_offset=18), lineno=1021, col_offset=0, end_lineno=1058, end_col_offset=19), FunctionDef(name='merge_explainability_into_findings', args=arguments(args=[arg(arg='findings', annotation=Subscript(value=Name(id='list', ctx=Load(), lineno=1062, col_offset=14, end_lineno=1062, end_col_offset=18), slice=Name(id='Finding', ctx=Load(), lineno=1062, col_offset=19, end_lineno=1062, end_col_offset=26), ctx=Load(), lineno=1062, col_offset=14, end_lineno=1062, end_col_offset=27), lineno=1062, col_offset=4, end_lineno=1062, end_col_offset=27), arg(arg='explainability', annotation=Subscript(value=Name(id='Sequence', ctx=Load(), lineno=1063, col_offset=20, end_lineno=1063, end_col_offset=28), slice=Subscript(value=Name(id='tuple', ctx=Load(), lineno=1063, col_offset=29, end_lineno=1063, end_col_offset=34), slice=Tuple(elts=[Name(id='int', ctx=Load(), lineno=1063, col_offset=35, end_lineno=1063, end_col_offset=38), Subscript(value=Name(id='dict', ctx=Load(), lineno=1063, col_offset=40, end_lineno=1063, end_col_offset=44), slice=Tuple(elts=[Name(id='str', ctx=Load(), lineno=1063, col_offset=45, end_lineno=1063, end_col_offset=48), Name(id='Any', ctx=Load(), lineno=1063, col_offset=50, end_lineno=1063, end_col_offset=53)], ctx=Load(), lineno=1063, col_offset=45, end_lineno=1063, end_col_offset=53), ctx=Load(), lineno=1063, col_offset=40, end_lineno=1063, end_col_offset=54)], ctx=Load(), lineno=1063, col_offset=35, end_lineno=1063, end_col_offset=54), ctx=Load(), lineno=1063, col_offset=29, end_lineno=1063, end_col_offset=55), ctx=Load(), lineno=1063, col_offset=20, end_lineno=1063, end_col_offset=56), lineno=1063, col_offset=4, end_lineno=1063, end_col_offset=56)]), body=[Expr(value=Constant(value='Append token-level explainability snippets to existing findings.\n\n    Extended Summary\n    ----------------\n    This function enriches Finding objects with token-level alignment information\n    from XTR/WARP explainability data. It matches explainability entries to findings\n    by chunk_id, extracts token match summaries, and appends formatted alignment\n    strings to the "why" field. The function mutates findings in-place, adding\n    XTR alignment details (query token index → document token index with similarity\n    scores) to help users understand why specific code chunks were retrieved.\n    This is called after findings are built but before the final AnswerEnvelope\n    is assembled.\n\n    Parameters\n    ----------\n    findings : list[Finding]\n        List of Finding dictionaries to enrich. Each finding should have a "chunk_id"\n        field for matching. Findings without matching explainability entries are\n        left unchanged. Mutated in-place.\n    explainability : Sequence[tuple[int, dict[str, Any]]]\n        Explainability data as (chunk_id, payload) tuples. Each payload should\n        contain a "token_matches" key with alignment information. Empty sequences\n        result in no modifications.\n\n    Notes\n    -----\n    Time complexity O(n * m) where n is len(findings) and m is len(explainability)\n    due to lookup construction and matching. Space complexity O(m) for the lookup\n    dictionary. The function mutates findings in-place and has no return value.\n    Thread-safe if findings list is not modified concurrently.\n\n    Examples\n    --------\n    >>> findings = [{"chunk_id": 1, "why": "Fusion weights: coderank rank=1"}]\n    >>> explain = [(1, {"token_matches": [{"q_index": 0, "doc_index": 5, "similarity": 0.8}]})]\n    >>> merge_explainability_into_findings(findings, explain)\n    >>> "XTR alignments" in findings[0]["why"]\n    True\n    ', lineno=1065, col_offset=4, end_lineno=1103, end_col_offset=7), lineno=1065, col_offset=4, end_lineno=1103, end_col_offset=7), If(test=UnaryOp(op=Not(), operand=Name(id='explainability', ctx=Load(), lineno=1104, col_offset=11, end_lineno=1104, end_col_offset=25), lineno=1104, col_offset=7, end_lineno=1104, end_col_offset=25), body=[Return(lineno=1105, col_offset=8, end_lineno=1105, end_col_offset=14)], lineno=1104, col_offset=4, end_lineno=1105, end_col_offset=14), Assign(targets=[Name(id='lookup', ctx=Store(), lineno=1106, col_offset=4, end_lineno=1106, end_col_offset=10)], value=Call(func=Name(id='dict', ctx=Load(), lineno=1106, col_offset=13, end_lineno=1106, end_col_offset=17), args=[Name(id='explainability', ctx=Load(), lineno=1106, col_offset=18, end_lineno=1106, end_col_offset=32)], lineno=1106, col_offset=13, end_lineno=1106, end_col_offset=33), lineno=1106, col_offset=4, end_lineno=1106, end_col_offset=33), For(target=Name(id='finding', ctx=Store(), lineno=1107, col_offset=8, end_lineno=1107, end_col_offset=15), iter=Name(id='findings', ctx=Load(), lineno=1107, col_offset=19, end_lineno=1107, end_col_offset=27), body=[Assign(targets=[Name(id='chunk_id', ctx=Store(), lineno=1108, col_offset=8, end_lineno=1108, end_col_offset=16)], value=Call(func=Attribute(value=Name(id='finding', ctx=Load(), lineno=1108, col_offset=19, end_lineno=1108, end_col_offset=26), attr='get', ctx=Load(), lineno=1108, col_offset=19, end_lineno=1108, end_col_offset=30), args=[Constant(value='chunk_id', lineno=1108, col_offset=31, end_lineno=1108, end_col_offset=41)], lineno=1108, col_offset=19, end_lineno=1108, end_col_offset=42), lineno=1108, col_offset=8, end_lineno=1108, end_col_offset=42), If(test=Compare(left=Name(id='chunk_id', ctx=Load(), lineno=1109, col_offset=11, end_lineno=1109, end_col_offset=19), ops=[Is()], comparators=[Constant(value=None, lineno=1109, col_offset=23, end_lineno=1109, end_col_offset=27)], lineno=1109, col_offset=11, end_lineno=1109, end_col_offset=27), body=[Continue(lineno=1110, col_offset=12, end_lineno=1110, end_col_offset=20)], lineno=1109, col_offset=8, end_lineno=1110, end_col_offset=20), Assign(targets=[Name(id='payload', ctx=Store(), lineno=1111, col_offset=8, end_lineno=1111, end_col_offset=15)], value=Call(func=Attribute(value=Name(id='lookup', ctx=Load(), lineno=1111, col_offset=18, end_lineno=1111, end_col_offset=24), attr='get', ctx=Load(), lineno=1111, col_offset=18, end_lineno=1111, end_col_offset=28), args=[Name(id='chunk_id', ctx=Load(), lineno=1111, col_offset=29, end_lineno=1111, end_col_offset=37)], lineno=1111, col_offset=18, end_lineno=1111, end_col_offset=38), lineno=1111, col_offset=8, end_lineno=1111, end_col_offset=38), If(test=UnaryOp(op=Not(), operand=Name(id='payload', ctx=Load(), lineno=1112, col_offset=15, end_lineno=1112, end_col_offset=22), lineno=1112, col_offset=11, end_lineno=1112, end_col_offset=22), body=[Continue(lineno=1113, col_offset=12, end_lineno=1113, end_col_offset=20)], lineno=1112, col_offset=8, end_lineno=1113, end_col_offset=20), Assign(targets=[Name(id='matches', ctx=Store(), lineno=1114, col_offset=8, end_lineno=1114, end_col_offset=15)], value=Call(func=Attribute(value=Name(id='payload', ctx=Load(), lineno=1114, col_offset=18, end_lineno=1114, end_col_offset=25), attr='get', ctx=Load(), lineno=1114, col_offset=18, end_lineno=1114, end_col_offset=29), args=[Constant(value='token_matches', lineno=1114, col_offset=30, end_lineno=1114, end_col_offset=45)], lineno=1114, col_offset=18, end_lineno=1114, end_col_offset=46), lineno=1114, col_offset=8, end_lineno=1114, end_col_offset=46), If(test=UnaryOp(op=Not(), operand=Name(id='matches', ctx=Load(), lineno=1115, col_offset=15, end_lineno=1115, end_col_offset=22), lineno=1115, col_offset=11, end_lineno=1115, end_col_offset=22), body=[Continue(lineno=1116, col_offset=12, end_lineno=1116, end_col_offset=20)], lineno=1115, col_offset=8, end_lineno=1116, end_col_offset=20), Assign(targets=[Name(id='summary', ctx=Store(), lineno=1117, col_offset=8, end_lineno=1117, end_col_offset=15)], value=Call(func=Attribute(value=Constant(value=', ', lineno=1117, col_offset=18, end_lineno=1117, end_col_offset=22), attr='join', ctx=Load(), lineno=1117, col_offset=18, end_lineno=1117, end_col_offset=27), args=[GeneratorExp(elt=JoinedStr(values=[Constant(value='q', lineno=1118, col_offset=14, end_lineno=1118, end_col_offset=15), FormattedValue(value=Subscript(value=Name(id='match', ctx=Load(), lineno=1118, col_offset=16, end_lineno=1118, end_col_offset=21), slice=Constant(value='q_index', lineno=1118, col_offset=22, end_lineno=1118, end_col_offset=31), ctx=Load(), lineno=1118, col_offset=16, end_lineno=1118, end_col_offset=32), conversion=-1, lineno=1118, col_offset=15, end_lineno=1118, end_col_offset=33), Constant(value='→d', lineno=1118, col_offset=33, end_lineno=1118, end_col_offset=37), FormattedValue(value=Subscript(value=Name(id='match', ctx=Load(), lineno=1118, col_offset=38, end_lineno=1118, end_col_offset=43), slice=Constant(value='doc_index', lineno=1118, col_offset=44, end_lineno=1118, end_col_offset=55), ctx=Load(), lineno=1118, col_offset=38, end_lineno=1118, end_col_offset=56), conversion=-1, lineno=1118, col_offset=37, end_lineno=1118, end_col_offset=57), Constant(value='=', lineno=1118, col_offset=57, end_lineno=1118, end_col_offset=58), FormattedValue(value=Subscript(value=Name(id='match', ctx=Load(), lineno=1118, col_offset=59, end_lineno=1118, end_col_offset=64), slice=Constant(value='similarity', lineno=1118, col_offset=65, end_lineno=1118, end_col_offset=77), ctx=Load(), lineno=1118, col_offset=59, end_lineno=1118, end_col_offset=78), conversion=-1, format_spec=JoinedStr(values=[Constant(value='.2f', lineno=1118, col_offset=79, end_lineno=1118, end_col_offset=82)], lineno=1118, col_offset=78, end_lineno=1118, end_col_offset=82), lineno=1118, col_offset=58, end_lineno=1118, end_col_offset=83)], lineno=1118, col_offset=12, end_lineno=1118, end_col_offset=84), generators=[comprehension(target=Name(id='match', ctx=Store(), lineno=1119, col_offset=16, end_lineno=1119, end_col_offset=21), iter=Name(id='matches', ctx=Load(), lineno=1119, col_offset=25, end_lineno=1119, end_col_offset=32), is_async=0)], lineno=1117, col_offset=27, end_lineno=1120, end_col_offset=9)], lineno=1117, col_offset=18, end_lineno=1120, end_col_offset=9), lineno=1117, col_offset=8, end_lineno=1120, end_col_offset=9), Assign(targets=[Name(id='addition', ctx=Store(), lineno=1121, col_offset=8, end_lineno=1121, end_col_offset=16)], value=JoinedStr(values=[Constant(value='XTR alignments: ', lineno=1121, col_offset=21, end_lineno=1121, end_col_offset=37), FormattedValue(value=Name(id='summary', ctx=Load(), lineno=1121, col_offset=38, end_lineno=1121, end_col_offset=45), conversion=-1, lineno=1121, col_offset=37, end_lineno=1121, end_col_offset=46)], lineno=1121, col_offset=19, end_lineno=1121, end_col_offset=47), lineno=1121, col_offset=8, end_lineno=1121, end_col_offset=47), Assign(targets=[Name(id='previous', ctx=Store(), lineno=1122, col_offset=8, end_lineno=1122, end_col_offset=16)], value=Call(func=Attribute(value=Name(id='finding', ctx=Load(), lineno=1122, col_offset=19, end_lineno=1122, end_col_offset=26), attr='get', ctx=Load(), lineno=1122, col_offset=19, end_lineno=1122, end_col_offset=30), args=[Constant(value='why', lineno=1122, col_offset=31, end_lineno=1122, end_col_offset=36)], lineno=1122, col_offset=19, end_lineno=1122, end_col_offset=37), lineno=1122, col_offset=8, end_lineno=1122, end_col_offset=37), Assign(targets=[Subscript(value=Name(id='finding', ctx=Load(), lineno=1123, col_offset=8, end_lineno=1123, end_col_offset=15), slice=Constant(value='why', lineno=1123, col_offset=16, end_lineno=1123, end_col_offset=21), ctx=Store(), lineno=1123, col_offset=8, end_lineno=1123, end_col_offset=22)], value=IfExp(test=Name(id='previous', ctx=Load(), lineno=1123, col_offset=54, end_lineno=1123, end_col_offset=62), body=JoinedStr(values=[FormattedValue(value=Name(id='previous', ctx=Load(), lineno=1123, col_offset=28, end_lineno=1123, end_col_offset=36), conversion=-1, lineno=1123, col_offset=27, end_lineno=1123, end_col_offset=37), Constant(value='; ', lineno=1123, col_offset=37, end_lineno=1123, end_col_offset=39), FormattedValue(value=Name(id='addition', ctx=Load(), lineno=1123, col_offset=40, end_lineno=1123, end_col_offset=48), conversion=-1, lineno=1123, col_offset=39, end_lineno=1123, end_col_offset=49)], lineno=1123, col_offset=25, end_lineno=1123, end_col_offset=50), orelse=Name(id='addition', ctx=Load(), lineno=1123, col_offset=68, end_lineno=1123, end_col_offset=76), lineno=1123, col_offset=25, end_lineno=1123, end_col_offset=76), lineno=1123, col_offset=8, end_lineno=1123, end_col_offset=76)], lineno=1107, col_offset=4, end_lineno=1123, end_col_offset=76)], returns=Constant(value=None, lineno=1064, col_offset=5, end_lineno=1064, end_col_offset=9), lineno=1061, col_offset=0, end_lineno=1123, end_col_offset=76), FunctionDef(name='_build_method_explainability', args=arguments(args=[arg(arg='explainability', annotation=Subscript(value=Name(id='Sequence', ctx=Load(), lineno=1127, col_offset=20, end_lineno=1127, end_col_offset=28), slice=Subscript(value=Name(id='tuple', ctx=Load(), lineno=1127, col_offset=29, end_lineno=1127, end_col_offset=34), slice=Tuple(elts=[Name(id='int', ctx=Load(), lineno=1127, col_offset=35, end_lineno=1127, end_col_offset=38), Subscript(value=Name(id='dict', ctx=Load(), lineno=1127, col_offset=40, end_lineno=1127, end_col_offset=44), slice=Tuple(elts=[Name(id='str', ctx=Load(), lineno=1127, col_offset=45, end_lineno=1127, end_col_offset=48), Name(id='Any', ctx=Load(), lineno=1127, col_offset=50, end_lineno=1127, end_col_offset=53)], ctx=Load(), lineno=1127, col_offset=45, end_lineno=1127, end_col_offset=53), ctx=Load(), lineno=1127, col_offset=40, end_lineno=1127, end_col_offset=54)], ctx=Load(), lineno=1127, col_offset=35, end_lineno=1127, end_col_offset=54), ctx=Load(), lineno=1127, col_offset=29, end_lineno=1127, end_col_offset=55), ctx=Load(), lineno=1127, col_offset=20, end_lineno=1127, end_col_offset=56), lineno=1127, col_offset=4, end_lineno=1127, end_col_offset=56)], kwonlyargs=[arg(arg='limit', annotation=Name(id='int', ctx=Load(), lineno=1129, col_offset=11, end_lineno=1129, end_col_offset=14), lineno=1129, col_offset=4, end_lineno=1129, end_col_offset=14)], kw_defaults=[Constant(value=5, lineno=1129, col_offset=17, end_lineno=1129, end_col_offset=18)]), body=[Expr(value=Constant(value='Build explainability payload for MethodInfo.\n\n    Extended Summary\n    ----------------\n    This helper function converts raw explainability tuples (chunk_id, payload) into\n    a structured dictionary format suitable for inclusion in MethodInfo. It filters\n    entries to include only those with token matches, limits the number of entries\n    to prevent payload bloat, and organizes them by channel (currently "warp").\n    The function is called after the retrieval pipeline completes to package\n    token-level alignment data for observability.\n\n    Parameters\n    ----------\n    explainability : Sequence[tuple[int, dict[str, Any]]]\n        Raw explainability data as (chunk_id, payload) tuples. Each payload should\n        contain a "token_matches" key with alignment information. Empty sequences\n        result in None return.\n    limit : int, optional\n        Maximum number of explainability entries to include in the result. Defaults\n        to 5 to keep payload sizes manageable. Higher values provide more detail but\n        increase response size.\n\n    Returns\n    -------\n    dict[str, list[dict[str, Any]]] | None\n        Structured explainability data keyed by channel name (e.g., "warp"). Each\n        entry contains chunk_id and token_matches. Returns None if no valid entries\n        are found or if explainability is empty.\n\n    Notes\n    -----\n    Time complexity O(n) where n is min(len(explainability), limit). Space complexity\n    O(n) for the result dictionary. No I/O or side effects. Thread-safe.\n\n    Examples\n    --------\n    >>> explain = [(1, {"token_matches": [{"q_index": 0, "doc_index": 5, "similarity": 0.8}]})]\n    >>> result = _build_method_explainability(explain, limit=5)\n    >>> result is not None and "warp" in result\n    True\n    >>> result = _build_method_explainability([], limit=5)\n    >>> result is None\n    True\n    ', lineno=1131, col_offset=4, end_lineno=1174, end_col_offset=7), lineno=1131, col_offset=4, end_lineno=1174, end_col_offset=7), If(test=UnaryOp(op=Not(), operand=Name(id='explainability', ctx=Load(), lineno=1175, col_offset=11, end_lineno=1175, end_col_offset=25), lineno=1175, col_offset=7, end_lineno=1175, end_col_offset=25), body=[Return(value=Constant(value=None, lineno=1176, col_offset=15, end_lineno=1176, end_col_offset=19), lineno=1176, col_offset=8, end_lineno=1176, end_col_offset=19)], lineno=1175, col_offset=4, end_lineno=1176, end_col_offset=19), AnnAssign(target=Name(id='entries', ctx=Store(), lineno=1177, col_offset=4, end_lineno=1177, end_col_offset=11), annotation=Subscript(value=Name(id='list', ctx=Load(), lineno=1177, col_offset=13, end_lineno=1177, end_col_offset=17), slice=Subscript(value=Name(id='dict', ctx=Load(), lineno=1177, col_offset=18, end_lineno=1177, end_col_offset=22), slice=Tuple(elts=[Name(id='str', ctx=Load(), lineno=1177, col_offset=23, end_lineno=1177, end_col_offset=26), Name(id='Any', ctx=Load(), lineno=1177, col_offset=28, end_lineno=1177, end_col_offset=31)], ctx=Load(), lineno=1177, col_offset=23, end_lineno=1177, end_col_offset=31), ctx=Load(), lineno=1177, col_offset=18, end_lineno=1177, end_col_offset=32), ctx=Load(), lineno=1177, col_offset=13, end_lineno=1177, end_col_offset=33), value=List(ctx=Load(), lineno=1177, col_offset=36, end_lineno=1177, end_col_offset=38), simple=1, lineno=1177, col_offset=4, end_lineno=1177, end_col_offset=38), For(target=Tuple(elts=[Name(id='chunk_id', ctx=Store(), lineno=1178, col_offset=8, end_lineno=1178, end_col_offset=16), Name(id='payload', ctx=Store(), lineno=1178, col_offset=18, end_lineno=1178, end_col_offset=25)], ctx=Store(), lineno=1178, col_offset=8, end_lineno=1178, end_col_offset=25), iter=Subscript(value=Name(id='explainability', ctx=Load(), lineno=1178, col_offset=29, end_lineno=1178, end_col_offset=43), slice=Slice(upper=Name(id='limit', ctx=Load(), lineno=1178, col_offset=45, end_lineno=1178, end_col_offset=50), lineno=1178, col_offset=44, end_lineno=1178, end_col_offset=50), ctx=Load(), lineno=1178, col_offset=29, end_lineno=1178, end_col_offset=51), body=[Assign(targets=[Name(id='token_matches', ctx=Store(), lineno=1179, col_offset=8, end_lineno=1179, end_col_offset=21)], value=Call(func=Name(id='list', ctx=Load(), lineno=1179, col_offset=24, end_lineno=1179, end_col_offset=28), args=[Call(func=Attribute(value=Name(id='payload', ctx=Load(), lineno=1179, col_offset=29, end_lineno=1179, end_col_offset=36), attr='get', ctx=Load(), lineno=1179, col_offset=29, end_lineno=1179, end_col_offset=40), args=[Constant(value='token_matches', lineno=1179, col_offset=41, end_lineno=1179, end_col_offset=56), List(ctx=Load(), lineno=1179, col_offset=58, end_lineno=1179, end_col_offset=60)], lineno=1179, col_offset=29, end_lineno=1179, end_col_offset=61)], lineno=1179, col_offset=24, end_lineno=1179, end_col_offset=62), lineno=1179, col_offset=8, end_lineno=1179, end_col_offset=62), If(test=UnaryOp(op=Not(), operand=Name(id='token_matches', ctx=Load(), lineno=1180, col_offset=15, end_lineno=1180, end_col_offset=28), lineno=1180, col_offset=11, end_lineno=1180, end_col_offset=28), body=[Continue(lineno=1181, col_offset=12, end_lineno=1181, end_col_offset=20)], lineno=1180, col_offset=8, end_lineno=1181, end_col_offset=20), Expr(value=Call(func=Attribute(value=Name(id='entries', ctx=Load(), lineno=1182, col_offset=8, end_lineno=1182, end_col_offset=15), attr='append', ctx=Load(), lineno=1182, col_offset=8, end_lineno=1182, end_col_offset=22), args=[Dict(keys=[Constant(value='chunk_id', lineno=1184, col_offset=16, end_lineno=1184, end_col_offset=26), Constant(value='token_matches', lineno=1185, col_offset=16, end_lineno=1185, end_col_offset=31)], values=[Name(id='chunk_id', ctx=Load(), lineno=1184, col_offset=28, end_lineno=1184, end_col_offset=36), Name(id='token_matches', ctx=Load(), lineno=1185, col_offset=33, end_lineno=1185, end_col_offset=46)], lineno=1183, col_offset=12, end_lineno=1186, end_col_offset=13)], lineno=1182, col_offset=8, end_lineno=1187, end_col_offset=9), lineno=1182, col_offset=8, end_lineno=1187, end_col_offset=9)], lineno=1178, col_offset=4, end_lineno=1187, end_col_offset=9), If(test=UnaryOp(op=Not(), operand=Name(id='entries', ctx=Load(), lineno=1188, col_offset=11, end_lineno=1188, end_col_offset=18), lineno=1188, col_offset=7, end_lineno=1188, end_col_offset=18), body=[Return(value=Constant(value=None, lineno=1189, col_offset=15, end_lineno=1189, end_col_offset=19), lineno=1189, col_offset=8, end_lineno=1189, end_col_offset=19)], lineno=1188, col_offset=4, end_lineno=1189, end_col_offset=19), Return(value=Dict(keys=[Constant(value='warp', lineno=1190, col_offset=12, end_lineno=1190, end_col_offset=18)], values=[Name(id='entries', ctx=Load(), lineno=1190, col_offset=20, end_lineno=1190, end_col_offset=27)], lineno=1190, col_offset=11, end_lineno=1190, end_col_offset=28), lineno=1190, col_offset=4, end_lineno=1190, end_col_offset=28)], returns=BinOp(left=Subscript(value=Name(id='dict', ctx=Load(), lineno=1130, col_offset=5, end_lineno=1130, end_col_offset=9), slice=Tuple(elts=[Name(id='str', ctx=Load(), lineno=1130, col_offset=10, end_lineno=1130, end_col_offset=13), Subscript(value=Name(id='list', ctx=Load(), lineno=1130, col_offset=15, end_lineno=1130, end_col_offset=19), slice=Subscript(value=Name(id='dict', ctx=Load(), lineno=1130, col_offset=20, end_lineno=1130, end_col_offset=24), slice=Tuple(elts=[Name(id='str', ctx=Load(), lineno=1130, col_offset=25, end_lineno=1130, end_col_offset=28), Name(id='Any', ctx=Load(), lineno=1130, col_offset=30, end_lineno=1130, end_col_offset=33)], ctx=Load(), lineno=1130, col_offset=25, end_lineno=1130, end_col_offset=33), ctx=Load(), lineno=1130, col_offset=20, end_lineno=1130, end_col_offset=34), ctx=Load(), lineno=1130, col_offset=15, end_lineno=1130, end_col_offset=35)], ctx=Load(), lineno=1130, col_offset=10, end_lineno=1130, end_col_offset=35), ctx=Load(), lineno=1130, col_offset=5, end_lineno=1130, end_col_offset=36), op=BitOr(), right=Constant(value=None, lineno=1130, col_offset=39, end_lineno=1130, end_col_offset=43), lineno=1130, col_offset=5, end_lineno=1130, end_col_offset=43), lineno=1126, col_offset=0, end_lineno=1190, end_col_offset=28), FunctionDef(name='_build_method', args=arguments(args=[arg(arg='context', annotation=Name(id='MethodContext', ctx=Load(), lineno=1193, col_offset=27, end_lineno=1193, end_col_offset=40), lineno=1193, col_offset=18, end_lineno=1193, end_col_offset=40)]), body=[Assign(targets=[Name(id='elapsed_ms', ctx=Store(), lineno=1194, col_offset=4, end_lineno=1194, end_col_offset=14)], value=Call(func=Name(id='int', ctx=Load(), lineno=1194, col_offset=17, end_lineno=1194, end_col_offset=20), args=[BinOp(left=BinOp(left=Call(func=Name(id='perf_counter', ctx=Load(), lineno=1194, col_offset=22, end_lineno=1194, end_col_offset=34), lineno=1194, col_offset=22, end_lineno=1194, end_col_offset=36), op=Sub(), right=Attribute(value=Name(id='context', ctx=Load(), lineno=1194, col_offset=39, end_lineno=1194, end_col_offset=46), attr='start_time', ctx=Load(), lineno=1194, col_offset=39, end_lineno=1194, end_col_offset=57), lineno=1194, col_offset=22, end_lineno=1194, end_col_offset=57), op=Mult(), right=Constant(value=1000, lineno=1194, col_offset=61, end_lineno=1194, end_col_offset=65), lineno=1194, col_offset=21, end_lineno=1194, end_col_offset=65)], lineno=1194, col_offset=17, end_lineno=1194, end_col_offset=66), lineno=1194, col_offset=4, end_lineno=1194, end_col_offset=66), Assign(targets=[Name(id='coverage', ctx=Store(), lineno=1195, col_offset=4, end_lineno=1195, end_col_offset=12)], value=JoinedStr(values=[FormattedValue(value=Attribute(value=Name(id='context', ctx=Load(), lineno=1195, col_offset=18, end_lineno=1195, end_col_offset=25), attr='findings_count', ctx=Load(), lineno=1195, col_offset=18, end_lineno=1195, end_col_offset=40), conversion=-1, lineno=1195, col_offset=17, end_lineno=1195, end_col_offset=41), Constant(value='/', lineno=1195, col_offset=41, end_lineno=1195, end_col_offset=42), FormattedValue(value=Attribute(value=Name(id='context', ctx=Load(), lineno=1195, col_offset=43, end_lineno=1195, end_col_offset=50), attr='effective_limit', ctx=Load(), lineno=1195, col_offset=43, end_lineno=1195, end_col_offset=66), conversion=-1, lineno=1195, col_offset=42, end_lineno=1195, end_col_offset=67), Constant(value=' results in ', lineno=1195, col_offset=67, end_lineno=1195, end_col_offset=79), FormattedValue(value=Name(id='elapsed_ms', ctx=Load(), lineno=1195, col_offset=80, end_lineno=1195, end_col_offset=90), conversion=-1, lineno=1195, col_offset=79, end_lineno=1195, end_col_offset=91), Constant(value='ms', lineno=1195, col_offset=91, end_lineno=1195, end_col_offset=93)], lineno=1195, col_offset=15, end_lineno=1195, end_col_offset=94), lineno=1195, col_offset=4, end_lineno=1195, end_col_offset=94), If(test=Compare(left=Attribute(value=Name(id='context', ctx=Load(), lineno=1196, col_offset=7, end_lineno=1196, end_col_offset=14), attr='requested_limit', ctx=Load(), lineno=1196, col_offset=7, end_lineno=1196, end_col_offset=30), ops=[NotEq()], comparators=[Attribute(value=Name(id='context', ctx=Load(), lineno=1196, col_offset=34, end_lineno=1196, end_col_offset=41), attr='effective_limit', ctx=Load(), lineno=1196, col_offset=34, end_lineno=1196, end_col_offset=57)], lineno=1196, col_offset=7, end_lineno=1196, end_col_offset=57), body=[Assign(targets=[Name(id='coverage', ctx=Store(), lineno=1197, col_offset=8, end_lineno=1197, end_col_offset=16)], value=JoinedStr(values=[FormattedValue(value=Name(id='coverage', ctx=Load(), lineno=1197, col_offset=22, end_lineno=1197, end_col_offset=30), conversion=-1, lineno=1197, col_offset=21, end_lineno=1197, end_col_offset=31), Constant(value=' (requested ', lineno=1197, col_offset=31, end_lineno=1197, end_col_offset=43), FormattedValue(value=Attribute(value=Name(id='context', ctx=Load(), lineno=1197, col_offset=44, end_lineno=1197, end_col_offset=51), attr='requested_limit', ctx=Load(), lineno=1197, col_offset=44, end_lineno=1197, end_col_offset=67), conversion=-1, lineno=1197, col_offset=43, end_lineno=1197, end_col_offset=68), Constant(value=')', lineno=1197, col_offset=68, end_lineno=1197, end_col_offset=69)], lineno=1197, col_offset=19, end_lineno=1197, end_col_offset=70), lineno=1197, col_offset=8, end_lineno=1197, end_col_offset=70)], lineno=1196, col_offset=4, end_lineno=1197, end_col_offset=70), AnnAssign(target=Name(id='method', ctx=Store(), lineno=1198, col_offset=4, end_lineno=1198, end_col_offset=10), annotation=Name(id='MethodInfo', ctx=Load(), lineno=1198, col_offset=12, end_lineno=1198, end_col_offset=22), value=Dict(keys=[Constant(value='retrieval', lineno=1199, col_offset=8, end_lineno=1199, end_col_offset=19), Constant(value='coverage', lineno=1200, col_offset=8, end_lineno=1200, end_col_offset=18)], values=[Call(func=Name(id='list', ctx=Load(), lineno=1199, col_offset=21, end_lineno=1199, end_col_offset=25), args=[Call(func=Attribute(value=Name(id='dict', ctx=Load(), lineno=1199, col_offset=26, end_lineno=1199, end_col_offset=30), attr='fromkeys', ctx=Load(), lineno=1199, col_offset=26, end_lineno=1199, end_col_offset=39), args=[Attribute(value=Name(id='context', ctx=Load(), lineno=1199, col_offset=40, end_lineno=1199, end_col_offset=47), attr='channels', ctx=Load(), lineno=1199, col_offset=40, end_lineno=1199, end_col_offset=56)], lineno=1199, col_offset=26, end_lineno=1199, end_col_offset=57)], lineno=1199, col_offset=21, end_lineno=1199, end_col_offset=58), Name(id='coverage', ctx=Load(), lineno=1200, col_offset=20, end_lineno=1200, end_col_offset=28)], lineno=1198, col_offset=25, end_lineno=1201, end_col_offset=5), simple=1, lineno=1198, col_offset=4, end_lineno=1201, end_col_offset=5), If(test=Attribute(value=Name(id='context', ctx=Load(), lineno=1202, col_offset=7, end_lineno=1202, end_col_offset=14), attr='stages', ctx=Load(), lineno=1202, col_offset=7, end_lineno=1202, end_col_offset=21), body=[Assign(targets=[Subscript(value=Name(id='method', ctx=Load(), lineno=1203, col_offset=8, end_lineno=1203, end_col_offset=14), slice=Constant(value='stages', lineno=1203, col_offset=15, end_lineno=1203, end_col_offset=23), ctx=Store(), lineno=1203, col_offset=8, end_lineno=1203, end_col_offset=24)], value=ListComp(elt=Call(func=Name(id='cast', ctx=Load(), lineno=1203, col_offset=28, end_lineno=1203, end_col_offset=32), args=[Constant(value='StageInfo', lineno=1203, col_offset=33, end_lineno=1203, end_col_offset=44), Call(func=Attribute(value=Name(id='stage', ctx=Load(), lineno=1203, col_offset=46, end_lineno=1203, end_col_offset=51), attr='as_payload', ctx=Load(), lineno=1203, col_offset=46, end_lineno=1203, end_col_offset=62), lineno=1203, col_offset=46, end_lineno=1203, end_col_offset=64)], lineno=1203, col_offset=28, end_lineno=1203, end_col_offset=65), generators=[comprehension(target=Name(id='stage', ctx=Store(), lineno=1203, col_offset=70, end_lineno=1203, end_col_offset=75), iter=Attribute(value=Name(id='context', ctx=Load(), lineno=1203, col_offset=79, end_lineno=1203, end_col_offset=86), attr='stages', ctx=Load(), lineno=1203, col_offset=79, end_lineno=1203, end_col_offset=93), is_async=0)], lineno=1203, col_offset=27, end_lineno=1203, end_col_offset=94), lineno=1203, col_offset=8, end_lineno=1203, end_col_offset=94)], lineno=1202, col_offset=4, end_lineno=1203, end_col_offset=94), If(test=Attribute(value=Name(id='context', ctx=Load(), lineno=1204, col_offset=7, end_lineno=1204, end_col_offset=14), attr='notes', ctx=Load(), lineno=1204, col_offset=7, end_lineno=1204, end_col_offset=20), body=[Assign(targets=[Subscript(value=Name(id='method', ctx=Load(), lineno=1205, col_offset=8, end_lineno=1205, end_col_offset=14), slice=Constant(value='notes', lineno=1205, col_offset=15, end_lineno=1205, end_col_offset=22), ctx=Store(), lineno=1205, col_offset=8, end_lineno=1205, end_col_offset=23)], value=Call(func=Name(id='list', ctx=Load(), lineno=1205, col_offset=26, end_lineno=1205, end_col_offset=30), args=[Attribute(value=Name(id='context', ctx=Load(), lineno=1205, col_offset=31, end_lineno=1205, end_col_offset=38), attr='notes', ctx=Load(), lineno=1205, col_offset=31, end_lineno=1205, end_col_offset=44)], lineno=1205, col_offset=26, end_lineno=1205, end_col_offset=45), lineno=1205, col_offset=8, end_lineno=1205, end_col_offset=45)], lineno=1204, col_offset=4, end_lineno=1205, end_col_offset=45), If(test=Attribute(value=Name(id='context', ctx=Load(), lineno=1206, col_offset=7, end_lineno=1206, end_col_offset=14), attr='explainability', ctx=Load(), lineno=1206, col_offset=7, end_lineno=1206, end_col_offset=29), body=[Assign(targets=[Subscript(value=Name(id='method', ctx=Load(), lineno=1207, col_offset=8, end_lineno=1207, end_col_offset=14), slice=Constant(value='explainability', lineno=1207, col_offset=15, end_lineno=1207, end_col_offset=31), ctx=Store(), lineno=1207, col_offset=8, end_lineno=1207, end_col_offset=32)], value=Attribute(value=Name(id='context', ctx=Load(), lineno=1207, col_offset=35, end_lineno=1207, end_col_offset=42), attr='explainability', ctx=Load(), lineno=1207, col_offset=35, end_lineno=1207, end_col_offset=57), lineno=1207, col_offset=8, end_lineno=1207, end_col_offset=57)], lineno=1206, col_offset=4, end_lineno=1207, end_col_offset=57), Return(value=Name(id='method', ctx=Load(), lineno=1208, col_offset=11, end_lineno=1208, end_col_offset=17), lineno=1208, col_offset=4, end_lineno=1208, end_col_offset=17)], returns=Name(id='MethodInfo', ctx=Load(), lineno=1193, col_offset=45, end_lineno=1193, end_col_offset=55), lineno=1193, col_offset=0, end_lineno=1208, end_col_offset=17), FunctionDef(name='_assemble_extras', args=arguments(kwonlyargs=[arg(arg='method', annotation=Name(id='MethodInfo', ctx=Load(), lineno=1213, col_offset=12, end_lineno=1213, end_col_offset=22), lineno=1213, col_offset=4, end_lineno=1213, end_col_offset=22), arg(arg='limits', annotation=Subscript(value=Name(id='list', ctx=Load(), lineno=1214, col_offset=12, end_lineno=1214, end_col_offset=16), slice=Name(id='str', ctx=Load(), lineno=1214, col_offset=17, end_lineno=1214, end_col_offset=20), ctx=Load(), lineno=1214, col_offset=12, end_lineno=1214, end_col_offset=21), lineno=1214, col_offset=4, end_lineno=1214, end_col_offset=21), arg(arg='scope', annotation=BinOp(left=Name(id='ScopeIn', ctx=Load(), lineno=1215, col_offset=11, end_lineno=1215, end_col_offset=18), op=BitOr(), right=Constant(value=None, lineno=1215, col_offset=21, end_lineno=1215, end_col_offset=25), lineno=1215, col_offset=11, end_lineno=1215, end_col_offset=25), lineno=1215, col_offset=4, end_lineno=1215, end_col_offset=25)], kw_defaults=[None, None, None]), body=[Expr(value=Constant(value='Assemble response metadata extras dictionary.\n\n    Extended Summary\n    ----------------\n    This helper function constructs the extras dictionary for an AnswerEnvelope,\n    combining method metadata (retrieval channels, coverage, stage timings) with\n    optional limits warnings and scope filters. It is called after the retrieval\n    pipeline completes to package telemetry and configuration context into the\n    response. The function ensures that only non-empty optional fields are included,\n    keeping the response payload minimal.\n\n    Parameters\n    ----------\n    method : MethodInfo\n        Method metadata dictionary containing retrieval channels, coverage string,\n        and optional stage timings. This is produced by _build_method() and describes\n        how the search was executed.\n    limits : list[str]\n        List of warning messages about budget overruns, limit clamping, or other\n        operational constraints. Empty list means no warnings. Non-empty lists are\n        included in the extras as the "limits" field.\n    scope : ScopeIn | None\n        Scope filters that were applied during search (include_globs, exclude_globs,\n        languages). None means no scope filtering was applied. Non-None values are\n        included in the extras as the "scope" field.\n\n    Returns\n    -------\n    AnswerEnvelope\n        Dictionary containing the method field (always present) and optionally\n        limits and scope fields if they are non-empty/non-None. This dictionary\n        is merged into the final AnswerEnvelope by _make_envelope().\n\n    Notes\n    -----\n    Time complexity O(1). No I/O or side effects. The function performs shallow\n    dictionary construction only. Thread-safe.\n\n    Examples\n    --------\n    >>> method = {"retrieval": ["coderank"], "coverage": "5/10 results in 42ms"}\n    >>> extras = _assemble_extras(method=method, limits=[], scope=None)\n    >>> extras["method"] == method\n    True\n    >>> "limits" in extras\n    False\n    >>> extras = _assemble_extras(method=method, limits=["Budget exceeded"], scope=None)\n    >>> extras["limits"] == ["Budget exceeded"]\n    True\n    ', lineno=1217, col_offset=4, end_lineno=1266, end_col_offset=7), lineno=1217, col_offset=4, end_lineno=1266, end_col_offset=7), AnnAssign(target=Name(id='extras', ctx=Store(), lineno=1267, col_offset=4, end_lineno=1267, end_col_offset=10), annotation=Name(id='AnswerEnvelope', ctx=Load(), lineno=1267, col_offset=12, end_lineno=1267, end_col_offset=26), value=Dict(keys=[Constant(value='method', lineno=1267, col_offset=30, end_lineno=1267, end_col_offset=38)], values=[Name(id='method', ctx=Load(), lineno=1267, col_offset=40, end_lineno=1267, end_col_offset=46)], lineno=1267, col_offset=29, end_lineno=1267, end_col_offset=47), simple=1, lineno=1267, col_offset=4, end_lineno=1267, end_col_offset=47), If(test=Name(id='limits', ctx=Load(), lineno=1268, col_offset=7, end_lineno=1268, end_col_offset=13), body=[Assign(targets=[Subscript(value=Name(id='extras', ctx=Load(), lineno=1269, col_offset=8, end_lineno=1269, end_col_offset=14), slice=Constant(value='limits', lineno=1269, col_offset=15, end_lineno=1269, end_col_offset=23), ctx=Store(), lineno=1269, col_offset=8, end_lineno=1269, end_col_offset=24)], value=Name(id='limits', ctx=Load(), lineno=1269, col_offset=27, end_lineno=1269, end_col_offset=33), lineno=1269, col_offset=8, end_lineno=1269, end_col_offset=33)], lineno=1268, col_offset=4, end_lineno=1269, end_col_offset=33), If(test=Name(id='scope', ctx=Load(), lineno=1270, col_offset=7, end_lineno=1270, end_col_offset=12), body=[Assign(targets=[Subscript(value=Name(id='extras', ctx=Load(), lineno=1271, col_offset=8, end_lineno=1271, end_col_offset=14), slice=Constant(value='scope', lineno=1271, col_offset=15, end_lineno=1271, end_col_offset=22), ctx=Store(), lineno=1271, col_offset=8, end_lineno=1271, end_col_offset=23)], value=Name(id='scope', ctx=Load(), lineno=1271, col_offset=26, end_lineno=1271, end_col_offset=31), lineno=1271, col_offset=8, end_lineno=1271, end_col_offset=31)], lineno=1270, col_offset=4, end_lineno=1271, end_col_offset=31), Return(value=Name(id='extras', ctx=Load(), lineno=1272, col_offset=11, end_lineno=1272, end_col_offset=17), lineno=1272, col_offset=4, end_lineno=1272, end_col_offset=17)], returns=Name(id='AnswerEnvelope', ctx=Load(), lineno=1216, col_offset=5, end_lineno=1216, end_col_offset=19), lineno=1211, col_offset=0, end_lineno=1272, end_col_offset=17), FunctionDef(name='_make_envelope', args=arguments(kwonlyargs=[arg(arg='answer', annotation=Name(id='str', ctx=Load(), lineno=1277, col_offset=12, end_lineno=1277, end_col_offset=15), lineno=1277, col_offset=4, end_lineno=1277, end_col_offset=15), arg(arg='findings', annotation=Subscript(value=Name(id='list', ctx=Load(), lineno=1278, col_offset=14, end_lineno=1278, end_col_offset=18), slice=Name(id='Finding', ctx=Load(), lineno=1278, col_offset=19, end_lineno=1278, end_col_offset=26), ctx=Load(), lineno=1278, col_offset=14, end_lineno=1278, end_col_offset=27), lineno=1278, col_offset=4, end_lineno=1278, end_col_offset=27), arg(arg='extras', annotation=Name(id='AnswerEnvelope', ctx=Load(), lineno=1279, col_offset=12, end_lineno=1279, end_col_offset=26), lineno=1279, col_offset=4, end_lineno=1279, end_col_offset=26)], kw_defaults=[None, None, None]), body=[AnnAssign(target=Name(id='envelope', ctx=Store(), lineno=1281, col_offset=4, end_lineno=1281, end_col_offset=12), annotation=Name(id='AnswerEnvelope', ctx=Load(), lineno=1281, col_offset=14, end_lineno=1281, end_col_offset=28), value=Dict(keys=[Constant(value='answer', lineno=1282, col_offset=8, end_lineno=1282, end_col_offset=16), Constant(value='query_kind', lineno=1283, col_offset=8, end_lineno=1283, end_col_offset=20), Constant(value='findings', lineno=1284, col_offset=8, end_lineno=1284, end_col_offset=18), Constant(value='confidence', lineno=1285, col_offset=8, end_lineno=1285, end_col_offset=20)], values=[Name(id='answer', ctx=Load(), lineno=1282, col_offset=18, end_lineno=1282, end_col_offset=24), Constant(value='semantic_pro', lineno=1283, col_offset=22, end_lineno=1283, end_col_offset=36), Name(id='findings', ctx=Load(), lineno=1284, col_offset=20, end_lineno=1284, end_col_offset=28), IfExp(test=Name(id='findings', ctx=Load(), lineno=1285, col_offset=29, end_lineno=1285, end_col_offset=37), body=Constant(value=0.9, lineno=1285, col_offset=22, end_lineno=1285, end_col_offset=25), orelse=Constant(value=0.0, lineno=1285, col_offset=43, end_lineno=1285, end_col_offset=46), lineno=1285, col_offset=22, end_lineno=1285, end_col_offset=46)], lineno=1281, col_offset=31, end_lineno=1286, end_col_offset=5), simple=1, lineno=1281, col_offset=4, end_lineno=1286, end_col_offset=5), Expr(value=Call(func=Attribute(value=Name(id='envelope', ctx=Load(), lineno=1287, col_offset=4, end_lineno=1287, end_col_offset=12), attr='update', ctx=Load(), lineno=1287, col_offset=4, end_lineno=1287, end_col_offset=19), args=[Name(id='extras', ctx=Load(), lineno=1287, col_offset=20, end_lineno=1287, end_col_offset=26)], lineno=1287, col_offset=4, end_lineno=1287, end_col_offset=27), lineno=1287, col_offset=4, end_lineno=1287, end_col_offset=27), Return(value=Name(id='envelope', ctx=Load(), lineno=1288, col_offset=11, end_lineno=1288, end_col_offset=19), lineno=1288, col_offset=4, end_lineno=1288, end_col_offset=19)], returns=Name(id='AnswerEnvelope', ctx=Load(), lineno=1280, col_offset=5, end_lineno=1280, end_col_offset=19), lineno=1275, col_offset=0, end_lineno=1288, end_col_offset=19), FunctionDef(name='_clamp_limit', args=arguments(args=[arg(arg='requested', annotation=Name(id='int', ctx=Load(), lineno=1291, col_offset=28, end_lineno=1291, end_col_offset=31), lineno=1291, col_offset=17, end_lineno=1291, end_col_offset=31), arg(arg='max_results', annotation=Name(id='int', ctx=Load(), lineno=1291, col_offset=46, end_lineno=1291, end_col_offset=49), lineno=1291, col_offset=33, end_lineno=1291, end_col_offset=49), arg(arg='notes', annotation=Subscript(value=Name(id='list', ctx=Load(), lineno=1291, col_offset=58, end_lineno=1291, end_col_offset=62), slice=Name(id='str', ctx=Load(), lineno=1291, col_offset=63, end_lineno=1291, end_col_offset=66), ctx=Load(), lineno=1291, col_offset=58, end_lineno=1291, end_col_offset=67), lineno=1291, col_offset=51, end_lineno=1291, end_col_offset=67)]), body=[If(test=Compare(left=Name(id='requested', ctx=Load(), lineno=1292, col_offset=7, end_lineno=1292, end_col_offset=16), ops=[LtE()], comparators=[Constant(value=0, lineno=1292, col_offset=20, end_lineno=1292, end_col_offset=21)], lineno=1292, col_offset=7, end_lineno=1292, end_col_offset=21), body=[Expr(value=Call(func=Attribute(value=Name(id='notes', ctx=Load(), lineno=1293, col_offset=8, end_lineno=1293, end_col_offset=13), attr='append', ctx=Load(), lineno=1293, col_offset=8, end_lineno=1293, end_col_offset=20), args=[Constant(value='Requested limit <= 0; defaulting to 1.', lineno=1293, col_offset=21, end_lineno=1293, end_col_offset=61)], lineno=1293, col_offset=8, end_lineno=1293, end_col_offset=62), lineno=1293, col_offset=8, end_lineno=1293, end_col_offset=62)], lineno=1292, col_offset=4, end_lineno=1293, end_col_offset=62), If(test=Compare(left=Name(id='requested', ctx=Load(), lineno=1294, col_offset=7, end_lineno=1294, end_col_offset=16), ops=[Gt()], comparators=[Name(id='max_results', ctx=Load(), lineno=1294, col_offset=19, end_lineno=1294, end_col_offset=30)], lineno=1294, col_offset=7, end_lineno=1294, end_col_offset=30), body=[Expr(value=Call(func=Attribute(value=Name(id='notes', ctx=Load(), lineno=1295, col_offset=8, end_lineno=1295, end_col_offset=13), attr='append', ctx=Load(), lineno=1295, col_offset=8, end_lineno=1295, end_col_offset=20), args=[JoinedStr(values=[Constant(value='Requested limit ', lineno=1295, col_offset=23, end_lineno=1295, end_col_offset=39), FormattedValue(value=Name(id='requested', ctx=Load(), lineno=1295, col_offset=40, end_lineno=1295, end_col_offset=49), conversion=-1, lineno=1295, col_offset=39, end_lineno=1295, end_col_offset=50), Constant(value=' exceeds max_results ', lineno=1295, col_offset=50, end_lineno=1295, end_col_offset=71), FormattedValue(value=Name(id='max_results', ctx=Load(), lineno=1295, col_offset=72, end_lineno=1295, end_col_offset=83), conversion=-1, lineno=1295, col_offset=71, end_lineno=1295, end_col_offset=84), Constant(value='; truncating.', lineno=1295, col_offset=84, end_lineno=1295, end_col_offset=97)], lineno=1295, col_offset=21, end_lineno=1295, end_col_offset=98)], lineno=1295, col_offset=8, end_lineno=1295, end_col_offset=99), lineno=1295, col_offset=8, end_lineno=1295, end_col_offset=99)], lineno=1294, col_offset=4, end_lineno=1295, end_col_offset=99), Assign(targets=[Name(id='effective', ctx=Store(), lineno=1296, col_offset=4, end_lineno=1296, end_col_offset=13)], value=Name(id='requested', ctx=Load(), lineno=1296, col_offset=16, end_lineno=1296, end_col_offset=25), lineno=1296, col_offset=4, end_lineno=1296, end_col_offset=25), If(test=Compare(left=Name(id='effective', ctx=Load(), lineno=1297, col_offset=7, end_lineno=1297, end_col_offset=16), ops=[LtE()], comparators=[Constant(value=0, lineno=1297, col_offset=20, end_lineno=1297, end_col_offset=21)], lineno=1297, col_offset=7, end_lineno=1297, end_col_offset=21), body=[Assign(targets=[Name(id='effective', ctx=Store(), lineno=1298, col_offset=8, end_lineno=1298, end_col_offset=17)], value=Constant(value=1, lineno=1298, col_offset=20, end_lineno=1298, end_col_offset=21), lineno=1298, col_offset=8, end_lineno=1298, end_col_offset=21)], lineno=1297, col_offset=4, end_lineno=1298, end_col_offset=21), Return(value=Call(func=Name(id='min', ctx=Load(), lineno=1299, col_offset=11, end_lineno=1299, end_col_offset=14), args=[Name(id='effective', ctx=Load(), lineno=1299, col_offset=15, end_lineno=1299, end_col_offset=24), Name(id='max_results', ctx=Load(), lineno=1299, col_offset=26, end_lineno=1299, end_col_offset=37)], lineno=1299, col_offset=11, end_lineno=1299, end_col_offset=38), lineno=1299, col_offset=4, end_lineno=1299, end_col_offset=38)], returns=Name(id='int', ctx=Load(), lineno=1291, col_offset=72, end_lineno=1291, end_col_offset=75), lineno=1291, col_offset=0, end_lineno=1299, end_col_offset=38), FunctionDef(name='_dedupe_preserve_order', args=arguments(args=[arg(arg='ids', annotation=Subscript(value=Name(id='list', ctx=Load(), lineno=1302, col_offset=32, end_lineno=1302, end_col_offset=36), slice=Name(id='int', ctx=Load(), lineno=1302, col_offset=37, end_lineno=1302, end_col_offset=40), ctx=Load(), lineno=1302, col_offset=32, end_lineno=1302, end_col_offset=41), lineno=1302, col_offset=27, end_lineno=1302, end_col_offset=41)]), body=[AnnAssign(target=Name(id='seen', ctx=Store(), lineno=1303, col_offset=4, end_lineno=1303, end_col_offset=8), annotation=Subscript(value=Name(id='set', ctx=Load(), lineno=1303, col_offset=10, end_lineno=1303, end_col_offset=13), slice=Name(id='int', ctx=Load(), lineno=1303, col_offset=14, end_lineno=1303, end_col_offset=17), ctx=Load(), lineno=1303, col_offset=10, end_lineno=1303, end_col_offset=18), value=Call(func=Name(id='set', ctx=Load(), lineno=1303, col_offset=21, end_lineno=1303, end_col_offset=24), lineno=1303, col_offset=21, end_lineno=1303, end_col_offset=26), simple=1, lineno=1303, col_offset=4, end_lineno=1303, end_col_offset=26), AnnAssign(target=Name(id='ordered', ctx=Store(), lineno=1304, col_offset=4, end_lineno=1304, end_col_offset=11), annotation=Subscript(value=Name(id='list', ctx=Load(), lineno=1304, col_offset=13, end_lineno=1304, end_col_offset=17), slice=Name(id='int', ctx=Load(), lineno=1304, col_offset=18, end_lineno=1304, end_col_offset=21), ctx=Load(), lineno=1304, col_offset=13, end_lineno=1304, end_col_offset=22), value=List(ctx=Load(), lineno=1304, col_offset=25, end_lineno=1304, end_col_offset=27), simple=1, lineno=1304, col_offset=4, end_lineno=1304, end_col_offset=27), For(target=Name(id='chunk_id', ctx=Store(), lineno=1305, col_offset=8, end_lineno=1305, end_col_offset=16), iter=Name(id='ids', ctx=Load(), lineno=1305, col_offset=20, end_lineno=1305, end_col_offset=23), body=[If(test=Compare(left=Name(id='chunk_id', ctx=Load(), lineno=1306, col_offset=11, end_lineno=1306, end_col_offset=19), ops=[In()], comparators=[Name(id='seen', ctx=Load(), lineno=1306, col_offset=23, end_lineno=1306, end_col_offset=27)], lineno=1306, col_offset=11, end_lineno=1306, end_col_offset=27), body=[Continue(lineno=1307, col_offset=12, end_lineno=1307, end_col_offset=20)], lineno=1306, col_offset=8, end_lineno=1307, end_col_offset=20), Expr(value=Call(func=Attribute(value=Name(id='seen', ctx=Load(), lineno=1308, col_offset=8, end_lineno=1308, end_col_offset=12), attr='add', ctx=Load(), lineno=1308, col_offset=8, end_lineno=1308, end_col_offset=16), args=[Name(id='chunk_id', ctx=Load(), lineno=1308, col_offset=17, end_lineno=1308, end_col_offset=25)], lineno=1308, col_offset=8, end_lineno=1308, end_col_offset=26), lineno=1308, col_offset=8, end_lineno=1308, end_col_offset=26), Expr(value=Call(func=Attribute(value=Name(id='ordered', ctx=Load(), lineno=1309, col_offset=8, end_lineno=1309, end_col_offset=15), attr='append', ctx=Load(), lineno=1309, col_offset=8, end_lineno=1309, end_col_offset=22), args=[Name(id='chunk_id', ctx=Load(), lineno=1309, col_offset=23, end_lineno=1309, end_col_offset=31)], lineno=1309, col_offset=8, end_lineno=1309, end_col_offset=32), lineno=1309, col_offset=8, end_lineno=1309, end_col_offset=32)], lineno=1305, col_offset=4, end_lineno=1309, end_col_offset=32), Return(value=Name(id='ordered', ctx=Load(), lineno=1310, col_offset=11, end_lineno=1310, end_col_offset=18), lineno=1310, col_offset=4, end_lineno=1310, end_col_offset=18)], returns=Subscript(value=Name(id='list', ctx=Load(), lineno=1302, col_offset=46, end_lineno=1302, end_col_offset=50), slice=Name(id='int', ctx=Load(), lineno=1302, col_offset=51, end_lineno=1302, end_col_offset=54), ctx=Load(), lineno=1302, col_offset=46, end_lineno=1302, end_col_offset=55), lineno=1302, col_offset=0, end_lineno=1310, end_col_offset=18), ClassDef(name='WarpOutcome', body=[Expr(value=Constant(value='Container describing the results of the optional WARP stage.', lineno=1315, col_offset=4, end_lineno=1315, end_col_offset=70), lineno=1315, col_offset=4, end_lineno=1315, end_col_offset=70), AnnAssign(target=Name(id='hits', ctx=Store(), lineno=1317, col_offset=4, end_lineno=1317, end_col_offset=8), annotation=Subscript(value=Name(id='list', ctx=Load(), lineno=1317, col_offset=10, end_lineno=1317, end_col_offset=14), slice=Subscript(value=Name(id='tuple', ctx=Load(), lineno=1317, col_offset=15, end_lineno=1317, end_col_offset=20), slice=Tuple(elts=[Name(id='int', ctx=Load(), lineno=1317, col_offset=21, end_lineno=1317, end_col_offset=24), Name(id='float', ctx=Load(), lineno=1317, col_offset=26, end_lineno=1317, end_col_offset=31)], ctx=Load(), lineno=1317, col_offset=21, end_lineno=1317, end_col_offset=31), ctx=Load(), lineno=1317, col_offset=15, end_lineno=1317, end_col_offset=32), ctx=Load(), lineno=1317, col_offset=10, end_lineno=1317, end_col_offset=33), simple=1, lineno=1317, col_offset=4, end_lineno=1317, end_col_offset=33), AnnAssign(target=Name(id='notes', ctx=Store(), lineno=1318, col_offset=4, end_lineno=1318, end_col_offset=9), annotation=Subscript(value=Name(id='list', ctx=Load(), lineno=1318, col_offset=11, end_lineno=1318, end_col_offset=15), slice=Name(id='str', ctx=Load(), lineno=1318, col_offset=16, end_lineno=1318, end_col_offset=19), ctx=Load(), lineno=1318, col_offset=11, end_lineno=1318, end_col_offset=20), simple=1, lineno=1318, col_offset=4, end_lineno=1318, end_col_offset=20), AnnAssign(target=Name(id='timing', ctx=Store(), lineno=1319, col_offset=4, end_lineno=1319, end_col_offset=10), annotation=BinOp(left=Name(id='StageTiming', ctx=Load(), lineno=1319, col_offset=12, end_lineno=1319, end_col_offset=23), op=BitOr(), right=Constant(value=None, lineno=1319, col_offset=26, end_lineno=1319, end_col_offset=30), lineno=1319, col_offset=12, end_lineno=1319, end_col_offset=30), simple=1, lineno=1319, col_offset=4, end_lineno=1319, end_col_offset=30), AnnAssign(target=Name(id='explainability', ctx=Store(), lineno=1320, col_offset=4, end_lineno=1320, end_col_offset=18), annotation=Subscript(value=Name(id='tuple', ctx=Load(), lineno=1320, col_offset=20, end_lineno=1320, end_col_offset=25), slice=Tuple(elts=[Subscript(value=Name(id='tuple', ctx=Load(), lineno=1320, col_offset=26, end_lineno=1320, end_col_offset=31), slice=Tuple(elts=[Name(id='int', ctx=Load(), lineno=1320, col_offset=32, end_lineno=1320, end_col_offset=35), Subscript(value=Name(id='dict', ctx=Load(), lineno=1320, col_offset=37, end_lineno=1320, end_col_offset=41), slice=Tuple(elts=[Name(id='str', ctx=Load(), lineno=1320, col_offset=42, end_lineno=1320, end_col_offset=45), Name(id='Any', ctx=Load(), lineno=1320, col_offset=47, end_lineno=1320, end_col_offset=50)], ctx=Load(), lineno=1320, col_offset=42, end_lineno=1320, end_col_offset=50), ctx=Load(), lineno=1320, col_offset=37, end_lineno=1320, end_col_offset=51)], ctx=Load(), lineno=1320, col_offset=32, end_lineno=1320, end_col_offset=51), ctx=Load(), lineno=1320, col_offset=26, end_lineno=1320, end_col_offset=52), Constant(value=Ellipsis, lineno=1320, col_offset=54, end_lineno=1320, end_col_offset=57)], ctx=Load(), lineno=1320, col_offset=26, end_lineno=1320, end_col_offset=57), ctx=Load(), lineno=1320, col_offset=20, end_lineno=1320, end_col_offset=58), simple=1, lineno=1320, col_offset=4, end_lineno=1320, end_col_offset=58), AnnAssign(target=Name(id='channel', ctx=Store(), lineno=1321, col_offset=4, end_lineno=1321, end_col_offset=11), annotation=Name(id='str', ctx=Load(), lineno=1321, col_offset=13, end_lineno=1321, end_col_offset=16), value=Constant(value='warp', lineno=1321, col_offset=19, end_lineno=1321, end_col_offset=25), simple=1, lineno=1321, col_offset=4, end_lineno=1321, end_col_offset=25)], decorator_list=[Call(func=Name(id='dataclass', ctx=Load(), lineno=1313, col_offset=1, end_lineno=1313, end_col_offset=10), keywords=[keyword(arg='slots', value=Constant(value=True, lineno=1313, col_offset=17, end_lineno=1313, end_col_offset=21), lineno=1313, col_offset=11, end_lineno=1313, end_col_offset=21), keyword(arg='frozen', value=Constant(value=True, lineno=1313, col_offset=30, end_lineno=1313, end_col_offset=34), lineno=1313, col_offset=23, end_lineno=1313, end_col_offset=34)], lineno=1313, col_offset=1, end_lineno=1313, end_col_offset=35)], lineno=1314, col_offset=0, end_lineno=1321, end_col_offset=25), ClassDef(name='FusionRequest', body=[Expr(value=Constant(value='Inputs required to execute the fusion stage.', lineno=1326, col_offset=4, end_lineno=1326, end_col_offset=54), lineno=1326, col_offset=4, end_lineno=1326, end_col_offset=54), AnnAssign(target=Name(id='query', ctx=Store(), lineno=1328, col_offset=4, end_lineno=1328, end_col_offset=9), annotation=Name(id='str', ctx=Load(), lineno=1328, col_offset=11, end_lineno=1328, end_col_offset=14), simple=1, lineno=1328, col_offset=4, end_lineno=1328, end_col_offset=14), AnnAssign(target=Name(id='coderank_hits', ctx=Store(), lineno=1329, col_offset=4, end_lineno=1329, end_col_offset=17), annotation=Subscript(value=Name(id='Sequence', ctx=Load(), lineno=1329, col_offset=19, end_lineno=1329, end_col_offset=27), slice=Subscript(value=Name(id='tuple', ctx=Load(), lineno=1329, col_offset=28, end_lineno=1329, end_col_offset=33), slice=Tuple(elts=[Name(id='int', ctx=Load(), lineno=1329, col_offset=34, end_lineno=1329, end_col_offset=37), Name(id='float', ctx=Load(), lineno=1329, col_offset=39, end_lineno=1329, end_col_offset=44)], ctx=Load(), lineno=1329, col_offset=34, end_lineno=1329, end_col_offset=44), ctx=Load(), lineno=1329, col_offset=28, end_lineno=1329, end_col_offset=45), ctx=Load(), lineno=1329, col_offset=19, end_lineno=1329, end_col_offset=46), simple=1, lineno=1329, col_offset=4, end_lineno=1329, end_col_offset=46), AnnAssign(target=Name(id='warp_hits', ctx=Store(), lineno=1330, col_offset=4, end_lineno=1330, end_col_offset=13), annotation=Subscript(value=Name(id='list', ctx=Load(), lineno=1330, col_offset=15, end_lineno=1330, end_col_offset=19), slice=Subscript(value=Name(id='tuple', ctx=Load(), lineno=1330, col_offset=20, end_lineno=1330, end_col_offset=25), slice=Tuple(elts=[Name(id='int', ctx=Load(), lineno=1330, col_offset=26, end_lineno=1330, end_col_offset=29), Name(id='float', ctx=Load(), lineno=1330, col_offset=31, end_lineno=1330, end_col_offset=36)], ctx=Load(), lineno=1330, col_offset=26, end_lineno=1330, end_col_offset=36), ctx=Load(), lineno=1330, col_offset=20, end_lineno=1330, end_col_offset=37), ctx=Load(), lineno=1330, col_offset=15, end_lineno=1330, end_col_offset=38), simple=1, lineno=1330, col_offset=4, end_lineno=1330, end_col_offset=38), AnnAssign(target=Name(id='warp_channel', ctx=Store(), lineno=1331, col_offset=4, end_lineno=1331, end_col_offset=16), annotation=Name(id='str', ctx=Load(), lineno=1331, col_offset=18, end_lineno=1331, end_col_offset=21), simple=1, lineno=1331, col_offset=4, end_lineno=1331, end_col_offset=21), AnnAssign(target=Name(id='effective_limit', ctx=Store(), lineno=1332, col_offset=4, end_lineno=1332, end_col_offset=19), annotation=Name(id='int', ctx=Load(), lineno=1332, col_offset=21, end_lineno=1332, end_col_offset=24), simple=1, lineno=1332, col_offset=4, end_lineno=1332, end_col_offset=24), AnnAssign(target=Name(id='weights', ctx=Store(), lineno=1333, col_offset=4, end_lineno=1333, end_col_offset=11), annotation=Subscript(value=Name(id='Mapping', ctx=Load(), lineno=1333, col_offset=13, end_lineno=1333, end_col_offset=20), slice=Tuple(elts=[Name(id='str', ctx=Load(), lineno=1333, col_offset=21, end_lineno=1333, end_col_offset=24), Name(id='float', ctx=Load(), lineno=1333, col_offset=26, end_lineno=1333, end_col_offset=31)], ctx=Load(), lineno=1333, col_offset=21, end_lineno=1333, end_col_offset=31), ctx=Load(), lineno=1333, col_offset=13, end_lineno=1333, end_col_offset=32), simple=1, lineno=1333, col_offset=4, end_lineno=1333, end_col_offset=32)], decorator_list=[Call(func=Name(id='dataclass', ctx=Load(), lineno=1324, col_offset=1, end_lineno=1324, end_col_offset=10), keywords=[keyword(arg='slots', value=Constant(value=True, lineno=1324, col_offset=17, end_lineno=1324, end_col_offset=21), lineno=1324, col_offset=11, end_lineno=1324, end_col_offset=21), keyword(arg='frozen', value=Constant(value=True, lineno=1324, col_offset=30, end_lineno=1324, end_col_offset=34), lineno=1324, col_offset=23, end_lineno=1324, end_col_offset=34)], lineno=1324, col_offset=1, end_lineno=1324, end_col_offset=35)], lineno=1325, col_offset=0, end_lineno=1333, end_col_offset=32), ClassDef(name='MethodContext', body=[Expr(value=Constant(value='Inputs required to build the MethodInfo payload.', lineno=1338, col_offset=4, end_lineno=1338, end_col_offset=58), lineno=1338, col_offset=4, end_lineno=1338, end_col_offset=58), AnnAssign(target=Name(id='findings_count', ctx=Store(), lineno=1340, col_offset=4, end_lineno=1340, end_col_offset=18), annotation=Name(id='int', ctx=Load(), lineno=1340, col_offset=20, end_lineno=1340, end_col_offset=23), simple=1, lineno=1340, col_offset=4, end_lineno=1340, end_col_offset=23), AnnAssign(target=Name(id='requested_limit', ctx=Store(), lineno=1341, col_offset=4, end_lineno=1341, end_col_offset=19), annotation=Name(id='int', ctx=Load(), lineno=1341, col_offset=21, end_lineno=1341, end_col_offset=24), simple=1, lineno=1341, col_offset=4, end_lineno=1341, end_col_offset=24), AnnAssign(target=Name(id='effective_limit', ctx=Store(), lineno=1342, col_offset=4, end_lineno=1342, end_col_offset=19), annotation=Name(id='int', ctx=Load(), lineno=1342, col_offset=21, end_lineno=1342, end_col_offset=24), simple=1, lineno=1342, col_offset=4, end_lineno=1342, end_col_offset=24), AnnAssign(target=Name(id='start_time', ctx=Store(), lineno=1343, col_offset=4, end_lineno=1343, end_col_offset=14), annotation=Name(id='float', ctx=Load(), lineno=1343, col_offset=16, end_lineno=1343, end_col_offset=21), simple=1, lineno=1343, col_offset=4, end_lineno=1343, end_col_offset=21), AnnAssign(target=Name(id='channels', ctx=Store(), lineno=1344, col_offset=4, end_lineno=1344, end_col_offset=12), annotation=Subscript(value=Name(id='list', ctx=Load(), lineno=1344, col_offset=14, end_lineno=1344, end_col_offset=18), slice=Name(id='str', ctx=Load(), lineno=1344, col_offset=19, end_lineno=1344, end_col_offset=22), ctx=Load(), lineno=1344, col_offset=14, end_lineno=1344, end_col_offset=23), simple=1, lineno=1344, col_offset=4, end_lineno=1344, end_col_offset=23), AnnAssign(target=Name(id='stages', ctx=Store(), lineno=1345, col_offset=4, end_lineno=1345, end_col_offset=10), annotation=BinOp(left=Subscript(value=Name(id='Sequence', ctx=Load(), lineno=1345, col_offset=12, end_lineno=1345, end_col_offset=20), slice=Name(id='StageTiming', ctx=Load(), lineno=1345, col_offset=21, end_lineno=1345, end_col_offset=32), ctx=Load(), lineno=1345, col_offset=12, end_lineno=1345, end_col_offset=33), op=BitOr(), right=Constant(value=None, lineno=1345, col_offset=36, end_lineno=1345, end_col_offset=40), lineno=1345, col_offset=12, end_lineno=1345, end_col_offset=40), simple=1, lineno=1345, col_offset=4, end_lineno=1345, end_col_offset=40), AnnAssign(target=Name(id='notes', ctx=Store(), lineno=1346, col_offset=4, end_lineno=1346, end_col_offset=9), annotation=BinOp(left=Subscript(value=Name(id='tuple', ctx=Load(), lineno=1346, col_offset=11, end_lineno=1346, end_col_offset=16), slice=Tuple(elts=[Name(id='str', ctx=Load(), lineno=1346, col_offset=17, end_lineno=1346, end_col_offset=20), Constant(value=Ellipsis, lineno=1346, col_offset=22, end_lineno=1346, end_col_offset=25)], ctx=Load(), lineno=1346, col_offset=17, end_lineno=1346, end_col_offset=25), ctx=Load(), lineno=1346, col_offset=11, end_lineno=1346, end_col_offset=26), op=BitOr(), right=Constant(value=None, lineno=1346, col_offset=29, end_lineno=1346, end_col_offset=33), lineno=1346, col_offset=11, end_lineno=1346, end_col_offset=33), value=Constant(value=None, lineno=1346, col_offset=36, end_lineno=1346, end_col_offset=40), simple=1, lineno=1346, col_offset=4, end_lineno=1346, end_col_offset=40), AnnAssign(target=Name(id='explainability', ctx=Store(), lineno=1347, col_offset=4, end_lineno=1347, end_col_offset=18), annotation=BinOp(left=Subscript(value=Name(id='dict', ctx=Load(), lineno=1347, col_offset=20, end_lineno=1347, end_col_offset=24), slice=Tuple(elts=[Name(id='str', ctx=Load(), lineno=1347, col_offset=25, end_lineno=1347, end_col_offset=28), Subscript(value=Name(id='list', ctx=Load(), lineno=1347, col_offset=30, end_lineno=1347, end_col_offset=34), slice=Subscript(value=Name(id='dict', ctx=Load(), lineno=1347, col_offset=35, end_lineno=1347, end_col_offset=39), slice=Tuple(elts=[Name(id='str', ctx=Load(), lineno=1347, col_offset=40, end_lineno=1347, end_col_offset=43), Name(id='Any', ctx=Load(), lineno=1347, col_offset=45, end_lineno=1347, end_col_offset=48)], ctx=Load(), lineno=1347, col_offset=40, end_lineno=1347, end_col_offset=48), ctx=Load(), lineno=1347, col_offset=35, end_lineno=1347, end_col_offset=49), ctx=Load(), lineno=1347, col_offset=30, end_lineno=1347, end_col_offset=50)], ctx=Load(), lineno=1347, col_offset=25, end_lineno=1347, end_col_offset=50), ctx=Load(), lineno=1347, col_offset=20, end_lineno=1347, end_col_offset=51), op=BitOr(), right=Constant(value=None, lineno=1347, col_offset=54, end_lineno=1347, end_col_offset=58), lineno=1347, col_offset=20, end_lineno=1347, end_col_offset=58), value=Constant(value=None, lineno=1347, col_offset=61, end_lineno=1347, end_col_offset=65), simple=1, lineno=1347, col_offset=4, end_lineno=1347, end_col_offset=65)], decorator_list=[Call(func=Name(id='dataclass', ctx=Load(), lineno=1336, col_offset=1, end_lineno=1336, end_col_offset=10), keywords=[keyword(arg='slots', value=Constant(value=True, lineno=1336, col_offset=17, end_lineno=1336, end_col_offset=21), lineno=1336, col_offset=11, end_lineno=1336, end_col_offset=21), keyword(arg='frozen', value=Constant(value=True, lineno=1336, col_offset=30, end_lineno=1336, end_col_offset=34), lineno=1336, col_offset=23, end_lineno=1336, end_col_offset=34)], lineno=1336, col_offset=1, end_lineno=1336, end_col_offset=35)], lineno=1337, col_offset=0, end_lineno=1347, end_col_offset=65)])