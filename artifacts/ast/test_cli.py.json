Module(body=[Expr(value=Constant(value='Tests for the download CLI migrating to the shared tooling standard.', lineno=1, col_offset=0, end_lineno=1, end_col_offset=74), lineno=1, col_offset=0, end_lineno=1, end_col_offset=74), ImportFrom(module='__future__', names=[alias(name='annotations', lineno=3, col_offset=23, end_lineno=3, end_col_offset=34)], level=0, lineno=3, col_offset=0, end_lineno=3, end_col_offset=34), Import(names=[alias(name='json', lineno=5, col_offset=7, end_lineno=5, end_col_offset=11)], lineno=5, col_offset=0, end_lineno=5, end_col_offset=11), ImportFrom(module='pathlib', names=[alias(name='Path', lineno=6, col_offset=20, end_lineno=6, end_col_offset=24)], level=0, lineno=6, col_offset=0, end_lineno=6, end_col_offset=24), ImportFrom(module='typer.testing', names=[alias(name='CliRunner', lineno=8, col_offset=26, end_lineno=8, end_col_offset=35)], level=0, lineno=8, col_offset=0, end_lineno=8, end_col_offset=35), ImportFrom(module='download', names=[alias(name='cli', lineno=10, col_offset=21, end_lineno=10, end_col_offset=24)], level=0, lineno=10, col_offset=0, end_lineno=10, end_col_offset=24), FunctionDef(name='test_harvest_emits_envelope', args=arguments(args=[arg(arg='tmp_path', annotation=Name(id='Path', ctx=Load(), lineno=13, col_offset=42, end_lineno=13, end_col_offset=46), lineno=13, col_offset=32, end_lineno=13, end_col_offset=46), arg(arg='monkeypatch', lineno=13, col_offset=48, end_lineno=13, end_col_offset=59)]), body=[Expr(value=Constant(value='The harvest command should write a structured CLI envelope on success.', lineno=14, col_offset=4, end_lineno=14, end_col_offset=80), lineno=14, col_offset=4, end_lineno=14, end_col_offset=80), Expr(value=Call(func=Attribute(value=Name(id='monkeypatch', ctx=Load(), lineno=15, col_offset=4, end_lineno=15, end_col_offset=15), attr='setattr', ctx=Load(), lineno=15, col_offset=4, end_lineno=15, end_col_offset=23), args=[Name(id='cli', ctx=Load(), lineno=15, col_offset=24, end_lineno=15, end_col_offset=27), Constant(value='CLI_ENVELOPE_DIR', lineno=15, col_offset=29, end_lineno=15, end_col_offset=47), Name(id='tmp_path', ctx=Load(), lineno=15, col_offset=49, end_lineno=15, end_col_offset=57)], lineno=15, col_offset=4, end_lineno=15, end_col_offset=58), lineno=15, col_offset=4, end_lineno=15, end_col_offset=58), Assign(targets=[Name(id='expected_path', ctx=Store(), lineno=16, col_offset=4, end_lineno=16, end_col_offset=17)], value=BinOp(left=Name(id='tmp_path', ctx=Load(), lineno=16, col_offset=20, end_lineno=16, end_col_offset=28), op=Div(), right=JoinedStr(values=[FormattedValue(value=Attribute(value=Attribute(value=Name(id='cli', ctx=Load(), lineno=16, col_offset=34, end_lineno=16, end_col_offset=37), attr='CLI_SETTINGS', ctx=Load(), lineno=16, col_offset=34, end_lineno=16, end_col_offset=50), attr='bin_name', ctx=Load(), lineno=16, col_offset=34, end_lineno=16, end_col_offset=59), conversion=-1, lineno=16, col_offset=33, end_lineno=16, end_col_offset=60), Constant(value='-', lineno=16, col_offset=60, end_lineno=16, end_col_offset=61), FormattedValue(value=Attribute(value=Name(id='cli', ctx=Load(), lineno=16, col_offset=62, end_lineno=16, end_col_offset=65), attr='CLI_COMMAND', ctx=Load(), lineno=16, col_offset=62, end_lineno=16, end_col_offset=77), conversion=-1, lineno=16, col_offset=61, end_lineno=16, end_col_offset=78), Constant(value='-harvest.json', lineno=16, col_offset=78, end_lineno=16, end_col_offset=91)], lineno=16, col_offset=31, end_lineno=16, end_col_offset=92), lineno=16, col_offset=20, end_lineno=16, end_col_offset=92), lineno=16, col_offset=4, end_lineno=16, end_col_offset=92), Assign(targets=[Name(id='runner', ctx=Store(), lineno=18, col_offset=4, end_lineno=18, end_col_offset=10)], value=Call(func=Name(id='CliRunner', ctx=Load(), lineno=18, col_offset=13, end_lineno=18, end_col_offset=22), lineno=18, col_offset=13, end_lineno=18, end_col_offset=24), lineno=18, col_offset=4, end_lineno=18, end_col_offset=24), Assign(targets=[Name(id='result', ctx=Store(), lineno=19, col_offset=4, end_lineno=19, end_col_offset=10)], value=Call(func=Attribute(value=Name(id='runner', ctx=Load(), lineno=19, col_offset=13, end_lineno=19, end_col_offset=19), attr='invoke', ctx=Load(), lineno=19, col_offset=13, end_lineno=19, end_col_offset=26), args=[Attribute(value=Name(id='cli', ctx=Load(), lineno=20, col_offset=8, end_lineno=20, end_col_offset=11), attr='app', ctx=Load(), lineno=20, col_offset=8, end_lineno=20, end_col_offset=15), List(elts=[Constant(value='download', lineno=22, col_offset=12, end_lineno=22, end_col_offset=22), Constant(value='harvest', lineno=23, col_offset=12, end_lineno=23, end_col_offset=21), Constant(value='foundation models', lineno=24, col_offset=12, end_lineno=24, end_col_offset=31), Constant(value='--years', lineno=25, col_offset=12, end_lineno=25, end_col_offset=21), Constant(value='>=2021', lineno=26, col_offset=12, end_lineno=26, end_col_offset=20), Constant(value='--max-works', lineno=27, col_offset=12, end_lineno=27, end_col_offset=25), Constant(value='100', lineno=28, col_offset=12, end_lineno=28, end_col_offset=17)], ctx=Load(), lineno=21, col_offset=8, end_lineno=29, end_col_offset=9)], lineno=19, col_offset=13, end_lineno=30, end_col_offset=5), lineno=19, col_offset=4, end_lineno=30, end_col_offset=5), Assert(test=Compare(left=Attribute(value=Name(id='result', ctx=Load(), lineno=32, col_offset=11, end_lineno=32, end_col_offset=17), attr='exit_code', ctx=Load(), lineno=32, col_offset=11, end_lineno=32, end_col_offset=27), ops=[Eq()], comparators=[Constant(value=0, lineno=32, col_offset=31, end_lineno=32, end_col_offset=32)], lineno=32, col_offset=11, end_lineno=32, end_col_offset=32), lineno=32, col_offset=4, end_lineno=32, end_col_offset=32), Assert(test=Compare(left=Constant(value='dry-run', lineno=33, col_offset=11, end_lineno=33, end_col_offset=20), ops=[In()], comparators=[Attribute(value=Name(id='result', ctx=Load(), lineno=33, col_offset=24, end_lineno=33, end_col_offset=30), attr='stdout', ctx=Load(), lineno=33, col_offset=24, end_lineno=33, end_col_offset=37)], lineno=33, col_offset=11, end_lineno=33, end_col_offset=37), lineno=33, col_offset=4, end_lineno=33, end_col_offset=37), Assign(targets=[Name(id='envelope', ctx=Store(), lineno=35, col_offset=4, end_lineno=35, end_col_offset=12)], value=Call(func=Attribute(value=Name(id='json', ctx=Load(), lineno=35, col_offset=15, end_lineno=35, end_col_offset=19), attr='loads', ctx=Load(), lineno=35, col_offset=15, end_lineno=35, end_col_offset=25), args=[Call(func=Attribute(value=Name(id='expected_path', ctx=Load(), lineno=35, col_offset=26, end_lineno=35, end_col_offset=39), attr='read_text', ctx=Load(), lineno=35, col_offset=26, end_lineno=35, end_col_offset=49), keywords=[keyword(arg='encoding', value=Constant(value='utf-8', lineno=35, col_offset=59, end_lineno=35, end_col_offset=66), lineno=35, col_offset=50, end_lineno=35, end_col_offset=66)], lineno=35, col_offset=26, end_lineno=35, end_col_offset=67)], lineno=35, col_offset=15, end_lineno=35, end_col_offset=68), lineno=35, col_offset=4, end_lineno=35, end_col_offset=68), Assert(test=Compare(left=Subscript(value=Name(id='envelope', ctx=Load(), lineno=36, col_offset=11, end_lineno=36, end_col_offset=19), slice=Constant(value='command', lineno=36, col_offset=20, end_lineno=36, end_col_offset=29), ctx=Load(), lineno=36, col_offset=11, end_lineno=36, end_col_offset=30), ops=[Eq()], comparators=[Attribute(value=Name(id='cli', ctx=Load(), lineno=36, col_offset=34, end_lineno=36, end_col_offset=37), attr='CLI_COMMAND', ctx=Load(), lineno=36, col_offset=34, end_lineno=36, end_col_offset=49)], lineno=36, col_offset=11, end_lineno=36, end_col_offset=49), lineno=36, col_offset=4, end_lineno=36, end_col_offset=49), Assert(test=Compare(left=Subscript(value=Name(id='envelope', ctx=Load(), lineno=37, col_offset=11, end_lineno=37, end_col_offset=19), slice=Constant(value='subcommand', lineno=37, col_offset=20, end_lineno=37, end_col_offset=32), ctx=Load(), lineno=37, col_offset=11, end_lineno=37, end_col_offset=33), ops=[Eq()], comparators=[Constant(value='harvest', lineno=37, col_offset=37, end_lineno=37, end_col_offset=46)], lineno=37, col_offset=11, end_lineno=37, end_col_offset=46), lineno=37, col_offset=4, end_lineno=37, end_col_offset=46), Assert(test=Compare(left=Subscript(value=Name(id='envelope', ctx=Load(), lineno=38, col_offset=11, end_lineno=38, end_col_offset=19), slice=Constant(value='status', lineno=38, col_offset=20, end_lineno=38, end_col_offset=28), ctx=Load(), lineno=38, col_offset=11, end_lineno=38, end_col_offset=29), ops=[Eq()], comparators=[Constant(value='success', lineno=38, col_offset=33, end_lineno=38, end_col_offset=42)], lineno=38, col_offset=11, end_lineno=38, end_col_offset=42), lineno=38, col_offset=4, end_lineno=38, end_col_offset=42), Assert(test=Compare(left=Subscript(value=Subscript(value=Subscript(value=Name(id='envelope', ctx=Load(), lineno=39, col_offset=11, end_lineno=39, end_col_offset=19), slice=Constant(value='files', lineno=39, col_offset=20, end_lineno=39, end_col_offset=27), ctx=Load(), lineno=39, col_offset=11, end_lineno=39, end_col_offset=28), slice=Constant(value=0, lineno=39, col_offset=29, end_lineno=39, end_col_offset=30), ctx=Load(), lineno=39, col_offset=11, end_lineno=39, end_col_offset=31), slice=Constant(value='status', lineno=39, col_offset=32, end_lineno=39, end_col_offset=40), ctx=Load(), lineno=39, col_offset=11, end_lineno=39, end_col_offset=41), ops=[Eq()], comparators=[Constant(value='success', lineno=39, col_offset=45, end_lineno=39, end_col_offset=54)], lineno=39, col_offset=11, end_lineno=39, end_col_offset=54), lineno=39, col_offset=4, end_lineno=39, end_col_offset=54)], returns=Constant(value=None, lineno=13, col_offset=64, end_lineno=13, end_col_offset=68), lineno=13, col_offset=0, end_lineno=39, end_col_offset=54)])