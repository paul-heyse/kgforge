Module(body=[Expr(value=Constant(value='Hybrid retrieval utilities combining FAISS, BM25, and SPLADE.', lineno=1, col_offset=0, end_lineno=1, end_col_offset=67), lineno=1, col_offset=0, end_lineno=1, end_col_offset=67), ImportFrom(module='__future__', names=[alias(name='annotations', lineno=3, col_offset=23, end_lineno=3, end_col_offset=34)], level=0, lineno=3, col_offset=0, end_lineno=3, end_col_offset=34), ImportFrom(module='collections.abc', names=[alias(name='Mapping', lineno=5, col_offset=28, end_lineno=5, end_col_offset=35), alias(name='Sequence', lineno=5, col_offset=37, end_lineno=5, end_col_offset=45)], level=0, lineno=5, col_offset=0, end_lineno=5, end_col_offset=45), ImportFrom(module='importlib', names=[alias(name='import_module', lineno=6, col_offset=22, end_lineno=6, end_col_offset=35)], level=0, lineno=6, col_offset=0, end_lineno=6, end_col_offset=35), ImportFrom(module='pathlib', names=[alias(name='Path', lineno=7, col_offset=20, end_lineno=7, end_col_offset=24)], level=0, lineno=7, col_offset=0, end_lineno=7, end_col_offset=24), ImportFrom(module='threading', names=[alias(name='Lock', lineno=8, col_offset=22, end_lineno=8, end_col_offset=26)], level=0, lineno=8, col_offset=0, end_lineno=8, end_col_offset=26), ImportFrom(module='typing', names=[alias(name='TYPE_CHECKING', lineno=9, col_offset=19, end_lineno=9, end_col_offset=32)], level=0, lineno=9, col_offset=0, end_lineno=9, end_col_offset=32), ImportFrom(module='codeintel_rev.retrieval.fusion', names=[alias(name='fuse_weighted_rrf', lineno=11, col_offset=43, end_lineno=11, end_col_offset=60)], level=0, lineno=11, col_offset=0, end_lineno=11, end_col_offset=60), ImportFrom(module='codeintel_rev.retrieval.types', names=[alias(name='ChannelHit', lineno=13, col_offset=4, end_lineno=13, end_col_offset=14), alias(name='HybridResultDoc', lineno=14, col_offset=4, end_lineno=14, end_col_offset=19), alias(name='HybridSearchResult', lineno=15, col_offset=4, end_lineno=15, end_col_offset=22)], level=0, lineno=12, col_offset=0, end_lineno=16, end_col_offset=1), ImportFrom(module='kgfoundry_common.logging', names=[alias(name='get_logger', lineno=17, col_offset=37, end_lineno=17, end_col_offset=47)], level=0, lineno=17, col_offset=0, end_lineno=17, end_col_offset=47), If(test=Name(id='TYPE_CHECKING', ctx=Load(), lineno=19, col_offset=3, end_lineno=19, end_col_offset=16), body=[ImportFrom(module='codeintel_rev.app.config_context', names=[alias(name='ResolvedPaths', lineno=20, col_offset=49, end_lineno=20, end_col_offset=62)], level=0, lineno=20, col_offset=4, end_lineno=20, end_col_offset=62), ImportFrom(module='codeintel_rev.config.settings', names=[alias(name='Settings', lineno=21, col_offset=46, end_lineno=21, end_col_offset=54), alias(name='SpladeConfig', lineno=21, col_offset=56, end_lineno=21, end_col_offset=68)], level=0, lineno=21, col_offset=4, end_lineno=21, end_col_offset=68)], lineno=19, col_offset=0, end_lineno=21, end_col_offset=68), Assign(targets=[Name(id='LOGGER', ctx=Store(), lineno=23, col_offset=0, end_lineno=23, end_col_offset=6)], value=Call(func=Name(id='get_logger', ctx=Load(), lineno=23, col_offset=9, end_lineno=23, end_col_offset=19), args=[Name(id='__name__', ctx=Load(), lineno=23, col_offset=20, end_lineno=23, end_col_offset=28)], lineno=23, col_offset=9, end_lineno=23, end_col_offset=29), lineno=23, col_offset=0, end_lineno=23, end_col_offset=29), ClassDef(name='BM25SearchProvider', body=[Expr(value=Constant(value="Thin wrapper around Pyserini's LuceneSearcher for BM25 retrieval.\n\n    This class provides a simple interface to Pyserini's Lucene-based BM25 search\n    implementation. BM25 (Best Matching 25) is a probabilistic ranking function\n    that scores documents based on term frequency, inverse document frequency,\n    and document length normalization. It's particularly effective for keyword\n    and exact-match queries in code search scenarios.\n\n    The provider initializes a Lucene searcher with the specified BM25 parameters\n    (k1 and b) which control term frequency saturation and length normalization\n    respectively. The searcher is thread-safe and can be reused for multiple\n    queries.\n\n    Parameters\n    ----------\n    index_dir : Path\n        Directory path containing the Lucene BM25 index. The index must be created\n        using Pyserini's indexing tools and contain document vectors suitable for\n        BM25 retrieval.\n    k1 : float\n        BM25 term frequency saturation parameter. Controls how quickly term\n        frequency saturates. Typical values range from 1.2 to 2.0. Higher values\n        give more weight to term frequency.\n    b : float\n        BM25 length normalization parameter. Controls the degree of document length\n        normalization. Values range from 0.0 (no normalization) to 1.0 (full\n        normalization). Typical value is 0.75.\n\n    Raises\n    ------\n    FileNotFoundError\n        If the BM25 index directory does not exist or is not accessible.\n    ", lineno=27, col_offset=4, end_lineno=59, end_col_offset=7), lineno=27, col_offset=4, end_lineno=59, end_col_offset=7), FunctionDef(name='__init__', args=arguments(args=[arg(arg='self', lineno=61, col_offset=17, end_lineno=61, end_col_offset=21), arg(arg='index_dir', annotation=Name(id='Path', ctx=Load(), lineno=61, col_offset=34, end_lineno=61, end_col_offset=38), lineno=61, col_offset=23, end_lineno=61, end_col_offset=38)], kwonlyargs=[arg(arg='k1', annotation=Name(id='float', ctx=Load(), lineno=61, col_offset=47, end_lineno=61, end_col_offset=52), lineno=61, col_offset=43, end_lineno=61, end_col_offset=52), arg(arg='b', annotation=Name(id='float', ctx=Load(), lineno=61, col_offset=57, end_lineno=61, end_col_offset=62), lineno=61, col_offset=54, end_lineno=61, end_col_offset=62)], kw_defaults=[None, None]), body=[If(test=UnaryOp(op=Not(), operand=Call(func=Attribute(value=Name(id='index_dir', ctx=Load(), lineno=62, col_offset=15, end_lineno=62, end_col_offset=24), attr='exists', ctx=Load(), lineno=62, col_offset=15, end_lineno=62, end_col_offset=31), lineno=62, col_offset=15, end_lineno=62, end_col_offset=33), lineno=62, col_offset=11, end_lineno=62, end_col_offset=33), body=[Assign(targets=[Name(id='msg', ctx=Store(), lineno=63, col_offset=12, end_lineno=63, end_col_offset=15)], value=JoinedStr(values=[Constant(value='BM25 index not found: ', lineno=63, col_offset=20, end_lineno=63, end_col_offset=42), FormattedValue(value=Name(id='index_dir', ctx=Load(), lineno=63, col_offset=43, end_lineno=63, end_col_offset=52), conversion=-1, lineno=63, col_offset=42, end_lineno=63, end_col_offset=53)], lineno=63, col_offset=18, end_lineno=63, end_col_offset=54), lineno=63, col_offset=12, end_lineno=63, end_col_offset=54), Raise(exc=Call(func=Name(id='FileNotFoundError', ctx=Load(), lineno=64, col_offset=18, end_lineno=64, end_col_offset=35), args=[Name(id='msg', ctx=Load(), lineno=64, col_offset=36, end_lineno=64, end_col_offset=39)], lineno=64, col_offset=18, end_lineno=64, end_col_offset=40), lineno=64, col_offset=12, end_lineno=64, end_col_offset=40)], lineno=62, col_offset=8, end_lineno=64, end_col_offset=40), Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=65, col_offset=8, end_lineno=65, end_col_offset=12), attr='_index_dir', ctx=Store(), lineno=65, col_offset=8, end_lineno=65, end_col_offset=23)], value=Name(id='index_dir', ctx=Load(), lineno=65, col_offset=26, end_lineno=65, end_col_offset=35), lineno=65, col_offset=8, end_lineno=65, end_col_offset=35), Assign(targets=[Name(id='lucene_module', ctx=Store(), lineno=66, col_offset=8, end_lineno=66, end_col_offset=21)], value=Call(func=Name(id='import_module', ctx=Load(), lineno=66, col_offset=24, end_lineno=66, end_col_offset=37), args=[Constant(value='pyserini.search.lucene', lineno=66, col_offset=38, end_lineno=66, end_col_offset=62)], lineno=66, col_offset=24, end_lineno=66, end_col_offset=63), lineno=66, col_offset=8, end_lineno=66, end_col_offset=63), Assign(targets=[Name(id='lucene_searcher_cls', ctx=Store(), lineno=67, col_offset=8, end_lineno=67, end_col_offset=27)], value=Attribute(value=Name(id='lucene_module', ctx=Load(), lineno=67, col_offset=30, end_lineno=67, end_col_offset=43), attr='LuceneSearcher', ctx=Load(), lineno=67, col_offset=30, end_lineno=67, end_col_offset=58), lineno=67, col_offset=8, end_lineno=67, end_col_offset=58), Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=68, col_offset=8, end_lineno=68, end_col_offset=12), attr='_searcher', ctx=Store(), lineno=68, col_offset=8, end_lineno=68, end_col_offset=22)], value=Call(func=Name(id='lucene_searcher_cls', ctx=Load(), lineno=68, col_offset=25, end_lineno=68, end_col_offset=44), args=[Call(func=Name(id='str', ctx=Load(), lineno=68, col_offset=45, end_lineno=68, end_col_offset=48), args=[Name(id='index_dir', ctx=Load(), lineno=68, col_offset=49, end_lineno=68, end_col_offset=58)], lineno=68, col_offset=45, end_lineno=68, end_col_offset=59)], lineno=68, col_offset=25, end_lineno=68, end_col_offset=60), lineno=68, col_offset=8, end_lineno=68, end_col_offset=60), Expr(value=Call(func=Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=69, col_offset=8, end_lineno=69, end_col_offset=12), attr='_searcher', ctx=Load(), lineno=69, col_offset=8, end_lineno=69, end_col_offset=22), attr='set_bm25', ctx=Load(), lineno=69, col_offset=8, end_lineno=69, end_col_offset=31), args=[Name(id='k1', ctx=Load(), lineno=69, col_offset=32, end_lineno=69, end_col_offset=34), Name(id='b', ctx=Load(), lineno=69, col_offset=36, end_lineno=69, end_col_offset=37)], lineno=69, col_offset=8, end_lineno=69, end_col_offset=38), lineno=69, col_offset=8, end_lineno=69, end_col_offset=38)], returns=Constant(value=None, lineno=61, col_offset=67, end_lineno=61, end_col_offset=71), lineno=61, col_offset=4, end_lineno=69, end_col_offset=38), FunctionDef(name='search', args=arguments(args=[arg(arg='self', lineno=71, col_offset=15, end_lineno=71, end_col_offset=19), arg(arg='query', annotation=Name(id='str', ctx=Load(), lineno=71, col_offset=28, end_lineno=71, end_col_offset=31), lineno=71, col_offset=21, end_lineno=71, end_col_offset=31), arg(arg='top_k', annotation=Name(id='int', ctx=Load(), lineno=71, col_offset=40, end_lineno=71, end_col_offset=43), lineno=71, col_offset=33, end_lineno=71, end_col_offset=43)]), body=[Expr(value=Constant(value='Return top-k BM25 hits for ``query``.\n\n        Executes a BM25 search query against the Lucene index and returns the\n        top-k most relevant documents. The search uses the configured BM25\n        parameters (k1, b) set during initialization. Results are ranked by\n        BM25 relevance score in descending order.\n\n        Parameters\n        ----------\n        query : str\n            Search query string. Can contain multiple terms separated by spaces.\n            BM25 will score documents based on term frequency and inverse document\n            frequency for each term in the query.\n        top_k : int\n            Maximum number of results to return. The searcher will return the\n            top-k highest-scoring documents. Must be a positive integer.\n\n        Returns\n        -------\n        list[ChannelHit]\n            List of ranked BM25 results, ordered by relevance score (highest first).\n            Each ChannelHit contains a document ID and BM25 score. Returns empty\n            list if no documents match the query or if top_k is 0.\n        ', lineno=72, col_offset=8, end_lineno=95, end_col_offset=11), lineno=72, col_offset=8, end_lineno=95, end_col_offset=11), Assign(targets=[Name(id='hits', ctx=Store(), lineno=96, col_offset=8, end_lineno=96, end_col_offset=12)], value=Call(func=Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=96, col_offset=15, end_lineno=96, end_col_offset=19), attr='_searcher', ctx=Load(), lineno=96, col_offset=15, end_lineno=96, end_col_offset=29), attr='search', ctx=Load(), lineno=96, col_offset=15, end_lineno=96, end_col_offset=36), args=[Name(id='query', ctx=Load(), lineno=96, col_offset=37, end_lineno=96, end_col_offset=42)], keywords=[keyword(arg='k', value=Name(id='top_k', ctx=Load(), lineno=96, col_offset=46, end_lineno=96, end_col_offset=51), lineno=96, col_offset=44, end_lineno=96, end_col_offset=51)], lineno=96, col_offset=15, end_lineno=96, end_col_offset=52), lineno=96, col_offset=8, end_lineno=96, end_col_offset=52), Return(value=ListComp(elt=Call(func=Name(id='ChannelHit', ctx=Load(), lineno=97, col_offset=16, end_lineno=97, end_col_offset=26), keywords=[keyword(arg='doc_id', value=Attribute(value=Name(id='hit', ctx=Load(), lineno=97, col_offset=34, end_lineno=97, end_col_offset=37), attr='docid', ctx=Load(), lineno=97, col_offset=34, end_lineno=97, end_col_offset=43), lineno=97, col_offset=27, end_lineno=97, end_col_offset=43), keyword(arg='score', value=Call(func=Name(id='float', ctx=Load(), lineno=97, col_offset=51, end_lineno=97, end_col_offset=56), args=[Attribute(value=Name(id='hit', ctx=Load(), lineno=97, col_offset=57, end_lineno=97, end_col_offset=60), attr='score', ctx=Load(), lineno=97, col_offset=57, end_lineno=97, end_col_offset=66)], lineno=97, col_offset=51, end_lineno=97, end_col_offset=67), lineno=97, col_offset=45, end_lineno=97, end_col_offset=67)], lineno=97, col_offset=16, end_lineno=97, end_col_offset=68), generators=[comprehension(target=Name(id='hit', ctx=Store(), lineno=97, col_offset=73, end_lineno=97, end_col_offset=76), iter=Name(id='hits', ctx=Load(), lineno=97, col_offset=80, end_lineno=97, end_col_offset=84), is_async=0)], lineno=97, col_offset=15, end_lineno=97, end_col_offset=85), lineno=97, col_offset=8, end_lineno=97, end_col_offset=85)], returns=Subscript(value=Name(id='list', ctx=Load(), lineno=71, col_offset=48, end_lineno=71, end_col_offset=52), slice=Name(id='ChannelHit', ctx=Load(), lineno=71, col_offset=53, end_lineno=71, end_col_offset=63), ctx=Load(), lineno=71, col_offset=48, end_lineno=71, end_col_offset=64), lineno=71, col_offset=4, end_lineno=97, end_col_offset=85)], lineno=26, col_offset=0, end_lineno=97, end_col_offset=85), ClassDef(name='SpladeSearchProvider', body=[Expr(value=Constant(value="SPLADE query encoder and Lucene impact searcher for learned sparse retrieval.\n\n    This class combines a SPLADE (Sparse Lexical and Expansion) query encoder\n    with a Lucene impact searcher to perform learned sparse retrieval. SPLADE\n    learns to expand queries with relevant terms and assign importance weights,\n    creating sparse representations that are more effective than traditional\n    keyword matching while maintaining the efficiency of sparse retrieval.\n\n    The provider initializes a SPLADE encoder model (typically loaded from ONNX\n    format for efficiency) and a Lucene impact searcher that uses learned term\n    weights for ranking. The encoder expands queries into weighted term vectors,\n    which are then converted to bag-of-words representations for Lucene search.\n\n    Parameters\n    ----------\n    config : SpladeConfig\n        SPLADE configuration containing model settings, quantization parameters,\n        and maximum term limits. Used to configure encoder behavior and search\n        parameters.\n    model_dir : Path\n        Directory containing the SPLADE model files. The model directory should\n        contain the encoder weights and tokenizer configuration.\n    onnx_dir : Path\n        Directory containing ONNX-exported model files. If an ONNX file exists\n        (specified in config.onnx_file), it will be used instead of the PyTorch\n        model for faster inference. Falls back to PyTorch model if ONNX not found.\n    index_dir : Path\n        Directory path containing the Lucene impact index. The index must be\n        created using Pyserini's indexing tools with SPLADE-encoded document\n        vectors. Each document should have term weights matching the SPLADE\n        encoding scheme.\n\n    Raises\n    ------\n    FileNotFoundError\n        If the SPLADE impact index directory does not exist or is not accessible.\n    ", lineno=101, col_offset=4, end_lineno=137, end_col_offset=7), lineno=101, col_offset=4, end_lineno=137, end_col_offset=7), FunctionDef(name='__init__', args=arguments(args=[arg(arg='self', lineno=140, col_offset=8, end_lineno=140, end_col_offset=12), arg(arg='config', annotation=Name(id='SpladeConfig', ctx=Load(), lineno=141, col_offset=16, end_lineno=141, end_col_offset=28), lineno=141, col_offset=8, end_lineno=141, end_col_offset=28)], kwonlyargs=[arg(arg='model_dir', annotation=Name(id='Path', ctx=Load(), lineno=143, col_offset=19, end_lineno=143, end_col_offset=23), lineno=143, col_offset=8, end_lineno=143, end_col_offset=23), arg(arg='onnx_dir', annotation=Name(id='Path', ctx=Load(), lineno=144, col_offset=18, end_lineno=144, end_col_offset=22), lineno=144, col_offset=8, end_lineno=144, end_col_offset=22), arg(arg='index_dir', annotation=Name(id='Path', ctx=Load(), lineno=145, col_offset=19, end_lineno=145, end_col_offset=23), lineno=145, col_offset=8, end_lineno=145, end_col_offset=23)], kw_defaults=[None, None, None]), body=[If(test=UnaryOp(op=Not(), operand=Call(func=Attribute(value=Name(id='index_dir', ctx=Load(), lineno=147, col_offset=15, end_lineno=147, end_col_offset=24), attr='exists', ctx=Load(), lineno=147, col_offset=15, end_lineno=147, end_col_offset=31), lineno=147, col_offset=15, end_lineno=147, end_col_offset=33), lineno=147, col_offset=11, end_lineno=147, end_col_offset=33), body=[Assign(targets=[Name(id='msg', ctx=Store(), lineno=148, col_offset=12, end_lineno=148, end_col_offset=15)], value=JoinedStr(values=[Constant(value='SPLADE impact index not found: ', lineno=148, col_offset=20, end_lineno=148, end_col_offset=51), FormattedValue(value=Name(id='index_dir', ctx=Load(), lineno=148, col_offset=52, end_lineno=148, end_col_offset=61), conversion=-1, lineno=148, col_offset=51, end_lineno=148, end_col_offset=62)], lineno=148, col_offset=18, end_lineno=148, end_col_offset=63), lineno=148, col_offset=12, end_lineno=148, end_col_offset=63), Raise(exc=Call(func=Name(id='FileNotFoundError', ctx=Load(), lineno=149, col_offset=18, end_lineno=149, end_col_offset=35), args=[Name(id='msg', ctx=Load(), lineno=149, col_offset=36, end_lineno=149, end_col_offset=39)], lineno=149, col_offset=18, end_lineno=149, end_col_offset=40), lineno=149, col_offset=12, end_lineno=149, end_col_offset=40)], lineno=147, col_offset=8, end_lineno=149, end_col_offset=40), Assign(targets=[Name(id='resolved_model_dir', ctx=Store(), lineno=150, col_offset=8, end_lineno=150, end_col_offset=26)], value=Name(id='model_dir', ctx=Load(), lineno=150, col_offset=29, end_lineno=150, end_col_offset=38), lineno=150, col_offset=8, end_lineno=150, end_col_offset=38), Assign(targets=[Name(id='resolved_onnx_path', ctx=Store(), lineno=151, col_offset=8, end_lineno=151, end_col_offset=26)], value=BinOp(left=Name(id='onnx_dir', ctx=Load(), lineno=151, col_offset=29, end_lineno=151, end_col_offset=37), op=Div(), right=Attribute(value=Name(id='config', ctx=Load(), lineno=151, col_offset=40, end_lineno=151, end_col_offset=46), attr='onnx_file', ctx=Load(), lineno=151, col_offset=40, end_lineno=151, end_col_offset=56), lineno=151, col_offset=29, end_lineno=151, end_col_offset=56), lineno=151, col_offset=8, end_lineno=151, end_col_offset=56), AnnAssign(target=Name(id='model_kwargs', ctx=Store(), lineno=152, col_offset=8, end_lineno=152, end_col_offset=20), annotation=Subscript(value=Name(id='dict', ctx=Load(), lineno=152, col_offset=22, end_lineno=152, end_col_offset=26), slice=Tuple(elts=[Name(id='str', ctx=Load(), lineno=152, col_offset=27, end_lineno=152, end_col_offset=30), Name(id='str', ctx=Load(), lineno=152, col_offset=32, end_lineno=152, end_col_offset=35)], ctx=Load(), lineno=152, col_offset=27, end_lineno=152, end_col_offset=35), ctx=Load(), lineno=152, col_offset=22, end_lineno=152, end_col_offset=36), value=Dict(keys=[Constant(value='provider', lineno=152, col_offset=40, end_lineno=152, end_col_offset=50)], values=[Attribute(value=Name(id='config', ctx=Load(), lineno=152, col_offset=52, end_lineno=152, end_col_offset=58), attr='provider', ctx=Load(), lineno=152, col_offset=52, end_lineno=152, end_col_offset=67)], lineno=152, col_offset=39, end_lineno=152, end_col_offset=68), simple=1, lineno=152, col_offset=8, end_lineno=152, end_col_offset=68), If(test=Call(func=Attribute(value=Name(id='resolved_onnx_path', ctx=Load(), lineno=153, col_offset=11, end_lineno=153, end_col_offset=29), attr='exists', ctx=Load(), lineno=153, col_offset=11, end_lineno=153, end_col_offset=36), lineno=153, col_offset=11, end_lineno=153, end_col_offset=38), body=[Try(body=[Assign(targets=[Name(id='relative', ctx=Store(), lineno=155, col_offset=16, end_lineno=155, end_col_offset=24)], value=Call(func=Attribute(value=Name(id='resolved_onnx_path', ctx=Load(), lineno=155, col_offset=27, end_lineno=155, end_col_offset=45), attr='relative_to', ctx=Load(), lineno=155, col_offset=27, end_lineno=155, end_col_offset=57), args=[Name(id='resolved_model_dir', ctx=Load(), lineno=155, col_offset=58, end_lineno=155, end_col_offset=76)], lineno=155, col_offset=27, end_lineno=155, end_col_offset=77), lineno=155, col_offset=16, end_lineno=155, end_col_offset=77), Assign(targets=[Subscript(value=Name(id='model_kwargs', ctx=Load(), lineno=156, col_offset=16, end_lineno=156, end_col_offset=28), slice=Constant(value='file_name', lineno=156, col_offset=29, end_lineno=156, end_col_offset=40), ctx=Store(), lineno=156, col_offset=16, end_lineno=156, end_col_offset=41)], value=Call(func=Name(id='str', ctx=Load(), lineno=156, col_offset=44, end_lineno=156, end_col_offset=47), args=[Name(id='relative', ctx=Load(), lineno=156, col_offset=48, end_lineno=156, end_col_offset=56)], lineno=156, col_offset=44, end_lineno=156, end_col_offset=57), lineno=156, col_offset=16, end_lineno=156, end_col_offset=57)], handlers=[ExceptHandler(type=Name(id='ValueError', ctx=Load(), lineno=157, col_offset=19, end_lineno=157, end_col_offset=29), body=[Assign(targets=[Subscript(value=Name(id='model_kwargs', ctx=Load(), lineno=158, col_offset=16, end_lineno=158, end_col_offset=28), slice=Constant(value='file_name', lineno=158, col_offset=29, end_lineno=158, end_col_offset=40), ctx=Store(), lineno=158, col_offset=16, end_lineno=158, end_col_offset=41)], value=Call(func=Name(id='str', ctx=Load(), lineno=158, col_offset=44, end_lineno=158, end_col_offset=47), args=[Name(id='resolved_onnx_path', ctx=Load(), lineno=158, col_offset=48, end_lineno=158, end_col_offset=66)], lineno=158, col_offset=44, end_lineno=158, end_col_offset=67), lineno=158, col_offset=16, end_lineno=158, end_col_offset=67)], lineno=157, col_offset=12, end_lineno=158, end_col_offset=67)], lineno=154, col_offset=12, end_lineno=158, end_col_offset=67)], lineno=153, col_offset=8, end_lineno=158, end_col_offset=67), Assign(targets=[Name(id='encoder_cls', ctx=Store(), lineno=160, col_offset=8, end_lineno=160, end_col_offset=19)], value=Attribute(value=Call(func=Name(id='import_module', ctx=Load(), lineno=160, col_offset=22, end_lineno=160, end_col_offset=35), args=[Constant(value='sentence_transformers', lineno=160, col_offset=36, end_lineno=160, end_col_offset=59)], lineno=160, col_offset=22, end_lineno=160, end_col_offset=60), attr='SparseEncoder', ctx=Load(), lineno=160, col_offset=22, end_lineno=160, end_col_offset=74), lineno=160, col_offset=8, end_lineno=160, end_col_offset=74), Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=161, col_offset=8, end_lineno=161, end_col_offset=12), attr='_encoder', ctx=Store(), lineno=161, col_offset=8, end_lineno=161, end_col_offset=21)], value=Call(func=Name(id='encoder_cls', ctx=Load(), lineno=161, col_offset=24, end_lineno=161, end_col_offset=35), args=[Call(func=Name(id='str', ctx=Load(), lineno=162, col_offset=12, end_lineno=162, end_col_offset=15), args=[Name(id='resolved_model_dir', ctx=Load(), lineno=162, col_offset=16, end_lineno=162, end_col_offset=34)], lineno=162, col_offset=12, end_lineno=162, end_col_offset=35)], keywords=[keyword(arg='backend', value=Constant(value='onnx', lineno=163, col_offset=20, end_lineno=163, end_col_offset=26), lineno=163, col_offset=12, end_lineno=163, end_col_offset=26), keyword(arg='model_kwargs', value=Name(id='model_kwargs', ctx=Load(), lineno=164, col_offset=25, end_lineno=164, end_col_offset=37), lineno=164, col_offset=12, end_lineno=164, end_col_offset=37)], lineno=161, col_offset=24, end_lineno=165, end_col_offset=9), lineno=161, col_offset=8, end_lineno=165, end_col_offset=9), Assign(targets=[Name(id='impact_module', ctx=Store(), lineno=166, col_offset=8, end_lineno=166, end_col_offset=21)], value=Call(func=Name(id='import_module', ctx=Load(), lineno=166, col_offset=24, end_lineno=166, end_col_offset=37), args=[Constant(value='pyserini.search.lucene', lineno=166, col_offset=38, end_lineno=166, end_col_offset=62)], lineno=166, col_offset=24, end_lineno=166, end_col_offset=63), lineno=166, col_offset=8, end_lineno=166, end_col_offset=63), Assign(targets=[Name(id='lucene_impact_searcher_cls', ctx=Store(), lineno=167, col_offset=8, end_lineno=167, end_col_offset=34)], value=Attribute(value=Name(id='impact_module', ctx=Load(), lineno=167, col_offset=37, end_lineno=167, end_col_offset=50), attr='LuceneImpactSearcher', ctx=Load(), lineno=167, col_offset=37, end_lineno=167, end_col_offset=71), lineno=167, col_offset=8, end_lineno=167, end_col_offset=71), Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=168, col_offset=8, end_lineno=168, end_col_offset=12), attr='_searcher', ctx=Store(), lineno=168, col_offset=8, end_lineno=168, end_col_offset=22)], value=Call(func=Name(id='lucene_impact_searcher_cls', ctx=Load(), lineno=168, col_offset=25, end_lineno=168, end_col_offset=51), args=[Call(func=Name(id='str', ctx=Load(), lineno=168, col_offset=52, end_lineno=168, end_col_offset=55), args=[Name(id='index_dir', ctx=Load(), lineno=168, col_offset=56, end_lineno=168, end_col_offset=65)], lineno=168, col_offset=52, end_lineno=168, end_col_offset=66)], lineno=168, col_offset=25, end_lineno=168, end_col_offset=67), lineno=168, col_offset=8, end_lineno=168, end_col_offset=67), Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=169, col_offset=8, end_lineno=169, end_col_offset=12), attr='_quantization', ctx=Store(), lineno=169, col_offset=8, end_lineno=169, end_col_offset=26)], value=Attribute(value=Name(id='config', ctx=Load(), lineno=169, col_offset=29, end_lineno=169, end_col_offset=35), attr='quantization', ctx=Load(), lineno=169, col_offset=29, end_lineno=169, end_col_offset=48), lineno=169, col_offset=8, end_lineno=169, end_col_offset=48), Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=170, col_offset=8, end_lineno=170, end_col_offset=12), attr='_max_terms', ctx=Store(), lineno=170, col_offset=8, end_lineno=170, end_col_offset=23)], value=Attribute(value=Name(id='config', ctx=Load(), lineno=170, col_offset=26, end_lineno=170, end_col_offset=32), attr='max_terms', ctx=Load(), lineno=170, col_offset=26, end_lineno=170, end_col_offset=42), lineno=170, col_offset=8, end_lineno=170, end_col_offset=42)], returns=Constant(value=None, lineno=146, col_offset=9, end_lineno=146, end_col_offset=13), lineno=139, col_offset=4, end_lineno=170, end_col_offset=42), FunctionDef(name='search', args=arguments(args=[arg(arg='self', lineno=172, col_offset=15, end_lineno=172, end_col_offset=19), arg(arg='query', annotation=Name(id='str', ctx=Load(), lineno=172, col_offset=28, end_lineno=172, end_col_offset=31), lineno=172, col_offset=21, end_lineno=172, end_col_offset=31), arg(arg='top_k', annotation=Name(id='int', ctx=Load(), lineno=172, col_offset=40, end_lineno=172, end_col_offset=43), lineno=172, col_offset=33, end_lineno=172, end_col_offset=43)]), body=[Expr(value=Constant(value='Return SPLADE impact hits for ``query``.\n\n        Encodes the query using the SPLADE encoder to generate a sparse term\n        vector with learned importance weights. The vector is decoded into a\n        bag-of-words representation with term repetitions based on quantized\n        weights, then searched against the Lucene impact index. Results are\n        ranked by learned relevance scores.\n\n        Parameters\n        ----------\n        query : str\n            Search query string to encode and search. The SPLADE encoder will\n            expand this query with relevant terms and assign importance weights\n            based on learned patterns from training data.\n        top_k : int\n            Maximum number of results to return. The searcher returns the top-k\n            highest-scoring documents based on learned SPLADE relevance. Must be\n            a positive integer.\n\n        Returns\n        -------\n        list[ChannelHit]\n            List of ranked SPLADE results, ordered by learned relevance score\n            (highest first). Each ChannelHit contains a document ID and SPLADE\n            impact score. Returns empty list if encoding fails, no terms are\n            generated, or top_k is 0.\n        ', lineno=173, col_offset=8, end_lineno=199, end_col_offset=11), lineno=173, col_offset=8, end_lineno=199, end_col_offset=11), Assign(targets=[Name(id='embeddings', ctx=Store(), lineno=200, col_offset=8, end_lineno=200, end_col_offset=18)], value=Call(func=Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=200, col_offset=21, end_lineno=200, end_col_offset=25), attr='_encoder', ctx=Load(), lineno=200, col_offset=21, end_lineno=200, end_col_offset=34), attr='encode_query', ctx=Load(), lineno=200, col_offset=21, end_lineno=200, end_col_offset=47), args=[List(elts=[Name(id='query', ctx=Load(), lineno=200, col_offset=49, end_lineno=200, end_col_offset=54)], ctx=Load(), lineno=200, col_offset=48, end_lineno=200, end_col_offset=55)], lineno=200, col_offset=21, end_lineno=200, end_col_offset=56), lineno=200, col_offset=8, end_lineno=200, end_col_offset=56), Assign(targets=[Name(id='decoded', ctx=Store(), lineno=201, col_offset=8, end_lineno=201, end_col_offset=15)], value=Call(func=Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=201, col_offset=18, end_lineno=201, end_col_offset=22), attr='_encoder', ctx=Load(), lineno=201, col_offset=18, end_lineno=201, end_col_offset=31), attr='decode', ctx=Load(), lineno=201, col_offset=18, end_lineno=201, end_col_offset=38), args=[Name(id='embeddings', ctx=Load(), lineno=201, col_offset=39, end_lineno=201, end_col_offset=49)], keywords=[keyword(arg='top_k', value=Constant(value=None, lineno=201, col_offset=57, end_lineno=201, end_col_offset=61), lineno=201, col_offset=51, end_lineno=201, end_col_offset=61)], lineno=201, col_offset=18, end_lineno=201, end_col_offset=62), lineno=201, col_offset=8, end_lineno=201, end_col_offset=62), If(test=BoolOp(op=Or(), values=[UnaryOp(op=Not(), operand=Name(id='decoded', ctx=Load(), lineno=202, col_offset=15, end_lineno=202, end_col_offset=22), lineno=202, col_offset=11, end_lineno=202, end_col_offset=22), UnaryOp(op=Not(), operand=Subscript(value=Name(id='decoded', ctx=Load(), lineno=202, col_offset=30, end_lineno=202, end_col_offset=37), slice=Constant(value=0, lineno=202, col_offset=38, end_lineno=202, end_col_offset=39), ctx=Load(), lineno=202, col_offset=30, end_lineno=202, end_col_offset=40), lineno=202, col_offset=26, end_lineno=202, end_col_offset=40)], lineno=202, col_offset=11, end_lineno=202, end_col_offset=40), body=[Return(value=List(ctx=Load(), lineno=203, col_offset=19, end_lineno=203, end_col_offset=21), lineno=203, col_offset=12, end_lineno=203, end_col_offset=21)], lineno=202, col_offset=8, end_lineno=203, end_col_offset=21), Assign(targets=[Name(id='bow', ctx=Store(), lineno=204, col_offset=8, end_lineno=204, end_col_offset=11)], value=Call(func=Attribute(value=Name(id='self', ctx=Load(), lineno=204, col_offset=14, end_lineno=204, end_col_offset=18), attr='_build_bow', ctx=Load(), lineno=204, col_offset=14, end_lineno=204, end_col_offset=29), args=[Subscript(value=Name(id='decoded', ctx=Load(), lineno=204, col_offset=30, end_lineno=204, end_col_offset=37), slice=Constant(value=0, lineno=204, col_offset=38, end_lineno=204, end_col_offset=39), ctx=Load(), lineno=204, col_offset=30, end_lineno=204, end_col_offset=40)], lineno=204, col_offset=14, end_lineno=204, end_col_offset=41), lineno=204, col_offset=8, end_lineno=204, end_col_offset=41), If(test=UnaryOp(op=Not(), operand=Name(id='bow', ctx=Load(), lineno=205, col_offset=15, end_lineno=205, end_col_offset=18), lineno=205, col_offset=11, end_lineno=205, end_col_offset=18), body=[Return(value=List(ctx=Load(), lineno=206, col_offset=19, end_lineno=206, end_col_offset=21), lineno=206, col_offset=12, end_lineno=206, end_col_offset=21)], lineno=205, col_offset=8, end_lineno=206, end_col_offset=21), Assign(targets=[Name(id='hits', ctx=Store(), lineno=207, col_offset=8, end_lineno=207, end_col_offset=12)], value=Call(func=Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=207, col_offset=15, end_lineno=207, end_col_offset=19), attr='_searcher', ctx=Load(), lineno=207, col_offset=15, end_lineno=207, end_col_offset=29), attr='search', ctx=Load(), lineno=207, col_offset=15, end_lineno=207, end_col_offset=36), args=[Name(id='bow', ctx=Load(), lineno=207, col_offset=37, end_lineno=207, end_col_offset=40)], keywords=[keyword(arg='k', value=Name(id='top_k', ctx=Load(), lineno=207, col_offset=44, end_lineno=207, end_col_offset=49), lineno=207, col_offset=42, end_lineno=207, end_col_offset=49)], lineno=207, col_offset=15, end_lineno=207, end_col_offset=50), lineno=207, col_offset=8, end_lineno=207, end_col_offset=50), Return(value=ListComp(elt=Call(func=Name(id='ChannelHit', ctx=Load(), lineno=208, col_offset=16, end_lineno=208, end_col_offset=26), keywords=[keyword(arg='doc_id', value=Attribute(value=Name(id='hit', ctx=Load(), lineno=208, col_offset=34, end_lineno=208, end_col_offset=37), attr='docid', ctx=Load(), lineno=208, col_offset=34, end_lineno=208, end_col_offset=43), lineno=208, col_offset=27, end_lineno=208, end_col_offset=43), keyword(arg='score', value=Call(func=Name(id='float', ctx=Load(), lineno=208, col_offset=51, end_lineno=208, end_col_offset=56), args=[Attribute(value=Name(id='hit', ctx=Load(), lineno=208, col_offset=57, end_lineno=208, end_col_offset=60), attr='score', ctx=Load(), lineno=208, col_offset=57, end_lineno=208, end_col_offset=66)], lineno=208, col_offset=51, end_lineno=208, end_col_offset=67), lineno=208, col_offset=45, end_lineno=208, end_col_offset=67)], lineno=208, col_offset=16, end_lineno=208, end_col_offset=68), generators=[comprehension(target=Name(id='hit', ctx=Store(), lineno=208, col_offset=73, end_lineno=208, end_col_offset=76), iter=Name(id='hits', ctx=Load(), lineno=208, col_offset=80, end_lineno=208, end_col_offset=84), is_async=0)], lineno=208, col_offset=15, end_lineno=208, end_col_offset=85), lineno=208, col_offset=8, end_lineno=208, end_col_offset=85)], returns=Subscript(value=Name(id='list', ctx=Load(), lineno=172, col_offset=48, end_lineno=172, end_col_offset=52), slice=Name(id='ChannelHit', ctx=Load(), lineno=172, col_offset=53, end_lineno=172, end_col_offset=63), ctx=Load(), lineno=172, col_offset=48, end_lineno=172, end_col_offset=64), lineno=172, col_offset=4, end_lineno=208, end_col_offset=85), FunctionDef(name='_build_bow', args=arguments(args=[arg(arg='self', lineno=210, col_offset=19, end_lineno=210, end_col_offset=23), arg(arg='pairs', annotation=Subscript(value=Name(id='Sequence', ctx=Load(), lineno=210, col_offset=32, end_lineno=210, end_col_offset=40), slice=Subscript(value=Name(id='tuple', ctx=Load(), lineno=210, col_offset=41, end_lineno=210, end_col_offset=46), slice=Tuple(elts=[Name(id='str', ctx=Load(), lineno=210, col_offset=47, end_lineno=210, end_col_offset=50), Name(id='float', ctx=Load(), lineno=210, col_offset=52, end_lineno=210, end_col_offset=57)], ctx=Load(), lineno=210, col_offset=47, end_lineno=210, end_col_offset=57), ctx=Load(), lineno=210, col_offset=41, end_lineno=210, end_col_offset=58), ctx=Load(), lineno=210, col_offset=32, end_lineno=210, end_col_offset=59), lineno=210, col_offset=25, end_lineno=210, end_col_offset=59)]), body=[AnnAssign(target=Name(id='tokens', ctx=Store(), lineno=211, col_offset=8, end_lineno=211, end_col_offset=14), annotation=Subscript(value=Name(id='list', ctx=Load(), lineno=211, col_offset=16, end_lineno=211, end_col_offset=20), slice=Name(id='str', ctx=Load(), lineno=211, col_offset=21, end_lineno=211, end_col_offset=24), ctx=Load(), lineno=211, col_offset=16, end_lineno=211, end_col_offset=25), value=List(ctx=Load(), lineno=211, col_offset=28, end_lineno=211, end_col_offset=30), simple=1, lineno=211, col_offset=8, end_lineno=211, end_col_offset=30), Assign(targets=[Name(id='remaining', ctx=Store(), lineno=212, col_offset=8, end_lineno=212, end_col_offset=17)], value=Attribute(value=Name(id='self', ctx=Load(), lineno=212, col_offset=20, end_lineno=212, end_col_offset=24), attr='_max_terms', ctx=Load(), lineno=212, col_offset=20, end_lineno=212, end_col_offset=35), lineno=212, col_offset=8, end_lineno=212, end_col_offset=35), For(target=Tuple(elts=[Name(id='token', ctx=Store(), lineno=213, col_offset=12, end_lineno=213, end_col_offset=17), Name(id='weight', ctx=Store(), lineno=213, col_offset=19, end_lineno=213, end_col_offset=25)], ctx=Store(), lineno=213, col_offset=12, end_lineno=213, end_col_offset=25), iter=Name(id='pairs', ctx=Load(), lineno=213, col_offset=29, end_lineno=213, end_col_offset=34), body=[If(test=BoolOp(op=Or(), values=[Compare(left=Name(id='weight', ctx=Load(), lineno=214, col_offset=15, end_lineno=214, end_col_offset=21), ops=[LtE()], comparators=[Constant(value=0, lineno=214, col_offset=25, end_lineno=214, end_col_offset=26)], lineno=214, col_offset=15, end_lineno=214, end_col_offset=26), Compare(left=Name(id='remaining', ctx=Load(), lineno=214, col_offset=30, end_lineno=214, end_col_offset=39), ops=[LtE()], comparators=[Constant(value=0, lineno=214, col_offset=43, end_lineno=214, end_col_offset=44)], lineno=214, col_offset=30, end_lineno=214, end_col_offset=44)], lineno=214, col_offset=15, end_lineno=214, end_col_offset=44), body=[Continue(lineno=215, col_offset=16, end_lineno=215, end_col_offset=24)], lineno=214, col_offset=12, end_lineno=215, end_col_offset=24), Assign(targets=[Name(id='impact', ctx=Store(), lineno=216, col_offset=12, end_lineno=216, end_col_offset=18)], value=Call(func=Name(id='round', ctx=Load(), lineno=216, col_offset=21, end_lineno=216, end_col_offset=26), args=[BinOp(left=Name(id='weight', ctx=Load(), lineno=216, col_offset=27, end_lineno=216, end_col_offset=33), op=Mult(), right=Attribute(value=Name(id='self', ctx=Load(), lineno=216, col_offset=36, end_lineno=216, end_col_offset=40), attr='_quantization', ctx=Load(), lineno=216, col_offset=36, end_lineno=216, end_col_offset=54), lineno=216, col_offset=27, end_lineno=216, end_col_offset=54)], lineno=216, col_offset=21, end_lineno=216, end_col_offset=55), lineno=216, col_offset=12, end_lineno=216, end_col_offset=55), If(test=Compare(left=Name(id='impact', ctx=Load(), lineno=217, col_offset=15, end_lineno=217, end_col_offset=21), ops=[LtE()], comparators=[Constant(value=0, lineno=217, col_offset=25, end_lineno=217, end_col_offset=26)], lineno=217, col_offset=15, end_lineno=217, end_col_offset=26), body=[Continue(lineno=218, col_offset=16, end_lineno=218, end_col_offset=24)], lineno=217, col_offset=12, end_lineno=218, end_col_offset=24), Assign(targets=[Name(id='repetitions', ctx=Store(), lineno=219, col_offset=12, end_lineno=219, end_col_offset=23)], value=Call(func=Name(id='min', ctx=Load(), lineno=219, col_offset=26, end_lineno=219, end_col_offset=29), args=[Name(id='impact', ctx=Load(), lineno=219, col_offset=30, end_lineno=219, end_col_offset=36), Name(id='remaining', ctx=Load(), lineno=219, col_offset=38, end_lineno=219, end_col_offset=47)], lineno=219, col_offset=26, end_lineno=219, end_col_offset=48), lineno=219, col_offset=12, end_lineno=219, end_col_offset=48), Expr(value=Call(func=Attribute(value=Name(id='tokens', ctx=Load(), lineno=220, col_offset=12, end_lineno=220, end_col_offset=18), attr='extend', ctx=Load(), lineno=220, col_offset=12, end_lineno=220, end_col_offset=25), args=[BinOp(left=List(elts=[Name(id='token', ctx=Load(), lineno=220, col_offset=27, end_lineno=220, end_col_offset=32)], ctx=Load(), lineno=220, col_offset=26, end_lineno=220, end_col_offset=33), op=Mult(), right=Name(id='repetitions', ctx=Load(), lineno=220, col_offset=36, end_lineno=220, end_col_offset=47), lineno=220, col_offset=26, end_lineno=220, end_col_offset=47)], lineno=220, col_offset=12, end_lineno=220, end_col_offset=48), lineno=220, col_offset=12, end_lineno=220, end_col_offset=48), AugAssign(target=Name(id='remaining', ctx=Store(), lineno=221, col_offset=12, end_lineno=221, end_col_offset=21), op=Sub(), value=Name(id='repetitions', ctx=Load(), lineno=221, col_offset=25, end_lineno=221, end_col_offset=36), lineno=221, col_offset=12, end_lineno=221, end_col_offset=36), If(test=Compare(left=Name(id='remaining', ctx=Load(), lineno=222, col_offset=15, end_lineno=222, end_col_offset=24), ops=[LtE()], comparators=[Constant(value=0, lineno=222, col_offset=28, end_lineno=222, end_col_offset=29)], lineno=222, col_offset=15, end_lineno=222, end_col_offset=29), body=[Break(lineno=223, col_offset=16, end_lineno=223, end_col_offset=21)], lineno=222, col_offset=12, end_lineno=223, end_col_offset=21)], lineno=213, col_offset=8, end_lineno=223, end_col_offset=21), Return(value=Call(func=Attribute(value=Constant(value=' ', lineno=224, col_offset=15, end_lineno=224, end_col_offset=18), attr='join', ctx=Load(), lineno=224, col_offset=15, end_lineno=224, end_col_offset=23), args=[Name(id='tokens', ctx=Load(), lineno=224, col_offset=24, end_lineno=224, end_col_offset=30)], lineno=224, col_offset=15, end_lineno=224, end_col_offset=31), lineno=224, col_offset=8, end_lineno=224, end_col_offset=31)], returns=Name(id='str', ctx=Load(), lineno=210, col_offset=64, end_lineno=210, end_col_offset=67), lineno=210, col_offset=4, end_lineno=224, end_col_offset=31)], lineno=100, col_offset=0, end_lineno=224, end_col_offset=31), ClassDef(name='HybridSearchEngine', body=[Expr(value=Constant(value='Combine dense (FAISS) and sparse channels (BM25, SPLADE) via RRF.', lineno=228, col_offset=4, end_lineno=228, end_col_offset=75), lineno=228, col_offset=4, end_lineno=228, end_col_offset=75), FunctionDef(name='__init__', args=arguments(args=[arg(arg='self', lineno=230, col_offset=17, end_lineno=230, end_col_offset=21), arg(arg='settings', annotation=Name(id='Settings', ctx=Load(), lineno=230, col_offset=33, end_lineno=230, end_col_offset=41), lineno=230, col_offset=23, end_lineno=230, end_col_offset=41), arg(arg='paths', annotation=Name(id='ResolvedPaths', ctx=Load(), lineno=230, col_offset=50, end_lineno=230, end_col_offset=63), lineno=230, col_offset=43, end_lineno=230, end_col_offset=63)]), body=[Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=231, col_offset=8, end_lineno=231, end_col_offset=12), attr='_settings', ctx=Store(), lineno=231, col_offset=8, end_lineno=231, end_col_offset=22)], value=Name(id='settings', ctx=Load(), lineno=231, col_offset=25, end_lineno=231, end_col_offset=33), lineno=231, col_offset=8, end_lineno=231, end_col_offset=33), Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=232, col_offset=8, end_lineno=232, end_col_offset=12), attr='_paths', ctx=Store(), lineno=232, col_offset=8, end_lineno=232, end_col_offset=19)], value=Name(id='paths', ctx=Load(), lineno=232, col_offset=22, end_lineno=232, end_col_offset=27), lineno=232, col_offset=8, end_lineno=232, end_col_offset=27), AnnAssign(target=Attribute(value=Name(id='self', ctx=Load(), lineno=233, col_offset=8, end_lineno=233, end_col_offset=12), attr='_bm25_provider', ctx=Store(), lineno=233, col_offset=8, end_lineno=233, end_col_offset=27), annotation=BinOp(left=Name(id='BM25SearchProvider', ctx=Load(), lineno=233, col_offset=29, end_lineno=233, end_col_offset=47), op=BitOr(), right=Constant(value=None, lineno=233, col_offset=50, end_lineno=233, end_col_offset=54), lineno=233, col_offset=29, end_lineno=233, end_col_offset=54), value=Constant(value=None, lineno=233, col_offset=57, end_lineno=233, end_col_offset=61), simple=0, lineno=233, col_offset=8, end_lineno=233, end_col_offset=61), AnnAssign(target=Attribute(value=Name(id='self', ctx=Load(), lineno=234, col_offset=8, end_lineno=234, end_col_offset=12), attr='_splade_provider', ctx=Store(), lineno=234, col_offset=8, end_lineno=234, end_col_offset=29), annotation=BinOp(left=Name(id='SpladeSearchProvider', ctx=Load(), lineno=234, col_offset=31, end_lineno=234, end_col_offset=51), op=BitOr(), right=Constant(value=None, lineno=234, col_offset=54, end_lineno=234, end_col_offset=58), lineno=234, col_offset=31, end_lineno=234, end_col_offset=58), value=Constant(value=None, lineno=234, col_offset=61, end_lineno=234, end_col_offset=65), simple=0, lineno=234, col_offset=8, end_lineno=234, end_col_offset=65), AnnAssign(target=Attribute(value=Name(id='self', ctx=Load(), lineno=235, col_offset=8, end_lineno=235, end_col_offset=12), attr='_bm25_error', ctx=Store(), lineno=235, col_offset=8, end_lineno=235, end_col_offset=24), annotation=BinOp(left=Name(id='str', ctx=Load(), lineno=235, col_offset=26, end_lineno=235, end_col_offset=29), op=BitOr(), right=Constant(value=None, lineno=235, col_offset=32, end_lineno=235, end_col_offset=36), lineno=235, col_offset=26, end_lineno=235, end_col_offset=36), value=Constant(value=None, lineno=235, col_offset=39, end_lineno=235, end_col_offset=43), simple=0, lineno=235, col_offset=8, end_lineno=235, end_col_offset=43), AnnAssign(target=Attribute(value=Name(id='self', ctx=Load(), lineno=236, col_offset=8, end_lineno=236, end_col_offset=12), attr='_splade_error', ctx=Store(), lineno=236, col_offset=8, end_lineno=236, end_col_offset=26), annotation=BinOp(left=Name(id='str', ctx=Load(), lineno=236, col_offset=28, end_lineno=236, end_col_offset=31), op=BitOr(), right=Constant(value=None, lineno=236, col_offset=34, end_lineno=236, end_col_offset=38), lineno=236, col_offset=28, end_lineno=236, end_col_offset=38), value=Constant(value=None, lineno=236, col_offset=41, end_lineno=236, end_col_offset=45), simple=0, lineno=236, col_offset=8, end_lineno=236, end_col_offset=45), Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=237, col_offset=8, end_lineno=237, end_col_offset=12), attr='_bm25_lock', ctx=Store(), lineno=237, col_offset=8, end_lineno=237, end_col_offset=23)], value=Call(func=Name(id='Lock', ctx=Load(), lineno=237, col_offset=26, end_lineno=237, end_col_offset=30), lineno=237, col_offset=26, end_lineno=237, end_col_offset=32), lineno=237, col_offset=8, end_lineno=237, end_col_offset=32), Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=238, col_offset=8, end_lineno=238, end_col_offset=12), attr='_splade_lock', ctx=Store(), lineno=238, col_offset=8, end_lineno=238, end_col_offset=25)], value=Call(func=Name(id='Lock', ctx=Load(), lineno=238, col_offset=28, end_lineno=238, end_col_offset=32), lineno=238, col_offset=28, end_lineno=238, end_col_offset=34), lineno=238, col_offset=8, end_lineno=238, end_col_offset=34)], returns=Constant(value=None, lineno=230, col_offset=68, end_lineno=230, end_col_offset=72), lineno=230, col_offset=4, end_lineno=238, end_col_offset=34), FunctionDef(name='search', args=arguments(args=[arg(arg='self', lineno=241, col_offset=8, end_lineno=241, end_col_offset=12), arg(arg='query', annotation=Name(id='str', ctx=Load(), lineno=242, col_offset=15, end_lineno=242, end_col_offset=18), lineno=242, col_offset=8, end_lineno=242, end_col_offset=18)], kwonlyargs=[arg(arg='semantic_hits', annotation=Subscript(value=Name(id='Sequence', ctx=Load(), lineno=244, col_offset=23, end_lineno=244, end_col_offset=31), slice=Subscript(value=Name(id='tuple', ctx=Load(), lineno=244, col_offset=32, end_lineno=244, end_col_offset=37), slice=Tuple(elts=[Name(id='int', ctx=Load(), lineno=244, col_offset=38, end_lineno=244, end_col_offset=41), Name(id='float', ctx=Load(), lineno=244, col_offset=43, end_lineno=244, end_col_offset=48)], ctx=Load(), lineno=244, col_offset=38, end_lineno=244, end_col_offset=48), ctx=Load(), lineno=244, col_offset=32, end_lineno=244, end_col_offset=49), ctx=Load(), lineno=244, col_offset=23, end_lineno=244, end_col_offset=50), lineno=244, col_offset=8, end_lineno=244, end_col_offset=50), arg(arg='limit', annotation=Name(id='int', ctx=Load(), lineno=245, col_offset=15, end_lineno=245, end_col_offset=18), lineno=245, col_offset=8, end_lineno=245, end_col_offset=18), arg(arg='extra_channels', annotation=BinOp(left=Subscript(value=Name(id='Mapping', ctx=Load(), lineno=246, col_offset=24, end_lineno=246, end_col_offset=31), slice=Tuple(elts=[Name(id='str', ctx=Load(), lineno=246, col_offset=32, end_lineno=246, end_col_offset=35), Subscript(value=Name(id='Sequence', ctx=Load(), lineno=246, col_offset=37, end_lineno=246, end_col_offset=45), slice=Name(id='ChannelHit', ctx=Load(), lineno=246, col_offset=46, end_lineno=246, end_col_offset=56), ctx=Load(), lineno=246, col_offset=37, end_lineno=246, end_col_offset=57)], ctx=Load(), lineno=246, col_offset=32, end_lineno=246, end_col_offset=57), ctx=Load(), lineno=246, col_offset=24, end_lineno=246, end_col_offset=58), op=BitOr(), right=Constant(value=None, lineno=246, col_offset=61, end_lineno=246, end_col_offset=65), lineno=246, col_offset=24, end_lineno=246, end_col_offset=65), lineno=246, col_offset=8, end_lineno=246, end_col_offset=65), arg(arg='weights', annotation=BinOp(left=Subscript(value=Name(id='Mapping', ctx=Load(), lineno=247, col_offset=17, end_lineno=247, end_col_offset=24), slice=Tuple(elts=[Name(id='str', ctx=Load(), lineno=247, col_offset=25, end_lineno=247, end_col_offset=28), Name(id='float', ctx=Load(), lineno=247, col_offset=30, end_lineno=247, end_col_offset=35)], ctx=Load(), lineno=247, col_offset=25, end_lineno=247, end_col_offset=35), ctx=Load(), lineno=247, col_offset=17, end_lineno=247, end_col_offset=36), op=BitOr(), right=Constant(value=None, lineno=247, col_offset=39, end_lineno=247, end_col_offset=43), lineno=247, col_offset=17, end_lineno=247, end_col_offset=43), lineno=247, col_offset=8, end_lineno=247, end_col_offset=43)], kw_defaults=[None, None, Constant(value=None, lineno=246, col_offset=68, end_lineno=246, end_col_offset=72), Constant(value=None, lineno=247, col_offset=46, end_lineno=247, end_col_offset=50)]), body=[Expr(value=Constant(value="Fuse dense and sparse retrieval results for ``query``.\n\n        This method combines results from multiple retrieval channels (semantic/FAISS,\n        BM25, SPLADE) using Reciprocal Rank Fusion (RRF) to produce a unified ranked\n        list. RRF is a rank aggregation technique that combines multiple ranked lists\n        without requiring score normalization, making it ideal for fusing different\n        retrieval modalities with incompatible score ranges.\n\n        The method gathers hits from all enabled channels (semantic is always included,\n        BM25 and SPLADE are optional based on settings), then applies RRF fusion to\n        produce the final ranked results. Channel contributions are tracked for\n        transparency and debugging.\n\n        Parameters\n        ----------\n        query : str\n            Search query string. Used for sparse retrieval channels (BM25, SPLADE)\n            which perform keyword-based or learned sparse matching. The semantic\n            channel uses pre-computed embeddings, so the query text is only used\n            for sparse channels.\n        semantic_hits : Sequence[tuple[int, float]]\n            Ordered dense results expressed as ``(doc_id, score)`` pairs.\n        limit : int\n            Maximum number of final results to return after RRF fusion. The fusion\n            process ranks all documents from all channels, then returns the top\n            'limit' documents. Must be a positive integer.\n        extra_channels : Mapping[str, Sequence[ChannelHit]] | None\n            Optional externally supplied channels (e.g., WARP). Each entry is\n            merged into the RRF runs prior to fusion.\n        weights : Mapping[str, float] | None\n            Optional per-channel weights applied during fusion. Defaults to\n            equal weighting.\n\n        Returns\n        -------\n        HybridSearchResult\n            Fused retrieval output containing:\n            - docs: Final ranked list of documents (top 'limit' after RRF fusion)\n            - contributions: Per-document breakdown of which channels contributed\n              each document (useful for understanding fusion behavior)\n            - channels: List of active channel identifiers that contributed results\n            - warnings: Any warnings generated during channel retrieval (e.g., index\n              unavailable, encoding failures)\n        ", lineno=249, col_offset=8, end_lineno=292, end_col_offset=11), lineno=249, col_offset=8, end_lineno=292, end_col_offset=11), Assign(targets=[Tuple(elts=[Name(id='runs', ctx=Store(), lineno=293, col_offset=8, end_lineno=293, end_col_offset=12), Name(id='warnings', ctx=Store(), lineno=293, col_offset=14, end_lineno=293, end_col_offset=22)], ctx=Store(), lineno=293, col_offset=8, end_lineno=293, end_col_offset=22)], value=Call(func=Attribute(value=Name(id='self', ctx=Load(), lineno=293, col_offset=25, end_lineno=293, end_col_offset=29), attr='_gather_channel_hits', ctx=Load(), lineno=293, col_offset=25, end_lineno=293, end_col_offset=50), args=[Name(id='query', ctx=Load(), lineno=293, col_offset=51, end_lineno=293, end_col_offset=56), Name(id='semantic_hits', ctx=Load(), lineno=293, col_offset=58, end_lineno=293, end_col_offset=71)], lineno=293, col_offset=25, end_lineno=293, end_col_offset=72), lineno=293, col_offset=8, end_lineno=293, end_col_offset=72), If(test=Name(id='extra_channels', ctx=Load(), lineno=294, col_offset=11, end_lineno=294, end_col_offset=25), body=[For(target=Tuple(elts=[Name(id='name', ctx=Store(), lineno=295, col_offset=16, end_lineno=295, end_col_offset=20), Name(id='hits', ctx=Store(), lineno=295, col_offset=22, end_lineno=295, end_col_offset=26)], ctx=Store(), lineno=295, col_offset=16, end_lineno=295, end_col_offset=26), iter=Call(func=Attribute(value=Name(id='extra_channels', ctx=Load(), lineno=295, col_offset=30, end_lineno=295, end_col_offset=44), attr='items', ctx=Load(), lineno=295, col_offset=30, end_lineno=295, end_col_offset=50), lineno=295, col_offset=30, end_lineno=295, end_col_offset=52), body=[If(test=UnaryOp(op=Not(), operand=Name(id='hits', ctx=Load(), lineno=296, col_offset=23, end_lineno=296, end_col_offset=27), lineno=296, col_offset=19, end_lineno=296, end_col_offset=27), body=[Continue(lineno=297, col_offset=20, end_lineno=297, end_col_offset=28)], lineno=296, col_offset=16, end_lineno=297, end_col_offset=28), Assign(targets=[Subscript(value=Name(id='runs', ctx=Load(), lineno=298, col_offset=16, end_lineno=298, end_col_offset=20), slice=Name(id='name', ctx=Load(), lineno=298, col_offset=21, end_lineno=298, end_col_offset=25), ctx=Store(), lineno=298, col_offset=16, end_lineno=298, end_col_offset=26)], value=Call(func=Name(id='list', ctx=Load(), lineno=298, col_offset=29, end_lineno=298, end_col_offset=33), args=[Name(id='hits', ctx=Load(), lineno=298, col_offset=34, end_lineno=298, end_col_offset=38)], lineno=298, col_offset=29, end_lineno=298, end_col_offset=39), lineno=298, col_offset=16, end_lineno=298, end_col_offset=39)], lineno=295, col_offset=12, end_lineno=298, end_col_offset=39)], lineno=294, col_offset=8, end_lineno=298, end_col_offset=39), If(test=UnaryOp(op=Not(), operand=Name(id='runs', ctx=Load(), lineno=299, col_offset=15, end_lineno=299, end_col_offset=19), lineno=299, col_offset=11, end_lineno=299, end_col_offset=19), body=[Return(value=Call(func=Name(id='HybridSearchResult', ctx=Load(), lineno=300, col_offset=19, end_lineno=300, end_col_offset=37), keywords=[keyword(arg='docs', value=List(ctx=Load(), lineno=301, col_offset=21, end_lineno=301, end_col_offset=23), lineno=301, col_offset=16, end_lineno=301, end_col_offset=23), keyword(arg='contributions', value=Dict(lineno=302, col_offset=30, end_lineno=302, end_col_offset=32), lineno=302, col_offset=16, end_lineno=302, end_col_offset=32), keyword(arg='channels', value=List(ctx=Load(), lineno=303, col_offset=25, end_lineno=303, end_col_offset=27), lineno=303, col_offset=16, end_lineno=303, end_col_offset=27), keyword(arg='warnings', value=Name(id='warnings', ctx=Load(), lineno=304, col_offset=25, end_lineno=304, end_col_offset=33), lineno=304, col_offset=16, end_lineno=304, end_col_offset=33)], lineno=300, col_offset=19, end_lineno=305, end_col_offset=13), lineno=300, col_offset=12, end_lineno=305, end_col_offset=13)], lineno=299, col_offset=8, end_lineno=305, end_col_offset=13), If(test=Name(id='weights', ctx=Load(), lineno=307, col_offset=11, end_lineno=307, end_col_offset=18), body=[Assign(targets=[Tuple(elts=[Name(id='docs', ctx=Store(), lineno=308, col_offset=12, end_lineno=308, end_col_offset=16), Name(id='contributions', ctx=Store(), lineno=308, col_offset=18, end_lineno=308, end_col_offset=31)], ctx=Store(), lineno=308, col_offset=12, end_lineno=308, end_col_offset=31)], value=Call(func=Name(id='fuse_weighted_rrf', ctx=Load(), lineno=308, col_offset=34, end_lineno=308, end_col_offset=51), args=[Name(id='runs', ctx=Load(), lineno=309, col_offset=16, end_lineno=309, end_col_offset=20)], keywords=[keyword(arg='weights', value=Name(id='weights', ctx=Load(), lineno=310, col_offset=24, end_lineno=310, end_col_offset=31), lineno=310, col_offset=16, end_lineno=310, end_col_offset=31), keyword(arg='k', value=Attribute(value=Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=311, col_offset=18, end_lineno=311, end_col_offset=22), attr='_settings', ctx=Load(), lineno=311, col_offset=18, end_lineno=311, end_col_offset=32), attr='index', ctx=Load(), lineno=311, col_offset=18, end_lineno=311, end_col_offset=38), attr='rrf_k', ctx=Load(), lineno=311, col_offset=18, end_lineno=311, end_col_offset=44), lineno=311, col_offset=16, end_lineno=311, end_col_offset=44), keyword(arg='limit', value=Name(id='limit', ctx=Load(), lineno=312, col_offset=22, end_lineno=312, end_col_offset=27), lineno=312, col_offset=16, end_lineno=312, end_col_offset=27)], lineno=308, col_offset=34, end_lineno=313, end_col_offset=13), lineno=308, col_offset=12, end_lineno=313, end_col_offset=13)], orelse=[Assign(targets=[Tuple(elts=[Name(id='docs', ctx=Store(), lineno=315, col_offset=12, end_lineno=315, end_col_offset=16), Name(id='contributions', ctx=Store(), lineno=315, col_offset=18, end_lineno=315, end_col_offset=31)], ctx=Store(), lineno=315, col_offset=12, end_lineno=315, end_col_offset=31)], value=Call(func=Name(id='_rrf_fuse', ctx=Load(), lineno=315, col_offset=34, end_lineno=315, end_col_offset=43), args=[Name(id='runs', ctx=Load(), lineno=316, col_offset=16, end_lineno=316, end_col_offset=20)], keywords=[keyword(arg='k', value=Attribute(value=Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=317, col_offset=18, end_lineno=317, end_col_offset=22), attr='_settings', ctx=Load(), lineno=317, col_offset=18, end_lineno=317, end_col_offset=32), attr='index', ctx=Load(), lineno=317, col_offset=18, end_lineno=317, end_col_offset=38), attr='rrf_k', ctx=Load(), lineno=317, col_offset=18, end_lineno=317, end_col_offset=44), lineno=317, col_offset=16, end_lineno=317, end_col_offset=44), keyword(arg='limit', value=Name(id='limit', ctx=Load(), lineno=318, col_offset=22, end_lineno=318, end_col_offset=27), lineno=318, col_offset=16, end_lineno=318, end_col_offset=27)], lineno=315, col_offset=34, end_lineno=319, end_col_offset=13), lineno=315, col_offset=12, end_lineno=319, end_col_offset=13)], lineno=307, col_offset=8, end_lineno=319, end_col_offset=13), Assign(targets=[Name(id='active_channels', ctx=Store(), lineno=320, col_offset=8, end_lineno=320, end_col_offset=23)], value=ListComp(elt=Name(id='channel', ctx=Load(), lineno=320, col_offset=27, end_lineno=320, end_col_offset=34), generators=[comprehension(target=Tuple(elts=[Name(id='channel', ctx=Store(), lineno=320, col_offset=39, end_lineno=320, end_col_offset=46), Name(id='hits', ctx=Store(), lineno=320, col_offset=48, end_lineno=320, end_col_offset=52)], ctx=Store(), lineno=320, col_offset=39, end_lineno=320, end_col_offset=52), iter=Call(func=Attribute(value=Name(id='runs', ctx=Load(), lineno=320, col_offset=56, end_lineno=320, end_col_offset=60), attr='items', ctx=Load(), lineno=320, col_offset=56, end_lineno=320, end_col_offset=66), lineno=320, col_offset=56, end_lineno=320, end_col_offset=68), ifs=[Name(id='hits', ctx=Load(), lineno=320, col_offset=72, end_lineno=320, end_col_offset=76)], is_async=0)], lineno=320, col_offset=26, end_lineno=320, end_col_offset=77), lineno=320, col_offset=8, end_lineno=320, end_col_offset=77), Return(value=Call(func=Name(id='HybridSearchResult', ctx=Load(), lineno=321, col_offset=15, end_lineno=321, end_col_offset=33), keywords=[keyword(arg='docs', value=Name(id='docs', ctx=Load(), lineno=322, col_offset=17, end_lineno=322, end_col_offset=21), lineno=322, col_offset=12, end_lineno=322, end_col_offset=21), keyword(arg='contributions', value=DictComp(key=Attribute(value=Name(id='doc', ctx=Load(), lineno=323, col_offset=27, end_lineno=323, end_col_offset=30), attr='doc_id', ctx=Load(), lineno=323, col_offset=27, end_lineno=323, end_col_offset=37), value=Call(func=Attribute(value=Name(id='contributions', ctx=Load(), lineno=323, col_offset=39, end_lineno=323, end_col_offset=52), attr='get', ctx=Load(), lineno=323, col_offset=39, end_lineno=323, end_col_offset=56), args=[Attribute(value=Name(id='doc', ctx=Load(), lineno=323, col_offset=57, end_lineno=323, end_col_offset=60), attr='doc_id', ctx=Load(), lineno=323, col_offset=57, end_lineno=323, end_col_offset=67), List(ctx=Load(), lineno=323, col_offset=69, end_lineno=323, end_col_offset=71)], lineno=323, col_offset=39, end_lineno=323, end_col_offset=72), generators=[comprehension(target=Name(id='doc', ctx=Store(), lineno=323, col_offset=77, end_lineno=323, end_col_offset=80), iter=Name(id='docs', ctx=Load(), lineno=323, col_offset=84, end_lineno=323, end_col_offset=88), is_async=0)], lineno=323, col_offset=26, end_lineno=323, end_col_offset=89), lineno=323, col_offset=12, end_lineno=323, end_col_offset=89), keyword(arg='channels', value=Name(id='active_channels', ctx=Load(), lineno=324, col_offset=21, end_lineno=324, end_col_offset=36), lineno=324, col_offset=12, end_lineno=324, end_col_offset=36), keyword(arg='warnings', value=Name(id='warnings', ctx=Load(), lineno=325, col_offset=21, end_lineno=325, end_col_offset=29), lineno=325, col_offset=12, end_lineno=325, end_col_offset=29)], lineno=321, col_offset=15, end_lineno=326, end_col_offset=9), lineno=321, col_offset=8, end_lineno=326, end_col_offset=9)], returns=Name(id='HybridSearchResult', ctx=Load(), lineno=248, col_offset=9, end_lineno=248, end_col_offset=27), lineno=240, col_offset=4, end_lineno=326, end_col_offset=9), FunctionDef(name='_gather_channel_hits', args=arguments(args=[arg(arg='self', lineno=329, col_offset=8, end_lineno=329, end_col_offset=12), arg(arg='query', annotation=Name(id='str', ctx=Load(), lineno=330, col_offset=15, end_lineno=330, end_col_offset=18), lineno=330, col_offset=8, end_lineno=330, end_col_offset=18), arg(arg='semantic_hits', annotation=Subscript(value=Name(id='Sequence', ctx=Load(), lineno=331, col_offset=23, end_lineno=331, end_col_offset=31), slice=Subscript(value=Name(id='tuple', ctx=Load(), lineno=331, col_offset=32, end_lineno=331, end_col_offset=37), slice=Tuple(elts=[Name(id='int', ctx=Load(), lineno=331, col_offset=38, end_lineno=331, end_col_offset=41), Name(id='float', ctx=Load(), lineno=331, col_offset=43, end_lineno=331, end_col_offset=48)], ctx=Load(), lineno=331, col_offset=38, end_lineno=331, end_col_offset=48), ctx=Load(), lineno=331, col_offset=32, end_lineno=331, end_col_offset=49), ctx=Load(), lineno=331, col_offset=23, end_lineno=331, end_col_offset=50), lineno=331, col_offset=8, end_lineno=331, end_col_offset=50)]), body=[Expr(value=Constant(value='Collect per-channel search hits and warnings for ``query``.\n\n        This internal method coordinates retrieval across all enabled channels,\n        collecting results from semantic (FAISS), BM25, and SPLADE channels.\n        Each channel is queried independently, and errors are captured as warnings\n        rather than exceptions to ensure robust multi-channel retrieval.\n\n        The semantic channel is always included (converting IDs and scores to\n        ChannelHit objects). BM25 and SPLADE channels are conditionally enabled\n        based on settings and availability. Channel initialization errors are\n        captured as warnings and included in the return value.\n\n        Parameters\n        ----------\n        query : str\n            Search query string. Used for sparse retrieval channels (BM25, SPLADE).\n            The semantic channel uses pre-computed results, so query is only\n            relevant for sparse channels.\n        semantic_hits : Sequence[tuple[int, float]]\n            Dense retrieval hits expressed as ``(doc_id, score)`` pairs.\n\n        Returns\n        -------\n        tuple[dict[str, list[ChannelHit]], list[str]]\n            Tuple containing:\n            - Dictionary mapping channel identifiers ("semantic", "bm25", "splade")\n              to lists of ChannelHit objects. Only channels that successfully\n              returned results are included.\n            - List of warning messages accumulated during channel retrieval. Includes\n              initialization errors, search failures, and availability issues.\n        ', lineno=333, col_offset=8, end_lineno=363, end_col_offset=11), lineno=333, col_offset=8, end_lineno=363, end_col_offset=11), AnnAssign(target=Name(id='runs', ctx=Store(), lineno=364, col_offset=8, end_lineno=364, end_col_offset=12), annotation=Subscript(value=Name(id='dict', ctx=Load(), lineno=364, col_offset=14, end_lineno=364, end_col_offset=18), slice=Tuple(elts=[Name(id='str', ctx=Load(), lineno=364, col_offset=19, end_lineno=364, end_col_offset=22), Subscript(value=Name(id='list', ctx=Load(), lineno=364, col_offset=24, end_lineno=364, end_col_offset=28), slice=Name(id='ChannelHit', ctx=Load(), lineno=364, col_offset=29, end_lineno=364, end_col_offset=39), ctx=Load(), lineno=364, col_offset=24, end_lineno=364, end_col_offset=40)], ctx=Load(), lineno=364, col_offset=19, end_lineno=364, end_col_offset=40), ctx=Load(), lineno=364, col_offset=14, end_lineno=364, end_col_offset=41), value=Dict(lineno=364, col_offset=44, end_lineno=364, end_col_offset=46), simple=1, lineno=364, col_offset=8, end_lineno=364, end_col_offset=46), AnnAssign(target=Name(id='warnings', ctx=Store(), lineno=365, col_offset=8, end_lineno=365, end_col_offset=16), annotation=Subscript(value=Name(id='list', ctx=Load(), lineno=365, col_offset=18, end_lineno=365, end_col_offset=22), slice=Name(id='str', ctx=Load(), lineno=365, col_offset=23, end_lineno=365, end_col_offset=26), ctx=Load(), lineno=365, col_offset=18, end_lineno=365, end_col_offset=27), value=List(ctx=Load(), lineno=365, col_offset=30, end_lineno=365, end_col_offset=32), simple=1, lineno=365, col_offset=8, end_lineno=365, end_col_offset=32), Assign(targets=[Name(id='semantic_channel_hits', ctx=Store(), lineno=367, col_offset=8, end_lineno=367, end_col_offset=29)], value=Call(func=Attribute(value=Name(id='self', ctx=Load(), lineno=367, col_offset=32, end_lineno=367, end_col_offset=36), attr='_build_semantic_channel_hits', ctx=Load(), lineno=367, col_offset=32, end_lineno=367, end_col_offset=65), args=[Name(id='semantic_hits', ctx=Load(), lineno=367, col_offset=66, end_lineno=367, end_col_offset=79)], lineno=367, col_offset=32, end_lineno=367, end_col_offset=80), lineno=367, col_offset=8, end_lineno=367, end_col_offset=80), If(test=Name(id='semantic_channel_hits', ctx=Load(), lineno=368, col_offset=11, end_lineno=368, end_col_offset=32), body=[Assign(targets=[Subscript(value=Name(id='runs', ctx=Load(), lineno=369, col_offset=12, end_lineno=369, end_col_offset=16), slice=Constant(value='semantic', lineno=369, col_offset=17, end_lineno=369, end_col_offset=27), ctx=Store(), lineno=369, col_offset=12, end_lineno=369, end_col_offset=28)], value=Name(id='semantic_channel_hits', ctx=Load(), lineno=369, col_offset=31, end_lineno=369, end_col_offset=52), lineno=369, col_offset=12, end_lineno=369, end_col_offset=52)], lineno=368, col_offset=8, end_lineno=369, end_col_offset=52), If(test=Attribute(value=Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=371, col_offset=11, end_lineno=371, end_col_offset=15), attr='_settings', ctx=Load(), lineno=371, col_offset=11, end_lineno=371, end_col_offset=25), attr='index', ctx=Load(), lineno=371, col_offset=11, end_lineno=371, end_col_offset=31), attr='enable_bm25_channel', ctx=Load(), lineno=371, col_offset=11, end_lineno=371, end_col_offset=51), body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load(), lineno=372, col_offset=12, end_lineno=372, end_col_offset=16), attr='_maybe_add_bm25_hits', ctx=Load(), lineno=372, col_offset=12, end_lineno=372, end_col_offset=37), args=[Name(id='query', ctx=Load(), lineno=372, col_offset=38, end_lineno=372, end_col_offset=43), Name(id='runs', ctx=Load(), lineno=372, col_offset=45, end_lineno=372, end_col_offset=49), Name(id='warnings', ctx=Load(), lineno=372, col_offset=51, end_lineno=372, end_col_offset=59)], lineno=372, col_offset=12, end_lineno=372, end_col_offset=60), lineno=372, col_offset=12, end_lineno=372, end_col_offset=60)], lineno=371, col_offset=8, end_lineno=372, end_col_offset=60), If(test=Attribute(value=Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=373, col_offset=11, end_lineno=373, end_col_offset=15), attr='_settings', ctx=Load(), lineno=373, col_offset=11, end_lineno=373, end_col_offset=25), attr='index', ctx=Load(), lineno=373, col_offset=11, end_lineno=373, end_col_offset=31), attr='enable_splade_channel', ctx=Load(), lineno=373, col_offset=11, end_lineno=373, end_col_offset=53), body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load(), lineno=374, col_offset=12, end_lineno=374, end_col_offset=16), attr='_maybe_add_splade_hits', ctx=Load(), lineno=374, col_offset=12, end_lineno=374, end_col_offset=39), args=[Name(id='query', ctx=Load(), lineno=374, col_offset=40, end_lineno=374, end_col_offset=45), Name(id='runs', ctx=Load(), lineno=374, col_offset=47, end_lineno=374, end_col_offset=51), Name(id='warnings', ctx=Load(), lineno=374, col_offset=53, end_lineno=374, end_col_offset=61)], lineno=374, col_offset=12, end_lineno=374, end_col_offset=62), lineno=374, col_offset=12, end_lineno=374, end_col_offset=62)], lineno=373, col_offset=8, end_lineno=374, end_col_offset=62), Return(value=Tuple(elts=[Name(id='runs', ctx=Load(), lineno=376, col_offset=15, end_lineno=376, end_col_offset=19), Name(id='warnings', ctx=Load(), lineno=376, col_offset=21, end_lineno=376, end_col_offset=29)], ctx=Load(), lineno=376, col_offset=15, end_lineno=376, end_col_offset=29), lineno=376, col_offset=8, end_lineno=376, end_col_offset=29)], returns=Subscript(value=Name(id='tuple', ctx=Load(), lineno=332, col_offset=9, end_lineno=332, end_col_offset=14), slice=Tuple(elts=[Subscript(value=Name(id='dict', ctx=Load(), lineno=332, col_offset=15, end_lineno=332, end_col_offset=19), slice=Tuple(elts=[Name(id='str', ctx=Load(), lineno=332, col_offset=20, end_lineno=332, end_col_offset=23), Subscript(value=Name(id='list', ctx=Load(), lineno=332, col_offset=25, end_lineno=332, end_col_offset=29), slice=Name(id='ChannelHit', ctx=Load(), lineno=332, col_offset=30, end_lineno=332, end_col_offset=40), ctx=Load(), lineno=332, col_offset=25, end_lineno=332, end_col_offset=41)], ctx=Load(), lineno=332, col_offset=20, end_lineno=332, end_col_offset=41), ctx=Load(), lineno=332, col_offset=15, end_lineno=332, end_col_offset=42), Subscript(value=Name(id='list', ctx=Load(), lineno=332, col_offset=44, end_lineno=332, end_col_offset=48), slice=Name(id='str', ctx=Load(), lineno=332, col_offset=49, end_lineno=332, end_col_offset=52), ctx=Load(), lineno=332, col_offset=44, end_lineno=332, end_col_offset=53)], ctx=Load(), lineno=332, col_offset=15, end_lineno=332, end_col_offset=53), ctx=Load(), lineno=332, col_offset=9, end_lineno=332, end_col_offset=54), lineno=328, col_offset=4, end_lineno=376, end_col_offset=29), FunctionDef(name='_maybe_add_bm25_hits', args=arguments(args=[arg(arg='self', lineno=379, col_offset=8, end_lineno=379, end_col_offset=12), arg(arg='query', annotation=Name(id='str', ctx=Load(), lineno=380, col_offset=15, end_lineno=380, end_col_offset=18), lineno=380, col_offset=8, end_lineno=380, end_col_offset=18), arg(arg='runs', annotation=Subscript(value=Name(id='dict', ctx=Load(), lineno=381, col_offset=14, end_lineno=381, end_col_offset=18), slice=Tuple(elts=[Name(id='str', ctx=Load(), lineno=381, col_offset=19, end_lineno=381, end_col_offset=22), Subscript(value=Name(id='list', ctx=Load(), lineno=381, col_offset=24, end_lineno=381, end_col_offset=28), slice=Name(id='ChannelHit', ctx=Load(), lineno=381, col_offset=29, end_lineno=381, end_col_offset=39), ctx=Load(), lineno=381, col_offset=24, end_lineno=381, end_col_offset=40)], ctx=Load(), lineno=381, col_offset=19, end_lineno=381, end_col_offset=40), ctx=Load(), lineno=381, col_offset=14, end_lineno=381, end_col_offset=41), lineno=381, col_offset=8, end_lineno=381, end_col_offset=41), arg(arg='warnings', annotation=Subscript(value=Name(id='list', ctx=Load(), lineno=382, col_offset=18, end_lineno=382, end_col_offset=22), slice=Name(id='str', ctx=Load(), lineno=382, col_offset=23, end_lineno=382, end_col_offset=26), ctx=Load(), lineno=382, col_offset=18, end_lineno=382, end_col_offset=27), lineno=382, col_offset=8, end_lineno=382, end_col_offset=27)]), body=[Expr(value=Constant(value='Populate BM25 hits when the channel is available.', lineno=384, col_offset=8, end_lineno=384, end_col_offset=63), lineno=384, col_offset=8, end_lineno=384, end_col_offset=63), Assign(targets=[Name(id='provider', ctx=Store(), lineno=385, col_offset=8, end_lineno=385, end_col_offset=16)], value=Call(func=Attribute(value=Name(id='self', ctx=Load(), lineno=385, col_offset=19, end_lineno=385, end_col_offset=23), attr='_ensure_bm25_provider', ctx=Load(), lineno=385, col_offset=19, end_lineno=385, end_col_offset=45), lineno=385, col_offset=19, end_lineno=385, end_col_offset=47), lineno=385, col_offset=8, end_lineno=385, end_col_offset=47), If(test=Compare(left=Name(id='provider', ctx=Load(), lineno=386, col_offset=11, end_lineno=386, end_col_offset=19), ops=[Is()], comparators=[Constant(value=None, lineno=386, col_offset=23, end_lineno=386, end_col_offset=27)], lineno=386, col_offset=11, end_lineno=386, end_col_offset=27), body=[If(test=Attribute(value=Name(id='self', ctx=Load(), lineno=387, col_offset=15, end_lineno=387, end_col_offset=19), attr='_bm25_error', ctx=Load(), lineno=387, col_offset=15, end_lineno=387, end_col_offset=31), body=[Expr(value=Call(func=Attribute(value=Name(id='warnings', ctx=Load(), lineno=388, col_offset=16, end_lineno=388, end_col_offset=24), attr='append', ctx=Load(), lineno=388, col_offset=16, end_lineno=388, end_col_offset=31), args=[Attribute(value=Name(id='self', ctx=Load(), lineno=388, col_offset=32, end_lineno=388, end_col_offset=36), attr='_bm25_error', ctx=Load(), lineno=388, col_offset=32, end_lineno=388, end_col_offset=48)], lineno=388, col_offset=16, end_lineno=388, end_col_offset=49), lineno=388, col_offset=16, end_lineno=388, end_col_offset=49)], lineno=387, col_offset=12, end_lineno=388, end_col_offset=49), Return(lineno=389, col_offset=12, end_lineno=389, end_col_offset=18)], lineno=386, col_offset=8, end_lineno=389, end_col_offset=18), Try(body=[Assign(targets=[Name(id='hits', ctx=Store(), lineno=392, col_offset=12, end_lineno=392, end_col_offset=16)], value=Call(func=Attribute(value=Name(id='provider', ctx=Load(), lineno=392, col_offset=19, end_lineno=392, end_col_offset=27), attr='search', ctx=Load(), lineno=392, col_offset=19, end_lineno=392, end_col_offset=34), args=[Name(id='query', ctx=Load(), lineno=392, col_offset=35, end_lineno=392, end_col_offset=40), Attribute(value=Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=392, col_offset=42, end_lineno=392, end_col_offset=46), attr='_settings', ctx=Load(), lineno=392, col_offset=42, end_lineno=392, end_col_offset=56), attr='index', ctx=Load(), lineno=392, col_offset=42, end_lineno=392, end_col_offset=62), attr='hybrid_top_k_per_channel', ctx=Load(), lineno=392, col_offset=42, end_lineno=392, end_col_offset=87)], lineno=392, col_offset=19, end_lineno=392, end_col_offset=88), lineno=392, col_offset=12, end_lineno=392, end_col_offset=88)], handlers=[ExceptHandler(type=Tuple(elts=[Name(id='RuntimeError', ctx=Load(), lineno=394, col_offset=12, end_lineno=394, end_col_offset=24), Name(id='ValueError', ctx=Load(), lineno=395, col_offset=12, end_lineno=395, end_col_offset=22)], ctx=Load(), lineno=393, col_offset=15, end_lineno=396, end_col_offset=9), name='exc', body=[Assign(targets=[Name(id='msg', ctx=Store(), lineno=397, col_offset=12, end_lineno=397, end_col_offset=15)], value=JoinedStr(values=[Constant(value='BM25 channel unavailable: ', lineno=397, col_offset=20, end_lineno=397, end_col_offset=46), FormattedValue(value=Name(id='exc', ctx=Load(), lineno=397, col_offset=47, end_lineno=397, end_col_offset=50), conversion=-1, lineno=397, col_offset=46, end_lineno=397, end_col_offset=51)], lineno=397, col_offset=18, end_lineno=397, end_col_offset=52), lineno=397, col_offset=12, end_lineno=397, end_col_offset=52), Expr(value=Call(func=Attribute(value=Name(id='warnings', ctx=Load(), lineno=398, col_offset=12, end_lineno=398, end_col_offset=20), attr='append', ctx=Load(), lineno=398, col_offset=12, end_lineno=398, end_col_offset=27), args=[Name(id='msg', ctx=Load(), lineno=398, col_offset=28, end_lineno=398, end_col_offset=31)], lineno=398, col_offset=12, end_lineno=398, end_col_offset=32), lineno=398, col_offset=12, end_lineno=398, end_col_offset=32), Expr(value=Call(func=Attribute(value=Name(id='LOGGER', ctx=Load(), lineno=399, col_offset=12, end_lineno=399, end_col_offset=18), attr='warning', ctx=Load(), lineno=399, col_offset=12, end_lineno=399, end_col_offset=26), args=[Name(id='msg', ctx=Load(), lineno=399, col_offset=27, end_lineno=399, end_col_offset=30)], keywords=[keyword(arg='exc_info', value=Name(id='exc', ctx=Load(), lineno=399, col_offset=41, end_lineno=399, end_col_offset=44), lineno=399, col_offset=32, end_lineno=399, end_col_offset=44)], lineno=399, col_offset=12, end_lineno=399, end_col_offset=45), lineno=399, col_offset=12, end_lineno=399, end_col_offset=45), Return(lineno=400, col_offset=12, end_lineno=400, end_col_offset=18)], lineno=393, col_offset=8, end_lineno=400, end_col_offset=18)], lineno=391, col_offset=8, end_lineno=400, end_col_offset=18), If(test=Name(id='hits', ctx=Load(), lineno=402, col_offset=11, end_lineno=402, end_col_offset=15), body=[Assign(targets=[Subscript(value=Name(id='runs', ctx=Load(), lineno=403, col_offset=12, end_lineno=403, end_col_offset=16), slice=Constant(value='bm25', lineno=403, col_offset=17, end_lineno=403, end_col_offset=23), ctx=Store(), lineno=403, col_offset=12, end_lineno=403, end_col_offset=24)], value=Name(id='hits', ctx=Load(), lineno=403, col_offset=27, end_lineno=403, end_col_offset=31), lineno=403, col_offset=12, end_lineno=403, end_col_offset=31)], lineno=402, col_offset=8, end_lineno=403, end_col_offset=31)], returns=Constant(value=None, lineno=383, col_offset=9, end_lineno=383, end_col_offset=13), lineno=378, col_offset=4, end_lineno=403, end_col_offset=31), FunctionDef(name='_maybe_add_splade_hits', args=arguments(args=[arg(arg='self', lineno=406, col_offset=8, end_lineno=406, end_col_offset=12), arg(arg='query', annotation=Name(id='str', ctx=Load(), lineno=407, col_offset=15, end_lineno=407, end_col_offset=18), lineno=407, col_offset=8, end_lineno=407, end_col_offset=18), arg(arg='runs', annotation=Subscript(value=Name(id='dict', ctx=Load(), lineno=408, col_offset=14, end_lineno=408, end_col_offset=18), slice=Tuple(elts=[Name(id='str', ctx=Load(), lineno=408, col_offset=19, end_lineno=408, end_col_offset=22), Subscript(value=Name(id='list', ctx=Load(), lineno=408, col_offset=24, end_lineno=408, end_col_offset=28), slice=Name(id='ChannelHit', ctx=Load(), lineno=408, col_offset=29, end_lineno=408, end_col_offset=39), ctx=Load(), lineno=408, col_offset=24, end_lineno=408, end_col_offset=40)], ctx=Load(), lineno=408, col_offset=19, end_lineno=408, end_col_offset=40), ctx=Load(), lineno=408, col_offset=14, end_lineno=408, end_col_offset=41), lineno=408, col_offset=8, end_lineno=408, end_col_offset=41), arg(arg='warnings', annotation=Subscript(value=Name(id='list', ctx=Load(), lineno=409, col_offset=18, end_lineno=409, end_col_offset=22), slice=Name(id='str', ctx=Load(), lineno=409, col_offset=23, end_lineno=409, end_col_offset=26), ctx=Load(), lineno=409, col_offset=18, end_lineno=409, end_col_offset=27), lineno=409, col_offset=8, end_lineno=409, end_col_offset=27)]), body=[Expr(value=Constant(value='Populate SPLADE hits when the channel is available.', lineno=411, col_offset=8, end_lineno=411, end_col_offset=65), lineno=411, col_offset=8, end_lineno=411, end_col_offset=65), Assign(targets=[Name(id='provider', ctx=Store(), lineno=412, col_offset=8, end_lineno=412, end_col_offset=16)], value=Call(func=Attribute(value=Name(id='self', ctx=Load(), lineno=412, col_offset=19, end_lineno=412, end_col_offset=23), attr='_ensure_splade_provider', ctx=Load(), lineno=412, col_offset=19, end_lineno=412, end_col_offset=47), lineno=412, col_offset=19, end_lineno=412, end_col_offset=49), lineno=412, col_offset=8, end_lineno=412, end_col_offset=49), If(test=Compare(left=Name(id='provider', ctx=Load(), lineno=413, col_offset=11, end_lineno=413, end_col_offset=19), ops=[Is()], comparators=[Constant(value=None, lineno=413, col_offset=23, end_lineno=413, end_col_offset=27)], lineno=413, col_offset=11, end_lineno=413, end_col_offset=27), body=[If(test=Attribute(value=Name(id='self', ctx=Load(), lineno=414, col_offset=15, end_lineno=414, end_col_offset=19), attr='_splade_error', ctx=Load(), lineno=414, col_offset=15, end_lineno=414, end_col_offset=33), body=[Expr(value=Call(func=Attribute(value=Name(id='warnings', ctx=Load(), lineno=415, col_offset=16, end_lineno=415, end_col_offset=24), attr='append', ctx=Load(), lineno=415, col_offset=16, end_lineno=415, end_col_offset=31), args=[Attribute(value=Name(id='self', ctx=Load(), lineno=415, col_offset=32, end_lineno=415, end_col_offset=36), attr='_splade_error', ctx=Load(), lineno=415, col_offset=32, end_lineno=415, end_col_offset=50)], lineno=415, col_offset=16, end_lineno=415, end_col_offset=51), lineno=415, col_offset=16, end_lineno=415, end_col_offset=51)], lineno=414, col_offset=12, end_lineno=415, end_col_offset=51), Return(lineno=416, col_offset=12, end_lineno=416, end_col_offset=18)], lineno=413, col_offset=8, end_lineno=416, end_col_offset=18), Try(body=[Assign(targets=[Name(id='hits', ctx=Store(), lineno=419, col_offset=12, end_lineno=419, end_col_offset=16)], value=Call(func=Attribute(value=Name(id='provider', ctx=Load(), lineno=419, col_offset=19, end_lineno=419, end_col_offset=27), attr='search', ctx=Load(), lineno=419, col_offset=19, end_lineno=419, end_col_offset=34), args=[Name(id='query', ctx=Load(), lineno=419, col_offset=35, end_lineno=419, end_col_offset=40), Attribute(value=Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=419, col_offset=42, end_lineno=419, end_col_offset=46), attr='_settings', ctx=Load(), lineno=419, col_offset=42, end_lineno=419, end_col_offset=56), attr='index', ctx=Load(), lineno=419, col_offset=42, end_lineno=419, end_col_offset=62), attr='hybrid_top_k_per_channel', ctx=Load(), lineno=419, col_offset=42, end_lineno=419, end_col_offset=87)], lineno=419, col_offset=19, end_lineno=419, end_col_offset=88), lineno=419, col_offset=12, end_lineno=419, end_col_offset=88)], handlers=[ExceptHandler(type=Tuple(elts=[Name(id='RuntimeError', ctx=Load(), lineno=421, col_offset=12, end_lineno=421, end_col_offset=24), Name(id='ValueError', ctx=Load(), lineno=422, col_offset=12, end_lineno=422, end_col_offset=22)], ctx=Load(), lineno=420, col_offset=15, end_lineno=423, end_col_offset=9), name='exc', body=[Assign(targets=[Name(id='msg', ctx=Store(), lineno=424, col_offset=12, end_lineno=424, end_col_offset=15)], value=JoinedStr(values=[Constant(value='SPLADE channel unavailable: ', lineno=424, col_offset=20, end_lineno=424, end_col_offset=48), FormattedValue(value=Name(id='exc', ctx=Load(), lineno=424, col_offset=49, end_lineno=424, end_col_offset=52), conversion=-1, lineno=424, col_offset=48, end_lineno=424, end_col_offset=53)], lineno=424, col_offset=18, end_lineno=424, end_col_offset=54), lineno=424, col_offset=12, end_lineno=424, end_col_offset=54), Expr(value=Call(func=Attribute(value=Name(id='warnings', ctx=Load(), lineno=425, col_offset=12, end_lineno=425, end_col_offset=20), attr='append', ctx=Load(), lineno=425, col_offset=12, end_lineno=425, end_col_offset=27), args=[Name(id='msg', ctx=Load(), lineno=425, col_offset=28, end_lineno=425, end_col_offset=31)], lineno=425, col_offset=12, end_lineno=425, end_col_offset=32), lineno=425, col_offset=12, end_lineno=425, end_col_offset=32), Expr(value=Call(func=Attribute(value=Name(id='LOGGER', ctx=Load(), lineno=426, col_offset=12, end_lineno=426, end_col_offset=18), attr='warning', ctx=Load(), lineno=426, col_offset=12, end_lineno=426, end_col_offset=26), args=[Name(id='msg', ctx=Load(), lineno=426, col_offset=27, end_lineno=426, end_col_offset=30)], keywords=[keyword(arg='exc_info', value=Name(id='exc', ctx=Load(), lineno=426, col_offset=41, end_lineno=426, end_col_offset=44), lineno=426, col_offset=32, end_lineno=426, end_col_offset=44)], lineno=426, col_offset=12, end_lineno=426, end_col_offset=45), lineno=426, col_offset=12, end_lineno=426, end_col_offset=45), Return(lineno=427, col_offset=12, end_lineno=427, end_col_offset=18)], lineno=420, col_offset=8, end_lineno=427, end_col_offset=18)], lineno=418, col_offset=8, end_lineno=427, end_col_offset=18), If(test=Name(id='hits', ctx=Load(), lineno=429, col_offset=11, end_lineno=429, end_col_offset=15), body=[Assign(targets=[Subscript(value=Name(id='runs', ctx=Load(), lineno=430, col_offset=12, end_lineno=430, end_col_offset=16), slice=Constant(value='splade', lineno=430, col_offset=17, end_lineno=430, end_col_offset=25), ctx=Store(), lineno=430, col_offset=12, end_lineno=430, end_col_offset=26)], value=Name(id='hits', ctx=Load(), lineno=430, col_offset=29, end_lineno=430, end_col_offset=33), lineno=430, col_offset=12, end_lineno=430, end_col_offset=33)], lineno=429, col_offset=8, end_lineno=430, end_col_offset=33)], returns=Constant(value=None, lineno=410, col_offset=9, end_lineno=410, end_col_offset=13), lineno=405, col_offset=4, end_lineno=430, end_col_offset=33), FunctionDef(name='_ensure_bm25_provider', args=arguments(args=[arg(arg='self', lineno=432, col_offset=30, end_lineno=432, end_col_offset=34)]), body=[If(test=Compare(left=Attribute(value=Name(id='self', ctx=Load(), lineno=433, col_offset=11, end_lineno=433, end_col_offset=15), attr='_bm25_provider', ctx=Load(), lineno=433, col_offset=11, end_lineno=433, end_col_offset=30), ops=[IsNot()], comparators=[Constant(value=None, lineno=433, col_offset=38, end_lineno=433, end_col_offset=42)], lineno=433, col_offset=11, end_lineno=433, end_col_offset=42), body=[Return(value=Attribute(value=Name(id='self', ctx=Load(), lineno=434, col_offset=19, end_lineno=434, end_col_offset=23), attr='_bm25_provider', ctx=Load(), lineno=434, col_offset=19, end_lineno=434, end_col_offset=38), lineno=434, col_offset=12, end_lineno=434, end_col_offset=38)], lineno=433, col_offset=8, end_lineno=434, end_col_offset=38), If(test=Compare(left=Attribute(value=Name(id='self', ctx=Load(), lineno=435, col_offset=11, end_lineno=435, end_col_offset=15), attr='_bm25_error', ctx=Load(), lineno=435, col_offset=11, end_lineno=435, end_col_offset=27), ops=[IsNot()], comparators=[Constant(value=None, lineno=435, col_offset=35, end_lineno=435, end_col_offset=39)], lineno=435, col_offset=11, end_lineno=435, end_col_offset=39), body=[Return(value=Constant(value=None, lineno=436, col_offset=19, end_lineno=436, end_col_offset=23), lineno=436, col_offset=12, end_lineno=436, end_col_offset=23)], lineno=435, col_offset=8, end_lineno=436, end_col_offset=23), With(items=[withitem(context_expr=Attribute(value=Name(id='self', ctx=Load(), lineno=437, col_offset=13, end_lineno=437, end_col_offset=17), attr='_bm25_lock', ctx=Load(), lineno=437, col_offset=13, end_lineno=437, end_col_offset=28))], body=[If(test=Compare(left=Attribute(value=Name(id='self', ctx=Load(), lineno=438, col_offset=15, end_lineno=438, end_col_offset=19), attr='_bm25_provider', ctx=Load(), lineno=438, col_offset=15, end_lineno=438, end_col_offset=34), ops=[IsNot()], comparators=[Constant(value=None, lineno=438, col_offset=42, end_lineno=438, end_col_offset=46)], lineno=438, col_offset=15, end_lineno=438, end_col_offset=46), body=[Return(value=Attribute(value=Name(id='self', ctx=Load(), lineno=439, col_offset=23, end_lineno=439, end_col_offset=27), attr='_bm25_provider', ctx=Load(), lineno=439, col_offset=23, end_lineno=439, end_col_offset=42), lineno=439, col_offset=16, end_lineno=439, end_col_offset=42)], lineno=438, col_offset=12, end_lineno=439, end_col_offset=42), Try(body=[Assign(targets=[Name(id='provider', ctx=Store(), lineno=441, col_offset=16, end_lineno=441, end_col_offset=24)], value=Call(func=Attribute(value=Name(id='self', ctx=Load(), lineno=441, col_offset=27, end_lineno=441, end_col_offset=31), attr='_create_bm25_provider', ctx=Load(), lineno=441, col_offset=27, end_lineno=441, end_col_offset=53), lineno=441, col_offset=27, end_lineno=441, end_col_offset=55), lineno=441, col_offset=16, end_lineno=441, end_col_offset=55)], handlers=[ExceptHandler(type=Tuple(elts=[Name(id='RuntimeError', ctx=Load(), lineno=442, col_offset=20, end_lineno=442, end_col_offset=32), Name(id='OSError', ctx=Load(), lineno=442, col_offset=34, end_lineno=442, end_col_offset=41), Name(id='ValueError', ctx=Load(), lineno=442, col_offset=43, end_lineno=442, end_col_offset=53), Name(id='ImportError', ctx=Load(), lineno=442, col_offset=55, end_lineno=442, end_col_offset=66)], ctx=Load(), lineno=442, col_offset=19, end_lineno=442, end_col_offset=67), name='exc', body=[Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=443, col_offset=16, end_lineno=443, end_col_offset=20), attr='_bm25_error', ctx=Store(), lineno=443, col_offset=16, end_lineno=443, end_col_offset=32)], value=JoinedStr(values=[Constant(value='BM25 initialization failed: ', lineno=443, col_offset=37, end_lineno=443, end_col_offset=65), FormattedValue(value=Name(id='exc', ctx=Load(), lineno=443, col_offset=66, end_lineno=443, end_col_offset=69), conversion=-1, lineno=443, col_offset=65, end_lineno=443, end_col_offset=70)], lineno=443, col_offset=35, end_lineno=443, end_col_offset=71), lineno=443, col_offset=16, end_lineno=443, end_col_offset=71), Expr(value=Call(func=Attribute(value=Name(id='LOGGER', ctx=Load(), lineno=444, col_offset=16, end_lineno=444, end_col_offset=22), attr='warning', ctx=Load(), lineno=444, col_offset=16, end_lineno=444, end_col_offset=30), args=[Constant(value='Failed to initialize BM25 search provider', lineno=444, col_offset=31, end_lineno=444, end_col_offset=74)], keywords=[keyword(arg='exc_info', value=Name(id='exc', ctx=Load(), lineno=444, col_offset=85, end_lineno=444, end_col_offset=88), lineno=444, col_offset=76, end_lineno=444, end_col_offset=88)], lineno=444, col_offset=16, end_lineno=444, end_col_offset=89), lineno=444, col_offset=16, end_lineno=444, end_col_offset=89), Return(value=Constant(value=None, lineno=445, col_offset=23, end_lineno=445, end_col_offset=27), lineno=445, col_offset=16, end_lineno=445, end_col_offset=27)], lineno=442, col_offset=12, end_lineno=445, end_col_offset=27)], lineno=440, col_offset=12, end_lineno=445, end_col_offset=27), Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=446, col_offset=12, end_lineno=446, end_col_offset=16), attr='_bm25_provider', ctx=Store(), lineno=446, col_offset=12, end_lineno=446, end_col_offset=31)], value=Name(id='provider', ctx=Load(), lineno=446, col_offset=34, end_lineno=446, end_col_offset=42), lineno=446, col_offset=12, end_lineno=446, end_col_offset=42), Return(value=Name(id='provider', ctx=Load(), lineno=447, col_offset=19, end_lineno=447, end_col_offset=27), lineno=447, col_offset=12, end_lineno=447, end_col_offset=27)], lineno=437, col_offset=8, end_lineno=447, end_col_offset=27)], returns=BinOp(left=Name(id='BM25SearchProvider', ctx=Load(), lineno=432, col_offset=39, end_lineno=432, end_col_offset=57), op=BitOr(), right=Constant(value=None, lineno=432, col_offset=60, end_lineno=432, end_col_offset=64), lineno=432, col_offset=39, end_lineno=432, end_col_offset=64), lineno=432, col_offset=4, end_lineno=447, end_col_offset=27), FunctionDef(name='_ensure_splade_provider', args=arguments(args=[arg(arg='self', lineno=449, col_offset=32, end_lineno=449, end_col_offset=36)]), body=[If(test=Compare(left=Attribute(value=Name(id='self', ctx=Load(), lineno=450, col_offset=11, end_lineno=450, end_col_offset=15), attr='_splade_provider', ctx=Load(), lineno=450, col_offset=11, end_lineno=450, end_col_offset=32), ops=[IsNot()], comparators=[Constant(value=None, lineno=450, col_offset=40, end_lineno=450, end_col_offset=44)], lineno=450, col_offset=11, end_lineno=450, end_col_offset=44), body=[Return(value=Attribute(value=Name(id='self', ctx=Load(), lineno=451, col_offset=19, end_lineno=451, end_col_offset=23), attr='_splade_provider', ctx=Load(), lineno=451, col_offset=19, end_lineno=451, end_col_offset=40), lineno=451, col_offset=12, end_lineno=451, end_col_offset=40)], lineno=450, col_offset=8, end_lineno=451, end_col_offset=40), If(test=Compare(left=Attribute(value=Name(id='self', ctx=Load(), lineno=452, col_offset=11, end_lineno=452, end_col_offset=15), attr='_splade_error', ctx=Load(), lineno=452, col_offset=11, end_lineno=452, end_col_offset=29), ops=[IsNot()], comparators=[Constant(value=None, lineno=452, col_offset=37, end_lineno=452, end_col_offset=41)], lineno=452, col_offset=11, end_lineno=452, end_col_offset=41), body=[Return(value=Constant(value=None, lineno=453, col_offset=19, end_lineno=453, end_col_offset=23), lineno=453, col_offset=12, end_lineno=453, end_col_offset=23)], lineno=452, col_offset=8, end_lineno=453, end_col_offset=23), With(items=[withitem(context_expr=Attribute(value=Name(id='self', ctx=Load(), lineno=454, col_offset=13, end_lineno=454, end_col_offset=17), attr='_splade_lock', ctx=Load(), lineno=454, col_offset=13, end_lineno=454, end_col_offset=30))], body=[If(test=Compare(left=Attribute(value=Name(id='self', ctx=Load(), lineno=455, col_offset=15, end_lineno=455, end_col_offset=19), attr='_splade_provider', ctx=Load(), lineno=455, col_offset=15, end_lineno=455, end_col_offset=36), ops=[IsNot()], comparators=[Constant(value=None, lineno=455, col_offset=44, end_lineno=455, end_col_offset=48)], lineno=455, col_offset=15, end_lineno=455, end_col_offset=48), body=[Return(value=Attribute(value=Name(id='self', ctx=Load(), lineno=456, col_offset=23, end_lineno=456, end_col_offset=27), attr='_splade_provider', ctx=Load(), lineno=456, col_offset=23, end_lineno=456, end_col_offset=44), lineno=456, col_offset=16, end_lineno=456, end_col_offset=44)], lineno=455, col_offset=12, end_lineno=456, end_col_offset=44), Try(body=[Assign(targets=[Name(id='provider', ctx=Store(), lineno=458, col_offset=16, end_lineno=458, end_col_offset=24)], value=Call(func=Attribute(value=Name(id='self', ctx=Load(), lineno=458, col_offset=27, end_lineno=458, end_col_offset=31), attr='_create_splade_provider', ctx=Load(), lineno=458, col_offset=27, end_lineno=458, end_col_offset=55), lineno=458, col_offset=27, end_lineno=458, end_col_offset=57), lineno=458, col_offset=16, end_lineno=458, end_col_offset=57)], handlers=[ExceptHandler(type=Tuple(elts=[Name(id='RuntimeError', ctx=Load(), lineno=459, col_offset=20, end_lineno=459, end_col_offset=32), Name(id='OSError', ctx=Load(), lineno=459, col_offset=34, end_lineno=459, end_col_offset=41), Name(id='ValueError', ctx=Load(), lineno=459, col_offset=43, end_lineno=459, end_col_offset=53), Name(id='ImportError', ctx=Load(), lineno=459, col_offset=55, end_lineno=459, end_col_offset=66)], ctx=Load(), lineno=459, col_offset=19, end_lineno=459, end_col_offset=67), name='exc', body=[Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=460, col_offset=16, end_lineno=460, end_col_offset=20), attr='_splade_error', ctx=Store(), lineno=460, col_offset=16, end_lineno=460, end_col_offset=34)], value=JoinedStr(values=[Constant(value='SPLADE initialization failed: ', lineno=460, col_offset=39, end_lineno=460, end_col_offset=69), FormattedValue(value=Name(id='exc', ctx=Load(), lineno=460, col_offset=70, end_lineno=460, end_col_offset=73), conversion=-1, lineno=460, col_offset=69, end_lineno=460, end_col_offset=74)], lineno=460, col_offset=37, end_lineno=460, end_col_offset=75), lineno=460, col_offset=16, end_lineno=460, end_col_offset=75), Expr(value=Call(func=Attribute(value=Name(id='LOGGER', ctx=Load(), lineno=461, col_offset=16, end_lineno=461, end_col_offset=22), attr='warning', ctx=Load(), lineno=461, col_offset=16, end_lineno=461, end_col_offset=30), args=[Constant(value='Failed to initialize SPLADE search provider', lineno=461, col_offset=31, end_lineno=461, end_col_offset=76)], keywords=[keyword(arg='exc_info', value=Name(id='exc', ctx=Load(), lineno=461, col_offset=87, end_lineno=461, end_col_offset=90), lineno=461, col_offset=78, end_lineno=461, end_col_offset=90)], lineno=461, col_offset=16, end_lineno=461, end_col_offset=91), lineno=461, col_offset=16, end_lineno=461, end_col_offset=91), Return(value=Constant(value=None, lineno=462, col_offset=23, end_lineno=462, end_col_offset=27), lineno=462, col_offset=16, end_lineno=462, end_col_offset=27)], lineno=459, col_offset=12, end_lineno=462, end_col_offset=27)], lineno=457, col_offset=12, end_lineno=462, end_col_offset=27), Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=463, col_offset=12, end_lineno=463, end_col_offset=16), attr='_splade_provider', ctx=Store(), lineno=463, col_offset=12, end_lineno=463, end_col_offset=33)], value=Name(id='provider', ctx=Load(), lineno=463, col_offset=36, end_lineno=463, end_col_offset=44), lineno=463, col_offset=12, end_lineno=463, end_col_offset=44), Return(value=Name(id='provider', ctx=Load(), lineno=464, col_offset=19, end_lineno=464, end_col_offset=27), lineno=464, col_offset=12, end_lineno=464, end_col_offset=27)], lineno=454, col_offset=8, end_lineno=464, end_col_offset=27)], returns=BinOp(left=Name(id='SpladeSearchProvider', ctx=Load(), lineno=449, col_offset=41, end_lineno=449, end_col_offset=61), op=BitOr(), right=Constant(value=None, lineno=449, col_offset=64, end_lineno=449, end_col_offset=68), lineno=449, col_offset=41, end_lineno=449, end_col_offset=68), lineno=449, col_offset=4, end_lineno=464, end_col_offset=27), FunctionDef(name='_create_bm25_provider', args=arguments(args=[arg(arg='self', lineno=466, col_offset=30, end_lineno=466, end_col_offset=34)]), body=[Assign(targets=[Name(id='index_dir', ctx=Store(), lineno=467, col_offset=8, end_lineno=467, end_col_offset=17)], value=Call(func=Attribute(value=Name(id='self', ctx=Load(), lineno=467, col_offset=20, end_lineno=467, end_col_offset=24), attr='resolve_path', ctx=Load(), lineno=467, col_offset=20, end_lineno=467, end_col_offset=37), args=[Attribute(value=Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=467, col_offset=38, end_lineno=467, end_col_offset=42), attr='_settings', ctx=Load(), lineno=467, col_offset=38, end_lineno=467, end_col_offset=52), attr='bm25', ctx=Load(), lineno=467, col_offset=38, end_lineno=467, end_col_offset=57), attr='index_dir', ctx=Load(), lineno=467, col_offset=38, end_lineno=467, end_col_offset=67)], lineno=467, col_offset=20, end_lineno=467, end_col_offset=68), lineno=467, col_offset=8, end_lineno=467, end_col_offset=68), Return(value=Call(func=Name(id='BM25SearchProvider', ctx=Load(), lineno=468, col_offset=15, end_lineno=468, end_col_offset=33), keywords=[keyword(arg='index_dir', value=Name(id='index_dir', ctx=Load(), lineno=469, col_offset=22, end_lineno=469, end_col_offset=31), lineno=469, col_offset=12, end_lineno=469, end_col_offset=31), keyword(arg='k1', value=Attribute(value=Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=470, col_offset=15, end_lineno=470, end_col_offset=19), attr='_settings', ctx=Load(), lineno=470, col_offset=15, end_lineno=470, end_col_offset=29), attr='index', ctx=Load(), lineno=470, col_offset=15, end_lineno=470, end_col_offset=35), attr='bm25_k1', ctx=Load(), lineno=470, col_offset=15, end_lineno=470, end_col_offset=43), lineno=470, col_offset=12, end_lineno=470, end_col_offset=43), keyword(arg='b', value=Attribute(value=Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=471, col_offset=14, end_lineno=471, end_col_offset=18), attr='_settings', ctx=Load(), lineno=471, col_offset=14, end_lineno=471, end_col_offset=28), attr='index', ctx=Load(), lineno=471, col_offset=14, end_lineno=471, end_col_offset=34), attr='bm25_b', ctx=Load(), lineno=471, col_offset=14, end_lineno=471, end_col_offset=41), lineno=471, col_offset=12, end_lineno=471, end_col_offset=41)], lineno=468, col_offset=15, end_lineno=472, end_col_offset=9), lineno=468, col_offset=8, end_lineno=472, end_col_offset=9)], returns=Name(id='BM25SearchProvider', ctx=Load(), lineno=466, col_offset=39, end_lineno=466, end_col_offset=57), lineno=466, col_offset=4, end_lineno=472, end_col_offset=9), FunctionDef(name='_create_splade_provider', args=arguments(args=[arg(arg='self', lineno=474, col_offset=32, end_lineno=474, end_col_offset=36)]), body=[Assign(targets=[Name(id='splade', ctx=Store(), lineno=475, col_offset=8, end_lineno=475, end_col_offset=14)], value=Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=475, col_offset=17, end_lineno=475, end_col_offset=21), attr='_settings', ctx=Load(), lineno=475, col_offset=17, end_lineno=475, end_col_offset=31), attr='splade', ctx=Load(), lineno=475, col_offset=17, end_lineno=475, end_col_offset=38), lineno=475, col_offset=8, end_lineno=475, end_col_offset=38), Return(value=Call(func=Name(id='SpladeSearchProvider', ctx=Load(), lineno=476, col_offset=15, end_lineno=476, end_col_offset=35), args=[Name(id='splade', ctx=Load(), lineno=477, col_offset=12, end_lineno=477, end_col_offset=18)], keywords=[keyword(arg='model_dir', value=Call(func=Attribute(value=Name(id='self', ctx=Load(), lineno=478, col_offset=22, end_lineno=478, end_col_offset=26), attr='resolve_path', ctx=Load(), lineno=478, col_offset=22, end_lineno=478, end_col_offset=39), args=[Attribute(value=Name(id='splade', ctx=Load(), lineno=478, col_offset=40, end_lineno=478, end_col_offset=46), attr='model_dir', ctx=Load(), lineno=478, col_offset=40, end_lineno=478, end_col_offset=56)], lineno=478, col_offset=22, end_lineno=478, end_col_offset=57), lineno=478, col_offset=12, end_lineno=478, end_col_offset=57), keyword(arg='onnx_dir', value=Call(func=Attribute(value=Name(id='self', ctx=Load(), lineno=479, col_offset=21, end_lineno=479, end_col_offset=25), attr='resolve_path', ctx=Load(), lineno=479, col_offset=21, end_lineno=479, end_col_offset=38), args=[Attribute(value=Name(id='splade', ctx=Load(), lineno=479, col_offset=39, end_lineno=479, end_col_offset=45), attr='onnx_dir', ctx=Load(), lineno=479, col_offset=39, end_lineno=479, end_col_offset=54)], lineno=479, col_offset=21, end_lineno=479, end_col_offset=55), lineno=479, col_offset=12, end_lineno=479, end_col_offset=55), keyword(arg='index_dir', value=Call(func=Attribute(value=Name(id='self', ctx=Load(), lineno=480, col_offset=22, end_lineno=480, end_col_offset=26), attr='resolve_path', ctx=Load(), lineno=480, col_offset=22, end_lineno=480, end_col_offset=39), args=[Attribute(value=Name(id='splade', ctx=Load(), lineno=480, col_offset=40, end_lineno=480, end_col_offset=46), attr='index_dir', ctx=Load(), lineno=480, col_offset=40, end_lineno=480, end_col_offset=56)], lineno=480, col_offset=22, end_lineno=480, end_col_offset=57), lineno=480, col_offset=12, end_lineno=480, end_col_offset=57)], lineno=476, col_offset=15, end_lineno=481, end_col_offset=9), lineno=476, col_offset=8, end_lineno=481, end_col_offset=9)], returns=Name(id='SpladeSearchProvider', ctx=Load(), lineno=474, col_offset=41, end_lineno=474, end_col_offset=61), lineno=474, col_offset=4, end_lineno=481, end_col_offset=9), FunctionDef(name='resolve_path', args=arguments(args=[arg(arg='self', lineno=483, col_offset=21, end_lineno=483, end_col_offset=25), arg(arg='value', annotation=Name(id='str', ctx=Load(), lineno=483, col_offset=34, end_lineno=483, end_col_offset=37), lineno=483, col_offset=27, end_lineno=483, end_col_offset=37)]), body=[Expr(value=Constant(value='Resolve a path string to an absolute Path.\n\n        Parameters\n        ----------\n        value : str\n            Path string that may be absolute, relative, or use ~ expansion.\n\n        Returns\n        -------\n        Path\n            Absolute resolved path. If input is absolute, returns as-is.\n            If relative, resolves relative to repository root.\n        ', lineno=484, col_offset=8, end_lineno=496, end_col_offset=11), lineno=484, col_offset=8, end_lineno=496, end_col_offset=11), Assign(targets=[Name(id='candidate', ctx=Store(), lineno=497, col_offset=8, end_lineno=497, end_col_offset=17)], value=Call(func=Attribute(value=Call(func=Name(id='Path', ctx=Load(), lineno=497, col_offset=20, end_lineno=497, end_col_offset=24), args=[Name(id='value', ctx=Load(), lineno=497, col_offset=25, end_lineno=497, end_col_offset=30)], lineno=497, col_offset=20, end_lineno=497, end_col_offset=31), attr='expanduser', ctx=Load(), lineno=497, col_offset=20, end_lineno=497, end_col_offset=42), lineno=497, col_offset=20, end_lineno=497, end_col_offset=44), lineno=497, col_offset=8, end_lineno=497, end_col_offset=44), If(test=Call(func=Attribute(value=Name(id='candidate', ctx=Load(), lineno=498, col_offset=11, end_lineno=498, end_col_offset=20), attr='is_absolute', ctx=Load(), lineno=498, col_offset=11, end_lineno=498, end_col_offset=32), lineno=498, col_offset=11, end_lineno=498, end_col_offset=34), body=[Return(value=Name(id='candidate', ctx=Load(), lineno=499, col_offset=19, end_lineno=499, end_col_offset=28), lineno=499, col_offset=12, end_lineno=499, end_col_offset=28)], lineno=498, col_offset=8, end_lineno=499, end_col_offset=28), Return(value=Call(func=Attribute(value=BinOp(left=Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=500, col_offset=16, end_lineno=500, end_col_offset=20), attr='_paths', ctx=Load(), lineno=500, col_offset=16, end_lineno=500, end_col_offset=27), attr='repo_root', ctx=Load(), lineno=500, col_offset=16, end_lineno=500, end_col_offset=37), op=Div(), right=Name(id='candidate', ctx=Load(), lineno=500, col_offset=40, end_lineno=500, end_col_offset=49), lineno=500, col_offset=16, end_lineno=500, end_col_offset=49), attr='resolve', ctx=Load(), lineno=500, col_offset=15, end_lineno=500, end_col_offset=58), lineno=500, col_offset=15, end_lineno=500, end_col_offset=60), lineno=500, col_offset=8, end_lineno=500, end_col_offset=60)], returns=Name(id='Path', ctx=Load(), lineno=483, col_offset=42, end_lineno=483, end_col_offset=46), lineno=483, col_offset=4, end_lineno=500, end_col_offset=60), FunctionDef(name='_build_semantic_channel_hits', args=arguments(args=[arg(arg='self', lineno=502, col_offset=37, end_lineno=502, end_col_offset=41), arg(arg='hits', annotation=Subscript(value=Name(id='Sequence', ctx=Load(), lineno=502, col_offset=49, end_lineno=502, end_col_offset=57), slice=Subscript(value=Name(id='tuple', ctx=Load(), lineno=502, col_offset=58, end_lineno=502, end_col_offset=63), slice=Tuple(elts=[Name(id='int', ctx=Load(), lineno=502, col_offset=64, end_lineno=502, end_col_offset=67), Name(id='float', ctx=Load(), lineno=502, col_offset=69, end_lineno=502, end_col_offset=74)], ctx=Load(), lineno=502, col_offset=64, end_lineno=502, end_col_offset=74), ctx=Load(), lineno=502, col_offset=58, end_lineno=502, end_col_offset=75), ctx=Load(), lineno=502, col_offset=49, end_lineno=502, end_col_offset=76), lineno=502, col_offset=43, end_lineno=502, end_col_offset=76)]), body=[Assign(targets=[Name(id='top_k', ctx=Store(), lineno=503, col_offset=8, end_lineno=503, end_col_offset=13)], value=BoolOp(op=Or(), values=[Call(func=Name(id='min', ctx=Load(), lineno=503, col_offset=16, end_lineno=503, end_col_offset=19), args=[Call(func=Name(id='len', ctx=Load(), lineno=503, col_offset=20, end_lineno=503, end_col_offset=23), args=[Name(id='hits', ctx=Load(), lineno=503, col_offset=24, end_lineno=503, end_col_offset=28)], lineno=503, col_offset=20, end_lineno=503, end_col_offset=29), Attribute(value=Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=503, col_offset=31, end_lineno=503, end_col_offset=35), attr='_settings', ctx=Load(), lineno=503, col_offset=31, end_lineno=503, end_col_offset=45), attr='index', ctx=Load(), lineno=503, col_offset=31, end_lineno=503, end_col_offset=51), attr='hybrid_top_k_per_channel', ctx=Load(), lineno=503, col_offset=31, end_lineno=503, end_col_offset=76)], lineno=503, col_offset=16, end_lineno=503, end_col_offset=77), Call(func=Name(id='len', ctx=Load(), lineno=503, col_offset=81, end_lineno=503, end_col_offset=84), args=[Name(id='hits', ctx=Load(), lineno=503, col_offset=85, end_lineno=503, end_col_offset=89)], lineno=503, col_offset=81, end_lineno=503, end_col_offset=90)], lineno=503, col_offset=16, end_lineno=503, end_col_offset=90), lineno=503, col_offset=8, end_lineno=503, end_col_offset=90), Return(value=ListComp(elt=Call(func=Name(id='ChannelHit', ctx=Load(), lineno=505, col_offset=12, end_lineno=505, end_col_offset=22), keywords=[keyword(arg='doc_id', value=Call(func=Name(id='str', ctx=Load(), lineno=505, col_offset=30, end_lineno=505, end_col_offset=33), args=[Name(id='chunk_id', ctx=Load(), lineno=505, col_offset=34, end_lineno=505, end_col_offset=42)], lineno=505, col_offset=30, end_lineno=505, end_col_offset=43), lineno=505, col_offset=23, end_lineno=505, end_col_offset=43), keyword(arg='score', value=Call(func=Name(id='float', ctx=Load(), lineno=505, col_offset=51, end_lineno=505, end_col_offset=56), args=[Name(id='score', ctx=Load(), lineno=505, col_offset=57, end_lineno=505, end_col_offset=62)], lineno=505, col_offset=51, end_lineno=505, end_col_offset=63), lineno=505, col_offset=45, end_lineno=505, end_col_offset=63)], lineno=505, col_offset=12, end_lineno=505, end_col_offset=64), generators=[comprehension(target=Tuple(elts=[Name(id='chunk_id', ctx=Store(), lineno=505, col_offset=69, end_lineno=505, end_col_offset=77), Name(id='score', ctx=Store(), lineno=505, col_offset=79, end_lineno=505, end_col_offset=84)], ctx=Store(), lineno=505, col_offset=69, end_lineno=505, end_col_offset=84), iter=Subscript(value=Name(id='hits', ctx=Load(), lineno=505, col_offset=88, end_lineno=505, end_col_offset=92), slice=Slice(upper=Name(id='top_k', ctx=Load(), lineno=505, col_offset=94, end_lineno=505, end_col_offset=99), lineno=505, col_offset=93, end_lineno=505, end_col_offset=99), ctx=Load(), lineno=505, col_offset=88, end_lineno=505, end_col_offset=100), is_async=0)], lineno=504, col_offset=15, end_lineno=506, end_col_offset=9), lineno=504, col_offset=8, end_lineno=506, end_col_offset=9)], returns=Subscript(value=Name(id='list', ctx=Load(), lineno=502, col_offset=81, end_lineno=502, end_col_offset=85), slice=Name(id='ChannelHit', ctx=Load(), lineno=502, col_offset=86, end_lineno=502, end_col_offset=96), ctx=Load(), lineno=502, col_offset=81, end_lineno=502, end_col_offset=97), lineno=502, col_offset=4, end_lineno=506, end_col_offset=9)], lineno=227, col_offset=0, end_lineno=506, end_col_offset=9), FunctionDef(name='_rrf_fuse', args=arguments(args=[arg(arg='runs', annotation=Subscript(value=Name(id='Mapping', ctx=Load(), lineno=510, col_offset=10, end_lineno=510, end_col_offset=17), slice=Tuple(elts=[Name(id='str', ctx=Load(), lineno=510, col_offset=18, end_lineno=510, end_col_offset=21), Subscript(value=Name(id='Sequence', ctx=Load(), lineno=510, col_offset=23, end_lineno=510, end_col_offset=31), slice=Name(id='ChannelHit', ctx=Load(), lineno=510, col_offset=32, end_lineno=510, end_col_offset=42), ctx=Load(), lineno=510, col_offset=23, end_lineno=510, end_col_offset=43)], ctx=Load(), lineno=510, col_offset=18, end_lineno=510, end_col_offset=43), ctx=Load(), lineno=510, col_offset=10, end_lineno=510, end_col_offset=44), lineno=510, col_offset=4, end_lineno=510, end_col_offset=44)], kwonlyargs=[arg(arg='k', annotation=Name(id='int', ctx=Load(), lineno=512, col_offset=7, end_lineno=512, end_col_offset=10), lineno=512, col_offset=4, end_lineno=512, end_col_offset=10), arg(arg='limit', annotation=Name(id='int', ctx=Load(), lineno=513, col_offset=11, end_lineno=513, end_col_offset=14), lineno=513, col_offset=4, end_lineno=513, end_col_offset=14)], kw_defaults=[None, None]), body=[AnnAssign(target=Name(id='fused_scores', ctx=Store(), lineno=515, col_offset=4, end_lineno=515, end_col_offset=16), annotation=Subscript(value=Name(id='dict', ctx=Load(), lineno=515, col_offset=18, end_lineno=515, end_col_offset=22), slice=Tuple(elts=[Name(id='str', ctx=Load(), lineno=515, col_offset=23, end_lineno=515, end_col_offset=26), Name(id='float', ctx=Load(), lineno=515, col_offset=28, end_lineno=515, end_col_offset=33)], ctx=Load(), lineno=515, col_offset=23, end_lineno=515, end_col_offset=33), ctx=Load(), lineno=515, col_offset=18, end_lineno=515, end_col_offset=34), value=Dict(lineno=515, col_offset=37, end_lineno=515, end_col_offset=39), simple=1, lineno=515, col_offset=4, end_lineno=515, end_col_offset=39), AnnAssign(target=Name(id='contributions', ctx=Store(), lineno=516, col_offset=4, end_lineno=516, end_col_offset=17), annotation=Subscript(value=Name(id='dict', ctx=Load(), lineno=516, col_offset=19, end_lineno=516, end_col_offset=23), slice=Tuple(elts=[Name(id='str', ctx=Load(), lineno=516, col_offset=24, end_lineno=516, end_col_offset=27), Subscript(value=Name(id='list', ctx=Load(), lineno=516, col_offset=29, end_lineno=516, end_col_offset=33), slice=Subscript(value=Name(id='tuple', ctx=Load(), lineno=516, col_offset=34, end_lineno=516, end_col_offset=39), slice=Tuple(elts=[Name(id='str', ctx=Load(), lineno=516, col_offset=40, end_lineno=516, end_col_offset=43), Name(id='int', ctx=Load(), lineno=516, col_offset=45, end_lineno=516, end_col_offset=48), Name(id='float', ctx=Load(), lineno=516, col_offset=50, end_lineno=516, end_col_offset=55)], ctx=Load(), lineno=516, col_offset=40, end_lineno=516, end_col_offset=55), ctx=Load(), lineno=516, col_offset=34, end_lineno=516, end_col_offset=56), ctx=Load(), lineno=516, col_offset=29, end_lineno=516, end_col_offset=57)], ctx=Load(), lineno=516, col_offset=24, end_lineno=516, end_col_offset=57), ctx=Load(), lineno=516, col_offset=19, end_lineno=516, end_col_offset=58), value=Dict(lineno=516, col_offset=61, end_lineno=516, end_col_offset=63), simple=1, lineno=516, col_offset=4, end_lineno=516, end_col_offset=63), For(target=Tuple(elts=[Name(id='channel', ctx=Store(), lineno=518, col_offset=8, end_lineno=518, end_col_offset=15), Name(id='hits', ctx=Store(), lineno=518, col_offset=17, end_lineno=518, end_col_offset=21)], ctx=Store(), lineno=518, col_offset=8, end_lineno=518, end_col_offset=21), iter=Call(func=Attribute(value=Name(id='runs', ctx=Load(), lineno=518, col_offset=25, end_lineno=518, end_col_offset=29), attr='items', ctx=Load(), lineno=518, col_offset=25, end_lineno=518, end_col_offset=35), lineno=518, col_offset=25, end_lineno=518, end_col_offset=37), body=[For(target=Tuple(elts=[Name(id='rank', ctx=Store(), lineno=519, col_offset=12, end_lineno=519, end_col_offset=16), Name(id='hit', ctx=Store(), lineno=519, col_offset=18, end_lineno=519, end_col_offset=21)], ctx=Store(), lineno=519, col_offset=12, end_lineno=519, end_col_offset=21), iter=Call(func=Name(id='enumerate', ctx=Load(), lineno=519, col_offset=25, end_lineno=519, end_col_offset=34), args=[Name(id='hits', ctx=Load(), lineno=519, col_offset=35, end_lineno=519, end_col_offset=39)], keywords=[keyword(arg='start', value=Constant(value=1, lineno=519, col_offset=47, end_lineno=519, end_col_offset=48), lineno=519, col_offset=41, end_lineno=519, end_col_offset=48)], lineno=519, col_offset=25, end_lineno=519, end_col_offset=49), body=[Assign(targets=[Name(id='contribution', ctx=Store(), lineno=520, col_offset=12, end_lineno=520, end_col_offset=24)], value=BinOp(left=Constant(value=1.0, lineno=520, col_offset=27, end_lineno=520, end_col_offset=30), op=Div(), right=BinOp(left=Name(id='k', ctx=Load(), lineno=520, col_offset=34, end_lineno=520, end_col_offset=35), op=Add(), right=Name(id='rank', ctx=Load(), lineno=520, col_offset=38, end_lineno=520, end_col_offset=42), lineno=520, col_offset=34, end_lineno=520, end_col_offset=42), lineno=520, col_offset=27, end_lineno=520, end_col_offset=43), lineno=520, col_offset=12, end_lineno=520, end_col_offset=43), Assign(targets=[Subscript(value=Name(id='fused_scores', ctx=Load(), lineno=521, col_offset=12, end_lineno=521, end_col_offset=24), slice=Attribute(value=Name(id='hit', ctx=Load(), lineno=521, col_offset=25, end_lineno=521, end_col_offset=28), attr='doc_id', ctx=Load(), lineno=521, col_offset=25, end_lineno=521, end_col_offset=35), ctx=Store(), lineno=521, col_offset=12, end_lineno=521, end_col_offset=36)], value=BinOp(left=Call(func=Attribute(value=Name(id='fused_scores', ctx=Load(), lineno=521, col_offset=39, end_lineno=521, end_col_offset=51), attr='get', ctx=Load(), lineno=521, col_offset=39, end_lineno=521, end_col_offset=55), args=[Attribute(value=Name(id='hit', ctx=Load(), lineno=521, col_offset=56, end_lineno=521, end_col_offset=59), attr='doc_id', ctx=Load(), lineno=521, col_offset=56, end_lineno=521, end_col_offset=66), Constant(value=0.0, lineno=521, col_offset=68, end_lineno=521, end_col_offset=71)], lineno=521, col_offset=39, end_lineno=521, end_col_offset=72), op=Add(), right=Name(id='contribution', ctx=Load(), lineno=521, col_offset=75, end_lineno=521, end_col_offset=87), lineno=521, col_offset=39, end_lineno=521, end_col_offset=87), lineno=521, col_offset=12, end_lineno=521, end_col_offset=87), Expr(value=Call(func=Attribute(value=Call(func=Attribute(value=Name(id='contributions', ctx=Load(), lineno=522, col_offset=12, end_lineno=522, end_col_offset=25), attr='setdefault', ctx=Load(), lineno=522, col_offset=12, end_lineno=522, end_col_offset=36), args=[Attribute(value=Name(id='hit', ctx=Load(), lineno=522, col_offset=37, end_lineno=522, end_col_offset=40), attr='doc_id', ctx=Load(), lineno=522, col_offset=37, end_lineno=522, end_col_offset=47), List(ctx=Load(), lineno=522, col_offset=49, end_lineno=522, end_col_offset=51)], lineno=522, col_offset=12, end_lineno=522, end_col_offset=52), attr='append', ctx=Load(), lineno=522, col_offset=12, end_lineno=522, end_col_offset=59), args=[Tuple(elts=[Name(id='channel', ctx=Load(), lineno=522, col_offset=61, end_lineno=522, end_col_offset=68), Name(id='rank', ctx=Load(), lineno=522, col_offset=70, end_lineno=522, end_col_offset=74), Attribute(value=Name(id='hit', ctx=Load(), lineno=522, col_offset=76, end_lineno=522, end_col_offset=79), attr='score', ctx=Load(), lineno=522, col_offset=76, end_lineno=522, end_col_offset=85)], ctx=Load(), lineno=522, col_offset=60, end_lineno=522, end_col_offset=86)], lineno=522, col_offset=12, end_lineno=522, end_col_offset=87), lineno=522, col_offset=12, end_lineno=522, end_col_offset=87)], lineno=519, col_offset=8, end_lineno=522, end_col_offset=87)], lineno=518, col_offset=4, end_lineno=522, end_col_offset=87), Assign(targets=[Name(id='sorted_docs', ctx=Store(), lineno=524, col_offset=4, end_lineno=524, end_col_offset=15)], value=Call(func=Name(id='sorted', ctx=Load(), lineno=524, col_offset=18, end_lineno=524, end_col_offset=24), args=[Call(func=Attribute(value=Name(id='fused_scores', ctx=Load(), lineno=524, col_offset=25, end_lineno=524, end_col_offset=37), attr='items', ctx=Load(), lineno=524, col_offset=25, end_lineno=524, end_col_offset=43), lineno=524, col_offset=25, end_lineno=524, end_col_offset=45)], keywords=[keyword(arg='key', value=Lambda(args=arguments(args=[arg(arg='item', lineno=524, col_offset=58, end_lineno=524, end_col_offset=62)]), body=Subscript(value=Name(id='item', ctx=Load(), lineno=524, col_offset=64, end_lineno=524, end_col_offset=68), slice=Constant(value=1, lineno=524, col_offset=69, end_lineno=524, end_col_offset=70), ctx=Load(), lineno=524, col_offset=64, end_lineno=524, end_col_offset=71), lineno=524, col_offset=51, end_lineno=524, end_col_offset=71), lineno=524, col_offset=47, end_lineno=524, end_col_offset=71), keyword(arg='reverse', value=Constant(value=True, lineno=524, col_offset=81, end_lineno=524, end_col_offset=85), lineno=524, col_offset=73, end_lineno=524, end_col_offset=85)], lineno=524, col_offset=18, end_lineno=524, end_col_offset=86), lineno=524, col_offset=4, end_lineno=524, end_col_offset=86), Assign(targets=[Name(id='top_docs', ctx=Store(), lineno=525, col_offset=4, end_lineno=525, end_col_offset=12)], value=Subscript(value=Name(id='sorted_docs', ctx=Load(), lineno=525, col_offset=15, end_lineno=525, end_col_offset=26), slice=Slice(upper=Name(id='limit', ctx=Load(), lineno=525, col_offset=28, end_lineno=525, end_col_offset=33), lineno=525, col_offset=27, end_lineno=525, end_col_offset=33), ctx=Load(), lineno=525, col_offset=15, end_lineno=525, end_col_offset=34), lineno=525, col_offset=4, end_lineno=525, end_col_offset=34), Assign(targets=[Name(id='docs', ctx=Store(), lineno=526, col_offset=4, end_lineno=526, end_col_offset=8)], value=ListComp(elt=Call(func=Name(id='HybridResultDoc', ctx=Load(), lineno=526, col_offset=12, end_lineno=526, end_col_offset=27), keywords=[keyword(arg='doc_id', value=Name(id='doc_id', ctx=Load(), lineno=526, col_offset=35, end_lineno=526, end_col_offset=41), lineno=526, col_offset=28, end_lineno=526, end_col_offset=41), keyword(arg='score', value=Name(id='score', ctx=Load(), lineno=526, col_offset=49, end_lineno=526, end_col_offset=54), lineno=526, col_offset=43, end_lineno=526, end_col_offset=54)], lineno=526, col_offset=12, end_lineno=526, end_col_offset=55), generators=[comprehension(target=Tuple(elts=[Name(id='doc_id', ctx=Store(), lineno=526, col_offset=60, end_lineno=526, end_col_offset=66), Name(id='score', ctx=Store(), lineno=526, col_offset=68, end_lineno=526, end_col_offset=73)], ctx=Store(), lineno=526, col_offset=60, end_lineno=526, end_col_offset=73), iter=Name(id='top_docs', ctx=Load(), lineno=526, col_offset=77, end_lineno=526, end_col_offset=85), is_async=0)], lineno=526, col_offset=11, end_lineno=526, end_col_offset=86), lineno=526, col_offset=4, end_lineno=526, end_col_offset=86), Assign(targets=[Name(id='filtered', ctx=Store(), lineno=527, col_offset=4, end_lineno=527, end_col_offset=12)], value=DictComp(key=Name(id='doc_id', ctx=Load(), lineno=527, col_offset=16, end_lineno=527, end_col_offset=22), value=Call(func=Attribute(value=Name(id='contributions', ctx=Load(), lineno=527, col_offset=24, end_lineno=527, end_col_offset=37), attr='get', ctx=Load(), lineno=527, col_offset=24, end_lineno=527, end_col_offset=41), args=[Name(id='doc_id', ctx=Load(), lineno=527, col_offset=42, end_lineno=527, end_col_offset=48), List(ctx=Load(), lineno=527, col_offset=50, end_lineno=527, end_col_offset=52)], lineno=527, col_offset=24, end_lineno=527, end_col_offset=53), generators=[comprehension(target=Tuple(elts=[Name(id='doc_id', ctx=Store(), lineno=527, col_offset=58, end_lineno=527, end_col_offset=64), Name(id='_', ctx=Store(), lineno=527, col_offset=66, end_lineno=527, end_col_offset=67)], ctx=Store(), lineno=527, col_offset=58, end_lineno=527, end_col_offset=67), iter=Name(id='top_docs', ctx=Load(), lineno=527, col_offset=71, end_lineno=527, end_col_offset=79), is_async=0)], lineno=527, col_offset=15, end_lineno=527, end_col_offset=80), lineno=527, col_offset=4, end_lineno=527, end_col_offset=80), Return(value=Tuple(elts=[Name(id='docs', ctx=Load(), lineno=528, col_offset=11, end_lineno=528, end_col_offset=15), Name(id='filtered', ctx=Load(), lineno=528, col_offset=17, end_lineno=528, end_col_offset=25)], ctx=Load(), lineno=528, col_offset=11, end_lineno=528, end_col_offset=25), lineno=528, col_offset=4, end_lineno=528, end_col_offset=25)], returns=Subscript(value=Name(id='tuple', ctx=Load(), lineno=514, col_offset=5, end_lineno=514, end_col_offset=10), slice=Tuple(elts=[Subscript(value=Name(id='list', ctx=Load(), lineno=514, col_offset=11, end_lineno=514, end_col_offset=15), slice=Name(id='HybridResultDoc', ctx=Load(), lineno=514, col_offset=16, end_lineno=514, end_col_offset=31), ctx=Load(), lineno=514, col_offset=11, end_lineno=514, end_col_offset=32), Subscript(value=Name(id='dict', ctx=Load(), lineno=514, col_offset=34, end_lineno=514, end_col_offset=38), slice=Tuple(elts=[Name(id='str', ctx=Load(), lineno=514, col_offset=39, end_lineno=514, end_col_offset=42), Subscript(value=Name(id='list', ctx=Load(), lineno=514, col_offset=44, end_lineno=514, end_col_offset=48), slice=Subscript(value=Name(id='tuple', ctx=Load(), lineno=514, col_offset=49, end_lineno=514, end_col_offset=54), slice=Tuple(elts=[Name(id='str', ctx=Load(), lineno=514, col_offset=55, end_lineno=514, end_col_offset=58), Name(id='int', ctx=Load(), lineno=514, col_offset=60, end_lineno=514, end_col_offset=63), Name(id='float', ctx=Load(), lineno=514, col_offset=65, end_lineno=514, end_col_offset=70)], ctx=Load(), lineno=514, col_offset=55, end_lineno=514, end_col_offset=70), ctx=Load(), lineno=514, col_offset=49, end_lineno=514, end_col_offset=71), ctx=Load(), lineno=514, col_offset=44, end_lineno=514, end_col_offset=72)], ctx=Load(), lineno=514, col_offset=39, end_lineno=514, end_col_offset=72), ctx=Load(), lineno=514, col_offset=34, end_lineno=514, end_col_offset=73)], ctx=Load(), lineno=514, col_offset=11, end_lineno=514, end_col_offset=73), ctx=Load(), lineno=514, col_offset=5, end_lineno=514, end_col_offset=74), lineno=509, col_offset=0, end_lineno=528, end_col_offset=25), Assign(targets=[Name(id='__all__', ctx=Store(), lineno=531, col_offset=0, end_lineno=531, end_col_offset=7)], value=List(elts=[Constant(value='BM25SearchProvider', lineno=532, col_offset=4, end_lineno=532, end_col_offset=24), Constant(value='ChannelHit', lineno=533, col_offset=4, end_lineno=533, end_col_offset=16), Constant(value='HybridResultDoc', lineno=534, col_offset=4, end_lineno=534, end_col_offset=21), Constant(value='HybridSearchEngine', lineno=535, col_offset=4, end_lineno=535, end_col_offset=24), Constant(value='HybridSearchResult', lineno=536, col_offset=4, end_lineno=536, end_col_offset=24), Constant(value='SpladeSearchProvider', lineno=537, col_offset=4, end_lineno=537, end_col_offset=26)], ctx=Load(), lineno=531, col_offset=10, end_lineno=538, end_col_offset=1), lineno=531, col_offset=0, end_lineno=538, end_col_offset=1)])