Module(body=[Expr(value=Constant(value='Reciprocal Rank Fusion utilities (legacy compatibility wrappers).', lineno=1, col_offset=0, end_lineno=1, end_col_offset=71), lineno=1, col_offset=0, end_lineno=1, end_col_offset=71), ImportFrom(module='__future__', names=[alias(name='annotations', lineno=3, col_offset=23, end_lineno=3, end_col_offset=34)], level=0, lineno=3, col_offset=0, end_lineno=3, end_col_offset=34), ImportFrom(module='collections.abc', names=[alias(name='Mapping', lineno=5, col_offset=28, end_lineno=5, end_col_offset=35), alias(name='Sequence', lineno=5, col_offset=37, end_lineno=5, end_col_offset=45)], level=0, lineno=5, col_offset=0, end_lineno=5, end_col_offset=45), ImportFrom(module='typing', names=[alias(name='Literal', lineno=6, col_offset=19, end_lineno=6, end_col_offset=26)], level=0, lineno=6, col_offset=0, end_lineno=6, end_col_offset=26), ImportFrom(module='codeintel_rev.retrieval.fusion', names=[alias(name='fuse_weighted_rrf', lineno=8, col_offset=43, end_lineno=8, end_col_offset=60)], level=0, lineno=8, col_offset=0, end_lineno=8, end_col_offset=60), ImportFrom(module='codeintel_rev.retrieval.types', names=[alias(name='ChannelHit', lineno=9, col_offset=42, end_lineno=9, end_col_offset=52)], level=0, lineno=9, col_offset=0, end_lineno=9, end_col_offset=52), FunctionDef(name='weighted_rrf', args=arguments(args=[arg(arg='channels', annotation=Subscript(value=Name(id='Mapping', ctx=Load(), lineno=13, col_offset=14, end_lineno=13, end_col_offset=21), slice=Tuple(elts=[Name(id='str', ctx=Load(), lineno=13, col_offset=22, end_lineno=13, end_col_offset=25), Subscript(value=Name(id='Sequence', ctx=Load(), lineno=13, col_offset=27, end_lineno=13, end_col_offset=35), slice=Subscript(value=Name(id='tuple', ctx=Load(), lineno=13, col_offset=36, end_lineno=13, end_col_offset=41), slice=Tuple(elts=[Name(id='int', ctx=Load(), lineno=13, col_offset=42, end_lineno=13, end_col_offset=45), Name(id='float', ctx=Load(), lineno=13, col_offset=47, end_lineno=13, end_col_offset=52)], ctx=Load(), lineno=13, col_offset=42, end_lineno=13, end_col_offset=52), ctx=Load(), lineno=13, col_offset=36, end_lineno=13, end_col_offset=53), ctx=Load(), lineno=13, col_offset=27, end_lineno=13, end_col_offset=54)], ctx=Load(), lineno=13, col_offset=22, end_lineno=13, end_col_offset=54), ctx=Load(), lineno=13, col_offset=14, end_lineno=13, end_col_offset=55), lineno=13, col_offset=4, end_lineno=13, end_col_offset=55)], kwonlyargs=[arg(arg='weights', annotation=Subscript(value=Name(id='Mapping', ctx=Load(), lineno=15, col_offset=13, end_lineno=15, end_col_offset=20), slice=Tuple(elts=[Name(id='str', ctx=Load(), lineno=15, col_offset=21, end_lineno=15, end_col_offset=24), Name(id='float', ctx=Load(), lineno=15, col_offset=26, end_lineno=15, end_col_offset=31)], ctx=Load(), lineno=15, col_offset=21, end_lineno=15, end_col_offset=31), ctx=Load(), lineno=15, col_offset=13, end_lineno=15, end_col_offset=32), lineno=15, col_offset=4, end_lineno=15, end_col_offset=32), arg(arg='k', annotation=Name(id='int', ctx=Load(), lineno=16, col_offset=7, end_lineno=16, end_col_offset=10), lineno=16, col_offset=4, end_lineno=16, end_col_offset=10), arg(arg='top_k', annotation=Name(id='int', ctx=Load(), lineno=17, col_offset=11, end_lineno=17, end_col_offset=14), lineno=17, col_offset=4, end_lineno=17, end_col_offset=14), arg(arg='normalize', annotation=Subscript(value=Name(id='Literal', ctx=Load(), lineno=18, col_offset=15, end_lineno=18, end_col_offset=22), slice=Tuple(elts=[Constant(value='none', lineno=18, col_offset=23, end_lineno=18, end_col_offset=29), Constant(value='minmax', lineno=18, col_offset=31, end_lineno=18, end_col_offset=39), Constant(value='z', lineno=18, col_offset=41, end_lineno=18, end_col_offset=44)], ctx=Load(), lineno=18, col_offset=23, end_lineno=18, end_col_offset=44), ctx=Load(), lineno=18, col_offset=15, end_lineno=18, end_col_offset=45), lineno=18, col_offset=4, end_lineno=18, end_col_offset=45)], kw_defaults=[None, None, None, Constant(value='none', lineno=18, col_offset=48, end_lineno=18, end_col_offset=54)]), body=[Expr(value=Constant(value='Apply weighted Reciprocal Rank Fusion to channel hits.\n\n    Extended Summary\n    ----------------\n    This function performs weighted Reciprocal Rank Fusion (RRF) across multiple\n    retrieval channels, combining ranked lists from different search methods (e.g.,\n    CodeRank, WARP, BM25) into a single unified ranking. It serves as a legacy\n    compatibility wrapper that converts integer-based channel hits into the internal\n    ChannelHit format, optionally normalizes scores per-channel (minmax or z-score),\n    delegates to the core fusion engine, and converts results back to integer document\n    IDs. The function is used by the hybrid search pipeline to merge semantic and\n    sparse retrieval signals with configurable per-channel weights and normalization.\n\n    Parameters\n    ----------\n    channels : Mapping[str, Sequence[tuple[int, float]]]\n        Per-channel ranked lists mapping channel names to sequences of (doc_id, score)\n        tuples. Each channel represents a distinct retrieval method (e.g., "coderank",\n        "warp", "bm25"). Document IDs must be convertible to integers.\n    weights : Mapping[str, float]\n        Per-channel fusion weights. Channels not present in this mapping default to\n        weight 1.0. Zero-weighted channels are excluded from fusion. Weights control\n        the relative influence of each channel in the final ranking.\n    k : int\n        RRF damping constant. Controls how quickly reciprocal rank contributions decay\n        with position. Higher values reduce the impact of lower-ranked items. Typical\n        values range from 20 to 100.\n    top_k : int\n        Maximum number of documents to return in the fused ranking. Must be positive.\n        The function returns the top_k highest-scoring documents after fusion.\n    normalize : Literal["none", "minmax", "z"], optional\n        Optional per-channel score normalization applied before fusion. Use "minmax"\n        to scale raw scores to [0, 1] or "z" for z-score normalization. Defaults to\n        "none", preserving incoming scores.\n\n    Returns\n    -------\n    tuple[list[int], dict[int, list[tuple[str, int, float]]], dict[int, float]]\n        A 3-tuple containing:\n        - Ranked list of document IDs (integers) sorted by fused RRF score (descending).\n        - Per-document contribution map: doc_id -> list of (channel, rank, score) tuples\n          showing which channels contributed to each document\'s final score.\n        - Per-document fused score map: doc_id -> final fused RRF score.\n\n    Raises\n    ------\n    ValueError\n        If a document ID cannot be converted to an integer, or if top_k is not positive.\n\n    Notes\n    -----\n    Time complexity O(n * m) where n is total hits across channels and m is the number\n    of channels. Space complexity O(n) for the fused score map and contributions.\n    The function performs no I/O and has no side effects. Thread-safe if input mappings\n    are immutable or accessed read-only.\n\n    Examples\n    --------\n    >>> channels = {"coderank": [(1, 0.9), (2, 0.8)], "warp": [(2, 0.85), (1, 0.75)]}\n    >>> weights = {"coderank": 1.0, "warp": 0.5}\n    >>> doc_ids, contribs, scores = weighted_rrf(channels, weights=weights, k=60, top_k=2)\n    >>> len(doc_ids) <= 2\n    True\n    >>> 1 in doc_ids and 2 in doc_ids\n    True\n    ', lineno=20, col_offset=4, end_lineno=85, end_col_offset=7), lineno=20, col_offset=4, end_lineno=85, end_col_offset=7), If(test=Compare(left=Name(id='top_k', ctx=Load(), lineno=86, col_offset=7, end_lineno=86, end_col_offset=12), ops=[LtE()], comparators=[Constant(value=0, lineno=86, col_offset=16, end_lineno=86, end_col_offset=17)], lineno=86, col_offset=7, end_lineno=86, end_col_offset=17), body=[Assign(targets=[Name(id='msg', ctx=Store(), lineno=87, col_offset=8, end_lineno=87, end_col_offset=11)], value=JoinedStr(values=[Constant(value='top_k must be positive, got ', lineno=87, col_offset=16, end_lineno=87, end_col_offset=44), FormattedValue(value=Name(id='top_k', ctx=Load(), lineno=87, col_offset=45, end_lineno=87, end_col_offset=50), conversion=-1, lineno=87, col_offset=44, end_lineno=87, end_col_offset=51)], lineno=87, col_offset=14, end_lineno=87, end_col_offset=52), lineno=87, col_offset=8, end_lineno=87, end_col_offset=52), Raise(exc=Call(func=Name(id='ValueError', ctx=Load(), lineno=88, col_offset=14, end_lineno=88, end_col_offset=24), args=[Name(id='msg', ctx=Load(), lineno=88, col_offset=25, end_lineno=88, end_col_offset=28)], lineno=88, col_offset=14, end_lineno=88, end_col_offset=29), lineno=88, col_offset=8, end_lineno=88, end_col_offset=29)], lineno=86, col_offset=4, end_lineno=88, end_col_offset=29), Assign(targets=[Name(id='converted', ctx=Store(), lineno=89, col_offset=4, end_lineno=89, end_col_offset=13)], value=DictComp(key=Name(id='channel', ctx=Load(), lineno=90, col_offset=8, end_lineno=90, end_col_offset=15), value=ListComp(elt=Call(func=Name(id='ChannelHit', ctx=Load(), lineno=91, col_offset=12, end_lineno=91, end_col_offset=22), keywords=[keyword(arg='doc_id', value=Call(func=Name(id='str', ctx=Load(), lineno=91, col_offset=30, end_lineno=91, end_col_offset=33), args=[Name(id='doc_id', ctx=Load(), lineno=91, col_offset=34, end_lineno=91, end_col_offset=40)], lineno=91, col_offset=30, end_lineno=91, end_col_offset=41), lineno=91, col_offset=23, end_lineno=91, end_col_offset=41), keyword(arg='score', value=Call(func=Name(id='float', ctx=Load(), lineno=91, col_offset=49, end_lineno=91, end_col_offset=54), args=[Name(id='score', ctx=Load(), lineno=91, col_offset=55, end_lineno=91, end_col_offset=60)], lineno=91, col_offset=49, end_lineno=91, end_col_offset=61), lineno=91, col_offset=43, end_lineno=91, end_col_offset=61)], lineno=91, col_offset=12, end_lineno=91, end_col_offset=62), generators=[comprehension(target=Tuple(elts=[Name(id='doc_id', ctx=Store(), lineno=92, col_offset=16, end_lineno=92, end_col_offset=22), Name(id='score', ctx=Store(), lineno=92, col_offset=24, end_lineno=92, end_col_offset=29)], ctx=Store(), lineno=92, col_offset=16, end_lineno=92, end_col_offset=29), iter=Call(func=Name(id='_normalize_channel_hits', ctx=Load(), lineno=92, col_offset=33, end_lineno=92, end_col_offset=56), args=[Name(id='hits', ctx=Load(), lineno=92, col_offset=57, end_lineno=92, end_col_offset=61), Name(id='normalize', ctx=Load(), lineno=92, col_offset=63, end_lineno=92, end_col_offset=72)], lineno=92, col_offset=33, end_lineno=92, end_col_offset=73), is_async=0)], lineno=90, col_offset=17, end_lineno=93, end_col_offset=9), generators=[comprehension(target=Tuple(elts=[Name(id='channel', ctx=Store(), lineno=94, col_offset=12, end_lineno=94, end_col_offset=19), Name(id='hits', ctx=Store(), lineno=94, col_offset=21, end_lineno=94, end_col_offset=25)], ctx=Store(), lineno=94, col_offset=12, end_lineno=94, end_col_offset=25), iter=Call(func=Attribute(value=Name(id='channels', ctx=Load(), lineno=94, col_offset=29, end_lineno=94, end_col_offset=37), attr='items', ctx=Load(), lineno=94, col_offset=29, end_lineno=94, end_col_offset=43), lineno=94, col_offset=29, end_lineno=94, end_col_offset=45), is_async=0)], lineno=89, col_offset=16, end_lineno=95, end_col_offset=5), lineno=89, col_offset=4, end_lineno=95, end_col_offset=5), Assign(targets=[Tuple(elts=[Name(id='docs', ctx=Store(), lineno=96, col_offset=4, end_lineno=96, end_col_offset=8), Name(id='contributions', ctx=Store(), lineno=96, col_offset=10, end_lineno=96, end_col_offset=23)], ctx=Store(), lineno=96, col_offset=4, end_lineno=96, end_col_offset=23)], value=Call(func=Name(id='fuse_weighted_rrf', ctx=Load(), lineno=96, col_offset=26, end_lineno=96, end_col_offset=43), args=[Name(id='converted', ctx=Load(), lineno=97, col_offset=8, end_lineno=97, end_col_offset=17)], keywords=[keyword(arg='weights', value=Name(id='weights', ctx=Load(), lineno=98, col_offset=16, end_lineno=98, end_col_offset=23), lineno=98, col_offset=8, end_lineno=98, end_col_offset=23), keyword(arg='k', value=Name(id='k', ctx=Load(), lineno=99, col_offset=10, end_lineno=99, end_col_offset=11), lineno=99, col_offset=8, end_lineno=99, end_col_offset=11), keyword(arg='limit', value=Name(id='top_k', ctx=Load(), lineno=100, col_offset=14, end_lineno=100, end_col_offset=19), lineno=100, col_offset=8, end_lineno=100, end_col_offset=19)], lineno=96, col_offset=26, end_lineno=101, end_col_offset=5), lineno=96, col_offset=4, end_lineno=101, end_col_offset=5), Assign(targets=[Name(id='fused_ids', ctx=Store(), lineno=102, col_offset=4, end_lineno=102, end_col_offset=13)], value=ListComp(elt=Call(func=Name(id='_to_int', ctx=Load(), lineno=102, col_offset=17, end_lineno=102, end_col_offset=24), args=[Attribute(value=Name(id='doc', ctx=Load(), lineno=102, col_offset=25, end_lineno=102, end_col_offset=28), attr='doc_id', ctx=Load(), lineno=102, col_offset=25, end_lineno=102, end_col_offset=35)], lineno=102, col_offset=17, end_lineno=102, end_col_offset=36), generators=[comprehension(target=Name(id='doc', ctx=Store(), lineno=102, col_offset=41, end_lineno=102, end_col_offset=44), iter=Name(id='docs', ctx=Load(), lineno=102, col_offset=48, end_lineno=102, end_col_offset=52), is_async=0)], lineno=102, col_offset=16, end_lineno=102, end_col_offset=53), lineno=102, col_offset=4, end_lineno=102, end_col_offset=53), Assign(targets=[Name(id='fused_contrib', ctx=Store(), lineno=103, col_offset=4, end_lineno=103, end_col_offset=17)], value=DictComp(key=Name(id='doc_id', ctx=Load(), lineno=103, col_offset=21, end_lineno=103, end_col_offset=27), value=Call(func=Attribute(value=Name(id='contributions', ctx=Load(), lineno=103, col_offset=29, end_lineno=103, end_col_offset=42), attr='get', ctx=Load(), lineno=103, col_offset=29, end_lineno=103, end_col_offset=46), args=[Call(func=Name(id='str', ctx=Load(), lineno=103, col_offset=47, end_lineno=103, end_col_offset=50), args=[Name(id='doc_id', ctx=Load(), lineno=103, col_offset=51, end_lineno=103, end_col_offset=57)], lineno=103, col_offset=47, end_lineno=103, end_col_offset=58), List(ctx=Load(), lineno=103, col_offset=60, end_lineno=103, end_col_offset=62)], lineno=103, col_offset=29, end_lineno=103, end_col_offset=63), generators=[comprehension(target=Name(id='doc_id', ctx=Store(), lineno=103, col_offset=68, end_lineno=103, end_col_offset=74), iter=Name(id='fused_ids', ctx=Load(), lineno=103, col_offset=78, end_lineno=103, end_col_offset=87), is_async=0)], lineno=103, col_offset=20, end_lineno=103, end_col_offset=88), lineno=103, col_offset=4, end_lineno=103, end_col_offset=88), Assign(targets=[Name(id='fused_scores', ctx=Store(), lineno=104, col_offset=4, end_lineno=104, end_col_offset=16)], value=DictComp(key=Name(id='doc_id', ctx=Load(), lineno=104, col_offset=20, end_lineno=104, end_col_offset=26), value=Attribute(value=Subscript(value=Name(id='docs', ctx=Load(), lineno=104, col_offset=28, end_lineno=104, end_col_offset=32), slice=Name(id='idx', ctx=Load(), lineno=104, col_offset=33, end_lineno=104, end_col_offset=36), ctx=Load(), lineno=104, col_offset=28, end_lineno=104, end_col_offset=37), attr='score', ctx=Load(), lineno=104, col_offset=28, end_lineno=104, end_col_offset=43), generators=[comprehension(target=Tuple(elts=[Name(id='idx', ctx=Store(), lineno=104, col_offset=48, end_lineno=104, end_col_offset=51), Name(id='doc_id', ctx=Store(), lineno=104, col_offset=53, end_lineno=104, end_col_offset=59)], ctx=Store(), lineno=104, col_offset=48, end_lineno=104, end_col_offset=59), iter=Call(func=Name(id='enumerate', ctx=Load(), lineno=104, col_offset=63, end_lineno=104, end_col_offset=72), args=[Name(id='fused_ids', ctx=Load(), lineno=104, col_offset=73, end_lineno=104, end_col_offset=82)], lineno=104, col_offset=63, end_lineno=104, end_col_offset=83), is_async=0)], lineno=104, col_offset=19, end_lineno=104, end_col_offset=84), lineno=104, col_offset=4, end_lineno=104, end_col_offset=84), Return(value=Tuple(elts=[Name(id='fused_ids', ctx=Load(), lineno=105, col_offset=11, end_lineno=105, end_col_offset=20), Name(id='fused_contrib', ctx=Load(), lineno=105, col_offset=22, end_lineno=105, end_col_offset=35), Name(id='fused_scores', ctx=Load(), lineno=105, col_offset=37, end_lineno=105, end_col_offset=49)], ctx=Load(), lineno=105, col_offset=11, end_lineno=105, end_col_offset=49), lineno=105, col_offset=4, end_lineno=105, end_col_offset=49)], returns=Subscript(value=Name(id='tuple', ctx=Load(), lineno=19, col_offset=5, end_lineno=19, end_col_offset=10), slice=Tuple(elts=[Subscript(value=Name(id='list', ctx=Load(), lineno=19, col_offset=11, end_lineno=19, end_col_offset=15), slice=Name(id='int', ctx=Load(), lineno=19, col_offset=16, end_lineno=19, end_col_offset=19), ctx=Load(), lineno=19, col_offset=11, end_lineno=19, end_col_offset=20), Subscript(value=Name(id='dict', ctx=Load(), lineno=19, col_offset=22, end_lineno=19, end_col_offset=26), slice=Tuple(elts=[Name(id='int', ctx=Load(), lineno=19, col_offset=27, end_lineno=19, end_col_offset=30), Subscript(value=Name(id='list', ctx=Load(), lineno=19, col_offset=32, end_lineno=19, end_col_offset=36), slice=Subscript(value=Name(id='tuple', ctx=Load(), lineno=19, col_offset=37, end_lineno=19, end_col_offset=42), slice=Tuple(elts=[Name(id='str', ctx=Load(), lineno=19, col_offset=43, end_lineno=19, end_col_offset=46), Name(id='int', ctx=Load(), lineno=19, col_offset=48, end_lineno=19, end_col_offset=51), Name(id='float', ctx=Load(), lineno=19, col_offset=53, end_lineno=19, end_col_offset=58)], ctx=Load(), lineno=19, col_offset=43, end_lineno=19, end_col_offset=58), ctx=Load(), lineno=19, col_offset=37, end_lineno=19, end_col_offset=59), ctx=Load(), lineno=19, col_offset=32, end_lineno=19, end_col_offset=60)], ctx=Load(), lineno=19, col_offset=27, end_lineno=19, end_col_offset=60), ctx=Load(), lineno=19, col_offset=22, end_lineno=19, end_col_offset=61), Subscript(value=Name(id='dict', ctx=Load(), lineno=19, col_offset=63, end_lineno=19, end_col_offset=67), slice=Tuple(elts=[Name(id='int', ctx=Load(), lineno=19, col_offset=68, end_lineno=19, end_col_offset=71), Name(id='float', ctx=Load(), lineno=19, col_offset=73, end_lineno=19, end_col_offset=78)], ctx=Load(), lineno=19, col_offset=68, end_lineno=19, end_col_offset=78), ctx=Load(), lineno=19, col_offset=63, end_lineno=19, end_col_offset=79)], ctx=Load(), lineno=19, col_offset=11, end_lineno=19, end_col_offset=79), ctx=Load(), lineno=19, col_offset=5, end_lineno=19, end_col_offset=80), lineno=12, col_offset=0, end_lineno=105, end_col_offset=49), FunctionDef(name='_normalize_channel_hits', args=arguments(args=[arg(arg='hits', annotation=Subscript(value=Name(id='Sequence', ctx=Load(), lineno=109, col_offset=10, end_lineno=109, end_col_offset=18), slice=Subscript(value=Name(id='tuple', ctx=Load(), lineno=109, col_offset=19, end_lineno=109, end_col_offset=24), slice=Tuple(elts=[Name(id='int', ctx=Load(), lineno=109, col_offset=25, end_lineno=109, end_col_offset=28), Name(id='float', ctx=Load(), lineno=109, col_offset=30, end_lineno=109, end_col_offset=35)], ctx=Load(), lineno=109, col_offset=25, end_lineno=109, end_col_offset=35), ctx=Load(), lineno=109, col_offset=19, end_lineno=109, end_col_offset=36), ctx=Load(), lineno=109, col_offset=10, end_lineno=109, end_col_offset=37), lineno=109, col_offset=4, end_lineno=109, end_col_offset=37), arg(arg='mode', annotation=Subscript(value=Name(id='Literal', ctx=Load(), lineno=110, col_offset=10, end_lineno=110, end_col_offset=17), slice=Tuple(elts=[Constant(value='none', lineno=110, col_offset=18, end_lineno=110, end_col_offset=24), Constant(value='minmax', lineno=110, col_offset=26, end_lineno=110, end_col_offset=34), Constant(value='z', lineno=110, col_offset=36, end_lineno=110, end_col_offset=39)], ctx=Load(), lineno=110, col_offset=18, end_lineno=110, end_col_offset=39), ctx=Load(), lineno=110, col_offset=10, end_lineno=110, end_col_offset=40), lineno=110, col_offset=4, end_lineno=110, end_col_offset=40)]), body=[Expr(value=Constant(value='Normalize channel hit scores using the specified mode.\n\n    Parameters\n    ----------\n    hits : Sequence[tuple[int, float]]\n        Original hits as (doc_id, score) tuples.\n    mode : Literal["none", "minmax", "z"]\n        Normalization mode: "none" returns hits unchanged, "minmax" scales to [0, 1],\n        "z" applies z-score normalization.\n\n    Returns\n    -------\n    list[tuple[int, float]]\n        Normalized hits with same doc_ids but transformed scores.\n    ', lineno=112, col_offset=4, end_lineno=126, end_col_offset=7), lineno=112, col_offset=4, end_lineno=126, end_col_offset=7), If(test=Compare(left=Name(id='mode', ctx=Load(), lineno=127, col_offset=7, end_lineno=127, end_col_offset=11), ops=[Eq()], comparators=[Constant(value='none', lineno=127, col_offset=15, end_lineno=127, end_col_offset=21)], lineno=127, col_offset=7, end_lineno=127, end_col_offset=21), body=[Return(value=ListComp(elt=Tuple(elts=[Call(func=Name(id='int', ctx=Load(), lineno=128, col_offset=17, end_lineno=128, end_col_offset=20), args=[Name(id='doc_id', ctx=Load(), lineno=128, col_offset=21, end_lineno=128, end_col_offset=27)], lineno=128, col_offset=17, end_lineno=128, end_col_offset=28), Call(func=Name(id='float', ctx=Load(), lineno=128, col_offset=30, end_lineno=128, end_col_offset=35), args=[Name(id='score', ctx=Load(), lineno=128, col_offset=36, end_lineno=128, end_col_offset=41)], lineno=128, col_offset=30, end_lineno=128, end_col_offset=42)], ctx=Load(), lineno=128, col_offset=16, end_lineno=128, end_col_offset=43), generators=[comprehension(target=Tuple(elts=[Name(id='doc_id', ctx=Store(), lineno=128, col_offset=48, end_lineno=128, end_col_offset=54), Name(id='score', ctx=Store(), lineno=128, col_offset=56, end_lineno=128, end_col_offset=61)], ctx=Store(), lineno=128, col_offset=48, end_lineno=128, end_col_offset=61), iter=Name(id='hits', ctx=Load(), lineno=128, col_offset=65, end_lineno=128, end_col_offset=69), is_async=0)], lineno=128, col_offset=15, end_lineno=128, end_col_offset=70), lineno=128, col_offset=8, end_lineno=128, end_col_offset=70)], lineno=127, col_offset=4, end_lineno=128, end_col_offset=70), Assign(targets=[Name(id='values', ctx=Store(), lineno=129, col_offset=4, end_lineno=129, end_col_offset=10)], value=ListComp(elt=Call(func=Name(id='float', ctx=Load(), lineno=129, col_offset=14, end_lineno=129, end_col_offset=19), args=[Name(id='score', ctx=Load(), lineno=129, col_offset=20, end_lineno=129, end_col_offset=25)], lineno=129, col_offset=14, end_lineno=129, end_col_offset=26), generators=[comprehension(target=Tuple(elts=[Name(id='_doc_id', ctx=Store(), lineno=129, col_offset=31, end_lineno=129, end_col_offset=38), Name(id='score', ctx=Store(), lineno=129, col_offset=40, end_lineno=129, end_col_offset=45)], ctx=Store(), lineno=129, col_offset=31, end_lineno=129, end_col_offset=45), iter=Name(id='hits', ctx=Load(), lineno=129, col_offset=49, end_lineno=129, end_col_offset=53), is_async=0)], lineno=129, col_offset=13, end_lineno=129, end_col_offset=54), lineno=129, col_offset=4, end_lineno=129, end_col_offset=54), If(test=UnaryOp(op=Not(), operand=Name(id='values', ctx=Load(), lineno=130, col_offset=11, end_lineno=130, end_col_offset=17), lineno=130, col_offset=7, end_lineno=130, end_col_offset=17), body=[Return(value=List(ctx=Load(), lineno=131, col_offset=15, end_lineno=131, end_col_offset=17), lineno=131, col_offset=8, end_lineno=131, end_col_offset=17)], lineno=130, col_offset=4, end_lineno=131, end_col_offset=17), If(test=Compare(left=Name(id='mode', ctx=Load(), lineno=132, col_offset=7, end_lineno=132, end_col_offset=11), ops=[Eq()], comparators=[Constant(value='minmax', lineno=132, col_offset=15, end_lineno=132, end_col_offset=23)], lineno=132, col_offset=7, end_lineno=132, end_col_offset=23), body=[Assign(targets=[Name(id='min_value', ctx=Store(), lineno=133, col_offset=8, end_lineno=133, end_col_offset=17)], value=Call(func=Name(id='min', ctx=Load(), lineno=133, col_offset=20, end_lineno=133, end_col_offset=23), args=[Name(id='values', ctx=Load(), lineno=133, col_offset=24, end_lineno=133, end_col_offset=30)], lineno=133, col_offset=20, end_lineno=133, end_col_offset=31), lineno=133, col_offset=8, end_lineno=133, end_col_offset=31), Assign(targets=[Name(id='max_value', ctx=Store(), lineno=134, col_offset=8, end_lineno=134, end_col_offset=17)], value=Call(func=Name(id='max', ctx=Load(), lineno=134, col_offset=20, end_lineno=134, end_col_offset=23), args=[Name(id='values', ctx=Load(), lineno=134, col_offset=24, end_lineno=134, end_col_offset=30)], lineno=134, col_offset=20, end_lineno=134, end_col_offset=31), lineno=134, col_offset=8, end_lineno=134, end_col_offset=31), If(test=Compare(left=Name(id='max_value', ctx=Load(), lineno=135, col_offset=11, end_lineno=135, end_col_offset=20), ops=[Eq()], comparators=[Name(id='min_value', ctx=Load(), lineno=135, col_offset=24, end_lineno=135, end_col_offset=33)], lineno=135, col_offset=11, end_lineno=135, end_col_offset=33), body=[Assign(targets=[Name(id='normalized', ctx=Store(), lineno=136, col_offset=12, end_lineno=136, end_col_offset=22)], value=ListComp(elt=Constant(value=0.0, lineno=136, col_offset=26, end_lineno=136, end_col_offset=29), generators=[comprehension(target=Name(id='_', ctx=Store(), lineno=136, col_offset=34, end_lineno=136, end_col_offset=35), iter=Name(id='values', ctx=Load(), lineno=136, col_offset=39, end_lineno=136, end_col_offset=45), is_async=0)], lineno=136, col_offset=25, end_lineno=136, end_col_offset=46), lineno=136, col_offset=12, end_lineno=136, end_col_offset=46)], orelse=[Assign(targets=[Name(id='span', ctx=Store(), lineno=138, col_offset=12, end_lineno=138, end_col_offset=16)], value=BinOp(left=Name(id='max_value', ctx=Load(), lineno=138, col_offset=19, end_lineno=138, end_col_offset=28), op=Sub(), right=Name(id='min_value', ctx=Load(), lineno=138, col_offset=31, end_lineno=138, end_col_offset=40), lineno=138, col_offset=19, end_lineno=138, end_col_offset=40), lineno=138, col_offset=12, end_lineno=138, end_col_offset=40), Assign(targets=[Name(id='normalized', ctx=Store(), lineno=139, col_offset=12, end_lineno=139, end_col_offset=22)], value=ListComp(elt=BinOp(left=BinOp(left=Name(id='value', ctx=Load(), lineno=139, col_offset=27, end_lineno=139, end_col_offset=32), op=Sub(), right=Name(id='min_value', ctx=Load(), lineno=139, col_offset=35, end_lineno=139, end_col_offset=44), lineno=139, col_offset=27, end_lineno=139, end_col_offset=44), op=Div(), right=Name(id='span', ctx=Load(), lineno=139, col_offset=48, end_lineno=139, end_col_offset=52), lineno=139, col_offset=26, end_lineno=139, end_col_offset=52), generators=[comprehension(target=Name(id='value', ctx=Store(), lineno=139, col_offset=57, end_lineno=139, end_col_offset=62), iter=Name(id='values', ctx=Load(), lineno=139, col_offset=66, end_lineno=139, end_col_offset=72), is_async=0)], lineno=139, col_offset=25, end_lineno=139, end_col_offset=73), lineno=139, col_offset=12, end_lineno=139, end_col_offset=73)], lineno=135, col_offset=8, end_lineno=139, end_col_offset=73)], orelse=[Assign(targets=[Name(id='mean', ctx=Store(), lineno=141, col_offset=8, end_lineno=141, end_col_offset=12)], value=BinOp(left=Call(func=Name(id='sum', ctx=Load(), lineno=141, col_offset=15, end_lineno=141, end_col_offset=18), args=[Name(id='values', ctx=Load(), lineno=141, col_offset=19, end_lineno=141, end_col_offset=25)], lineno=141, col_offset=15, end_lineno=141, end_col_offset=26), op=Div(), right=Call(func=Name(id='len', ctx=Load(), lineno=141, col_offset=29, end_lineno=141, end_col_offset=32), args=[Name(id='values', ctx=Load(), lineno=141, col_offset=33, end_lineno=141, end_col_offset=39)], lineno=141, col_offset=29, end_lineno=141, end_col_offset=40), lineno=141, col_offset=15, end_lineno=141, end_col_offset=40), lineno=141, col_offset=8, end_lineno=141, end_col_offset=40), Assign(targets=[Name(id='variance', ctx=Store(), lineno=142, col_offset=8, end_lineno=142, end_col_offset=16)], value=BinOp(left=Call(func=Name(id='sum', ctx=Load(), lineno=142, col_offset=19, end_lineno=142, end_col_offset=22), args=[GeneratorExp(elt=BinOp(left=BinOp(left=Name(id='value', ctx=Load(), lineno=142, col_offset=24, end_lineno=142, end_col_offset=29), op=Sub(), right=Name(id='mean', ctx=Load(), lineno=142, col_offset=32, end_lineno=142, end_col_offset=36), lineno=142, col_offset=24, end_lineno=142, end_col_offset=36), op=Pow(), right=Constant(value=2, lineno=142, col_offset=41, end_lineno=142, end_col_offset=42), lineno=142, col_offset=23, end_lineno=142, end_col_offset=42), generators=[comprehension(target=Name(id='value', ctx=Store(), lineno=142, col_offset=47, end_lineno=142, end_col_offset=52), iter=Name(id='values', ctx=Load(), lineno=142, col_offset=56, end_lineno=142, end_col_offset=62), is_async=0)], lineno=142, col_offset=22, end_lineno=142, end_col_offset=63)], lineno=142, col_offset=19, end_lineno=142, end_col_offset=63), op=Div(), right=Call(func=Name(id='len', ctx=Load(), lineno=142, col_offset=66, end_lineno=142, end_col_offset=69), args=[Name(id='values', ctx=Load(), lineno=142, col_offset=70, end_lineno=142, end_col_offset=76)], lineno=142, col_offset=66, end_lineno=142, end_col_offset=77), lineno=142, col_offset=19, end_lineno=142, end_col_offset=77), lineno=142, col_offset=8, end_lineno=142, end_col_offset=77), If(test=Compare(left=Name(id='variance', ctx=Load(), lineno=143, col_offset=11, end_lineno=143, end_col_offset=19), ops=[Eq()], comparators=[Constant(value=0.0, lineno=143, col_offset=23, end_lineno=143, end_col_offset=26)], lineno=143, col_offset=11, end_lineno=143, end_col_offset=26), body=[Assign(targets=[Name(id='normalized', ctx=Store(), lineno=144, col_offset=12, end_lineno=144, end_col_offset=22)], value=ListComp(elt=Constant(value=0.0, lineno=144, col_offset=26, end_lineno=144, end_col_offset=29), generators=[comprehension(target=Name(id='_', ctx=Store(), lineno=144, col_offset=34, end_lineno=144, end_col_offset=35), iter=Name(id='values', ctx=Load(), lineno=144, col_offset=39, end_lineno=144, end_col_offset=45), is_async=0)], lineno=144, col_offset=25, end_lineno=144, end_col_offset=46), lineno=144, col_offset=12, end_lineno=144, end_col_offset=46)], orelse=[Assign(targets=[Name(id='std', ctx=Store(), lineno=146, col_offset=12, end_lineno=146, end_col_offset=15)], value=BinOp(left=Name(id='variance', ctx=Load(), lineno=146, col_offset=18, end_lineno=146, end_col_offset=26), op=Pow(), right=Constant(value=0.5, lineno=146, col_offset=28, end_lineno=146, end_col_offset=31), lineno=146, col_offset=18, end_lineno=146, end_col_offset=31), lineno=146, col_offset=12, end_lineno=146, end_col_offset=31), Assign(targets=[Name(id='normalized', ctx=Store(), lineno=147, col_offset=12, end_lineno=147, end_col_offset=22)], value=ListComp(elt=BinOp(left=BinOp(left=Name(id='value', ctx=Load(), lineno=147, col_offset=27, end_lineno=147, end_col_offset=32), op=Sub(), right=Name(id='mean', ctx=Load(), lineno=147, col_offset=35, end_lineno=147, end_col_offset=39), lineno=147, col_offset=27, end_lineno=147, end_col_offset=39), op=Div(), right=Name(id='std', ctx=Load(), lineno=147, col_offset=43, end_lineno=147, end_col_offset=46), lineno=147, col_offset=26, end_lineno=147, end_col_offset=46), generators=[comprehension(target=Name(id='value', ctx=Store(), lineno=147, col_offset=51, end_lineno=147, end_col_offset=56), iter=Name(id='values', ctx=Load(), lineno=147, col_offset=60, end_lineno=147, end_col_offset=66), is_async=0)], lineno=147, col_offset=25, end_lineno=147, end_col_offset=67), lineno=147, col_offset=12, end_lineno=147, end_col_offset=67)], lineno=143, col_offset=8, end_lineno=147, end_col_offset=67)], lineno=132, col_offset=4, end_lineno=147, end_col_offset=67), Return(value=ListComp(elt=Tuple(elts=[Call(func=Name(id='int', ctx=Load(), lineno=149, col_offset=9, end_lineno=149, end_col_offset=12), args=[Name(id='doc_id', ctx=Load(), lineno=149, col_offset=13, end_lineno=149, end_col_offset=19)], lineno=149, col_offset=9, end_lineno=149, end_col_offset=20), Call(func=Name(id='float', ctx=Load(), lineno=149, col_offset=22, end_lineno=149, end_col_offset=27), args=[Name(id='value', ctx=Load(), lineno=149, col_offset=28, end_lineno=149, end_col_offset=33)], lineno=149, col_offset=22, end_lineno=149, end_col_offset=34)], ctx=Load(), lineno=149, col_offset=8, end_lineno=149, end_col_offset=35), generators=[comprehension(target=Tuple(elts=[Tuple(elts=[Name(id='doc_id', ctx=Store(), lineno=150, col_offset=13, end_lineno=150, end_col_offset=19), Name(id='_score', ctx=Store(), lineno=150, col_offset=21, end_lineno=150, end_col_offset=27)], ctx=Store(), lineno=150, col_offset=12, end_lineno=150, end_col_offset=28), Name(id='value', ctx=Store(), lineno=150, col_offset=30, end_lineno=150, end_col_offset=35)], ctx=Store(), lineno=150, col_offset=12, end_lineno=150, end_col_offset=35), iter=Call(func=Name(id='zip', ctx=Load(), lineno=150, col_offset=39, end_lineno=150, end_col_offset=42), args=[Name(id='hits', ctx=Load(), lineno=150, col_offset=43, end_lineno=150, end_col_offset=47), Name(id='normalized', ctx=Load(), lineno=150, col_offset=49, end_lineno=150, end_col_offset=59)], keywords=[keyword(arg='strict', value=Constant(value=False, lineno=150, col_offset=68, end_lineno=150, end_col_offset=73), lineno=150, col_offset=61, end_lineno=150, end_col_offset=73)], lineno=150, col_offset=39, end_lineno=150, end_col_offset=74), is_async=0)], lineno=148, col_offset=11, end_lineno=151, end_col_offset=5), lineno=148, col_offset=4, end_lineno=151, end_col_offset=5)], returns=Subscript(value=Name(id='list', ctx=Load(), lineno=111, col_offset=5, end_lineno=111, end_col_offset=9), slice=Subscript(value=Name(id='tuple', ctx=Load(), lineno=111, col_offset=10, end_lineno=111, end_col_offset=15), slice=Tuple(elts=[Name(id='int', ctx=Load(), lineno=111, col_offset=16, end_lineno=111, end_col_offset=19), Name(id='float', ctx=Load(), lineno=111, col_offset=21, end_lineno=111, end_col_offset=26)], ctx=Load(), lineno=111, col_offset=16, end_lineno=111, end_col_offset=26), ctx=Load(), lineno=111, col_offset=10, end_lineno=111, end_col_offset=27), ctx=Load(), lineno=111, col_offset=5, end_lineno=111, end_col_offset=28), lineno=108, col_offset=0, end_lineno=151, end_col_offset=5), FunctionDef(name='_to_int', args=arguments(args=[arg(arg='value', annotation=Name(id='str', ctx=Load(), lineno=154, col_offset=19, end_lineno=154, end_col_offset=22), lineno=154, col_offset=12, end_lineno=154, end_col_offset=22)]), body=[Try(body=[Return(value=Call(func=Name(id='int', ctx=Load(), lineno=156, col_offset=15, end_lineno=156, end_col_offset=18), args=[Name(id='value', ctx=Load(), lineno=156, col_offset=19, end_lineno=156, end_col_offset=24)], lineno=156, col_offset=15, end_lineno=156, end_col_offset=25), lineno=156, col_offset=8, end_lineno=156, end_col_offset=25)], handlers=[ExceptHandler(type=Tuple(elts=[Name(id='TypeError', ctx=Load(), lineno=157, col_offset=12, end_lineno=157, end_col_offset=21), Name(id='ValueError', ctx=Load(), lineno=157, col_offset=23, end_lineno=157, end_col_offset=33)], ctx=Load(), lineno=157, col_offset=11, end_lineno=157, end_col_offset=34), name='exc', body=[Assign(targets=[Name(id='msg', ctx=Store(), lineno=158, col_offset=8, end_lineno=158, end_col_offset=11)], value=JoinedStr(values=[Constant(value='Channel doc_id should be convertible to int, got ', lineno=158, col_offset=16, end_lineno=158, end_col_offset=65), FormattedValue(value=Name(id='value', ctx=Load(), lineno=158, col_offset=66, end_lineno=158, end_col_offset=71), conversion=114, lineno=158, col_offset=65, end_lineno=158, end_col_offset=74)], lineno=158, col_offset=14, end_lineno=158, end_col_offset=75), lineno=158, col_offset=8, end_lineno=158, end_col_offset=75), Raise(exc=Call(func=Name(id='ValueError', ctx=Load(), lineno=159, col_offset=14, end_lineno=159, end_col_offset=24), args=[Name(id='msg', ctx=Load(), lineno=159, col_offset=25, end_lineno=159, end_col_offset=28)], lineno=159, col_offset=14, end_lineno=159, end_col_offset=29), cause=Name(id='exc', ctx=Load(), lineno=159, col_offset=35, end_lineno=159, end_col_offset=38), lineno=159, col_offset=8, end_lineno=159, end_col_offset=38)], lineno=157, col_offset=4, end_lineno=159, end_col_offset=38)], lineno=155, col_offset=4, end_lineno=159, end_col_offset=38)], returns=Name(id='int', ctx=Load(), lineno=154, col_offset=27, end_lineno=154, end_col_offset=30), lineno=154, col_offset=0, end_lineno=159, end_col_offset=38), Assign(targets=[Name(id='__all__', ctx=Store(), lineno=162, col_offset=0, end_lineno=162, end_col_offset=7)], value=List(elts=[Constant(value='weighted_rrf', lineno=162, col_offset=11, end_lineno=162, end_col_offset=25)], ctx=Load(), lineno=162, col_offset=10, end_lineno=162, end_col_offset=26), lineno=162, col_offset=0, end_lineno=162, end_col_offset=26)])