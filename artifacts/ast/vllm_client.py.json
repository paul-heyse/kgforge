Module(body=[Expr(value=Constant(value='vLLM embedding client using msgspec for fast serialization.\n\nOpenAI-compatible /v1/embeddings endpoint with batching support.\n', lineno=1, col_offset=0, end_lineno=4, end_col_offset=3), lineno=1, col_offset=0, end_lineno=4, end_col_offset=3), ImportFrom(module='__future__', names=[alias(name='annotations', lineno=6, col_offset=23, end_lineno=6, end_col_offset=34)], level=0, lineno=6, col_offset=0, end_lineno=6, end_col_offset=34), Import(names=[alias(name='asyncio', lineno=8, col_offset=7, end_lineno=8, end_col_offset=14)], lineno=8, col_offset=0, end_lineno=8, end_col_offset=14), ImportFrom(module='importlib', names=[alias(name='import_module', lineno=9, col_offset=22, end_lineno=9, end_col_offset=35)], level=0, lineno=9, col_offset=0, end_lineno=9, end_col_offset=35), ImportFrom(module='typing', names=[alias(name='TYPE_CHECKING', lineno=10, col_offset=19, end_lineno=10, end_col_offset=32)], level=0, lineno=10, col_offset=0, end_lineno=10, end_col_offset=32), Import(names=[alias(name='httpx', lineno=12, col_offset=7, end_lineno=12, end_col_offset=12)], lineno=12, col_offset=0, end_lineno=12, end_col_offset=12), Import(names=[alias(name='msgspec', lineno=13, col_offset=7, end_lineno=13, end_col_offset=14)], lineno=13, col_offset=0, end_lineno=13, end_col_offset=14), Import(names=[alias(name='numpy', asname='np', lineno=14, col_offset=7, end_lineno=14, end_col_offset=18)], lineno=14, col_offset=0, end_lineno=14, end_col_offset=18), ImportFrom(module='kgfoundry_common.logging', names=[alias(name='get_logger', lineno=16, col_offset=37, end_lineno=16, end_col_offset=47)], level=0, lineno=16, col_offset=0, end_lineno=16, end_col_offset=47), If(test=Name(id='TYPE_CHECKING', ctx=Load(), lineno=18, col_offset=3, end_lineno=18, end_col_offset=16), body=[ImportFrom(module='collections.abc', names=[alias(name='Sequence', lineno=19, col_offset=32, end_lineno=19, end_col_offset=40)], level=0, lineno=19, col_offset=4, end_lineno=19, end_col_offset=40), ImportFrom(module='codeintel_rev.config.settings', names=[alias(name='VLLMConfig', lineno=21, col_offset=46, end_lineno=21, end_col_offset=56)], level=0, lineno=21, col_offset=4, end_lineno=21, end_col_offset=56), ImportFrom(module='codeintel_rev.io.vllm_engine', names=[alias(name='InprocessVLLMEmbedder', lineno=22, col_offset=45, end_lineno=22, end_col_offset=66)], level=0, lineno=22, col_offset=4, end_lineno=22, end_col_offset=66)], lineno=18, col_offset=0, end_lineno=22, end_col_offset=66), Assign(targets=[Name(id='LOGGER', ctx=Store(), lineno=24, col_offset=0, end_lineno=24, end_col_offset=6)], value=Call(func=Name(id='get_logger', ctx=Load(), lineno=24, col_offset=9, end_lineno=24, end_col_offset=19), args=[Name(id='__name__', ctx=Load(), lineno=24, col_offset=20, end_lineno=24, end_col_offset=28)], lineno=24, col_offset=9, end_lineno=24, end_col_offset=29), lineno=24, col_offset=0, end_lineno=24, end_col_offset=29), ClassDef(name='EmbeddingRequest', bases=[Attribute(value=Name(id='msgspec', ctx=Load(), lineno=27, col_offset=23, end_lineno=27, end_col_offset=30), attr='Struct', ctx=Load(), lineno=27, col_offset=23, end_lineno=27, end_col_offset=37)], body=[Expr(value=Constant(value='OpenAI-compatible embedding request payload.\n\n    Request structure for the vLLM /v1/embeddings endpoint, matching the OpenAI\n    API format. This allows vLLM to be used as a drop-in replacement for OpenAI\'s\n    embedding API.\n\n    The request can embed a single text (str) or a batch of texts (list[str]).\n    Batch requests are more efficient as they\'re processed in parallel by the\n    model.\n\n    Attributes\n    ----------\n    input : str | list[str]\n        Text(s) to embed. Can be a single string for one embedding, or a list\n        of strings for batch embedding. Batch processing is more efficient.\n        Each text should be a code chunk or query string.\n    model : str\n        Model identifier string. Must match a model loaded by the vLLM server.\n        Defaults to "nomic-ai/nomic-embed-code" which is a code-specific\n        embedding model with 2560 dimensions. The embedding dimensionality is\n        surfaced via :class:`codeintel_rev.config.settings.VLLMConfig` ``embedding_dim``.\n    ', lineno=28, col_offset=4, end_lineno=49, end_col_offset=7), lineno=28, col_offset=4, end_lineno=49, end_col_offset=7), AnnAssign(target=Name(id='input', ctx=Store(), lineno=51, col_offset=4, end_lineno=51, end_col_offset=9), annotation=BinOp(left=Name(id='str', ctx=Load(), lineno=51, col_offset=11, end_lineno=51, end_col_offset=14), op=BitOr(), right=Subscript(value=Name(id='list', ctx=Load(), lineno=51, col_offset=17, end_lineno=51, end_col_offset=21), slice=Name(id='str', ctx=Load(), lineno=51, col_offset=22, end_lineno=51, end_col_offset=25), ctx=Load(), lineno=51, col_offset=17, end_lineno=51, end_col_offset=26), lineno=51, col_offset=11, end_lineno=51, end_col_offset=26), simple=1, lineno=51, col_offset=4, end_lineno=51, end_col_offset=26), AnnAssign(target=Name(id='model', ctx=Store(), lineno=52, col_offset=4, end_lineno=52, end_col_offset=9), annotation=Name(id='str', ctx=Load(), lineno=52, col_offset=11, end_lineno=52, end_col_offset=14), simple=1, lineno=52, col_offset=4, end_lineno=52, end_col_offset=14)], lineno=27, col_offset=0, end_lineno=52, end_col_offset=14), ClassDef(name='EmbeddingData', bases=[Attribute(value=Name(id='msgspec', ctx=Load(), lineno=55, col_offset=20, end_lineno=55, end_col_offset=27), attr='Struct', ctx=Load(), lineno=55, col_offset=20, end_lineno=55, end_col_offset=34)], body=[Expr(value=Constant(value="Single embedding result from a batch request.\n\n    Represents one embedding vector from a batch embedding request. Each text\n    in the input batch produces one EmbeddingData object. The index field\n    indicates the position in the original batch, which is important because\n    vLLM may return results in a different order than the input.\n\n    Attributes\n    ----------\n    embedding : list[float]\n        Embedding vector as a list of floats. The length matches the model's\n        dimension (e.g., 2560 for nomic-embed-code). Values are typically\n        normalized for cosine similarity. The expected size is available as\n        ``VLLMConfig.embedding_dim``.\n    index : int\n        Zero-based index indicating the position of this embedding in the\n        original input batch. Used to match embeddings back to their input\n        texts when results may be reordered.\n    ", lineno=56, col_offset=4, end_lineno=74, end_col_offset=7), lineno=56, col_offset=4, end_lineno=74, end_col_offset=7), AnnAssign(target=Name(id='embedding', ctx=Store(), lineno=76, col_offset=4, end_lineno=76, end_col_offset=13), annotation=Subscript(value=Name(id='list', ctx=Load(), lineno=76, col_offset=15, end_lineno=76, end_col_offset=19), slice=Name(id='float', ctx=Load(), lineno=76, col_offset=20, end_lineno=76, end_col_offset=25), ctx=Load(), lineno=76, col_offset=15, end_lineno=76, end_col_offset=26), simple=1, lineno=76, col_offset=4, end_lineno=76, end_col_offset=26), AnnAssign(target=Name(id='index', ctx=Store(), lineno=77, col_offset=4, end_lineno=77, end_col_offset=9), annotation=Name(id='int', ctx=Load(), lineno=77, col_offset=11, end_lineno=77, end_col_offset=14), simple=1, lineno=77, col_offset=4, end_lineno=77, end_col_offset=14)], lineno=55, col_offset=0, end_lineno=77, end_col_offset=14), ClassDef(name='EmbeddingResponse', bases=[Attribute(value=Name(id='msgspec', ctx=Load(), lineno=80, col_offset=24, end_lineno=80, end_col_offset=31), attr='Struct', ctx=Load(), lineno=80, col_offset=24, end_lineno=80, end_col_offset=38)], body=[Expr(value=Constant(value='OpenAI-compatible embedding response payload.\n\n    Response structure from the vLLM /v1/embeddings endpoint, matching the OpenAI\n    API format. Contains the embedding vectors along with metadata about the\n    request and model usage.\n\n    The data field contains one EmbeddingData per input text. Results may be\n    returned in a different order than the input, so use the index field to\n    match embeddings to their original texts.\n\n    Attributes\n    ----------\n    data : list[EmbeddingData]\n        List of embedding results, one per input text. The list length matches\n        the number of texts in the request. Each EmbeddingData contains the\n        vector and its index in the original batch.\n    model : str\n        Model identifier that was used to generate the embeddings. Should match\n        the model field from the request. Useful for verification and logging.\n    usage : dict\n        Token usage statistics dictionary. Typically contains keys like "prompt_tokens"\n        and "total_tokens" indicating how many tokens were processed. Useful for\n        monitoring and cost tracking.\n    ', lineno=81, col_offset=4, end_lineno=104, end_col_offset=7), lineno=81, col_offset=4, end_lineno=104, end_col_offset=7), AnnAssign(target=Name(id='data', ctx=Store(), lineno=106, col_offset=4, end_lineno=106, end_col_offset=8), annotation=Subscript(value=Name(id='list', ctx=Load(), lineno=106, col_offset=10, end_lineno=106, end_col_offset=14), slice=Name(id='EmbeddingData', ctx=Load(), lineno=106, col_offset=15, end_lineno=106, end_col_offset=28), ctx=Load(), lineno=106, col_offset=10, end_lineno=106, end_col_offset=29), simple=1, lineno=106, col_offset=4, end_lineno=106, end_col_offset=29), AnnAssign(target=Name(id='model', ctx=Store(), lineno=107, col_offset=4, end_lineno=107, end_col_offset=9), annotation=Name(id='str', ctx=Load(), lineno=107, col_offset=11, end_lineno=107, end_col_offset=14), simple=1, lineno=107, col_offset=4, end_lineno=107, end_col_offset=14), AnnAssign(target=Name(id='usage', ctx=Store(), lineno=108, col_offset=4, end_lineno=108, end_col_offset=9), annotation=Name(id='dict', ctx=Load(), lineno=108, col_offset=11, end_lineno=108, end_col_offset=15), simple=1, lineno=108, col_offset=4, end_lineno=108, end_col_offset=15)], lineno=80, col_offset=0, end_lineno=108, end_col_offset=15), ClassDef(name='VLLMClient', body=[Expr(value=Constant(value='vLLM embedding client supporting HTTP or in-process execution.\n\n    Maintains a persistent HTTP client for connection reuse across embedding\n    batches. This reduces latency by eliminating TCP handshake overhead and\n    enables HTTP/1.1 keep-alive for better performance.\n\n    The client is created during initialization and reused for all embed_batch\n    calls. Connection pooling is configured with limits to prevent server\n    overload. The client must be closed during application shutdown via the\n    close() method to avoid resource leaks.\n\n    Parameters\n    ----------\n    config : VLLMConfig\n        vLLM configuration including base URL, timeout, and model name.\n\n    Examples\n    --------\n    Create client and embed batch:\n\n    >>> from codeintel_rev.config.settings import VLLMConfig\n    >>> config = VLLMConfig(base_url="http://localhost:8000", model="test-model")\n    >>> client = VLLMClient(config)\n    >>> vectors = client.embed_batch(["def hello(): pass", "def world(): pass"])\n    >>> vectors.shape\n    (2, 2560)\n\n    Cleanup during shutdown:\n\n    >>> client.close()  # Must be called to close HTTP connections\n\n    Notes\n    -----\n    Connection pool limits:\n    - max_connections=100: Maximum total connections in pool\n    - max_keepalive_connections=20: Maximum connections kept alive for reuse\n\n    These limits prevent overwhelming the vLLM server while allowing efficient\n    connection reuse for high-throughput embedding workloads.\n\n    Internal attributes (not part of public API):\n    - ``config``: vLLM configuration\n    - ``_client``: Persistent HTTP client with connection pooling. Created during\n      initialization and reused across all requests\n    - ``_async_client``: Optional async HTTP client for concurrent embedding generation.\n      Lazy-initialized on first call to embed_batch_async\n    - ``_encoder``: Fast JSON encoder for request serialization\n    - ``_decoder``: Fast JSON decoder for response deserialization\n    ', lineno=112, col_offset=4, end_lineno=160, end_col_offset=7), lineno=112, col_offset=4, end_lineno=160, end_col_offset=7), FunctionDef(name='__init__', args=arguments(args=[arg(arg='self', lineno=162, col_offset=17, end_lineno=162, end_col_offset=21), arg(arg='config', annotation=Name(id='VLLMConfig', ctx=Load(), lineno=162, col_offset=31, end_lineno=162, end_col_offset=41), lineno=162, col_offset=23, end_lineno=162, end_col_offset=41)]), body=[Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=163, col_offset=8, end_lineno=163, end_col_offset=12), attr='config', ctx=Store(), lineno=163, col_offset=8, end_lineno=163, end_col_offset=19)], value=Name(id='config', ctx=Load(), lineno=163, col_offset=22, end_lineno=163, end_col_offset=28), lineno=163, col_offset=8, end_lineno=163, end_col_offset=28), Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=164, col_offset=8, end_lineno=164, end_col_offset=12), attr='_encoder', ctx=Store(), lineno=164, col_offset=8, end_lineno=164, end_col_offset=21)], value=Call(func=Attribute(value=Attribute(value=Name(id='msgspec', ctx=Load(), lineno=164, col_offset=24, end_lineno=164, end_col_offset=31), attr='json', ctx=Load(), lineno=164, col_offset=24, end_lineno=164, end_col_offset=36), attr='Encoder', ctx=Load(), lineno=164, col_offset=24, end_lineno=164, end_col_offset=44), lineno=164, col_offset=24, end_lineno=164, end_col_offset=46), lineno=164, col_offset=8, end_lineno=164, end_col_offset=46), Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=165, col_offset=8, end_lineno=165, end_col_offset=12), attr='_decoder', ctx=Store(), lineno=165, col_offset=8, end_lineno=165, end_col_offset=21)], value=Call(func=Attribute(value=Attribute(value=Name(id='msgspec', ctx=Load(), lineno=165, col_offset=24, end_lineno=165, end_col_offset=31), attr='json', ctx=Load(), lineno=165, col_offset=24, end_lineno=165, end_col_offset=36), attr='Decoder', ctx=Load(), lineno=165, col_offset=24, end_lineno=165, end_col_offset=44), args=[Name(id='EmbeddingResponse', ctx=Load(), lineno=165, col_offset=45, end_lineno=165, end_col_offset=62)], lineno=165, col_offset=24, end_lineno=165, end_col_offset=63), lineno=165, col_offset=8, end_lineno=165, end_col_offset=63), Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=166, col_offset=8, end_lineno=166, end_col_offset=12), attr='_mode', ctx=Store(), lineno=166, col_offset=8, end_lineno=166, end_col_offset=18)], value=Call(func=Name(id='getattr', ctx=Load(), lineno=166, col_offset=21, end_lineno=166, end_col_offset=28), args=[Attribute(value=Name(id='config', ctx=Load(), lineno=166, col_offset=29, end_lineno=166, end_col_offset=35), attr='run', ctx=Load(), lineno=166, col_offset=29, end_lineno=166, end_col_offset=39), Constant(value='mode', lineno=166, col_offset=41, end_lineno=166, end_col_offset=47), Constant(value='inprocess', lineno=166, col_offset=49, end_lineno=166, end_col_offset=60)], lineno=166, col_offset=21, end_lineno=166, end_col_offset=61), lineno=166, col_offset=8, end_lineno=166, end_col_offset=61), AnnAssign(target=Attribute(value=Name(id='self', ctx=Load(), lineno=167, col_offset=8, end_lineno=167, end_col_offset=12), attr='_client', ctx=Store(), lineno=167, col_offset=8, end_lineno=167, end_col_offset=20), annotation=BinOp(left=Attribute(value=Name(id='httpx', ctx=Load(), lineno=167, col_offset=22, end_lineno=167, end_col_offset=27), attr='Client', ctx=Load(), lineno=167, col_offset=22, end_lineno=167, end_col_offset=34), op=BitOr(), right=Constant(value=None, lineno=167, col_offset=37, end_lineno=167, end_col_offset=41), lineno=167, col_offset=22, end_lineno=167, end_col_offset=41), value=Constant(value=None, lineno=167, col_offset=44, end_lineno=167, end_col_offset=48), simple=0, lineno=167, col_offset=8, end_lineno=167, end_col_offset=48), AnnAssign(target=Attribute(value=Name(id='self', ctx=Load(), lineno=168, col_offset=8, end_lineno=168, end_col_offset=12), attr='_async_client', ctx=Store(), lineno=168, col_offset=8, end_lineno=168, end_col_offset=26), annotation=BinOp(left=Attribute(value=Name(id='httpx', ctx=Load(), lineno=168, col_offset=28, end_lineno=168, end_col_offset=33), attr='AsyncClient', ctx=Load(), lineno=168, col_offset=28, end_lineno=168, end_col_offset=45), op=BitOr(), right=Constant(value=None, lineno=168, col_offset=48, end_lineno=168, end_col_offset=52), lineno=168, col_offset=28, end_lineno=168, end_col_offset=52), value=Constant(value=None, lineno=168, col_offset=55, end_lineno=168, end_col_offset=59), simple=0, lineno=168, col_offset=8, end_lineno=168, end_col_offset=59), AnnAssign(target=Attribute(value=Name(id='self', ctx=Load(), lineno=169, col_offset=8, end_lineno=169, end_col_offset=12), attr='_local_engine', ctx=Store(), lineno=169, col_offset=8, end_lineno=169, end_col_offset=26), annotation=BinOp(left=Name(id='InprocessVLLMEmbedder', ctx=Load(), lineno=169, col_offset=28, end_lineno=169, end_col_offset=49), op=BitOr(), right=Constant(value=None, lineno=169, col_offset=52, end_lineno=169, end_col_offset=56), lineno=169, col_offset=28, end_lineno=169, end_col_offset=56), value=Constant(value=None, lineno=169, col_offset=59, end_lineno=169, end_col_offset=63), simple=0, lineno=169, col_offset=8, end_lineno=169, end_col_offset=63), AnnAssign(target=Attribute(value=Name(id='self', ctx=Load(), lineno=170, col_offset=8, end_lineno=170, end_col_offset=12), attr='_local_semaphore', ctx=Store(), lineno=170, col_offset=8, end_lineno=170, end_col_offset=29), annotation=BinOp(left=Attribute(value=Name(id='asyncio', ctx=Load(), lineno=170, col_offset=31, end_lineno=170, end_col_offset=38), attr='Semaphore', ctx=Load(), lineno=170, col_offset=31, end_lineno=170, end_col_offset=48), op=BitOr(), right=Constant(value=None, lineno=170, col_offset=51, end_lineno=170, end_col_offset=55), lineno=170, col_offset=31, end_lineno=170, end_col_offset=55), value=Constant(value=None, lineno=170, col_offset=58, end_lineno=170, end_col_offset=62), simple=0, lineno=170, col_offset=8, end_lineno=170, end_col_offset=62), If(test=Compare(left=Attribute(value=Name(id='self', ctx=Load(), lineno=172, col_offset=11, end_lineno=172, end_col_offset=15), attr='_mode', ctx=Load(), lineno=172, col_offset=11, end_lineno=172, end_col_offset=21), ops=[Eq()], comparators=[Constant(value='inprocess', lineno=172, col_offset=25, end_lineno=172, end_col_offset=36)], lineno=172, col_offset=11, end_lineno=172, end_col_offset=36), body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load(), lineno=173, col_offset=12, end_lineno=173, end_col_offset=16), attr='_initialize_local_engine', ctx=Load(), lineno=173, col_offset=12, end_lineno=173, end_col_offset=41), lineno=173, col_offset=12, end_lineno=173, end_col_offset=43), lineno=173, col_offset=12, end_lineno=173, end_col_offset=43)], orelse=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load(), lineno=175, col_offset=12, end_lineno=175, end_col_offset=16), attr='_initialize_http_client', ctx=Load(), lineno=175, col_offset=12, end_lineno=175, end_col_offset=40), lineno=175, col_offset=12, end_lineno=175, end_col_offset=42), lineno=175, col_offset=12, end_lineno=175, end_col_offset=42)], lineno=172, col_offset=8, end_lineno=175, end_col_offset=42)], returns=Constant(value=None, lineno=162, col_offset=46, end_lineno=162, end_col_offset=50), lineno=162, col_offset=4, end_lineno=175, end_col_offset=42), FunctionDef(name='_initialize_local_engine', args=arguments(args=[arg(arg='self', lineno=177, col_offset=33, end_lineno=177, end_col_offset=37)]), body=[Assign(targets=[Name(id='engine_module', ctx=Store(), lineno=178, col_offset=8, end_lineno=178, end_col_offset=21)], value=Call(func=Name(id='import_module', ctx=Load(), lineno=178, col_offset=24, end_lineno=178, end_col_offset=37), args=[Constant(value='codeintel_rev.io.vllm_engine', lineno=178, col_offset=38, end_lineno=178, end_col_offset=68)], lineno=178, col_offset=24, end_lineno=178, end_col_offset=69), lineno=178, col_offset=8, end_lineno=178, end_col_offset=69), Assign(targets=[Name(id='engine_cls', ctx=Store(), lineno=179, col_offset=8, end_lineno=179, end_col_offset=18)], value=Attribute(value=Name(id='engine_module', ctx=Load(), lineno=179, col_offset=21, end_lineno=179, end_col_offset=34), attr='InprocessVLLMEmbedder', ctx=Load(), lineno=179, col_offset=21, end_lineno=179, end_col_offset=56), lineno=179, col_offset=8, end_lineno=179, end_col_offset=56), Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=180, col_offset=8, end_lineno=180, end_col_offset=12), attr='_local_engine', ctx=Store(), lineno=180, col_offset=8, end_lineno=180, end_col_offset=26)], value=Call(func=Name(id='engine_cls', ctx=Load(), lineno=180, col_offset=29, end_lineno=180, end_col_offset=39), args=[Attribute(value=Name(id='self', ctx=Load(), lineno=180, col_offset=40, end_lineno=180, end_col_offset=44), attr='config', ctx=Load(), lineno=180, col_offset=40, end_lineno=180, end_col_offset=51)], lineno=180, col_offset=29, end_lineno=180, end_col_offset=52), lineno=180, col_offset=8, end_lineno=180, end_col_offset=52), Expr(value=Call(func=Attribute(value=Name(id='LOGGER', ctx=Load(), lineno=181, col_offset=8, end_lineno=181, end_col_offset=14), attr='debug', ctx=Load(), lineno=181, col_offset=8, end_lineno=181, end_col_offset=20), args=[Constant(value='Initialized VLLMClient in in-process mode', lineno=182, col_offset=12, end_lineno=182, end_col_offset=55)], keywords=[keyword(arg='extra', value=Dict(keys=[Constant(value='model', lineno=183, col_offset=19, end_lineno=183, end_col_offset=26)], values=[Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=183, col_offset=28, end_lineno=183, end_col_offset=32), attr='config', ctx=Load(), lineno=183, col_offset=28, end_lineno=183, end_col_offset=39), attr='model', ctx=Load(), lineno=183, col_offset=28, end_lineno=183, end_col_offset=45)], lineno=183, col_offset=18, end_lineno=183, end_col_offset=46), lineno=183, col_offset=12, end_lineno=183, end_col_offset=46)], lineno=181, col_offset=8, end_lineno=184, end_col_offset=9), lineno=181, col_offset=8, end_lineno=184, end_col_offset=9)], returns=Constant(value=None, lineno=177, col_offset=42, end_lineno=177, end_col_offset=46), lineno=177, col_offset=4, end_lineno=184, end_col_offset=9), FunctionDef(name='_initialize_http_client', args=arguments(args=[arg(arg='self', lineno=186, col_offset=32, end_lineno=186, end_col_offset=36)]), body=[Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=187, col_offset=8, end_lineno=187, end_col_offset=12), attr='_client', ctx=Store(), lineno=187, col_offset=8, end_lineno=187, end_col_offset=20)], value=Call(func=Attribute(value=Name(id='httpx', ctx=Load(), lineno=187, col_offset=23, end_lineno=187, end_col_offset=28), attr='Client', ctx=Load(), lineno=187, col_offset=23, end_lineno=187, end_col_offset=35), keywords=[keyword(arg='timeout', value=Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=188, col_offset=20, end_lineno=188, end_col_offset=24), attr='config', ctx=Load(), lineno=188, col_offset=20, end_lineno=188, end_col_offset=31), attr='timeout_s', ctx=Load(), lineno=188, col_offset=20, end_lineno=188, end_col_offset=41), lineno=188, col_offset=12, end_lineno=188, end_col_offset=41), keyword(arg='limits', value=Call(func=Attribute(value=Name(id='httpx', ctx=Load(), lineno=189, col_offset=19, end_lineno=189, end_col_offset=24), attr='Limits', ctx=Load(), lineno=189, col_offset=19, end_lineno=189, end_col_offset=31), keywords=[keyword(arg='max_connections', value=Constant(value=100, lineno=190, col_offset=32, end_lineno=190, end_col_offset=35), lineno=190, col_offset=16, end_lineno=190, end_col_offset=35), keyword(arg='max_keepalive_connections', value=Constant(value=20, lineno=191, col_offset=42, end_lineno=191, end_col_offset=44), lineno=191, col_offset=16, end_lineno=191, end_col_offset=44)], lineno=189, col_offset=19, end_lineno=192, end_col_offset=13), lineno=189, col_offset=12, end_lineno=192, end_col_offset=13)], lineno=187, col_offset=23, end_lineno=193, end_col_offset=9), lineno=187, col_offset=8, end_lineno=193, end_col_offset=9), Expr(value=Call(func=Attribute(value=Name(id='LOGGER', ctx=Load(), lineno=194, col_offset=8, end_lineno=194, end_col_offset=14), attr='debug', ctx=Load(), lineno=194, col_offset=8, end_lineno=194, end_col_offset=20), args=[Constant(value='Initialized VLLMClient HTTP transport', lineno=195, col_offset=12, end_lineno=195, end_col_offset=51)], keywords=[keyword(arg='extra', value=Dict(keys=[Constant(value='base_url', lineno=197, col_offset=16, end_lineno=197, end_col_offset=26), Constant(value='model', lineno=198, col_offset=16, end_lineno=198, end_col_offset=23), Constant(value='timeout_s', lineno=199, col_offset=16, end_lineno=199, end_col_offset=27), Constant(value='max_connections', lineno=200, col_offset=16, end_lineno=200, end_col_offset=33), Constant(value='max_keepalive_connections', lineno=201, col_offset=16, end_lineno=201, end_col_offset=43)], values=[Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=197, col_offset=28, end_lineno=197, end_col_offset=32), attr='config', ctx=Load(), lineno=197, col_offset=28, end_lineno=197, end_col_offset=39), attr='base_url', ctx=Load(), lineno=197, col_offset=28, end_lineno=197, end_col_offset=48), Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=198, col_offset=25, end_lineno=198, end_col_offset=29), attr='config', ctx=Load(), lineno=198, col_offset=25, end_lineno=198, end_col_offset=36), attr='model', ctx=Load(), lineno=198, col_offset=25, end_lineno=198, end_col_offset=42), Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=199, col_offset=29, end_lineno=199, end_col_offset=33), attr='config', ctx=Load(), lineno=199, col_offset=29, end_lineno=199, end_col_offset=40), attr='timeout_s', ctx=Load(), lineno=199, col_offset=29, end_lineno=199, end_col_offset=50), Constant(value=100, lineno=200, col_offset=35, end_lineno=200, end_col_offset=38), Constant(value=20, lineno=201, col_offset=45, end_lineno=201, end_col_offset=47)], lineno=196, col_offset=18, end_lineno=202, end_col_offset=13), lineno=196, col_offset=12, end_lineno=202, end_col_offset=13)], lineno=194, col_offset=8, end_lineno=203, end_col_offset=9), lineno=194, col_offset=8, end_lineno=203, end_col_offset=9)], returns=Constant(value=None, lineno=186, col_offset=41, end_lineno=186, end_col_offset=45), lineno=186, col_offset=4, end_lineno=203, end_col_offset=9), FunctionDef(name='embed_batch', args=arguments(args=[arg(arg='self', lineno=205, col_offset=20, end_lineno=205, end_col_offset=24), arg(arg='texts', annotation=Subscript(value=Name(id='Sequence', ctx=Load(), lineno=205, col_offset=33, end_lineno=205, end_col_offset=41), slice=Name(id='str', ctx=Load(), lineno=205, col_offset=42, end_lineno=205, end_col_offset=45), ctx=Load(), lineno=205, col_offset=33, end_lineno=205, end_col_offset=46), lineno=205, col_offset=26, end_lineno=205, end_col_offset=46)]), body=[Expr(value=Constant(value="Embed texts using the configured transport (HTTP or local).\n\n        Extended Summary\n        ----------------\n        This method generates dense vector embeddings for a batch of text strings using\n        the configured vLLM service. It supports both HTTP-based remote embedding (when\n        vLLM runs as a separate service) and in-process embedding (when vLLM is loaded\n        locally). The method automatically selects the appropriate transport based on\n        the client configuration and handles empty input batches gracefully. This is the\n        primary entry point for generating embeddings in Stage-0 retrieval pipelines.\n\n        Parameters\n        ----------\n        texts : Sequence[str]\n            Ordered sequence of text strings to embed. Empty sequences result in an\n            empty embedding matrix. Each text will be tokenized and encoded by the\n            vLLM model to produce a dense vector representation.\n\n        Returns\n        -------\n        np.ndarray\n            Embedding matrix with shape (N, embedding_dim) where N is len(texts) and\n            embedding_dim matches the configured model's output dimensionality. Dtype is\n            float32. Each row corresponds to the embedding of the corresponding input text.\n\n        Notes\n        -----\n        Time complexity O(N * T) where N is batch size and T is average token count per\n        text, plus network latency for HTTP mode. Space complexity O(N * embedding_dim)\n        for the result matrix. The method performs network I/O in HTTP mode or GPU\n        computation in local mode. Thread-safe if the underlying HTTP client or local\n        engine is thread-safe. Empty batches return shape (0, embedding_dim).\n        ", lineno=206, col_offset=8, end_lineno=238, end_col_offset=11), lineno=206, col_offset=8, end_lineno=238, end_col_offset=11), If(test=UnaryOp(op=Not(), operand=Name(id='texts', ctx=Load(), lineno=239, col_offset=15, end_lineno=239, end_col_offset=20), lineno=239, col_offset=11, end_lineno=239, end_col_offset=20), body=[Return(value=Call(func=Attribute(value=Name(id='np', ctx=Load(), lineno=240, col_offset=19, end_lineno=240, end_col_offset=21), attr='empty', ctx=Load(), lineno=240, col_offset=19, end_lineno=240, end_col_offset=27), args=[Tuple(elts=[Constant(value=0, lineno=240, col_offset=29, end_lineno=240, end_col_offset=30), Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=240, col_offset=32, end_lineno=240, end_col_offset=36), attr='config', ctx=Load(), lineno=240, col_offset=32, end_lineno=240, end_col_offset=43), attr='embedding_dim', ctx=Load(), lineno=240, col_offset=32, end_lineno=240, end_col_offset=57)], ctx=Load(), lineno=240, col_offset=28, end_lineno=240, end_col_offset=58)], keywords=[keyword(arg='dtype', value=Attribute(value=Name(id='np', ctx=Load(), lineno=240, col_offset=66, end_lineno=240, end_col_offset=68), attr='float32', ctx=Load(), lineno=240, col_offset=66, end_lineno=240, end_col_offset=76), lineno=240, col_offset=60, end_lineno=240, end_col_offset=76)], lineno=240, col_offset=19, end_lineno=240, end_col_offset=77), lineno=240, col_offset=12, end_lineno=240, end_col_offset=77)], lineno=239, col_offset=8, end_lineno=240, end_col_offset=77), If(test=Compare(left=Attribute(value=Name(id='self', ctx=Load(), lineno=242, col_offset=11, end_lineno=242, end_col_offset=15), attr='_local_engine', ctx=Load(), lineno=242, col_offset=11, end_lineno=242, end_col_offset=29), ops=[IsNot()], comparators=[Constant(value=None, lineno=242, col_offset=37, end_lineno=242, end_col_offset=41)], lineno=242, col_offset=11, end_lineno=242, end_col_offset=41), body=[Assign(targets=[Name(id='vectors', ctx=Store(), lineno=243, col_offset=12, end_lineno=243, end_col_offset=19)], value=Call(func=Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=243, col_offset=22, end_lineno=243, end_col_offset=26), attr='_local_engine', ctx=Load(), lineno=243, col_offset=22, end_lineno=243, end_col_offset=40), attr='embed_batch', ctx=Load(), lineno=243, col_offset=22, end_lineno=243, end_col_offset=52), args=[Name(id='texts', ctx=Load(), lineno=243, col_offset=53, end_lineno=243, end_col_offset=58)], lineno=243, col_offset=22, end_lineno=243, end_col_offset=59), lineno=243, col_offset=12, end_lineno=243, end_col_offset=59)], orelse=[Assign(targets=[Name(id='vectors', ctx=Store(), lineno=245, col_offset=12, end_lineno=245, end_col_offset=19)], value=Call(func=Attribute(value=Name(id='self', ctx=Load(), lineno=245, col_offset=22, end_lineno=245, end_col_offset=26), attr='_embed_batch_http', ctx=Load(), lineno=245, col_offset=22, end_lineno=245, end_col_offset=44), args=[Name(id='texts', ctx=Load(), lineno=245, col_offset=45, end_lineno=245, end_col_offset=50)], lineno=245, col_offset=22, end_lineno=245, end_col_offset=51), lineno=245, col_offset=12, end_lineno=245, end_col_offset=51)], lineno=242, col_offset=8, end_lineno=245, end_col_offset=51), Expr(value=Call(func=Attribute(value=Name(id='LOGGER', ctx=Load(), lineno=247, col_offset=8, end_lineno=247, end_col_offset=14), attr='debug', ctx=Load(), lineno=247, col_offset=8, end_lineno=247, end_col_offset=20), args=[Constant(value='Batch embedding completed', lineno=248, col_offset=12, end_lineno=248, end_col_offset=39)], keywords=[keyword(arg='extra', value=Dict(keys=[Constant(value='batch_size', lineno=250, col_offset=16, end_lineno=250, end_col_offset=28), Constant(value='vectors_shape', lineno=251, col_offset=16, end_lineno=251, end_col_offset=31), Constant(value='model', lineno=252, col_offset=16, end_lineno=252, end_col_offset=23), Constant(value='mode', lineno=253, col_offset=16, end_lineno=253, end_col_offset=22)], values=[Call(func=Name(id='len', ctx=Load(), lineno=250, col_offset=30, end_lineno=250, end_col_offset=33), args=[Name(id='texts', ctx=Load(), lineno=250, col_offset=34, end_lineno=250, end_col_offset=39)], lineno=250, col_offset=30, end_lineno=250, end_col_offset=40), Attribute(value=Name(id='vectors', ctx=Load(), lineno=251, col_offset=33, end_lineno=251, end_col_offset=40), attr='shape', ctx=Load(), lineno=251, col_offset=33, end_lineno=251, end_col_offset=46), Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=252, col_offset=25, end_lineno=252, end_col_offset=29), attr='config', ctx=Load(), lineno=252, col_offset=25, end_lineno=252, end_col_offset=36), attr='model', ctx=Load(), lineno=252, col_offset=25, end_lineno=252, end_col_offset=42), Attribute(value=Name(id='self', ctx=Load(), lineno=253, col_offset=24, end_lineno=253, end_col_offset=28), attr='_mode', ctx=Load(), lineno=253, col_offset=24, end_lineno=253, end_col_offset=34)], lineno=249, col_offset=18, end_lineno=254, end_col_offset=13), lineno=249, col_offset=12, end_lineno=254, end_col_offset=13)], lineno=247, col_offset=8, end_lineno=255, end_col_offset=9), lineno=247, col_offset=8, end_lineno=255, end_col_offset=9), Return(value=Name(id='vectors', ctx=Load(), lineno=256, col_offset=15, end_lineno=256, end_col_offset=22), lineno=256, col_offset=8, end_lineno=256, end_col_offset=22)], returns=Attribute(value=Name(id='np', ctx=Load(), lineno=205, col_offset=51, end_lineno=205, end_col_offset=53), attr='ndarray', ctx=Load(), lineno=205, col_offset=51, end_lineno=205, end_col_offset=61), lineno=205, col_offset=4, end_lineno=256, end_col_offset=22), FunctionDef(name='_embed_batch_http', args=arguments(args=[arg(arg='self', lineno=258, col_offset=26, end_lineno=258, end_col_offset=30), arg(arg='texts', annotation=Subscript(value=Name(id='Sequence', ctx=Load(), lineno=258, col_offset=39, end_lineno=258, end_col_offset=47), slice=Name(id='str', ctx=Load(), lineno=258, col_offset=48, end_lineno=258, end_col_offset=51), ctx=Load(), lineno=258, col_offset=39, end_lineno=258, end_col_offset=52), lineno=258, col_offset=32, end_lineno=258, end_col_offset=52)]), body=[Assign(targets=[Name(id='request', ctx=Store(), lineno=259, col_offset=8, end_lineno=259, end_col_offset=15)], value=Call(func=Name(id='EmbeddingRequest', ctx=Load(), lineno=259, col_offset=18, end_lineno=259, end_col_offset=34), keywords=[keyword(arg='input', value=Call(func=Name(id='list', ctx=Load(), lineno=259, col_offset=41, end_lineno=259, end_col_offset=45), args=[Name(id='texts', ctx=Load(), lineno=259, col_offset=46, end_lineno=259, end_col_offset=51)], lineno=259, col_offset=41, end_lineno=259, end_col_offset=52), lineno=259, col_offset=35, end_lineno=259, end_col_offset=52), keyword(arg='model', value=Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=259, col_offset=60, end_lineno=259, end_col_offset=64), attr='config', ctx=Load(), lineno=259, col_offset=60, end_lineno=259, end_col_offset=71), attr='model', ctx=Load(), lineno=259, col_offset=60, end_lineno=259, end_col_offset=77), lineno=259, col_offset=54, end_lineno=259, end_col_offset=77)], lineno=259, col_offset=18, end_lineno=259, end_col_offset=78), lineno=259, col_offset=8, end_lineno=259, end_col_offset=78), Assign(targets=[Name(id='payload', ctx=Store(), lineno=260, col_offset=8, end_lineno=260, end_col_offset=15)], value=Call(func=Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=260, col_offset=18, end_lineno=260, end_col_offset=22), attr='_encoder', ctx=Load(), lineno=260, col_offset=18, end_lineno=260, end_col_offset=31), attr='encode', ctx=Load(), lineno=260, col_offset=18, end_lineno=260, end_col_offset=38), args=[Name(id='request', ctx=Load(), lineno=260, col_offset=39, end_lineno=260, end_col_offset=46)], lineno=260, col_offset=18, end_lineno=260, end_col_offset=47), lineno=260, col_offset=8, end_lineno=260, end_col_offset=47), Expr(value=Call(func=Attribute(value=Name(id='LOGGER', ctx=Load(), lineno=262, col_offset=8, end_lineno=262, end_col_offset=14), attr='debug', ctx=Load(), lineno=262, col_offset=8, end_lineno=262, end_col_offset=20), args=[Constant(value='Embedding batch', lineno=263, col_offset=12, end_lineno=263, end_col_offset=29)], keywords=[keyword(arg='extra', value=Dict(keys=[Constant(value='batch_size', lineno=264, col_offset=19, end_lineno=264, end_col_offset=31), Constant(value='model', lineno=264, col_offset=45, end_lineno=264, end_col_offset=52)], values=[Call(func=Name(id='len', ctx=Load(), lineno=264, col_offset=33, end_lineno=264, end_col_offset=36), args=[Name(id='texts', ctx=Load(), lineno=264, col_offset=37, end_lineno=264, end_col_offset=42)], lineno=264, col_offset=33, end_lineno=264, end_col_offset=43), Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=264, col_offset=54, end_lineno=264, end_col_offset=58), attr='config', ctx=Load(), lineno=264, col_offset=54, end_lineno=264, end_col_offset=65), attr='model', ctx=Load(), lineno=264, col_offset=54, end_lineno=264, end_col_offset=71)], lineno=264, col_offset=18, end_lineno=264, end_col_offset=72), lineno=264, col_offset=12, end_lineno=264, end_col_offset=72)], lineno=262, col_offset=8, end_lineno=265, end_col_offset=9), lineno=262, col_offset=8, end_lineno=265, end_col_offset=9), Assign(targets=[Name(id='client', ctx=Store(), lineno=267, col_offset=8, end_lineno=267, end_col_offset=14)], value=Call(func=Attribute(value=Name(id='self', ctx=Load(), lineno=267, col_offset=17, end_lineno=267, end_col_offset=21), attr='_require_http_client', ctx=Load(), lineno=267, col_offset=17, end_lineno=267, end_col_offset=42), lineno=267, col_offset=17, end_lineno=267, end_col_offset=44), lineno=267, col_offset=8, end_lineno=267, end_col_offset=44), Assign(targets=[Name(id='response', ctx=Store(), lineno=268, col_offset=8, end_lineno=268, end_col_offset=16)], value=Call(func=Attribute(value=Name(id='client', ctx=Load(), lineno=268, col_offset=19, end_lineno=268, end_col_offset=25), attr='post', ctx=Load(), lineno=268, col_offset=19, end_lineno=268, end_col_offset=30), args=[JoinedStr(values=[FormattedValue(value=Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=269, col_offset=15, end_lineno=269, end_col_offset=19), attr='config', ctx=Load(), lineno=269, col_offset=15, end_lineno=269, end_col_offset=26), attr='base_url', ctx=Load(), lineno=269, col_offset=15, end_lineno=269, end_col_offset=35), conversion=-1, lineno=269, col_offset=14, end_lineno=269, end_col_offset=36), Constant(value='/embeddings', lineno=269, col_offset=36, end_lineno=269, end_col_offset=47)], lineno=269, col_offset=12, end_lineno=269, end_col_offset=48)], keywords=[keyword(arg='content', value=Name(id='payload', ctx=Load(), lineno=270, col_offset=20, end_lineno=270, end_col_offset=27), lineno=270, col_offset=12, end_lineno=270, end_col_offset=27), keyword(arg='headers', value=Dict(keys=[Constant(value='Content-Type', lineno=271, col_offset=21, end_lineno=271, end_col_offset=35)], values=[Constant(value='application/json', lineno=271, col_offset=37, end_lineno=271, end_col_offset=55)], lineno=271, col_offset=20, end_lineno=271, end_col_offset=56), lineno=271, col_offset=12, end_lineno=271, end_col_offset=56)], lineno=268, col_offset=19, end_lineno=272, end_col_offset=9), lineno=268, col_offset=8, end_lineno=272, end_col_offset=9), Expr(value=Call(func=Attribute(value=Name(id='response', ctx=Load(), lineno=273, col_offset=8, end_lineno=273, end_col_offset=16), attr='raise_for_status', ctx=Load(), lineno=273, col_offset=8, end_lineno=273, end_col_offset=33), lineno=273, col_offset=8, end_lineno=273, end_col_offset=35), lineno=273, col_offset=8, end_lineno=273, end_col_offset=35), Assign(targets=[Name(id='result', ctx=Store(), lineno=275, col_offset=8, end_lineno=275, end_col_offset=14)], value=Call(func=Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=275, col_offset=17, end_lineno=275, end_col_offset=21), attr='_decoder', ctx=Load(), lineno=275, col_offset=17, end_lineno=275, end_col_offset=30), attr='decode', ctx=Load(), lineno=275, col_offset=17, end_lineno=275, end_col_offset=37), args=[Attribute(value=Name(id='response', ctx=Load(), lineno=275, col_offset=38, end_lineno=275, end_col_offset=46), attr='content', ctx=Load(), lineno=275, col_offset=38, end_lineno=275, end_col_offset=54)], lineno=275, col_offset=17, end_lineno=275, end_col_offset=55), lineno=275, col_offset=8, end_lineno=275, end_col_offset=55), Assign(targets=[Name(id='sorted_data', ctx=Store(), lineno=278, col_offset=8, end_lineno=278, end_col_offset=19)], value=Call(func=Name(id='sorted', ctx=Load(), lineno=278, col_offset=22, end_lineno=278, end_col_offset=28), args=[Attribute(value=Name(id='result', ctx=Load(), lineno=278, col_offset=29, end_lineno=278, end_col_offset=35), attr='data', ctx=Load(), lineno=278, col_offset=29, end_lineno=278, end_col_offset=40)], keywords=[keyword(arg='key', value=Lambda(args=arguments(args=[arg(arg='d', lineno=278, col_offset=53, end_lineno=278, end_col_offset=54)]), body=Attribute(value=Name(id='d', ctx=Load(), lineno=278, col_offset=56, end_lineno=278, end_col_offset=57), attr='index', ctx=Load(), lineno=278, col_offset=56, end_lineno=278, end_col_offset=63), lineno=278, col_offset=46, end_lineno=278, end_col_offset=63), lineno=278, col_offset=42, end_lineno=278, end_col_offset=63)], lineno=278, col_offset=22, end_lineno=278, end_col_offset=64), lineno=278, col_offset=8, end_lineno=278, end_col_offset=64), Return(value=Call(func=Attribute(value=Name(id='np', ctx=Load(), lineno=279, col_offset=15, end_lineno=279, end_col_offset=17), attr='array', ctx=Load(), lineno=279, col_offset=15, end_lineno=279, end_col_offset=23), args=[ListComp(elt=Attribute(value=Name(id='d', ctx=Load(), lineno=279, col_offset=25, end_lineno=279, end_col_offset=26), attr='embedding', ctx=Load(), lineno=279, col_offset=25, end_lineno=279, end_col_offset=36), generators=[comprehension(target=Name(id='d', ctx=Store(), lineno=279, col_offset=41, end_lineno=279, end_col_offset=42), iter=Name(id='sorted_data', ctx=Load(), lineno=279, col_offset=46, end_lineno=279, end_col_offset=57), is_async=0)], lineno=279, col_offset=24, end_lineno=279, end_col_offset=58)], keywords=[keyword(arg='dtype', value=Attribute(value=Name(id='np', ctx=Load(), lineno=279, col_offset=66, end_lineno=279, end_col_offset=68), attr='float32', ctx=Load(), lineno=279, col_offset=66, end_lineno=279, end_col_offset=76), lineno=279, col_offset=60, end_lineno=279, end_col_offset=76)], lineno=279, col_offset=15, end_lineno=279, end_col_offset=77), lineno=279, col_offset=8, end_lineno=279, end_col_offset=77)], returns=Attribute(value=Name(id='np', ctx=Load(), lineno=258, col_offset=57, end_lineno=258, end_col_offset=59), attr='ndarray', ctx=Load(), lineno=258, col_offset=57, end_lineno=258, end_col_offset=67), lineno=258, col_offset=4, end_lineno=279, end_col_offset=77), FunctionDef(name='embed_single', args=arguments(args=[arg(arg='self', lineno=281, col_offset=21, end_lineno=281, end_col_offset=25), arg(arg='text', annotation=Name(id='str', ctx=Load(), lineno=281, col_offset=33, end_lineno=281, end_col_offset=36), lineno=281, col_offset=27, end_lineno=281, end_col_offset=36)]), body=[Expr(value=Constant(value='Embed a single string and return its vector.\n\n        Parameters\n        ----------\n        text : str\n            Text to embed.\n\n        Returns\n        -------\n        np.ndarray\n            One-dimensional embedding vector for the supplied text.\n\n        Raises\n        ------\n        RuntimeError\n            If the embedding service returns an empty response.\n        ', lineno=282, col_offset=8, end_lineno=298, end_col_offset=11), lineno=282, col_offset=8, end_lineno=298, end_col_offset=11), Assign(targets=[Name(id='vectors', ctx=Store(), lineno=299, col_offset=8, end_lineno=299, end_col_offset=15)], value=Call(func=Attribute(value=Name(id='self', ctx=Load(), lineno=299, col_offset=18, end_lineno=299, end_col_offset=22), attr='embed_batch', ctx=Load(), lineno=299, col_offset=18, end_lineno=299, end_col_offset=34), args=[List(elts=[Name(id='text', ctx=Load(), lineno=299, col_offset=36, end_lineno=299, end_col_offset=40)], ctx=Load(), lineno=299, col_offset=35, end_lineno=299, end_col_offset=41)], lineno=299, col_offset=18, end_lineno=299, end_col_offset=42), lineno=299, col_offset=8, end_lineno=299, end_col_offset=42), If(test=Compare(left=Attribute(value=Name(id='vectors', ctx=Load(), lineno=300, col_offset=11, end_lineno=300, end_col_offset=18), attr='size', ctx=Load(), lineno=300, col_offset=11, end_lineno=300, end_col_offset=23), ops=[Eq()], comparators=[Constant(value=0, lineno=300, col_offset=27, end_lineno=300, end_col_offset=28)], lineno=300, col_offset=11, end_lineno=300, end_col_offset=28), body=[Assign(targets=[Name(id='msg', ctx=Store(), lineno=301, col_offset=12, end_lineno=301, end_col_offset=15)], value=Constant(value='vLLM returned no vectors for single embed request', lineno=301, col_offset=18, end_lineno=301, end_col_offset=69), lineno=301, col_offset=12, end_lineno=301, end_col_offset=69), Raise(exc=Call(func=Name(id='RuntimeError', ctx=Load(), lineno=302, col_offset=18, end_lineno=302, end_col_offset=30), args=[Name(id='msg', ctx=Load(), lineno=302, col_offset=31, end_lineno=302, end_col_offset=34)], lineno=302, col_offset=18, end_lineno=302, end_col_offset=35), lineno=302, col_offset=12, end_lineno=302, end_col_offset=35)], lineno=300, col_offset=8, end_lineno=302, end_col_offset=35), Return(value=Subscript(value=Name(id='vectors', ctx=Load(), lineno=303, col_offset=15, end_lineno=303, end_col_offset=22), slice=Constant(value=0, lineno=303, col_offset=23, end_lineno=303, end_col_offset=24), ctx=Load(), lineno=303, col_offset=15, end_lineno=303, end_col_offset=25), lineno=303, col_offset=8, end_lineno=303, end_col_offset=25)], returns=Attribute(value=Name(id='np', ctx=Load(), lineno=281, col_offset=41, end_lineno=281, end_col_offset=43), attr='ndarray', ctx=Load(), lineno=281, col_offset=41, end_lineno=281, end_col_offset=51), lineno=281, col_offset=4, end_lineno=303, end_col_offset=25), FunctionDef(name='embed_chunks', args=arguments(args=[arg(arg='self', lineno=306, col_offset=8, end_lineno=306, end_col_offset=12), arg(arg='texts', annotation=Subscript(value=Name(id='Sequence', ctx=Load(), lineno=307, col_offset=15, end_lineno=307, end_col_offset=23), slice=Name(id='str', ctx=Load(), lineno=307, col_offset=24, end_lineno=307, end_col_offset=27), ctx=Load(), lineno=307, col_offset=15, end_lineno=307, end_col_offset=28), lineno=307, col_offset=8, end_lineno=307, end_col_offset=28), arg(arg='batch_size', annotation=BinOp(left=Name(id='int', ctx=Load(), lineno=308, col_offset=20, end_lineno=308, end_col_offset=23), op=BitOr(), right=Constant(value=None, lineno=308, col_offset=26, end_lineno=308, end_col_offset=30), lineno=308, col_offset=20, end_lineno=308, end_col_offset=30), lineno=308, col_offset=8, end_lineno=308, end_col_offset=30)], defaults=[Constant(value=None, lineno=308, col_offset=33, end_lineno=308, end_col_offset=37)]), body=[Expr(value=Constant(value="Embed texts in batches.\n\n        This method processes multiple texts efficiently by splitting them into\n        batches and sending each batch to the vLLM embedding service. Batching\n        improves throughput by amortizing HTTP request overhead and allowing\n        the service to process multiple texts in parallel.\n\n        The method handles empty input gracefully, returning an empty array with\n        the correct shape. Batch size can be customized per call or defaults to\n        the client's configured batch size. Results are concatenated into a single\n        array maintaining the input order.\n\n        Parameters\n        ----------\n        texts : Sequence[str]\n            Sequence of texts to embed. Can be any sequence type (list, tuple, etc.).\n            Each text should be a code chunk or query string suitable for the\n            embedding model. Empty sequence returns empty array.\n        batch_size : int | None, optional\n            Number of texts to process per batch. If None, uses the client's\n            configured batch_size from config. Larger batches improve throughput\n            but increase memory usage. Defaults to None (use config.batch_size).\n\n        Returns\n        -------\n        np.ndarray\n            Embeddings array of shape (len(texts), vec_dim) where vec_dim is the\n            model's embedding dimension (e.g., 2560). Dtype is float32 for memory\n            efficiency. Returns an empty array of shape (0, self.config.embedding_dim)\n            when texts is empty. The order matches the input texts.\n        ", lineno=310, col_offset=8, end_lineno=340, end_col_offset=11), lineno=310, col_offset=8, end_lineno=340, end_col_offset=11), If(test=UnaryOp(op=Not(), operand=Name(id='texts', ctx=Load(), lineno=341, col_offset=15, end_lineno=341, end_col_offset=20), lineno=341, col_offset=11, end_lineno=341, end_col_offset=20), body=[Return(value=Call(func=Attribute(value=Name(id='np', ctx=Load(), lineno=342, col_offset=19, end_lineno=342, end_col_offset=21), attr='empty', ctx=Load(), lineno=342, col_offset=19, end_lineno=342, end_col_offset=27), args=[Tuple(elts=[Constant(value=0, lineno=342, col_offset=29, end_lineno=342, end_col_offset=30), Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=342, col_offset=32, end_lineno=342, end_col_offset=36), attr='config', ctx=Load(), lineno=342, col_offset=32, end_lineno=342, end_col_offset=43), attr='embedding_dim', ctx=Load(), lineno=342, col_offset=32, end_lineno=342, end_col_offset=57)], ctx=Load(), lineno=342, col_offset=28, end_lineno=342, end_col_offset=58)], keywords=[keyword(arg='dtype', value=Attribute(value=Name(id='np', ctx=Load(), lineno=342, col_offset=66, end_lineno=342, end_col_offset=68), attr='float32', ctx=Load(), lineno=342, col_offset=66, end_lineno=342, end_col_offset=76), lineno=342, col_offset=60, end_lineno=342, end_col_offset=76)], lineno=342, col_offset=19, end_lineno=342, end_col_offset=77), lineno=342, col_offset=12, end_lineno=342, end_col_offset=77)], lineno=341, col_offset=8, end_lineno=342, end_col_offset=77), Assign(targets=[Name(id='bs', ctx=Store(), lineno=344, col_offset=8, end_lineno=344, end_col_offset=10)], value=BoolOp(op=Or(), values=[Name(id='batch_size', ctx=Load(), lineno=344, col_offset=13, end_lineno=344, end_col_offset=23), Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=344, col_offset=27, end_lineno=344, end_col_offset=31), attr='config', ctx=Load(), lineno=344, col_offset=27, end_lineno=344, end_col_offset=38), attr='batch_size', ctx=Load(), lineno=344, col_offset=27, end_lineno=344, end_col_offset=49)], lineno=344, col_offset=13, end_lineno=344, end_col_offset=49), lineno=344, col_offset=8, end_lineno=344, end_col_offset=49), Assign(targets=[Name(id='all_vectors', ctx=Store(), lineno=345, col_offset=8, end_lineno=345, end_col_offset=19)], value=List(ctx=Load(), lineno=345, col_offset=22, end_lineno=345, end_col_offset=24), lineno=345, col_offset=8, end_lineno=345, end_col_offset=24), For(target=Name(id='i', ctx=Store(), lineno=347, col_offset=12, end_lineno=347, end_col_offset=13), iter=Call(func=Name(id='range', ctx=Load(), lineno=347, col_offset=17, end_lineno=347, end_col_offset=22), args=[Constant(value=0, lineno=347, col_offset=23, end_lineno=347, end_col_offset=24), Call(func=Name(id='len', ctx=Load(), lineno=347, col_offset=26, end_lineno=347, end_col_offset=29), args=[Name(id='texts', ctx=Load(), lineno=347, col_offset=30, end_lineno=347, end_col_offset=35)], lineno=347, col_offset=26, end_lineno=347, end_col_offset=36), Name(id='bs', ctx=Load(), lineno=347, col_offset=38, end_lineno=347, end_col_offset=40)], lineno=347, col_offset=17, end_lineno=347, end_col_offset=41), body=[Assign(targets=[Name(id='batch', ctx=Store(), lineno=348, col_offset=12, end_lineno=348, end_col_offset=17)], value=Subscript(value=Name(id='texts', ctx=Load(), lineno=348, col_offset=20, end_lineno=348, end_col_offset=25), slice=Slice(lower=Name(id='i', ctx=Load(), lineno=348, col_offset=26, end_lineno=348, end_col_offset=27), upper=BinOp(left=Name(id='i', ctx=Load(), lineno=348, col_offset=30, end_lineno=348, end_col_offset=31), op=Add(), right=Name(id='bs', ctx=Load(), lineno=348, col_offset=34, end_lineno=348, end_col_offset=36), lineno=348, col_offset=30, end_lineno=348, end_col_offset=36), lineno=348, col_offset=26, end_lineno=348, end_col_offset=36), ctx=Load(), lineno=348, col_offset=20, end_lineno=348, end_col_offset=37), lineno=348, col_offset=12, end_lineno=348, end_col_offset=37), Assign(targets=[Name(id='vectors', ctx=Store(), lineno=349, col_offset=12, end_lineno=349, end_col_offset=19)], value=Call(func=Attribute(value=Name(id='self', ctx=Load(), lineno=349, col_offset=22, end_lineno=349, end_col_offset=26), attr='embed_batch', ctx=Load(), lineno=349, col_offset=22, end_lineno=349, end_col_offset=38), args=[Name(id='batch', ctx=Load(), lineno=349, col_offset=39, end_lineno=349, end_col_offset=44)], lineno=349, col_offset=22, end_lineno=349, end_col_offset=45), lineno=349, col_offset=12, end_lineno=349, end_col_offset=45), Expr(value=Call(func=Attribute(value=Name(id='all_vectors', ctx=Load(), lineno=350, col_offset=12, end_lineno=350, end_col_offset=23), attr='append', ctx=Load(), lineno=350, col_offset=12, end_lineno=350, end_col_offset=30), args=[Name(id='vectors', ctx=Load(), lineno=350, col_offset=31, end_lineno=350, end_col_offset=38)], lineno=350, col_offset=12, end_lineno=350, end_col_offset=39), lineno=350, col_offset=12, end_lineno=350, end_col_offset=39)], lineno=347, col_offset=8, end_lineno=350, end_col_offset=39), Return(value=Call(func=Attribute(value=Name(id='np', ctx=Load(), lineno=352, col_offset=15, end_lineno=352, end_col_offset=17), attr='vstack', ctx=Load(), lineno=352, col_offset=15, end_lineno=352, end_col_offset=24), args=[Name(id='all_vectors', ctx=Load(), lineno=352, col_offset=25, end_lineno=352, end_col_offset=36)], lineno=352, col_offset=15, end_lineno=352, end_col_offset=37), lineno=352, col_offset=8, end_lineno=352, end_col_offset=37)], returns=Attribute(value=Name(id='np', ctx=Load(), lineno=309, col_offset=9, end_lineno=309, end_col_offset=11), attr='ndarray', ctx=Load(), lineno=309, col_offset=9, end_lineno=309, end_col_offset=19), lineno=305, col_offset=4, end_lineno=352, end_col_offset=37), AsyncFunctionDef(name='embed_batch_async', args=arguments(args=[arg(arg='self', lineno=354, col_offset=32, end_lineno=354, end_col_offset=36), arg(arg='texts', annotation=Subscript(value=Name(id='Sequence', ctx=Load(), lineno=354, col_offset=45, end_lineno=354, end_col_offset=53), slice=Name(id='str', ctx=Load(), lineno=354, col_offset=54, end_lineno=354, end_col_offset=57), ctx=Load(), lineno=354, col_offset=45, end_lineno=354, end_col_offset=58), lineno=354, col_offset=38, end_lineno=354, end_col_offset=58)]), body=[Expr(value=Constant(value="Asynchronous variant of embed_batch for async/await workflows.\n\n        Extended Summary\n        ----------------\n        This method provides an asynchronous interface for generating dense vector\n        embeddings, enabling non-blocking embedding generation in async contexts.\n        It supports both HTTP-based remote embedding (via async HTTP client) and\n        in-process embedding (via async local engine wrapper). The method handles\n        empty input batches gracefully and provides the same functionality as\n        embed_batch but with async/await semantics for use in async event loops.\n\n        Parameters\n        ----------\n        texts : Sequence[str]\n            Ordered sequence of text strings to embed. Empty sequences result in an\n            empty embedding matrix. Each text will be tokenized and encoded by the\n            vLLM model to produce a dense vector representation.\n\n        Returns\n        -------\n        np.ndarray\n            Embedding matrix with shape (N, embedding_dim) where N is len(texts) and\n            embedding_dim matches the configured model's output dimensionality. Dtype is\n            float32. Each row corresponds to the embedding of the corresponding input text.\n\n        Notes\n        -----\n        Time complexity O(N * T) where N is batch size and T is average token count per\n        text, plus network latency for HTTP mode. Space complexity O(N * embedding_dim)\n        for the result matrix. The method performs async network I/O in HTTP mode or\n        async GPU computation in local mode. Thread-safe if the underlying async HTTP\n        client or local engine is thread-safe. Empty batches return shape (0, embedding_dim).\n        ", lineno=355, col_offset=8, end_lineno=387, end_col_offset=11), lineno=355, col_offset=8, end_lineno=387, end_col_offset=11), If(test=UnaryOp(op=Not(), operand=Name(id='texts', ctx=Load(), lineno=388, col_offset=15, end_lineno=388, end_col_offset=20), lineno=388, col_offset=11, end_lineno=388, end_col_offset=20), body=[Return(value=Call(func=Attribute(value=Name(id='np', ctx=Load(), lineno=389, col_offset=19, end_lineno=389, end_col_offset=21), attr='empty', ctx=Load(), lineno=389, col_offset=19, end_lineno=389, end_col_offset=27), args=[Tuple(elts=[Constant(value=0, lineno=389, col_offset=29, end_lineno=389, end_col_offset=30), Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=389, col_offset=32, end_lineno=389, end_col_offset=36), attr='config', ctx=Load(), lineno=389, col_offset=32, end_lineno=389, end_col_offset=43), attr='embedding_dim', ctx=Load(), lineno=389, col_offset=32, end_lineno=389, end_col_offset=57)], ctx=Load(), lineno=389, col_offset=28, end_lineno=389, end_col_offset=58)], keywords=[keyword(arg='dtype', value=Attribute(value=Name(id='np', ctx=Load(), lineno=389, col_offset=66, end_lineno=389, end_col_offset=68), attr='float32', ctx=Load(), lineno=389, col_offset=66, end_lineno=389, end_col_offset=76), lineno=389, col_offset=60, end_lineno=389, end_col_offset=76)], lineno=389, col_offset=19, end_lineno=389, end_col_offset=77), lineno=389, col_offset=12, end_lineno=389, end_col_offset=77)], lineno=388, col_offset=8, end_lineno=389, end_col_offset=77), If(test=Compare(left=Attribute(value=Name(id='self', ctx=Load(), lineno=391, col_offset=11, end_lineno=391, end_col_offset=15), attr='_local_engine', ctx=Load(), lineno=391, col_offset=11, end_lineno=391, end_col_offset=29), ops=[IsNot()], comparators=[Constant(value=None, lineno=391, col_offset=37, end_lineno=391, end_col_offset=41)], lineno=391, col_offset=11, end_lineno=391, end_col_offset=41), body=[Return(value=Await(value=Call(func=Attribute(value=Name(id='self', ctx=Load(), lineno=392, col_offset=25, end_lineno=392, end_col_offset=29), attr='_embed_batch_async_local', ctx=Load(), lineno=392, col_offset=25, end_lineno=392, end_col_offset=54), args=[Name(id='texts', ctx=Load(), lineno=392, col_offset=55, end_lineno=392, end_col_offset=60)], lineno=392, col_offset=25, end_lineno=392, end_col_offset=61), lineno=392, col_offset=19, end_lineno=392, end_col_offset=61), lineno=392, col_offset=12, end_lineno=392, end_col_offset=61)], lineno=391, col_offset=8, end_lineno=392, end_col_offset=61), Assign(targets=[Name(id='async_client', ctx=Store(), lineno=394, col_offset=8, end_lineno=394, end_col_offset=20)], value=Call(func=Attribute(value=Name(id='self', ctx=Load(), lineno=394, col_offset=23, end_lineno=394, end_col_offset=27), attr='_ensure_async_http_client', ctx=Load(), lineno=394, col_offset=23, end_lineno=394, end_col_offset=53), lineno=394, col_offset=23, end_lineno=394, end_col_offset=55), lineno=394, col_offset=8, end_lineno=394, end_col_offset=55), Assign(targets=[Name(id='request', ctx=Store(), lineno=395, col_offset=8, end_lineno=395, end_col_offset=15)], value=Call(func=Name(id='EmbeddingRequest', ctx=Load(), lineno=395, col_offset=18, end_lineno=395, end_col_offset=34), keywords=[keyword(arg='input', value=Call(func=Name(id='list', ctx=Load(), lineno=395, col_offset=41, end_lineno=395, end_col_offset=45), args=[Name(id='texts', ctx=Load(), lineno=395, col_offset=46, end_lineno=395, end_col_offset=51)], lineno=395, col_offset=41, end_lineno=395, end_col_offset=52), lineno=395, col_offset=35, end_lineno=395, end_col_offset=52), keyword(arg='model', value=Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=395, col_offset=60, end_lineno=395, end_col_offset=64), attr='config', ctx=Load(), lineno=395, col_offset=60, end_lineno=395, end_col_offset=71), attr='model', ctx=Load(), lineno=395, col_offset=60, end_lineno=395, end_col_offset=77), lineno=395, col_offset=54, end_lineno=395, end_col_offset=77)], lineno=395, col_offset=18, end_lineno=395, end_col_offset=78), lineno=395, col_offset=8, end_lineno=395, end_col_offset=78), Assign(targets=[Name(id='payload', ctx=Store(), lineno=396, col_offset=8, end_lineno=396, end_col_offset=15)], value=Call(func=Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=396, col_offset=18, end_lineno=396, end_col_offset=22), attr='_encoder', ctx=Load(), lineno=396, col_offset=18, end_lineno=396, end_col_offset=31), attr='encode', ctx=Load(), lineno=396, col_offset=18, end_lineno=396, end_col_offset=38), args=[Name(id='request', ctx=Load(), lineno=396, col_offset=39, end_lineno=396, end_col_offset=46)], lineno=396, col_offset=18, end_lineno=396, end_col_offset=47), lineno=396, col_offset=8, end_lineno=396, end_col_offset=47), Expr(value=Call(func=Attribute(value=Name(id='LOGGER', ctx=Load(), lineno=398, col_offset=8, end_lineno=398, end_col_offset=14), attr='debug', ctx=Load(), lineno=398, col_offset=8, end_lineno=398, end_col_offset=20), args=[Constant(value='Embedding batch (async)', lineno=399, col_offset=12, end_lineno=399, end_col_offset=37)], keywords=[keyword(arg='extra', value=Dict(keys=[Constant(value='batch_size', lineno=400, col_offset=19, end_lineno=400, end_col_offset=31), Constant(value='model', lineno=400, col_offset=45, end_lineno=400, end_col_offset=52)], values=[Call(func=Name(id='len', ctx=Load(), lineno=400, col_offset=33, end_lineno=400, end_col_offset=36), args=[Name(id='texts', ctx=Load(), lineno=400, col_offset=37, end_lineno=400, end_col_offset=42)], lineno=400, col_offset=33, end_lineno=400, end_col_offset=43), Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=400, col_offset=54, end_lineno=400, end_col_offset=58), attr='config', ctx=Load(), lineno=400, col_offset=54, end_lineno=400, end_col_offset=65), attr='model', ctx=Load(), lineno=400, col_offset=54, end_lineno=400, end_col_offset=71)], lineno=400, col_offset=18, end_lineno=400, end_col_offset=72), lineno=400, col_offset=12, end_lineno=400, end_col_offset=72)], lineno=398, col_offset=8, end_lineno=401, end_col_offset=9), lineno=398, col_offset=8, end_lineno=401, end_col_offset=9), Assign(targets=[Name(id='response', ctx=Store(), lineno=403, col_offset=8, end_lineno=403, end_col_offset=16)], value=Await(value=Call(func=Attribute(value=Name(id='async_client', ctx=Load(), lineno=403, col_offset=25, end_lineno=403, end_col_offset=37), attr='post', ctx=Load(), lineno=403, col_offset=25, end_lineno=403, end_col_offset=42), args=[JoinedStr(values=[FormattedValue(value=Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=404, col_offset=15, end_lineno=404, end_col_offset=19), attr='config', ctx=Load(), lineno=404, col_offset=15, end_lineno=404, end_col_offset=26), attr='base_url', ctx=Load(), lineno=404, col_offset=15, end_lineno=404, end_col_offset=35), conversion=-1, lineno=404, col_offset=14, end_lineno=404, end_col_offset=36), Constant(value='/embeddings', lineno=404, col_offset=36, end_lineno=404, end_col_offset=47)], lineno=404, col_offset=12, end_lineno=404, end_col_offset=48)], keywords=[keyword(arg='content', value=Name(id='payload', ctx=Load(), lineno=405, col_offset=20, end_lineno=405, end_col_offset=27), lineno=405, col_offset=12, end_lineno=405, end_col_offset=27), keyword(arg='headers', value=Dict(keys=[Constant(value='Content-Type', lineno=406, col_offset=21, end_lineno=406, end_col_offset=35)], values=[Constant(value='application/json', lineno=406, col_offset=37, end_lineno=406, end_col_offset=55)], lineno=406, col_offset=20, end_lineno=406, end_col_offset=56), lineno=406, col_offset=12, end_lineno=406, end_col_offset=56)], lineno=403, col_offset=25, end_lineno=407, end_col_offset=9), lineno=403, col_offset=19, end_lineno=407, end_col_offset=9), lineno=403, col_offset=8, end_lineno=407, end_col_offset=9), Expr(value=Call(func=Attribute(value=Name(id='response', ctx=Load(), lineno=408, col_offset=8, end_lineno=408, end_col_offset=16), attr='raise_for_status', ctx=Load(), lineno=408, col_offset=8, end_lineno=408, end_col_offset=33), lineno=408, col_offset=8, end_lineno=408, end_col_offset=35), lineno=408, col_offset=8, end_lineno=408, end_col_offset=35), Assign(targets=[Name(id='result', ctx=Store(), lineno=410, col_offset=8, end_lineno=410, end_col_offset=14)], value=Call(func=Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=410, col_offset=17, end_lineno=410, end_col_offset=21), attr='_decoder', ctx=Load(), lineno=410, col_offset=17, end_lineno=410, end_col_offset=30), attr='decode', ctx=Load(), lineno=410, col_offset=17, end_lineno=410, end_col_offset=37), args=[Attribute(value=Name(id='response', ctx=Load(), lineno=410, col_offset=38, end_lineno=410, end_col_offset=46), attr='content', ctx=Load(), lineno=410, col_offset=38, end_lineno=410, end_col_offset=54)], lineno=410, col_offset=17, end_lineno=410, end_col_offset=55), lineno=410, col_offset=8, end_lineno=410, end_col_offset=55), Assign(targets=[Name(id='sorted_data', ctx=Store(), lineno=413, col_offset=8, end_lineno=413, end_col_offset=19)], value=Call(func=Name(id='sorted', ctx=Load(), lineno=413, col_offset=22, end_lineno=413, end_col_offset=28), args=[Attribute(value=Name(id='result', ctx=Load(), lineno=413, col_offset=29, end_lineno=413, end_col_offset=35), attr='data', ctx=Load(), lineno=413, col_offset=29, end_lineno=413, end_col_offset=40)], keywords=[keyword(arg='key', value=Lambda(args=arguments(args=[arg(arg='d', lineno=413, col_offset=53, end_lineno=413, end_col_offset=54)]), body=Attribute(value=Name(id='d', ctx=Load(), lineno=413, col_offset=56, end_lineno=413, end_col_offset=57), attr='index', ctx=Load(), lineno=413, col_offset=56, end_lineno=413, end_col_offset=63), lineno=413, col_offset=46, end_lineno=413, end_col_offset=63), lineno=413, col_offset=42, end_lineno=413, end_col_offset=63)], lineno=413, col_offset=22, end_lineno=413, end_col_offset=64), lineno=413, col_offset=8, end_lineno=413, end_col_offset=64), Assign(targets=[Name(id='vectors', ctx=Store(), lineno=414, col_offset=8, end_lineno=414, end_col_offset=15)], value=Call(func=Attribute(value=Name(id='np', ctx=Load(), lineno=414, col_offset=18, end_lineno=414, end_col_offset=20), attr='array', ctx=Load(), lineno=414, col_offset=18, end_lineno=414, end_col_offset=26), args=[ListComp(elt=Attribute(value=Name(id='d', ctx=Load(), lineno=414, col_offset=28, end_lineno=414, end_col_offset=29), attr='embedding', ctx=Load(), lineno=414, col_offset=28, end_lineno=414, end_col_offset=39), generators=[comprehension(target=Name(id='d', ctx=Store(), lineno=414, col_offset=44, end_lineno=414, end_col_offset=45), iter=Name(id='sorted_data', ctx=Load(), lineno=414, col_offset=49, end_lineno=414, end_col_offset=60), is_async=0)], lineno=414, col_offset=27, end_lineno=414, end_col_offset=61)], keywords=[keyword(arg='dtype', value=Attribute(value=Name(id='np', ctx=Load(), lineno=414, col_offset=69, end_lineno=414, end_col_offset=71), attr='float32', ctx=Load(), lineno=414, col_offset=69, end_lineno=414, end_col_offset=79), lineno=414, col_offset=63, end_lineno=414, end_col_offset=79)], lineno=414, col_offset=18, end_lineno=414, end_col_offset=80), lineno=414, col_offset=8, end_lineno=414, end_col_offset=80), Expr(value=Call(func=Attribute(value=Name(id='LOGGER', ctx=Load(), lineno=416, col_offset=8, end_lineno=416, end_col_offset=14), attr='debug', ctx=Load(), lineno=416, col_offset=8, end_lineno=416, end_col_offset=20), args=[Constant(value='Batch embedding completed (async)', lineno=417, col_offset=12, end_lineno=417, end_col_offset=47)], keywords=[keyword(arg='extra', value=Dict(keys=[Constant(value='batch_size', lineno=419, col_offset=16, end_lineno=419, end_col_offset=28), Constant(value='vectors_shape', lineno=420, col_offset=16, end_lineno=420, end_col_offset=31), Constant(value='model', lineno=421, col_offset=16, end_lineno=421, end_col_offset=23)], values=[Call(func=Name(id='len', ctx=Load(), lineno=419, col_offset=30, end_lineno=419, end_col_offset=33), args=[Name(id='texts', ctx=Load(), lineno=419, col_offset=34, end_lineno=419, end_col_offset=39)], lineno=419, col_offset=30, end_lineno=419, end_col_offset=40), Attribute(value=Name(id='vectors', ctx=Load(), lineno=420, col_offset=33, end_lineno=420, end_col_offset=40), attr='shape', ctx=Load(), lineno=420, col_offset=33, end_lineno=420, end_col_offset=46), Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=421, col_offset=25, end_lineno=421, end_col_offset=29), attr='config', ctx=Load(), lineno=421, col_offset=25, end_lineno=421, end_col_offset=36), attr='model', ctx=Load(), lineno=421, col_offset=25, end_lineno=421, end_col_offset=42)], lineno=418, col_offset=18, end_lineno=422, end_col_offset=13), lineno=418, col_offset=12, end_lineno=422, end_col_offset=13)], lineno=416, col_offset=8, end_lineno=423, end_col_offset=9), lineno=416, col_offset=8, end_lineno=423, end_col_offset=9), Return(value=Name(id='vectors', ctx=Load(), lineno=425, col_offset=15, end_lineno=425, end_col_offset=22), lineno=425, col_offset=8, end_lineno=425, end_col_offset=22)], returns=Attribute(value=Name(id='np', ctx=Load(), lineno=354, col_offset=63, end_lineno=354, end_col_offset=65), attr='ndarray', ctx=Load(), lineno=354, col_offset=63, end_lineno=354, end_col_offset=73), lineno=354, col_offset=4, end_lineno=425, end_col_offset=22), FunctionDef(name='close', args=arguments(args=[arg(arg='self', lineno=427, col_offset=14, end_lineno=427, end_col_offset=18)]), body=[Expr(value=Constant(value='Close HTTP clients, async clients, and the local engine.', lineno=428, col_offset=8, end_lineno=428, end_col_offset=70), lineno=428, col_offset=8, end_lineno=428, end_col_offset=70), Expr(value=Call(func=Attribute(value=Name(id='LOGGER', ctx=Load(), lineno=429, col_offset=8, end_lineno=429, end_col_offset=14), attr='debug', ctx=Load(), lineno=429, col_offset=8, end_lineno=429, end_col_offset=20), args=[Constant(value='Closing VLLMClient resources', lineno=429, col_offset=21, end_lineno=429, end_col_offset=51)], keywords=[keyword(arg='extra', value=Dict(keys=[Constant(value='mode', lineno=429, col_offset=60, end_lineno=429, end_col_offset=66)], values=[Attribute(value=Name(id='self', ctx=Load(), lineno=429, col_offset=68, end_lineno=429, end_col_offset=72), attr='_mode', ctx=Load(), lineno=429, col_offset=68, end_lineno=429, end_col_offset=78)], lineno=429, col_offset=59, end_lineno=429, end_col_offset=79), lineno=429, col_offset=53, end_lineno=429, end_col_offset=79)], lineno=429, col_offset=8, end_lineno=429, end_col_offset=80), lineno=429, col_offset=8, end_lineno=429, end_col_offset=80), If(test=Compare(left=Attribute(value=Name(id='self', ctx=Load(), lineno=430, col_offset=11, end_lineno=430, end_col_offset=15), attr='_client', ctx=Load(), lineno=430, col_offset=11, end_lineno=430, end_col_offset=23), ops=[IsNot()], comparators=[Constant(value=None, lineno=430, col_offset=31, end_lineno=430, end_col_offset=35)], lineno=430, col_offset=11, end_lineno=430, end_col_offset=35), body=[Expr(value=Call(func=Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=431, col_offset=12, end_lineno=431, end_col_offset=16), attr='_client', ctx=Load(), lineno=431, col_offset=12, end_lineno=431, end_col_offset=24), attr='close', ctx=Load(), lineno=431, col_offset=12, end_lineno=431, end_col_offset=30), lineno=431, col_offset=12, end_lineno=431, end_col_offset=32), lineno=431, col_offset=12, end_lineno=431, end_col_offset=32), Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=432, col_offset=12, end_lineno=432, end_col_offset=16), attr='_client', ctx=Store(), lineno=432, col_offset=12, end_lineno=432, end_col_offset=24)], value=Constant(value=None, lineno=432, col_offset=27, end_lineno=432, end_col_offset=31), lineno=432, col_offset=12, end_lineno=432, end_col_offset=31)], lineno=430, col_offset=8, end_lineno=432, end_col_offset=31), If(test=Compare(left=Attribute(value=Name(id='self', ctx=Load(), lineno=433, col_offset=11, end_lineno=433, end_col_offset=15), attr='_async_client', ctx=Load(), lineno=433, col_offset=11, end_lineno=433, end_col_offset=29), ops=[IsNot()], comparators=[Constant(value=None, lineno=433, col_offset=37, end_lineno=433, end_col_offset=41)], lineno=433, col_offset=11, end_lineno=433, end_col_offset=41), body=[Try(body=[Assign(targets=[Name(id='loop', ctx=Store(), lineno=435, col_offset=16, end_lineno=435, end_col_offset=20)], value=Call(func=Attribute(value=Name(id='asyncio', ctx=Load(), lineno=435, col_offset=23, end_lineno=435, end_col_offset=30), attr='get_event_loop', ctx=Load(), lineno=435, col_offset=23, end_lineno=435, end_col_offset=45), lineno=435, col_offset=23, end_lineno=435, end_col_offset=47), lineno=435, col_offset=16, end_lineno=435, end_col_offset=47)], handlers=[ExceptHandler(type=Name(id='RuntimeError', ctx=Load(), lineno=436, col_offset=19, end_lineno=436, end_col_offset=31), body=[Assign(targets=[Name(id='loop', ctx=Store(), lineno=437, col_offset=16, end_lineno=437, end_col_offset=20)], value=Constant(value=None, lineno=437, col_offset=23, end_lineno=437, end_col_offset=27), lineno=437, col_offset=16, end_lineno=437, end_col_offset=27)], lineno=436, col_offset=12, end_lineno=437, end_col_offset=27)], lineno=434, col_offset=12, end_lineno=437, end_col_offset=27), If(test=BoolOp(op=And(), values=[Name(id='loop', ctx=Load(), lineno=438, col_offset=15, end_lineno=438, end_col_offset=19), Call(func=Attribute(value=Name(id='loop', ctx=Load(), lineno=438, col_offset=24, end_lineno=438, end_col_offset=28), attr='is_running', ctx=Load(), lineno=438, col_offset=24, end_lineno=438, end_col_offset=39), lineno=438, col_offset=24, end_lineno=438, end_col_offset=41)], lineno=438, col_offset=15, end_lineno=438, end_col_offset=41), body=[Assign(targets=[Name(id='close_task', ctx=Store(), lineno=439, col_offset=16, end_lineno=439, end_col_offset=26)], value=Call(func=Attribute(value=Name(id='loop', ctx=Load(), lineno=439, col_offset=29, end_lineno=439, end_col_offset=33), attr='create_task', ctx=Load(), lineno=439, col_offset=29, end_lineno=439, end_col_offset=45), args=[Call(func=Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=439, col_offset=46, end_lineno=439, end_col_offset=50), attr='_async_client', ctx=Load(), lineno=439, col_offset=46, end_lineno=439, end_col_offset=64), attr='aclose', ctx=Load(), lineno=439, col_offset=46, end_lineno=439, end_col_offset=71), lineno=439, col_offset=46, end_lineno=439, end_col_offset=73)], lineno=439, col_offset=29, end_lineno=439, end_col_offset=74), lineno=439, col_offset=16, end_lineno=439, end_col_offset=74), Assign(targets=[Name(id='_', ctx=Store(), lineno=440, col_offset=16, end_lineno=440, end_col_offset=17)], value=Name(id='close_task', ctx=Load(), lineno=440, col_offset=20, end_lineno=440, end_col_offset=30), lineno=440, col_offset=16, end_lineno=440, end_col_offset=30)], orelse=[If(test=Name(id='loop', ctx=Load(), lineno=441, col_offset=17, end_lineno=441, end_col_offset=21), body=[Expr(value=Call(func=Attribute(value=Name(id='loop', ctx=Load(), lineno=442, col_offset=16, end_lineno=442, end_col_offset=20), attr='run_until_complete', ctx=Load(), lineno=442, col_offset=16, end_lineno=442, end_col_offset=39), args=[Call(func=Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=442, col_offset=40, end_lineno=442, end_col_offset=44), attr='_async_client', ctx=Load(), lineno=442, col_offset=40, end_lineno=442, end_col_offset=58), attr='aclose', ctx=Load(), lineno=442, col_offset=40, end_lineno=442, end_col_offset=65), lineno=442, col_offset=40, end_lineno=442, end_col_offset=67)], lineno=442, col_offset=16, end_lineno=442, end_col_offset=68), lineno=442, col_offset=16, end_lineno=442, end_col_offset=68)], orelse=[Expr(value=Call(func=Attribute(value=Name(id='asyncio', ctx=Load(), lineno=444, col_offset=16, end_lineno=444, end_col_offset=23), attr='run', ctx=Load(), lineno=444, col_offset=16, end_lineno=444, end_col_offset=27), args=[Call(func=Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=444, col_offset=28, end_lineno=444, end_col_offset=32), attr='_async_client', ctx=Load(), lineno=444, col_offset=28, end_lineno=444, end_col_offset=46), attr='aclose', ctx=Load(), lineno=444, col_offset=28, end_lineno=444, end_col_offset=53), lineno=444, col_offset=28, end_lineno=444, end_col_offset=55)], lineno=444, col_offset=16, end_lineno=444, end_col_offset=56), lineno=444, col_offset=16, end_lineno=444, end_col_offset=56)], lineno=441, col_offset=12, end_lineno=444, end_col_offset=56)], lineno=438, col_offset=12, end_lineno=444, end_col_offset=56), Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=445, col_offset=12, end_lineno=445, end_col_offset=16), attr='_async_client', ctx=Store(), lineno=445, col_offset=12, end_lineno=445, end_col_offset=30)], value=Constant(value=None, lineno=445, col_offset=33, end_lineno=445, end_col_offset=37), lineno=445, col_offset=12, end_lineno=445, end_col_offset=37)], lineno=433, col_offset=8, end_lineno=445, end_col_offset=37), If(test=Compare(left=Attribute(value=Name(id='self', ctx=Load(), lineno=446, col_offset=11, end_lineno=446, end_col_offset=15), attr='_local_engine', ctx=Load(), lineno=446, col_offset=11, end_lineno=446, end_col_offset=29), ops=[IsNot()], comparators=[Constant(value=None, lineno=446, col_offset=37, end_lineno=446, end_col_offset=41)], lineno=446, col_offset=11, end_lineno=446, end_col_offset=41), body=[Expr(value=Call(func=Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=447, col_offset=12, end_lineno=447, end_col_offset=16), attr='_local_engine', ctx=Load(), lineno=447, col_offset=12, end_lineno=447, end_col_offset=30), attr='close', ctx=Load(), lineno=447, col_offset=12, end_lineno=447, end_col_offset=36), lineno=447, col_offset=12, end_lineno=447, end_col_offset=38), lineno=447, col_offset=12, end_lineno=447, end_col_offset=38), Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=448, col_offset=12, end_lineno=448, end_col_offset=16), attr='_local_engine', ctx=Store(), lineno=448, col_offset=12, end_lineno=448, end_col_offset=30)], value=Constant(value=None, lineno=448, col_offset=33, end_lineno=448, end_col_offset=37), lineno=448, col_offset=12, end_lineno=448, end_col_offset=37)], lineno=446, col_offset=8, end_lineno=448, end_col_offset=37), Expr(value=Call(func=Attribute(value=Name(id='LOGGER', ctx=Load(), lineno=449, col_offset=8, end_lineno=449, end_col_offset=14), attr='debug', ctx=Load(), lineno=449, col_offset=8, end_lineno=449, end_col_offset=20), args=[Constant(value='VLLMClient resources closed', lineno=449, col_offset=21, end_lineno=449, end_col_offset=50)], lineno=449, col_offset=8, end_lineno=449, end_col_offset=51), lineno=449, col_offset=8, end_lineno=449, end_col_offset=51)], returns=Constant(value=None, lineno=427, col_offset=23, end_lineno=427, end_col_offset=27), lineno=427, col_offset=4, end_lineno=449, end_col_offset=51), AsyncFunctionDef(name='aclose', args=arguments(args=[arg(arg='self', lineno=451, col_offset=21, end_lineno=451, end_col_offset=25)]), body=[Expr(value=Constant(value='Asynchronously release all clients/engines.', lineno=452, col_offset=8, end_lineno=452, end_col_offset=57), lineno=452, col_offset=8, end_lineno=452, end_col_offset=57), If(test=Compare(left=Attribute(value=Name(id='self', ctx=Load(), lineno=453, col_offset=11, end_lineno=453, end_col_offset=15), attr='_client', ctx=Load(), lineno=453, col_offset=11, end_lineno=453, end_col_offset=23), ops=[IsNot()], comparators=[Constant(value=None, lineno=453, col_offset=31, end_lineno=453, end_col_offset=35)], lineno=453, col_offset=11, end_lineno=453, end_col_offset=35), body=[Expr(value=Call(func=Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=454, col_offset=12, end_lineno=454, end_col_offset=16), attr='_client', ctx=Load(), lineno=454, col_offset=12, end_lineno=454, end_col_offset=24), attr='close', ctx=Load(), lineno=454, col_offset=12, end_lineno=454, end_col_offset=30), lineno=454, col_offset=12, end_lineno=454, end_col_offset=32), lineno=454, col_offset=12, end_lineno=454, end_col_offset=32), Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=455, col_offset=12, end_lineno=455, end_col_offset=16), attr='_client', ctx=Store(), lineno=455, col_offset=12, end_lineno=455, end_col_offset=24)], value=Constant(value=None, lineno=455, col_offset=27, end_lineno=455, end_col_offset=31), lineno=455, col_offset=12, end_lineno=455, end_col_offset=31)], lineno=453, col_offset=8, end_lineno=455, end_col_offset=31), If(test=Compare(left=Attribute(value=Name(id='self', ctx=Load(), lineno=456, col_offset=11, end_lineno=456, end_col_offset=15), attr='_async_client', ctx=Load(), lineno=456, col_offset=11, end_lineno=456, end_col_offset=29), ops=[IsNot()], comparators=[Constant(value=None, lineno=456, col_offset=37, end_lineno=456, end_col_offset=41)], lineno=456, col_offset=11, end_lineno=456, end_col_offset=41), body=[Expr(value=Await(value=Call(func=Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=457, col_offset=18, end_lineno=457, end_col_offset=22), attr='_async_client', ctx=Load(), lineno=457, col_offset=18, end_lineno=457, end_col_offset=36), attr='aclose', ctx=Load(), lineno=457, col_offset=18, end_lineno=457, end_col_offset=43), lineno=457, col_offset=18, end_lineno=457, end_col_offset=45), lineno=457, col_offset=12, end_lineno=457, end_col_offset=45), lineno=457, col_offset=12, end_lineno=457, end_col_offset=45), Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=458, col_offset=12, end_lineno=458, end_col_offset=16), attr='_async_client', ctx=Store(), lineno=458, col_offset=12, end_lineno=458, end_col_offset=30)], value=Constant(value=None, lineno=458, col_offset=33, end_lineno=458, end_col_offset=37), lineno=458, col_offset=12, end_lineno=458, end_col_offset=37)], lineno=456, col_offset=8, end_lineno=458, end_col_offset=37), If(test=Compare(left=Attribute(value=Name(id='self', ctx=Load(), lineno=459, col_offset=11, end_lineno=459, end_col_offset=15), attr='_local_engine', ctx=Load(), lineno=459, col_offset=11, end_lineno=459, end_col_offset=29), ops=[IsNot()], comparators=[Constant(value=None, lineno=459, col_offset=37, end_lineno=459, end_col_offset=41)], lineno=459, col_offset=11, end_lineno=459, end_col_offset=41), body=[Expr(value=Call(func=Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=460, col_offset=12, end_lineno=460, end_col_offset=16), attr='_local_engine', ctx=Load(), lineno=460, col_offset=12, end_lineno=460, end_col_offset=30), attr='close', ctx=Load(), lineno=460, col_offset=12, end_lineno=460, end_col_offset=36), lineno=460, col_offset=12, end_lineno=460, end_col_offset=38), lineno=460, col_offset=12, end_lineno=460, end_col_offset=38), Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=461, col_offset=12, end_lineno=461, end_col_offset=16), attr='_local_engine', ctx=Store(), lineno=461, col_offset=12, end_lineno=461, end_col_offset=30)], value=Constant(value=None, lineno=461, col_offset=33, end_lineno=461, end_col_offset=37), lineno=461, col_offset=12, end_lineno=461, end_col_offset=37)], lineno=459, col_offset=8, end_lineno=461, end_col_offset=37), Expr(value=Call(func=Attribute(value=Name(id='LOGGER', ctx=Load(), lineno=462, col_offset=8, end_lineno=462, end_col_offset=14), attr='debug', ctx=Load(), lineno=462, col_offset=8, end_lineno=462, end_col_offset=20), args=[Constant(value='VLLMClient resources closed (async)', lineno=462, col_offset=21, end_lineno=462, end_col_offset=58)], lineno=462, col_offset=8, end_lineno=462, end_col_offset=59), lineno=462, col_offset=8, end_lineno=462, end_col_offset=59)], returns=Constant(value=None, lineno=451, col_offset=30, end_lineno=451, end_col_offset=34), lineno=451, col_offset=4, end_lineno=462, end_col_offset=59), AsyncFunctionDef(name='_embed_batch_async_local', args=arguments(args=[arg(arg='self', lineno=464, col_offset=39, end_lineno=464, end_col_offset=43), arg(arg='texts', annotation=Subscript(value=Name(id='Sequence', ctx=Load(), lineno=464, col_offset=52, end_lineno=464, end_col_offset=60), slice=Name(id='str', ctx=Load(), lineno=464, col_offset=61, end_lineno=464, end_col_offset=64), ctx=Load(), lineno=464, col_offset=52, end_lineno=464, end_col_offset=65), lineno=464, col_offset=45, end_lineno=464, end_col_offset=65)]), body=[If(test=Compare(left=Attribute(value=Name(id='self', ctx=Load(), lineno=465, col_offset=11, end_lineno=465, end_col_offset=15), attr='_local_engine', ctx=Load(), lineno=465, col_offset=11, end_lineno=465, end_col_offset=29), ops=[Is()], comparators=[Constant(value=None, lineno=465, col_offset=33, end_lineno=465, end_col_offset=37)], lineno=465, col_offset=11, end_lineno=465, end_col_offset=37), body=[Assign(targets=[Name(id='msg', ctx=Store(), lineno=466, col_offset=12, end_lineno=466, end_col_offset=15)], value=Constant(value='Local vLLM engine not initialized.', lineno=466, col_offset=18, end_lineno=466, end_col_offset=54), lineno=466, col_offset=12, end_lineno=466, end_col_offset=54), Raise(exc=Call(func=Name(id='RuntimeError', ctx=Load(), lineno=467, col_offset=18, end_lineno=467, end_col_offset=30), args=[Name(id='msg', ctx=Load(), lineno=467, col_offset=31, end_lineno=467, end_col_offset=34)], lineno=467, col_offset=18, end_lineno=467, end_col_offset=35), lineno=467, col_offset=12, end_lineno=467, end_col_offset=35)], lineno=465, col_offset=8, end_lineno=467, end_col_offset=35), If(test=Compare(left=Attribute(value=Name(id='self', ctx=Load(), lineno=468, col_offset=11, end_lineno=468, end_col_offset=15), attr='_local_semaphore', ctx=Load(), lineno=468, col_offset=11, end_lineno=468, end_col_offset=32), ops=[Is()], comparators=[Constant(value=None, lineno=468, col_offset=36, end_lineno=468, end_col_offset=40)], lineno=468, col_offset=11, end_lineno=468, end_col_offset=40), body=[Assign(targets=[Name(id='permits', ctx=Store(), lineno=469, col_offset=12, end_lineno=469, end_col_offset=19)], value=Call(func=Name(id='max', ctx=Load(), lineno=469, col_offset=22, end_lineno=469, end_col_offset=25), args=[Constant(value=1, lineno=469, col_offset=26, end_lineno=469, end_col_offset=27), Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=469, col_offset=29, end_lineno=469, end_col_offset=33), attr='config', ctx=Load(), lineno=469, col_offset=29, end_lineno=469, end_col_offset=40), attr='max_concurrent_requests', ctx=Load(), lineno=469, col_offset=29, end_lineno=469, end_col_offset=64)], lineno=469, col_offset=22, end_lineno=469, end_col_offset=65), lineno=469, col_offset=12, end_lineno=469, end_col_offset=65), Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=470, col_offset=12, end_lineno=470, end_col_offset=16), attr='_local_semaphore', ctx=Store(), lineno=470, col_offset=12, end_lineno=470, end_col_offset=33)], value=Call(func=Attribute(value=Name(id='asyncio', ctx=Load(), lineno=470, col_offset=36, end_lineno=470, end_col_offset=43), attr='Semaphore', ctx=Load(), lineno=470, col_offset=36, end_lineno=470, end_col_offset=53), args=[Name(id='permits', ctx=Load(), lineno=470, col_offset=54, end_lineno=470, end_col_offset=61)], lineno=470, col_offset=36, end_lineno=470, end_col_offset=62), lineno=470, col_offset=12, end_lineno=470, end_col_offset=62)], lineno=468, col_offset=8, end_lineno=470, end_col_offset=62), AsyncWith(items=[withitem(context_expr=Attribute(value=Name(id='self', ctx=Load(), lineno=471, col_offset=19, end_lineno=471, end_col_offset=23), attr='_local_semaphore', ctx=Load(), lineno=471, col_offset=19, end_lineno=471, end_col_offset=40))], body=[Assign(targets=[Name(id='loop', ctx=Store(), lineno=472, col_offset=12, end_lineno=472, end_col_offset=16)], value=Call(func=Attribute(value=Name(id='asyncio', ctx=Load(), lineno=472, col_offset=19, end_lineno=472, end_col_offset=26), attr='get_running_loop', ctx=Load(), lineno=472, col_offset=19, end_lineno=472, end_col_offset=43), lineno=472, col_offset=19, end_lineno=472, end_col_offset=45), lineno=472, col_offset=12, end_lineno=472, end_col_offset=45), Return(value=Await(value=Call(func=Attribute(value=Name(id='loop', ctx=Load(), lineno=473, col_offset=25, end_lineno=473, end_col_offset=29), attr='run_in_executor', ctx=Load(), lineno=473, col_offset=25, end_lineno=473, end_col_offset=45), args=[Constant(value=None, lineno=473, col_offset=46, end_lineno=473, end_col_offset=50), Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=473, col_offset=52, end_lineno=473, end_col_offset=56), attr='_local_engine', ctx=Load(), lineno=473, col_offset=52, end_lineno=473, end_col_offset=70), attr='embed_batch', ctx=Load(), lineno=473, col_offset=52, end_lineno=473, end_col_offset=82), Call(func=Name(id='list', ctx=Load(), lineno=473, col_offset=84, end_lineno=473, end_col_offset=88), args=[Name(id='texts', ctx=Load(), lineno=473, col_offset=89, end_lineno=473, end_col_offset=94)], lineno=473, col_offset=84, end_lineno=473, end_col_offset=95)], lineno=473, col_offset=25, end_lineno=473, end_col_offset=96), lineno=473, col_offset=19, end_lineno=473, end_col_offset=96), lineno=473, col_offset=12, end_lineno=473, end_col_offset=96)], lineno=471, col_offset=8, end_lineno=473, end_col_offset=96)], returns=Attribute(value=Name(id='np', ctx=Load(), lineno=464, col_offset=70, end_lineno=464, end_col_offset=72), attr='ndarray', ctx=Load(), lineno=464, col_offset=70, end_lineno=464, end_col_offset=80), lineno=464, col_offset=4, end_lineno=473, end_col_offset=96), FunctionDef(name='_ensure_async_http_client', args=arguments(args=[arg(arg='self', lineno=475, col_offset=34, end_lineno=475, end_col_offset=38)]), body=[If(test=Compare(left=Attribute(value=Name(id='self', ctx=Load(), lineno=476, col_offset=11, end_lineno=476, end_col_offset=15), attr='_async_client', ctx=Load(), lineno=476, col_offset=11, end_lineno=476, end_col_offset=29), ops=[Is()], comparators=[Constant(value=None, lineno=476, col_offset=33, end_lineno=476, end_col_offset=37)], lineno=476, col_offset=11, end_lineno=476, end_col_offset=37), body=[Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=477, col_offset=12, end_lineno=477, end_col_offset=16), attr='_async_client', ctx=Store(), lineno=477, col_offset=12, end_lineno=477, end_col_offset=30)], value=Call(func=Attribute(value=Name(id='httpx', ctx=Load(), lineno=477, col_offset=33, end_lineno=477, end_col_offset=38), attr='AsyncClient', ctx=Load(), lineno=477, col_offset=33, end_lineno=477, end_col_offset=50), keywords=[keyword(arg='timeout', value=Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=478, col_offset=24, end_lineno=478, end_col_offset=28), attr='config', ctx=Load(), lineno=478, col_offset=24, end_lineno=478, end_col_offset=35), attr='timeout_s', ctx=Load(), lineno=478, col_offset=24, end_lineno=478, end_col_offset=45), lineno=478, col_offset=16, end_lineno=478, end_col_offset=45), keyword(arg='limits', value=Call(func=Attribute(value=Name(id='httpx', ctx=Load(), lineno=479, col_offset=23, end_lineno=479, end_col_offset=28), attr='Limits', ctx=Load(), lineno=479, col_offset=23, end_lineno=479, end_col_offset=35), keywords=[keyword(arg='max_connections', value=Constant(value=100, lineno=480, col_offset=36, end_lineno=480, end_col_offset=39), lineno=480, col_offset=20, end_lineno=480, end_col_offset=39), keyword(arg='max_keepalive_connections', value=Constant(value=20, lineno=481, col_offset=46, end_lineno=481, end_col_offset=48), lineno=481, col_offset=20, end_lineno=481, end_col_offset=48)], lineno=479, col_offset=23, end_lineno=482, end_col_offset=17), lineno=479, col_offset=16, end_lineno=482, end_col_offset=17)], lineno=477, col_offset=33, end_lineno=483, end_col_offset=13), lineno=477, col_offset=12, end_lineno=483, end_col_offset=13), Expr(value=Call(func=Attribute(value=Name(id='LOGGER', ctx=Load(), lineno=484, col_offset=12, end_lineno=484, end_col_offset=18), attr='debug', ctx=Load(), lineno=484, col_offset=12, end_lineno=484, end_col_offset=24), args=[Constant(value='Initialized async HTTP client for VLLMClient', lineno=485, col_offset=16, end_lineno=485, end_col_offset=62)], keywords=[keyword(arg='extra', value=Dict(keys=[Constant(value='base_url', lineno=487, col_offset=20, end_lineno=487, end_col_offset=30), Constant(value='model', lineno=488, col_offset=20, end_lineno=488, end_col_offset=27)], values=[Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=487, col_offset=32, end_lineno=487, end_col_offset=36), attr='config', ctx=Load(), lineno=487, col_offset=32, end_lineno=487, end_col_offset=43), attr='base_url', ctx=Load(), lineno=487, col_offset=32, end_lineno=487, end_col_offset=52), Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=488, col_offset=29, end_lineno=488, end_col_offset=33), attr='config', ctx=Load(), lineno=488, col_offset=29, end_lineno=488, end_col_offset=40), attr='model', ctx=Load(), lineno=488, col_offset=29, end_lineno=488, end_col_offset=46)], lineno=486, col_offset=22, end_lineno=489, end_col_offset=17), lineno=486, col_offset=16, end_lineno=489, end_col_offset=17)], lineno=484, col_offset=12, end_lineno=490, end_col_offset=13), lineno=484, col_offset=12, end_lineno=490, end_col_offset=13)], lineno=476, col_offset=8, end_lineno=490, end_col_offset=13), Return(value=Attribute(value=Name(id='self', ctx=Load(), lineno=491, col_offset=15, end_lineno=491, end_col_offset=19), attr='_async_client', ctx=Load(), lineno=491, col_offset=15, end_lineno=491, end_col_offset=33), lineno=491, col_offset=8, end_lineno=491, end_col_offset=33)], returns=Attribute(value=Name(id='httpx', ctx=Load(), lineno=475, col_offset=43, end_lineno=475, end_col_offset=48), attr='AsyncClient', ctx=Load(), lineno=475, col_offset=43, end_lineno=475, end_col_offset=60), lineno=475, col_offset=4, end_lineno=491, end_col_offset=33), FunctionDef(name='_require_http_client', args=arguments(args=[arg(arg='self', lineno=493, col_offset=29, end_lineno=493, end_col_offset=33)]), body=[If(test=Compare(left=Attribute(value=Name(id='self', ctx=Load(), lineno=494, col_offset=11, end_lineno=494, end_col_offset=15), attr='_client', ctx=Load(), lineno=494, col_offset=11, end_lineno=494, end_col_offset=23), ops=[Is()], comparators=[Constant(value=None, lineno=494, col_offset=27, end_lineno=494, end_col_offset=31)], lineno=494, col_offset=11, end_lineno=494, end_col_offset=31), body=[Assign(targets=[Name(id='msg', ctx=Store(), lineno=495, col_offset=12, end_lineno=495, end_col_offset=15)], value=Constant(value="HTTP transport not initialized; set VLLM run mode to 'http'.", lineno=495, col_offset=18, end_lineno=495, end_col_offset=80), lineno=495, col_offset=12, end_lineno=495, end_col_offset=80), Raise(exc=Call(func=Name(id='RuntimeError', ctx=Load(), lineno=496, col_offset=18, end_lineno=496, end_col_offset=30), args=[Name(id='msg', ctx=Load(), lineno=496, col_offset=31, end_lineno=496, end_col_offset=34)], lineno=496, col_offset=18, end_lineno=496, end_col_offset=35), lineno=496, col_offset=12, end_lineno=496, end_col_offset=35)], lineno=494, col_offset=8, end_lineno=496, end_col_offset=35), Return(value=Attribute(value=Name(id='self', ctx=Load(), lineno=497, col_offset=15, end_lineno=497, end_col_offset=19), attr='_client', ctx=Load(), lineno=497, col_offset=15, end_lineno=497, end_col_offset=27), lineno=497, col_offset=8, end_lineno=497, end_col_offset=27)], returns=Attribute(value=Name(id='httpx', ctx=Load(), lineno=493, col_offset=38, end_lineno=493, end_col_offset=43), attr='Client', ctx=Load(), lineno=493, col_offset=38, end_lineno=493, end_col_offset=50), lineno=493, col_offset=4, end_lineno=497, end_col_offset=27)], lineno=111, col_offset=0, end_lineno=497, end_col_offset=27), Assign(targets=[Name(id='__all__', ctx=Store(), lineno=500, col_offset=0, end_lineno=500, end_col_offset=7)], value=List(elts=[Constant(value='EmbeddingData', lineno=501, col_offset=4, end_lineno=501, end_col_offset=19), Constant(value='EmbeddingRequest', lineno=502, col_offset=4, end_lineno=502, end_col_offset=22), Constant(value='EmbeddingResponse', lineno=503, col_offset=4, end_lineno=503, end_col_offset=23), Constant(value='VLLMClient', lineno=504, col_offset=4, end_lineno=504, end_col_offset=16)], ctx=Load(), lineno=500, col_offset=10, end_lineno=505, end_col_offset=1), lineno=500, col_offset=0, end_lineno=505, end_col_offset=1)])