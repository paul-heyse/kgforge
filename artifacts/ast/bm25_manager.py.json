Module(body=[Expr(value=Constant(value='BM25 indexing workflow helpers.', lineno=1, col_offset=0, end_lineno=1, end_col_offset=37), lineno=1, col_offset=0, end_lineno=1, end_col_offset=37), ImportFrom(module='__future__', names=[alias(name='annotations', lineno=3, col_offset=23, end_lineno=3, end_col_offset=34)], level=0, lineno=3, col_offset=0, end_lineno=3, end_col_offset=34), Import(names=[alias(name='importlib', lineno=5, col_offset=7, end_lineno=5, end_col_offset=16)], lineno=5, col_offset=0, end_lineno=5, end_col_offset=16), Import(names=[alias(name='json', lineno=6, col_offset=7, end_lineno=6, end_col_offset=11)], lineno=6, col_offset=0, end_lineno=6, end_col_offset=11), Import(names=[alias(name='logging', lineno=7, col_offset=7, end_lineno=7, end_col_offset=14)], lineno=7, col_offset=0, end_lineno=7, end_col_offset=14), Import(names=[alias(name='shutil', lineno=8, col_offset=7, end_lineno=8, end_col_offset=13)], lineno=8, col_offset=0, end_lineno=8, end_col_offset=13), Import(names=[alias(name='sys', lineno=9, col_offset=7, end_lineno=9, end_col_offset=10)], lineno=9, col_offset=0, end_lineno=9, end_col_offset=10), ImportFrom(module='datetime', names=[alias(name='UTC', lineno=10, col_offset=21, end_lineno=10, end_col_offset=24), alias(name='datetime', lineno=10, col_offset=26, end_lineno=10, end_col_offset=34)], level=0, lineno=10, col_offset=0, end_lineno=10, end_col_offset=34), ImportFrom(module='hashlib', names=[alias(name='sha256', lineno=11, col_offset=20, end_lineno=11, end_col_offset=26)], level=0, lineno=11, col_offset=0, end_lineno=11, end_col_offset=26), ImportFrom(module='pathlib', names=[alias(name='Path', lineno=12, col_offset=20, end_lineno=12, end_col_offset=24)], level=0, lineno=12, col_offset=0, end_lineno=12, end_col_offset=24), ImportFrom(module='typing', names=[alias(name='TYPE_CHECKING', lineno=13, col_offset=19, end_lineno=13, end_col_offset=32)], level=0, lineno=13, col_offset=0, end_lineno=13, end_col_offset=32), Import(names=[alias(name='msgspec', lineno=15, col_offset=7, end_lineno=15, end_col_offset=14)], lineno=15, col_offset=0, end_lineno=15, end_col_offset=14), ImportFrom(module='codeintel_rev.io.path_utils', names=[alias(name='resolve_within_repo', lineno=17, col_offset=40, end_lineno=17, end_col_offset=59)], level=0, lineno=17, col_offset=0, end_lineno=17, end_col_offset=59), ImportFrom(module='kgfoundry_common.subprocess_utils', names=[alias(name='run_subprocess', lineno=18, col_offset=46, end_lineno=18, end_col_offset=60)], level=0, lineno=18, col_offset=0, end_lineno=18, end_col_offset=60), If(test=Name(id='TYPE_CHECKING', ctx=Load(), lineno=20, col_offset=3, end_lineno=20, end_col_offset=16), body=[ImportFrom(module='codeintel_rev.config.settings', names=[alias(name='Settings', lineno=21, col_offset=46, end_lineno=21, end_col_offset=54)], level=0, lineno=21, col_offset=4, end_lineno=21, end_col_offset=54)], lineno=20, col_offset=0, end_lineno=21, end_col_offset=54), Assign(targets=[Name(id='GENERATOR_NAME', ctx=Store(), lineno=23, col_offset=0, end_lineno=23, end_col_offset=14)], value=Constant(value='codeintel_rev.io.bm25_manager', lineno=23, col_offset=17, end_lineno=23, end_col_offset=48), lineno=23, col_offset=0, end_lineno=23, end_col_offset=48), Assign(targets=[Name(id='CORPUS_METADATA_FILENAME', ctx=Store(), lineno=24, col_offset=0, end_lineno=24, end_col_offset=24)], value=Constant(value='metadata.json', lineno=24, col_offset=27, end_lineno=24, end_col_offset=42), lineno=24, col_offset=0, end_lineno=24, end_col_offset=42), Assign(targets=[Name(id='INDEX_METADATA_FILENAME', ctx=Store(), lineno=25, col_offset=0, end_lineno=25, end_col_offset=23)], value=Constant(value='metadata.json', lineno=25, col_offset=26, end_lineno=25, end_col_offset=41), lineno=25, col_offset=0, end_lineno=25, end_col_offset=41), Assign(targets=[Name(id='logger', ctx=Store(), lineno=27, col_offset=0, end_lineno=27, end_col_offset=6)], value=Call(func=Attribute(value=Name(id='logging', ctx=Load(), lineno=27, col_offset=9, end_lineno=27, end_col_offset=16), attr='getLogger', ctx=Load(), lineno=27, col_offset=9, end_lineno=27, end_col_offset=26), args=[Name(id='__name__', ctx=Load(), lineno=27, col_offset=27, end_lineno=27, end_col_offset=35)], lineno=27, col_offset=9, end_lineno=27, end_col_offset=36), lineno=27, col_offset=0, end_lineno=27, end_col_offset=36), ClassDef(name='BM25CorpusMetadata', bases=[Attribute(value=Name(id='msgspec', ctx=Load(), lineno=30, col_offset=25, end_lineno=30, end_col_offset=32), attr='Struct', ctx=Load(), lineno=30, col_offset=25, end_lineno=30, end_col_offset=39)], keywords=[keyword(arg='frozen', value=Constant(value=True, lineno=30, col_offset=48, end_lineno=30, end_col_offset=52), lineno=30, col_offset=41, end_lineno=30, end_col_offset=52)], body=[Expr(value=Constant(value='Metadata describing a prepared BM25 corpus.', lineno=31, col_offset=4, end_lineno=31, end_col_offset=53), lineno=31, col_offset=4, end_lineno=31, end_col_offset=53), AnnAssign(target=Name(id='doc_count', ctx=Store(), lineno=33, col_offset=4, end_lineno=33, end_col_offset=13), annotation=Name(id='int', ctx=Load(), lineno=33, col_offset=15, end_lineno=33, end_col_offset=18), simple=1, lineno=33, col_offset=4, end_lineno=33, end_col_offset=18), AnnAssign(target=Name(id='source_path', ctx=Store(), lineno=34, col_offset=4, end_lineno=34, end_col_offset=15), annotation=Name(id='str', ctx=Load(), lineno=34, col_offset=17, end_lineno=34, end_col_offset=20), simple=1, lineno=34, col_offset=4, end_lineno=34, end_col_offset=20), AnnAssign(target=Name(id='digest', ctx=Store(), lineno=35, col_offset=4, end_lineno=35, end_col_offset=10), annotation=Name(id='str', ctx=Load(), lineno=35, col_offset=12, end_lineno=35, end_col_offset=15), simple=1, lineno=35, col_offset=4, end_lineno=35, end_col_offset=15), AnnAssign(target=Name(id='prepared_at', ctx=Store(), lineno=36, col_offset=4, end_lineno=36, end_col_offset=15), annotation=Name(id='str', ctx=Load(), lineno=36, col_offset=17, end_lineno=36, end_col_offset=20), simple=1, lineno=36, col_offset=4, end_lineno=36, end_col_offset=20), AnnAssign(target=Name(id='generator', ctx=Store(), lineno=37, col_offset=4, end_lineno=37, end_col_offset=13), annotation=Name(id='str', ctx=Load(), lineno=37, col_offset=15, end_lineno=37, end_col_offset=18), simple=1, lineno=37, col_offset=4, end_lineno=37, end_col_offset=18)], lineno=30, col_offset=0, end_lineno=37, end_col_offset=18), ClassDef(name='BM25CorpusSummary', bases=[Attribute(value=Name(id='msgspec', ctx=Load(), lineno=40, col_offset=24, end_lineno=40, end_col_offset=31), attr='Struct', ctx=Load(), lineno=40, col_offset=24, end_lineno=40, end_col_offset=38)], keywords=[keyword(arg='frozen', value=Constant(value=True, lineno=40, col_offset=47, end_lineno=40, end_col_offset=51), lineno=40, col_offset=40, end_lineno=40, end_col_offset=51)], body=[Expr(value=Constant(value='Summary information returned after preparing a corpus.', lineno=41, col_offset=4, end_lineno=41, end_col_offset=64), lineno=41, col_offset=4, end_lineno=41, end_col_offset=64), AnnAssign(target=Name(id='doc_count', ctx=Store(), lineno=43, col_offset=4, end_lineno=43, end_col_offset=13), annotation=Name(id='int', ctx=Load(), lineno=43, col_offset=15, end_lineno=43, end_col_offset=18), simple=1, lineno=43, col_offset=4, end_lineno=43, end_col_offset=18), AnnAssign(target=Name(id='output_dir', ctx=Store(), lineno=44, col_offset=4, end_lineno=44, end_col_offset=14), annotation=Name(id='str', ctx=Load(), lineno=44, col_offset=16, end_lineno=44, end_col_offset=19), simple=1, lineno=44, col_offset=4, end_lineno=44, end_col_offset=19), AnnAssign(target=Name(id='digest', ctx=Store(), lineno=45, col_offset=4, end_lineno=45, end_col_offset=10), annotation=Name(id='str', ctx=Load(), lineno=45, col_offset=12, end_lineno=45, end_col_offset=15), simple=1, lineno=45, col_offset=4, end_lineno=45, end_col_offset=15), AnnAssign(target=Name(id='corpus_metadata_path', ctx=Store(), lineno=46, col_offset=4, end_lineno=46, end_col_offset=24), annotation=Name(id='str', ctx=Load(), lineno=46, col_offset=26, end_lineno=46, end_col_offset=29), simple=1, lineno=46, col_offset=4, end_lineno=46, end_col_offset=29)], lineno=40, col_offset=0, end_lineno=46, end_col_offset=29), ClassDef(name='BM25IndexMetadata', bases=[Attribute(value=Name(id='msgspec', ctx=Load(), lineno=49, col_offset=24, end_lineno=49, end_col_offset=31), attr='Struct', ctx=Load(), lineno=49, col_offset=24, end_lineno=49, end_col_offset=38)], keywords=[keyword(arg='frozen', value=Constant(value=True, lineno=49, col_offset=47, end_lineno=49, end_col_offset=51), lineno=49, col_offset=40, end_lineno=49, end_col_offset=51)], body=[Expr(value=Constant(value='Metadata describing a built BM25 index.', lineno=50, col_offset=4, end_lineno=50, end_col_offset=49), lineno=50, col_offset=4, end_lineno=50, end_col_offset=49), AnnAssign(target=Name(id='doc_count', ctx=Store(), lineno=52, col_offset=4, end_lineno=52, end_col_offset=13), annotation=Name(id='int', ctx=Load(), lineno=52, col_offset=15, end_lineno=52, end_col_offset=18), simple=1, lineno=52, col_offset=4, end_lineno=52, end_col_offset=18), AnnAssign(target=Name(id='built_at', ctx=Store(), lineno=53, col_offset=4, end_lineno=53, end_col_offset=12), annotation=Name(id='str', ctx=Load(), lineno=53, col_offset=14, end_lineno=53, end_col_offset=17), simple=1, lineno=53, col_offset=4, end_lineno=53, end_col_offset=17), AnnAssign(target=Name(id='corpus_digest', ctx=Store(), lineno=54, col_offset=4, end_lineno=54, end_col_offset=17), annotation=Name(id='str', ctx=Load(), lineno=54, col_offset=19, end_lineno=54, end_col_offset=22), simple=1, lineno=54, col_offset=4, end_lineno=54, end_col_offset=22), AnnAssign(target=Name(id='corpus_source', ctx=Store(), lineno=55, col_offset=4, end_lineno=55, end_col_offset=17), annotation=Name(id='str', ctx=Load(), lineno=55, col_offset=19, end_lineno=55, end_col_offset=22), simple=1, lineno=55, col_offset=4, end_lineno=55, end_col_offset=22), AnnAssign(target=Name(id='pyserini_version', ctx=Store(), lineno=56, col_offset=4, end_lineno=56, end_col_offset=20), annotation=Name(id='str', ctx=Load(), lineno=56, col_offset=22, end_lineno=56, end_col_offset=25), simple=1, lineno=56, col_offset=4, end_lineno=56, end_col_offset=25), AnnAssign(target=Name(id='threads', ctx=Store(), lineno=57, col_offset=4, end_lineno=57, end_col_offset=11), annotation=Name(id='int', ctx=Load(), lineno=57, col_offset=13, end_lineno=57, end_col_offset=16), simple=1, lineno=57, col_offset=4, end_lineno=57, end_col_offset=16), AnnAssign(target=Name(id='index_dir', ctx=Store(), lineno=58, col_offset=4, end_lineno=58, end_col_offset=13), annotation=Name(id='str', ctx=Load(), lineno=58, col_offset=15, end_lineno=58, end_col_offset=18), simple=1, lineno=58, col_offset=4, end_lineno=58, end_col_offset=18), AnnAssign(target=Name(id='index_size_bytes', ctx=Store(), lineno=59, col_offset=4, end_lineno=59, end_col_offset=20), annotation=Name(id='int', ctx=Load(), lineno=59, col_offset=22, end_lineno=59, end_col_offset=25), simple=1, lineno=59, col_offset=4, end_lineno=59, end_col_offset=25), AnnAssign(target=Name(id='generator', ctx=Store(), lineno=60, col_offset=4, end_lineno=60, end_col_offset=13), annotation=Name(id='str', ctx=Load(), lineno=60, col_offset=15, end_lineno=60, end_col_offset=18), simple=1, lineno=60, col_offset=4, end_lineno=60, end_col_offset=18)], lineno=49, col_offset=0, end_lineno=60, end_col_offset=18), ClassDef(name='BM25BuildOptions', bases=[Attribute(value=Name(id='msgspec', ctx=Load(), lineno=63, col_offset=23, end_lineno=63, end_col_offset=30), attr='Struct', ctx=Load(), lineno=63, col_offset=23, end_lineno=63, end_col_offset=37)], keywords=[keyword(arg='frozen', value=Constant(value=True, lineno=63, col_offset=46, end_lineno=63, end_col_offset=50), lineno=63, col_offset=39, end_lineno=63, end_col_offset=50)], body=[Expr(value=Constant(value='Options controlling BM25 index builds.', lineno=64, col_offset=4, end_lineno=64, end_col_offset=48), lineno=64, col_offset=4, end_lineno=64, end_col_offset=48), AnnAssign(target=Name(id='json_dir', ctx=Store(), lineno=66, col_offset=4, end_lineno=66, end_col_offset=12), annotation=BinOp(left=BinOp(left=Name(id='str', ctx=Load(), lineno=66, col_offset=14, end_lineno=66, end_col_offset=17), op=BitOr(), right=Name(id='Path', ctx=Load(), lineno=66, col_offset=20, end_lineno=66, end_col_offset=24), lineno=66, col_offset=14, end_lineno=66, end_col_offset=24), op=BitOr(), right=Constant(value=None, lineno=66, col_offset=27, end_lineno=66, end_col_offset=31), lineno=66, col_offset=14, end_lineno=66, end_col_offset=31), value=Constant(value=None, lineno=66, col_offset=34, end_lineno=66, end_col_offset=38), simple=1, lineno=66, col_offset=4, end_lineno=66, end_col_offset=38), AnnAssign(target=Name(id='index_dir', ctx=Store(), lineno=67, col_offset=4, end_lineno=67, end_col_offset=13), annotation=BinOp(left=BinOp(left=Name(id='str', ctx=Load(), lineno=67, col_offset=15, end_lineno=67, end_col_offset=18), op=BitOr(), right=Name(id='Path', ctx=Load(), lineno=67, col_offset=21, end_lineno=67, end_col_offset=25), lineno=67, col_offset=15, end_lineno=67, end_col_offset=25), op=BitOr(), right=Constant(value=None, lineno=67, col_offset=28, end_lineno=67, end_col_offset=32), lineno=67, col_offset=15, end_lineno=67, end_col_offset=32), value=Constant(value=None, lineno=67, col_offset=35, end_lineno=67, end_col_offset=39), simple=1, lineno=67, col_offset=4, end_lineno=67, end_col_offset=39), AnnAssign(target=Name(id='threads', ctx=Store(), lineno=68, col_offset=4, end_lineno=68, end_col_offset=11), annotation=BinOp(left=Name(id='int', ctx=Load(), lineno=68, col_offset=13, end_lineno=68, end_col_offset=16), op=BitOr(), right=Constant(value=None, lineno=68, col_offset=19, end_lineno=68, end_col_offset=23), lineno=68, col_offset=13, end_lineno=68, end_col_offset=23), value=Constant(value=None, lineno=68, col_offset=26, end_lineno=68, end_col_offset=30), simple=1, lineno=68, col_offset=4, end_lineno=68, end_col_offset=30), AnnAssign(target=Name(id='overwrite', ctx=Store(), lineno=69, col_offset=4, end_lineno=69, end_col_offset=13), annotation=Name(id='bool', ctx=Load(), lineno=69, col_offset=15, end_lineno=69, end_col_offset=19), value=Constant(value=True, lineno=69, col_offset=22, end_lineno=69, end_col_offset=26), simple=1, lineno=69, col_offset=4, end_lineno=69, end_col_offset=26), AnnAssign(target=Name(id='store_positions', ctx=Store(), lineno=70, col_offset=4, end_lineno=70, end_col_offset=19), annotation=Name(id='bool', ctx=Load(), lineno=70, col_offset=21, end_lineno=70, end_col_offset=25), value=Constant(value=True, lineno=70, col_offset=28, end_lineno=70, end_col_offset=32), simple=1, lineno=70, col_offset=4, end_lineno=70, end_col_offset=32), AnnAssign(target=Name(id='store_docvectors', ctx=Store(), lineno=71, col_offset=4, end_lineno=71, end_col_offset=20), annotation=Name(id='bool', ctx=Load(), lineno=71, col_offset=22, end_lineno=71, end_col_offset=26), value=Constant(value=True, lineno=71, col_offset=29, end_lineno=71, end_col_offset=33), simple=1, lineno=71, col_offset=4, end_lineno=71, end_col_offset=33), AnnAssign(target=Name(id='store_raw', ctx=Store(), lineno=72, col_offset=4, end_lineno=72, end_col_offset=13), annotation=Name(id='bool', ctx=Load(), lineno=72, col_offset=15, end_lineno=72, end_col_offset=19), value=Constant(value=True, lineno=72, col_offset=22, end_lineno=72, end_col_offset=26), simple=1, lineno=72, col_offset=4, end_lineno=72, end_col_offset=26)], lineno=63, col_offset=0, end_lineno=72, end_col_offset=26), ClassDef(name='BM25IndexManager', body=[Expr(value=Constant(value='Manage BM25 corpus preparation and Lucene index builds.', lineno=76, col_offset=4, end_lineno=76, end_col_offset=65), lineno=76, col_offset=4, end_lineno=76, end_col_offset=65), FunctionDef(name='__init__', args=arguments(args=[arg(arg='self', lineno=78, col_offset=17, end_lineno=78, end_col_offset=21), arg(arg='settings', annotation=Name(id='Settings', ctx=Load(), lineno=78, col_offset=33, end_lineno=78, end_col_offset=41), lineno=78, col_offset=23, end_lineno=78, end_col_offset=41)], kwonlyargs=[arg(arg='logger_', annotation=BinOp(left=Attribute(value=Name(id='logging', ctx=Load(), lineno=78, col_offset=55, end_lineno=78, end_col_offset=62), attr='Logger', ctx=Load(), lineno=78, col_offset=55, end_lineno=78, end_col_offset=69), op=BitOr(), right=Constant(value=None, lineno=78, col_offset=72, end_lineno=78, end_col_offset=76), lineno=78, col_offset=55, end_lineno=78, end_col_offset=76), lineno=78, col_offset=46, end_lineno=78, end_col_offset=76)], kw_defaults=[Constant(value=None, lineno=78, col_offset=79, end_lineno=78, end_col_offset=83)]), body=[Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=79, col_offset=8, end_lineno=79, end_col_offset=12), attr='_settings', ctx=Store(), lineno=79, col_offset=8, end_lineno=79, end_col_offset=22)], value=Name(id='settings', ctx=Load(), lineno=79, col_offset=25, end_lineno=79, end_col_offset=33), lineno=79, col_offset=8, end_lineno=79, end_col_offset=33), Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=80, col_offset=8, end_lineno=80, end_col_offset=12), attr='_logger', ctx=Store(), lineno=80, col_offset=8, end_lineno=80, end_col_offset=20)], value=BoolOp(op=Or(), values=[Name(id='logger_', ctx=Load(), lineno=80, col_offset=23, end_lineno=80, end_col_offset=30), Call(func=Attribute(value=Name(id='logging', ctx=Load(), lineno=80, col_offset=34, end_lineno=80, end_col_offset=41), attr='getLogger', ctx=Load(), lineno=80, col_offset=34, end_lineno=80, end_col_offset=51), args=[Name(id='__name__', ctx=Load(), lineno=80, col_offset=52, end_lineno=80, end_col_offset=60)], lineno=80, col_offset=34, end_lineno=80, end_col_offset=61)], lineno=80, col_offset=23, end_lineno=80, end_col_offset=61), lineno=80, col_offset=8, end_lineno=80, end_col_offset=61), Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=81, col_offset=8, end_lineno=81, end_col_offset=12), attr='_repo_root', ctx=Store(), lineno=81, col_offset=8, end_lineno=81, end_col_offset=23)], value=Call(func=Attribute(value=Call(func=Attribute(value=Call(func=Name(id='Path', ctx=Load(), lineno=81, col_offset=26, end_lineno=81, end_col_offset=30), args=[Attribute(value=Attribute(value=Name(id='settings', ctx=Load(), lineno=81, col_offset=31, end_lineno=81, end_col_offset=39), attr='paths', ctx=Load(), lineno=81, col_offset=31, end_lineno=81, end_col_offset=45), attr='repo_root', ctx=Load(), lineno=81, col_offset=31, end_lineno=81, end_col_offset=55)], lineno=81, col_offset=26, end_lineno=81, end_col_offset=56), attr='expanduser', ctx=Load(), lineno=81, col_offset=26, end_lineno=81, end_col_offset=67), lineno=81, col_offset=26, end_lineno=81, end_col_offset=69), attr='resolve', ctx=Load(), lineno=81, col_offset=26, end_lineno=81, end_col_offset=77), lineno=81, col_offset=26, end_lineno=81, end_col_offset=79), lineno=81, col_offset=8, end_lineno=81, end_col_offset=79), Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=82, col_offset=8, end_lineno=82, end_col_offset=12), attr='_config', ctx=Store(), lineno=82, col_offset=8, end_lineno=82, end_col_offset=20)], value=Attribute(value=Name(id='settings', ctx=Load(), lineno=82, col_offset=23, end_lineno=82, end_col_offset=31), attr='bm25', ctx=Load(), lineno=82, col_offset=23, end_lineno=82, end_col_offset=36), lineno=82, col_offset=8, end_lineno=82, end_col_offset=36)], returns=Constant(value=None, lineno=78, col_offset=88, end_lineno=78, end_col_offset=92), lineno=78, col_offset=4, end_lineno=82, end_col_offset=36), FunctionDef(name='corpus_dir', args=arguments(args=[arg(arg='self', lineno=85, col_offset=19, end_lineno=85, end_col_offset=23)]), body=[Expr(value=Constant(value='Return the resolved corpus JsonCollection directory.', lineno=86, col_offset=8, end_lineno=86, end_col_offset=66), lineno=86, col_offset=8, end_lineno=86, end_col_offset=66), Return(value=Call(func=Name(id='resolve_within_repo', ctx=Load(), lineno=87, col_offset=15, end_lineno=87, end_col_offset=34), args=[Attribute(value=Name(id='self', ctx=Load(), lineno=87, col_offset=35, end_lineno=87, end_col_offset=39), attr='_repo_root', ctx=Load(), lineno=87, col_offset=35, end_lineno=87, end_col_offset=50), Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=87, col_offset=52, end_lineno=87, end_col_offset=56), attr='_config', ctx=Load(), lineno=87, col_offset=52, end_lineno=87, end_col_offset=64), attr='corpus_json_dir', ctx=Load(), lineno=87, col_offset=52, end_lineno=87, end_col_offset=80)], lineno=87, col_offset=15, end_lineno=87, end_col_offset=81), lineno=87, col_offset=8, end_lineno=87, end_col_offset=81)], decorator_list=[Name(id='property', ctx=Load(), lineno=84, col_offset=5, end_lineno=84, end_col_offset=13)], returns=Name(id='Path', ctx=Load(), lineno=85, col_offset=28, end_lineno=85, end_col_offset=32), lineno=85, col_offset=4, end_lineno=87, end_col_offset=81), FunctionDef(name='index_dir', args=arguments(args=[arg(arg='self', lineno=90, col_offset=18, end_lineno=90, end_col_offset=22)]), body=[Expr(value=Constant(value='Return the resolved Lucene index directory.', lineno=91, col_offset=8, end_lineno=91, end_col_offset=57), lineno=91, col_offset=8, end_lineno=91, end_col_offset=57), Return(value=Call(func=Name(id='resolve_within_repo', ctx=Load(), lineno=92, col_offset=15, end_lineno=92, end_col_offset=34), args=[Attribute(value=Name(id='self', ctx=Load(), lineno=92, col_offset=35, end_lineno=92, end_col_offset=39), attr='_repo_root', ctx=Load(), lineno=92, col_offset=35, end_lineno=92, end_col_offset=50), Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=92, col_offset=52, end_lineno=92, end_col_offset=56), attr='_config', ctx=Load(), lineno=92, col_offset=52, end_lineno=92, end_col_offset=64), attr='index_dir', ctx=Load(), lineno=92, col_offset=52, end_lineno=92, end_col_offset=74)], lineno=92, col_offset=15, end_lineno=92, end_col_offset=75), lineno=92, col_offset=8, end_lineno=92, end_col_offset=75)], decorator_list=[Name(id='property', ctx=Load(), lineno=89, col_offset=5, end_lineno=89, end_col_offset=13)], returns=Name(id='Path', ctx=Load(), lineno=90, col_offset=27, end_lineno=90, end_col_offset=31), lineno=90, col_offset=4, end_lineno=92, end_col_offset=75), FunctionDef(name='prepare_corpus', args=arguments(args=[arg(arg='self', lineno=95, col_offset=8, end_lineno=95, end_col_offset=12), arg(arg='source', annotation=BinOp(left=Name(id='str', ctx=Load(), lineno=96, col_offset=16, end_lineno=96, end_col_offset=19), op=BitOr(), right=Name(id='Path', ctx=Load(), lineno=96, col_offset=22, end_lineno=96, end_col_offset=26), lineno=96, col_offset=16, end_lineno=96, end_col_offset=26), lineno=96, col_offset=8, end_lineno=96, end_col_offset=26)], kwonlyargs=[arg(arg='output_dir', annotation=BinOp(left=BinOp(left=Name(id='str', ctx=Load(), lineno=98, col_offset=20, end_lineno=98, end_col_offset=23), op=BitOr(), right=Name(id='Path', ctx=Load(), lineno=98, col_offset=26, end_lineno=98, end_col_offset=30), lineno=98, col_offset=20, end_lineno=98, end_col_offset=30), op=BitOr(), right=Constant(value=None, lineno=98, col_offset=33, end_lineno=98, end_col_offset=37), lineno=98, col_offset=20, end_lineno=98, end_col_offset=37), lineno=98, col_offset=8, end_lineno=98, end_col_offset=37), arg(arg='overwrite', annotation=Name(id='bool', ctx=Load(), lineno=99, col_offset=19, end_lineno=99, end_col_offset=23), lineno=99, col_offset=8, end_lineno=99, end_col_offset=23)], kw_defaults=[Constant(value=None, lineno=98, col_offset=40, end_lineno=98, end_col_offset=44), Constant(value=True, lineno=99, col_offset=26, end_lineno=99, end_col_offset=30)]), body=[Expr(value=Constant(value='Materialize a Pyserini JsonCollection directory from a JSONL source.\n\n        Parameters\n        ----------\n        source : str | Path\n            Path to the JSONL corpus containing ``{"id": "...", "contents": ...}`` rows.\n        output_dir : str | Path | None, optional\n            Override the configured JsonCollection directory. If None, uses the\n            default corpus directory from configuration. The directory will be\n            created if it doesn\'t exist. Defaults to None.\n        overwrite : bool, optional\n            When ``True`` (default) existing documents in the output directory are removed.\n\n        Returns\n        -------\n        BM25CorpusSummary\n            Summary describing the prepared corpus and metadata location.\n\n        Raises\n        ------\n        FileNotFoundError\n            If ``source`` does not exist.\n        ValueError\n            If a document is missing required fields or duplicated.\n        FileExistsError\n            If ``overwrite`` is ``False`` and the output directory already contains documents.\n        ', lineno=101, col_offset=8, end_lineno=127, end_col_offset=11), lineno=101, col_offset=8, end_lineno=127, end_col_offset=11), Try(body=[Assign(targets=[Name(id='source_path', ctx=Store(), lineno=129, col_offset=12, end_lineno=129, end_col_offset=23)], value=Call(func=Name(id='resolve_within_repo', ctx=Load(), lineno=129, col_offset=26, end_lineno=129, end_col_offset=45), args=[Attribute(value=Name(id='self', ctx=Load(), lineno=129, col_offset=46, end_lineno=129, end_col_offset=50), attr='_repo_root', ctx=Load(), lineno=129, col_offset=46, end_lineno=129, end_col_offset=61), Name(id='source', ctx=Load(), lineno=129, col_offset=63, end_lineno=129, end_col_offset=69)], keywords=[keyword(arg='allow_nonexistent', value=Constant(value=False, lineno=129, col_offset=89, end_lineno=129, end_col_offset=94), lineno=129, col_offset=71, end_lineno=129, end_col_offset=94)], lineno=129, col_offset=26, end_lineno=129, end_col_offset=95), lineno=129, col_offset=12, end_lineno=129, end_col_offset=95)], handlers=[ExceptHandler(type=Name(id='FileNotFoundError', ctx=Load(), lineno=130, col_offset=15, end_lineno=130, end_col_offset=32), name='exc', body=[Assign(targets=[Name(id='msg', ctx=Store(), lineno=131, col_offset=12, end_lineno=131, end_col_offset=15)], value=JoinedStr(values=[Constant(value='Corpus source ', lineno=131, col_offset=20, end_lineno=131, end_col_offset=34), FormattedValue(value=Name(id='source', ctx=Load(), lineno=131, col_offset=35, end_lineno=131, end_col_offset=41), conversion=-1, lineno=131, col_offset=34, end_lineno=131, end_col_offset=42), Constant(value=' does not exist', lineno=131, col_offset=42, end_lineno=131, end_col_offset=57)], lineno=131, col_offset=18, end_lineno=131, end_col_offset=58), lineno=131, col_offset=12, end_lineno=131, end_col_offset=58), Raise(exc=Call(func=Name(id='FileNotFoundError', ctx=Load(), lineno=132, col_offset=18, end_lineno=132, end_col_offset=35), args=[Name(id='msg', ctx=Load(), lineno=132, col_offset=36, end_lineno=132, end_col_offset=39)], lineno=132, col_offset=18, end_lineno=132, end_col_offset=40), cause=Name(id='exc', ctx=Load(), lineno=132, col_offset=46, end_lineno=132, end_col_offset=49), lineno=132, col_offset=12, end_lineno=132, end_col_offset=49)], lineno=130, col_offset=8, end_lineno=132, end_col_offset=49)], lineno=128, col_offset=8, end_lineno=132, end_col_offset=49), Assign(targets=[Name(id='json_dir', ctx=Store(), lineno=133, col_offset=8, end_lineno=133, end_col_offset=16)], value=IfExp(test=Compare(left=Name(id='output_dir', ctx=Load(), lineno=135, col_offset=15, end_lineno=135, end_col_offset=25), ops=[IsNot()], comparators=[Constant(value=None, lineno=135, col_offset=33, end_lineno=135, end_col_offset=37)], lineno=135, col_offset=15, end_lineno=135, end_col_offset=37), body=Call(func=Name(id='resolve_within_repo', ctx=Load(), lineno=134, col_offset=12, end_lineno=134, end_col_offset=31), args=[Attribute(value=Name(id='self', ctx=Load(), lineno=134, col_offset=32, end_lineno=134, end_col_offset=36), attr='_repo_root', ctx=Load(), lineno=134, col_offset=32, end_lineno=134, end_col_offset=47), Name(id='output_dir', ctx=Load(), lineno=134, col_offset=49, end_lineno=134, end_col_offset=59)], lineno=134, col_offset=12, end_lineno=134, end_col_offset=60), orelse=Attribute(value=Name(id='self', ctx=Load(), lineno=136, col_offset=17, end_lineno=136, end_col_offset=21), attr='corpus_dir', ctx=Load(), lineno=136, col_offset=17, end_lineno=136, end_col_offset=32), lineno=134, col_offset=12, end_lineno=136, end_col_offset=32), lineno=133, col_offset=8, end_lineno=137, end_col_offset=9), Expr(value=Call(func=Attribute(value=Name(id='json_dir', ctx=Load(), lineno=138, col_offset=8, end_lineno=138, end_col_offset=16), attr='mkdir', ctx=Load(), lineno=138, col_offset=8, end_lineno=138, end_col_offset=22), keywords=[keyword(arg='parents', value=Constant(value=True, lineno=138, col_offset=31, end_lineno=138, end_col_offset=35), lineno=138, col_offset=23, end_lineno=138, end_col_offset=35), keyword(arg='exist_ok', value=Constant(value=True, lineno=138, col_offset=46, end_lineno=138, end_col_offset=50), lineno=138, col_offset=37, end_lineno=138, end_col_offset=50)], lineno=138, col_offset=8, end_lineno=138, end_col_offset=51), lineno=138, col_offset=8, end_lineno=138, end_col_offset=51), If(test=Name(id='overwrite', ctx=Load(), lineno=140, col_offset=11, end_lineno=140, end_col_offset=20), body=[For(target=Name(id='existing', ctx=Store(), lineno=141, col_offset=16, end_lineno=141, end_col_offset=24), iter=Call(func=Attribute(value=Name(id='json_dir', ctx=Load(), lineno=141, col_offset=28, end_lineno=141, end_col_offset=36), attr='glob', ctx=Load(), lineno=141, col_offset=28, end_lineno=141, end_col_offset=41), args=[Constant(value='*.json', lineno=141, col_offset=42, end_lineno=141, end_col_offset=50)], lineno=141, col_offset=28, end_lineno=141, end_col_offset=51), body=[Expr(value=Call(func=Attribute(value=Name(id='existing', ctx=Load(), lineno=142, col_offset=16, end_lineno=142, end_col_offset=24), attr='unlink', ctx=Load(), lineno=142, col_offset=16, end_lineno=142, end_col_offset=31), lineno=142, col_offset=16, end_lineno=142, end_col_offset=33), lineno=142, col_offset=16, end_lineno=142, end_col_offset=33)], lineno=141, col_offset=12, end_lineno=142, end_col_offset=33)], orelse=[Assign(targets=[Name(id='existing_docs', ctx=Store(), lineno=144, col_offset=12, end_lineno=144, end_col_offset=25)], value=Call(func=Name(id='list', ctx=Load(), lineno=144, col_offset=28, end_lineno=144, end_col_offset=32), args=[Call(func=Attribute(value=Name(id='json_dir', ctx=Load(), lineno=144, col_offset=33, end_lineno=144, end_col_offset=41), attr='glob', ctx=Load(), lineno=144, col_offset=33, end_lineno=144, end_col_offset=46), args=[Constant(value='*.json', lineno=144, col_offset=47, end_lineno=144, end_col_offset=55)], lineno=144, col_offset=33, end_lineno=144, end_col_offset=56)], lineno=144, col_offset=28, end_lineno=144, end_col_offset=57), lineno=144, col_offset=12, end_lineno=144, end_col_offset=57), If(test=Name(id='existing_docs', ctx=Load(), lineno=145, col_offset=15, end_lineno=145, end_col_offset=28), body=[Assign(targets=[Name(id='msg', ctx=Store(), lineno=146, col_offset=16, end_lineno=146, end_col_offset=19)], value=JoinedStr(values=[Constant(value='Corpus directory ', lineno=146, col_offset=24, end_lineno=146, end_col_offset=41), FormattedValue(value=Name(id='json_dir', ctx=Load(), lineno=146, col_offset=42, end_lineno=146, end_col_offset=50), conversion=-1, lineno=146, col_offset=41, end_lineno=146, end_col_offset=51), Constant(value=' is not empty', lineno=146, col_offset=51, end_lineno=146, end_col_offset=64)], lineno=146, col_offset=22, end_lineno=146, end_col_offset=65), lineno=146, col_offset=16, end_lineno=146, end_col_offset=65), Raise(exc=Call(func=Name(id='FileExistsError', ctx=Load(), lineno=147, col_offset=22, end_lineno=147, end_col_offset=37), args=[Name(id='msg', ctx=Load(), lineno=147, col_offset=38, end_lineno=147, end_col_offset=41)], lineno=147, col_offset=22, end_lineno=147, end_col_offset=42), lineno=147, col_offset=16, end_lineno=147, end_col_offset=42)], lineno=145, col_offset=12, end_lineno=147, end_col_offset=42)], lineno=140, col_offset=8, end_lineno=147, end_col_offset=42), Assign(targets=[Name(id='doc_count', ctx=Store(), lineno=149, col_offset=8, end_lineno=149, end_col_offset=17)], value=Constant(value=0, lineno=149, col_offset=20, end_lineno=149, end_col_offset=21), lineno=149, col_offset=8, end_lineno=149, end_col_offset=21), Assign(targets=[Name(id='digest', ctx=Store(), lineno=150, col_offset=8, end_lineno=150, end_col_offset=14)], value=Call(func=Name(id='sha256', ctx=Load(), lineno=150, col_offset=17, end_lineno=150, end_col_offset=23), lineno=150, col_offset=17, end_lineno=150, end_col_offset=25), lineno=150, col_offset=8, end_lineno=150, end_col_offset=25), AnnAssign(target=Name(id='seen_ids', ctx=Store(), lineno=151, col_offset=8, end_lineno=151, end_col_offset=16), annotation=Subscript(value=Name(id='set', ctx=Load(), lineno=151, col_offset=18, end_lineno=151, end_col_offset=21), slice=Name(id='str', ctx=Load(), lineno=151, col_offset=22, end_lineno=151, end_col_offset=25), ctx=Load(), lineno=151, col_offset=18, end_lineno=151, end_col_offset=26), value=Call(func=Name(id='set', ctx=Load(), lineno=151, col_offset=29, end_lineno=151, end_col_offset=32), lineno=151, col_offset=29, end_lineno=151, end_col_offset=34), simple=1, lineno=151, col_offset=8, end_lineno=151, end_col_offset=34), With(items=[withitem(context_expr=Call(func=Attribute(value=Name(id='source_path', ctx=Load(), lineno=153, col_offset=13, end_lineno=153, end_col_offset=24), attr='open', ctx=Load(), lineno=153, col_offset=13, end_lineno=153, end_col_offset=29), args=[Constant(value='r', lineno=153, col_offset=30, end_lineno=153, end_col_offset=33)], keywords=[keyword(arg='encoding', value=Constant(value='utf-8', lineno=153, col_offset=44, end_lineno=153, end_col_offset=51), lineno=153, col_offset=35, end_lineno=153, end_col_offset=51)], lineno=153, col_offset=13, end_lineno=153, end_col_offset=52), optional_vars=Name(id='handle', ctx=Store(), lineno=153, col_offset=56, end_lineno=153, end_col_offset=62))], body=[For(target=Tuple(elts=[Name(id='line_number', ctx=Store(), lineno=154, col_offset=16, end_lineno=154, end_col_offset=27), Name(id='raw_line', ctx=Store(), lineno=154, col_offset=29, end_lineno=154, end_col_offset=37)], ctx=Store(), lineno=154, col_offset=16, end_lineno=154, end_col_offset=37), iter=Call(func=Name(id='enumerate', ctx=Load(), lineno=154, col_offset=41, end_lineno=154, end_col_offset=50), args=[Name(id='handle', ctx=Load(), lineno=154, col_offset=51, end_lineno=154, end_col_offset=57)], keywords=[keyword(arg='start', value=Constant(value=1, lineno=154, col_offset=65, end_lineno=154, end_col_offset=66), lineno=154, col_offset=59, end_lineno=154, end_col_offset=66)], lineno=154, col_offset=41, end_lineno=154, end_col_offset=67), body=[Try(body=[Assign(targets=[Name(id='parsed', ctx=Store(), lineno=156, col_offset=20, end_lineno=156, end_col_offset=26)], value=Call(func=Name(id='_parse_corpus_line', ctx=Load(), lineno=156, col_offset=29, end_lineno=156, end_col_offset=47), args=[Name(id='raw_line', ctx=Load(), lineno=157, col_offset=24, end_lineno=157, end_col_offset=32)], keywords=[keyword(arg='line_number', value=Name(id='line_number', ctx=Load(), lineno=158, col_offset=36, end_lineno=158, end_col_offset=47), lineno=158, col_offset=24, end_lineno=158, end_col_offset=47), keyword(arg='seen_ids', value=Name(id='seen_ids', ctx=Load(), lineno=159, col_offset=33, end_lineno=159, end_col_offset=41), lineno=159, col_offset=24, end_lineno=159, end_col_offset=41), keyword(arg='source_path', value=Name(id='source_path', ctx=Load(), lineno=160, col_offset=36, end_lineno=160, end_col_offset=47), lineno=160, col_offset=24, end_lineno=160, end_col_offset=47)], lineno=156, col_offset=29, end_lineno=161, end_col_offset=21), lineno=156, col_offset=20, end_lineno=161, end_col_offset=21)], handlers=[ExceptHandler(type=Name(id='ValueError', ctx=Load(), lineno=162, col_offset=23, end_lineno=162, end_col_offset=33), name='exc', body=[Raise(exc=Call(func=Name(id='ValueError', ctx=Load(), lineno=163, col_offset=26, end_lineno=163, end_col_offset=36), args=[Call(func=Name(id='str', ctx=Load(), lineno=163, col_offset=37, end_lineno=163, end_col_offset=40), args=[Name(id='exc', ctx=Load(), lineno=163, col_offset=41, end_lineno=163, end_col_offset=44)], lineno=163, col_offset=37, end_lineno=163, end_col_offset=45)], lineno=163, col_offset=26, end_lineno=163, end_col_offset=46), cause=Name(id='exc', ctx=Load(), lineno=163, col_offset=52, end_lineno=163, end_col_offset=55), lineno=163, col_offset=20, end_lineno=163, end_col_offset=55)], lineno=162, col_offset=16, end_lineno=163, end_col_offset=55)], lineno=155, col_offset=16, end_lineno=163, end_col_offset=55), If(test=Compare(left=Name(id='parsed', ctx=Load(), lineno=164, col_offset=19, end_lineno=164, end_col_offset=25), ops=[Is()], comparators=[Constant(value=None, lineno=164, col_offset=29, end_lineno=164, end_col_offset=33)], lineno=164, col_offset=19, end_lineno=164, end_col_offset=33), body=[Continue(lineno=165, col_offset=20, end_lineno=165, end_col_offset=28)], lineno=164, col_offset=16, end_lineno=165, end_col_offset=28), Assign(targets=[Tuple(elts=[Name(id='doc_id_str', ctx=Store(), lineno=166, col_offset=16, end_lineno=166, end_col_offset=26), Name(id='contents', ctx=Store(), lineno=166, col_offset=28, end_lineno=166, end_col_offset=36)], ctx=Store(), lineno=166, col_offset=16, end_lineno=166, end_col_offset=36)], value=Name(id='parsed', ctx=Load(), lineno=166, col_offset=39, end_lineno=166, end_col_offset=45), lineno=166, col_offset=16, end_lineno=166, end_col_offset=45), Expr(value=Call(func=Attribute(value=Name(id='digest', ctx=Load(), lineno=168, col_offset=16, end_lineno=168, end_col_offset=22), attr='update', ctx=Load(), lineno=168, col_offset=16, end_lineno=168, end_col_offset=29), args=[Call(func=Attribute(value=Name(id='doc_id_str', ctx=Load(), lineno=168, col_offset=30, end_lineno=168, end_col_offset=40), attr='encode', ctx=Load(), lineno=168, col_offset=30, end_lineno=168, end_col_offset=47), args=[Constant(value='utf-8', lineno=168, col_offset=48, end_lineno=168, end_col_offset=55)], lineno=168, col_offset=30, end_lineno=168, end_col_offset=56)], lineno=168, col_offset=16, end_lineno=168, end_col_offset=57), lineno=168, col_offset=16, end_lineno=168, end_col_offset=57), Expr(value=Call(func=Attribute(value=Name(id='digest', ctx=Load(), lineno=169, col_offset=16, end_lineno=169, end_col_offset=22), attr='update', ctx=Load(), lineno=169, col_offset=16, end_lineno=169, end_col_offset=29), args=[Constant(value=b'\x1f', lineno=169, col_offset=30, end_lineno=169, end_col_offset=37)], lineno=169, col_offset=16, end_lineno=169, end_col_offset=38), lineno=169, col_offset=16, end_lineno=169, end_col_offset=38), Expr(value=Call(func=Attribute(value=Name(id='digest', ctx=Load(), lineno=170, col_offset=16, end_lineno=170, end_col_offset=22), attr='update', ctx=Load(), lineno=170, col_offset=16, end_lineno=170, end_col_offset=29), args=[Call(func=Attribute(value=Name(id='contents', ctx=Load(), lineno=170, col_offset=30, end_lineno=170, end_col_offset=38), attr='encode', ctx=Load(), lineno=170, col_offset=30, end_lineno=170, end_col_offset=45), args=[Constant(value='utf-8', lineno=170, col_offset=46, end_lineno=170, end_col_offset=53)], lineno=170, col_offset=30, end_lineno=170, end_col_offset=54)], lineno=170, col_offset=16, end_lineno=170, end_col_offset=55), lineno=170, col_offset=16, end_lineno=170, end_col_offset=55), Expr(value=Call(func=Attribute(value=Name(id='digest', ctx=Load(), lineno=171, col_offset=16, end_lineno=171, end_col_offset=22), attr='update', ctx=Load(), lineno=171, col_offset=16, end_lineno=171, end_col_offset=29), args=[Constant(value=b'\x1e', lineno=171, col_offset=30, end_lineno=171, end_col_offset=37)], lineno=171, col_offset=16, end_lineno=171, end_col_offset=38), lineno=171, col_offset=16, end_lineno=171, end_col_offset=38), With(items=[withitem(context_expr=Call(func=Attribute(value=BinOp(left=Name(id='json_dir', ctx=Load(), lineno=173, col_offset=22, end_lineno=173, end_col_offset=30), op=Div(), right=JoinedStr(values=[FormattedValue(value=Name(id='doc_id_str', ctx=Load(), lineno=173, col_offset=36, end_lineno=173, end_col_offset=46), conversion=-1, lineno=173, col_offset=35, end_lineno=173, end_col_offset=47), Constant(value='.json', lineno=173, col_offset=47, end_lineno=173, end_col_offset=52)], lineno=173, col_offset=33, end_lineno=173, end_col_offset=53), lineno=173, col_offset=22, end_lineno=173, end_col_offset=53), attr='open', ctx=Load(), lineno=173, col_offset=21, end_lineno=173, end_col_offset=59), args=[Constant(value='w', lineno=173, col_offset=60, end_lineno=173, end_col_offset=63)], keywords=[keyword(arg='encoding', value=Constant(value='utf-8', lineno=173, col_offset=74, end_lineno=173, end_col_offset=81), lineno=173, col_offset=65, end_lineno=173, end_col_offset=81)], lineno=173, col_offset=21, end_lineno=173, end_col_offset=82), optional_vars=Name(id='out_handle', ctx=Store(), lineno=173, col_offset=86, end_lineno=173, end_col_offset=96))], body=[Expr(value=Call(func=Attribute(value=Name(id='json', ctx=Load(), lineno=174, col_offset=20, end_lineno=174, end_col_offset=24), attr='dump', ctx=Load(), lineno=174, col_offset=20, end_lineno=174, end_col_offset=29), args=[Dict(keys=[Constant(value='id', lineno=175, col_offset=25, end_lineno=175, end_col_offset=29), Constant(value='contents', lineno=175, col_offset=43, end_lineno=175, end_col_offset=53)], values=[Name(id='doc_id_str', ctx=Load(), lineno=175, col_offset=31, end_lineno=175, end_col_offset=41), Name(id='contents', ctx=Load(), lineno=175, col_offset=55, end_lineno=175, end_col_offset=63)], lineno=175, col_offset=24, end_lineno=175, end_col_offset=64), Name(id='out_handle', ctx=Load(), lineno=176, col_offset=24, end_lineno=176, end_col_offset=34)], keywords=[keyword(arg='ensure_ascii', value=Constant(value=False, lineno=177, col_offset=37, end_lineno=177, end_col_offset=42), lineno=177, col_offset=24, end_lineno=177, end_col_offset=42)], lineno=174, col_offset=20, end_lineno=178, end_col_offset=21), lineno=174, col_offset=20, end_lineno=178, end_col_offset=21)], lineno=173, col_offset=16, end_lineno=178, end_col_offset=21), AugAssign(target=Name(id='doc_count', ctx=Store(), lineno=179, col_offset=16, end_lineno=179, end_col_offset=25), op=Add(), value=Constant(value=1, lineno=179, col_offset=29, end_lineno=179, end_col_offset=30), lineno=179, col_offset=16, end_lineno=179, end_col_offset=30)], lineno=154, col_offset=12, end_lineno=179, end_col_offset=30)], lineno=153, col_offset=8, end_lineno=179, end_col_offset=30), Assign(targets=[Name(id='prepared_at', ctx=Store(), lineno=181, col_offset=8, end_lineno=181, end_col_offset=19)], value=Call(func=Attribute(value=Call(func=Attribute(value=Name(id='datetime', ctx=Load(), lineno=181, col_offset=22, end_lineno=181, end_col_offset=30), attr='now', ctx=Load(), lineno=181, col_offset=22, end_lineno=181, end_col_offset=34), args=[Name(id='UTC', ctx=Load(), lineno=181, col_offset=35, end_lineno=181, end_col_offset=38)], lineno=181, col_offset=22, end_lineno=181, end_col_offset=39), attr='isoformat', ctx=Load(), lineno=181, col_offset=22, end_lineno=181, end_col_offset=49), lineno=181, col_offset=22, end_lineno=181, end_col_offset=51), lineno=181, col_offset=8, end_lineno=181, end_col_offset=51), Assign(targets=[Name(id='corpus_metadata', ctx=Store(), lineno=182, col_offset=8, end_lineno=182, end_col_offset=23)], value=Call(func=Name(id='BM25CorpusMetadata', ctx=Load(), lineno=182, col_offset=26, end_lineno=182, end_col_offset=44), keywords=[keyword(arg='doc_count', value=Name(id='doc_count', ctx=Load(), lineno=183, col_offset=22, end_lineno=183, end_col_offset=31), lineno=183, col_offset=12, end_lineno=183, end_col_offset=31), keyword(arg='source_path', value=Call(func=Name(id='str', ctx=Load(), lineno=184, col_offset=24, end_lineno=184, end_col_offset=27), args=[Name(id='source_path', ctx=Load(), lineno=184, col_offset=28, end_lineno=184, end_col_offset=39)], lineno=184, col_offset=24, end_lineno=184, end_col_offset=40), lineno=184, col_offset=12, end_lineno=184, end_col_offset=40), keyword(arg='digest', value=Call(func=Attribute(value=Name(id='digest', ctx=Load(), lineno=185, col_offset=19, end_lineno=185, end_col_offset=25), attr='hexdigest', ctx=Load(), lineno=185, col_offset=19, end_lineno=185, end_col_offset=35), lineno=185, col_offset=19, end_lineno=185, end_col_offset=37), lineno=185, col_offset=12, end_lineno=185, end_col_offset=37), keyword(arg='prepared_at', value=Name(id='prepared_at', ctx=Load(), lineno=186, col_offset=24, end_lineno=186, end_col_offset=35), lineno=186, col_offset=12, end_lineno=186, end_col_offset=35), keyword(arg='generator', value=Name(id='GENERATOR_NAME', ctx=Load(), lineno=187, col_offset=22, end_lineno=187, end_col_offset=36), lineno=187, col_offset=12, end_lineno=187, end_col_offset=36)], lineno=182, col_offset=26, end_lineno=188, end_col_offset=9), lineno=182, col_offset=8, end_lineno=188, end_col_offset=9), Assign(targets=[Name(id='metadata_path', ctx=Store(), lineno=189, col_offset=8, end_lineno=189, end_col_offset=21)], value=BinOp(left=Name(id='json_dir', ctx=Load(), lineno=189, col_offset=24, end_lineno=189, end_col_offset=32), op=Div(), right=Name(id='CORPUS_METADATA_FILENAME', ctx=Load(), lineno=189, col_offset=35, end_lineno=189, end_col_offset=59), lineno=189, col_offset=24, end_lineno=189, end_col_offset=59), lineno=189, col_offset=8, end_lineno=189, end_col_offset=59), Expr(value=Call(func=Name(id='_write_struct', ctx=Load(), lineno=190, col_offset=8, end_lineno=190, end_col_offset=21), args=[Name(id='metadata_path', ctx=Load(), lineno=190, col_offset=22, end_lineno=190, end_col_offset=35), Name(id='corpus_metadata', ctx=Load(), lineno=190, col_offset=37, end_lineno=190, end_col_offset=52)], lineno=190, col_offset=8, end_lineno=190, end_col_offset=53), lineno=190, col_offset=8, end_lineno=190, end_col_offset=53), Expr(value=Call(func=Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=192, col_offset=8, end_lineno=192, end_col_offset=12), attr='_logger', ctx=Load(), lineno=192, col_offset=8, end_lineno=192, end_col_offset=20), attr='info', ctx=Load(), lineno=192, col_offset=8, end_lineno=192, end_col_offset=25), args=[Constant(value='Prepared BM25 corpus at %s (docs=%s, digest=%s)', lineno=193, col_offset=12, end_lineno=193, end_col_offset=61), Name(id='json_dir', ctx=Load(), lineno=194, col_offset=12, end_lineno=194, end_col_offset=20), Name(id='doc_count', ctx=Load(), lineno=195, col_offset=12, end_lineno=195, end_col_offset=21), Attribute(value=Name(id='corpus_metadata', ctx=Load(), lineno=196, col_offset=12, end_lineno=196, end_col_offset=27), attr='digest', ctx=Load(), lineno=196, col_offset=12, end_lineno=196, end_col_offset=34)], lineno=192, col_offset=8, end_lineno=197, end_col_offset=9), lineno=192, col_offset=8, end_lineno=197, end_col_offset=9), Return(value=Call(func=Name(id='BM25CorpusSummary', ctx=Load(), lineno=199, col_offset=15, end_lineno=199, end_col_offset=32), keywords=[keyword(arg='doc_count', value=Name(id='doc_count', ctx=Load(), lineno=200, col_offset=22, end_lineno=200, end_col_offset=31), lineno=200, col_offset=12, end_lineno=200, end_col_offset=31), keyword(arg='output_dir', value=Call(func=Name(id='str', ctx=Load(), lineno=201, col_offset=23, end_lineno=201, end_col_offset=26), args=[Name(id='json_dir', ctx=Load(), lineno=201, col_offset=27, end_lineno=201, end_col_offset=35)], lineno=201, col_offset=23, end_lineno=201, end_col_offset=36), lineno=201, col_offset=12, end_lineno=201, end_col_offset=36), keyword(arg='digest', value=Attribute(value=Name(id='corpus_metadata', ctx=Load(), lineno=202, col_offset=19, end_lineno=202, end_col_offset=34), attr='digest', ctx=Load(), lineno=202, col_offset=19, end_lineno=202, end_col_offset=41), lineno=202, col_offset=12, end_lineno=202, end_col_offset=41), keyword(arg='corpus_metadata_path', value=Call(func=Name(id='str', ctx=Load(), lineno=203, col_offset=33, end_lineno=203, end_col_offset=36), args=[Name(id='metadata_path', ctx=Load(), lineno=203, col_offset=37, end_lineno=203, end_col_offset=50)], lineno=203, col_offset=33, end_lineno=203, end_col_offset=51), lineno=203, col_offset=12, end_lineno=203, end_col_offset=51)], lineno=199, col_offset=15, end_lineno=204, end_col_offset=9), lineno=199, col_offset=8, end_lineno=204, end_col_offset=9)], returns=Name(id='BM25CorpusSummary', ctx=Load(), lineno=100, col_offset=9, end_lineno=100, end_col_offset=26), lineno=94, col_offset=4, end_lineno=204, end_col_offset=9), FunctionDef(name='build_index', args=arguments(args=[arg(arg='self', lineno=206, col_offset=20, end_lineno=206, end_col_offset=24), arg(arg='options', annotation=BinOp(left=Name(id='BM25BuildOptions', ctx=Load(), lineno=206, col_offset=35, end_lineno=206, end_col_offset=51), op=BitOr(), right=Constant(value=None, lineno=206, col_offset=54, end_lineno=206, end_col_offset=58), lineno=206, col_offset=35, end_lineno=206, end_col_offset=58), lineno=206, col_offset=26, end_lineno=206, end_col_offset=58)], defaults=[Constant(value=None, lineno=206, col_offset=61, end_lineno=206, end_col_offset=65)]), body=[Expr(value=Constant(value='Invoke Pyserini to build a Lucene BM25 index.\n\n        Parameters\n        ----------\n        options : BM25BuildOptions | None, optional\n            Build options. When omitted, defaults from configuration are used.\n\n        Returns\n        -------\n        BM25IndexMetadata\n            Structured metadata describing the resulting Lucene index.\n\n        Raises\n        ------\n        FileNotFoundError\n            If the JsonCollection directory does not exist.\n        FileExistsError\n            If ``overwrite`` is ``False`` and the index directory already contains data.\n        ', lineno=207, col_offset=8, end_lineno=225, end_col_offset=11), lineno=207, col_offset=8, end_lineno=225, end_col_offset=11), Assign(targets=[Name(id='opts', ctx=Store(), lineno=226, col_offset=8, end_lineno=226, end_col_offset=12)], value=BoolOp(op=Or(), values=[Name(id='options', ctx=Load(), lineno=226, col_offset=15, end_lineno=226, end_col_offset=22), Call(func=Name(id='BM25BuildOptions', ctx=Load(), lineno=226, col_offset=26, end_lineno=226, end_col_offset=42), lineno=226, col_offset=26, end_lineno=226, end_col_offset=44)], lineno=226, col_offset=15, end_lineno=226, end_col_offset=44), lineno=226, col_offset=8, end_lineno=226, end_col_offset=44), Assign(targets=[Name(id='resolved_json_dir', ctx=Store(), lineno=227, col_offset=8, end_lineno=227, end_col_offset=25)], value=IfExp(test=Compare(left=Attribute(value=Name(id='opts', ctx=Load(), lineno=229, col_offset=15, end_lineno=229, end_col_offset=19), attr='json_dir', ctx=Load(), lineno=229, col_offset=15, end_lineno=229, end_col_offset=28), ops=[IsNot()], comparators=[Constant(value=None, lineno=229, col_offset=36, end_lineno=229, end_col_offset=40)], lineno=229, col_offset=15, end_lineno=229, end_col_offset=40), body=Call(func=Name(id='resolve_within_repo', ctx=Load(), lineno=228, col_offset=12, end_lineno=228, end_col_offset=31), args=[Attribute(value=Name(id='self', ctx=Load(), lineno=228, col_offset=32, end_lineno=228, end_col_offset=36), attr='_repo_root', ctx=Load(), lineno=228, col_offset=32, end_lineno=228, end_col_offset=47), Attribute(value=Name(id='opts', ctx=Load(), lineno=228, col_offset=49, end_lineno=228, end_col_offset=53), attr='json_dir', ctx=Load(), lineno=228, col_offset=49, end_lineno=228, end_col_offset=62)], lineno=228, col_offset=12, end_lineno=228, end_col_offset=63), orelse=Attribute(value=Name(id='self', ctx=Load(), lineno=230, col_offset=17, end_lineno=230, end_col_offset=21), attr='corpus_dir', ctx=Load(), lineno=230, col_offset=17, end_lineno=230, end_col_offset=32), lineno=228, col_offset=12, end_lineno=230, end_col_offset=32), lineno=227, col_offset=8, end_lineno=231, end_col_offset=9), Assign(targets=[Name(id='resolved_index_dir', ctx=Store(), lineno=232, col_offset=8, end_lineno=232, end_col_offset=26)], value=IfExp(test=Compare(left=Attribute(value=Name(id='opts', ctx=Load(), lineno=234, col_offset=15, end_lineno=234, end_col_offset=19), attr='index_dir', ctx=Load(), lineno=234, col_offset=15, end_lineno=234, end_col_offset=29), ops=[IsNot()], comparators=[Constant(value=None, lineno=234, col_offset=37, end_lineno=234, end_col_offset=41)], lineno=234, col_offset=15, end_lineno=234, end_col_offset=41), body=Call(func=Name(id='resolve_within_repo', ctx=Load(), lineno=233, col_offset=12, end_lineno=233, end_col_offset=31), args=[Attribute(value=Name(id='self', ctx=Load(), lineno=233, col_offset=32, end_lineno=233, end_col_offset=36), attr='_repo_root', ctx=Load(), lineno=233, col_offset=32, end_lineno=233, end_col_offset=47), Attribute(value=Name(id='opts', ctx=Load(), lineno=233, col_offset=49, end_lineno=233, end_col_offset=53), attr='index_dir', ctx=Load(), lineno=233, col_offset=49, end_lineno=233, end_col_offset=63)], lineno=233, col_offset=12, end_lineno=233, end_col_offset=64), orelse=Attribute(value=Name(id='self', ctx=Load(), lineno=235, col_offset=17, end_lineno=235, end_col_offset=21), attr='index_dir', ctx=Load(), lineno=235, col_offset=17, end_lineno=235, end_col_offset=31), lineno=233, col_offset=12, end_lineno=235, end_col_offset=31), lineno=232, col_offset=8, end_lineno=236, end_col_offset=9), Expr(value=Call(func=Attribute(value=Name(id='resolved_json_dir', ctx=Load(), lineno=237, col_offset=8, end_lineno=237, end_col_offset=25), attr='mkdir', ctx=Load(), lineno=237, col_offset=8, end_lineno=237, end_col_offset=31), keywords=[keyword(arg='parents', value=Constant(value=True, lineno=237, col_offset=40, end_lineno=237, end_col_offset=44), lineno=237, col_offset=32, end_lineno=237, end_col_offset=44), keyword(arg='exist_ok', value=Constant(value=True, lineno=237, col_offset=55, end_lineno=237, end_col_offset=59), lineno=237, col_offset=46, end_lineno=237, end_col_offset=59)], lineno=237, col_offset=8, end_lineno=237, end_col_offset=60), lineno=237, col_offset=8, end_lineno=237, end_col_offset=60), If(test=UnaryOp(op=Not(), operand=Call(func=Attribute(value=Name(id='resolved_json_dir', ctx=Load(), lineno=238, col_offset=15, end_lineno=238, end_col_offset=32), attr='exists', ctx=Load(), lineno=238, col_offset=15, end_lineno=238, end_col_offset=39), lineno=238, col_offset=15, end_lineno=238, end_col_offset=41), lineno=238, col_offset=11, end_lineno=238, end_col_offset=41), body=[Assign(targets=[Name(id='msg', ctx=Store(), lineno=239, col_offset=12, end_lineno=239, end_col_offset=15)], value=JoinedStr(values=[Constant(value='JsonCollection directory ', lineno=239, col_offset=20, end_lineno=239, end_col_offset=45), FormattedValue(value=Name(id='resolved_json_dir', ctx=Load(), lineno=239, col_offset=46, end_lineno=239, end_col_offset=63), conversion=-1, lineno=239, col_offset=45, end_lineno=239, end_col_offset=64), Constant(value=' does not exist', lineno=239, col_offset=64, end_lineno=239, end_col_offset=79)], lineno=239, col_offset=18, end_lineno=239, end_col_offset=80), lineno=239, col_offset=12, end_lineno=239, end_col_offset=80), Raise(exc=Call(func=Name(id='FileNotFoundError', ctx=Load(), lineno=240, col_offset=18, end_lineno=240, end_col_offset=35), args=[Name(id='msg', ctx=Load(), lineno=240, col_offset=36, end_lineno=240, end_col_offset=39)], lineno=240, col_offset=18, end_lineno=240, end_col_offset=40), lineno=240, col_offset=12, end_lineno=240, end_col_offset=40)], lineno=238, col_offset=8, end_lineno=240, end_col_offset=40), If(test=Call(func=Attribute(value=Name(id='resolved_index_dir', ctx=Load(), lineno=242, col_offset=11, end_lineno=242, end_col_offset=29), attr='exists', ctx=Load(), lineno=242, col_offset=11, end_lineno=242, end_col_offset=36), lineno=242, col_offset=11, end_lineno=242, end_col_offset=38), body=[Assign(targets=[Name(id='has_contents', ctx=Store(), lineno=243, col_offset=12, end_lineno=243, end_col_offset=24)], value=Call(func=Name(id='any', ctx=Load(), lineno=243, col_offset=27, end_lineno=243, end_col_offset=30), args=[Call(func=Attribute(value=Name(id='resolved_index_dir', ctx=Load(), lineno=243, col_offset=31, end_lineno=243, end_col_offset=49), attr='iterdir', ctx=Load(), lineno=243, col_offset=31, end_lineno=243, end_col_offset=57), lineno=243, col_offset=31, end_lineno=243, end_col_offset=59)], lineno=243, col_offset=27, end_lineno=243, end_col_offset=60), lineno=243, col_offset=12, end_lineno=243, end_col_offset=60), If(test=BoolOp(op=And(), values=[Name(id='has_contents', ctx=Load(), lineno=244, col_offset=15, end_lineno=244, end_col_offset=27), UnaryOp(op=Not(), operand=Attribute(value=Name(id='opts', ctx=Load(), lineno=244, col_offset=36, end_lineno=244, end_col_offset=40), attr='overwrite', ctx=Load(), lineno=244, col_offset=36, end_lineno=244, end_col_offset=50), lineno=244, col_offset=32, end_lineno=244, end_col_offset=50)], lineno=244, col_offset=15, end_lineno=244, end_col_offset=50), body=[Assign(targets=[Name(id='msg', ctx=Store(), lineno=245, col_offset=16, end_lineno=245, end_col_offset=19)], value=JoinedStr(values=[Constant(value='Index directory ', lineno=245, col_offset=24, end_lineno=245, end_col_offset=40), FormattedValue(value=Name(id='resolved_index_dir', ctx=Load(), lineno=245, col_offset=41, end_lineno=245, end_col_offset=59), conversion=-1, lineno=245, col_offset=40, end_lineno=245, end_col_offset=60), Constant(value=' already contains data', lineno=245, col_offset=60, end_lineno=245, end_col_offset=82)], lineno=245, col_offset=22, end_lineno=245, end_col_offset=83), lineno=245, col_offset=16, end_lineno=245, end_col_offset=83), Raise(exc=Call(func=Name(id='FileExistsError', ctx=Load(), lineno=246, col_offset=22, end_lineno=246, end_col_offset=37), args=[Name(id='msg', ctx=Load(), lineno=246, col_offset=38, end_lineno=246, end_col_offset=41)], lineno=246, col_offset=22, end_lineno=246, end_col_offset=42), lineno=246, col_offset=16, end_lineno=246, end_col_offset=42)], lineno=244, col_offset=12, end_lineno=246, end_col_offset=42), If(test=BoolOp(op=And(), values=[Name(id='has_contents', ctx=Load(), lineno=247, col_offset=15, end_lineno=247, end_col_offset=27), Attribute(value=Name(id='opts', ctx=Load(), lineno=247, col_offset=32, end_lineno=247, end_col_offset=36), attr='overwrite', ctx=Load(), lineno=247, col_offset=32, end_lineno=247, end_col_offset=46)], lineno=247, col_offset=15, end_lineno=247, end_col_offset=46), body=[Expr(value=Call(func=Attribute(value=Name(id='shutil', ctx=Load(), lineno=248, col_offset=16, end_lineno=248, end_col_offset=22), attr='rmtree', ctx=Load(), lineno=248, col_offset=16, end_lineno=248, end_col_offset=29), args=[Name(id='resolved_index_dir', ctx=Load(), lineno=248, col_offset=30, end_lineno=248, end_col_offset=48)], lineno=248, col_offset=16, end_lineno=248, end_col_offset=49), lineno=248, col_offset=16, end_lineno=248, end_col_offset=49)], lineno=247, col_offset=12, end_lineno=248, end_col_offset=49)], lineno=242, col_offset=8, end_lineno=248, end_col_offset=49), Expr(value=Call(func=Attribute(value=Name(id='resolved_index_dir', ctx=Load(), lineno=249, col_offset=8, end_lineno=249, end_col_offset=26), attr='mkdir', ctx=Load(), lineno=249, col_offset=8, end_lineno=249, end_col_offset=32), keywords=[keyword(arg='parents', value=Constant(value=True, lineno=249, col_offset=41, end_lineno=249, end_col_offset=45), lineno=249, col_offset=33, end_lineno=249, end_col_offset=45), keyword(arg='exist_ok', value=Constant(value=True, lineno=249, col_offset=56, end_lineno=249, end_col_offset=60), lineno=249, col_offset=47, end_lineno=249, end_col_offset=60)], lineno=249, col_offset=8, end_lineno=249, end_col_offset=61), lineno=249, col_offset=8, end_lineno=249, end_col_offset=61), Assign(targets=[Name(id='corpus_metadata_path', ctx=Store(), lineno=251, col_offset=8, end_lineno=251, end_col_offset=28)], value=BinOp(left=Name(id='resolved_json_dir', ctx=Load(), lineno=251, col_offset=31, end_lineno=251, end_col_offset=48), op=Div(), right=Name(id='CORPUS_METADATA_FILENAME', ctx=Load(), lineno=251, col_offset=51, end_lineno=251, end_col_offset=75), lineno=251, col_offset=31, end_lineno=251, end_col_offset=75), lineno=251, col_offset=8, end_lineno=251, end_col_offset=75), Assign(targets=[Name(id='corpus_metadata', ctx=Store(), lineno=252, col_offset=8, end_lineno=252, end_col_offset=23)], value=IfExp(test=Call(func=Attribute(value=Name(id='corpus_metadata_path', ctx=Load(), lineno=253, col_offset=59, end_lineno=253, end_col_offset=79), attr='exists', ctx=Load(), lineno=253, col_offset=59, end_lineno=253, end_col_offset=86), lineno=253, col_offset=59, end_lineno=253, end_col_offset=88), body=Call(func=Name(id='_read_corpus_metadata', ctx=Load(), lineno=253, col_offset=12, end_lineno=253, end_col_offset=33), args=[Name(id='corpus_metadata_path', ctx=Load(), lineno=253, col_offset=34, end_lineno=253, end_col_offset=54)], lineno=253, col_offset=12, end_lineno=253, end_col_offset=55), orelse=Constant(value=None, lineno=253, col_offset=94, end_lineno=253, end_col_offset=98), lineno=253, col_offset=12, end_lineno=253, end_col_offset=98), lineno=252, col_offset=8, end_lineno=254, end_col_offset=9), Assign(targets=[Name(id='cmd', ctx=Store(), lineno=256, col_offset=8, end_lineno=256, end_col_offset=11)], value=List(elts=[Attribute(value=Name(id='sys', ctx=Load(), lineno=257, col_offset=12, end_lineno=257, end_col_offset=15), attr='executable', ctx=Load(), lineno=257, col_offset=12, end_lineno=257, end_col_offset=26), Constant(value='-m', lineno=258, col_offset=12, end_lineno=258, end_col_offset=16), Constant(value='pyserini.index.lucene', lineno=259, col_offset=12, end_lineno=259, end_col_offset=35), Constant(value='--collection', lineno=260, col_offset=12, end_lineno=260, end_col_offset=26), Constant(value='JsonCollection', lineno=261, col_offset=12, end_lineno=261, end_col_offset=28), Constant(value='--input', lineno=262, col_offset=12, end_lineno=262, end_col_offset=21), Call(func=Name(id='str', ctx=Load(), lineno=263, col_offset=12, end_lineno=263, end_col_offset=15), args=[Name(id='resolved_json_dir', ctx=Load(), lineno=263, col_offset=16, end_lineno=263, end_col_offset=33)], lineno=263, col_offset=12, end_lineno=263, end_col_offset=34), Constant(value='--index', lineno=264, col_offset=12, end_lineno=264, end_col_offset=21), Call(func=Name(id='str', ctx=Load(), lineno=265, col_offset=12, end_lineno=265, end_col_offset=15), args=[Name(id='resolved_index_dir', ctx=Load(), lineno=265, col_offset=16, end_lineno=265, end_col_offset=34)], lineno=265, col_offset=12, end_lineno=265, end_col_offset=35), Constant(value='--generator', lineno=266, col_offset=12, end_lineno=266, end_col_offset=25), Constant(value='DefaultLuceneDocumentGenerator', lineno=267, col_offset=12, end_lineno=267, end_col_offset=44), Constant(value='--threads', lineno=268, col_offset=12, end_lineno=268, end_col_offset=23), Call(func=Name(id='str', ctx=Load(), lineno=269, col_offset=12, end_lineno=269, end_col_offset=15), args=[IfExp(test=Compare(left=Attribute(value=Name(id='opts', ctx=Load(), lineno=269, col_offset=32, end_lineno=269, end_col_offset=36), attr='threads', ctx=Load(), lineno=269, col_offset=32, end_lineno=269, end_col_offset=44), ops=[IsNot()], comparators=[Constant(value=None, lineno=269, col_offset=52, end_lineno=269, end_col_offset=56)], lineno=269, col_offset=32, end_lineno=269, end_col_offset=56), body=Attribute(value=Name(id='opts', ctx=Load(), lineno=269, col_offset=16, end_lineno=269, end_col_offset=20), attr='threads', ctx=Load(), lineno=269, col_offset=16, end_lineno=269, end_col_offset=28), orelse=Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=269, col_offset=62, end_lineno=269, end_col_offset=66), attr='_config', ctx=Load(), lineno=269, col_offset=62, end_lineno=269, end_col_offset=74), attr='threads', ctx=Load(), lineno=269, col_offset=62, end_lineno=269, end_col_offset=82), lineno=269, col_offset=16, end_lineno=269, end_col_offset=82)], lineno=269, col_offset=12, end_lineno=269, end_col_offset=83)], ctx=Load(), lineno=256, col_offset=14, end_lineno=270, end_col_offset=9), lineno=256, col_offset=8, end_lineno=270, end_col_offset=9), If(test=Attribute(value=Name(id='opts', ctx=Load(), lineno=271, col_offset=11, end_lineno=271, end_col_offset=15), attr='store_positions', ctx=Load(), lineno=271, col_offset=11, end_lineno=271, end_col_offset=31), body=[Expr(value=Call(func=Attribute(value=Name(id='cmd', ctx=Load(), lineno=272, col_offset=12, end_lineno=272, end_col_offset=15), attr='append', ctx=Load(), lineno=272, col_offset=12, end_lineno=272, end_col_offset=22), args=[Constant(value='--storePositions', lineno=272, col_offset=23, end_lineno=272, end_col_offset=41)], lineno=272, col_offset=12, end_lineno=272, end_col_offset=42), lineno=272, col_offset=12, end_lineno=272, end_col_offset=42)], lineno=271, col_offset=8, end_lineno=272, end_col_offset=42), If(test=Attribute(value=Name(id='opts', ctx=Load(), lineno=273, col_offset=11, end_lineno=273, end_col_offset=15), attr='store_docvectors', ctx=Load(), lineno=273, col_offset=11, end_lineno=273, end_col_offset=32), body=[Expr(value=Call(func=Attribute(value=Name(id='cmd', ctx=Load(), lineno=274, col_offset=12, end_lineno=274, end_col_offset=15), attr='append', ctx=Load(), lineno=274, col_offset=12, end_lineno=274, end_col_offset=22), args=[Constant(value='--storeDocvectors', lineno=274, col_offset=23, end_lineno=274, end_col_offset=42)], lineno=274, col_offset=12, end_lineno=274, end_col_offset=43), lineno=274, col_offset=12, end_lineno=274, end_col_offset=43)], lineno=273, col_offset=8, end_lineno=274, end_col_offset=43), If(test=Attribute(value=Name(id='opts', ctx=Load(), lineno=275, col_offset=11, end_lineno=275, end_col_offset=15), attr='store_raw', ctx=Load(), lineno=275, col_offset=11, end_lineno=275, end_col_offset=25), body=[Expr(value=Call(func=Attribute(value=Name(id='cmd', ctx=Load(), lineno=276, col_offset=12, end_lineno=276, end_col_offset=15), attr='append', ctx=Load(), lineno=276, col_offset=12, end_lineno=276, end_col_offset=22), args=[Constant(value='--storeRaw', lineno=276, col_offset=23, end_lineno=276, end_col_offset=35)], lineno=276, col_offset=12, end_lineno=276, end_col_offset=36), lineno=276, col_offset=12, end_lineno=276, end_col_offset=36)], lineno=275, col_offset=8, end_lineno=276, end_col_offset=36), Expr(value=Call(func=Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=278, col_offset=8, end_lineno=278, end_col_offset=12), attr='_logger', ctx=Load(), lineno=278, col_offset=8, end_lineno=278, end_col_offset=20), attr='info', ctx=Load(), lineno=278, col_offset=8, end_lineno=278, end_col_offset=25), args=[Constant(value='Building BM25 index via Pyserini: %s', lineno=278, col_offset=26, end_lineno=278, end_col_offset=64), Call(func=Attribute(value=Constant(value=' ', lineno=278, col_offset=66, end_lineno=278, end_col_offset=69), attr='join', ctx=Load(), lineno=278, col_offset=66, end_lineno=278, end_col_offset=74), args=[Name(id='cmd', ctx=Load(), lineno=278, col_offset=75, end_lineno=278, end_col_offset=78)], lineno=278, col_offset=66, end_lineno=278, end_col_offset=79)], lineno=278, col_offset=8, end_lineno=278, end_col_offset=80), lineno=278, col_offset=8, end_lineno=278, end_col_offset=80), Expr(value=Call(func=Name(id='_run_pyserini_index', ctx=Load(), lineno=279, col_offset=8, end_lineno=279, end_col_offset=27), args=[Name(id='cmd', ctx=Load(), lineno=279, col_offset=28, end_lineno=279, end_col_offset=31)], lineno=279, col_offset=8, end_lineno=279, end_col_offset=32), lineno=279, col_offset=8, end_lineno=279, end_col_offset=32), Assign(targets=[Name(id='built_at', ctx=Store(), lineno=281, col_offset=8, end_lineno=281, end_col_offset=16)], value=Call(func=Attribute(value=Call(func=Attribute(value=Name(id='datetime', ctx=Load(), lineno=281, col_offset=19, end_lineno=281, end_col_offset=27), attr='now', ctx=Load(), lineno=281, col_offset=19, end_lineno=281, end_col_offset=31), args=[Name(id='UTC', ctx=Load(), lineno=281, col_offset=32, end_lineno=281, end_col_offset=35)], lineno=281, col_offset=19, end_lineno=281, end_col_offset=36), attr='isoformat', ctx=Load(), lineno=281, col_offset=19, end_lineno=281, end_col_offset=46), lineno=281, col_offset=19, end_lineno=281, end_col_offset=48), lineno=281, col_offset=8, end_lineno=281, end_col_offset=48), Assign(targets=[Name(id='pyserini_version', ctx=Store(), lineno=282, col_offset=8, end_lineno=282, end_col_offset=24)], value=Call(func=Name(id='_detect_pyserini_version', ctx=Load(), lineno=282, col_offset=27, end_lineno=282, end_col_offset=51), lineno=282, col_offset=27, end_lineno=282, end_col_offset=53), lineno=282, col_offset=8, end_lineno=282, end_col_offset=53), Assign(targets=[Name(id='index_size_bytes', ctx=Store(), lineno=283, col_offset=8, end_lineno=283, end_col_offset=24)], value=Call(func=Name(id='_directory_size', ctx=Load(), lineno=283, col_offset=27, end_lineno=283, end_col_offset=42), args=[Name(id='resolved_index_dir', ctx=Load(), lineno=283, col_offset=43, end_lineno=283, end_col_offset=61)], lineno=283, col_offset=27, end_lineno=283, end_col_offset=62), lineno=283, col_offset=8, end_lineno=283, end_col_offset=62), Assign(targets=[Name(id='metadata', ctx=Store(), lineno=285, col_offset=8, end_lineno=285, end_col_offset=16)], value=Call(func=Name(id='BM25IndexMetadata', ctx=Load(), lineno=285, col_offset=19, end_lineno=285, end_col_offset=36), keywords=[keyword(arg='doc_count', value=IfExp(test=Name(id='corpus_metadata', ctx=Load(), lineno=286, col_offset=52, end_lineno=286, end_col_offset=67), body=Attribute(value=Name(id='corpus_metadata', ctx=Load(), lineno=286, col_offset=23, end_lineno=286, end_col_offset=38), attr='doc_count', ctx=Load(), lineno=286, col_offset=23, end_lineno=286, end_col_offset=48), orelse=Constant(value=0, lineno=286, col_offset=73, end_lineno=286, end_col_offset=74), lineno=286, col_offset=23, end_lineno=286, end_col_offset=74), lineno=286, col_offset=12, end_lineno=286, end_col_offset=75), keyword(arg='built_at', value=Name(id='built_at', ctx=Load(), lineno=287, col_offset=21, end_lineno=287, end_col_offset=29), lineno=287, col_offset=12, end_lineno=287, end_col_offset=29), keyword(arg='corpus_digest', value=IfExp(test=Name(id='corpus_metadata', ctx=Load(), lineno=288, col_offset=53, end_lineno=288, end_col_offset=68), body=Attribute(value=Name(id='corpus_metadata', ctx=Load(), lineno=288, col_offset=27, end_lineno=288, end_col_offset=42), attr='digest', ctx=Load(), lineno=288, col_offset=27, end_lineno=288, end_col_offset=49), orelse=Constant(value='', lineno=288, col_offset=74, end_lineno=288, end_col_offset=76), lineno=288, col_offset=27, end_lineno=288, end_col_offset=76), lineno=288, col_offset=12, end_lineno=288, end_col_offset=77), keyword(arg='corpus_source', value=IfExp(test=Name(id='corpus_metadata', ctx=Load(), lineno=289, col_offset=58, end_lineno=289, end_col_offset=73), body=Attribute(value=Name(id='corpus_metadata', ctx=Load(), lineno=289, col_offset=27, end_lineno=289, end_col_offset=42), attr='source_path', ctx=Load(), lineno=289, col_offset=27, end_lineno=289, end_col_offset=54), orelse=Constant(value='', lineno=289, col_offset=79, end_lineno=289, end_col_offset=81), lineno=289, col_offset=27, end_lineno=289, end_col_offset=81), lineno=289, col_offset=12, end_lineno=289, end_col_offset=82), keyword(arg='pyserini_version', value=Name(id='pyserini_version', ctx=Load(), lineno=290, col_offset=29, end_lineno=290, end_col_offset=45), lineno=290, col_offset=12, end_lineno=290, end_col_offset=45), keyword(arg='threads', value=Call(func=Name(id='int', ctx=Load(), lineno=291, col_offset=20, end_lineno=291, end_col_offset=23), args=[Subscript(value=Name(id='cmd', ctx=Load(), lineno=291, col_offset=24, end_lineno=291, end_col_offset=27), slice=BinOp(left=Call(func=Attribute(value=Name(id='cmd', ctx=Load(), lineno=291, col_offset=28, end_lineno=291, end_col_offset=31), attr='index', ctx=Load(), lineno=291, col_offset=28, end_lineno=291, end_col_offset=37), args=[Constant(value='--threads', lineno=291, col_offset=38, end_lineno=291, end_col_offset=49)], lineno=291, col_offset=28, end_lineno=291, end_col_offset=50), op=Add(), right=Constant(value=1, lineno=291, col_offset=53, end_lineno=291, end_col_offset=54), lineno=291, col_offset=28, end_lineno=291, end_col_offset=54), ctx=Load(), lineno=291, col_offset=24, end_lineno=291, end_col_offset=55)], lineno=291, col_offset=20, end_lineno=291, end_col_offset=56), lineno=291, col_offset=12, end_lineno=291, end_col_offset=56), keyword(arg='index_dir', value=Call(func=Name(id='str', ctx=Load(), lineno=292, col_offset=22, end_lineno=292, end_col_offset=25), args=[Name(id='resolved_index_dir', ctx=Load(), lineno=292, col_offset=26, end_lineno=292, end_col_offset=44)], lineno=292, col_offset=22, end_lineno=292, end_col_offset=45), lineno=292, col_offset=12, end_lineno=292, end_col_offset=45), keyword(arg='index_size_bytes', value=Name(id='index_size_bytes', ctx=Load(), lineno=293, col_offset=29, end_lineno=293, end_col_offset=45), lineno=293, col_offset=12, end_lineno=293, end_col_offset=45), keyword(arg='generator', value=Name(id='GENERATOR_NAME', ctx=Load(), lineno=294, col_offset=22, end_lineno=294, end_col_offset=36), lineno=294, col_offset=12, end_lineno=294, end_col_offset=36)], lineno=285, col_offset=19, end_lineno=295, end_col_offset=9), lineno=285, col_offset=8, end_lineno=295, end_col_offset=9), Expr(value=Call(func=Name(id='_write_struct', ctx=Load(), lineno=296, col_offset=8, end_lineno=296, end_col_offset=21), args=[BinOp(left=Name(id='resolved_index_dir', ctx=Load(), lineno=296, col_offset=22, end_lineno=296, end_col_offset=40), op=Div(), right=Name(id='INDEX_METADATA_FILENAME', ctx=Load(), lineno=296, col_offset=43, end_lineno=296, end_col_offset=66), lineno=296, col_offset=22, end_lineno=296, end_col_offset=66), Name(id='metadata', ctx=Load(), lineno=296, col_offset=68, end_lineno=296, end_col_offset=76)], lineno=296, col_offset=8, end_lineno=296, end_col_offset=77), lineno=296, col_offset=8, end_lineno=296, end_col_offset=77), Expr(value=Call(func=Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=298, col_offset=8, end_lineno=298, end_col_offset=12), attr='_logger', ctx=Load(), lineno=298, col_offset=8, end_lineno=298, end_col_offset=20), attr='info', ctx=Load(), lineno=298, col_offset=8, end_lineno=298, end_col_offset=25), args=[Constant(value='Built BM25 index at %s (docs=%s, size=%s bytes)', lineno=299, col_offset=12, end_lineno=299, end_col_offset=61), Name(id='resolved_index_dir', ctx=Load(), lineno=300, col_offset=12, end_lineno=300, end_col_offset=30), Attribute(value=Name(id='metadata', ctx=Load(), lineno=301, col_offset=12, end_lineno=301, end_col_offset=20), attr='doc_count', ctx=Load(), lineno=301, col_offset=12, end_lineno=301, end_col_offset=30), Attribute(value=Name(id='metadata', ctx=Load(), lineno=302, col_offset=12, end_lineno=302, end_col_offset=20), attr='index_size_bytes', ctx=Load(), lineno=302, col_offset=12, end_lineno=302, end_col_offset=37)], lineno=298, col_offset=8, end_lineno=303, end_col_offset=9), lineno=298, col_offset=8, end_lineno=303, end_col_offset=9), Return(value=Name(id='metadata', ctx=Load(), lineno=304, col_offset=15, end_lineno=304, end_col_offset=23), lineno=304, col_offset=8, end_lineno=304, end_col_offset=23)], returns=Name(id='BM25IndexMetadata', ctx=Load(), lineno=206, col_offset=70, end_lineno=206, end_col_offset=87), lineno=206, col_offset=4, end_lineno=304, end_col_offset=23)], lineno=75, col_offset=0, end_lineno=304, end_col_offset=23), FunctionDef(name='_write_struct', args=arguments(args=[arg(arg='path', annotation=Name(id='Path', ctx=Load(), lineno=307, col_offset=24, end_lineno=307, end_col_offset=28), lineno=307, col_offset=18, end_lineno=307, end_col_offset=28), arg(arg='data', annotation=Attribute(value=Name(id='msgspec', ctx=Load(), lineno=307, col_offset=36, end_lineno=307, end_col_offset=43), attr='Struct', ctx=Load(), lineno=307, col_offset=36, end_lineno=307, end_col_offset=50), lineno=307, col_offset=30, end_lineno=307, end_col_offset=50)]), body=[Expr(value=Constant(value='Write a msgspec struct to JSON with UTF-8 encoding.', lineno=308, col_offset=4, end_lineno=308, end_col_offset=61), lineno=308, col_offset=4, end_lineno=308, end_col_offset=61), Expr(value=Call(func=Attribute(value=Attribute(value=Name(id='path', ctx=Load(), lineno=309, col_offset=4, end_lineno=309, end_col_offset=8), attr='parent', ctx=Load(), lineno=309, col_offset=4, end_lineno=309, end_col_offset=15), attr='mkdir', ctx=Load(), lineno=309, col_offset=4, end_lineno=309, end_col_offset=21), keywords=[keyword(arg='parents', value=Constant(value=True, lineno=309, col_offset=30, end_lineno=309, end_col_offset=34), lineno=309, col_offset=22, end_lineno=309, end_col_offset=34), keyword(arg='exist_ok', value=Constant(value=True, lineno=309, col_offset=45, end_lineno=309, end_col_offset=49), lineno=309, col_offset=36, end_lineno=309, end_col_offset=49)], lineno=309, col_offset=4, end_lineno=309, end_col_offset=50), lineno=309, col_offset=4, end_lineno=309, end_col_offset=50), Assign(targets=[Name(id='serialized', ctx=Store(), lineno=310, col_offset=4, end_lineno=310, end_col_offset=14)], value=Call(func=Attribute(value=Attribute(value=Name(id='msgspec', ctx=Load(), lineno=310, col_offset=17, end_lineno=310, end_col_offset=24), attr='json', ctx=Load(), lineno=310, col_offset=17, end_lineno=310, end_col_offset=29), attr='encode', ctx=Load(), lineno=310, col_offset=17, end_lineno=310, end_col_offset=36), args=[Name(id='data', ctx=Load(), lineno=310, col_offset=37, end_lineno=310, end_col_offset=41)], lineno=310, col_offset=17, end_lineno=310, end_col_offset=42), lineno=310, col_offset=4, end_lineno=310, end_col_offset=42), Expr(value=Call(func=Attribute(value=Name(id='path', ctx=Load(), lineno=311, col_offset=4, end_lineno=311, end_col_offset=8), attr='write_text', ctx=Load(), lineno=311, col_offset=4, end_lineno=311, end_col_offset=19), args=[Call(func=Attribute(value=Name(id='serialized', ctx=Load(), lineno=311, col_offset=20, end_lineno=311, end_col_offset=30), attr='decode', ctx=Load(), lineno=311, col_offset=20, end_lineno=311, end_col_offset=37), args=[Constant(value='utf-8', lineno=311, col_offset=38, end_lineno=311, end_col_offset=45)], lineno=311, col_offset=20, end_lineno=311, end_col_offset=46)], keywords=[keyword(arg='encoding', value=Constant(value='utf-8', lineno=311, col_offset=57, end_lineno=311, end_col_offset=64), lineno=311, col_offset=48, end_lineno=311, end_col_offset=64)], lineno=311, col_offset=4, end_lineno=311, end_col_offset=65), lineno=311, col_offset=4, end_lineno=311, end_col_offset=65)], returns=Constant(value=None, lineno=307, col_offset=55, end_lineno=307, end_col_offset=59), lineno=307, col_offset=0, end_lineno=311, end_col_offset=65), FunctionDef(name='_read_corpus_metadata', args=arguments(args=[arg(arg='path', annotation=Name(id='Path', ctx=Load(), lineno=314, col_offset=32, end_lineno=314, end_col_offset=36), lineno=314, col_offset=26, end_lineno=314, end_col_offset=36)]), body=[Expr(value=Constant(value="Read corpus metadata from JSON file.\n\n    This helper function deserializes BM25 corpus metadata from a JSON file\n    created during corpus preparation. The metadata contains information about\n    document count, source path, content digest, preparation timestamp, and\n    generator identifier.\n\n    Parameters\n    ----------\n    path : Path\n        File path to the JSON metadata file. The file must exist and contain\n        valid BM25CorpusMetadata JSON serialized data.\n\n    Returns\n    -------\n    BM25CorpusMetadata\n        Decoded metadata structure containing corpus statistics and provenance\n        information. Includes document count, source path, SHA-256 digest of\n        corpus content, ISO 8601 timestamp, and generator name.\n\n    Notes\n    -----\n    Exception Propagation:\n        This function may propagate exceptions from underlying operations:\n        - FileNotFoundError: If the metadata file does not exist (from path.read_bytes())\n        - msgspec.DecodeError: If the file contains invalid JSON or data that doesn't\n          match the BM25CorpusMetadata schema (from msgspec.json.decode())\n    ", lineno=315, col_offset=4, end_lineno=342, end_col_offset=7), lineno=315, col_offset=4, end_lineno=342, end_col_offset=7), Return(value=Call(func=Attribute(value=Attribute(value=Name(id='msgspec', ctx=Load(), lineno=343, col_offset=11, end_lineno=343, end_col_offset=18), attr='json', ctx=Load(), lineno=343, col_offset=11, end_lineno=343, end_col_offset=23), attr='decode', ctx=Load(), lineno=343, col_offset=11, end_lineno=343, end_col_offset=30), args=[Call(func=Attribute(value=Name(id='path', ctx=Load(), lineno=343, col_offset=31, end_lineno=343, end_col_offset=35), attr='read_bytes', ctx=Load(), lineno=343, col_offset=31, end_lineno=343, end_col_offset=46), lineno=343, col_offset=31, end_lineno=343, end_col_offset=48)], keywords=[keyword(arg='type', value=Name(id='BM25CorpusMetadata', ctx=Load(), lineno=343, col_offset=55, end_lineno=343, end_col_offset=73), lineno=343, col_offset=50, end_lineno=343, end_col_offset=73)], lineno=343, col_offset=11, end_lineno=343, end_col_offset=74), lineno=343, col_offset=4, end_lineno=343, end_col_offset=74)], returns=Name(id='BM25CorpusMetadata', ctx=Load(), lineno=314, col_offset=41, end_lineno=314, end_col_offset=59), lineno=314, col_offset=0, end_lineno=343, end_col_offset=74), FunctionDef(name='_parse_corpus_line', args=arguments(args=[arg(arg='raw_line', annotation=Name(id='str', ctx=Load(), lineno=347, col_offset=14, end_lineno=347, end_col_offset=17), lineno=347, col_offset=4, end_lineno=347, end_col_offset=17)], kwonlyargs=[arg(arg='line_number', annotation=Name(id='int', ctx=Load(), lineno=349, col_offset=17, end_lineno=349, end_col_offset=20), lineno=349, col_offset=4, end_lineno=349, end_col_offset=20), arg(arg='seen_ids', annotation=Subscript(value=Name(id='set', ctx=Load(), lineno=350, col_offset=14, end_lineno=350, end_col_offset=17), slice=Name(id='str', ctx=Load(), lineno=350, col_offset=18, end_lineno=350, end_col_offset=21), ctx=Load(), lineno=350, col_offset=14, end_lineno=350, end_col_offset=22), lineno=350, col_offset=4, end_lineno=350, end_col_offset=22), arg(arg='source_path', annotation=Name(id='Path', ctx=Load(), lineno=351, col_offset=17, end_lineno=351, end_col_offset=21), lineno=351, col_offset=4, end_lineno=351, end_col_offset=21)], kw_defaults=[None, None, None]), body=[Expr(value=Constant(value="Parse and validate a JSONL line from the corpus source.\n\n    This function parses a single line from a JSONL corpus file, validates that\n    it contains required fields (id and contents/text), checks for duplicate\n    document IDs, and returns the parsed document identifier and content. Empty\n    lines are skipped by returning None.\n\n    The function maintains a set of seen document IDs to detect duplicates within\n    the corpus, which is important for ensuring corpus integrity and preventing\n    indexing errors.\n\n    Parameters\n    ----------\n    raw_line : str\n        Raw line from the JSONL file, including any trailing whitespace or\n        newline characters. Will be stripped before parsing.\n    line_number : int\n        One-based line number in the source file. Used for error messages to\n        help identify problematic lines during corpus preparation.\n    seen_ids : set[str]\n        Set of document IDs that have been encountered in previous lines. This\n        set is mutated by adding the current document ID if parsing succeeds.\n        Used to detect duplicate document IDs within the corpus.\n    source_path : Path\n        Path to the source JSONL file. Used in error messages to provide context\n        about which file contains the problematic line.\n\n    Returns\n    -------\n    tuple[str, str] | None\n        Tuple of (doc_id, contents) if the line was successfully parsed and\n        validated. Returns None if the line is empty (after stripping) or should\n        be skipped for any reason.\n\n    Raises\n    ------\n    ValueError\n        Raised in the following cases:\n        - Line contains invalid JSON (JSONDecodeError)\n        - Document object is missing the 'id' field\n        - Document ID has already been seen (duplicate)\n        - Document is missing both 'contents' and 'text' fields, or the content\n          field is empty or not a string\n    ", lineno=353, col_offset=4, end_lineno=396, end_col_offset=7), lineno=353, col_offset=4, end_lineno=396, end_col_offset=7), Assign(targets=[Name(id='stripped_line', ctx=Store(), lineno=397, col_offset=4, end_lineno=397, end_col_offset=17)], value=Call(func=Attribute(value=Name(id='raw_line', ctx=Load(), lineno=397, col_offset=20, end_lineno=397, end_col_offset=28), attr='strip', ctx=Load(), lineno=397, col_offset=20, end_lineno=397, end_col_offset=34), lineno=397, col_offset=20, end_lineno=397, end_col_offset=36), lineno=397, col_offset=4, end_lineno=397, end_col_offset=36), If(test=UnaryOp(op=Not(), operand=Name(id='stripped_line', ctx=Load(), lineno=398, col_offset=11, end_lineno=398, end_col_offset=24), lineno=398, col_offset=7, end_lineno=398, end_col_offset=24), body=[Return(value=Constant(value=None, lineno=399, col_offset=15, end_lineno=399, end_col_offset=19), lineno=399, col_offset=8, end_lineno=399, end_col_offset=19)], lineno=398, col_offset=4, end_lineno=399, end_col_offset=19), Try(body=[Assign(targets=[Name(id='obj', ctx=Store(), lineno=401, col_offset=8, end_lineno=401, end_col_offset=11)], value=Call(func=Attribute(value=Name(id='json', ctx=Load(), lineno=401, col_offset=14, end_lineno=401, end_col_offset=18), attr='loads', ctx=Load(), lineno=401, col_offset=14, end_lineno=401, end_col_offset=24), args=[Name(id='stripped_line', ctx=Load(), lineno=401, col_offset=25, end_lineno=401, end_col_offset=38)], lineno=401, col_offset=14, end_lineno=401, end_col_offset=39), lineno=401, col_offset=8, end_lineno=401, end_col_offset=39)], handlers=[ExceptHandler(type=Attribute(value=Name(id='json', ctx=Load(), lineno=402, col_offset=11, end_lineno=402, end_col_offset=15), attr='JSONDecodeError', ctx=Load(), lineno=402, col_offset=11, end_lineno=402, end_col_offset=31), name='exc', body=[Assign(targets=[Name(id='msg', ctx=Store(), lineno=403, col_offset=8, end_lineno=403, end_col_offset=11)], value=JoinedStr(values=[Constant(value='Invalid JSON on line ', lineno=403, col_offset=16, end_lineno=403, end_col_offset=37), FormattedValue(value=Name(id='line_number', ctx=Load(), lineno=403, col_offset=38, end_lineno=403, end_col_offset=49), conversion=-1, lineno=403, col_offset=37, end_lineno=403, end_col_offset=50), Constant(value=' of ', lineno=403, col_offset=50, end_lineno=403, end_col_offset=54), FormattedValue(value=Name(id='source_path', ctx=Load(), lineno=403, col_offset=55, end_lineno=403, end_col_offset=66), conversion=-1, lineno=403, col_offset=54, end_lineno=403, end_col_offset=67)], lineno=403, col_offset=14, end_lineno=403, end_col_offset=68), lineno=403, col_offset=8, end_lineno=403, end_col_offset=68), Raise(exc=Call(func=Name(id='ValueError', ctx=Load(), lineno=404, col_offset=14, end_lineno=404, end_col_offset=24), args=[Name(id='msg', ctx=Load(), lineno=404, col_offset=25, end_lineno=404, end_col_offset=28)], lineno=404, col_offset=14, end_lineno=404, end_col_offset=29), cause=Name(id='exc', ctx=Load(), lineno=404, col_offset=35, end_lineno=404, end_col_offset=38), lineno=404, col_offset=8, end_lineno=404, end_col_offset=38)], lineno=402, col_offset=4, end_lineno=404, end_col_offset=38)], lineno=400, col_offset=4, end_lineno=404, end_col_offset=38), Assign(targets=[Name(id='doc_id_raw', ctx=Store(), lineno=406, col_offset=4, end_lineno=406, end_col_offset=14)], value=Call(func=Attribute(value=Name(id='obj', ctx=Load(), lineno=406, col_offset=17, end_lineno=406, end_col_offset=20), attr='get', ctx=Load(), lineno=406, col_offset=17, end_lineno=406, end_col_offset=24), args=[Constant(value='id', lineno=406, col_offset=25, end_lineno=406, end_col_offset=29)], lineno=406, col_offset=17, end_lineno=406, end_col_offset=30), lineno=406, col_offset=4, end_lineno=406, end_col_offset=30), If(test=Compare(left=Name(id='doc_id_raw', ctx=Load(), lineno=407, col_offset=7, end_lineno=407, end_col_offset=17), ops=[Is()], comparators=[Constant(value=None, lineno=407, col_offset=21, end_lineno=407, end_col_offset=25)], lineno=407, col_offset=7, end_lineno=407, end_col_offset=25), body=[Assign(targets=[Name(id='msg', ctx=Store(), lineno=408, col_offset=8, end_lineno=408, end_col_offset=11)], value=JoinedStr(values=[Constant(value='Document on line ', lineno=408, col_offset=16, end_lineno=408, end_col_offset=33), FormattedValue(value=Name(id='line_number', ctx=Load(), lineno=408, col_offset=34, end_lineno=408, end_col_offset=45), conversion=-1, lineno=408, col_offset=33, end_lineno=408, end_col_offset=46), Constant(value=" is missing 'id'", lineno=408, col_offset=46, end_lineno=408, end_col_offset=62)], lineno=408, col_offset=14, end_lineno=408, end_col_offset=63), lineno=408, col_offset=8, end_lineno=408, end_col_offset=63), Raise(exc=Call(func=Name(id='ValueError', ctx=Load(), lineno=409, col_offset=14, end_lineno=409, end_col_offset=24), args=[Name(id='msg', ctx=Load(), lineno=409, col_offset=25, end_lineno=409, end_col_offset=28)], lineno=409, col_offset=14, end_lineno=409, end_col_offset=29), lineno=409, col_offset=8, end_lineno=409, end_col_offset=29)], lineno=407, col_offset=4, end_lineno=409, end_col_offset=29), Assign(targets=[Name(id='doc_id_str', ctx=Store(), lineno=410, col_offset=4, end_lineno=410, end_col_offset=14)], value=Call(func=Name(id='str', ctx=Load(), lineno=410, col_offset=17, end_lineno=410, end_col_offset=20), args=[Name(id='doc_id_raw', ctx=Load(), lineno=410, col_offset=21, end_lineno=410, end_col_offset=31)], lineno=410, col_offset=17, end_lineno=410, end_col_offset=32), lineno=410, col_offset=4, end_lineno=410, end_col_offset=32), If(test=Compare(left=Name(id='doc_id_str', ctx=Load(), lineno=411, col_offset=7, end_lineno=411, end_col_offset=17), ops=[In()], comparators=[Name(id='seen_ids', ctx=Load(), lineno=411, col_offset=21, end_lineno=411, end_col_offset=29)], lineno=411, col_offset=7, end_lineno=411, end_col_offset=29), body=[Assign(targets=[Name(id='msg', ctx=Store(), lineno=412, col_offset=8, end_lineno=412, end_col_offset=11)], value=JoinedStr(values=[Constant(value="Duplicate document id '", lineno=412, col_offset=16, end_lineno=412, end_col_offset=39), FormattedValue(value=Name(id='doc_id_str', ctx=Load(), lineno=412, col_offset=40, end_lineno=412, end_col_offset=50), conversion=-1, lineno=412, col_offset=39, end_lineno=412, end_col_offset=51), Constant(value="' on line ", lineno=412, col_offset=51, end_lineno=412, end_col_offset=61), FormattedValue(value=Name(id='line_number', ctx=Load(), lineno=412, col_offset=62, end_lineno=412, end_col_offset=73), conversion=-1, lineno=412, col_offset=61, end_lineno=412, end_col_offset=74)], lineno=412, col_offset=14, end_lineno=412, end_col_offset=75), lineno=412, col_offset=8, end_lineno=412, end_col_offset=75), Raise(exc=Call(func=Name(id='ValueError', ctx=Load(), lineno=413, col_offset=14, end_lineno=413, end_col_offset=24), args=[Name(id='msg', ctx=Load(), lineno=413, col_offset=25, end_lineno=413, end_col_offset=28)], lineno=413, col_offset=14, end_lineno=413, end_col_offset=29), lineno=413, col_offset=8, end_lineno=413, end_col_offset=29)], lineno=411, col_offset=4, end_lineno=413, end_col_offset=29), Expr(value=Call(func=Attribute(value=Name(id='seen_ids', ctx=Load(), lineno=414, col_offset=4, end_lineno=414, end_col_offset=12), attr='add', ctx=Load(), lineno=414, col_offset=4, end_lineno=414, end_col_offset=16), args=[Name(id='doc_id_str', ctx=Load(), lineno=414, col_offset=17, end_lineno=414, end_col_offset=27)], lineno=414, col_offset=4, end_lineno=414, end_col_offset=28), lineno=414, col_offset=4, end_lineno=414, end_col_offset=28), Assign(targets=[Name(id='contents', ctx=Store(), lineno=416, col_offset=4, end_lineno=416, end_col_offset=12)], value=Call(func=Attribute(value=Name(id='obj', ctx=Load(), lineno=416, col_offset=15, end_lineno=416, end_col_offset=18), attr='get', ctx=Load(), lineno=416, col_offset=15, end_lineno=416, end_col_offset=22), args=[Constant(value='contents', lineno=416, col_offset=23, end_lineno=416, end_col_offset=33), Call(func=Attribute(value=Name(id='obj', ctx=Load(), lineno=416, col_offset=35, end_lineno=416, end_col_offset=38), attr='get', ctx=Load(), lineno=416, col_offset=35, end_lineno=416, end_col_offset=42), args=[Constant(value='text', lineno=416, col_offset=43, end_lineno=416, end_col_offset=49)], lineno=416, col_offset=35, end_lineno=416, end_col_offset=50)], lineno=416, col_offset=15, end_lineno=416, end_col_offset=51), lineno=416, col_offset=4, end_lineno=416, end_col_offset=51), If(test=BoolOp(op=Or(), values=[UnaryOp(op=Not(), operand=Call(func=Name(id='isinstance', ctx=Load(), lineno=417, col_offset=11, end_lineno=417, end_col_offset=21), args=[Name(id='contents', ctx=Load(), lineno=417, col_offset=22, end_lineno=417, end_col_offset=30), Name(id='str', ctx=Load(), lineno=417, col_offset=32, end_lineno=417, end_col_offset=35)], lineno=417, col_offset=11, end_lineno=417, end_col_offset=36), lineno=417, col_offset=7, end_lineno=417, end_col_offset=36), UnaryOp(op=Not(), operand=Name(id='contents', ctx=Load(), lineno=417, col_offset=44, end_lineno=417, end_col_offset=52), lineno=417, col_offset=40, end_lineno=417, end_col_offset=52)], lineno=417, col_offset=7, end_lineno=417, end_col_offset=52), body=[Assign(targets=[Name(id='msg', ctx=Store(), lineno=418, col_offset=8, end_lineno=418, end_col_offset=11)], value=JoinedStr(values=[Constant(value="Document '", lineno=418, col_offset=16, end_lineno=418, end_col_offset=26), FormattedValue(value=Name(id='doc_id_str', ctx=Load(), lineno=418, col_offset=27, end_lineno=418, end_col_offset=37), conversion=-1, lineno=418, col_offset=26, end_lineno=418, end_col_offset=38), Constant(value="' is missing textual contents", lineno=418, col_offset=38, end_lineno=418, end_col_offset=67)], lineno=418, col_offset=14, end_lineno=418, end_col_offset=68), lineno=418, col_offset=8, end_lineno=418, end_col_offset=68), Raise(exc=Call(func=Name(id='ValueError', ctx=Load(), lineno=419, col_offset=14, end_lineno=419, end_col_offset=24), args=[Name(id='msg', ctx=Load(), lineno=419, col_offset=25, end_lineno=419, end_col_offset=28)], lineno=419, col_offset=14, end_lineno=419, end_col_offset=29), lineno=419, col_offset=8, end_lineno=419, end_col_offset=29)], lineno=417, col_offset=4, end_lineno=419, end_col_offset=29), Return(value=Tuple(elts=[Name(id='doc_id_str', ctx=Load(), lineno=420, col_offset=11, end_lineno=420, end_col_offset=21), Name(id='contents', ctx=Load(), lineno=420, col_offset=23, end_lineno=420, end_col_offset=31)], ctx=Load(), lineno=420, col_offset=11, end_lineno=420, end_col_offset=31), lineno=420, col_offset=4, end_lineno=420, end_col_offset=31)], returns=BinOp(left=Subscript(value=Name(id='tuple', ctx=Load(), lineno=352, col_offset=5, end_lineno=352, end_col_offset=10), slice=Tuple(elts=[Name(id='str', ctx=Load(), lineno=352, col_offset=11, end_lineno=352, end_col_offset=14), Name(id='str', ctx=Load(), lineno=352, col_offset=16, end_lineno=352, end_col_offset=19)], ctx=Load(), lineno=352, col_offset=11, end_lineno=352, end_col_offset=19), ctx=Load(), lineno=352, col_offset=5, end_lineno=352, end_col_offset=20), op=BitOr(), right=Constant(value=None, lineno=352, col_offset=23, end_lineno=352, end_col_offset=27), lineno=352, col_offset=5, end_lineno=352, end_col_offset=27), lineno=346, col_offset=0, end_lineno=420, end_col_offset=31), FunctionDef(name='_run_pyserini_index', args=arguments(args=[arg(arg='cmd', annotation=Subscript(value=Name(id='list', ctx=Load(), lineno=423, col_offset=29, end_lineno=423, end_col_offset=33), slice=Name(id='str', ctx=Load(), lineno=423, col_offset=34, end_lineno=423, end_col_offset=37), ctx=Load(), lineno=423, col_offset=29, end_lineno=423, end_col_offset=38), lineno=423, col_offset=24, end_lineno=423, end_col_offset=38)]), body=[Expr(value=Constant(value='Execute the Pyserini index command and raise for failures.', lineno=424, col_offset=4, end_lineno=424, end_col_offset=68), lineno=424, col_offset=4, end_lineno=424, end_col_offset=68), Expr(value=Call(func=Name(id='run_subprocess', ctx=Load(), lineno=425, col_offset=4, end_lineno=425, end_col_offset=18), args=[Name(id='cmd', ctx=Load(), lineno=425, col_offset=19, end_lineno=425, end_col_offset=22)], lineno=425, col_offset=4, end_lineno=425, end_col_offset=23), lineno=425, col_offset=4, end_lineno=425, end_col_offset=23)], returns=Constant(value=None, lineno=423, col_offset=43, end_lineno=423, end_col_offset=47), lineno=423, col_offset=0, end_lineno=425, end_col_offset=23), FunctionDef(name='_detect_pyserini_version', args=arguments(), body=[Expr(value=Constant(value="Return the installed Pyserini version or ``'unknown'`` if unavailable.\n\n    Returns\n    -------\n    str\n        The Pyserini version string, or ``'unknown'`` if the package is not installed.\n    ", lineno=429, col_offset=4, end_lineno=435, end_col_offset=7), lineno=429, col_offset=4, end_lineno=435, end_col_offset=7), Try(body=[Assign(targets=[Name(id='module', ctx=Store(), lineno=437, col_offset=8, end_lineno=437, end_col_offset=14)], value=Call(func=Attribute(value=Name(id='importlib', ctx=Load(), lineno=437, col_offset=17, end_lineno=437, end_col_offset=26), attr='import_module', ctx=Load(), lineno=437, col_offset=17, end_lineno=437, end_col_offset=40), args=[Constant(value='pyserini', lineno=437, col_offset=41, end_lineno=437, end_col_offset=51)], lineno=437, col_offset=17, end_lineno=437, end_col_offset=52), lineno=437, col_offset=8, end_lineno=437, end_col_offset=52)], handlers=[ExceptHandler(type=Name(id='ModuleNotFoundError', ctx=Load(), lineno=438, col_offset=11, end_lineno=438, end_col_offset=30), body=[Return(value=Constant(value='unknown', lineno=439, col_offset=15, end_lineno=439, end_col_offset=24), lineno=439, col_offset=8, end_lineno=439, end_col_offset=24)], lineno=438, col_offset=4, end_lineno=439, end_col_offset=24)], lineno=436, col_offset=4, end_lineno=439, end_col_offset=24), Assign(targets=[Name(id='version', ctx=Store(), lineno=440, col_offset=4, end_lineno=440, end_col_offset=11)], value=Call(func=Name(id='getattr', ctx=Load(), lineno=440, col_offset=14, end_lineno=440, end_col_offset=21), args=[Name(id='module', ctx=Load(), lineno=440, col_offset=22, end_lineno=440, end_col_offset=28), Constant(value='__version__', lineno=440, col_offset=30, end_lineno=440, end_col_offset=43), Constant(value=None, lineno=440, col_offset=45, end_lineno=440, end_col_offset=49)], lineno=440, col_offset=14, end_lineno=440, end_col_offset=50), lineno=440, col_offset=4, end_lineno=440, end_col_offset=50), Return(value=IfExp(test=Compare(left=Name(id='version', ctx=Load(), lineno=441, col_offset=27, end_lineno=441, end_col_offset=34), ops=[IsNot()], comparators=[Constant(value=None, lineno=441, col_offset=42, end_lineno=441, end_col_offset=46)], lineno=441, col_offset=27, end_lineno=441, end_col_offset=46), body=Call(func=Name(id='str', ctx=Load(), lineno=441, col_offset=11, end_lineno=441, end_col_offset=14), args=[Name(id='version', ctx=Load(), lineno=441, col_offset=15, end_lineno=441, end_col_offset=22)], lineno=441, col_offset=11, end_lineno=441, end_col_offset=23), orelse=Constant(value='unknown', lineno=441, col_offset=52, end_lineno=441, end_col_offset=61), lineno=441, col_offset=11, end_lineno=441, end_col_offset=61), lineno=441, col_offset=4, end_lineno=441, end_col_offset=61)], returns=Name(id='str', ctx=Load(), lineno=428, col_offset=34, end_lineno=428, end_col_offset=37), lineno=428, col_offset=0, end_lineno=441, end_col_offset=61), FunctionDef(name='_directory_size', args=arguments(args=[arg(arg='path', annotation=Name(id='Path', ctx=Load(), lineno=444, col_offset=26, end_lineno=444, end_col_offset=30), lineno=444, col_offset=20, end_lineno=444, end_col_offset=30)]), body=[Expr(value=Constant(value="Compute total size in bytes for all files beneath a directory.\n\n    This utility function recursively traverses a directory tree and sums the\n    sizes of all regular files found. It's used to calculate index sizes for\n    metadata purposes. Symbolic links are followed, but directories themselves\n    don't contribute to the size.\n\n    Parameters\n    ----------\n    path : Path\n        Root directory path to measure. The function recursively traverses all\n        subdirectories and sums file sizes. The path must exist and be a directory.\n\n    Returns\n    -------\n    int\n        Total size in bytes for all regular files contained within the directory\n        tree. Returns 0 if the directory is empty or contains no files. The\n        size is calculated using file system stat information (st_size).\n    ", lineno=445, col_offset=4, end_lineno=464, end_col_offset=7), lineno=445, col_offset=4, end_lineno=464, end_col_offset=7), Assign(targets=[Name(id='total', ctx=Store(), lineno=465, col_offset=4, end_lineno=465, end_col_offset=9)], value=Constant(value=0, lineno=465, col_offset=12, end_lineno=465, end_col_offset=13), lineno=465, col_offset=4, end_lineno=465, end_col_offset=13), For(target=Name(id='child', ctx=Store(), lineno=466, col_offset=8, end_lineno=466, end_col_offset=13), iter=Call(func=Attribute(value=Name(id='path', ctx=Load(), lineno=466, col_offset=17, end_lineno=466, end_col_offset=21), attr='rglob', ctx=Load(), lineno=466, col_offset=17, end_lineno=466, end_col_offset=27), args=[Constant(value='*', lineno=466, col_offset=28, end_lineno=466, end_col_offset=31)], lineno=466, col_offset=17, end_lineno=466, end_col_offset=32), body=[If(test=Call(func=Attribute(value=Name(id='child', ctx=Load(), lineno=467, col_offset=11, end_lineno=467, end_col_offset=16), attr='is_file', ctx=Load(), lineno=467, col_offset=11, end_lineno=467, end_col_offset=24), lineno=467, col_offset=11, end_lineno=467, end_col_offset=26), body=[AugAssign(target=Name(id='total', ctx=Store(), lineno=468, col_offset=12, end_lineno=468, end_col_offset=17), op=Add(), value=Attribute(value=Call(func=Attribute(value=Name(id='child', ctx=Load(), lineno=468, col_offset=21, end_lineno=468, end_col_offset=26), attr='stat', ctx=Load(), lineno=468, col_offset=21, end_lineno=468, end_col_offset=31), lineno=468, col_offset=21, end_lineno=468, end_col_offset=33), attr='st_size', ctx=Load(), lineno=468, col_offset=21, end_lineno=468, end_col_offset=41), lineno=468, col_offset=12, end_lineno=468, end_col_offset=41)], lineno=467, col_offset=8, end_lineno=468, end_col_offset=41)], lineno=466, col_offset=4, end_lineno=468, end_col_offset=41), Return(value=Name(id='total', ctx=Load(), lineno=469, col_offset=11, end_lineno=469, end_col_offset=16), lineno=469, col_offset=4, end_lineno=469, end_col_offset=16)], returns=Name(id='int', ctx=Load(), lineno=444, col_offset=35, end_lineno=444, end_col_offset=38), lineno=444, col_offset=0, end_lineno=469, end_col_offset=16), Assign(targets=[Name(id='__all__', ctx=Store(), lineno=472, col_offset=0, end_lineno=472, end_col_offset=7)], value=List(elts=[Constant(value='BM25BuildOptions', lineno=473, col_offset=4, end_lineno=473, end_col_offset=22), Constant(value='BM25CorpusMetadata', lineno=474, col_offset=4, end_lineno=474, end_col_offset=24), Constant(value='BM25CorpusSummary', lineno=475, col_offset=4, end_lineno=475, end_col_offset=23), Constant(value='BM25IndexManager', lineno=476, col_offset=4, end_lineno=476, end_col_offset=22), Constant(value='BM25IndexMetadata', lineno=477, col_offset=4, end_lineno=477, end_col_offset=23)], ctx=Load(), lineno=472, col_offset=10, end_lineno=478, end_col_offset=1), lineno=472, col_offset=0, end_lineno=478, end_col_offset=1)])