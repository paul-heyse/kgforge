Module(body=[ImportFrom(module='__future__', names=[alias(name='annotations', lineno=1, col_offset=23, end_lineno=1, end_col_offset=34)], level=0, lineno=1, col_offset=0, end_lineno=1, end_col_offset=34), Import(names=[alias(name='asyncio', lineno=3, col_offset=7, end_lineno=3, end_col_offset=14)], lineno=3, col_offset=0, end_lineno=3, end_col_offset=14), Import(names=[alias(name='time', asname='time_module', lineno=4, col_offset=7, end_lineno=4, end_col_offset=26)], lineno=4, col_offset=0, end_lineno=4, end_col_offset=26), ImportFrom(module='concurrent.futures', names=[alias(name='ThreadPoolExecutor', lineno=5, col_offset=31, end_lineno=5, end_col_offset=49)], level=0, lineno=5, col_offset=0, end_lineno=5, end_col_offset=49), ImportFrom(module='typing', names=[alias(name='cast', lineno=6, col_offset=19, end_lineno=6, end_col_offset=23)], level=0, lineno=6, col_offset=0, end_lineno=6, end_col_offset=23), Import(names=[alias(name='pytest', lineno=8, col_offset=7, end_lineno=8, end_col_offset=13)], lineno=8, col_offset=0, end_lineno=8, end_col_offset=13), ImportFrom(module='codeintel_rev.app.scope_store', names=[alias(name='AsyncSingleFlight', lineno=9, col_offset=42, end_lineno=9, end_col_offset=59), alias(name='LRUCache', lineno=9, col_offset=61, end_lineno=9, end_col_offset=69), alias(name='ScopeStore', lineno=9, col_offset=71, end_lineno=9, end_col_offset=81)], level=0, lineno=9, col_offset=0, end_lineno=9, end_col_offset=81), ImportFrom(module='codeintel_rev.mcp_server.schemas', names=[alias(name='ScopeIn', lineno=10, col_offset=45, end_lineno=10, end_col_offset=52)], level=0, lineno=10, col_offset=0, end_lineno=10, end_col_offset=52), ClassDef(name='FakeClock', body=[Expr(value=Constant(value='Simple monotonic clock for deterministic TTL testing.', lineno=14, col_offset=4, end_lineno=14, end_col_offset=63), lineno=14, col_offset=4, end_lineno=14, end_col_offset=63), FunctionDef(name='__init__', args=arguments(args=[arg(arg='self', lineno=16, col_offset=17, end_lineno=16, end_col_offset=21)]), body=[Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=17, col_offset=8, end_lineno=17, end_col_offset=12), attr='_now', ctx=Store(), lineno=17, col_offset=8, end_lineno=17, end_col_offset=17)], value=Constant(value=0.0, lineno=17, col_offset=20, end_lineno=17, end_col_offset=23), lineno=17, col_offset=8, end_lineno=17, end_col_offset=23)], returns=Constant(value=None, lineno=16, col_offset=26, end_lineno=16, end_col_offset=30), lineno=16, col_offset=4, end_lineno=17, end_col_offset=23), FunctionDef(name='now', args=arguments(args=[arg(arg='self', lineno=19, col_offset=12, end_lineno=19, end_col_offset=16)]), body=[Return(value=Attribute(value=Name(id='self', ctx=Load(), lineno=20, col_offset=15, end_lineno=20, end_col_offset=19), attr='_now', ctx=Load(), lineno=20, col_offset=15, end_lineno=20, end_col_offset=24), lineno=20, col_offset=8, end_lineno=20, end_col_offset=24)], returns=Name(id='float', ctx=Load(), lineno=19, col_offset=21, end_lineno=19, end_col_offset=26), lineno=19, col_offset=4, end_lineno=20, end_col_offset=24), FunctionDef(name='advance', args=arguments(args=[arg(arg='self', lineno=22, col_offset=16, end_lineno=22, end_col_offset=20), arg(arg='seconds', annotation=Name(id='float', ctx=Load(), lineno=22, col_offset=31, end_lineno=22, end_col_offset=36), lineno=22, col_offset=22, end_lineno=22, end_col_offset=36)]), body=[AugAssign(target=Attribute(value=Name(id='self', ctx=Load(), lineno=23, col_offset=8, end_lineno=23, end_col_offset=12), attr='_now', ctx=Store(), lineno=23, col_offset=8, end_lineno=23, end_col_offset=17), op=Add(), value=Name(id='seconds', ctx=Load(), lineno=23, col_offset=21, end_lineno=23, end_col_offset=28), lineno=23, col_offset=8, end_lineno=23, end_col_offset=28)], returns=Constant(value=None, lineno=22, col_offset=41, end_lineno=22, end_col_offset=45), lineno=22, col_offset=4, end_lineno=23, end_col_offset=28)], lineno=13, col_offset=0, end_lineno=23, end_col_offset=28), FunctionDef(name='test_lru_cache_evicts_least_recently_used', args=arguments(), body=[Assign(targets=[Name(id='clock', ctx=Store(), lineno=27, col_offset=4, end_lineno=27, end_col_offset=9)], value=Call(func=Name(id='FakeClock', ctx=Load(), lineno=27, col_offset=12, end_lineno=27, end_col_offset=21), lineno=27, col_offset=12, end_lineno=27, end_col_offset=23), lineno=27, col_offset=4, end_lineno=27, end_col_offset=23), AnnAssign(target=Name(id='cache', ctx=Store(), lineno=28, col_offset=4, end_lineno=28, end_col_offset=9), annotation=Subscript(value=Name(id='LRUCache', ctx=Load(), lineno=28, col_offset=11, end_lineno=28, end_col_offset=19), slice=Tuple(elts=[Name(id='str', ctx=Load(), lineno=28, col_offset=20, end_lineno=28, end_col_offset=23), Name(id='int', ctx=Load(), lineno=28, col_offset=25, end_lineno=28, end_col_offset=28)], ctx=Load(), lineno=28, col_offset=20, end_lineno=28, end_col_offset=28), ctx=Load(), lineno=28, col_offset=11, end_lineno=28, end_col_offset=29), value=Call(func=Name(id='LRUCache', ctx=Load(), lineno=28, col_offset=32, end_lineno=28, end_col_offset=40), keywords=[keyword(arg='maxsize', value=Constant(value=2, lineno=28, col_offset=49, end_lineno=28, end_col_offset=50), lineno=28, col_offset=41, end_lineno=28, end_col_offset=50), keyword(arg='ttl_seconds', value=Constant(value=None, lineno=28, col_offset=64, end_lineno=28, end_col_offset=68), lineno=28, col_offset=52, end_lineno=28, end_col_offset=68), keyword(arg='now_fn', value=Attribute(value=Name(id='clock', ctx=Load(), lineno=28, col_offset=77, end_lineno=28, end_col_offset=82), attr='now', ctx=Load(), lineno=28, col_offset=77, end_lineno=28, end_col_offset=86), lineno=28, col_offset=70, end_lineno=28, end_col_offset=86)], lineno=28, col_offset=32, end_lineno=28, end_col_offset=87), simple=1, lineno=28, col_offset=4, end_lineno=28, end_col_offset=87), Expr(value=Call(func=Attribute(value=Name(id='cache', ctx=Load(), lineno=30, col_offset=4, end_lineno=30, end_col_offset=9), attr='set', ctx=Load(), lineno=30, col_offset=4, end_lineno=30, end_col_offset=13), args=[Constant(value='a', lineno=30, col_offset=14, end_lineno=30, end_col_offset=17), Constant(value=1, lineno=30, col_offset=19, end_lineno=30, end_col_offset=20)], lineno=30, col_offset=4, end_lineno=30, end_col_offset=21), lineno=30, col_offset=4, end_lineno=30, end_col_offset=21), Expr(value=Call(func=Attribute(value=Name(id='cache', ctx=Load(), lineno=31, col_offset=4, end_lineno=31, end_col_offset=9), attr='set', ctx=Load(), lineno=31, col_offset=4, end_lineno=31, end_col_offset=13), args=[Constant(value='b', lineno=31, col_offset=14, end_lineno=31, end_col_offset=17), Constant(value=2, lineno=31, col_offset=19, end_lineno=31, end_col_offset=20)], lineno=31, col_offset=4, end_lineno=31, end_col_offset=21), lineno=31, col_offset=4, end_lineno=31, end_col_offset=21), Assert(test=Compare(left=Call(func=Attribute(value=Name(id='cache', ctx=Load(), lineno=33, col_offset=11, end_lineno=33, end_col_offset=16), attr='get', ctx=Load(), lineno=33, col_offset=11, end_lineno=33, end_col_offset=20), args=[Constant(value='a', lineno=33, col_offset=21, end_lineno=33, end_col_offset=24)], lineno=33, col_offset=11, end_lineno=33, end_col_offset=25), ops=[Eq()], comparators=[Constant(value=1, lineno=33, col_offset=29, end_lineno=33, end_col_offset=30)], lineno=33, col_offset=11, end_lineno=33, end_col_offset=30), lineno=33, col_offset=4, end_lineno=33, end_col_offset=30), Expr(value=Call(func=Attribute(value=Name(id='cache', ctx=Load(), lineno=35, col_offset=4, end_lineno=35, end_col_offset=9), attr='set', ctx=Load(), lineno=35, col_offset=4, end_lineno=35, end_col_offset=13), args=[Constant(value='c', lineno=35, col_offset=14, end_lineno=35, end_col_offset=17), Constant(value=3, lineno=35, col_offset=19, end_lineno=35, end_col_offset=20)], lineno=35, col_offset=4, end_lineno=35, end_col_offset=21), lineno=35, col_offset=4, end_lineno=35, end_col_offset=21), Assert(test=Compare(left=Constant(value='a', lineno=37, col_offset=11, end_lineno=37, end_col_offset=14), ops=[In()], comparators=[Name(id='cache', ctx=Load(), lineno=37, col_offset=18, end_lineno=37, end_col_offset=23)], lineno=37, col_offset=11, end_lineno=37, end_col_offset=23), lineno=37, col_offset=4, end_lineno=37, end_col_offset=23), Assert(test=Compare(left=Constant(value='c', lineno=38, col_offset=11, end_lineno=38, end_col_offset=14), ops=[In()], comparators=[Name(id='cache', ctx=Load(), lineno=38, col_offset=18, end_lineno=38, end_col_offset=23)], lineno=38, col_offset=11, end_lineno=38, end_col_offset=23), lineno=38, col_offset=4, end_lineno=38, end_col_offset=23), Assert(test=Compare(left=Call(func=Attribute(value=Name(id='cache', ctx=Load(), lineno=39, col_offset=11, end_lineno=39, end_col_offset=16), attr='get', ctx=Load(), lineno=39, col_offset=11, end_lineno=39, end_col_offset=20), args=[Constant(value='b', lineno=39, col_offset=21, end_lineno=39, end_col_offset=24)], lineno=39, col_offset=11, end_lineno=39, end_col_offset=25), ops=[Is()], comparators=[Constant(value=None, lineno=39, col_offset=29, end_lineno=39, end_col_offset=33)], lineno=39, col_offset=11, end_lineno=39, end_col_offset=33), lineno=39, col_offset=4, end_lineno=39, end_col_offset=33), Assert(test=Compare(left=Call(func=Attribute(value=Name(id='cache', ctx=Load(), lineno=40, col_offset=11, end_lineno=40, end_col_offset=16), attr='snapshot', ctx=Load(), lineno=40, col_offset=11, end_lineno=40, end_col_offset=25), lineno=40, col_offset=11, end_lineno=40, end_col_offset=27), ops=[Eq()], comparators=[Dict(keys=[Constant(value='a', lineno=40, col_offset=32, end_lineno=40, end_col_offset=35), Constant(value='c', lineno=40, col_offset=40, end_lineno=40, end_col_offset=43)], values=[Constant(value=1, lineno=40, col_offset=37, end_lineno=40, end_col_offset=38), Constant(value=3, lineno=40, col_offset=45, end_lineno=40, end_col_offset=46)], lineno=40, col_offset=31, end_lineno=40, end_col_offset=47)], lineno=40, col_offset=11, end_lineno=40, end_col_offset=47), lineno=40, col_offset=4, end_lineno=40, end_col_offset=47)], returns=Constant(value=None, lineno=26, col_offset=51, end_lineno=26, end_col_offset=55), lineno=26, col_offset=0, end_lineno=40, end_col_offset=47), FunctionDef(name='test_lru_cache_ttl_expires_entries_on_access', args=arguments(), body=[Assign(targets=[Name(id='clock', ctx=Store(), lineno=44, col_offset=4, end_lineno=44, end_col_offset=9)], value=Call(func=Name(id='FakeClock', ctx=Load(), lineno=44, col_offset=12, end_lineno=44, end_col_offset=21), lineno=44, col_offset=12, end_lineno=44, end_col_offset=23), lineno=44, col_offset=4, end_lineno=44, end_col_offset=23), AnnAssign(target=Name(id='cache', ctx=Store(), lineno=45, col_offset=4, end_lineno=45, end_col_offset=9), annotation=Subscript(value=Name(id='LRUCache', ctx=Load(), lineno=45, col_offset=11, end_lineno=45, end_col_offset=19), slice=Tuple(elts=[Name(id='str', ctx=Load(), lineno=45, col_offset=20, end_lineno=45, end_col_offset=23), Name(id='str', ctx=Load(), lineno=45, col_offset=25, end_lineno=45, end_col_offset=28)], ctx=Load(), lineno=45, col_offset=20, end_lineno=45, end_col_offset=28), ctx=Load(), lineno=45, col_offset=11, end_lineno=45, end_col_offset=29), value=Call(func=Name(id='LRUCache', ctx=Load(), lineno=45, col_offset=32, end_lineno=45, end_col_offset=40), keywords=[keyword(arg='maxsize', value=Constant(value=4, lineno=45, col_offset=49, end_lineno=45, end_col_offset=50), lineno=45, col_offset=41, end_lineno=45, end_col_offset=50), keyword(arg='ttl_seconds', value=Constant(value=1.0, lineno=45, col_offset=64, end_lineno=45, end_col_offset=67), lineno=45, col_offset=52, end_lineno=45, end_col_offset=67), keyword(arg='now_fn', value=Attribute(value=Name(id='clock', ctx=Load(), lineno=45, col_offset=76, end_lineno=45, end_col_offset=81), attr='now', ctx=Load(), lineno=45, col_offset=76, end_lineno=45, end_col_offset=85), lineno=45, col_offset=69, end_lineno=45, end_col_offset=85)], lineno=45, col_offset=32, end_lineno=45, end_col_offset=86), simple=1, lineno=45, col_offset=4, end_lineno=45, end_col_offset=86), Expr(value=Call(func=Attribute(value=Name(id='cache', ctx=Load(), lineno=47, col_offset=4, end_lineno=47, end_col_offset=9), attr='set', ctx=Load(), lineno=47, col_offset=4, end_lineno=47, end_col_offset=13), args=[Constant(value='token', lineno=47, col_offset=14, end_lineno=47, end_col_offset=21), Constant(value='value', lineno=47, col_offset=23, end_lineno=47, end_col_offset=30)], lineno=47, col_offset=4, end_lineno=47, end_col_offset=31), lineno=47, col_offset=4, end_lineno=47, end_col_offset=31), Assert(test=Compare(left=Call(func=Attribute(value=Name(id='cache', ctx=Load(), lineno=48, col_offset=11, end_lineno=48, end_col_offset=16), attr='get', ctx=Load(), lineno=48, col_offset=11, end_lineno=48, end_col_offset=20), args=[Constant(value='token', lineno=48, col_offset=21, end_lineno=48, end_col_offset=28)], lineno=48, col_offset=11, end_lineno=48, end_col_offset=29), ops=[Eq()], comparators=[Constant(value='value', lineno=48, col_offset=33, end_lineno=48, end_col_offset=40)], lineno=48, col_offset=11, end_lineno=48, end_col_offset=40), lineno=48, col_offset=4, end_lineno=48, end_col_offset=40), Expr(value=Call(func=Attribute(value=Name(id='clock', ctx=Load(), lineno=50, col_offset=4, end_lineno=50, end_col_offset=9), attr='advance', ctx=Load(), lineno=50, col_offset=4, end_lineno=50, end_col_offset=17), args=[Constant(value=0.9, lineno=50, col_offset=18, end_lineno=50, end_col_offset=21)], lineno=50, col_offset=4, end_lineno=50, end_col_offset=22), lineno=50, col_offset=4, end_lineno=50, end_col_offset=22), Assert(test=Compare(left=Call(func=Attribute(value=Name(id='cache', ctx=Load(), lineno=51, col_offset=11, end_lineno=51, end_col_offset=16), attr='get', ctx=Load(), lineno=51, col_offset=11, end_lineno=51, end_col_offset=20), args=[Constant(value='token', lineno=51, col_offset=21, end_lineno=51, end_col_offset=28)], lineno=51, col_offset=11, end_lineno=51, end_col_offset=29), ops=[Eq()], comparators=[Constant(value='value', lineno=51, col_offset=33, end_lineno=51, end_col_offset=40)], lineno=51, col_offset=11, end_lineno=51, end_col_offset=40), lineno=51, col_offset=4, end_lineno=51, end_col_offset=40), Expr(value=Call(func=Attribute(value=Name(id='clock', ctx=Load(), lineno=53, col_offset=4, end_lineno=53, end_col_offset=9), attr='advance', ctx=Load(), lineno=53, col_offset=4, end_lineno=53, end_col_offset=17), args=[Constant(value=0.2, lineno=53, col_offset=18, end_lineno=53, end_col_offset=21)], lineno=53, col_offset=4, end_lineno=53, end_col_offset=22), lineno=53, col_offset=4, end_lineno=53, end_col_offset=22), Assert(test=Compare(left=Call(func=Attribute(value=Name(id='cache', ctx=Load(), lineno=54, col_offset=11, end_lineno=54, end_col_offset=16), attr='get', ctx=Load(), lineno=54, col_offset=11, end_lineno=54, end_col_offset=20), args=[Constant(value='token', lineno=54, col_offset=21, end_lineno=54, end_col_offset=28)], lineno=54, col_offset=11, end_lineno=54, end_col_offset=29), ops=[Is()], comparators=[Constant(value=None, lineno=54, col_offset=33, end_lineno=54, end_col_offset=37)], lineno=54, col_offset=11, end_lineno=54, end_col_offset=37), lineno=54, col_offset=4, end_lineno=54, end_col_offset=37), Assert(test=Compare(left=Constant(value='token', lineno=55, col_offset=11, end_lineno=55, end_col_offset=18), ops=[NotIn()], comparators=[Name(id='cache', ctx=Load(), lineno=55, col_offset=26, end_lineno=55, end_col_offset=31)], lineno=55, col_offset=11, end_lineno=55, end_col_offset=31), lineno=55, col_offset=4, end_lineno=55, end_col_offset=31), Assert(test=Compare(left=Call(func=Name(id='len', ctx=Load(), lineno=56, col_offset=11, end_lineno=56, end_col_offset=14), args=[Name(id='cache', ctx=Load(), lineno=56, col_offset=15, end_lineno=56, end_col_offset=20)], lineno=56, col_offset=11, end_lineno=56, end_col_offset=21), ops=[Eq()], comparators=[Constant(value=0, lineno=56, col_offset=25, end_lineno=56, end_col_offset=26)], lineno=56, col_offset=11, end_lineno=56, end_col_offset=26), lineno=56, col_offset=4, end_lineno=56, end_col_offset=26)], returns=Constant(value=None, lineno=43, col_offset=54, end_lineno=43, end_col_offset=58), lineno=43, col_offset=0, end_lineno=56, end_col_offset=26), FunctionDef(name='test_lru_cache_is_thread_safe', args=arguments(), body=[AnnAssign(target=Name(id='cache', ctx=Store(), lineno=60, col_offset=4, end_lineno=60, end_col_offset=9), annotation=Subscript(value=Name(id='LRUCache', ctx=Load(), lineno=60, col_offset=11, end_lineno=60, end_col_offset=19), slice=Tuple(elts=[Name(id='str', ctx=Load(), lineno=60, col_offset=20, end_lineno=60, end_col_offset=23), Name(id='int', ctx=Load(), lineno=60, col_offset=25, end_lineno=60, end_col_offset=28)], ctx=Load(), lineno=60, col_offset=20, end_lineno=60, end_col_offset=28), ctx=Load(), lineno=60, col_offset=11, end_lineno=60, end_col_offset=29), value=Call(func=Name(id='LRUCache', ctx=Load(), lineno=60, col_offset=32, end_lineno=60, end_col_offset=40), keywords=[keyword(arg='maxsize', value=Constant(value=128, lineno=60, col_offset=49, end_lineno=60, end_col_offset=52), lineno=60, col_offset=41, end_lineno=60, end_col_offset=52), keyword(arg='ttl_seconds', value=Constant(value=None, lineno=60, col_offset=66, end_lineno=60, end_col_offset=70), lineno=60, col_offset=54, end_lineno=60, end_col_offset=70)], lineno=60, col_offset=32, end_lineno=60, end_col_offset=71), simple=1, lineno=60, col_offset=4, end_lineno=60, end_col_offset=71), FunctionDef(name='writer_reader', args=arguments(args=[arg(arg='idx', annotation=Name(id='int', ctx=Load(), lineno=62, col_offset=27, end_lineno=62, end_col_offset=30), lineno=62, col_offset=22, end_lineno=62, end_col_offset=30)]), body=[Expr(value=Call(func=Attribute(value=Name(id='cache', ctx=Load(), lineno=63, col_offset=8, end_lineno=63, end_col_offset=13), attr='set', ctx=Load(), lineno=63, col_offset=8, end_lineno=63, end_col_offset=17), args=[JoinedStr(values=[Constant(value='key-', lineno=63, col_offset=20, end_lineno=63, end_col_offset=24), FormattedValue(value=Name(id='idx', ctx=Load(), lineno=63, col_offset=25, end_lineno=63, end_col_offset=28), conversion=-1, lineno=63, col_offset=24, end_lineno=63, end_col_offset=29)], lineno=63, col_offset=18, end_lineno=63, end_col_offset=30), Name(id='idx', ctx=Load(), lineno=63, col_offset=32, end_lineno=63, end_col_offset=35)], lineno=63, col_offset=8, end_lineno=63, end_col_offset=36), lineno=63, col_offset=8, end_lineno=63, end_col_offset=36), Return(value=Call(func=Attribute(value=Name(id='cache', ctx=Load(), lineno=64, col_offset=15, end_lineno=64, end_col_offset=20), attr='get', ctx=Load(), lineno=64, col_offset=15, end_lineno=64, end_col_offset=24), args=[JoinedStr(values=[Constant(value='key-', lineno=64, col_offset=27, end_lineno=64, end_col_offset=31), FormattedValue(value=Name(id='idx', ctx=Load(), lineno=64, col_offset=32, end_lineno=64, end_col_offset=35), conversion=-1, lineno=64, col_offset=31, end_lineno=64, end_col_offset=36)], lineno=64, col_offset=25, end_lineno=64, end_col_offset=37)], lineno=64, col_offset=15, end_lineno=64, end_col_offset=38), lineno=64, col_offset=8, end_lineno=64, end_col_offset=38)], returns=BinOp(left=Name(id='int', ctx=Load(), lineno=62, col_offset=35, end_lineno=62, end_col_offset=38), op=BitOr(), right=Constant(value=None, lineno=62, col_offset=41, end_lineno=62, end_col_offset=45), lineno=62, col_offset=35, end_lineno=62, end_col_offset=45), lineno=62, col_offset=4, end_lineno=64, end_col_offset=38), With(items=[withitem(context_expr=Call(func=Name(id='ThreadPoolExecutor', ctx=Load(), lineno=66, col_offset=9, end_lineno=66, end_col_offset=27), keywords=[keyword(arg='max_workers', value=Constant(value=16, lineno=66, col_offset=40, end_lineno=66, end_col_offset=42), lineno=66, col_offset=28, end_lineno=66, end_col_offset=42)], lineno=66, col_offset=9, end_lineno=66, end_col_offset=43), optional_vars=Name(id='executor', ctx=Store(), lineno=66, col_offset=47, end_lineno=66, end_col_offset=55))], body=[Assign(targets=[Name(id='results', ctx=Store(), lineno=67, col_offset=8, end_lineno=67, end_col_offset=15)], value=Call(func=Name(id='list', ctx=Load(), lineno=67, col_offset=18, end_lineno=67, end_col_offset=22), args=[Call(func=Attribute(value=Name(id='executor', ctx=Load(), lineno=67, col_offset=23, end_lineno=67, end_col_offset=31), attr='map', ctx=Load(), lineno=67, col_offset=23, end_lineno=67, end_col_offset=35), args=[Name(id='writer_reader', ctx=Load(), lineno=67, col_offset=36, end_lineno=67, end_col_offset=49), Call(func=Name(id='range', ctx=Load(), lineno=67, col_offset=51, end_lineno=67, end_col_offset=56), args=[Constant(value=64, lineno=67, col_offset=57, end_lineno=67, end_col_offset=59)], lineno=67, col_offset=51, end_lineno=67, end_col_offset=60)], lineno=67, col_offset=23, end_lineno=67, end_col_offset=61)], lineno=67, col_offset=18, end_lineno=67, end_col_offset=62), lineno=67, col_offset=8, end_lineno=67, end_col_offset=62)], lineno=66, col_offset=4, end_lineno=67, end_col_offset=62), Assign(targets=[Name(id='observed', ctx=Store(), lineno=69, col_offset=4, end_lineno=69, end_col_offset=12)], value=SetComp(elt=Name(id='value', ctx=Load(), lineno=69, col_offset=16, end_lineno=69, end_col_offset=21), generators=[comprehension(target=Name(id='value', ctx=Store(), lineno=69, col_offset=26, end_lineno=69, end_col_offset=31), iter=Name(id='results', ctx=Load(), lineno=69, col_offset=35, end_lineno=69, end_col_offset=42), ifs=[Compare(left=Name(id='value', ctx=Load(), lineno=69, col_offset=46, end_lineno=69, end_col_offset=51), ops=[IsNot()], comparators=[Constant(value=None, lineno=69, col_offset=59, end_lineno=69, end_col_offset=63)], lineno=69, col_offset=46, end_lineno=69, end_col_offset=63)], is_async=0)], lineno=69, col_offset=15, end_lineno=69, end_col_offset=64), lineno=69, col_offset=4, end_lineno=69, end_col_offset=64), Assert(test=Compare(left=Name(id='observed', ctx=Load(), lineno=70, col_offset=11, end_lineno=70, end_col_offset=19), ops=[Eq()], comparators=[Call(func=Name(id='set', ctx=Load(), lineno=70, col_offset=23, end_lineno=70, end_col_offset=26), args=[Call(func=Name(id='range', ctx=Load(), lineno=70, col_offset=27, end_lineno=70, end_col_offset=32), args=[Constant(value=64, lineno=70, col_offset=33, end_lineno=70, end_col_offset=35)], lineno=70, col_offset=27, end_lineno=70, end_col_offset=36)], lineno=70, col_offset=23, end_lineno=70, end_col_offset=37)], lineno=70, col_offset=11, end_lineno=70, end_col_offset=37), lineno=70, col_offset=4, end_lineno=70, end_col_offset=37), Assert(test=Compare(left=Call(func=Name(id='len', ctx=Load(), lineno=71, col_offset=11, end_lineno=71, end_col_offset=14), args=[Name(id='cache', ctx=Load(), lineno=71, col_offset=15, end_lineno=71, end_col_offset=20)], lineno=71, col_offset=11, end_lineno=71, end_col_offset=21), ops=[Eq()], comparators=[Constant(value=64, lineno=71, col_offset=25, end_lineno=71, end_col_offset=27)], lineno=71, col_offset=11, end_lineno=71, end_col_offset=27), lineno=71, col_offset=4, end_lineno=71, end_col_offset=27)], returns=Constant(value=None, lineno=59, col_offset=39, end_lineno=59, end_col_offset=43), lineno=59, col_offset=0, end_lineno=71, end_col_offset=27), ClassDef(name='FakeRedis', body=[Expr(value=Constant(value='Minimal in-memory Redis analogue for testing.', lineno=75, col_offset=4, end_lineno=75, end_col_offset=55), lineno=75, col_offset=4, end_lineno=75, end_col_offset=55), FunctionDef(name='__init__', args=arguments(args=[arg(arg='self', lineno=77, col_offset=17, end_lineno=77, end_col_offset=21)]), body=[AnnAssign(target=Attribute(value=Name(id='self', ctx=Load(), lineno=78, col_offset=8, end_lineno=78, end_col_offset=12), attr='_data', ctx=Store(), lineno=78, col_offset=8, end_lineno=78, end_col_offset=18), annotation=Subscript(value=Name(id='dict', ctx=Load(), lineno=78, col_offset=20, end_lineno=78, end_col_offset=24), slice=Tuple(elts=[Name(id='str', ctx=Load(), lineno=78, col_offset=25, end_lineno=78, end_col_offset=28), Subscript(value=Name(id='tuple', ctx=Load(), lineno=78, col_offset=30, end_lineno=78, end_col_offset=35), slice=Tuple(elts=[Name(id='bytes', ctx=Load(), lineno=78, col_offset=36, end_lineno=78, end_col_offset=41), BinOp(left=Name(id='float', ctx=Load(), lineno=78, col_offset=43, end_lineno=78, end_col_offset=48), op=BitOr(), right=Constant(value=None, lineno=78, col_offset=51, end_lineno=78, end_col_offset=55), lineno=78, col_offset=43, end_lineno=78, end_col_offset=55)], ctx=Load(), lineno=78, col_offset=36, end_lineno=78, end_col_offset=55), ctx=Load(), lineno=78, col_offset=30, end_lineno=78, end_col_offset=56)], ctx=Load(), lineno=78, col_offset=25, end_lineno=78, end_col_offset=56), ctx=Load(), lineno=78, col_offset=20, end_lineno=78, end_col_offset=57), value=Dict(lineno=78, col_offset=60, end_lineno=78, end_col_offset=62), simple=0, lineno=78, col_offset=8, end_lineno=78, end_col_offset=62), Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=79, col_offset=8, end_lineno=79, end_col_offset=12), attr='get_calls', ctx=Store(), lineno=79, col_offset=8, end_lineno=79, end_col_offset=22)], value=Constant(value=0, lineno=79, col_offset=25, end_lineno=79, end_col_offset=26), lineno=79, col_offset=8, end_lineno=79, end_col_offset=26), Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=80, col_offset=8, end_lineno=80, end_col_offset=12), attr='set_calls', ctx=Store(), lineno=80, col_offset=8, end_lineno=80, end_col_offset=22)], value=Constant(value=0, lineno=80, col_offset=25, end_lineno=80, end_col_offset=26), lineno=80, col_offset=8, end_lineno=80, end_col_offset=26), AnnAssign(target=Attribute(value=Name(id='self', ctx=Load(), lineno=81, col_offset=8, end_lineno=81, end_col_offset=12), attr='setex_calls', ctx=Store(), lineno=81, col_offset=8, end_lineno=81, end_col_offset=24), annotation=Subscript(value=Name(id='list', ctx=Load(), lineno=81, col_offset=26, end_lineno=81, end_col_offset=30), slice=Name(id='int', ctx=Load(), lineno=81, col_offset=31, end_lineno=81, end_col_offset=34), ctx=Load(), lineno=81, col_offset=26, end_lineno=81, end_col_offset=35), value=List(ctx=Load(), lineno=81, col_offset=38, end_lineno=81, end_col_offset=40), simple=0, lineno=81, col_offset=8, end_lineno=81, end_col_offset=40)], returns=Constant(value=None, lineno=77, col_offset=26, end_lineno=77, end_col_offset=30), lineno=77, col_offset=4, end_lineno=81, end_col_offset=40), AsyncFunctionDef(name='get', args=arguments(args=[arg(arg='self', lineno=83, col_offset=18, end_lineno=83, end_col_offset=22), arg(arg='name', annotation=Name(id='str', ctx=Load(), lineno=83, col_offset=30, end_lineno=83, end_col_offset=33), lineno=83, col_offset=24, end_lineno=83, end_col_offset=33)]), body=[AugAssign(target=Attribute(value=Name(id='self', ctx=Load(), lineno=84, col_offset=8, end_lineno=84, end_col_offset=12), attr='get_calls', ctx=Store(), lineno=84, col_offset=8, end_lineno=84, end_col_offset=22), op=Add(), value=Constant(value=1, lineno=84, col_offset=26, end_lineno=84, end_col_offset=27), lineno=84, col_offset=8, end_lineno=84, end_col_offset=27), Assign(targets=[Name(id='record', ctx=Store(), lineno=85, col_offset=8, end_lineno=85, end_col_offset=14)], value=Call(func=Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=85, col_offset=17, end_lineno=85, end_col_offset=21), attr='_data', ctx=Load(), lineno=85, col_offset=17, end_lineno=85, end_col_offset=27), attr='get', ctx=Load(), lineno=85, col_offset=17, end_lineno=85, end_col_offset=31), args=[Name(id='name', ctx=Load(), lineno=85, col_offset=32, end_lineno=85, end_col_offset=36)], lineno=85, col_offset=17, end_lineno=85, end_col_offset=37), lineno=85, col_offset=8, end_lineno=85, end_col_offset=37), If(test=Compare(left=Name(id='record', ctx=Load(), lineno=86, col_offset=11, end_lineno=86, end_col_offset=17), ops=[Is()], comparators=[Constant(value=None, lineno=86, col_offset=21, end_lineno=86, end_col_offset=25)], lineno=86, col_offset=11, end_lineno=86, end_col_offset=25), body=[Return(value=Constant(value=None, lineno=87, col_offset=19, end_lineno=87, end_col_offset=23), lineno=87, col_offset=12, end_lineno=87, end_col_offset=23)], lineno=86, col_offset=8, end_lineno=87, end_col_offset=23), Assign(targets=[Tuple(elts=[Name(id='value', ctx=Store(), lineno=88, col_offset=8, end_lineno=88, end_col_offset=13), Name(id='expires_at', ctx=Store(), lineno=88, col_offset=15, end_lineno=88, end_col_offset=25)], ctx=Store(), lineno=88, col_offset=8, end_lineno=88, end_col_offset=25)], value=Name(id='record', ctx=Load(), lineno=88, col_offset=28, end_lineno=88, end_col_offset=34), lineno=88, col_offset=8, end_lineno=88, end_col_offset=34), If(test=BoolOp(op=And(), values=[Compare(left=Name(id='expires_at', ctx=Load(), lineno=89, col_offset=11, end_lineno=89, end_col_offset=21), ops=[IsNot()], comparators=[Constant(value=None, lineno=89, col_offset=29, end_lineno=89, end_col_offset=33)], lineno=89, col_offset=11, end_lineno=89, end_col_offset=33), Compare(left=Name(id='expires_at', ctx=Load(), lineno=89, col_offset=38, end_lineno=89, end_col_offset=48), ops=[LtE()], comparators=[Call(func=Attribute(value=Name(id='time_module', ctx=Load(), lineno=89, col_offset=52, end_lineno=89, end_col_offset=63), attr='monotonic', ctx=Load(), lineno=89, col_offset=52, end_lineno=89, end_col_offset=73), lineno=89, col_offset=52, end_lineno=89, end_col_offset=75)], lineno=89, col_offset=38, end_lineno=89, end_col_offset=75)], lineno=89, col_offset=11, end_lineno=89, end_col_offset=75), body=[Expr(value=Call(func=Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=90, col_offset=12, end_lineno=90, end_col_offset=16), attr='_data', ctx=Load(), lineno=90, col_offset=12, end_lineno=90, end_col_offset=22), attr='pop', ctx=Load(), lineno=90, col_offset=12, end_lineno=90, end_col_offset=26), args=[Name(id='name', ctx=Load(), lineno=90, col_offset=27, end_lineno=90, end_col_offset=31), Constant(value=None, lineno=90, col_offset=33, end_lineno=90, end_col_offset=37)], lineno=90, col_offset=12, end_lineno=90, end_col_offset=38), lineno=90, col_offset=12, end_lineno=90, end_col_offset=38), Return(value=Constant(value=None, lineno=91, col_offset=19, end_lineno=91, end_col_offset=23), lineno=91, col_offset=12, end_lineno=91, end_col_offset=23)], lineno=89, col_offset=8, end_lineno=91, end_col_offset=23), Return(value=Name(id='value', ctx=Load(), lineno=92, col_offset=15, end_lineno=92, end_col_offset=20), lineno=92, col_offset=8, end_lineno=92, end_col_offset=20)], returns=BinOp(left=Name(id='bytes', ctx=Load(), lineno=83, col_offset=38, end_lineno=83, end_col_offset=43), op=BitOr(), right=Constant(value=None, lineno=83, col_offset=46, end_lineno=83, end_col_offset=50), lineno=83, col_offset=38, end_lineno=83, end_col_offset=50), lineno=83, col_offset=4, end_lineno=92, end_col_offset=20), AsyncFunctionDef(name='setex', args=arguments(args=[arg(arg='self', lineno=94, col_offset=20, end_lineno=94, end_col_offset=24), arg(arg='name', annotation=Name(id='str', ctx=Load(), lineno=94, col_offset=32, end_lineno=94, end_col_offset=35), lineno=94, col_offset=26, end_lineno=94, end_col_offset=35), arg(arg='time', annotation=Name(id='int', ctx=Load(), lineno=94, col_offset=43, end_lineno=94, end_col_offset=46), lineno=94, col_offset=37, end_lineno=94, end_col_offset=46), arg(arg='value', annotation=Name(id='bytes', ctx=Load(), lineno=94, col_offset=55, end_lineno=94, end_col_offset=60), lineno=94, col_offset=48, end_lineno=94, end_col_offset=60)]), body=[Assign(targets=[Name(id='expires_at', ctx=Store(), lineno=95, col_offset=8, end_lineno=95, end_col_offset=18)], value=IfExp(test=Compare(left=Name(id='time', ctx=Load(), lineno=95, col_offset=55, end_lineno=95, end_col_offset=59), ops=[Gt()], comparators=[Constant(value=0, lineno=95, col_offset=62, end_lineno=95, end_col_offset=63)], lineno=95, col_offset=55, end_lineno=95, end_col_offset=63), body=BinOp(left=Call(func=Attribute(value=Name(id='time_module', ctx=Load(), lineno=95, col_offset=21, end_lineno=95, end_col_offset=32), attr='monotonic', ctx=Load(), lineno=95, col_offset=21, end_lineno=95, end_col_offset=42), lineno=95, col_offset=21, end_lineno=95, end_col_offset=44), op=Add(), right=Name(id='time', ctx=Load(), lineno=95, col_offset=47, end_lineno=95, end_col_offset=51), lineno=95, col_offset=21, end_lineno=95, end_col_offset=51), orelse=Constant(value=None, lineno=95, col_offset=69, end_lineno=95, end_col_offset=73), lineno=95, col_offset=21, end_lineno=95, end_col_offset=73), lineno=95, col_offset=8, end_lineno=95, end_col_offset=73), Expr(value=Call(func=Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=96, col_offset=8, end_lineno=96, end_col_offset=12), attr='setex_calls', ctx=Load(), lineno=96, col_offset=8, end_lineno=96, end_col_offset=24), attr='append', ctx=Load(), lineno=96, col_offset=8, end_lineno=96, end_col_offset=31), args=[Name(id='time', ctx=Load(), lineno=96, col_offset=32, end_lineno=96, end_col_offset=36)], lineno=96, col_offset=8, end_lineno=96, end_col_offset=37), lineno=96, col_offset=8, end_lineno=96, end_col_offset=37), Assign(targets=[Subscript(value=Attribute(value=Name(id='self', ctx=Load(), lineno=97, col_offset=8, end_lineno=97, end_col_offset=12), attr='_data', ctx=Load(), lineno=97, col_offset=8, end_lineno=97, end_col_offset=18), slice=Name(id='name', ctx=Load(), lineno=97, col_offset=19, end_lineno=97, end_col_offset=23), ctx=Store(), lineno=97, col_offset=8, end_lineno=97, end_col_offset=24)], value=Tuple(elts=[Name(id='value', ctx=Load(), lineno=97, col_offset=28, end_lineno=97, end_col_offset=33), Name(id='expires_at', ctx=Load(), lineno=97, col_offset=35, end_lineno=97, end_col_offset=45)], ctx=Load(), lineno=97, col_offset=27, end_lineno=97, end_col_offset=46), lineno=97, col_offset=8, end_lineno=97, end_col_offset=46), Return(value=Constant(value=True, lineno=98, col_offset=15, end_lineno=98, end_col_offset=19), lineno=98, col_offset=8, end_lineno=98, end_col_offset=19)], returns=BinOp(left=Name(id='bool', ctx=Load(), lineno=94, col_offset=65, end_lineno=94, end_col_offset=69), op=BitOr(), right=Constant(value=None, lineno=94, col_offset=72, end_lineno=94, end_col_offset=76), lineno=94, col_offset=65, end_lineno=94, end_col_offset=76), lineno=94, col_offset=4, end_lineno=98, end_col_offset=19), AsyncFunctionDef(name='set', args=arguments(args=[arg(arg='self', lineno=100, col_offset=18, end_lineno=100, end_col_offset=22), arg(arg='name', annotation=Name(id='str', ctx=Load(), lineno=100, col_offset=30, end_lineno=100, end_col_offset=33), lineno=100, col_offset=24, end_lineno=100, end_col_offset=33), arg(arg='value', annotation=Name(id='bytes', ctx=Load(), lineno=100, col_offset=42, end_lineno=100, end_col_offset=47), lineno=100, col_offset=35, end_lineno=100, end_col_offset=47)]), body=[AugAssign(target=Attribute(value=Name(id='self', ctx=Load(), lineno=101, col_offset=8, end_lineno=101, end_col_offset=12), attr='set_calls', ctx=Store(), lineno=101, col_offset=8, end_lineno=101, end_col_offset=22), op=Add(), value=Constant(value=1, lineno=101, col_offset=26, end_lineno=101, end_col_offset=27), lineno=101, col_offset=8, end_lineno=101, end_col_offset=27), Assign(targets=[Subscript(value=Attribute(value=Name(id='self', ctx=Load(), lineno=102, col_offset=8, end_lineno=102, end_col_offset=12), attr='_data', ctx=Load(), lineno=102, col_offset=8, end_lineno=102, end_col_offset=18), slice=Name(id='name', ctx=Load(), lineno=102, col_offset=19, end_lineno=102, end_col_offset=23), ctx=Store(), lineno=102, col_offset=8, end_lineno=102, end_col_offset=24)], value=Tuple(elts=[Name(id='value', ctx=Load(), lineno=102, col_offset=28, end_lineno=102, end_col_offset=33), Constant(value=None, lineno=102, col_offset=35, end_lineno=102, end_col_offset=39)], ctx=Load(), lineno=102, col_offset=27, end_lineno=102, end_col_offset=40), lineno=102, col_offset=8, end_lineno=102, end_col_offset=40), Return(value=Constant(value=True, lineno=103, col_offset=15, end_lineno=103, end_col_offset=19), lineno=103, col_offset=8, end_lineno=103, end_col_offset=19)], returns=BinOp(left=Name(id='bool', ctx=Load(), lineno=100, col_offset=52, end_lineno=100, end_col_offset=56), op=BitOr(), right=Constant(value=None, lineno=100, col_offset=59, end_lineno=100, end_col_offset=63), lineno=100, col_offset=52, end_lineno=100, end_col_offset=63), lineno=100, col_offset=4, end_lineno=103, end_col_offset=19), AsyncFunctionDef(name='delete', args=arguments(args=[arg(arg='self', lineno=105, col_offset=21, end_lineno=105, end_col_offset=25)], vararg=arg(arg='names', annotation=Name(id='str', ctx=Load(), lineno=105, col_offset=35, end_lineno=105, end_col_offset=38), lineno=105, col_offset=28, end_lineno=105, end_col_offset=38)), body=[Assign(targets=[Name(id='removed', ctx=Store(), lineno=106, col_offset=8, end_lineno=106, end_col_offset=15)], value=Constant(value=0, lineno=106, col_offset=18, end_lineno=106, end_col_offset=19), lineno=106, col_offset=8, end_lineno=106, end_col_offset=19), For(target=Name(id='entry', ctx=Store(), lineno=107, col_offset=12, end_lineno=107, end_col_offset=17), iter=Name(id='names', ctx=Load(), lineno=107, col_offset=21, end_lineno=107, end_col_offset=26), body=[If(test=Compare(left=Call(func=Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=108, col_offset=15, end_lineno=108, end_col_offset=19), attr='_data', ctx=Load(), lineno=108, col_offset=15, end_lineno=108, end_col_offset=25), attr='pop', ctx=Load(), lineno=108, col_offset=15, end_lineno=108, end_col_offset=29), args=[Name(id='entry', ctx=Load(), lineno=108, col_offset=30, end_lineno=108, end_col_offset=35), Constant(value=None, lineno=108, col_offset=37, end_lineno=108, end_col_offset=41)], lineno=108, col_offset=15, end_lineno=108, end_col_offset=42), ops=[IsNot()], comparators=[Constant(value=None, lineno=108, col_offset=50, end_lineno=108, end_col_offset=54)], lineno=108, col_offset=15, end_lineno=108, end_col_offset=54), body=[AugAssign(target=Name(id='removed', ctx=Store(), lineno=109, col_offset=16, end_lineno=109, end_col_offset=23), op=Add(), value=Constant(value=1, lineno=109, col_offset=27, end_lineno=109, end_col_offset=28), lineno=109, col_offset=16, end_lineno=109, end_col_offset=28)], lineno=108, col_offset=12, end_lineno=109, end_col_offset=28)], lineno=107, col_offset=8, end_lineno=109, end_col_offset=28), Return(value=Name(id='removed', ctx=Load(), lineno=110, col_offset=15, end_lineno=110, end_col_offset=22), lineno=110, col_offset=8, end_lineno=110, end_col_offset=22)], returns=BinOp(left=Name(id='int', ctx=Load(), lineno=105, col_offset=43, end_lineno=105, end_col_offset=46), op=BitOr(), right=Constant(value=None, lineno=105, col_offset=49, end_lineno=105, end_col_offset=53), lineno=105, col_offset=43, end_lineno=105, end_col_offset=53), lineno=105, col_offset=4, end_lineno=110, end_col_offset=22), AsyncFunctionDef(name='close', args=arguments(args=[arg(arg='self', lineno=112, col_offset=20, end_lineno=112, end_col_offset=24)]), body=[Expr(value=Call(func=Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=113, col_offset=8, end_lineno=113, end_col_offset=12), attr='_data', ctx=Load(), lineno=113, col_offset=8, end_lineno=113, end_col_offset=18), attr='clear', ctx=Load(), lineno=113, col_offset=8, end_lineno=113, end_col_offset=24), lineno=113, col_offset=8, end_lineno=113, end_col_offset=26), lineno=113, col_offset=8, end_lineno=113, end_col_offset=26)], returns=Constant(value=None, lineno=112, col_offset=29, end_lineno=112, end_col_offset=33), lineno=112, col_offset=4, end_lineno=113, end_col_offset=26), FunctionDef(name='contains', args=arguments(args=[arg(arg='self', lineno=115, col_offset=17, end_lineno=115, end_col_offset=21), arg(arg='key', annotation=Name(id='str', ctx=Load(), lineno=115, col_offset=28, end_lineno=115, end_col_offset=31), lineno=115, col_offset=23, end_lineno=115, end_col_offset=31)]), body=[Return(value=Compare(left=Name(id='key', ctx=Load(), lineno=116, col_offset=15, end_lineno=116, end_col_offset=18), ops=[In()], comparators=[Attribute(value=Name(id='self', ctx=Load(), lineno=116, col_offset=22, end_lineno=116, end_col_offset=26), attr='_data', ctx=Load(), lineno=116, col_offset=22, end_lineno=116, end_col_offset=32)], lineno=116, col_offset=15, end_lineno=116, end_col_offset=32), lineno=116, col_offset=8, end_lineno=116, end_col_offset=32)], returns=Name(id='bool', ctx=Load(), lineno=115, col_offset=36, end_lineno=115, end_col_offset=40), lineno=115, col_offset=4, end_lineno=116, end_col_offset=32)], lineno=74, col_offset=0, end_lineno=116, end_col_offset=32), FunctionDef(name='_sample_scope', args=arguments(), body=[Return(value=Call(func=Name(id='cast', ctx=Load(), lineno=120, col_offset=11, end_lineno=120, end_col_offset=15), args=[Constant(value='ScopeIn', lineno=121, col_offset=8, end_lineno=121, end_col_offset=17), Dict(keys=[Constant(value='repos', lineno=123, col_offset=12, end_lineno=123, end_col_offset=19), Constant(value='branches', lineno=124, col_offset=12, end_lineno=124, end_col_offset=22), Constant(value='include_globs', lineno=125, col_offset=12, end_lineno=125, end_col_offset=27), Constant(value='exclude_globs', lineno=126, col_offset=12, end_lineno=126, end_col_offset=27), Constant(value='languages', lineno=127, col_offset=12, end_lineno=127, end_col_offset=23)], values=[List(elts=[Constant(value='kgfoundry', lineno=123, col_offset=22, end_lineno=123, end_col_offset=33)], ctx=Load(), lineno=123, col_offset=21, end_lineno=123, end_col_offset=34), List(elts=[Constant(value='main', lineno=124, col_offset=25, end_lineno=124, end_col_offset=31)], ctx=Load(), lineno=124, col_offset=24, end_lineno=124, end_col_offset=32), List(elts=[Constant(value='src/**', lineno=125, col_offset=30, end_lineno=125, end_col_offset=38)], ctx=Load(), lineno=125, col_offset=29, end_lineno=125, end_col_offset=39), List(ctx=Load(), lineno=126, col_offset=29, end_lineno=126, end_col_offset=31), List(elts=[Constant(value='python', lineno=127, col_offset=26, end_lineno=127, end_col_offset=34)], ctx=Load(), lineno=127, col_offset=25, end_lineno=127, end_col_offset=35)], lineno=122, col_offset=8, end_lineno=128, end_col_offset=9)], lineno=120, col_offset=11, end_lineno=129, end_col_offset=5), lineno=120, col_offset=4, end_lineno=129, end_col_offset=5)], returns=Name(id='ScopeIn', ctx=Load(), lineno=119, col_offset=23, end_lineno=119, end_col_offset=30), lineno=119, col_offset=0, end_lineno=129, end_col_offset=5), AsyncFunctionDef(name='test_scope_store_prefers_l1_cache', args=arguments(), body=[Assign(targets=[Name(id='redis', ctx=Store(), lineno=134, col_offset=4, end_lineno=134, end_col_offset=9)], value=Call(func=Name(id='FakeRedis', ctx=Load(), lineno=134, col_offset=12, end_lineno=134, end_col_offset=21), lineno=134, col_offset=12, end_lineno=134, end_col_offset=23), lineno=134, col_offset=4, end_lineno=134, end_col_offset=23), Assign(targets=[Name(id='store', ctx=Store(), lineno=135, col_offset=4, end_lineno=135, end_col_offset=9)], value=Call(func=Name(id='ScopeStore', ctx=Load(), lineno=135, col_offset=12, end_lineno=135, end_col_offset=22), args=[Name(id='redis', ctx=Load(), lineno=135, col_offset=23, end_lineno=135, end_col_offset=28)], keywords=[keyword(arg='l1_maxsize', value=Constant(value=8, lineno=135, col_offset=41, end_lineno=135, end_col_offset=42), lineno=135, col_offset=30, end_lineno=135, end_col_offset=42), keyword(arg='l1_ttl_seconds', value=Constant(value=30.0, lineno=135, col_offset=59, end_lineno=135, end_col_offset=63), lineno=135, col_offset=44, end_lineno=135, end_col_offset=63), keyword(arg='l2_ttl_seconds', value=Constant(value=3600, lineno=135, col_offset=80, end_lineno=135, end_col_offset=84), lineno=135, col_offset=65, end_lineno=135, end_col_offset=84)], lineno=135, col_offset=12, end_lineno=135, end_col_offset=85), lineno=135, col_offset=4, end_lineno=135, end_col_offset=85), Assign(targets=[Name(id='scope', ctx=Store(), lineno=137, col_offset=4, end_lineno=137, end_col_offset=9)], value=Call(func=Name(id='_sample_scope', ctx=Load(), lineno=137, col_offset=12, end_lineno=137, end_col_offset=25), lineno=137, col_offset=12, end_lineno=137, end_col_offset=27), lineno=137, col_offset=4, end_lineno=137, end_col_offset=27), Expr(value=Await(value=Call(func=Attribute(value=Name(id='store', ctx=Load(), lineno=138, col_offset=10, end_lineno=138, end_col_offset=15), attr='set', ctx=Load(), lineno=138, col_offset=10, end_lineno=138, end_col_offset=19), args=[Constant(value='session-1', lineno=138, col_offset=20, end_lineno=138, end_col_offset=31), Name(id='scope', ctx=Load(), lineno=138, col_offset=33, end_lineno=138, end_col_offset=38)], lineno=138, col_offset=10, end_lineno=138, end_col_offset=39), lineno=138, col_offset=4, end_lineno=138, end_col_offset=39), lineno=138, col_offset=4, end_lineno=138, end_col_offset=39), Assign(targets=[Name(id='result', ctx=Store(), lineno=140, col_offset=4, end_lineno=140, end_col_offset=10)], value=Await(value=Call(func=Attribute(value=Name(id='store', ctx=Load(), lineno=140, col_offset=19, end_lineno=140, end_col_offset=24), attr='get', ctx=Load(), lineno=140, col_offset=19, end_lineno=140, end_col_offset=28), args=[Constant(value='session-1', lineno=140, col_offset=29, end_lineno=140, end_col_offset=40)], lineno=140, col_offset=19, end_lineno=140, end_col_offset=41), lineno=140, col_offset=13, end_lineno=140, end_col_offset=41), lineno=140, col_offset=4, end_lineno=140, end_col_offset=41), Assert(test=Compare(left=Name(id='result', ctx=Load(), lineno=142, col_offset=11, end_lineno=142, end_col_offset=17), ops=[Eq()], comparators=[Name(id='scope', ctx=Load(), lineno=142, col_offset=21, end_lineno=142, end_col_offset=26)], lineno=142, col_offset=11, end_lineno=142, end_col_offset=26), lineno=142, col_offset=4, end_lineno=142, end_col_offset=26), Assert(test=Compare(left=Attribute(value=Attribute(value=Name(id='store', ctx=Load(), lineno=143, col_offset=11, end_lineno=143, end_col_offset=16), attr='metrics', ctx=Load(), lineno=143, col_offset=11, end_lineno=143, end_col_offset=24), attr='l1_hits', ctx=Load(), lineno=143, col_offset=11, end_lineno=143, end_col_offset=32), ops=[Eq()], comparators=[Constant(value=1, lineno=143, col_offset=36, end_lineno=143, end_col_offset=37)], lineno=143, col_offset=11, end_lineno=143, end_col_offset=37), lineno=143, col_offset=4, end_lineno=143, end_col_offset=37), Assert(test=Compare(left=Attribute(value=Attribute(value=Name(id='store', ctx=Load(), lineno=144, col_offset=11, end_lineno=144, end_col_offset=16), attr='metrics', ctx=Load(), lineno=144, col_offset=11, end_lineno=144, end_col_offset=24), attr='l2_hits', ctx=Load(), lineno=144, col_offset=11, end_lineno=144, end_col_offset=32), ops=[Eq()], comparators=[Constant(value=0, lineno=144, col_offset=36, end_lineno=144, end_col_offset=37)], lineno=144, col_offset=11, end_lineno=144, end_col_offset=37), lineno=144, col_offset=4, end_lineno=144, end_col_offset=37), Assert(test=Compare(left=Attribute(value=Name(id='redis', ctx=Load(), lineno=145, col_offset=11, end_lineno=145, end_col_offset=16), attr='get_calls', ctx=Load(), lineno=145, col_offset=11, end_lineno=145, end_col_offset=26), ops=[Eq()], comparators=[Constant(value=0, lineno=145, col_offset=30, end_lineno=145, end_col_offset=31)], lineno=145, col_offset=11, end_lineno=145, end_col_offset=31), lineno=145, col_offset=4, end_lineno=145, end_col_offset=31), Expr(value=Await(value=Call(func=Attribute(value=Name(id='store', ctx=Load(), lineno=147, col_offset=10, end_lineno=147, end_col_offset=15), attr='close', ctx=Load(), lineno=147, col_offset=10, end_lineno=147, end_col_offset=21), lineno=147, col_offset=10, end_lineno=147, end_col_offset=23), lineno=147, col_offset=4, end_lineno=147, end_col_offset=23), lineno=147, col_offset=4, end_lineno=147, end_col_offset=23)], decorator_list=[Attribute(value=Attribute(value=Name(id='pytest', ctx=Load(), lineno=132, col_offset=1, end_lineno=132, end_col_offset=7), attr='mark', ctx=Load(), lineno=132, col_offset=1, end_lineno=132, end_col_offset=12), attr='asyncio', ctx=Load(), lineno=132, col_offset=1, end_lineno=132, end_col_offset=20)], returns=Constant(value=None, lineno=133, col_offset=49, end_lineno=133, end_col_offset=53), lineno=133, col_offset=0, end_lineno=147, end_col_offset=23), AsyncFunctionDef(name='test_scope_store_l2_fetch_coalesces_requests', args=arguments(), body=[Assign(targets=[Name(id='redis', ctx=Store(), lineno=152, col_offset=4, end_lineno=152, end_col_offset=9)], value=Call(func=Name(id='FakeRedis', ctx=Load(), lineno=152, col_offset=12, end_lineno=152, end_col_offset=21), lineno=152, col_offset=12, end_lineno=152, end_col_offset=23), lineno=152, col_offset=4, end_lineno=152, end_col_offset=23), Assign(targets=[Name(id='store', ctx=Store(), lineno=153, col_offset=4, end_lineno=153, end_col_offset=9)], value=Call(func=Name(id='ScopeStore', ctx=Load(), lineno=153, col_offset=12, end_lineno=153, end_col_offset=22), args=[Name(id='redis', ctx=Load(), lineno=153, col_offset=23, end_lineno=153, end_col_offset=28)], keywords=[keyword(arg='l1_maxsize', value=Constant(value=8, lineno=153, col_offset=41, end_lineno=153, end_col_offset=42), lineno=153, col_offset=30, end_lineno=153, end_col_offset=42), keyword(arg='l1_ttl_seconds', value=Constant(value=30.0, lineno=153, col_offset=59, end_lineno=153, end_col_offset=63), lineno=153, col_offset=44, end_lineno=153, end_col_offset=63), keyword(arg='l2_ttl_seconds', value=Constant(value=3600, lineno=153, col_offset=80, end_lineno=153, end_col_offset=84), lineno=153, col_offset=65, end_lineno=153, end_col_offset=84)], lineno=153, col_offset=12, end_lineno=153, end_col_offset=85), lineno=153, col_offset=4, end_lineno=153, end_col_offset=85), Assign(targets=[Name(id='scope', ctx=Store(), lineno=155, col_offset=4, end_lineno=155, end_col_offset=9)], value=Call(func=Name(id='_sample_scope', ctx=Load(), lineno=155, col_offset=12, end_lineno=155, end_col_offset=25), lineno=155, col_offset=12, end_lineno=155, end_col_offset=27), lineno=155, col_offset=4, end_lineno=155, end_col_offset=27), Expr(value=Await(value=Call(func=Attribute(value=Name(id='store', ctx=Load(), lineno=156, col_offset=10, end_lineno=156, end_col_offset=15), attr='set', ctx=Load(), lineno=156, col_offset=10, end_lineno=156, end_col_offset=19), args=[Constant(value='session-2', lineno=156, col_offset=20, end_lineno=156, end_col_offset=31), Name(id='scope', ctx=Load(), lineno=156, col_offset=33, end_lineno=156, end_col_offset=38)], lineno=156, col_offset=10, end_lineno=156, end_col_offset=39), lineno=156, col_offset=4, end_lineno=156, end_col_offset=39), lineno=156, col_offset=4, end_lineno=156, end_col_offset=39), Expr(value=Call(func=Attribute(value=Name(id='store', ctx=Load(), lineno=158, col_offset=4, end_lineno=158, end_col_offset=9), attr='evict_l1', ctx=Load(), lineno=158, col_offset=4, end_lineno=158, end_col_offset=18), args=[Constant(value='session-2', lineno=158, col_offset=19, end_lineno=158, end_col_offset=30)], lineno=158, col_offset=4, end_lineno=158, end_col_offset=31), lineno=158, col_offset=4, end_lineno=158, end_col_offset=31), Assign(targets=[Name(id='results', ctx=Store(), lineno=160, col_offset=4, end_lineno=160, end_col_offset=11)], value=Await(value=Call(func=Attribute(value=Name(id='asyncio', ctx=Load(), lineno=160, col_offset=20, end_lineno=160, end_col_offset=27), attr='gather', ctx=Load(), lineno=160, col_offset=20, end_lineno=160, end_col_offset=34), args=[Starred(value=GeneratorExp(elt=Call(func=Attribute(value=Name(id='store', ctx=Load(), lineno=160, col_offset=37, end_lineno=160, end_col_offset=42), attr='get', ctx=Load(), lineno=160, col_offset=37, end_lineno=160, end_col_offset=46), args=[Constant(value='session-2', lineno=160, col_offset=47, end_lineno=160, end_col_offset=58)], lineno=160, col_offset=37, end_lineno=160, end_col_offset=59), generators=[comprehension(target=Name(id='_', ctx=Store(), lineno=160, col_offset=64, end_lineno=160, end_col_offset=65), iter=Call(func=Name(id='range', ctx=Load(), lineno=160, col_offset=69, end_lineno=160, end_col_offset=74), args=[Constant(value=5, lineno=160, col_offset=75, end_lineno=160, end_col_offset=76)], lineno=160, col_offset=69, end_lineno=160, end_col_offset=77), is_async=0)], lineno=160, col_offset=36, end_lineno=160, end_col_offset=78), ctx=Load(), lineno=160, col_offset=35, end_lineno=160, end_col_offset=78)], lineno=160, col_offset=20, end_lineno=160, end_col_offset=79), lineno=160, col_offset=14, end_lineno=160, end_col_offset=79), lineno=160, col_offset=4, end_lineno=160, end_col_offset=79), Assert(test=Compare(left=Name(id='results', ctx=Load(), lineno=162, col_offset=11, end_lineno=162, end_col_offset=18), ops=[Eq()], comparators=[BinOp(left=List(elts=[Name(id='scope', ctx=Load(), lineno=162, col_offset=23, end_lineno=162, end_col_offset=28)], ctx=Load(), lineno=162, col_offset=22, end_lineno=162, end_col_offset=29), op=Mult(), right=Constant(value=5, lineno=162, col_offset=32, end_lineno=162, end_col_offset=33), lineno=162, col_offset=22, end_lineno=162, end_col_offset=33)], lineno=162, col_offset=11, end_lineno=162, end_col_offset=33), lineno=162, col_offset=4, end_lineno=162, end_col_offset=33), Assert(test=Compare(left=Attribute(value=Name(id='redis', ctx=Load(), lineno=163, col_offset=11, end_lineno=163, end_col_offset=16), attr='get_calls', ctx=Load(), lineno=163, col_offset=11, end_lineno=163, end_col_offset=26), ops=[Eq()], comparators=[Constant(value=1, lineno=163, col_offset=30, end_lineno=163, end_col_offset=31)], lineno=163, col_offset=11, end_lineno=163, end_col_offset=31), lineno=163, col_offset=4, end_lineno=163, end_col_offset=31), Assert(test=Compare(left=Attribute(value=Attribute(value=Name(id='store', ctx=Load(), lineno=164, col_offset=11, end_lineno=164, end_col_offset=16), attr='metrics', ctx=Load(), lineno=164, col_offset=11, end_lineno=164, end_col_offset=24), attr='l2_hits', ctx=Load(), lineno=164, col_offset=11, end_lineno=164, end_col_offset=32), ops=[Eq()], comparators=[Constant(value=1, lineno=164, col_offset=36, end_lineno=164, end_col_offset=37)], lineno=164, col_offset=11, end_lineno=164, end_col_offset=37), lineno=164, col_offset=4, end_lineno=164, end_col_offset=37), Assert(test=Compare(left=Attribute(value=Attribute(value=Name(id='store', ctx=Load(), lineno=165, col_offset=11, end_lineno=165, end_col_offset=16), attr='metrics', ctx=Load(), lineno=165, col_offset=11, end_lineno=165, end_col_offset=24), attr='l2_misses', ctx=Load(), lineno=165, col_offset=11, end_lineno=165, end_col_offset=34), ops=[Eq()], comparators=[Constant(value=0, lineno=165, col_offset=38, end_lineno=165, end_col_offset=39)], lineno=165, col_offset=11, end_lineno=165, end_col_offset=39), lineno=165, col_offset=4, end_lineno=165, end_col_offset=39), Expr(value=Await(value=Call(func=Attribute(value=Name(id='store', ctx=Load(), lineno=167, col_offset=10, end_lineno=167, end_col_offset=15), attr='close', ctx=Load(), lineno=167, col_offset=10, end_lineno=167, end_col_offset=21), lineno=167, col_offset=10, end_lineno=167, end_col_offset=23), lineno=167, col_offset=4, end_lineno=167, end_col_offset=23), lineno=167, col_offset=4, end_lineno=167, end_col_offset=23)], decorator_list=[Attribute(value=Attribute(value=Name(id='pytest', ctx=Load(), lineno=150, col_offset=1, end_lineno=150, end_col_offset=7), attr='mark', ctx=Load(), lineno=150, col_offset=1, end_lineno=150, end_col_offset=12), attr='asyncio', ctx=Load(), lineno=150, col_offset=1, end_lineno=150, end_col_offset=20)], returns=Constant(value=None, lineno=151, col_offset=60, end_lineno=151, end_col_offset=64), lineno=151, col_offset=0, end_lineno=167, end_col_offset=23), AsyncFunctionDef(name='test_scope_store_delete_clears_l1_and_l2', args=arguments(), body=[Assign(targets=[Name(id='redis', ctx=Store(), lineno=172, col_offset=4, end_lineno=172, end_col_offset=9)], value=Call(func=Name(id='FakeRedis', ctx=Load(), lineno=172, col_offset=12, end_lineno=172, end_col_offset=21), lineno=172, col_offset=12, end_lineno=172, end_col_offset=23), lineno=172, col_offset=4, end_lineno=172, end_col_offset=23), Assign(targets=[Name(id='store', ctx=Store(), lineno=173, col_offset=4, end_lineno=173, end_col_offset=9)], value=Call(func=Name(id='ScopeStore', ctx=Load(), lineno=173, col_offset=12, end_lineno=173, end_col_offset=22), args=[Name(id='redis', ctx=Load(), lineno=173, col_offset=23, end_lineno=173, end_col_offset=28)], keywords=[keyword(arg='l1_maxsize', value=Constant(value=8, lineno=173, col_offset=41, end_lineno=173, end_col_offset=42), lineno=173, col_offset=30, end_lineno=173, end_col_offset=42), keyword(arg='l1_ttl_seconds', value=Constant(value=30.0, lineno=173, col_offset=59, end_lineno=173, end_col_offset=63), lineno=173, col_offset=44, end_lineno=173, end_col_offset=63), keyword(arg='l2_ttl_seconds', value=Constant(value=3600, lineno=173, col_offset=80, end_lineno=173, end_col_offset=84), lineno=173, col_offset=65, end_lineno=173, end_col_offset=84)], lineno=173, col_offset=12, end_lineno=173, end_col_offset=85), lineno=173, col_offset=4, end_lineno=173, end_col_offset=85), Assign(targets=[Name(id='scope', ctx=Store(), lineno=175, col_offset=4, end_lineno=175, end_col_offset=9)], value=Call(func=Name(id='_sample_scope', ctx=Load(), lineno=175, col_offset=12, end_lineno=175, end_col_offset=25), lineno=175, col_offset=12, end_lineno=175, end_col_offset=27), lineno=175, col_offset=4, end_lineno=175, end_col_offset=27), Expr(value=Await(value=Call(func=Attribute(value=Name(id='store', ctx=Load(), lineno=176, col_offset=10, end_lineno=176, end_col_offset=15), attr='set', ctx=Load(), lineno=176, col_offset=10, end_lineno=176, end_col_offset=19), args=[Constant(value='session-3', lineno=176, col_offset=20, end_lineno=176, end_col_offset=31), Name(id='scope', ctx=Load(), lineno=176, col_offset=33, end_lineno=176, end_col_offset=38)], lineno=176, col_offset=10, end_lineno=176, end_col_offset=39), lineno=176, col_offset=4, end_lineno=176, end_col_offset=39), lineno=176, col_offset=4, end_lineno=176, end_col_offset=39), Expr(value=Await(value=Call(func=Attribute(value=Name(id='store', ctx=Load(), lineno=177, col_offset=10, end_lineno=177, end_col_offset=15), attr='delete', ctx=Load(), lineno=177, col_offset=10, end_lineno=177, end_col_offset=22), args=[Constant(value='session-3', lineno=177, col_offset=23, end_lineno=177, end_col_offset=34)], lineno=177, col_offset=10, end_lineno=177, end_col_offset=35), lineno=177, col_offset=4, end_lineno=177, end_col_offset=35), lineno=177, col_offset=4, end_lineno=177, end_col_offset=35), Assert(test=Compare(left=Attribute(value=Attribute(value=Name(id='store', ctx=Load(), lineno=179, col_offset=11, end_lineno=179, end_col_offset=16), attr='metrics', ctx=Load(), lineno=179, col_offset=11, end_lineno=179, end_col_offset=24), attr='l1_hits', ctx=Load(), lineno=179, col_offset=11, end_lineno=179, end_col_offset=32), ops=[Eq()], comparators=[Constant(value=0, lineno=179, col_offset=36, end_lineno=179, end_col_offset=37)], lineno=179, col_offset=11, end_lineno=179, end_col_offset=37), lineno=179, col_offset=4, end_lineno=179, end_col_offset=37), Assert(test=Compare(left=Await(value=Call(func=Attribute(value=Name(id='store', ctx=Load(), lineno=180, col_offset=17, end_lineno=180, end_col_offset=22), attr='get', ctx=Load(), lineno=180, col_offset=17, end_lineno=180, end_col_offset=26), args=[Constant(value='session-3', lineno=180, col_offset=27, end_lineno=180, end_col_offset=38)], lineno=180, col_offset=17, end_lineno=180, end_col_offset=39), lineno=180, col_offset=11, end_lineno=180, end_col_offset=39), ops=[Is()], comparators=[Constant(value=None, lineno=180, col_offset=43, end_lineno=180, end_col_offset=47)], lineno=180, col_offset=11, end_lineno=180, end_col_offset=47), lineno=180, col_offset=4, end_lineno=180, end_col_offset=47), Assert(test=UnaryOp(op=Not(), operand=Call(func=Attribute(value=Name(id='redis', ctx=Load(), lineno=181, col_offset=15, end_lineno=181, end_col_offset=20), attr='contains', ctx=Load(), lineno=181, col_offset=15, end_lineno=181, end_col_offset=29), args=[Constant(value='scope:session-3', lineno=181, col_offset=30, end_lineno=181, end_col_offset=47)], lineno=181, col_offset=15, end_lineno=181, end_col_offset=48), lineno=181, col_offset=11, end_lineno=181, end_col_offset=48), lineno=181, col_offset=4, end_lineno=181, end_col_offset=48), Expr(value=Await(value=Call(func=Attribute(value=Name(id='store', ctx=Load(), lineno=183, col_offset=10, end_lineno=183, end_col_offset=15), attr='close', ctx=Load(), lineno=183, col_offset=10, end_lineno=183, end_col_offset=21), lineno=183, col_offset=10, end_lineno=183, end_col_offset=23), lineno=183, col_offset=4, end_lineno=183, end_col_offset=23), lineno=183, col_offset=4, end_lineno=183, end_col_offset=23)], decorator_list=[Attribute(value=Attribute(value=Name(id='pytest', ctx=Load(), lineno=170, col_offset=1, end_lineno=170, end_col_offset=7), attr='mark', ctx=Load(), lineno=170, col_offset=1, end_lineno=170, end_col_offset=12), attr='asyncio', ctx=Load(), lineno=170, col_offset=1, end_lineno=170, end_col_offset=20)], returns=Constant(value=None, lineno=171, col_offset=56, end_lineno=171, end_col_offset=60), lineno=171, col_offset=0, end_lineno=183, end_col_offset=23), AsyncFunctionDef(name='test_scope_store_without_l2_ttl_uses_set', args=arguments(), body=[Assign(targets=[Name(id='redis', ctx=Store(), lineno=188, col_offset=4, end_lineno=188, end_col_offset=9)], value=Call(func=Name(id='FakeRedis', ctx=Load(), lineno=188, col_offset=12, end_lineno=188, end_col_offset=21), lineno=188, col_offset=12, end_lineno=188, end_col_offset=23), lineno=188, col_offset=4, end_lineno=188, end_col_offset=23), Assign(targets=[Name(id='store', ctx=Store(), lineno=189, col_offset=4, end_lineno=189, end_col_offset=9)], value=Call(func=Name(id='ScopeStore', ctx=Load(), lineno=189, col_offset=12, end_lineno=189, end_col_offset=22), args=[Name(id='redis', ctx=Load(), lineno=189, col_offset=23, end_lineno=189, end_col_offset=28)], keywords=[keyword(arg='l1_maxsize', value=Constant(value=8, lineno=189, col_offset=41, end_lineno=189, end_col_offset=42), lineno=189, col_offset=30, end_lineno=189, end_col_offset=42), keyword(arg='l1_ttl_seconds', value=Constant(value=30.0, lineno=189, col_offset=59, end_lineno=189, end_col_offset=63), lineno=189, col_offset=44, end_lineno=189, end_col_offset=63), keyword(arg='l2_ttl_seconds', value=Constant(value=None, lineno=189, col_offset=80, end_lineno=189, end_col_offset=84), lineno=189, col_offset=65, end_lineno=189, end_col_offset=84)], lineno=189, col_offset=12, end_lineno=189, end_col_offset=85), lineno=189, col_offset=4, end_lineno=189, end_col_offset=85), Expr(value=Await(value=Call(func=Attribute(value=Name(id='store', ctx=Load(), lineno=191, col_offset=10, end_lineno=191, end_col_offset=15), attr='set', ctx=Load(), lineno=191, col_offset=10, end_lineno=191, end_col_offset=19), args=[Constant(value='session-4', lineno=191, col_offset=20, end_lineno=191, end_col_offset=31), Call(func=Name(id='_sample_scope', ctx=Load(), lineno=191, col_offset=33, end_lineno=191, end_col_offset=46), lineno=191, col_offset=33, end_lineno=191, end_col_offset=48)], lineno=191, col_offset=10, end_lineno=191, end_col_offset=49), lineno=191, col_offset=4, end_lineno=191, end_col_offset=49), lineno=191, col_offset=4, end_lineno=191, end_col_offset=49), Assert(test=Compare(left=Attribute(value=Name(id='redis', ctx=Load(), lineno=193, col_offset=11, end_lineno=193, end_col_offset=16), attr='set_calls', ctx=Load(), lineno=193, col_offset=11, end_lineno=193, end_col_offset=26), ops=[Eq()], comparators=[Constant(value=1, lineno=193, col_offset=30, end_lineno=193, end_col_offset=31)], lineno=193, col_offset=11, end_lineno=193, end_col_offset=31), lineno=193, col_offset=4, end_lineno=193, end_col_offset=31), Assert(test=UnaryOp(op=Not(), operand=Attribute(value=Name(id='redis', ctx=Load(), lineno=194, col_offset=15, end_lineno=194, end_col_offset=20), attr='setex_calls', ctx=Load(), lineno=194, col_offset=15, end_lineno=194, end_col_offset=32), lineno=194, col_offset=11, end_lineno=194, end_col_offset=32), lineno=194, col_offset=4, end_lineno=194, end_col_offset=32), Expr(value=Await(value=Call(func=Attribute(value=Name(id='store', ctx=Load(), lineno=196, col_offset=10, end_lineno=196, end_col_offset=15), attr='close', ctx=Load(), lineno=196, col_offset=10, end_lineno=196, end_col_offset=21), lineno=196, col_offset=10, end_lineno=196, end_col_offset=23), lineno=196, col_offset=4, end_lineno=196, end_col_offset=23), lineno=196, col_offset=4, end_lineno=196, end_col_offset=23)], decorator_list=[Attribute(value=Attribute(value=Name(id='pytest', ctx=Load(), lineno=186, col_offset=1, end_lineno=186, end_col_offset=7), attr='mark', ctx=Load(), lineno=186, col_offset=1, end_lineno=186, end_col_offset=12), attr='asyncio', ctx=Load(), lineno=186, col_offset=1, end_lineno=186, end_col_offset=20)], returns=Constant(value=None, lineno=187, col_offset=56, end_lineno=187, end_col_offset=60), lineno=187, col_offset=0, end_lineno=196, end_col_offset=23), AsyncFunctionDef(name='test_async_single_flight_coalesces_calls', args=arguments(), body=[AnnAssign(target=Name(id='flight', ctx=Store(), lineno=201, col_offset=4, end_lineno=201, end_col_offset=10), annotation=Subscript(value=Name(id='AsyncSingleFlight', ctx=Load(), lineno=201, col_offset=12, end_lineno=201, end_col_offset=29), slice=Tuple(elts=[Name(id='str', ctx=Load(), lineno=201, col_offset=30, end_lineno=201, end_col_offset=33), Name(id='int', ctx=Load(), lineno=201, col_offset=35, end_lineno=201, end_col_offset=38)], ctx=Load(), lineno=201, col_offset=30, end_lineno=201, end_col_offset=38), ctx=Load(), lineno=201, col_offset=12, end_lineno=201, end_col_offset=39), value=Call(func=Name(id='AsyncSingleFlight', ctx=Load(), lineno=201, col_offset=42, end_lineno=201, end_col_offset=59), lineno=201, col_offset=42, end_lineno=201, end_col_offset=61), simple=1, lineno=201, col_offset=4, end_lineno=201, end_col_offset=61), Assign(targets=[Name(id='call_count', ctx=Store(), lineno=202, col_offset=4, end_lineno=202, end_col_offset=14)], value=Constant(value=0, lineno=202, col_offset=17, end_lineno=202, end_col_offset=18), lineno=202, col_offset=4, end_lineno=202, end_col_offset=18), AsyncFunctionDef(name='expensive_call', args=arguments(), body=[Nonlocal(names=['call_count'], lineno=205, col_offset=8, end_lineno=205, end_col_offset=27), AugAssign(target=Name(id='call_count', ctx=Store(), lineno=206, col_offset=8, end_lineno=206, end_col_offset=18), op=Add(), value=Constant(value=1, lineno=206, col_offset=22, end_lineno=206, end_col_offset=23), lineno=206, col_offset=8, end_lineno=206, end_col_offset=23), Expr(value=Await(value=Call(func=Attribute(value=Name(id='asyncio', ctx=Load(), lineno=207, col_offset=14, end_lineno=207, end_col_offset=21), attr='sleep', ctx=Load(), lineno=207, col_offset=14, end_lineno=207, end_col_offset=27), args=[Constant(value=0.01, lineno=207, col_offset=28, end_lineno=207, end_col_offset=32)], lineno=207, col_offset=14, end_lineno=207, end_col_offset=33), lineno=207, col_offset=8, end_lineno=207, end_col_offset=33), lineno=207, col_offset=8, end_lineno=207, end_col_offset=33), Return(value=Constant(value=42, lineno=208, col_offset=15, end_lineno=208, end_col_offset=17), lineno=208, col_offset=8, end_lineno=208, end_col_offset=17)], returns=Name(id='int', ctx=Load(), lineno=204, col_offset=34, end_lineno=204, end_col_offset=37), lineno=204, col_offset=4, end_lineno=208, end_col_offset=17), Assign(targets=[Name(id='results', ctx=Store(), lineno=210, col_offset=4, end_lineno=210, end_col_offset=11)], value=Await(value=Call(func=Attribute(value=Name(id='asyncio', ctx=Load(), lineno=210, col_offset=20, end_lineno=210, end_col_offset=27), attr='gather', ctx=Load(), lineno=210, col_offset=20, end_lineno=210, end_col_offset=34), args=[Starred(value=ListComp(elt=Call(func=Attribute(value=Name(id='flight', ctx=Load(), lineno=210, col_offset=37, end_lineno=210, end_col_offset=43), attr='do', ctx=Load(), lineno=210, col_offset=37, end_lineno=210, end_col_offset=46), args=[Constant(value='scope', lineno=210, col_offset=47, end_lineno=210, end_col_offset=54), Name(id='expensive_call', ctx=Load(), lineno=210, col_offset=56, end_lineno=210, end_col_offset=70)], lineno=210, col_offset=37, end_lineno=210, end_col_offset=71), generators=[comprehension(target=Name(id='_', ctx=Store(), lineno=210, col_offset=76, end_lineno=210, end_col_offset=77), iter=Call(func=Name(id='range', ctx=Load(), lineno=210, col_offset=81, end_lineno=210, end_col_offset=86), args=[Constant(value=10, lineno=210, col_offset=87, end_lineno=210, end_col_offset=89)], lineno=210, col_offset=81, end_lineno=210, end_col_offset=90), is_async=0)], lineno=210, col_offset=36, end_lineno=210, end_col_offset=91), ctx=Load(), lineno=210, col_offset=35, end_lineno=210, end_col_offset=91)], lineno=210, col_offset=20, end_lineno=210, end_col_offset=92), lineno=210, col_offset=14, end_lineno=210, end_col_offset=92), lineno=210, col_offset=4, end_lineno=210, end_col_offset=92), Assert(test=Call(func=Name(id='all', ctx=Load(), lineno=212, col_offset=11, end_lineno=212, end_col_offset=14), args=[GeneratorExp(elt=Compare(left=Name(id='result', ctx=Load(), lineno=212, col_offset=15, end_lineno=212, end_col_offset=21), ops=[Eq()], comparators=[Constant(value=42, lineno=212, col_offset=25, end_lineno=212, end_col_offset=27)], lineno=212, col_offset=15, end_lineno=212, end_col_offset=27), generators=[comprehension(target=Name(id='result', ctx=Store(), lineno=212, col_offset=32, end_lineno=212, end_col_offset=38), iter=Name(id='results', ctx=Load(), lineno=212, col_offset=42, end_lineno=212, end_col_offset=49), is_async=0)], lineno=212, col_offset=14, end_lineno=212, end_col_offset=50)], lineno=212, col_offset=11, end_lineno=212, end_col_offset=50), lineno=212, col_offset=4, end_lineno=212, end_col_offset=50), Assert(test=Compare(left=Name(id='call_count', ctx=Load(), lineno=213, col_offset=11, end_lineno=213, end_col_offset=21), ops=[Eq()], comparators=[Constant(value=1, lineno=213, col_offset=25, end_lineno=213, end_col_offset=26)], lineno=213, col_offset=11, end_lineno=213, end_col_offset=26), lineno=213, col_offset=4, end_lineno=213, end_col_offset=26)], decorator_list=[Attribute(value=Attribute(value=Name(id='pytest', ctx=Load(), lineno=199, col_offset=1, end_lineno=199, end_col_offset=7), attr='mark', ctx=Load(), lineno=199, col_offset=1, end_lineno=199, end_col_offset=12), attr='asyncio', ctx=Load(), lineno=199, col_offset=1, end_lineno=199, end_col_offset=20)], returns=Constant(value=None, lineno=200, col_offset=56, end_lineno=200, end_col_offset=60), lineno=200, col_offset=0, end_lineno=213, end_col_offset=26), AsyncFunctionDef(name='test_async_single_flight_propagates_exceptions_and_allows_retry', args=arguments(), body=[AnnAssign(target=Name(id='flight', ctx=Store(), lineno=218, col_offset=4, end_lineno=218, end_col_offset=10), annotation=Subscript(value=Name(id='AsyncSingleFlight', ctx=Load(), lineno=218, col_offset=12, end_lineno=218, end_col_offset=29), slice=Tuple(elts=[Name(id='str', ctx=Load(), lineno=218, col_offset=30, end_lineno=218, end_col_offset=33), Name(id='int', ctx=Load(), lineno=218, col_offset=35, end_lineno=218, end_col_offset=38)], ctx=Load(), lineno=218, col_offset=30, end_lineno=218, end_col_offset=38), ctx=Load(), lineno=218, col_offset=12, end_lineno=218, end_col_offset=39), value=Call(func=Name(id='AsyncSingleFlight', ctx=Load(), lineno=218, col_offset=42, end_lineno=218, end_col_offset=59), lineno=218, col_offset=42, end_lineno=218, end_col_offset=61), simple=1, lineno=218, col_offset=4, end_lineno=218, end_col_offset=61), Assign(targets=[Name(id='call_count', ctx=Store(), lineno=219, col_offset=4, end_lineno=219, end_col_offset=14)], value=Constant(value=0, lineno=219, col_offset=17, end_lineno=219, end_col_offset=18), lineno=219, col_offset=4, end_lineno=219, end_col_offset=18), AsyncFunctionDef(name='failing_call', args=arguments(), body=[Nonlocal(names=['call_count'], lineno=222, col_offset=8, end_lineno=222, end_col_offset=27), AugAssign(target=Name(id='call_count', ctx=Store(), lineno=223, col_offset=8, end_lineno=223, end_col_offset=18), op=Add(), value=Constant(value=1, lineno=223, col_offset=22, end_lineno=223, end_col_offset=23), lineno=223, col_offset=8, end_lineno=223, end_col_offset=23), Expr(value=Await(value=Call(func=Attribute(value=Name(id='asyncio', ctx=Load(), lineno=224, col_offset=14, end_lineno=224, end_col_offset=21), attr='sleep', ctx=Load(), lineno=224, col_offset=14, end_lineno=224, end_col_offset=27), args=[Constant(value=0, lineno=224, col_offset=28, end_lineno=224, end_col_offset=29)], lineno=224, col_offset=14, end_lineno=224, end_col_offset=30), lineno=224, col_offset=8, end_lineno=224, end_col_offset=30), lineno=224, col_offset=8, end_lineno=224, end_col_offset=30), Assign(targets=[Name(id='message', ctx=Store(), lineno=225, col_offset=8, end_lineno=225, end_col_offset=15)], value=Constant(value='boom', lineno=225, col_offset=18, end_lineno=225, end_col_offset=24), lineno=225, col_offset=8, end_lineno=225, end_col_offset=24), Raise(exc=Call(func=Name(id='RuntimeError', ctx=Load(), lineno=226, col_offset=14, end_lineno=226, end_col_offset=26), args=[Name(id='message', ctx=Load(), lineno=226, col_offset=27, end_lineno=226, end_col_offset=34)], lineno=226, col_offset=14, end_lineno=226, end_col_offset=35), lineno=226, col_offset=8, end_lineno=226, end_col_offset=35)], returns=Name(id='int', ctx=Load(), lineno=221, col_offset=32, end_lineno=221, end_col_offset=35), lineno=221, col_offset=4, end_lineno=226, end_col_offset=35), With(items=[withitem(context_expr=Call(func=Attribute(value=Name(id='pytest', ctx=Load(), lineno=228, col_offset=9, end_lineno=228, end_col_offset=15), attr='raises', ctx=Load(), lineno=228, col_offset=9, end_lineno=228, end_col_offset=22), args=[Name(id='RuntimeError', ctx=Load(), lineno=228, col_offset=23, end_lineno=228, end_col_offset=35)], lineno=228, col_offset=9, end_lineno=228, end_col_offset=36))], body=[Expr(value=Await(value=Call(func=Attribute(value=Name(id='asyncio', ctx=Load(), lineno=229, col_offset=14, end_lineno=229, end_col_offset=21), attr='gather', ctx=Load(), lineno=229, col_offset=14, end_lineno=229, end_col_offset=28), args=[Call(func=Attribute(value=Name(id='flight', ctx=Load(), lineno=229, col_offset=29, end_lineno=229, end_col_offset=35), attr='do', ctx=Load(), lineno=229, col_offset=29, end_lineno=229, end_col_offset=38), args=[Constant(value='scope', lineno=229, col_offset=39, end_lineno=229, end_col_offset=46), Name(id='failing_call', ctx=Load(), lineno=229, col_offset=48, end_lineno=229, end_col_offset=60)], lineno=229, col_offset=29, end_lineno=229, end_col_offset=61), Call(func=Attribute(value=Name(id='flight', ctx=Load(), lineno=229, col_offset=63, end_lineno=229, end_col_offset=69), attr='do', ctx=Load(), lineno=229, col_offset=63, end_lineno=229, end_col_offset=72), args=[Constant(value='scope', lineno=229, col_offset=73, end_lineno=229, end_col_offset=80), Name(id='failing_call', ctx=Load(), lineno=229, col_offset=82, end_lineno=229, end_col_offset=94)], lineno=229, col_offset=63, end_lineno=229, end_col_offset=95)], lineno=229, col_offset=14, end_lineno=229, end_col_offset=96), lineno=229, col_offset=8, end_lineno=229, end_col_offset=96), lineno=229, col_offset=8, end_lineno=229, end_col_offset=96)], lineno=228, col_offset=4, end_lineno=229, end_col_offset=96), Assert(test=Compare(left=Name(id='call_count', ctx=Load(), lineno=231, col_offset=11, end_lineno=231, end_col_offset=21), ops=[Eq()], comparators=[Constant(value=1, lineno=231, col_offset=25, end_lineno=231, end_col_offset=26)], lineno=231, col_offset=11, end_lineno=231, end_col_offset=26), lineno=231, col_offset=4, end_lineno=231, end_col_offset=26), AsyncFunctionDef(name='succeeding_call', args=arguments(), body=[Expr(value=Await(value=Call(func=Attribute(value=Name(id='asyncio', ctx=Load(), lineno=234, col_offset=14, end_lineno=234, end_col_offset=21), attr='sleep', ctx=Load(), lineno=234, col_offset=14, end_lineno=234, end_col_offset=27), args=[Constant(value=0, lineno=234, col_offset=28, end_lineno=234, end_col_offset=29)], lineno=234, col_offset=14, end_lineno=234, end_col_offset=30), lineno=234, col_offset=8, end_lineno=234, end_col_offset=30), lineno=234, col_offset=8, end_lineno=234, end_col_offset=30), Return(value=Constant(value=7, lineno=235, col_offset=15, end_lineno=235, end_col_offset=16), lineno=235, col_offset=8, end_lineno=235, end_col_offset=16)], returns=Name(id='int', ctx=Load(), lineno=233, col_offset=35, end_lineno=233, end_col_offset=38), lineno=233, col_offset=4, end_lineno=235, end_col_offset=16), Assign(targets=[Name(id='result', ctx=Store(), lineno=237, col_offset=4, end_lineno=237, end_col_offset=10)], value=Await(value=Call(func=Attribute(value=Name(id='flight', ctx=Load(), lineno=237, col_offset=19, end_lineno=237, end_col_offset=25), attr='do', ctx=Load(), lineno=237, col_offset=19, end_lineno=237, end_col_offset=28), args=[Constant(value='scope', lineno=237, col_offset=29, end_lineno=237, end_col_offset=36), Name(id='succeeding_call', ctx=Load(), lineno=237, col_offset=38, end_lineno=237, end_col_offset=53)], lineno=237, col_offset=19, end_lineno=237, end_col_offset=54), lineno=237, col_offset=13, end_lineno=237, end_col_offset=54), lineno=237, col_offset=4, end_lineno=237, end_col_offset=54), Assert(test=Compare(left=Name(id='result', ctx=Load(), lineno=238, col_offset=11, end_lineno=238, end_col_offset=17), ops=[Eq()], comparators=[Constant(value=7, lineno=238, col_offset=21, end_lineno=238, end_col_offset=22)], lineno=238, col_offset=11, end_lineno=238, end_col_offset=22), lineno=238, col_offset=4, end_lineno=238, end_col_offset=22)], decorator_list=[Attribute(value=Attribute(value=Name(id='pytest', ctx=Load(), lineno=216, col_offset=1, end_lineno=216, end_col_offset=7), attr='mark', ctx=Load(), lineno=216, col_offset=1, end_lineno=216, end_col_offset=12), attr='asyncio', ctx=Load(), lineno=216, col_offset=1, end_lineno=216, end_col_offset=20)], returns=Constant(value=None, lineno=217, col_offset=79, end_lineno=217, end_col_offset=83), lineno=217, col_offset=0, end_lineno=238, end_col_offset=22)])