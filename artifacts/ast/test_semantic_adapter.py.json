Module(body=[ImportFrom(module='__future__', names=[alias(name='annotations', lineno=1, col_offset=23, end_lineno=1, end_col_offset=34)], level=0, lineno=1, col_offset=0, end_lineno=1, end_col_offset=34), Import(names=[alias(name='types', lineno=3, col_offset=7, end_lineno=3, end_col_offset=12)], lineno=3, col_offset=0, end_lineno=3, end_col_offset=12), ImportFrom(module='collections.abc', names=[alias(name='Iterator', lineno=4, col_offset=28, end_lineno=4, end_col_offset=36), alias(name='Sequence', lineno=4, col_offset=38, end_lineno=4, end_col_offset=46)], level=0, lineno=4, col_offset=0, end_lineno=4, end_col_offset=46), ImportFrom(module='contextlib', names=[alias(name='contextmanager', lineno=5, col_offset=23, end_lineno=5, end_col_offset=37)], level=0, lineno=5, col_offset=0, end_lineno=5, end_col_offset=37), ImportFrom(module='dataclasses', names=[alias(name='dataclass', lineno=6, col_offset=24, end_lineno=6, end_col_offset=33), alias(name='replace', lineno=6, col_offset=35, end_lineno=6, end_col_offset=42)], level=0, lineno=6, col_offset=0, end_lineno=6, end_col_offset=42), ImportFrom(module='pathlib', names=[alias(name='Path', lineno=7, col_offset=20, end_lineno=7, end_col_offset=24)], level=0, lineno=7, col_offset=0, end_lineno=7, end_col_offset=24), ImportFrom(module='types', names=[alias(name='SimpleNamespace', lineno=8, col_offset=18, end_lineno=8, end_col_offset=33)], level=0, lineno=8, col_offset=0, end_lineno=8, end_col_offset=33), ImportFrom(module='typing', names=[alias(name='TYPE_CHECKING', lineno=9, col_offset=19, end_lineno=9, end_col_offset=32), alias(name='Any', lineno=9, col_offset=34, end_lineno=9, end_col_offset=37), alias(name='Self', lineno=9, col_offset=39, end_lineno=9, end_col_offset=43), alias(name='cast', lineno=9, col_offset=45, end_lineno=9, end_col_offset=49)], level=0, lineno=9, col_offset=0, end_lineno=9, end_col_offset=49), ImportFrom(module='unittest.mock', names=[alias(name='patch', lineno=10, col_offset=26, end_lineno=10, end_col_offset=31)], level=0, lineno=10, col_offset=0, end_lineno=10, end_col_offset=31), Import(names=[alias(name='numpy', asname='np', lineno=12, col_offset=7, end_lineno=12, end_col_offset=18)], lineno=12, col_offset=0, end_lineno=12, end_col_offset=18), Import(names=[alias(name='pytest', lineno=13, col_offset=7, end_lineno=13, end_col_offset=13)], lineno=13, col_offset=0, end_lineno=13, end_col_offset=13), If(test=Name(id='TYPE_CHECKING', ctx=Load(), lineno=15, col_offset=3, end_lineno=15, end_col_offset=16), body=[ImportFrom(module='codeintel_rev.app.config_context', names=[alias(name='ApplicationContext', lineno=16, col_offset=49, end_lineno=16, end_col_offset=67)], level=0, lineno=16, col_offset=4, end_lineno=16, end_col_offset=67)], lineno=15, col_offset=0, end_lineno=16, end_col_offset=67), ImportFrom(module='codeintel_rev.mcp_server.adapters.semantic', names=[alias(name='semantic_search', lineno=18, col_offset=55, end_lineno=18, end_col_offset=70)], level=0, lineno=18, col_offset=0, end_lineno=18, end_col_offset=70), ImportFrom(module='codeintel_rev.mcp_server.schemas', names=[alias(name='ScopeIn', lineno=19, col_offset=45, end_lineno=19, end_col_offset=52)], level=0, lineno=19, col_offset=0, end_lineno=19, end_col_offset=52), ImportFrom(module='kgfoundry_common.errors', names=[alias(name='EmbeddingError', lineno=21, col_offset=36, end_lineno=21, end_col_offset=50), alias(name='VectorSearchError', lineno=21, col_offset=52, end_lineno=21, end_col_offset=69)], level=0, lineno=21, col_offset=0, end_lineno=21, end_col_offset=69), ClassDef(name='_ObservationRecord', body=[AnnAssign(target=Name(id='operation', ctx=Store(), lineno=26, col_offset=4, end_lineno=26, end_col_offset=13), annotation=Name(id='str', ctx=Load(), lineno=26, col_offset=15, end_lineno=26, end_col_offset=18), simple=1, lineno=26, col_offset=4, end_lineno=26, end_col_offset=18), AnnAssign(target=Name(id='component', ctx=Store(), lineno=27, col_offset=4, end_lineno=27, end_col_offset=13), annotation=Name(id='str', ctx=Load(), lineno=27, col_offset=15, end_lineno=27, end_col_offset=18), simple=1, lineno=27, col_offset=4, end_lineno=27, end_col_offset=18), AnnAssign(target=Name(id='success', ctx=Store(), lineno=28, col_offset=4, end_lineno=28, end_col_offset=11), annotation=Name(id='bool', ctx=Load(), lineno=28, col_offset=13, end_lineno=28, end_col_offset=17), value=Constant(value=False, lineno=28, col_offset=20, end_lineno=28, end_col_offset=25), simple=1, lineno=28, col_offset=4, end_lineno=28, end_col_offset=25), AnnAssign(target=Name(id='error', ctx=Store(), lineno=29, col_offset=4, end_lineno=29, end_col_offset=9), annotation=Name(id='bool', ctx=Load(), lineno=29, col_offset=11, end_lineno=29, end_col_offset=15), value=Constant(value=False, lineno=29, col_offset=18, end_lineno=29, end_col_offset=23), simple=1, lineno=29, col_offset=4, end_lineno=29, end_col_offset=23), FunctionDef(name='mark_success', args=arguments(args=[arg(arg='self', lineno=31, col_offset=21, end_lineno=31, end_col_offset=25)]), body=[Return(value=Call(func=Name(id='_replace_observation', ctx=Load(), lineno=32, col_offset=15, end_lineno=32, end_col_offset=35), args=[Name(id='self', ctx=Load(), lineno=32, col_offset=36, end_lineno=32, end_col_offset=40)], keywords=[keyword(arg='success', value=Constant(value=True, lineno=32, col_offset=50, end_lineno=32, end_col_offset=54), lineno=32, col_offset=42, end_lineno=32, end_col_offset=54)], lineno=32, col_offset=15, end_lineno=32, end_col_offset=55), lineno=32, col_offset=8, end_lineno=32, end_col_offset=55)], returns=Name(id='_ObservationRecord', ctx=Load(), lineno=31, col_offset=30, end_lineno=31, end_col_offset=48), lineno=31, col_offset=4, end_lineno=32, end_col_offset=55), FunctionDef(name='mark_error', args=arguments(args=[arg(arg='self', lineno=34, col_offset=19, end_lineno=34, end_col_offset=23)]), body=[Return(value=Call(func=Name(id='_replace_observation', ctx=Load(), lineno=35, col_offset=15, end_lineno=35, end_col_offset=35), args=[Name(id='self', ctx=Load(), lineno=35, col_offset=36, end_lineno=35, end_col_offset=40)], keywords=[keyword(arg='error', value=Constant(value=True, lineno=35, col_offset=48, end_lineno=35, end_col_offset=52), lineno=35, col_offset=42, end_lineno=35, end_col_offset=52)], lineno=35, col_offset=15, end_lineno=35, end_col_offset=53), lineno=35, col_offset=8, end_lineno=35, end_col_offset=53)], returns=Name(id='_ObservationRecord', ctx=Load(), lineno=34, col_offset=28, end_lineno=34, end_col_offset=46), lineno=34, col_offset=4, end_lineno=35, end_col_offset=53)], decorator_list=[Call(func=Name(id='dataclass', ctx=Load(), lineno=24, col_offset=1, end_lineno=24, end_col_offset=10), keywords=[keyword(arg='frozen', value=Constant(value=True, lineno=24, col_offset=18, end_lineno=24, end_col_offset=22), lineno=24, col_offset=11, end_lineno=24, end_col_offset=22)], lineno=24, col_offset=1, end_lineno=24, end_col_offset=23)], lineno=25, col_offset=0, end_lineno=35, end_col_offset=53), AnnAssign(target=Name(id='OBSERVATION_RECORDS', ctx=Store(), lineno=38, col_offset=0, end_lineno=38, end_col_offset=19), annotation=Subscript(value=Name(id='list', ctx=Load(), lineno=38, col_offset=21, end_lineno=38, end_col_offset=25), slice=Name(id='_ObservationRecord', ctx=Load(), lineno=38, col_offset=26, end_lineno=38, end_col_offset=44), ctx=Load(), lineno=38, col_offset=21, end_lineno=38, end_col_offset=45), value=List(ctx=Load(), lineno=38, col_offset=48, end_lineno=38, end_col_offset=50), simple=1, lineno=38, col_offset=0, end_lineno=38, end_col_offset=50), AnnAssign(target=Name(id='_OBSERVATION_INDEX', ctx=Store(), lineno=39, col_offset=0, end_lineno=39, end_col_offset=18), annotation=Subscript(value=Name(id='dict', ctx=Load(), lineno=39, col_offset=20, end_lineno=39, end_col_offset=24), slice=Tuple(elts=[Name(id='int', ctx=Load(), lineno=39, col_offset=25, end_lineno=39, end_col_offset=28), Name(id='int', ctx=Load(), lineno=39, col_offset=30, end_lineno=39, end_col_offset=33)], ctx=Load(), lineno=39, col_offset=25, end_lineno=39, end_col_offset=33), ctx=Load(), lineno=39, col_offset=20, end_lineno=39, end_col_offset=34), value=Dict(lineno=39, col_offset=37, end_lineno=39, end_col_offset=39), simple=1, lineno=39, col_offset=0, end_lineno=39, end_col_offset=39), FunctionDef(name='_replace_observation', args=arguments(args=[arg(arg='record', annotation=Name(id='_ObservationRecord', ctx=Load(), lineno=42, col_offset=33, end_lineno=42, end_col_offset=51), lineno=42, col_offset=25, end_lineno=42, end_col_offset=51)], kwarg=arg(arg='updates', annotation=Name(id='object', ctx=Load(), lineno=42, col_offset=64, end_lineno=42, end_col_offset=70), lineno=42, col_offset=55, end_lineno=42, end_col_offset=70)), body=[Assign(targets=[Name(id='index', ctx=Store(), lineno=43, col_offset=4, end_lineno=43, end_col_offset=9)], value=Call(func=Attribute(value=Name(id='_OBSERVATION_INDEX', ctx=Load(), lineno=43, col_offset=12, end_lineno=43, end_col_offset=30), attr='get', ctx=Load(), lineno=43, col_offset=12, end_lineno=43, end_col_offset=34), args=[Call(func=Name(id='id', ctx=Load(), lineno=43, col_offset=35, end_lineno=43, end_col_offset=37), args=[Name(id='record', ctx=Load(), lineno=43, col_offset=38, end_lineno=43, end_col_offset=44)], lineno=43, col_offset=35, end_lineno=43, end_col_offset=45)], lineno=43, col_offset=12, end_lineno=43, end_col_offset=46), lineno=43, col_offset=4, end_lineno=43, end_col_offset=46), If(test=Compare(left=Name(id='index', ctx=Load(), lineno=44, col_offset=7, end_lineno=44, end_col_offset=12), ops=[Is()], comparators=[Constant(value=None, lineno=44, col_offset=16, end_lineno=44, end_col_offset=20)], lineno=44, col_offset=7, end_lineno=44, end_col_offset=20), body=[Return(value=Name(id='record', ctx=Load(), lineno=45, col_offset=15, end_lineno=45, end_col_offset=21), lineno=45, col_offset=8, end_lineno=45, end_col_offset=21)], lineno=44, col_offset=4, end_lineno=45, end_col_offset=21), Assign(targets=[Name(id='updated', ctx=Store(), lineno=46, col_offset=4, end_lineno=46, end_col_offset=11)], value=Call(func=Name(id='replace', ctx=Load(), lineno=46, col_offset=14, end_lineno=46, end_col_offset=21), args=[Name(id='record', ctx=Load(), lineno=46, col_offset=22, end_lineno=46, end_col_offset=28)], keywords=[keyword(value=Name(id='updates', ctx=Load(), lineno=46, col_offset=32, end_lineno=46, end_col_offset=39), lineno=46, col_offset=30, end_lineno=46, end_col_offset=39)], lineno=46, col_offset=14, end_lineno=46, end_col_offset=40), lineno=46, col_offset=4, end_lineno=46, end_col_offset=40), Assign(targets=[Subscript(value=Name(id='OBSERVATION_RECORDS', ctx=Load(), lineno=47, col_offset=4, end_lineno=47, end_col_offset=23), slice=Name(id='index', ctx=Load(), lineno=47, col_offset=24, end_lineno=47, end_col_offset=29), ctx=Store(), lineno=47, col_offset=4, end_lineno=47, end_col_offset=30)], value=Name(id='updated', ctx=Load(), lineno=47, col_offset=33, end_lineno=47, end_col_offset=40), lineno=47, col_offset=4, end_lineno=47, end_col_offset=40), Return(value=Name(id='updated', ctx=Load(), lineno=48, col_offset=11, end_lineno=48, end_col_offset=18), lineno=48, col_offset=4, end_lineno=48, end_col_offset=18)], returns=Name(id='_ObservationRecord', ctx=Load(), lineno=42, col_offset=75, end_lineno=42, end_col_offset=93), lineno=42, col_offset=0, end_lineno=48, end_col_offset=18), FunctionDef(name='_patch_observe_duration', args=arguments(args=[arg(arg='monkeypatch', annotation=Attribute(value=Name(id='pytest', ctx=Load(), lineno=52, col_offset=41, end_lineno=52, end_col_offset=47), attr='MonkeyPatch', ctx=Load(), lineno=52, col_offset=41, end_lineno=52, end_col_offset=59), lineno=52, col_offset=28, end_lineno=52, end_col_offset=59)]), body=[Expr(value=Constant(value='Patch observe_duration so tests do not touch real metrics.', lineno=53, col_offset=4, end_lineno=53, end_col_offset=68), lineno=53, col_offset=4, end_lineno=53, end_col_offset=68), Expr(value=Call(func=Attribute(value=Name(id='OBSERVATION_RECORDS', ctx=Load(), lineno=54, col_offset=4, end_lineno=54, end_col_offset=23), attr='clear', ctx=Load(), lineno=54, col_offset=4, end_lineno=54, end_col_offset=29), lineno=54, col_offset=4, end_lineno=54, end_col_offset=31), lineno=54, col_offset=4, end_lineno=54, end_col_offset=31), Expr(value=Call(func=Attribute(value=Name(id='_OBSERVATION_INDEX', ctx=Load(), lineno=55, col_offset=4, end_lineno=55, end_col_offset=22), attr='clear', ctx=Load(), lineno=55, col_offset=4, end_lineno=55, end_col_offset=28), lineno=55, col_offset=4, end_lineno=55, end_col_offset=30), lineno=55, col_offset=4, end_lineno=55, end_col_offset=30), FunctionDef(name='_fake_observe', args=arguments(args=[arg(arg='operation', annotation=Name(id='str', ctx=Load(), lineno=58, col_offset=33, end_lineno=58, end_col_offset=36), lineno=58, col_offset=22, end_lineno=58, end_col_offset=36), arg(arg='component', annotation=Name(id='str', ctx=Load(), lineno=58, col_offset=49, end_lineno=58, end_col_offset=52), lineno=58, col_offset=38, end_lineno=58, end_col_offset=52)], kwarg=arg(arg='_', annotation=Name(id='object', ctx=Load(), lineno=58, col_offset=59, end_lineno=58, end_col_offset=65), lineno=58, col_offset=56, end_lineno=58, end_col_offset=65)), body=[Assign(targets=[Name(id='record', ctx=Store(), lineno=59, col_offset=8, end_lineno=59, end_col_offset=14)], value=Call(func=Name(id='_ObservationRecord', ctx=Load(), lineno=59, col_offset=17, end_lineno=59, end_col_offset=35), keywords=[keyword(arg='operation', value=Name(id='operation', ctx=Load(), lineno=59, col_offset=46, end_lineno=59, end_col_offset=55), lineno=59, col_offset=36, end_lineno=59, end_col_offset=55), keyword(arg='component', value=Name(id='component', ctx=Load(), lineno=59, col_offset=67, end_lineno=59, end_col_offset=76), lineno=59, col_offset=57, end_lineno=59, end_col_offset=76)], lineno=59, col_offset=17, end_lineno=59, end_col_offset=77), lineno=59, col_offset=8, end_lineno=59, end_col_offset=77), Expr(value=Call(func=Attribute(value=Name(id='OBSERVATION_RECORDS', ctx=Load(), lineno=60, col_offset=8, end_lineno=60, end_col_offset=27), attr='append', ctx=Load(), lineno=60, col_offset=8, end_lineno=60, end_col_offset=34), args=[Name(id='record', ctx=Load(), lineno=60, col_offset=35, end_lineno=60, end_col_offset=41)], lineno=60, col_offset=8, end_lineno=60, end_col_offset=42), lineno=60, col_offset=8, end_lineno=60, end_col_offset=42), Assign(targets=[Subscript(value=Name(id='_OBSERVATION_INDEX', ctx=Load(), lineno=61, col_offset=8, end_lineno=61, end_col_offset=26), slice=Call(func=Name(id='id', ctx=Load(), lineno=61, col_offset=27, end_lineno=61, end_col_offset=29), args=[Name(id='record', ctx=Load(), lineno=61, col_offset=30, end_lineno=61, end_col_offset=36)], lineno=61, col_offset=27, end_lineno=61, end_col_offset=37), ctx=Store(), lineno=61, col_offset=8, end_lineno=61, end_col_offset=38)], value=BinOp(left=Call(func=Name(id='len', ctx=Load(), lineno=61, col_offset=41, end_lineno=61, end_col_offset=44), args=[Name(id='OBSERVATION_RECORDS', ctx=Load(), lineno=61, col_offset=45, end_lineno=61, end_col_offset=64)], lineno=61, col_offset=41, end_lineno=61, end_col_offset=65), op=Sub(), right=Constant(value=1, lineno=61, col_offset=68, end_lineno=61, end_col_offset=69), lineno=61, col_offset=41, end_lineno=61, end_col_offset=69), lineno=61, col_offset=8, end_lineno=61, end_col_offset=69), Try(body=[Expr(value=Yield(value=Name(id='record', ctx=Load(), lineno=63, col_offset=18, end_lineno=63, end_col_offset=24), lineno=63, col_offset=12, end_lineno=63, end_col_offset=24), lineno=63, col_offset=12, end_lineno=63, end_col_offset=24)], finalbody=[Expr(value=Call(func=Attribute(value=Name(id='_OBSERVATION_INDEX', ctx=Load(), lineno=65, col_offset=12, end_lineno=65, end_col_offset=30), attr='pop', ctx=Load(), lineno=65, col_offset=12, end_lineno=65, end_col_offset=34), args=[Call(func=Name(id='id', ctx=Load(), lineno=65, col_offset=35, end_lineno=65, end_col_offset=37), args=[Name(id='record', ctx=Load(), lineno=65, col_offset=38, end_lineno=65, end_col_offset=44)], lineno=65, col_offset=35, end_lineno=65, end_col_offset=45), Constant(value=None, lineno=65, col_offset=47, end_lineno=65, end_col_offset=51)], lineno=65, col_offset=12, end_lineno=65, end_col_offset=52), lineno=65, col_offset=12, end_lineno=65, end_col_offset=52)], lineno=62, col_offset=8, end_lineno=65, end_col_offset=52)], decorator_list=[Name(id='contextmanager', ctx=Load(), lineno=57, col_offset=5, end_lineno=57, end_col_offset=19)], returns=Subscript(value=Name(id='Iterator', ctx=Load(), lineno=58, col_offset=70, end_lineno=58, end_col_offset=78), slice=Name(id='_ObservationRecord', ctx=Load(), lineno=58, col_offset=79, end_lineno=58, end_col_offset=97), ctx=Load(), lineno=58, col_offset=70, end_lineno=58, end_col_offset=98), lineno=58, col_offset=4, end_lineno=65, end_col_offset=52), Expr(value=Call(func=Attribute(value=Name(id='monkeypatch', ctx=Load(), lineno=67, col_offset=4, end_lineno=67, end_col_offset=15), attr='setattr', ctx=Load(), lineno=67, col_offset=4, end_lineno=67, end_col_offset=23), args=[Constant(value='codeintel_rev.mcp_server.adapters.semantic.observe_duration', lineno=68, col_offset=8, end_lineno=68, end_col_offset=69), Name(id='_fake_observe', ctx=Load(), lineno=69, col_offset=8, end_lineno=69, end_col_offset=21)], lineno=67, col_offset=4, end_lineno=70, end_col_offset=5), lineno=67, col_offset=4, end_lineno=70, end_col_offset=5)], decorator_list=[Call(func=Attribute(value=Name(id='pytest', ctx=Load(), lineno=51, col_offset=1, end_lineno=51, end_col_offset=7), attr='fixture', ctx=Load(), lineno=51, col_offset=1, end_lineno=51, end_col_offset=15), keywords=[keyword(arg='autouse', value=Constant(value=True, lineno=51, col_offset=24, end_lineno=51, end_col_offset=28), lineno=51, col_offset=16, end_lineno=51, end_col_offset=28)], lineno=51, col_offset=1, end_lineno=51, end_col_offset=29)], returns=Constant(value=None, lineno=52, col_offset=64, end_lineno=52, end_col_offset=68), lineno=52, col_offset=0, end_lineno=70, end_col_offset=5), FunctionDef(name='observe_duration_calls', args=arguments(), body=[Expr(value=Constant(value='Return recorded observation calls from the semantic adapter.\n\n    Returns\n    -------\n    list[_ObservationRecord]\n        Recorded observation entries captured by the patched helper.\n    ', lineno=75, col_offset=4, end_lineno=81, end_col_offset=7), lineno=75, col_offset=4, end_lineno=81, end_col_offset=7), Return(value=Name(id='OBSERVATION_RECORDS', ctx=Load(), lineno=82, col_offset=11, end_lineno=82, end_col_offset=30), lineno=82, col_offset=4, end_lineno=82, end_col_offset=30)], decorator_list=[Attribute(value=Name(id='pytest', ctx=Load(), lineno=73, col_offset=1, end_lineno=73, end_col_offset=7), attr='fixture', ctx=Load(), lineno=73, col_offset=1, end_lineno=73, end_col_offset=15)], returns=Subscript(value=Name(id='list', ctx=Load(), lineno=74, col_offset=32, end_lineno=74, end_col_offset=36), slice=Name(id='_ObservationRecord', ctx=Load(), lineno=74, col_offset=37, end_lineno=74, end_col_offset=55), ctx=Load(), lineno=74, col_offset=32, end_lineno=74, end_col_offset=56), lineno=74, col_offset=0, end_lineno=82, end_col_offset=30), AsyncFunctionDef(name='test_semantic_search_observes_duration', args=arguments(args=[arg(arg='observe_duration_calls', annotation=Subscript(value=Name(id='list', ctx=Load(), lineno=87, col_offset=28, end_lineno=87, end_col_offset=32), slice=Name(id='_ObservationRecord', ctx=Load(), lineno=87, col_offset=33, end_lineno=87, end_col_offset=51), ctx=Load(), lineno=87, col_offset=28, end_lineno=87, end_col_offset=52), lineno=87, col_offset=4, end_lineno=87, end_col_offset=52)]), body=[Assign(targets=[Name(id='context', ctx=Store(), lineno=89, col_offset=4, end_lineno=89, end_col_offset=11)], value=Call(func=Name(id='StubContext', ctx=Load(), lineno=89, col_offset=14, end_lineno=89, end_col_offset=25), keywords=[keyword(arg='faiss_manager', value=Call(func=Name(id='_BaseStubFAISSManager', ctx=Load(), lineno=90, col_offset=22, end_lineno=90, end_col_offset=43), keywords=[keyword(arg='should_fail_gpu', value=Constant(value=False, lineno=90, col_offset=60, end_lineno=90, end_col_offset=65), lineno=90, col_offset=44, end_lineno=90, end_col_offset=65)], lineno=90, col_offset=22, end_lineno=90, end_col_offset=66), lineno=90, col_offset=8, end_lineno=90, end_col_offset=66), keyword(arg='config', value=Call(func=Name(id='StubContextConfig', ctx=Load(), lineno=91, col_offset=15, end_lineno=91, end_col_offset=32), keywords=[keyword(arg='limits', value=List(ctx=Load(), lineno=91, col_offset=40, end_lineno=91, end_col_offset=42), lineno=91, col_offset=33, end_lineno=91, end_col_offset=42), keyword(arg='error', value=Constant(value=None, lineno=91, col_offset=50, end_lineno=91, end_col_offset=54), lineno=91, col_offset=44, end_lineno=91, end_col_offset=54)], lineno=91, col_offset=15, end_lineno=91, end_col_offset=55), lineno=91, col_offset=8, end_lineno=91, end_col_offset=55)], lineno=89, col_offset=14, end_lineno=92, end_col_offset=5), lineno=89, col_offset=4, end_lineno=92, end_col_offset=5), With(items=[withitem(context_expr=Call(func=Name(id='patch', ctx=Load(), lineno=95, col_offset=8, end_lineno=95, end_col_offset=13), args=[Constant(value='codeintel_rev.mcp_server.adapters.semantic.get_session_id', lineno=96, col_offset=12, end_lineno=96, end_col_offset=71)], keywords=[keyword(arg='return_value', value=Constant(value='session-observe', lineno=97, col_offset=25, end_lineno=97, end_col_offset=42), lineno=97, col_offset=12, end_lineno=97, end_col_offset=42)], lineno=95, col_offset=8, end_lineno=98, end_col_offset=9)), withitem(context_expr=Call(func=Name(id='patch', ctx=Load(), lineno=99, col_offset=8, end_lineno=99, end_col_offset=13), args=[Constant(value='codeintel_rev.mcp_server.adapters.semantic.get_effective_scope', lineno=100, col_offset=12, end_lineno=100, end_col_offset=76)], keywords=[keyword(arg='return_value', value=Constant(value=None, lineno=101, col_offset=25, end_lineno=101, end_col_offset=29), lineno=101, col_offset=12, end_lineno=101, end_col_offset=29)], lineno=99, col_offset=8, end_lineno=102, end_col_offset=9))], body=[Assign(targets=[Name(id='result', ctx=Store(), lineno=104, col_offset=8, end_lineno=104, end_col_offset=14)], value=Await(value=Call(func=Name(id='semantic_search', ctx=Load(), lineno=104, col_offset=23, end_lineno=104, end_col_offset=38), args=[Call(func=Name(id='cast', ctx=Load(), lineno=104, col_offset=39, end_lineno=104, end_col_offset=43), args=[Constant(value='ApplicationContext', lineno=104, col_offset=44, end_lineno=104, end_col_offset=64), Name(id='context', ctx=Load(), lineno=104, col_offset=66, end_lineno=104, end_col_offset=73)], lineno=104, col_offset=39, end_lineno=104, end_col_offset=74), Constant(value='hello world', lineno=104, col_offset=76, end_lineno=104, end_col_offset=89)], keywords=[keyword(arg='limit', value=Constant(value=1, lineno=104, col_offset=97, end_lineno=104, end_col_offset=98), lineno=104, col_offset=91, end_lineno=104, end_col_offset=98)], lineno=104, col_offset=23, end_lineno=104, end_col_offset=99), lineno=104, col_offset=17, end_lineno=104, end_col_offset=99), lineno=104, col_offset=8, end_lineno=104, end_col_offset=99)], lineno=94, col_offset=4, end_lineno=104, end_col_offset=99), Assert(test=Call(func=Attribute(value=Name(id='result', ctx=Load(), lineno=106, col_offset=11, end_lineno=106, end_col_offset=17), attr='get', ctx=Load(), lineno=106, col_offset=11, end_lineno=106, end_col_offset=21), args=[Constant(value='findings', lineno=106, col_offset=22, end_lineno=106, end_col_offset=32)], lineno=106, col_offset=11, end_lineno=106, end_col_offset=33), lineno=106, col_offset=4, end_lineno=106, end_col_offset=33), Assert(test=Name(id='observe_duration_calls', ctx=Load(), lineno=107, col_offset=11, end_lineno=107, end_col_offset=33), lineno=107, col_offset=4, end_lineno=107, end_col_offset=33), Assign(targets=[Name(id='observation', ctx=Store(), lineno=108, col_offset=4, end_lineno=108, end_col_offset=15)], value=Subscript(value=Name(id='observe_duration_calls', ctx=Load(), lineno=108, col_offset=18, end_lineno=108, end_col_offset=40), slice=Constant(value=0, lineno=108, col_offset=41, end_lineno=108, end_col_offset=42), ctx=Load(), lineno=108, col_offset=18, end_lineno=108, end_col_offset=43), lineno=108, col_offset=4, end_lineno=108, end_col_offset=43), Assert(test=Compare(left=Attribute(value=Name(id='observation', ctx=Load(), lineno=109, col_offset=11, end_lineno=109, end_col_offset=22), attr='operation', ctx=Load(), lineno=109, col_offset=11, end_lineno=109, end_col_offset=32), ops=[Eq()], comparators=[Constant(value='semantic_search', lineno=109, col_offset=36, end_lineno=109, end_col_offset=53)], lineno=109, col_offset=11, end_lineno=109, end_col_offset=53), lineno=109, col_offset=4, end_lineno=109, end_col_offset=53), Assert(test=Compare(left=Attribute(value=Name(id='observation', ctx=Load(), lineno=110, col_offset=11, end_lineno=110, end_col_offset=22), attr='component', ctx=Load(), lineno=110, col_offset=11, end_lineno=110, end_col_offset=32), ops=[Eq()], comparators=[Constant(value='codeintel_mcp', lineno=110, col_offset=36, end_lineno=110, end_col_offset=51)], lineno=110, col_offset=11, end_lineno=110, end_col_offset=51), lineno=110, col_offset=4, end_lineno=110, end_col_offset=51), Assert(test=Compare(left=Attribute(value=Name(id='observation', ctx=Load(), lineno=111, col_offset=11, end_lineno=111, end_col_offset=22), attr='success', ctx=Load(), lineno=111, col_offset=11, end_lineno=111, end_col_offset=30), ops=[Is()], comparators=[Constant(value=True, lineno=111, col_offset=34, end_lineno=111, end_col_offset=38)], lineno=111, col_offset=11, end_lineno=111, end_col_offset=38), lineno=111, col_offset=4, end_lineno=111, end_col_offset=38)], decorator_list=[Attribute(value=Attribute(value=Name(id='pytest', ctx=Load(), lineno=85, col_offset=1, end_lineno=85, end_col_offset=7), attr='mark', ctx=Load(), lineno=85, col_offset=1, end_lineno=85, end_col_offset=12), attr='asyncio', ctx=Load(), lineno=85, col_offset=1, end_lineno=85, end_col_offset=20)], returns=Constant(value=None, lineno=88, col_offset=5, end_lineno=88, end_col_offset=9), lineno=86, col_offset=0, end_lineno=111, end_col_offset=38), ClassDef(name='StubDuckDBCatalog', body=[Expr(value=Constant(value='Stub DuckDB catalog for testing.\n\n    Parameters\n    ----------\n    _db_path : Any\n        Database path (unused in stub).\n    _vectors_dir : Any\n        Vectors directory (unused in stub).\n    chunks : list[dict[str, Any]] | None, optional\n        List of chunks to return. If None, uses default chunk.\n    ', lineno=115, col_offset=4, end_lineno=125, end_col_offset=7), lineno=115, col_offset=4, end_lineno=125, end_col_offset=7), FunctionDef(name='__init__', args=arguments(args=[arg(arg='self', lineno=128, col_offset=8, end_lineno=128, end_col_offset=12), arg(arg='_db_path', annotation=Name(id='Any', ctx=Load(), lineno=129, col_offset=18, end_lineno=129, end_col_offset=21), lineno=129, col_offset=8, end_lineno=129, end_col_offset=21), arg(arg='_vectors_dir', annotation=Name(id='Any', ctx=Load(), lineno=130, col_offset=22, end_lineno=130, end_col_offset=25), lineno=130, col_offset=8, end_lineno=130, end_col_offset=25)], kwonlyargs=[arg(arg='chunks', annotation=BinOp(left=Subscript(value=Name(id='list', ctx=Load(), lineno=132, col_offset=16, end_lineno=132, end_col_offset=20), slice=Subscript(value=Name(id='dict', ctx=Load(), lineno=132, col_offset=21, end_lineno=132, end_col_offset=25), slice=Tuple(elts=[Name(id='str', ctx=Load(), lineno=132, col_offset=26, end_lineno=132, end_col_offset=29), Name(id='Any', ctx=Load(), lineno=132, col_offset=31, end_lineno=132, end_col_offset=34)], ctx=Load(), lineno=132, col_offset=26, end_lineno=132, end_col_offset=34), ctx=Load(), lineno=132, col_offset=21, end_lineno=132, end_col_offset=35), ctx=Load(), lineno=132, col_offset=16, end_lineno=132, end_col_offset=36), op=BitOr(), right=Constant(value=None, lineno=132, col_offset=39, end_lineno=132, end_col_offset=43), lineno=132, col_offset=16, end_lineno=132, end_col_offset=43), lineno=132, col_offset=8, end_lineno=132, end_col_offset=43)], kw_defaults=[Constant(value=None, lineno=132, col_offset=46, end_lineno=132, end_col_offset=50)]), body=[If(test=Compare(left=Name(id='chunks', ctx=Load(), lineno=134, col_offset=11, end_lineno=134, end_col_offset=17), ops=[Is()], comparators=[Constant(value=None, lineno=134, col_offset=21, end_lineno=134, end_col_offset=25)], lineno=134, col_offset=11, end_lineno=134, end_col_offset=25), body=[Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=135, col_offset=12, end_lineno=135, end_col_offset=16), attr='_chunks', ctx=Store(), lineno=135, col_offset=12, end_lineno=135, end_col_offset=24)], value=List(elts=[Dict(keys=[Constant(value='id', lineno=137, col_offset=20, end_lineno=137, end_col_offset=24), Constant(value='uri', lineno=138, col_offset=20, end_lineno=138, end_col_offset=25), Constant(value='start_line', lineno=139, col_offset=20, end_lineno=139, end_col_offset=32), Constant(value='end_line', lineno=140, col_offset=20, end_lineno=140, end_col_offset=30), Constant(value='preview', lineno=141, col_offset=20, end_lineno=141, end_col_offset=29)], values=[Constant(value=123, lineno=137, col_offset=26, end_lineno=137, end_col_offset=29), Constant(value='src/module.py', lineno=138, col_offset=27, end_lineno=138, end_col_offset=42), Constant(value=0, lineno=139, col_offset=34, end_lineno=139, end_col_offset=35), Constant(value=0, lineno=140, col_offset=32, end_lineno=140, end_col_offset=33), Constant(value='code snippet', lineno=141, col_offset=31, end_lineno=141, end_col_offset=45)], lineno=136, col_offset=16, end_lineno=142, end_col_offset=17)], ctx=Load(), lineno=135, col_offset=27, end_lineno=143, end_col_offset=13), lineno=135, col_offset=12, end_lineno=143, end_col_offset=13)], orelse=[Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=145, col_offset=12, end_lineno=145, end_col_offset=16), attr='_chunks', ctx=Store(), lineno=145, col_offset=12, end_lineno=145, end_col_offset=24)], value=Name(id='chunks', ctx=Load(), lineno=145, col_offset=27, end_lineno=145, end_col_offset=33), lineno=145, col_offset=12, end_lineno=145, end_col_offset=33)], lineno=134, col_offset=8, end_lineno=145, end_col_offset=33), Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=146, col_offset=8, end_lineno=146, end_col_offset=12), attr='_chunk', ctx=Store(), lineno=146, col_offset=8, end_lineno=146, end_col_offset=19)], value=IfExp(test=Attribute(value=Name(id='self', ctx=Load(), lineno=146, col_offset=41, end_lineno=146, end_col_offset=45), attr='_chunks', ctx=Load(), lineno=146, col_offset=41, end_lineno=146, end_col_offset=53), body=Subscript(value=Attribute(value=Name(id='self', ctx=Load(), lineno=146, col_offset=22, end_lineno=146, end_col_offset=26), attr='_chunks', ctx=Load(), lineno=146, col_offset=22, end_lineno=146, end_col_offset=34), slice=Constant(value=0, lineno=146, col_offset=35, end_lineno=146, end_col_offset=36), ctx=Load(), lineno=146, col_offset=22, end_lineno=146, end_col_offset=37), orelse=Dict(lineno=146, col_offset=59, end_lineno=146, end_col_offset=61), lineno=146, col_offset=22, end_lineno=146, end_col_offset=61), lineno=146, col_offset=8, end_lineno=146, end_col_offset=61)], returns=Constant(value=None, lineno=133, col_offset=9, end_lineno=133, end_col_offset=13), lineno=127, col_offset=4, end_lineno=146, end_col_offset=61), FunctionDef(name='__enter__', args=arguments(args=[arg(arg='self', lineno=148, col_offset=18, end_lineno=148, end_col_offset=22)]), body=[Expr(value=Constant(value='Enter context manager.\n\n        Returns\n        -------\n        Self\n            Self instance.\n        ', lineno=149, col_offset=8, end_lineno=155, end_col_offset=11), lineno=149, col_offset=8, end_lineno=155, end_col_offset=11), Return(value=Name(id='self', ctx=Load(), lineno=156, col_offset=15, end_lineno=156, end_col_offset=19), lineno=156, col_offset=8, end_lineno=156, end_col_offset=19)], returns=Name(id='Self', ctx=Load(), lineno=148, col_offset=27, end_lineno=148, end_col_offset=31), lineno=148, col_offset=4, end_lineno=156, end_col_offset=19), FunctionDef(name='__exit__', args=arguments(args=[arg(arg='self', lineno=159, col_offset=8, end_lineno=159, end_col_offset=12), arg(arg='exc_type', annotation=BinOp(left=Subscript(value=Name(id='type', ctx=Load(), lineno=160, col_offset=18, end_lineno=160, end_col_offset=22), slice=Name(id='BaseException', ctx=Load(), lineno=160, col_offset=23, end_lineno=160, end_col_offset=36), ctx=Load(), lineno=160, col_offset=18, end_lineno=160, end_col_offset=37), op=BitOr(), right=Constant(value=None, lineno=160, col_offset=40, end_lineno=160, end_col_offset=44), lineno=160, col_offset=18, end_lineno=160, end_col_offset=44), lineno=160, col_offset=8, end_lineno=160, end_col_offset=44), arg(arg='exc', annotation=BinOp(left=Name(id='BaseException', ctx=Load(), lineno=161, col_offset=13, end_lineno=161, end_col_offset=26), op=BitOr(), right=Constant(value=None, lineno=161, col_offset=29, end_lineno=161, end_col_offset=33), lineno=161, col_offset=13, end_lineno=161, end_col_offset=33), lineno=161, col_offset=8, end_lineno=161, end_col_offset=33), arg(arg='tb', annotation=BinOp(left=Attribute(value=Name(id='types', ctx=Load(), lineno=162, col_offset=12, end_lineno=162, end_col_offset=17), attr='TracebackType', ctx=Load(), lineno=162, col_offset=12, end_lineno=162, end_col_offset=31), op=BitOr(), right=Constant(value=None, lineno=162, col_offset=34, end_lineno=162, end_col_offset=38), lineno=162, col_offset=12, end_lineno=162, end_col_offset=38), lineno=162, col_offset=8, end_lineno=162, end_col_offset=38)]), body=[Expr(value=Constant(value='Exit context manager.\n\n        Parameters\n        ----------\n        exc_type : type[BaseException] | None\n            Exception type.\n        exc : BaseException | None\n            Exception instance.\n        tb : types.TracebackType | None\n            Traceback.\n\n        Returns\n        -------\n        bool\n            Always returns False.\n        ', lineno=164, col_offset=8, end_lineno=179, end_col_offset=11), lineno=164, col_offset=8, end_lineno=179, end_col_offset=11), Return(value=Constant(value=False, lineno=180, col_offset=15, end_lineno=180, end_col_offset=20), lineno=180, col_offset=8, end_lineno=180, end_col_offset=20)], returns=Name(id='bool', ctx=Load(), lineno=163, col_offset=9, end_lineno=163, end_col_offset=13), lineno=158, col_offset=4, end_lineno=180, end_col_offset=20), FunctionDef(name='get_chunk_by_id', args=arguments(args=[arg(arg='self', lineno=182, col_offset=24, end_lineno=182, end_col_offset=28), arg(arg='chunk_id', annotation=Name(id='int', ctx=Load(), lineno=182, col_offset=40, end_lineno=182, end_col_offset=43), lineno=182, col_offset=30, end_lineno=182, end_col_offset=43)]), body=[Return(value=IfExp(test=Compare(left=Name(id='chunk_id', ctx=Load(), lineno=183, col_offset=30, end_lineno=183, end_col_offset=38), ops=[Eq()], comparators=[Constant(value=123, lineno=183, col_offset=42, end_lineno=183, end_col_offset=45)], lineno=183, col_offset=30, end_lineno=183, end_col_offset=45), body=Attribute(value=Name(id='self', ctx=Load(), lineno=183, col_offset=15, end_lineno=183, end_col_offset=19), attr='_chunk', ctx=Load(), lineno=183, col_offset=15, end_lineno=183, end_col_offset=26), orelse=Constant(value=None, lineno=183, col_offset=51, end_lineno=183, end_col_offset=55), lineno=183, col_offset=15, end_lineno=183, end_col_offset=55), lineno=183, col_offset=8, end_lineno=183, end_col_offset=55)], returns=BinOp(left=Subscript(value=Name(id='dict', ctx=Load(), lineno=182, col_offset=48, end_lineno=182, end_col_offset=52), slice=Tuple(elts=[Name(id='str', ctx=Load(), lineno=182, col_offset=53, end_lineno=182, end_col_offset=56), Name(id='Any', ctx=Load(), lineno=182, col_offset=58, end_lineno=182, end_col_offset=61)], ctx=Load(), lineno=182, col_offset=53, end_lineno=182, end_col_offset=61), ctx=Load(), lineno=182, col_offset=48, end_lineno=182, end_col_offset=62), op=BitOr(), right=Constant(value=None, lineno=182, col_offset=65, end_lineno=182, end_col_offset=69), lineno=182, col_offset=48, end_lineno=182, end_col_offset=69), lineno=182, col_offset=4, end_lineno=183, end_col_offset=55), FunctionDef(name='query_by_ids', args=arguments(args=[arg(arg='self', lineno=185, col_offset=21, end_lineno=185, end_col_offset=25), arg(arg='chunk_ids', annotation=Subscript(value=Name(id='list', ctx=Load(), lineno=185, col_offset=38, end_lineno=185, end_col_offset=42), slice=Name(id='int', ctx=Load(), lineno=185, col_offset=43, end_lineno=185, end_col_offset=46), ctx=Load(), lineno=185, col_offset=38, end_lineno=185, end_col_offset=47), lineno=185, col_offset=27, end_lineno=185, end_col_offset=47)]), body=[Expr(value=Constant(value='Query chunks by IDs.\n\n        Parameters\n        ----------\n        chunk_ids : list[int]\n            List of chunk IDs to query.\n\n        Returns\n        -------\n        list[dict[str, Any]]\n            List of chunks matching the IDs.\n        ', lineno=186, col_offset=8, end_lineno=197, end_col_offset=11), lineno=186, col_offset=8, end_lineno=197, end_col_offset=11), Return(value=ListComp(elt=Call(func=Name(id='dict', ctx=Load(), lineno=198, col_offset=16, end_lineno=198, end_col_offset=20), args=[Name(id='chunk', ctx=Load(), lineno=198, col_offset=21, end_lineno=198, end_col_offset=26)], lineno=198, col_offset=16, end_lineno=198, end_col_offset=27), generators=[comprehension(target=Name(id='chunk', ctx=Store(), lineno=198, col_offset=32, end_lineno=198, end_col_offset=37), iter=Attribute(value=Name(id='self', ctx=Load(), lineno=198, col_offset=41, end_lineno=198, end_col_offset=45), attr='_chunks', ctx=Load(), lineno=198, col_offset=41, end_lineno=198, end_col_offset=53), ifs=[Compare(left=Call(func=Attribute(value=Name(id='chunk', ctx=Load(), lineno=198, col_offset=57, end_lineno=198, end_col_offset=62), attr='get', ctx=Load(), lineno=198, col_offset=57, end_lineno=198, end_col_offset=66), args=[Constant(value='id', lineno=198, col_offset=67, end_lineno=198, end_col_offset=71)], lineno=198, col_offset=57, end_lineno=198, end_col_offset=72), ops=[In()], comparators=[Name(id='chunk_ids', ctx=Load(), lineno=198, col_offset=76, end_lineno=198, end_col_offset=85)], lineno=198, col_offset=57, end_lineno=198, end_col_offset=85)], is_async=0)], lineno=198, col_offset=15, end_lineno=198, end_col_offset=86), lineno=198, col_offset=8, end_lineno=198, end_col_offset=86)], returns=Subscript(value=Name(id='list', ctx=Load(), lineno=185, col_offset=52, end_lineno=185, end_col_offset=56), slice=Subscript(value=Name(id='dict', ctx=Load(), lineno=185, col_offset=57, end_lineno=185, end_col_offset=61), slice=Tuple(elts=[Name(id='str', ctx=Load(), lineno=185, col_offset=62, end_lineno=185, end_col_offset=65), Name(id='Any', ctx=Load(), lineno=185, col_offset=67, end_lineno=185, end_col_offset=70)], ctx=Load(), lineno=185, col_offset=62, end_lineno=185, end_col_offset=70), ctx=Load(), lineno=185, col_offset=57, end_lineno=185, end_col_offset=71), ctx=Load(), lineno=185, col_offset=52, end_lineno=185, end_col_offset=72), lineno=185, col_offset=4, end_lineno=198, end_col_offset=86), FunctionDef(name='query_by_filters', args=arguments(args=[arg(arg='self', lineno=201, col_offset=8, end_lineno=201, end_col_offset=12), arg(arg='chunk_ids', annotation=Subscript(value=Name(id='list', ctx=Load(), lineno=202, col_offset=19, end_lineno=202, end_col_offset=23), slice=Name(id='int', ctx=Load(), lineno=202, col_offset=24, end_lineno=202, end_col_offset=27), ctx=Load(), lineno=202, col_offset=19, end_lineno=202, end_col_offset=28), lineno=202, col_offset=8, end_lineno=202, end_col_offset=28)], kwonlyargs=[arg(arg='include_globs', annotation=BinOp(left=Subscript(value=Name(id='list', ctx=Load(), lineno=204, col_offset=23, end_lineno=204, end_col_offset=27), slice=Name(id='str', ctx=Load(), lineno=204, col_offset=28, end_lineno=204, end_col_offset=31), ctx=Load(), lineno=204, col_offset=23, end_lineno=204, end_col_offset=32), op=BitOr(), right=Constant(value=None, lineno=204, col_offset=35, end_lineno=204, end_col_offset=39), lineno=204, col_offset=23, end_lineno=204, end_col_offset=39), lineno=204, col_offset=8, end_lineno=204, end_col_offset=39), arg(arg='exclude_globs', annotation=BinOp(left=Subscript(value=Name(id='list', ctx=Load(), lineno=205, col_offset=23, end_lineno=205, end_col_offset=27), slice=Name(id='str', ctx=Load(), lineno=205, col_offset=28, end_lineno=205, end_col_offset=31), ctx=Load(), lineno=205, col_offset=23, end_lineno=205, end_col_offset=32), op=BitOr(), right=Constant(value=None, lineno=205, col_offset=35, end_lineno=205, end_col_offset=39), lineno=205, col_offset=23, end_lineno=205, end_col_offset=39), lineno=205, col_offset=8, end_lineno=205, end_col_offset=39), arg(arg='languages', annotation=BinOp(left=Subscript(value=Name(id='list', ctx=Load(), lineno=206, col_offset=19, end_lineno=206, end_col_offset=23), slice=Name(id='str', ctx=Load(), lineno=206, col_offset=24, end_lineno=206, end_col_offset=27), ctx=Load(), lineno=206, col_offset=19, end_lineno=206, end_col_offset=28), op=BitOr(), right=Constant(value=None, lineno=206, col_offset=31, end_lineno=206, end_col_offset=35), lineno=206, col_offset=19, end_lineno=206, end_col_offset=35), lineno=206, col_offset=8, end_lineno=206, end_col_offset=35)], kw_defaults=[Constant(value=None, lineno=204, col_offset=42, end_lineno=204, end_col_offset=46), Constant(value=None, lineno=205, col_offset=42, end_lineno=205, end_col_offset=46), Constant(value=None, lineno=206, col_offset=38, end_lineno=206, end_col_offset=42)]), body=[Expr(value=Constant(value='Query chunks by IDs with filters.\n\n        Parameters\n        ----------\n        chunk_ids : list[int]\n            List of chunk IDs to query.\n        include_globs : list[str] | None, optional\n            Glob patterns to include. Defaults to None.\n        exclude_globs : list[str] | None, optional\n            Glob patterns to exclude. Defaults to None.\n        languages : list[str] | None, optional\n            Languages to filter by. Defaults to None.\n\n        Returns\n        -------\n        list[dict[str, Any]]\n            Filtered list of chunks.\n        ', lineno=208, col_offset=8, end_lineno=225, end_col_offset=11), lineno=208, col_offset=8, end_lineno=225, end_col_offset=11), Import(names=[alias(name='fnmatch', lineno=226, col_offset=15, end_lineno=226, end_col_offset=22)], lineno=226, col_offset=8, end_lineno=226, end_col_offset=22), Assign(targets=[Name(id='filtered', ctx=Store(), lineno=228, col_offset=8, end_lineno=228, end_col_offset=16)], value=ListComp(elt=Call(func=Name(id='dict', ctx=Load(), lineno=228, col_offset=20, end_lineno=228, end_col_offset=24), args=[Name(id='chunk', ctx=Load(), lineno=228, col_offset=25, end_lineno=228, end_col_offset=30)], lineno=228, col_offset=20, end_lineno=228, end_col_offset=31), generators=[comprehension(target=Name(id='chunk', ctx=Store(), lineno=228, col_offset=36, end_lineno=228, end_col_offset=41), iter=Attribute(value=Name(id='self', ctx=Load(), lineno=228, col_offset=45, end_lineno=228, end_col_offset=49), attr='_chunks', ctx=Load(), lineno=228, col_offset=45, end_lineno=228, end_col_offset=57), ifs=[Compare(left=Call(func=Attribute(value=Name(id='chunk', ctx=Load(), lineno=228, col_offset=61, end_lineno=228, end_col_offset=66), attr='get', ctx=Load(), lineno=228, col_offset=61, end_lineno=228, end_col_offset=70), args=[Constant(value='id', lineno=228, col_offset=71, end_lineno=228, end_col_offset=75)], lineno=228, col_offset=61, end_lineno=228, end_col_offset=76), ops=[In()], comparators=[Name(id='chunk_ids', ctx=Load(), lineno=228, col_offset=80, end_lineno=228, end_col_offset=89)], lineno=228, col_offset=61, end_lineno=228, end_col_offset=89)], is_async=0)], lineno=228, col_offset=19, end_lineno=228, end_col_offset=90), lineno=228, col_offset=8, end_lineno=228, end_col_offset=90), If(test=Name(id='languages', ctx=Load(), lineno=231, col_offset=11, end_lineno=231, end_col_offset=20), body=[Assign(targets=[Name(id='extensions', ctx=Store(), lineno=232, col_offset=12, end_lineno=232, end_col_offset=22)], value=List(ctx=Load(), lineno=232, col_offset=25, end_lineno=232, end_col_offset=27), lineno=232, col_offset=12, end_lineno=232, end_col_offset=27), Assign(targets=[Name(id='language_exts', ctx=Store(), lineno=233, col_offset=12, end_lineno=233, end_col_offset=25)], value=Dict(keys=[Constant(value='python', lineno=234, col_offset=16, end_lineno=234, end_col_offset=24), Constant(value='typescript', lineno=235, col_offset=16, end_lineno=235, end_col_offset=28), Constant(value='javascript', lineno=236, col_offset=16, end_lineno=236, end_col_offset=28)], values=[List(elts=[Constant(value='.py', lineno=234, col_offset=27, end_lineno=234, end_col_offset=32), Constant(value='.pyi', lineno=234, col_offset=34, end_lineno=234, end_col_offset=40)], ctx=Load(), lineno=234, col_offset=26, end_lineno=234, end_col_offset=41), List(elts=[Constant(value='.ts', lineno=235, col_offset=31, end_lineno=235, end_col_offset=36), Constant(value='.tsx', lineno=235, col_offset=38, end_lineno=235, end_col_offset=44)], ctx=Load(), lineno=235, col_offset=30, end_lineno=235, end_col_offset=45), List(elts=[Constant(value='.js', lineno=236, col_offset=31, end_lineno=236, end_col_offset=36), Constant(value='.jsx', lineno=236, col_offset=38, end_lineno=236, end_col_offset=44)], ctx=Load(), lineno=236, col_offset=30, end_lineno=236, end_col_offset=45)], lineno=233, col_offset=28, end_lineno=237, end_col_offset=13), lineno=233, col_offset=12, end_lineno=237, end_col_offset=13), For(target=Name(id='lang', ctx=Store(), lineno=238, col_offset=16, end_lineno=238, end_col_offset=20), iter=Name(id='languages', ctx=Load(), lineno=238, col_offset=24, end_lineno=238, end_col_offset=33), body=[Expr(value=Call(func=Attribute(value=Name(id='extensions', ctx=Load(), lineno=239, col_offset=16, end_lineno=239, end_col_offset=26), attr='extend', ctx=Load(), lineno=239, col_offset=16, end_lineno=239, end_col_offset=33), args=[Call(func=Attribute(value=Name(id='language_exts', ctx=Load(), lineno=239, col_offset=34, end_lineno=239, end_col_offset=47), attr='get', ctx=Load(), lineno=239, col_offset=34, end_lineno=239, end_col_offset=51), args=[Call(func=Attribute(value=Name(id='lang', ctx=Load(), lineno=239, col_offset=52, end_lineno=239, end_col_offset=56), attr='lower', ctx=Load(), lineno=239, col_offset=52, end_lineno=239, end_col_offset=62), lineno=239, col_offset=52, end_lineno=239, end_col_offset=64), List(ctx=Load(), lineno=239, col_offset=66, end_lineno=239, end_col_offset=68)], lineno=239, col_offset=34, end_lineno=239, end_col_offset=69)], lineno=239, col_offset=16, end_lineno=239, end_col_offset=70), lineno=239, col_offset=16, end_lineno=239, end_col_offset=70)], lineno=238, col_offset=12, end_lineno=239, end_col_offset=70), If(test=Name(id='extensions', ctx=Load(), lineno=240, col_offset=15, end_lineno=240, end_col_offset=25), body=[Assign(targets=[Name(id='filtered', ctx=Store(), lineno=241, col_offset=16, end_lineno=241, end_col_offset=24)], value=ListComp(elt=Name(id='chunk', ctx=Load(), lineno=242, col_offset=20, end_lineno=242, end_col_offset=25), generators=[comprehension(target=Name(id='chunk', ctx=Store(), lineno=243, col_offset=24, end_lineno=243, end_col_offset=29), iter=Name(id='filtered', ctx=Load(), lineno=243, col_offset=33, end_lineno=243, end_col_offset=41), ifs=[BoolOp(op=And(), values=[Call(func=Name(id='isinstance', ctx=Load(), lineno=244, col_offset=23, end_lineno=244, end_col_offset=33), args=[Call(func=Attribute(value=Name(id='chunk', ctx=Load(), lineno=244, col_offset=34, end_lineno=244, end_col_offset=39), attr='get', ctx=Load(), lineno=244, col_offset=34, end_lineno=244, end_col_offset=43), args=[Constant(value='uri', lineno=244, col_offset=44, end_lineno=244, end_col_offset=49)], lineno=244, col_offset=34, end_lineno=244, end_col_offset=50), Name(id='str', ctx=Load(), lineno=244, col_offset=52, end_lineno=244, end_col_offset=55)], lineno=244, col_offset=23, end_lineno=244, end_col_offset=56), Call(func=Name(id='any', ctx=Load(), lineno=245, col_offset=24, end_lineno=245, end_col_offset=27), args=[GeneratorExp(elt=Call(func=Attribute(value=Subscript(value=Name(id='chunk', ctx=Load(), lineno=245, col_offset=28, end_lineno=245, end_col_offset=33), slice=Constant(value='uri', lineno=245, col_offset=34, end_lineno=245, end_col_offset=39), ctx=Load(), lineno=245, col_offset=28, end_lineno=245, end_col_offset=40), attr='endswith', ctx=Load(), lineno=245, col_offset=28, end_lineno=245, end_col_offset=49), args=[Name(id='ext', ctx=Load(), lineno=245, col_offset=50, end_lineno=245, end_col_offset=53)], lineno=245, col_offset=28, end_lineno=245, end_col_offset=54), generators=[comprehension(target=Name(id='ext', ctx=Store(), lineno=245, col_offset=59, end_lineno=245, end_col_offset=62), iter=Name(id='extensions', ctx=Load(), lineno=245, col_offset=66, end_lineno=245, end_col_offset=76), is_async=0)], lineno=245, col_offset=27, end_lineno=245, end_col_offset=77)], lineno=245, col_offset=24, end_lineno=245, end_col_offset=77)], lineno=244, col_offset=23, end_lineno=245, end_col_offset=77)], is_async=0)], lineno=241, col_offset=27, end_lineno=246, end_col_offset=17), lineno=241, col_offset=16, end_lineno=246, end_col_offset=17)], lineno=240, col_offset=12, end_lineno=246, end_col_offset=17)], lineno=231, col_offset=8, end_lineno=246, end_col_offset=17), If(test=Name(id='include_globs', ctx=Load(), lineno=249, col_offset=11, end_lineno=249, end_col_offset=24), body=[Assign(targets=[Name(id='filtered', ctx=Store(), lineno=250, col_offset=12, end_lineno=250, end_col_offset=20)], value=ListComp(elt=Name(id='chunk', ctx=Load(), lineno=251, col_offset=16, end_lineno=251, end_col_offset=21), generators=[comprehension(target=Name(id='chunk', ctx=Store(), lineno=252, col_offset=20, end_lineno=252, end_col_offset=25), iter=Name(id='filtered', ctx=Load(), lineno=252, col_offset=29, end_lineno=252, end_col_offset=37), ifs=[BoolOp(op=And(), values=[Call(func=Name(id='isinstance', ctx=Load(), lineno=253, col_offset=19, end_lineno=253, end_col_offset=29), args=[Call(func=Attribute(value=Name(id='chunk', ctx=Load(), lineno=253, col_offset=30, end_lineno=253, end_col_offset=35), attr='get', ctx=Load(), lineno=253, col_offset=30, end_lineno=253, end_col_offset=39), args=[Constant(value='uri', lineno=253, col_offset=40, end_lineno=253, end_col_offset=45)], lineno=253, col_offset=30, end_lineno=253, end_col_offset=46), Name(id='str', ctx=Load(), lineno=253, col_offset=48, end_lineno=253, end_col_offset=51)], lineno=253, col_offset=19, end_lineno=253, end_col_offset=52), Call(func=Name(id='any', ctx=Load(), lineno=254, col_offset=20, end_lineno=254, end_col_offset=23), args=[GeneratorExp(elt=Call(func=Attribute(value=Name(id='fnmatch', ctx=Load(), lineno=254, col_offset=24, end_lineno=254, end_col_offset=31), attr='fnmatch', ctx=Load(), lineno=254, col_offset=24, end_lineno=254, end_col_offset=39), args=[Subscript(value=Name(id='chunk', ctx=Load(), lineno=254, col_offset=40, end_lineno=254, end_col_offset=45), slice=Constant(value='uri', lineno=254, col_offset=46, end_lineno=254, end_col_offset=51), ctx=Load(), lineno=254, col_offset=40, end_lineno=254, end_col_offset=52), Name(id='pattern', ctx=Load(), lineno=254, col_offset=54, end_lineno=254, end_col_offset=61)], lineno=254, col_offset=24, end_lineno=254, end_col_offset=62), generators=[comprehension(target=Name(id='pattern', ctx=Store(), lineno=254, col_offset=67, end_lineno=254, end_col_offset=74), iter=Name(id='include_globs', ctx=Load(), lineno=254, col_offset=78, end_lineno=254, end_col_offset=91), is_async=0)], lineno=254, col_offset=23, end_lineno=254, end_col_offset=92)], lineno=254, col_offset=20, end_lineno=254, end_col_offset=92)], lineno=253, col_offset=19, end_lineno=254, end_col_offset=92)], is_async=0)], lineno=250, col_offset=23, end_lineno=255, end_col_offset=13), lineno=250, col_offset=12, end_lineno=255, end_col_offset=13)], lineno=249, col_offset=8, end_lineno=255, end_col_offset=13), If(test=Name(id='exclude_globs', ctx=Load(), lineno=258, col_offset=11, end_lineno=258, end_col_offset=24), body=[Assign(targets=[Name(id='filtered', ctx=Store(), lineno=259, col_offset=12, end_lineno=259, end_col_offset=20)], value=ListComp(elt=Name(id='chunk', ctx=Load(), lineno=260, col_offset=16, end_lineno=260, end_col_offset=21), generators=[comprehension(target=Name(id='chunk', ctx=Store(), lineno=261, col_offset=20, end_lineno=261, end_col_offset=25), iter=Name(id='filtered', ctx=Load(), lineno=261, col_offset=29, end_lineno=261, end_col_offset=37), ifs=[BoolOp(op=And(), values=[Call(func=Name(id='isinstance', ctx=Load(), lineno=262, col_offset=19, end_lineno=262, end_col_offset=29), args=[Call(func=Attribute(value=Name(id='chunk', ctx=Load(), lineno=262, col_offset=30, end_lineno=262, end_col_offset=35), attr='get', ctx=Load(), lineno=262, col_offset=30, end_lineno=262, end_col_offset=39), args=[Constant(value='uri', lineno=262, col_offset=40, end_lineno=262, end_col_offset=45)], lineno=262, col_offset=30, end_lineno=262, end_col_offset=46), Name(id='str', ctx=Load(), lineno=262, col_offset=48, end_lineno=262, end_col_offset=51)], lineno=262, col_offset=19, end_lineno=262, end_col_offset=52), UnaryOp(op=Not(), operand=Call(func=Name(id='any', ctx=Load(), lineno=263, col_offset=24, end_lineno=263, end_col_offset=27), args=[GeneratorExp(elt=Call(func=Attribute(value=Name(id='fnmatch', ctx=Load(), lineno=263, col_offset=28, end_lineno=263, end_col_offset=35), attr='fnmatch', ctx=Load(), lineno=263, col_offset=28, end_lineno=263, end_col_offset=43), args=[Subscript(value=Name(id='chunk', ctx=Load(), lineno=263, col_offset=44, end_lineno=263, end_col_offset=49), slice=Constant(value='uri', lineno=263, col_offset=50, end_lineno=263, end_col_offset=55), ctx=Load(), lineno=263, col_offset=44, end_lineno=263, end_col_offset=56), Name(id='pattern', ctx=Load(), lineno=263, col_offset=58, end_lineno=263, end_col_offset=65)], lineno=263, col_offset=28, end_lineno=263, end_col_offset=66), generators=[comprehension(target=Name(id='pattern', ctx=Store(), lineno=263, col_offset=71, end_lineno=263, end_col_offset=78), iter=Name(id='exclude_globs', ctx=Load(), lineno=263, col_offset=82, end_lineno=263, end_col_offset=95), is_async=0)], lineno=263, col_offset=27, end_lineno=263, end_col_offset=96)], lineno=263, col_offset=24, end_lineno=263, end_col_offset=96), lineno=263, col_offset=20, end_lineno=263, end_col_offset=96)], lineno=262, col_offset=19, end_lineno=263, end_col_offset=96)], is_async=0)], lineno=259, col_offset=23, end_lineno=264, end_col_offset=13), lineno=259, col_offset=12, end_lineno=264, end_col_offset=13)], lineno=258, col_offset=8, end_lineno=264, end_col_offset=13), Return(value=Name(id='filtered', ctx=Load(), lineno=266, col_offset=15, end_lineno=266, end_col_offset=23), lineno=266, col_offset=8, end_lineno=266, end_col_offset=23)], returns=Subscript(value=Name(id='list', ctx=Load(), lineno=207, col_offset=9, end_lineno=207, end_col_offset=13), slice=Subscript(value=Name(id='dict', ctx=Load(), lineno=207, col_offset=14, end_lineno=207, end_col_offset=18), slice=Tuple(elts=[Name(id='str', ctx=Load(), lineno=207, col_offset=19, end_lineno=207, end_col_offset=22), Name(id='Any', ctx=Load(), lineno=207, col_offset=24, end_lineno=207, end_col_offset=27)], ctx=Load(), lineno=207, col_offset=19, end_lineno=207, end_col_offset=27), ctx=Load(), lineno=207, col_offset=14, end_lineno=207, end_col_offset=28), ctx=Load(), lineno=207, col_offset=9, end_lineno=207, end_col_offset=29), lineno=200, col_offset=4, end_lineno=266, end_col_offset=23)], lineno=114, col_offset=0, end_lineno=266, end_col_offset=23), ClassDef(name='StubVLLMClient', body=[Expr(value=Constant(value='Stub vLLM client for testing.\n\n    Parameters\n    ----------\n    _config : Any\n        Configuration (unused in stub).\n    ', lineno=270, col_offset=4, end_lineno=276, end_col_offset=7), lineno=270, col_offset=4, end_lineno=276, end_col_offset=7), FunctionDef(name='__init__', args=arguments(args=[arg(arg='self', lineno=278, col_offset=17, end_lineno=278, end_col_offset=21), arg(arg='_config', annotation=Name(id='Any', ctx=Load(), lineno=278, col_offset=32, end_lineno=278, end_col_offset=35), lineno=278, col_offset=23, end_lineno=278, end_col_offset=35)]), body=[Pass(lineno=279, col_offset=8, end_lineno=279, end_col_offset=12)], returns=Constant(value=None, lineno=278, col_offset=40, end_lineno=278, end_col_offset=44), lineno=278, col_offset=4, end_lineno=279, end_col_offset=12), FunctionDef(name='embed_single', args=arguments(args=[arg(arg='self', lineno=281, col_offset=21, end_lineno=281, end_col_offset=25), arg(arg='query', annotation=Name(id='str', ctx=Load(), lineno=281, col_offset=34, end_lineno=281, end_col_offset=37), lineno=281, col_offset=27, end_lineno=281, end_col_offset=37)]), body=[Expr(value=Constant(value='Return mock embedding vector.\n\n        Parameters\n        ----------\n        query : str\n            Query text.\n\n        Returns\n        -------\n        np.ndarray\n            Mock embedding vector (2560 dimensions).\n        ', lineno=282, col_offset=8, end_lineno=293, end_col_offset=11), lineno=282, col_offset=8, end_lineno=293, end_col_offset=11), Assert(test=Name(id='query', ctx=Load(), lineno=294, col_offset=15, end_lineno=294, end_col_offset=20), lineno=294, col_offset=8, end_lineno=294, end_col_offset=20), Return(value=Call(func=Attribute(value=Name(id='np', ctx=Load(), lineno=295, col_offset=15, end_lineno=295, end_col_offset=17), attr='array', ctx=Load(), lineno=295, col_offset=15, end_lineno=295, end_col_offset=23), args=[BinOp(left=List(elts=[Constant(value=0.1, lineno=295, col_offset=25, end_lineno=295, end_col_offset=28)], ctx=Load(), lineno=295, col_offset=24, end_lineno=295, end_col_offset=29), op=Mult(), right=Constant(value=2560, lineno=295, col_offset=32, end_lineno=295, end_col_offset=36), lineno=295, col_offset=24, end_lineno=295, end_col_offset=36)], keywords=[keyword(arg='dtype', value=Attribute(value=Name(id='np', ctx=Load(), lineno=295, col_offset=44, end_lineno=295, end_col_offset=46), attr='float32', ctx=Load(), lineno=295, col_offset=44, end_lineno=295, end_col_offset=54), lineno=295, col_offset=38, end_lineno=295, end_col_offset=54)], lineno=295, col_offset=15, end_lineno=295, end_col_offset=55), lineno=295, col_offset=8, end_lineno=295, end_col_offset=55)], returns=Attribute(value=Name(id='np', ctx=Load(), lineno=281, col_offset=42, end_lineno=281, end_col_offset=44), attr='ndarray', ctx=Load(), lineno=281, col_offset=42, end_lineno=281, end_col_offset=52), lineno=281, col_offset=4, end_lineno=295, end_col_offset=55)], lineno=269, col_offset=0, end_lineno=295, end_col_offset=55), ClassDef(name='_BaseStubFAISSManager', body=[Expr(value=Constant(value='Base stub FAISS manager for testing.\n\n    Parameters\n    ----------\n    should_fail_gpu : bool\n        Whether GPU cloning should fail.\n    search_ids : list[int] | None, optional\n        List of chunk IDs to return from search. If None, returns [123].\n    ', lineno=299, col_offset=4, end_lineno=307, end_col_offset=7), lineno=299, col_offset=4, end_lineno=307, end_col_offset=7), FunctionDef(name='__init__', args=arguments(args=[arg(arg='self', lineno=309, col_offset=17, end_lineno=309, end_col_offset=21)], kwonlyargs=[arg(arg='should_fail_gpu', annotation=Name(id='bool', ctx=Load(), lineno=309, col_offset=43, end_lineno=309, end_col_offset=47), lineno=309, col_offset=26, end_lineno=309, end_col_offset=47), arg(arg='search_ids', annotation=BinOp(left=Subscript(value=Name(id='list', ctx=Load(), lineno=309, col_offset=61, end_lineno=309, end_col_offset=65), slice=Name(id='int', ctx=Load(), lineno=309, col_offset=66, end_lineno=309, end_col_offset=69), ctx=Load(), lineno=309, col_offset=61, end_lineno=309, end_col_offset=70), op=BitOr(), right=Constant(value=None, lineno=309, col_offset=73, end_lineno=309, end_col_offset=77), lineno=309, col_offset=61, end_lineno=309, end_col_offset=77), lineno=309, col_offset=49, end_lineno=309, end_col_offset=77)], kw_defaults=[None, Constant(value=None, lineno=309, col_offset=80, end_lineno=309, end_col_offset=84)]), body=[Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=310, col_offset=8, end_lineno=310, end_col_offset=12), attr='should_fail_gpu', ctx=Store(), lineno=310, col_offset=8, end_lineno=310, end_col_offset=28)], value=Name(id='should_fail_gpu', ctx=Load(), lineno=310, col_offset=31, end_lineno=310, end_col_offset=46), lineno=310, col_offset=8, end_lineno=310, end_col_offset=46), AnnAssign(target=Attribute(value=Name(id='self', ctx=Load(), lineno=311, col_offset=8, end_lineno=311, end_col_offset=12), attr='gpu_disabled_reason', ctx=Store(), lineno=311, col_offset=8, end_lineno=311, end_col_offset=32), annotation=BinOp(left=Name(id='str', ctx=Load(), lineno=311, col_offset=34, end_lineno=311, end_col_offset=37), op=BitOr(), right=Constant(value=None, lineno=311, col_offset=40, end_lineno=311, end_col_offset=44), lineno=311, col_offset=34, end_lineno=311, end_col_offset=44), value=Constant(value=None, lineno=311, col_offset=47, end_lineno=311, end_col_offset=51), simple=0, lineno=311, col_offset=8, end_lineno=311, end_col_offset=51), Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=312, col_offset=8, end_lineno=312, end_col_offset=12), attr='clone_invocations', ctx=Store(), lineno=312, col_offset=8, end_lineno=312, end_col_offset=30)], value=Constant(value=0, lineno=312, col_offset=33, end_lineno=312, end_col_offset=34), lineno=312, col_offset=8, end_lineno=312, end_col_offset=34), AnnAssign(target=Attribute(value=Name(id='self', ctx=Load(), lineno=313, col_offset=8, end_lineno=313, end_col_offset=12), attr='last_k', ctx=Store(), lineno=313, col_offset=8, end_lineno=313, end_col_offset=19), annotation=BinOp(left=Name(id='int', ctx=Load(), lineno=313, col_offset=21, end_lineno=313, end_col_offset=24), op=BitOr(), right=Constant(value=None, lineno=313, col_offset=27, end_lineno=313, end_col_offset=31), lineno=313, col_offset=21, end_lineno=313, end_col_offset=31), value=Constant(value=None, lineno=313, col_offset=34, end_lineno=313, end_col_offset=38), simple=0, lineno=313, col_offset=8, end_lineno=313, end_col_offset=38), AnnAssign(target=Attribute(value=Name(id='self', ctx=Load(), lineno=314, col_offset=8, end_lineno=314, end_col_offset=12), attr='last_nprobe', ctx=Store(), lineno=314, col_offset=8, end_lineno=314, end_col_offset=24), annotation=BinOp(left=Name(id='int', ctx=Load(), lineno=314, col_offset=26, end_lineno=314, end_col_offset=29), op=BitOr(), right=Constant(value=None, lineno=314, col_offset=32, end_lineno=314, end_col_offset=36), lineno=314, col_offset=26, end_lineno=314, end_col_offset=36), value=Constant(value=None, lineno=314, col_offset=39, end_lineno=314, end_col_offset=43), simple=0, lineno=314, col_offset=8, end_lineno=314, end_col_offset=43), Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=315, col_offset=8, end_lineno=315, end_col_offset=12), attr='_search_ids', ctx=Store(), lineno=315, col_offset=8, end_lineno=315, end_col_offset=24)], value=BoolOp(op=Or(), values=[Name(id='search_ids', ctx=Load(), lineno=315, col_offset=27, end_lineno=315, end_col_offset=37), List(elts=[Constant(value=123, lineno=315, col_offset=42, end_lineno=315, end_col_offset=45)], ctx=Load(), lineno=315, col_offset=41, end_lineno=315, end_col_offset=46)], lineno=315, col_offset=27, end_lineno=315, end_col_offset=46), lineno=315, col_offset=8, end_lineno=315, end_col_offset=46)], returns=Constant(value=None, lineno=309, col_offset=89, end_lineno=309, end_col_offset=93), lineno=309, col_offset=4, end_lineno=315, end_col_offset=46), FunctionDef(name='load_cpu_index', args=arguments(args=[arg(arg='self', lineno=317, col_offset=23, end_lineno=317, end_col_offset=27)]), body=[Expr(value=Constant(value='Load CPU index (no-op for testing).', lineno=318, col_offset=8, end_lineno=318, end_col_offset=49), lineno=318, col_offset=8, end_lineno=318, end_col_offset=49), Return(lineno=319, col_offset=8, end_lineno=319, end_col_offset=14)], returns=Constant(value=None, lineno=317, col_offset=32, end_lineno=317, end_col_offset=36), lineno=317, col_offset=4, end_lineno=319, end_col_offset=14), FunctionDef(name='clone_to_gpu', args=arguments(args=[arg(arg='self', lineno=321, col_offset=21, end_lineno=321, end_col_offset=25)]), body=[Expr(value=Constant(value='Clone to GPU (may fail based on should_fail_gpu).\n\n        Returns\n        -------\n        bool\n            True if GPU cloning succeeds, False otherwise.\n        ', lineno=322, col_offset=8, end_lineno=328, end_col_offset=11), lineno=322, col_offset=8, end_lineno=328, end_col_offset=11), AugAssign(target=Attribute(value=Name(id='self', ctx=Load(), lineno=329, col_offset=8, end_lineno=329, end_col_offset=12), attr='clone_invocations', ctx=Store(), lineno=329, col_offset=8, end_lineno=329, end_col_offset=30), op=Add(), value=Constant(value=1, lineno=329, col_offset=34, end_lineno=329, end_col_offset=35), lineno=329, col_offset=8, end_lineno=329, end_col_offset=35), If(test=Attribute(value=Name(id='self', ctx=Load(), lineno=330, col_offset=11, end_lineno=330, end_col_offset=15), attr='should_fail_gpu', ctx=Load(), lineno=330, col_offset=11, end_lineno=330, end_col_offset=31), body=[Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=331, col_offset=12, end_lineno=331, end_col_offset=16), attr='gpu_disabled_reason', ctx=Store(), lineno=331, col_offset=12, end_lineno=331, end_col_offset=36)], value=Constant(value='FAISS GPU disabled - using CPU: simulated failure', lineno=331, col_offset=39, end_lineno=331, end_col_offset=90), lineno=331, col_offset=12, end_lineno=331, end_col_offset=90), Return(value=Constant(value=False, lineno=332, col_offset=19, end_lineno=332, end_col_offset=24), lineno=332, col_offset=12, end_lineno=332, end_col_offset=24)], lineno=330, col_offset=8, end_lineno=332, end_col_offset=24), Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=333, col_offset=8, end_lineno=333, end_col_offset=12), attr='gpu_disabled_reason', ctx=Store(), lineno=333, col_offset=8, end_lineno=333, end_col_offset=32)], value=Constant(value=None, lineno=333, col_offset=35, end_lineno=333, end_col_offset=39), lineno=333, col_offset=8, end_lineno=333, end_col_offset=39), Return(value=Constant(value=True, lineno=334, col_offset=15, end_lineno=334, end_col_offset=19), lineno=334, col_offset=8, end_lineno=334, end_col_offset=19)], returns=Name(id='bool', ctx=Load(), lineno=321, col_offset=30, end_lineno=321, end_col_offset=34), lineno=321, col_offset=4, end_lineno=334, end_col_offset=19), FunctionDef(name='search', args=arguments(args=[arg(arg='self', lineno=337, col_offset=8, end_lineno=337, end_col_offset=12), arg(arg='query', annotation=Attribute(value=Name(id='np', ctx=Load(), lineno=337, col_offset=21, end_lineno=337, end_col_offset=23), attr='ndarray', ctx=Load(), lineno=337, col_offset=21, end_lineno=337, end_col_offset=31), lineno=337, col_offset=14, end_lineno=337, end_col_offset=31)], kwonlyargs=[arg(arg='k', annotation=Name(id='int', ctx=Load(), lineno=337, col_offset=39, end_lineno=337, end_col_offset=42), lineno=337, col_offset=36, end_lineno=337, end_col_offset=42), arg(arg='nprobe', annotation=Name(id='int', ctx=Load(), lineno=337, col_offset=52, end_lineno=337, end_col_offset=55), lineno=337, col_offset=44, end_lineno=337, end_col_offset=55)], kw_defaults=[None, Constant(value=128, lineno=337, col_offset=58, end_lineno=337, end_col_offset=61)]), body=[Expr(value=Constant(value='Return mock search results.\n\n        Parameters\n        ----------\n        query : np.ndarray\n            Query vector.\n        k : int\n            Number of results to return.\n        nprobe : int, optional\n            Number of probes. Defaults to 128.\n\n        Returns\n        -------\n        tuple[np.ndarray, np.ndarray]\n            Tuple of (distances, ids) arrays.\n        ', lineno=339, col_offset=8, end_lineno=354, end_col_offset=11), lineno=339, col_offset=8, end_lineno=354, end_col_offset=11), Assert(test=Compare(left=Subscript(value=Attribute(value=Name(id='query', ctx=Load(), lineno=355, col_offset=15, end_lineno=355, end_col_offset=20), attr='shape', ctx=Load(), lineno=355, col_offset=15, end_lineno=355, end_col_offset=26), slice=Constant(value=0, lineno=355, col_offset=27, end_lineno=355, end_col_offset=28), ctx=Load(), lineno=355, col_offset=15, end_lineno=355, end_col_offset=29), ops=[Eq()], comparators=[Constant(value=1, lineno=355, col_offset=33, end_lineno=355, end_col_offset=34)], lineno=355, col_offset=15, end_lineno=355, end_col_offset=34), lineno=355, col_offset=8, end_lineno=355, end_col_offset=34), Assert(test=Compare(left=Name(id='k', ctx=Load(), lineno=356, col_offset=15, end_lineno=356, end_col_offset=16), ops=[GtE()], comparators=[Constant(value=1, lineno=356, col_offset=20, end_lineno=356, end_col_offset=21)], lineno=356, col_offset=15, end_lineno=356, end_col_offset=21), lineno=356, col_offset=8, end_lineno=356, end_col_offset=21), Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=357, col_offset=8, end_lineno=357, end_col_offset=12), attr='last_k', ctx=Store(), lineno=357, col_offset=8, end_lineno=357, end_col_offset=19)], value=Name(id='k', ctx=Load(), lineno=357, col_offset=22, end_lineno=357, end_col_offset=23), lineno=357, col_offset=8, end_lineno=357, end_col_offset=23), Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=358, col_offset=8, end_lineno=358, end_col_offset=12), attr='last_nprobe', ctx=Store(), lineno=358, col_offset=8, end_lineno=358, end_col_offset=24)], value=Name(id='nprobe', ctx=Load(), lineno=358, col_offset=27, end_lineno=358, end_col_offset=33), lineno=358, col_offset=8, end_lineno=358, end_col_offset=33), Assert(test=Compare(left=Name(id='nprobe', ctx=Load(), lineno=359, col_offset=15, end_lineno=359, end_col_offset=21), ops=[GtE()], comparators=[Constant(value=1, lineno=359, col_offset=25, end_lineno=359, end_col_offset=26)], lineno=359, col_offset=15, end_lineno=359, end_col_offset=26), lineno=359, col_offset=8, end_lineno=359, end_col_offset=26), Assign(targets=[Name(id='result_ids', ctx=Store(), lineno=362, col_offset=8, end_lineno=362, end_col_offset=18)], value=Subscript(value=Attribute(value=Name(id='self', ctx=Load(), lineno=362, col_offset=21, end_lineno=362, end_col_offset=25), attr='_search_ids', ctx=Load(), lineno=362, col_offset=21, end_lineno=362, end_col_offset=37), slice=Slice(upper=Name(id='k', ctx=Load(), lineno=362, col_offset=39, end_lineno=362, end_col_offset=40), lineno=362, col_offset=38, end_lineno=362, end_col_offset=40), ctx=Load(), lineno=362, col_offset=21, end_lineno=362, end_col_offset=41), lineno=362, col_offset=8, end_lineno=362, end_col_offset=41), Assign(targets=[Name(id='ids', ctx=Store(), lineno=363, col_offset=8, end_lineno=363, end_col_offset=11)], value=Call(func=Attribute(value=Name(id='np', ctx=Load(), lineno=363, col_offset=14, end_lineno=363, end_col_offset=16), attr='array', ctx=Load(), lineno=363, col_offset=14, end_lineno=363, end_col_offset=22), args=[List(elts=[Name(id='result_ids', ctx=Load(), lineno=363, col_offset=24, end_lineno=363, end_col_offset=34)], ctx=Load(), lineno=363, col_offset=23, end_lineno=363, end_col_offset=35)], keywords=[keyword(arg='dtype', value=Attribute(value=Name(id='np', ctx=Load(), lineno=363, col_offset=43, end_lineno=363, end_col_offset=45), attr='int64', ctx=Load(), lineno=363, col_offset=43, end_lineno=363, end_col_offset=51), lineno=363, col_offset=37, end_lineno=363, end_col_offset=51)], lineno=363, col_offset=14, end_lineno=363, end_col_offset=52), lineno=363, col_offset=8, end_lineno=363, end_col_offset=52), Assign(targets=[Name(id='distances', ctx=Store(), lineno=364, col_offset=8, end_lineno=364, end_col_offset=17)], value=Call(func=Attribute(value=Name(id='np', ctx=Load(), lineno=364, col_offset=20, end_lineno=364, end_col_offset=22), attr='array', ctx=Load(), lineno=364, col_offset=20, end_lineno=364, end_col_offset=28), args=[List(elts=[BinOp(left=List(elts=[Constant(value=0.9, lineno=364, col_offset=31, end_lineno=364, end_col_offset=34)], ctx=Load(), lineno=364, col_offset=30, end_lineno=364, end_col_offset=35), op=Mult(), right=Call(func=Name(id='len', ctx=Load(), lineno=364, col_offset=38, end_lineno=364, end_col_offset=41), args=[Name(id='result_ids', ctx=Load(), lineno=364, col_offset=42, end_lineno=364, end_col_offset=52)], lineno=364, col_offset=38, end_lineno=364, end_col_offset=53), lineno=364, col_offset=30, end_lineno=364, end_col_offset=53)], ctx=Load(), lineno=364, col_offset=29, end_lineno=364, end_col_offset=54)], keywords=[keyword(arg='dtype', value=Attribute(value=Name(id='np', ctx=Load(), lineno=364, col_offset=62, end_lineno=364, end_col_offset=64), attr='float32', ctx=Load(), lineno=364, col_offset=62, end_lineno=364, end_col_offset=72), lineno=364, col_offset=56, end_lineno=364, end_col_offset=72)], lineno=364, col_offset=20, end_lineno=364, end_col_offset=73), lineno=364, col_offset=8, end_lineno=364, end_col_offset=73), Return(value=Tuple(elts=[Name(id='distances', ctx=Load(), lineno=365, col_offset=15, end_lineno=365, end_col_offset=24), Name(id='ids', ctx=Load(), lineno=365, col_offset=26, end_lineno=365, end_col_offset=29)], ctx=Load(), lineno=365, col_offset=15, end_lineno=365, end_col_offset=29), lineno=365, col_offset=8, end_lineno=365, end_col_offset=29)], returns=Subscript(value=Name(id='tuple', ctx=Load(), lineno=338, col_offset=9, end_lineno=338, end_col_offset=14), slice=Tuple(elts=[Attribute(value=Name(id='np', ctx=Load(), lineno=338, col_offset=15, end_lineno=338, end_col_offset=17), attr='ndarray', ctx=Load(), lineno=338, col_offset=15, end_lineno=338, end_col_offset=25), Attribute(value=Name(id='np', ctx=Load(), lineno=338, col_offset=27, end_lineno=338, end_col_offset=29), attr='ndarray', ctx=Load(), lineno=338, col_offset=27, end_lineno=338, end_col_offset=37)], ctx=Load(), lineno=338, col_offset=15, end_lineno=338, end_col_offset=37), ctx=Load(), lineno=338, col_offset=9, end_lineno=338, end_col_offset=38), lineno=336, col_offset=4, end_lineno=365, end_col_offset=29)], lineno=298, col_offset=0, end_lineno=365, end_col_offset=29), ClassDef(name='_DefaultStubHybridEngine', body=[Expr(value=Constant(value='Default hybrid engine stub that yields no additional channels.', lineno=369, col_offset=4, end_lineno=369, end_col_offset=72), lineno=369, col_offset=4, end_lineno=369, end_col_offset=72), FunctionDef(name='search', args=arguments(args=[arg(arg='self', lineno=372, col_offset=8, end_lineno=372, end_col_offset=12), arg(arg='query', annotation=Name(id='str', ctx=Load(), lineno=373, col_offset=15, end_lineno=373, end_col_offset=18), lineno=373, col_offset=8, end_lineno=373, end_col_offset=18)], kwonlyargs=[arg(arg='semantic_hits', annotation=Subscript(value=Name(id='Sequence', ctx=Load(), lineno=375, col_offset=23, end_lineno=375, end_col_offset=31), slice=Subscript(value=Name(id='tuple', ctx=Load(), lineno=375, col_offset=32, end_lineno=375, end_col_offset=37), slice=Tuple(elts=[Name(id='int', ctx=Load(), lineno=375, col_offset=38, end_lineno=375, end_col_offset=41), Name(id='float', ctx=Load(), lineno=375, col_offset=43, end_lineno=375, end_col_offset=48)], ctx=Load(), lineno=375, col_offset=38, end_lineno=375, end_col_offset=48), ctx=Load(), lineno=375, col_offset=32, end_lineno=375, end_col_offset=49), ctx=Load(), lineno=375, col_offset=23, end_lineno=375, end_col_offset=50), lineno=375, col_offset=8, end_lineno=375, end_col_offset=50), arg(arg='limit', annotation=Name(id='int', ctx=Load(), lineno=376, col_offset=15, end_lineno=376, end_col_offset=18), lineno=376, col_offset=8, end_lineno=376, end_col_offset=18)], kw_defaults=[None, None]), body=[Delete(targets=[Name(id='query', ctx=Del(), lineno=378, col_offset=12, end_lineno=378, end_col_offset=17), Name(id='semantic_hits', ctx=Del(), lineno=378, col_offset=19, end_lineno=378, end_col_offset=32), Name(id='limit', ctx=Del(), lineno=378, col_offset=34, end_lineno=378, end_col_offset=39)], lineno=378, col_offset=8, end_lineno=378, end_col_offset=39), Return(value=Call(func=Name(id='SimpleNamespace', ctx=Load(), lineno=379, col_offset=15, end_lineno=379, end_col_offset=30), keywords=[keyword(arg='docs', value=List(ctx=Load(), lineno=380, col_offset=17, end_lineno=380, end_col_offset=19), lineno=380, col_offset=12, end_lineno=380, end_col_offset=19), keyword(arg='contributions', value=Dict(lineno=381, col_offset=26, end_lineno=381, end_col_offset=28), lineno=381, col_offset=12, end_lineno=381, end_col_offset=28), keyword(arg='channels', value=List(ctx=Load(), lineno=382, col_offset=21, end_lineno=382, end_col_offset=23), lineno=382, col_offset=12, end_lineno=382, end_col_offset=23), keyword(arg='warnings', value=List(ctx=Load(), lineno=383, col_offset=21, end_lineno=383, end_col_offset=23), lineno=383, col_offset=12, end_lineno=383, end_col_offset=23)], lineno=379, col_offset=15, end_lineno=384, end_col_offset=9), lineno=379, col_offset=8, end_lineno=384, end_col_offset=9)], returns=Name(id='SimpleNamespace', ctx=Load(), lineno=377, col_offset=9, end_lineno=377, end_col_offset=24), lineno=371, col_offset=4, end_lineno=384, end_col_offset=9)], lineno=368, col_offset=0, end_lineno=384, end_col_offset=9), ClassDef(name='StubContextConfig', body=[Expr(value=Constant(value='Configuration for StubContext initialization.', lineno=389, col_offset=4, end_lineno=389, end_col_offset=55), lineno=389, col_offset=4, end_lineno=389, end_col_offset=55), AnnAssign(target=Name(id='limits', ctx=Store(), lineno=391, col_offset=4, end_lineno=391, end_col_offset=10), annotation=BinOp(left=Subscript(value=Name(id='list', ctx=Load(), lineno=391, col_offset=12, end_lineno=391, end_col_offset=16), slice=Name(id='str', ctx=Load(), lineno=391, col_offset=17, end_lineno=391, end_col_offset=20), ctx=Load(), lineno=391, col_offset=12, end_lineno=391, end_col_offset=21), op=BitOr(), right=Constant(value=None, lineno=391, col_offset=24, end_lineno=391, end_col_offset=28), lineno=391, col_offset=12, end_lineno=391, end_col_offset=28), value=Constant(value=None, lineno=391, col_offset=31, end_lineno=391, end_col_offset=35), simple=1, lineno=391, col_offset=4, end_lineno=391, end_col_offset=35), AnnAssign(target=Name(id='error', ctx=Store(), lineno=392, col_offset=4, end_lineno=392, end_col_offset=9), annotation=BinOp(left=Name(id='str', ctx=Load(), lineno=392, col_offset=11, end_lineno=392, end_col_offset=14), op=BitOr(), right=Constant(value=None, lineno=392, col_offset=17, end_lineno=392, end_col_offset=21), lineno=392, col_offset=11, end_lineno=392, end_col_offset=21), value=Constant(value=None, lineno=392, col_offset=24, end_lineno=392, end_col_offset=28), simple=1, lineno=392, col_offset=4, end_lineno=392, end_col_offset=28), AnnAssign(target=Name(id='max_results', ctx=Store(), lineno=393, col_offset=4, end_lineno=393, end_col_offset=15), annotation=Name(id='int', ctx=Load(), lineno=393, col_offset=17, end_lineno=393, end_col_offset=20), value=Constant(value=5, lineno=393, col_offset=23, end_lineno=393, end_col_offset=24), simple=1, lineno=393, col_offset=4, end_lineno=393, end_col_offset=24), AnnAssign(target=Name(id='semantic_overfetch_multiplier', ctx=Store(), lineno=394, col_offset=4, end_lineno=394, end_col_offset=33), annotation=Name(id='int', ctx=Load(), lineno=394, col_offset=35, end_lineno=394, end_col_offset=38), value=Constant(value=2, lineno=394, col_offset=41, end_lineno=394, end_col_offset=42), simple=1, lineno=394, col_offset=4, end_lineno=394, end_col_offset=42), AnnAssign(target=Name(id='catalog_chunks', ctx=Store(), lineno=395, col_offset=4, end_lineno=395, end_col_offset=18), annotation=BinOp(left=Subscript(value=Name(id='list', ctx=Load(), lineno=395, col_offset=20, end_lineno=395, end_col_offset=24), slice=Subscript(value=Name(id='dict', ctx=Load(), lineno=395, col_offset=25, end_lineno=395, end_col_offset=29), slice=Tuple(elts=[Name(id='str', ctx=Load(), lineno=395, col_offset=30, end_lineno=395, end_col_offset=33), Name(id='Any', ctx=Load(), lineno=395, col_offset=35, end_lineno=395, end_col_offset=38)], ctx=Load(), lineno=395, col_offset=30, end_lineno=395, end_col_offset=38), ctx=Load(), lineno=395, col_offset=25, end_lineno=395, end_col_offset=39), ctx=Load(), lineno=395, col_offset=20, end_lineno=395, end_col_offset=40), op=BitOr(), right=Constant(value=None, lineno=395, col_offset=43, end_lineno=395, end_col_offset=47), lineno=395, col_offset=20, end_lineno=395, end_col_offset=47), value=Constant(value=None, lineno=395, col_offset=50, end_lineno=395, end_col_offset=54), simple=1, lineno=395, col_offset=4, end_lineno=395, end_col_offset=54), AnnAssign(target=Name(id='faiss_nprobe', ctx=Store(), lineno=396, col_offset=4, end_lineno=396, end_col_offset=16), annotation=Name(id='int', ctx=Load(), lineno=396, col_offset=18, end_lineno=396, end_col_offset=21), value=Constant(value=128, lineno=396, col_offset=24, end_lineno=396, end_col_offset=27), simple=1, lineno=396, col_offset=4, end_lineno=396, end_col_offset=27), AnnAssign(target=Name(id='hybrid_engine', ctx=Store(), lineno=397, col_offset=4, end_lineno=397, end_col_offset=17), annotation=BinOp(left=Name(id='Any', ctx=Load(), lineno=397, col_offset=19, end_lineno=397, end_col_offset=22), op=BitOr(), right=Constant(value=None, lineno=397, col_offset=25, end_lineno=397, end_col_offset=29), lineno=397, col_offset=19, end_lineno=397, end_col_offset=29), value=Constant(value=None, lineno=397, col_offset=32, end_lineno=397, end_col_offset=36), simple=1, lineno=397, col_offset=4, end_lineno=397, end_col_offset=36), AnnAssign(target=Name(id='enable_bm25_channel', ctx=Store(), lineno=398, col_offset=4, end_lineno=398, end_col_offset=23), annotation=Name(id='bool', ctx=Load(), lineno=398, col_offset=25, end_lineno=398, end_col_offset=29), value=Constant(value=True, lineno=398, col_offset=32, end_lineno=398, end_col_offset=36), simple=1, lineno=398, col_offset=4, end_lineno=398, end_col_offset=36), AnnAssign(target=Name(id='enable_splade_channel', ctx=Store(), lineno=399, col_offset=4, end_lineno=399, end_col_offset=25), annotation=Name(id='bool', ctx=Load(), lineno=399, col_offset=27, end_lineno=399, end_col_offset=31), value=Constant(value=True, lineno=399, col_offset=34, end_lineno=399, end_col_offset=38), simple=1, lineno=399, col_offset=4, end_lineno=399, end_col_offset=38), AnnAssign(target=Name(id='hybrid_top_k_per_channel', ctx=Store(), lineno=400, col_offset=4, end_lineno=400, end_col_offset=28), annotation=Name(id='int', ctx=Load(), lineno=400, col_offset=30, end_lineno=400, end_col_offset=33), value=Constant(value=50, lineno=400, col_offset=36, end_lineno=400, end_col_offset=38), simple=1, lineno=400, col_offset=4, end_lineno=400, end_col_offset=38), AnnAssign(target=Name(id='rrf_k', ctx=Store(), lineno=401, col_offset=4, end_lineno=401, end_col_offset=9), annotation=Name(id='int', ctx=Load(), lineno=401, col_offset=11, end_lineno=401, end_col_offset=14), value=Constant(value=60, lineno=401, col_offset=17, end_lineno=401, end_col_offset=19), simple=1, lineno=401, col_offset=4, end_lineno=401, end_col_offset=19)], decorator_list=[Call(func=Name(id='dataclass', ctx=Load(), lineno=387, col_offset=1, end_lineno=387, end_col_offset=10), keywords=[keyword(arg='frozen', value=Constant(value=True, lineno=387, col_offset=18, end_lineno=387, end_col_offset=22), lineno=387, col_offset=11, end_lineno=387, end_col_offset=22)], lineno=387, col_offset=1, end_lineno=387, end_col_offset=23)], lineno=388, col_offset=0, end_lineno=401, end_col_offset=19), ClassDef(name='StubContext', body=[Expr(value=Constant(value='Stub ApplicationContext for semantic adapter tests.\n\n    Parameters\n    ----------\n    faiss_manager : _BaseStubFAISSManager\n        FAISS manager stub.\n    config : StubContextConfig | None, optional\n        Configuration for stub context. Defaults to None (uses defaults).\n    ', lineno=405, col_offset=4, end_lineno=413, end_col_offset=7), lineno=405, col_offset=4, end_lineno=413, end_col_offset=7), FunctionDef(name='__init__', args=arguments(args=[arg(arg='self', lineno=416, col_offset=8, end_lineno=416, end_col_offset=12)], kwonlyargs=[arg(arg='faiss_manager', annotation=Name(id='_BaseStubFAISSManager', ctx=Load(), lineno=418, col_offset=23, end_lineno=418, end_col_offset=44), lineno=418, col_offset=8, end_lineno=418, end_col_offset=44), arg(arg='config', annotation=BinOp(left=Name(id='StubContextConfig', ctx=Load(), lineno=419, col_offset=16, end_lineno=419, end_col_offset=33), op=BitOr(), right=Constant(value=None, lineno=419, col_offset=36, end_lineno=419, end_col_offset=40), lineno=419, col_offset=16, end_lineno=419, end_col_offset=40), lineno=419, col_offset=8, end_lineno=419, end_col_offset=40)], kw_defaults=[None, Constant(value=None, lineno=419, col_offset=43, end_lineno=419, end_col_offset=47)]), body=[If(test=Compare(left=Name(id='config', ctx=Load(), lineno=421, col_offset=11, end_lineno=421, end_col_offset=17), ops=[Is()], comparators=[Constant(value=None, lineno=421, col_offset=21, end_lineno=421, end_col_offset=25)], lineno=421, col_offset=11, end_lineno=421, end_col_offset=25), body=[Assign(targets=[Name(id='config', ctx=Store(), lineno=422, col_offset=12, end_lineno=422, end_col_offset=18)], value=Call(func=Name(id='StubContextConfig', ctx=Load(), lineno=422, col_offset=21, end_lineno=422, end_col_offset=38), lineno=422, col_offset=21, end_lineno=422, end_col_offset=40), lineno=422, col_offset=12, end_lineno=422, end_col_offset=40)], lineno=421, col_offset=8, end_lineno=422, end_col_offset=40), Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=423, col_offset=8, end_lineno=423, end_col_offset=12), attr='faiss_manager', ctx=Store(), lineno=423, col_offset=8, end_lineno=423, end_col_offset=26)], value=Name(id='faiss_manager', ctx=Load(), lineno=423, col_offset=29, end_lineno=423, end_col_offset=42), lineno=423, col_offset=8, end_lineno=423, end_col_offset=42), Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=424, col_offset=8, end_lineno=424, end_col_offset=12), attr='vllm_client', ctx=Store(), lineno=424, col_offset=8, end_lineno=424, end_col_offset=24)], value=Call(func=Name(id='StubVLLMClient', ctx=Load(), lineno=424, col_offset=27, end_lineno=424, end_col_offset=41), args=[Call(func=Name(id='SimpleNamespace', ctx=Load(), lineno=424, col_offset=42, end_lineno=424, end_col_offset=57), lineno=424, col_offset=42, end_lineno=424, end_col_offset=59)], lineno=424, col_offset=27, end_lineno=424, end_col_offset=60), lineno=424, col_offset=8, end_lineno=424, end_col_offset=60), Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=425, col_offset=8, end_lineno=425, end_col_offset=12), attr='settings', ctx=Store(), lineno=425, col_offset=8, end_lineno=425, end_col_offset=21)], value=Call(func=Name(id='SimpleNamespace', ctx=Load(), lineno=425, col_offset=24, end_lineno=425, end_col_offset=39), keywords=[keyword(arg='limits', value=Call(func=Name(id='SimpleNamespace', ctx=Load(), lineno=426, col_offset=19, end_lineno=426, end_col_offset=34), keywords=[keyword(arg='max_results', value=Attribute(value=Name(id='config', ctx=Load(), lineno=427, col_offset=28, end_lineno=427, end_col_offset=34), attr='max_results', ctx=Load(), lineno=427, col_offset=28, end_lineno=427, end_col_offset=46), lineno=427, col_offset=16, end_lineno=427, end_col_offset=46), keyword(arg='semantic_overfetch_multiplier', value=Attribute(value=Name(id='config', ctx=Load(), lineno=428, col_offset=46, end_lineno=428, end_col_offset=52), attr='semantic_overfetch_multiplier', ctx=Load(), lineno=428, col_offset=46, end_lineno=428, end_col_offset=82), lineno=428, col_offset=16, end_lineno=428, end_col_offset=82)], lineno=426, col_offset=19, end_lineno=429, end_col_offset=13), lineno=426, col_offset=12, end_lineno=429, end_col_offset=13), keyword(arg='vllm', value=Call(func=Name(id='SimpleNamespace', ctx=Load(), lineno=430, col_offset=17, end_lineno=430, end_col_offset=32), keywords=[keyword(arg='base_url', value=Constant(value='http://localhost', lineno=430, col_offset=42, end_lineno=430, end_col_offset=60), lineno=430, col_offset=33, end_lineno=430, end_col_offset=60)], lineno=430, col_offset=17, end_lineno=430, end_col_offset=61), lineno=430, col_offset=12, end_lineno=430, end_col_offset=61), keyword(arg='index', value=Call(func=Name(id='SimpleNamespace', ctx=Load(), lineno=431, col_offset=18, end_lineno=431, end_col_offset=33), keywords=[keyword(arg='faiss_nprobe', value=Attribute(value=Name(id='config', ctx=Load(), lineno=432, col_offset=29, end_lineno=432, end_col_offset=35), attr='faiss_nprobe', ctx=Load(), lineno=432, col_offset=29, end_lineno=432, end_col_offset=48), lineno=432, col_offset=16, end_lineno=432, end_col_offset=48), keyword(arg='enable_bm25_channel', value=Attribute(value=Name(id='config', ctx=Load(), lineno=433, col_offset=36, end_lineno=433, end_col_offset=42), attr='enable_bm25_channel', ctx=Load(), lineno=433, col_offset=36, end_lineno=433, end_col_offset=62), lineno=433, col_offset=16, end_lineno=433, end_col_offset=62), keyword(arg='enable_splade_channel', value=Attribute(value=Name(id='config', ctx=Load(), lineno=434, col_offset=38, end_lineno=434, end_col_offset=44), attr='enable_splade_channel', ctx=Load(), lineno=434, col_offset=38, end_lineno=434, end_col_offset=66), lineno=434, col_offset=16, end_lineno=434, end_col_offset=66), keyword(arg='hybrid_top_k_per_channel', value=Attribute(value=Name(id='config', ctx=Load(), lineno=435, col_offset=41, end_lineno=435, end_col_offset=47), attr='hybrid_top_k_per_channel', ctx=Load(), lineno=435, col_offset=41, end_lineno=435, end_col_offset=72), lineno=435, col_offset=16, end_lineno=435, end_col_offset=72), keyword(arg='rrf_k', value=Attribute(value=Name(id='config', ctx=Load(), lineno=436, col_offset=22, end_lineno=436, end_col_offset=28), attr='rrf_k', ctx=Load(), lineno=436, col_offset=22, end_lineno=436, end_col_offset=34), lineno=436, col_offset=16, end_lineno=436, end_col_offset=34)], lineno=431, col_offset=18, end_lineno=437, end_col_offset=13), lineno=431, col_offset=12, end_lineno=437, end_col_offset=13)], lineno=425, col_offset=24, end_lineno=438, end_col_offset=9), lineno=425, col_offset=8, end_lineno=438, end_col_offset=9), Import(names=[alias(name='tempfile', lineno=440, col_offset=15, end_lineno=440, end_col_offset=23)], lineno=440, col_offset=8, end_lineno=440, end_col_offset=23), Assign(targets=[Name(id='temp_dir', ctx=Store(), lineno=442, col_offset=8, end_lineno=442, end_col_offset=16)], value=Call(func=Name(id='Path', ctx=Load(), lineno=442, col_offset=19, end_lineno=442, end_col_offset=23), args=[Call(func=Attribute(value=Name(id='tempfile', ctx=Load(), lineno=442, col_offset=24, end_lineno=442, end_col_offset=32), attr='gettempdir', ctx=Load(), lineno=442, col_offset=24, end_lineno=442, end_col_offset=43), lineno=442, col_offset=24, end_lineno=442, end_col_offset=45)], lineno=442, col_offset=19, end_lineno=442, end_col_offset=46), lineno=442, col_offset=8, end_lineno=442, end_col_offset=46), Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=443, col_offset=8, end_lineno=443, end_col_offset=12), attr='paths', ctx=Store(), lineno=443, col_offset=8, end_lineno=443, end_col_offset=18)], value=Call(func=Name(id='SimpleNamespace', ctx=Load(), lineno=443, col_offset=21, end_lineno=443, end_col_offset=36), keywords=[keyword(arg='faiss_index', value=BinOp(left=Name(id='temp_dir', ctx=Load(), lineno=444, col_offset=24, end_lineno=444, end_col_offset=32), op=Div(), right=Constant(value='index.faiss', lineno=444, col_offset=35, end_lineno=444, end_col_offset=48), lineno=444, col_offset=24, end_lineno=444, end_col_offset=48), lineno=444, col_offset=12, end_lineno=444, end_col_offset=48), keyword(arg='duckdb_path', value=BinOp(left=Name(id='temp_dir', ctx=Load(), lineno=445, col_offset=24, end_lineno=445, end_col_offset=32), op=Div(), right=Constant(value='catalog.duckdb', lineno=445, col_offset=35, end_lineno=445, end_col_offset=51), lineno=445, col_offset=24, end_lineno=445, end_col_offset=51), lineno=445, col_offset=12, end_lineno=445, end_col_offset=51), keyword(arg='vectors_dir', value=BinOp(left=Name(id='temp_dir', ctx=Load(), lineno=446, col_offset=24, end_lineno=446, end_col_offset=32), op=Div(), right=Constant(value='vectors', lineno=446, col_offset=35, end_lineno=446, end_col_offset=44), lineno=446, col_offset=24, end_lineno=446, end_col_offset=44), lineno=446, col_offset=12, end_lineno=446, end_col_offset=44)], lineno=443, col_offset=21, end_lineno=447, end_col_offset=9), lineno=443, col_offset=8, end_lineno=447, end_col_offset=9), Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=448, col_offset=8, end_lineno=448, end_col_offset=12), attr='_limits', ctx=Store(), lineno=448, col_offset=8, end_lineno=448, end_col_offset=20)], value=BoolOp(op=Or(), values=[Attribute(value=Name(id='config', ctx=Load(), lineno=448, col_offset=23, end_lineno=448, end_col_offset=29), attr='limits', ctx=Load(), lineno=448, col_offset=23, end_lineno=448, end_col_offset=36), List(ctx=Load(), lineno=448, col_offset=40, end_lineno=448, end_col_offset=42)], lineno=448, col_offset=23, end_lineno=448, end_col_offset=42), lineno=448, col_offset=8, end_lineno=448, end_col_offset=42), Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=449, col_offset=8, end_lineno=449, end_col_offset=12), attr='_error', ctx=Store(), lineno=449, col_offset=8, end_lineno=449, end_col_offset=19)], value=Attribute(value=Name(id='config', ctx=Load(), lineno=449, col_offset=22, end_lineno=449, end_col_offset=28), attr='error', ctx=Load(), lineno=449, col_offset=22, end_lineno=449, end_col_offset=34), lineno=449, col_offset=8, end_lineno=449, end_col_offset=34), Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=450, col_offset=8, end_lineno=450, end_col_offset=12), attr='_catalog_chunks', ctx=Store(), lineno=450, col_offset=8, end_lineno=450, end_col_offset=28)], value=Attribute(value=Name(id='config', ctx=Load(), lineno=450, col_offset=31, end_lineno=450, end_col_offset=37), attr='catalog_chunks', ctx=Load(), lineno=450, col_offset=31, end_lineno=450, end_col_offset=52), lineno=450, col_offset=8, end_lineno=450, end_col_offset=52), Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=451, col_offset=8, end_lineno=451, end_col_offset=12), attr='_hybrid_engine', ctx=Store(), lineno=451, col_offset=8, end_lineno=451, end_col_offset=27)], value=BoolOp(op=Or(), values=[Attribute(value=Name(id='config', ctx=Load(), lineno=451, col_offset=30, end_lineno=451, end_col_offset=36), attr='hybrid_engine', ctx=Load(), lineno=451, col_offset=30, end_lineno=451, end_col_offset=50), Call(func=Name(id='_DefaultStubHybridEngine', ctx=Load(), lineno=451, col_offset=54, end_lineno=451, end_col_offset=78), lineno=451, col_offset=54, end_lineno=451, end_col_offset=80)], lineno=451, col_offset=30, end_lineno=451, end_col_offset=80), lineno=451, col_offset=8, end_lineno=451, end_col_offset=80)], returns=Constant(value=None, lineno=420, col_offset=9, end_lineno=420, end_col_offset=13), lineno=415, col_offset=4, end_lineno=451, end_col_offset=80), FunctionDef(name='ensure_faiss_ready', args=arguments(args=[arg(arg='self', lineno=453, col_offset=27, end_lineno=453, end_col_offset=31)]), body=[Expr(value=Constant(value='Return readiness tuple.\n\n        Returns\n        -------\n        tuple[bool, list[str], str | None]\n            Tuple of (ready, limits, error).\n        ', lineno=454, col_offset=8, end_lineno=460, end_col_offset=11), lineno=454, col_offset=8, end_lineno=460, end_col_offset=11), Assign(targets=[Name(id='ready', ctx=Store(), lineno=461, col_offset=8, end_lineno=461, end_col_offset=13)], value=Compare(left=Attribute(value=Name(id='self', ctx=Load(), lineno=461, col_offset=16, end_lineno=461, end_col_offset=20), attr='_error', ctx=Load(), lineno=461, col_offset=16, end_lineno=461, end_col_offset=27), ops=[Is()], comparators=[Constant(value=None, lineno=461, col_offset=31, end_lineno=461, end_col_offset=35)], lineno=461, col_offset=16, end_lineno=461, end_col_offset=35), lineno=461, col_offset=8, end_lineno=461, end_col_offset=35), Return(value=Tuple(elts=[Name(id='ready', ctx=Load(), lineno=462, col_offset=15, end_lineno=462, end_col_offset=20), Call(func=Name(id='list', ctx=Load(), lineno=462, col_offset=22, end_lineno=462, end_col_offset=26), args=[Attribute(value=Name(id='self', ctx=Load(), lineno=462, col_offset=27, end_lineno=462, end_col_offset=31), attr='_limits', ctx=Load(), lineno=462, col_offset=27, end_lineno=462, end_col_offset=39)], lineno=462, col_offset=22, end_lineno=462, end_col_offset=40), Attribute(value=Name(id='self', ctx=Load(), lineno=462, col_offset=42, end_lineno=462, end_col_offset=46), attr='_error', ctx=Load(), lineno=462, col_offset=42, end_lineno=462, end_col_offset=53)], ctx=Load(), lineno=462, col_offset=15, end_lineno=462, end_col_offset=53), lineno=462, col_offset=8, end_lineno=462, end_col_offset=53)], returns=Subscript(value=Name(id='tuple', ctx=Load(), lineno=453, col_offset=36, end_lineno=453, end_col_offset=41), slice=Tuple(elts=[Name(id='bool', ctx=Load(), lineno=453, col_offset=42, end_lineno=453, end_col_offset=46), Subscript(value=Name(id='list', ctx=Load(), lineno=453, col_offset=48, end_lineno=453, end_col_offset=52), slice=Name(id='str', ctx=Load(), lineno=453, col_offset=53, end_lineno=453, end_col_offset=56), ctx=Load(), lineno=453, col_offset=48, end_lineno=453, end_col_offset=57), BinOp(left=Name(id='str', ctx=Load(), lineno=453, col_offset=59, end_lineno=453, end_col_offset=62), op=BitOr(), right=Constant(value=None, lineno=453, col_offset=65, end_lineno=453, end_col_offset=69), lineno=453, col_offset=59, end_lineno=453, end_col_offset=69)], ctx=Load(), lineno=453, col_offset=42, end_lineno=453, end_col_offset=69), ctx=Load(), lineno=453, col_offset=36, end_lineno=453, end_col_offset=70), lineno=453, col_offset=4, end_lineno=462, end_col_offset=53), FunctionDef(name='open_catalog', args=arguments(args=[arg(arg='self', lineno=465, col_offset=21, end_lineno=465, end_col_offset=25)]), body=[Expr(value=Constant(value='Yield stub catalog.\n\n        Yields\n        ------\n        StubDuckDBCatalog\n            Stub catalog instance.\n        ', lineno=466, col_offset=8, end_lineno=472, end_col_offset=11), lineno=466, col_offset=8, end_lineno=472, end_col_offset=11), Expr(value=Yield(value=Call(func=Name(id='StubDuckDBCatalog', ctx=Load(), lineno=473, col_offset=14, end_lineno=473, end_col_offset=31), args=[Constant(value=None, lineno=473, col_offset=32, end_lineno=473, end_col_offset=36), Constant(value=None, lineno=473, col_offset=38, end_lineno=473, end_col_offset=42)], keywords=[keyword(arg='chunks', value=Attribute(value=Name(id='self', ctx=Load(), lineno=473, col_offset=51, end_lineno=473, end_col_offset=55), attr='_catalog_chunks', ctx=Load(), lineno=473, col_offset=51, end_lineno=473, end_col_offset=71), lineno=473, col_offset=44, end_lineno=473, end_col_offset=71)], lineno=473, col_offset=14, end_lineno=473, end_col_offset=72), lineno=473, col_offset=8, end_lineno=473, end_col_offset=72), lineno=473, col_offset=8, end_lineno=473, end_col_offset=72)], decorator_list=[Name(id='contextmanager', ctx=Load(), lineno=464, col_offset=5, end_lineno=464, end_col_offset=19)], returns=Subscript(value=Name(id='Iterator', ctx=Load(), lineno=465, col_offset=30, end_lineno=465, end_col_offset=38), slice=Name(id='StubDuckDBCatalog', ctx=Load(), lineno=465, col_offset=39, end_lineno=465, end_col_offset=56), ctx=Load(), lineno=465, col_offset=30, end_lineno=465, end_col_offset=57), lineno=465, col_offset=4, end_lineno=473, end_col_offset=72), FunctionDef(name='get_hybrid_engine', args=arguments(args=[arg(arg='self', lineno=475, col_offset=26, end_lineno=475, end_col_offset=30)]), body=[Expr(value=Constant(value='Return configured hybrid engine stub.\n\n        Returns\n        -------\n        Any\n            Hybrid engine stub instance.\n        ', lineno=476, col_offset=8, end_lineno=482, end_col_offset=11), lineno=476, col_offset=8, end_lineno=482, end_col_offset=11), Return(value=Attribute(value=Name(id='self', ctx=Load(), lineno=483, col_offset=15, end_lineno=483, end_col_offset=19), attr='_hybrid_engine', ctx=Load(), lineno=483, col_offset=15, end_lineno=483, end_col_offset=34), lineno=483, col_offset=8, end_lineno=483, end_col_offset=34)], returns=Name(id='Any', ctx=Load(), lineno=475, col_offset=35, end_lineno=475, end_col_offset=38), lineno=475, col_offset=4, end_lineno=483, end_col_offset=34)], lineno=404, col_offset=0, end_lineno=483, end_col_offset=34), AsyncFunctionDef(name='test_semantic_search_gpu_success', args=arguments(), body=[Assign(targets=[Name(id='context', ctx=Store(), lineno=488, col_offset=4, end_lineno=488, end_col_offset=11)], value=Call(func=Name(id='StubContext', ctx=Load(), lineno=488, col_offset=14, end_lineno=488, end_col_offset=25), keywords=[keyword(arg='faiss_manager', value=Call(func=Name(id='_BaseStubFAISSManager', ctx=Load(), lineno=489, col_offset=22, end_lineno=489, end_col_offset=43), keywords=[keyword(arg='should_fail_gpu', value=Constant(value=False, lineno=489, col_offset=60, end_lineno=489, end_col_offset=65), lineno=489, col_offset=44, end_lineno=489, end_col_offset=65)], lineno=489, col_offset=22, end_lineno=489, end_col_offset=66), lineno=489, col_offset=8, end_lineno=489, end_col_offset=66), keyword(arg='config', value=Call(func=Name(id='StubContextConfig', ctx=Load(), lineno=490, col_offset=15, end_lineno=490, end_col_offset=32), keywords=[keyword(arg='limits', value=List(ctx=Load(), lineno=490, col_offset=40, end_lineno=490, end_col_offset=42), lineno=490, col_offset=33, end_lineno=490, end_col_offset=42), keyword(arg='error', value=Constant(value=None, lineno=490, col_offset=50, end_lineno=490, end_col_offset=54), lineno=490, col_offset=44, end_lineno=490, end_col_offset=54)], lineno=490, col_offset=15, end_lineno=490, end_col_offset=55), lineno=490, col_offset=8, end_lineno=490, end_col_offset=55)], lineno=488, col_offset=14, end_lineno=491, end_col_offset=5), lineno=488, col_offset=4, end_lineno=491, end_col_offset=5), With(items=[withitem(context_expr=Call(func=Name(id='patch', ctx=Load(), lineno=495, col_offset=8, end_lineno=495, end_col_offset=13), args=[Constant(value='codeintel_rev.mcp_server.adapters.semantic.get_session_id', lineno=496, col_offset=12, end_lineno=496, end_col_offset=71)], keywords=[keyword(arg='return_value', value=Constant(value='test-session-123', lineno=497, col_offset=25, end_lineno=497, end_col_offset=43), lineno=497, col_offset=12, end_lineno=497, end_col_offset=43)], lineno=495, col_offset=8, end_lineno=498, end_col_offset=9)), withitem(context_expr=Call(func=Name(id='patch', ctx=Load(), lineno=499, col_offset=8, end_lineno=499, end_col_offset=13), args=[Constant(value='codeintel_rev.mcp_server.adapters.semantic.get_effective_scope', lineno=500, col_offset=12, end_lineno=500, end_col_offset=76)], keywords=[keyword(arg='return_value', value=Constant(value=None, lineno=501, col_offset=25, end_lineno=501, end_col_offset=29), lineno=501, col_offset=12, end_lineno=501, end_col_offset=29)], lineno=499, col_offset=8, end_lineno=502, end_col_offset=9))], body=[Assign(targets=[Name(id='result', ctx=Store(), lineno=506, col_offset=8, end_lineno=506, end_col_offset=14)], value=Await(value=Call(func=Name(id='semantic_search', ctx=Load(), lineno=506, col_offset=23, end_lineno=506, end_col_offset=38), args=[Call(func=Name(id='cast', ctx=Load(), lineno=506, col_offset=39, end_lineno=506, end_col_offset=43), args=[Constant(value='ApplicationContext', lineno=506, col_offset=44, end_lineno=506, end_col_offset=64), Name(id='context', ctx=Load(), lineno=506, col_offset=66, end_lineno=506, end_col_offset=73)], lineno=506, col_offset=39, end_lineno=506, end_col_offset=74), Constant(value='hello', lineno=506, col_offset=76, end_lineno=506, end_col_offset=83)], keywords=[keyword(arg='limit', value=Constant(value=1, lineno=506, col_offset=91, end_lineno=506, end_col_offset=92), lineno=506, col_offset=85, end_lineno=506, end_col_offset=92)], lineno=506, col_offset=23, end_lineno=506, end_col_offset=93), lineno=506, col_offset=17, end_lineno=506, end_col_offset=93), lineno=506, col_offset=8, end_lineno=506, end_col_offset=93)], lineno=494, col_offset=4, end_lineno=506, end_col_offset=93), Assert(test=Compare(left=Constant(value='limits', lineno=508, col_offset=11, end_lineno=508, end_col_offset=19), ops=[NotIn()], comparators=[Name(id='result', ctx=Load(), lineno=508, col_offset=27, end_lineno=508, end_col_offset=33)], lineno=508, col_offset=11, end_lineno=508, end_col_offset=33), lineno=508, col_offset=4, end_lineno=508, end_col_offset=33), Assign(targets=[Name(id='findings', ctx=Store(), lineno=509, col_offset=4, end_lineno=509, end_col_offset=12)], value=Call(func=Attribute(value=Name(id='result', ctx=Load(), lineno=509, col_offset=15, end_lineno=509, end_col_offset=21), attr='get', ctx=Load(), lineno=509, col_offset=15, end_lineno=509, end_col_offset=25), args=[Constant(value='findings', lineno=509, col_offset=26, end_lineno=509, end_col_offset=36)], lineno=509, col_offset=15, end_lineno=509, end_col_offset=37), lineno=509, col_offset=4, end_lineno=509, end_col_offset=37), Assert(test=Compare(left=Name(id='findings', ctx=Load(), lineno=510, col_offset=11, end_lineno=510, end_col_offset=19), ops=[IsNot()], comparators=[Constant(value=None, lineno=510, col_offset=27, end_lineno=510, end_col_offset=31)], lineno=510, col_offset=11, end_lineno=510, end_col_offset=31), lineno=510, col_offset=4, end_lineno=510, end_col_offset=31), Assert(test=Compare(left=Call(func=Name(id='len', ctx=Load(), lineno=511, col_offset=11, end_lineno=511, end_col_offset=14), args=[Name(id='findings', ctx=Load(), lineno=511, col_offset=15, end_lineno=511, end_col_offset=23)], lineno=511, col_offset=11, end_lineno=511, end_col_offset=24), ops=[Gt()], comparators=[Constant(value=0, lineno=511, col_offset=27, end_lineno=511, end_col_offset=28)], lineno=511, col_offset=11, end_lineno=511, end_col_offset=28), lineno=511, col_offset=4, end_lineno=511, end_col_offset=28), Assign(targets=[Name(id='location', ctx=Store(), lineno=512, col_offset=4, end_lineno=512, end_col_offset=12)], value=Call(func=Attribute(value=Subscript(value=Name(id='findings', ctx=Load(), lineno=512, col_offset=15, end_lineno=512, end_col_offset=23), slice=Constant(value=0, lineno=512, col_offset=24, end_lineno=512, end_col_offset=25), ctx=Load(), lineno=512, col_offset=15, end_lineno=512, end_col_offset=26), attr='get', ctx=Load(), lineno=512, col_offset=15, end_lineno=512, end_col_offset=30), args=[Constant(value='location', lineno=512, col_offset=31, end_lineno=512, end_col_offset=41)], lineno=512, col_offset=15, end_lineno=512, end_col_offset=42), lineno=512, col_offset=4, end_lineno=512, end_col_offset=42), Assert(test=Compare(left=Name(id='location', ctx=Load(), lineno=513, col_offset=11, end_lineno=513, end_col_offset=19), ops=[IsNot()], comparators=[Constant(value=None, lineno=513, col_offset=27, end_lineno=513, end_col_offset=31)], lineno=513, col_offset=11, end_lineno=513, end_col_offset=31), lineno=513, col_offset=4, end_lineno=513, end_col_offset=31), Assert(test=Compare(left=Call(func=Attribute(value=Name(id='location', ctx=Load(), lineno=514, col_offset=11, end_lineno=514, end_col_offset=19), attr='get', ctx=Load(), lineno=514, col_offset=11, end_lineno=514, end_col_offset=23), args=[Constant(value='uri', lineno=514, col_offset=24, end_lineno=514, end_col_offset=29)], lineno=514, col_offset=11, end_lineno=514, end_col_offset=30), ops=[Eq()], comparators=[Constant(value='src/module.py', lineno=514, col_offset=34, end_lineno=514, end_col_offset=49)], lineno=514, col_offset=11, end_lineno=514, end_col_offset=49), lineno=514, col_offset=4, end_lineno=514, end_col_offset=49)], decorator_list=[Attribute(value=Attribute(value=Name(id='pytest', ctx=Load(), lineno=486, col_offset=1, end_lineno=486, end_col_offset=7), attr='mark', ctx=Load(), lineno=486, col_offset=1, end_lineno=486, end_col_offset=12), attr='asyncio', ctx=Load(), lineno=486, col_offset=1, end_lineno=486, end_col_offset=20)], returns=Constant(value=None, lineno=487, col_offset=48, end_lineno=487, end_col_offset=52), lineno=487, col_offset=0, end_lineno=514, end_col_offset=49), AsyncFunctionDef(name='test_semantic_search_gpu_fallback', args=arguments(), body=[Assign(targets=[Name(id='context', ctx=Store(), lineno=519, col_offset=4, end_lineno=519, end_col_offset=11)], value=Call(func=Name(id='StubContext', ctx=Load(), lineno=519, col_offset=14, end_lineno=519, end_col_offset=25), keywords=[keyword(arg='faiss_manager', value=Call(func=Name(id='_BaseStubFAISSManager', ctx=Load(), lineno=520, col_offset=22, end_lineno=520, end_col_offset=43), keywords=[keyword(arg='should_fail_gpu', value=Constant(value=True, lineno=520, col_offset=60, end_lineno=520, end_col_offset=64), lineno=520, col_offset=44, end_lineno=520, end_col_offset=64)], lineno=520, col_offset=22, end_lineno=520, end_col_offset=65), lineno=520, col_offset=8, end_lineno=520, end_col_offset=65), keyword(arg='config', value=Call(func=Name(id='StubContextConfig', ctx=Load(), lineno=521, col_offset=15, end_lineno=521, end_col_offset=32), keywords=[keyword(arg='limits', value=List(elts=[Constant(value='FAISS GPU disabled - using CPU: simulated failure', lineno=522, col_offset=20, end_lineno=522, end_col_offset=71)], ctx=Load(), lineno=522, col_offset=19, end_lineno=522, end_col_offset=72), lineno=522, col_offset=12, end_lineno=522, end_col_offset=72), keyword(arg='error', value=Constant(value=None, lineno=522, col_offset=80, end_lineno=522, end_col_offset=84), lineno=522, col_offset=74, end_lineno=522, end_col_offset=84)], lineno=521, col_offset=15, end_lineno=523, end_col_offset=9), lineno=521, col_offset=8, end_lineno=523, end_col_offset=9)], lineno=519, col_offset=14, end_lineno=524, end_col_offset=5), lineno=519, col_offset=4, end_lineno=524, end_col_offset=5), With(items=[withitem(context_expr=Call(func=Name(id='patch', ctx=Load(), lineno=528, col_offset=8, end_lineno=528, end_col_offset=13), args=[Constant(value='codeintel_rev.mcp_server.adapters.semantic.get_session_id', lineno=529, col_offset=12, end_lineno=529, end_col_offset=71)], keywords=[keyword(arg='return_value', value=Constant(value='test-session-123', lineno=530, col_offset=25, end_lineno=530, end_col_offset=43), lineno=530, col_offset=12, end_lineno=530, end_col_offset=43)], lineno=528, col_offset=8, end_lineno=531, end_col_offset=9)), withitem(context_expr=Call(func=Name(id='patch', ctx=Load(), lineno=532, col_offset=8, end_lineno=532, end_col_offset=13), args=[Constant(value='codeintel_rev.mcp_server.adapters.semantic.get_effective_scope', lineno=533, col_offset=12, end_lineno=533, end_col_offset=76)], keywords=[keyword(arg='return_value', value=Constant(value=None, lineno=534, col_offset=25, end_lineno=534, end_col_offset=29), lineno=534, col_offset=12, end_lineno=534, end_col_offset=29)], lineno=532, col_offset=8, end_lineno=535, end_col_offset=9))], body=[Assign(targets=[Name(id='result', ctx=Store(), lineno=537, col_offset=8, end_lineno=537, end_col_offset=14)], value=Await(value=Call(func=Name(id='semantic_search', ctx=Load(), lineno=537, col_offset=23, end_lineno=537, end_col_offset=38), args=[Call(func=Name(id='cast', ctx=Load(), lineno=537, col_offset=39, end_lineno=537, end_col_offset=43), args=[Constant(value='ApplicationContext', lineno=537, col_offset=44, end_lineno=537, end_col_offset=64), Name(id='context', ctx=Load(), lineno=537, col_offset=66, end_lineno=537, end_col_offset=73)], lineno=537, col_offset=39, end_lineno=537, end_col_offset=74), Constant(value='hello', lineno=537, col_offset=76, end_lineno=537, end_col_offset=83)], keywords=[keyword(arg='limit', value=Constant(value=1, lineno=537, col_offset=91, end_lineno=537, end_col_offset=92), lineno=537, col_offset=85, end_lineno=537, end_col_offset=92)], lineno=537, col_offset=23, end_lineno=537, end_col_offset=93), lineno=537, col_offset=17, end_lineno=537, end_col_offset=93), lineno=537, col_offset=8, end_lineno=537, end_col_offset=93)], lineno=527, col_offset=4, end_lineno=537, end_col_offset=93), Assign(targets=[Name(id='limits', ctx=Store(), lineno=539, col_offset=4, end_lineno=539, end_col_offset=10)], value=Call(func=Attribute(value=Name(id='result', ctx=Load(), lineno=539, col_offset=13, end_lineno=539, end_col_offset=19), attr='get', ctx=Load(), lineno=539, col_offset=13, end_lineno=539, end_col_offset=23), args=[Constant(value='limits', lineno=539, col_offset=24, end_lineno=539, end_col_offset=32)], lineno=539, col_offset=13, end_lineno=539, end_col_offset=33), lineno=539, col_offset=4, end_lineno=539, end_col_offset=33), Assert(test=Compare(left=Name(id='limits', ctx=Load(), lineno=540, col_offset=11, end_lineno=540, end_col_offset=17), ops=[Eq()], comparators=[List(elts=[Constant(value='FAISS GPU disabled - using CPU: simulated failure', lineno=540, col_offset=22, end_lineno=540, end_col_offset=73)], ctx=Load(), lineno=540, col_offset=21, end_lineno=540, end_col_offset=74)], lineno=540, col_offset=11, end_lineno=540, end_col_offset=74), lineno=540, col_offset=4, end_lineno=540, end_col_offset=74), Assign(targets=[Name(id='findings', ctx=Store(), lineno=541, col_offset=4, end_lineno=541, end_col_offset=12)], value=Call(func=Attribute(value=Name(id='result', ctx=Load(), lineno=541, col_offset=15, end_lineno=541, end_col_offset=21), attr='get', ctx=Load(), lineno=541, col_offset=15, end_lineno=541, end_col_offset=25), args=[Constant(value='findings', lineno=541, col_offset=26, end_lineno=541, end_col_offset=36)], lineno=541, col_offset=15, end_lineno=541, end_col_offset=37), lineno=541, col_offset=4, end_lineno=541, end_col_offset=37), Assert(test=Compare(left=Name(id='findings', ctx=Load(), lineno=542, col_offset=11, end_lineno=542, end_col_offset=19), ops=[IsNot()], comparators=[Constant(value=None, lineno=542, col_offset=27, end_lineno=542, end_col_offset=31)], lineno=542, col_offset=11, end_lineno=542, end_col_offset=31), lineno=542, col_offset=4, end_lineno=542, end_col_offset=31), Assert(test=Compare(left=Call(func=Name(id='len', ctx=Load(), lineno=543, col_offset=11, end_lineno=543, end_col_offset=14), args=[Name(id='findings', ctx=Load(), lineno=543, col_offset=15, end_lineno=543, end_col_offset=23)], lineno=543, col_offset=11, end_lineno=543, end_col_offset=24), ops=[Gt()], comparators=[Constant(value=0, lineno=543, col_offset=27, end_lineno=543, end_col_offset=28)], lineno=543, col_offset=11, end_lineno=543, end_col_offset=28), lineno=543, col_offset=4, end_lineno=543, end_col_offset=28), Assign(targets=[Name(id='location', ctx=Store(), lineno=544, col_offset=4, end_lineno=544, end_col_offset=12)], value=Call(func=Attribute(value=Subscript(value=Name(id='findings', ctx=Load(), lineno=544, col_offset=15, end_lineno=544, end_col_offset=23), slice=Constant(value=0, lineno=544, col_offset=24, end_lineno=544, end_col_offset=25), ctx=Load(), lineno=544, col_offset=15, end_lineno=544, end_col_offset=26), attr='get', ctx=Load(), lineno=544, col_offset=15, end_lineno=544, end_col_offset=30), args=[Constant(value='location', lineno=544, col_offset=31, end_lineno=544, end_col_offset=41)], lineno=544, col_offset=15, end_lineno=544, end_col_offset=42), lineno=544, col_offset=4, end_lineno=544, end_col_offset=42), Assert(test=Compare(left=Name(id='location', ctx=Load(), lineno=545, col_offset=11, end_lineno=545, end_col_offset=19), ops=[IsNot()], comparators=[Constant(value=None, lineno=545, col_offset=27, end_lineno=545, end_col_offset=31)], lineno=545, col_offset=11, end_lineno=545, end_col_offset=31), lineno=545, col_offset=4, end_lineno=545, end_col_offset=31), Assert(test=Compare(left=Call(func=Attribute(value=Name(id='location', ctx=Load(), lineno=546, col_offset=11, end_lineno=546, end_col_offset=19), attr='get', ctx=Load(), lineno=546, col_offset=11, end_lineno=546, end_col_offset=23), args=[Constant(value='uri', lineno=546, col_offset=24, end_lineno=546, end_col_offset=29)], lineno=546, col_offset=11, end_lineno=546, end_col_offset=30), ops=[Eq()], comparators=[Constant(value='src/module.py', lineno=546, col_offset=34, end_lineno=546, end_col_offset=49)], lineno=546, col_offset=11, end_lineno=546, end_col_offset=49), lineno=546, col_offset=4, end_lineno=546, end_col_offset=49)], decorator_list=[Attribute(value=Attribute(value=Name(id='pytest', ctx=Load(), lineno=517, col_offset=1, end_lineno=517, end_col_offset=7), attr='mark', ctx=Load(), lineno=517, col_offset=1, end_lineno=517, end_col_offset=12), attr='asyncio', ctx=Load(), lineno=517, col_offset=1, end_lineno=517, end_col_offset=20)], returns=Constant(value=None, lineno=518, col_offset=49, end_lineno=518, end_col_offset=53), lineno=518, col_offset=0, end_lineno=546, end_col_offset=49), AsyncFunctionDef(name='test_semantic_search_limit_truncates_to_max_results', args=arguments(), body=[Assign(targets=[Name(id='faiss_manager', ctx=Store(), lineno=551, col_offset=4, end_lineno=551, end_col_offset=17)], value=Call(func=Name(id='_BaseStubFAISSManager', ctx=Load(), lineno=551, col_offset=20, end_lineno=551, end_col_offset=41), keywords=[keyword(arg='should_fail_gpu', value=Constant(value=False, lineno=551, col_offset=58, end_lineno=551, end_col_offset=63), lineno=551, col_offset=42, end_lineno=551, end_col_offset=63)], lineno=551, col_offset=20, end_lineno=551, end_col_offset=64), lineno=551, col_offset=4, end_lineno=551, end_col_offset=64), Assign(targets=[Name(id='context', ctx=Store(), lineno=552, col_offset=4, end_lineno=552, end_col_offset=11)], value=Call(func=Name(id='StubContext', ctx=Load(), lineno=552, col_offset=14, end_lineno=552, end_col_offset=25), keywords=[keyword(arg='faiss_manager', value=Name(id='faiss_manager', ctx=Load(), lineno=553, col_offset=22, end_lineno=553, end_col_offset=35), lineno=553, col_offset=8, end_lineno=553, end_col_offset=35), keyword(arg='config', value=Call(func=Name(id='StubContextConfig', ctx=Load(), lineno=554, col_offset=15, end_lineno=554, end_col_offset=32), keywords=[keyword(arg='limits', value=List(ctx=Load(), lineno=554, col_offset=40, end_lineno=554, end_col_offset=42), lineno=554, col_offset=33, end_lineno=554, end_col_offset=42), keyword(arg='error', value=Constant(value=None, lineno=554, col_offset=50, end_lineno=554, end_col_offset=54), lineno=554, col_offset=44, end_lineno=554, end_col_offset=54), keyword(arg='max_results', value=Constant(value=3, lineno=554, col_offset=68, end_lineno=554, end_col_offset=69), lineno=554, col_offset=56, end_lineno=554, end_col_offset=69)], lineno=554, col_offset=15, end_lineno=554, end_col_offset=70), lineno=554, col_offset=8, end_lineno=554, end_col_offset=70)], lineno=552, col_offset=14, end_lineno=555, end_col_offset=5), lineno=552, col_offset=4, end_lineno=555, end_col_offset=5), With(items=[withitem(context_expr=Call(func=Name(id='patch', ctx=Load(), lineno=559, col_offset=8, end_lineno=559, end_col_offset=13), args=[Constant(value='codeintel_rev.mcp_server.adapters.semantic.get_session_id', lineno=560, col_offset=12, end_lineno=560, end_col_offset=71)], keywords=[keyword(arg='return_value', value=Constant(value='test-session-123', lineno=561, col_offset=25, end_lineno=561, end_col_offset=43), lineno=561, col_offset=12, end_lineno=561, end_col_offset=43)], lineno=559, col_offset=8, end_lineno=562, end_col_offset=9)), withitem(context_expr=Call(func=Name(id='patch', ctx=Load(), lineno=563, col_offset=8, end_lineno=563, end_col_offset=13), args=[Constant(value='codeintel_rev.mcp_server.adapters.semantic.get_effective_scope', lineno=564, col_offset=12, end_lineno=564, end_col_offset=76)], keywords=[keyword(arg='return_value', value=Constant(value=None, lineno=565, col_offset=25, end_lineno=565, end_col_offset=29), lineno=565, col_offset=12, end_lineno=565, end_col_offset=29)], lineno=563, col_offset=8, end_lineno=566, end_col_offset=9))], body=[Assign(targets=[Name(id='result', ctx=Store(), lineno=568, col_offset=8, end_lineno=568, end_col_offset=14)], value=Await(value=Call(func=Name(id='semantic_search', ctx=Load(), lineno=568, col_offset=23, end_lineno=568, end_col_offset=38), args=[Call(func=Name(id='cast', ctx=Load(), lineno=568, col_offset=39, end_lineno=568, end_col_offset=43), args=[Constant(value='ApplicationContext', lineno=568, col_offset=44, end_lineno=568, end_col_offset=64), Name(id='context', ctx=Load(), lineno=568, col_offset=66, end_lineno=568, end_col_offset=73)], lineno=568, col_offset=39, end_lineno=568, end_col_offset=74), Constant(value='hello', lineno=568, col_offset=76, end_lineno=568, end_col_offset=83)], keywords=[keyword(arg='limit', value=Constant(value=10, lineno=568, col_offset=91, end_lineno=568, end_col_offset=93), lineno=568, col_offset=85, end_lineno=568, end_col_offset=93)], lineno=568, col_offset=23, end_lineno=568, end_col_offset=94), lineno=568, col_offset=17, end_lineno=568, end_col_offset=94), lineno=568, col_offset=8, end_lineno=568, end_col_offset=94)], lineno=558, col_offset=4, end_lineno=568, end_col_offset=94), Assert(test=Compare(left=Attribute(value=Name(id='faiss_manager', ctx=Load(), lineno=570, col_offset=11, end_lineno=570, end_col_offset=24), attr='last_k', ctx=Load(), lineno=570, col_offset=11, end_lineno=570, end_col_offset=31), ops=[Eq()], comparators=[Constant(value=3, lineno=570, col_offset=35, end_lineno=570, end_col_offset=36)], lineno=570, col_offset=11, end_lineno=570, end_col_offset=36), lineno=570, col_offset=4, end_lineno=570, end_col_offset=36), Assign(targets=[Name(id='limits', ctx=Store(), lineno=571, col_offset=4, end_lineno=571, end_col_offset=10)], value=Call(func=Attribute(value=Name(id='result', ctx=Load(), lineno=571, col_offset=13, end_lineno=571, end_col_offset=19), attr='get', ctx=Load(), lineno=571, col_offset=13, end_lineno=571, end_col_offset=23), args=[Constant(value='limits', lineno=571, col_offset=24, end_lineno=571, end_col_offset=32)], lineno=571, col_offset=13, end_lineno=571, end_col_offset=33), lineno=571, col_offset=4, end_lineno=571, end_col_offset=33), Assert(test=Compare(left=Name(id='limits', ctx=Load(), lineno=572, col_offset=11, end_lineno=572, end_col_offset=17), ops=[IsNot()], comparators=[Constant(value=None, lineno=572, col_offset=25, end_lineno=572, end_col_offset=29)], lineno=572, col_offset=11, end_lineno=572, end_col_offset=29), lineno=572, col_offset=4, end_lineno=572, end_col_offset=29), Assert(test=Call(func=Name(id='any', ctx=Load(), lineno=573, col_offset=11, end_lineno=573, end_col_offset=14), args=[GeneratorExp(elt=Compare(left=Constant(value='exceeds max_results', lineno=573, col_offset=15, end_lineno=573, end_col_offset=36), ops=[In()], comparators=[Name(id='message', ctx=Load(), lineno=573, col_offset=40, end_lineno=573, end_col_offset=47)], lineno=573, col_offset=15, end_lineno=573, end_col_offset=47), generators=[comprehension(target=Name(id='message', ctx=Store(), lineno=573, col_offset=52, end_lineno=573, end_col_offset=59), iter=Name(id='limits', ctx=Load(), lineno=573, col_offset=63, end_lineno=573, end_col_offset=69), is_async=0)], lineno=573, col_offset=14, end_lineno=573, end_col_offset=70)], lineno=573, col_offset=11, end_lineno=573, end_col_offset=70), lineno=573, col_offset=4, end_lineno=573, end_col_offset=70), Assign(targets=[Name(id='method', ctx=Store(), lineno=574, col_offset=4, end_lineno=574, end_col_offset=10)], value=Call(func=Attribute(value=Name(id='result', ctx=Load(), lineno=574, col_offset=13, end_lineno=574, end_col_offset=19), attr='get', ctx=Load(), lineno=574, col_offset=13, end_lineno=574, end_col_offset=23), args=[Constant(value='method', lineno=574, col_offset=24, end_lineno=574, end_col_offset=32)], lineno=574, col_offset=13, end_lineno=574, end_col_offset=33), lineno=574, col_offset=4, end_lineno=574, end_col_offset=33), Assert(test=Compare(left=Name(id='method', ctx=Load(), lineno=575, col_offset=11, end_lineno=575, end_col_offset=17), ops=[IsNot()], comparators=[Constant(value=None, lineno=575, col_offset=25, end_lineno=575, end_col_offset=29)], lineno=575, col_offset=11, end_lineno=575, end_col_offset=29), lineno=575, col_offset=4, end_lineno=575, end_col_offset=29), Assign(targets=[Name(id='coverage', ctx=Store(), lineno=576, col_offset=4, end_lineno=576, end_col_offset=12)], value=Call(func=Attribute(value=Name(id='method', ctx=Load(), lineno=576, col_offset=15, end_lineno=576, end_col_offset=21), attr='get', ctx=Load(), lineno=576, col_offset=15, end_lineno=576, end_col_offset=25), args=[Constant(value='coverage', lineno=576, col_offset=26, end_lineno=576, end_col_offset=36)], lineno=576, col_offset=15, end_lineno=576, end_col_offset=37), lineno=576, col_offset=4, end_lineno=576, end_col_offset=37), Assert(test=Compare(left=Name(id='coverage', ctx=Load(), lineno=577, col_offset=11, end_lineno=577, end_col_offset=19), ops=[IsNot()], comparators=[Constant(value=None, lineno=577, col_offset=27, end_lineno=577, end_col_offset=31)], lineno=577, col_offset=11, end_lineno=577, end_col_offset=31), lineno=577, col_offset=4, end_lineno=577, end_col_offset=31), Assert(test=Compare(left=Constant(value='/3 results', lineno=578, col_offset=11, end_lineno=578, end_col_offset=23), ops=[In()], comparators=[Name(id='coverage', ctx=Load(), lineno=578, col_offset=27, end_lineno=578, end_col_offset=35)], lineno=578, col_offset=11, end_lineno=578, end_col_offset=35), lineno=578, col_offset=4, end_lineno=578, end_col_offset=35), Assert(test=Compare(left=Constant(value='requested 10', lineno=579, col_offset=11, end_lineno=579, end_col_offset=25), ops=[In()], comparators=[Name(id='coverage', ctx=Load(), lineno=579, col_offset=29, end_lineno=579, end_col_offset=37)], lineno=579, col_offset=11, end_lineno=579, end_col_offset=37), lineno=579, col_offset=4, end_lineno=579, end_col_offset=37)], decorator_list=[Attribute(value=Attribute(value=Name(id='pytest', ctx=Load(), lineno=549, col_offset=1, end_lineno=549, end_col_offset=7), attr='mark', ctx=Load(), lineno=549, col_offset=1, end_lineno=549, end_col_offset=12), attr='asyncio', ctx=Load(), lineno=549, col_offset=1, end_lineno=549, end_col_offset=20)], returns=Constant(value=None, lineno=550, col_offset=67, end_lineno=550, end_col_offset=71), lineno=550, col_offset=0, end_lineno=579, end_col_offset=37), AsyncFunctionDef(name='test_semantic_search_limit_enforces_minimum', args=arguments(), body=[Assign(targets=[Name(id='faiss_manager', ctx=Store(), lineno=584, col_offset=4, end_lineno=584, end_col_offset=17)], value=Call(func=Name(id='_BaseStubFAISSManager', ctx=Load(), lineno=584, col_offset=20, end_lineno=584, end_col_offset=41), keywords=[keyword(arg='should_fail_gpu', value=Constant(value=False, lineno=584, col_offset=58, end_lineno=584, end_col_offset=63), lineno=584, col_offset=42, end_lineno=584, end_col_offset=63)], lineno=584, col_offset=20, end_lineno=584, end_col_offset=64), lineno=584, col_offset=4, end_lineno=584, end_col_offset=64), Assign(targets=[Name(id='context', ctx=Store(), lineno=585, col_offset=4, end_lineno=585, end_col_offset=11)], value=Call(func=Name(id='StubContext', ctx=Load(), lineno=585, col_offset=14, end_lineno=585, end_col_offset=25), keywords=[keyword(arg='faiss_manager', value=Name(id='faiss_manager', ctx=Load(), lineno=586, col_offset=22, end_lineno=586, end_col_offset=35), lineno=586, col_offset=8, end_lineno=586, end_col_offset=35), keyword(arg='config', value=Call(func=Name(id='StubContextConfig', ctx=Load(), lineno=587, col_offset=15, end_lineno=587, end_col_offset=32), keywords=[keyword(arg='limits', value=List(ctx=Load(), lineno=587, col_offset=40, end_lineno=587, end_col_offset=42), lineno=587, col_offset=33, end_lineno=587, end_col_offset=42), keyword(arg='error', value=Constant(value=None, lineno=587, col_offset=50, end_lineno=587, end_col_offset=54), lineno=587, col_offset=44, end_lineno=587, end_col_offset=54), keyword(arg='max_results', value=Constant(value=5, lineno=587, col_offset=68, end_lineno=587, end_col_offset=69), lineno=587, col_offset=56, end_lineno=587, end_col_offset=69)], lineno=587, col_offset=15, end_lineno=587, end_col_offset=70), lineno=587, col_offset=8, end_lineno=587, end_col_offset=70)], lineno=585, col_offset=14, end_lineno=588, end_col_offset=5), lineno=585, col_offset=4, end_lineno=588, end_col_offset=5), With(items=[withitem(context_expr=Call(func=Name(id='patch', ctx=Load(), lineno=592, col_offset=8, end_lineno=592, end_col_offset=13), args=[Constant(value='codeintel_rev.mcp_server.adapters.semantic.get_session_id', lineno=593, col_offset=12, end_lineno=593, end_col_offset=71)], keywords=[keyword(arg='return_value', value=Constant(value='test-session-123', lineno=594, col_offset=25, end_lineno=594, end_col_offset=43), lineno=594, col_offset=12, end_lineno=594, end_col_offset=43)], lineno=592, col_offset=8, end_lineno=595, end_col_offset=9)), withitem(context_expr=Call(func=Name(id='patch', ctx=Load(), lineno=596, col_offset=8, end_lineno=596, end_col_offset=13), args=[Constant(value='codeintel_rev.mcp_server.adapters.semantic.get_effective_scope', lineno=597, col_offset=12, end_lineno=597, end_col_offset=76)], keywords=[keyword(arg='return_value', value=Constant(value=None, lineno=598, col_offset=25, end_lineno=598, end_col_offset=29), lineno=598, col_offset=12, end_lineno=598, end_col_offset=29)], lineno=596, col_offset=8, end_lineno=599, end_col_offset=9))], body=[Assign(targets=[Name(id='result', ctx=Store(), lineno=601, col_offset=8, end_lineno=601, end_col_offset=14)], value=Await(value=Call(func=Name(id='semantic_search', ctx=Load(), lineno=601, col_offset=23, end_lineno=601, end_col_offset=38), args=[Call(func=Name(id='cast', ctx=Load(), lineno=601, col_offset=39, end_lineno=601, end_col_offset=43), args=[Constant(value='ApplicationContext', lineno=601, col_offset=44, end_lineno=601, end_col_offset=64), Name(id='context', ctx=Load(), lineno=601, col_offset=66, end_lineno=601, end_col_offset=73)], lineno=601, col_offset=39, end_lineno=601, end_col_offset=74), Constant(value='hello', lineno=601, col_offset=76, end_lineno=601, end_col_offset=83)], keywords=[keyword(arg='limit', value=Constant(value=0, lineno=601, col_offset=91, end_lineno=601, end_col_offset=92), lineno=601, col_offset=85, end_lineno=601, end_col_offset=92)], lineno=601, col_offset=23, end_lineno=601, end_col_offset=93), lineno=601, col_offset=17, end_lineno=601, end_col_offset=93), lineno=601, col_offset=8, end_lineno=601, end_col_offset=93)], lineno=591, col_offset=4, end_lineno=601, end_col_offset=93), Assert(test=Compare(left=Attribute(value=Name(id='faiss_manager', ctx=Load(), lineno=603, col_offset=11, end_lineno=603, end_col_offset=24), attr='last_k', ctx=Load(), lineno=603, col_offset=11, end_lineno=603, end_col_offset=31), ops=[Eq()], comparators=[Constant(value=1, lineno=603, col_offset=35, end_lineno=603, end_col_offset=36)], lineno=603, col_offset=11, end_lineno=603, end_col_offset=36), lineno=603, col_offset=4, end_lineno=603, end_col_offset=36), Assign(targets=[Name(id='limits', ctx=Store(), lineno=604, col_offset=4, end_lineno=604, end_col_offset=10)], value=Call(func=Attribute(value=Name(id='result', ctx=Load(), lineno=604, col_offset=13, end_lineno=604, end_col_offset=19), attr='get', ctx=Load(), lineno=604, col_offset=13, end_lineno=604, end_col_offset=23), args=[Constant(value='limits', lineno=604, col_offset=24, end_lineno=604, end_col_offset=32)], lineno=604, col_offset=13, end_lineno=604, end_col_offset=33), lineno=604, col_offset=4, end_lineno=604, end_col_offset=33), Assert(test=Compare(left=Name(id='limits', ctx=Load(), lineno=605, col_offset=11, end_lineno=605, end_col_offset=17), ops=[IsNot()], comparators=[Constant(value=None, lineno=605, col_offset=25, end_lineno=605, end_col_offset=29)], lineno=605, col_offset=11, end_lineno=605, end_col_offset=29), lineno=605, col_offset=4, end_lineno=605, end_col_offset=29), Assert(test=Call(func=Name(id='any', ctx=Load(), lineno=606, col_offset=11, end_lineno=606, end_col_offset=14), args=[GeneratorExp(elt=Compare(left=Constant(value='not positive', lineno=606, col_offset=15, end_lineno=606, end_col_offset=29), ops=[In()], comparators=[Name(id='message', ctx=Load(), lineno=606, col_offset=33, end_lineno=606, end_col_offset=40)], lineno=606, col_offset=15, end_lineno=606, end_col_offset=40), generators=[comprehension(target=Name(id='message', ctx=Store(), lineno=606, col_offset=45, end_lineno=606, end_col_offset=52), iter=Name(id='limits', ctx=Load(), lineno=606, col_offset=56, end_lineno=606, end_col_offset=62), is_async=0)], lineno=606, col_offset=14, end_lineno=606, end_col_offset=63)], lineno=606, col_offset=11, end_lineno=606, end_col_offset=63), lineno=606, col_offset=4, end_lineno=606, end_col_offset=63), Assign(targets=[Name(id='method', ctx=Store(), lineno=607, col_offset=4, end_lineno=607, end_col_offset=10)], value=Call(func=Attribute(value=Name(id='result', ctx=Load(), lineno=607, col_offset=13, end_lineno=607, end_col_offset=19), attr='get', ctx=Load(), lineno=607, col_offset=13, end_lineno=607, end_col_offset=23), args=[Constant(value='method', lineno=607, col_offset=24, end_lineno=607, end_col_offset=32)], lineno=607, col_offset=13, end_lineno=607, end_col_offset=33), lineno=607, col_offset=4, end_lineno=607, end_col_offset=33), Assert(test=Compare(left=Name(id='method', ctx=Load(), lineno=608, col_offset=11, end_lineno=608, end_col_offset=17), ops=[IsNot()], comparators=[Constant(value=None, lineno=608, col_offset=25, end_lineno=608, end_col_offset=29)], lineno=608, col_offset=11, end_lineno=608, end_col_offset=29), lineno=608, col_offset=4, end_lineno=608, end_col_offset=29), Assign(targets=[Name(id='coverage', ctx=Store(), lineno=609, col_offset=4, end_lineno=609, end_col_offset=12)], value=Call(func=Attribute(value=Name(id='method', ctx=Load(), lineno=609, col_offset=15, end_lineno=609, end_col_offset=21), attr='get', ctx=Load(), lineno=609, col_offset=15, end_lineno=609, end_col_offset=25), args=[Constant(value='coverage', lineno=609, col_offset=26, end_lineno=609, end_col_offset=36)], lineno=609, col_offset=15, end_lineno=609, end_col_offset=37), lineno=609, col_offset=4, end_lineno=609, end_col_offset=37), Assert(test=Compare(left=Name(id='coverage', ctx=Load(), lineno=610, col_offset=11, end_lineno=610, end_col_offset=19), ops=[IsNot()], comparators=[Constant(value=None, lineno=610, col_offset=27, end_lineno=610, end_col_offset=31)], lineno=610, col_offset=11, end_lineno=610, end_col_offset=31), lineno=610, col_offset=4, end_lineno=610, end_col_offset=31), Assert(test=Compare(left=Constant(value='/1 results', lineno=611, col_offset=11, end_lineno=611, end_col_offset=23), ops=[In()], comparators=[Name(id='coverage', ctx=Load(), lineno=611, col_offset=27, end_lineno=611, end_col_offset=35)], lineno=611, col_offset=11, end_lineno=611, end_col_offset=35), lineno=611, col_offset=4, end_lineno=611, end_col_offset=35), Assert(test=Compare(left=Constant(value='requested 0', lineno=612, col_offset=11, end_lineno=612, end_col_offset=24), ops=[In()], comparators=[Name(id='coverage', ctx=Load(), lineno=612, col_offset=28, end_lineno=612, end_col_offset=36)], lineno=612, col_offset=11, end_lineno=612, end_col_offset=36), lineno=612, col_offset=4, end_lineno=612, end_col_offset=36)], decorator_list=[Attribute(value=Attribute(value=Name(id='pytest', ctx=Load(), lineno=582, col_offset=1, end_lineno=582, end_col_offset=7), attr='mark', ctx=Load(), lineno=582, col_offset=1, end_lineno=582, end_col_offset=12), attr='asyncio', ctx=Load(), lineno=582, col_offset=1, end_lineno=582, end_col_offset=20)], returns=Constant(value=None, lineno=583, col_offset=59, end_lineno=583, end_col_offset=63), lineno=583, col_offset=0, end_lineno=612, end_col_offset=36), AsyncFunctionDef(name='test_semantic_search_respects_configured_nprobe', args=arguments(), body=[Assign(targets=[Name(id='faiss_manager', ctx=Store(), lineno=617, col_offset=4, end_lineno=617, end_col_offset=17)], value=Call(func=Name(id='_BaseStubFAISSManager', ctx=Load(), lineno=617, col_offset=20, end_lineno=617, end_col_offset=41), keywords=[keyword(arg='should_fail_gpu', value=Constant(value=False, lineno=617, col_offset=58, end_lineno=617, end_col_offset=63), lineno=617, col_offset=42, end_lineno=617, end_col_offset=63)], lineno=617, col_offset=20, end_lineno=617, end_col_offset=64), lineno=617, col_offset=4, end_lineno=617, end_col_offset=64), Assign(targets=[Name(id='context', ctx=Store(), lineno=618, col_offset=4, end_lineno=618, end_col_offset=11)], value=Call(func=Name(id='StubContext', ctx=Load(), lineno=618, col_offset=14, end_lineno=618, end_col_offset=25), keywords=[keyword(arg='faiss_manager', value=Name(id='faiss_manager', ctx=Load(), lineno=619, col_offset=22, end_lineno=619, end_col_offset=35), lineno=619, col_offset=8, end_lineno=619, end_col_offset=35), keyword(arg='config', value=Call(func=Name(id='StubContextConfig', ctx=Load(), lineno=620, col_offset=15, end_lineno=620, end_col_offset=32), keywords=[keyword(arg='limits', value=List(ctx=Load(), lineno=620, col_offset=40, end_lineno=620, end_col_offset=42), lineno=620, col_offset=33, end_lineno=620, end_col_offset=42), keyword(arg='error', value=Constant(value=None, lineno=620, col_offset=50, end_lineno=620, end_col_offset=54), lineno=620, col_offset=44, end_lineno=620, end_col_offset=54), keyword(arg='max_results', value=Constant(value=5, lineno=620, col_offset=68, end_lineno=620, end_col_offset=69), lineno=620, col_offset=56, end_lineno=620, end_col_offset=69), keyword(arg='faiss_nprobe', value=Constant(value=64, lineno=620, col_offset=84, end_lineno=620, end_col_offset=86), lineno=620, col_offset=71, end_lineno=620, end_col_offset=86)], lineno=620, col_offset=15, end_lineno=620, end_col_offset=87), lineno=620, col_offset=8, end_lineno=620, end_col_offset=87)], lineno=618, col_offset=14, end_lineno=621, end_col_offset=5), lineno=618, col_offset=4, end_lineno=621, end_col_offset=5), With(items=[withitem(context_expr=Call(func=Name(id='patch', ctx=Load(), lineno=624, col_offset=8, end_lineno=624, end_col_offset=13), args=[Constant(value='codeintel_rev.mcp_server.adapters.semantic.get_session_id', lineno=625, col_offset=12, end_lineno=625, end_col_offset=71)], keywords=[keyword(arg='return_value', value=Constant(value='test-session-123', lineno=626, col_offset=25, end_lineno=626, end_col_offset=43), lineno=626, col_offset=12, end_lineno=626, end_col_offset=43)], lineno=624, col_offset=8, end_lineno=627, end_col_offset=9)), withitem(context_expr=Call(func=Name(id='patch', ctx=Load(), lineno=628, col_offset=8, end_lineno=628, end_col_offset=13), args=[Constant(value='codeintel_rev.mcp_server.adapters.semantic.get_effective_scope', lineno=629, col_offset=12, end_lineno=629, end_col_offset=76)], keywords=[keyword(arg='return_value', value=Constant(value=None, lineno=630, col_offset=25, end_lineno=630, end_col_offset=29), lineno=630, col_offset=12, end_lineno=630, end_col_offset=29)], lineno=628, col_offset=8, end_lineno=631, end_col_offset=9))], body=[Expr(value=Await(value=Call(func=Name(id='semantic_search', ctx=Load(), lineno=633, col_offset=14, end_lineno=633, end_col_offset=29), args=[Call(func=Name(id='cast', ctx=Load(), lineno=633, col_offset=30, end_lineno=633, end_col_offset=34), args=[Constant(value='ApplicationContext', lineno=633, col_offset=35, end_lineno=633, end_col_offset=55), Name(id='context', ctx=Load(), lineno=633, col_offset=57, end_lineno=633, end_col_offset=64)], lineno=633, col_offset=30, end_lineno=633, end_col_offset=65), Constant(value='hello', lineno=633, col_offset=67, end_lineno=633, end_col_offset=74)], keywords=[keyword(arg='limit', value=Constant(value=1, lineno=633, col_offset=82, end_lineno=633, end_col_offset=83), lineno=633, col_offset=76, end_lineno=633, end_col_offset=83)], lineno=633, col_offset=14, end_lineno=633, end_col_offset=84), lineno=633, col_offset=8, end_lineno=633, end_col_offset=84), lineno=633, col_offset=8, end_lineno=633, end_col_offset=84)], lineno=623, col_offset=4, end_lineno=633, end_col_offset=84), Assert(test=Compare(left=Attribute(value=Name(id='faiss_manager', ctx=Load(), lineno=635, col_offset=11, end_lineno=635, end_col_offset=24), attr='last_nprobe', ctx=Load(), lineno=635, col_offset=11, end_lineno=635, end_col_offset=36), ops=[Eq()], comparators=[Constant(value=64, lineno=635, col_offset=40, end_lineno=635, end_col_offset=42)], lineno=635, col_offset=11, end_lineno=635, end_col_offset=42), lineno=635, col_offset=4, end_lineno=635, end_col_offset=42)], decorator_list=[Attribute(value=Attribute(value=Name(id='pytest', ctx=Load(), lineno=615, col_offset=1, end_lineno=615, end_col_offset=7), attr='mark', ctx=Load(), lineno=615, col_offset=1, end_lineno=615, end_col_offset=12), attr='asyncio', ctx=Load(), lineno=615, col_offset=1, end_lineno=615, end_col_offset=20)], returns=Constant(value=None, lineno=616, col_offset=63, end_lineno=616, end_col_offset=67), lineno=616, col_offset=0, end_lineno=635, end_col_offset=42), AsyncFunctionDef(name='test_semantic_search_with_scope_filters', args=arguments(), body=[Expr(value=Constant(value='Test semantic search applies scope filters (language filter).\n\n    Verifies that when session scope has language filters, only chunks\n    matching those languages are returned.\n    ', lineno=640, col_offset=4, end_lineno=644, end_col_offset=7), lineno=640, col_offset=4, end_lineno=644, end_col_offset=7), Assign(targets=[Name(id='catalog_chunks', ctx=Store(), lineno=646, col_offset=4, end_lineno=646, end_col_offset=18)], value=List(elts=[Dict(keys=[Constant(value='id', lineno=648, col_offset=12, end_lineno=648, end_col_offset=16), Constant(value='uri', lineno=649, col_offset=12, end_lineno=649, end_col_offset=17), Constant(value='start_line', lineno=650, col_offset=12, end_lineno=650, end_col_offset=24), Constant(value='end_line', lineno=651, col_offset=12, end_lineno=651, end_col_offset=22), Constant(value='preview', lineno=652, col_offset=12, end_lineno=652, end_col_offset=21)], values=[Constant(value=123, lineno=648, col_offset=18, end_lineno=648, end_col_offset=21), Constant(value='src/main.py', lineno=649, col_offset=19, end_lineno=649, end_col_offset=32), Constant(value=0, lineno=650, col_offset=26, end_lineno=650, end_col_offset=27), Constant(value=10, lineno=651, col_offset=24, end_lineno=651, end_col_offset=26), Constant(value='def main():\n    pass', lineno=652, col_offset=23, end_lineno=652, end_col_offset=46)], lineno=647, col_offset=8, end_lineno=653, end_col_offset=9), Dict(keys=[Constant(value='id', lineno=655, col_offset=12, end_lineno=655, end_col_offset=16), Constant(value='uri', lineno=656, col_offset=12, end_lineno=656, end_col_offset=17), Constant(value='start_line', lineno=657, col_offset=12, end_lineno=657, end_col_offset=24), Constant(value='end_line', lineno=658, col_offset=12, end_lineno=658, end_col_offset=22), Constant(value='preview', lineno=659, col_offset=12, end_lineno=659, end_col_offset=21)], values=[Constant(value=456, lineno=655, col_offset=18, end_lineno=655, end_col_offset=21), Constant(value='src/app.ts', lineno=656, col_offset=19, end_lineno=656, end_col_offset=31), Constant(value=0, lineno=657, col_offset=26, end_lineno=657, end_col_offset=27), Constant(value=10, lineno=658, col_offset=24, end_lineno=658, end_col_offset=26), Constant(value='function app() {\n    return null;\n}', lineno=659, col_offset=23, end_lineno=659, end_col_offset=62)], lineno=654, col_offset=8, end_lineno=660, end_col_offset=9), Dict(keys=[Constant(value='id', lineno=662, col_offset=12, end_lineno=662, end_col_offset=16), Constant(value='uri', lineno=663, col_offset=12, end_lineno=663, end_col_offset=17), Constant(value='start_line', lineno=664, col_offset=12, end_lineno=664, end_col_offset=24), Constant(value='end_line', lineno=665, col_offset=12, end_lineno=665, end_col_offset=22), Constant(value='preview', lineno=666, col_offset=12, end_lineno=666, end_col_offset=21)], values=[Constant(value=789, lineno=662, col_offset=18, end_lineno=662, end_col_offset=21), Constant(value='src/utils.py', lineno=663, col_offset=19, end_lineno=663, end_col_offset=33), Constant(value=0, lineno=664, col_offset=26, end_lineno=664, end_col_offset=27), Constant(value=5, lineno=665, col_offset=24, end_lineno=665, end_col_offset=25), Constant(value='def helper():\n    pass', lineno=666, col_offset=23, end_lineno=666, end_col_offset=48)], lineno=661, col_offset=8, end_lineno=667, end_col_offset=9)], ctx=Load(), lineno=646, col_offset=21, end_lineno=668, end_col_offset=5), lineno=646, col_offset=4, end_lineno=668, end_col_offset=5), Assign(targets=[Name(id='faiss_manager', ctx=Store(), lineno=671, col_offset=4, end_lineno=671, end_col_offset=17)], value=Call(func=Name(id='_BaseStubFAISSManager', ctx=Load(), lineno=671, col_offset=20, end_lineno=671, end_col_offset=41), keywords=[keyword(arg='should_fail_gpu', value=Constant(value=False, lineno=671, col_offset=58, end_lineno=671, end_col_offset=63), lineno=671, col_offset=42, end_lineno=671, end_col_offset=63), keyword(arg='search_ids', value=List(elts=[Constant(value=123, lineno=671, col_offset=77, end_lineno=671, end_col_offset=80), Constant(value=456, lineno=671, col_offset=82, end_lineno=671, end_col_offset=85), Constant(value=789, lineno=671, col_offset=87, end_lineno=671, end_col_offset=90)], ctx=Load(), lineno=671, col_offset=76, end_lineno=671, end_col_offset=91), lineno=671, col_offset=65, end_lineno=671, end_col_offset=91)], lineno=671, col_offset=20, end_lineno=671, end_col_offset=92), lineno=671, col_offset=4, end_lineno=671, end_col_offset=92), Assign(targets=[Name(id='context', ctx=Store(), lineno=673, col_offset=4, end_lineno=673, end_col_offset=11)], value=Call(func=Name(id='StubContext', ctx=Load(), lineno=673, col_offset=14, end_lineno=673, end_col_offset=25), keywords=[keyword(arg='faiss_manager', value=Name(id='faiss_manager', ctx=Load(), lineno=674, col_offset=22, end_lineno=674, end_col_offset=35), lineno=674, col_offset=8, end_lineno=674, end_col_offset=35), keyword(arg='config', value=Call(func=Name(id='StubContextConfig', ctx=Load(), lineno=675, col_offset=15, end_lineno=675, end_col_offset=32), keywords=[keyword(arg='limits', value=List(ctx=Load(), lineno=675, col_offset=40, end_lineno=675, end_col_offset=42), lineno=675, col_offset=33, end_lineno=675, end_col_offset=42), keyword(arg='error', value=Constant(value=None, lineno=675, col_offset=50, end_lineno=675, end_col_offset=54), lineno=675, col_offset=44, end_lineno=675, end_col_offset=54), keyword(arg='catalog_chunks', value=Name(id='catalog_chunks', ctx=Load(), lineno=675, col_offset=71, end_lineno=675, end_col_offset=85), lineno=675, col_offset=56, end_lineno=675, end_col_offset=85)], lineno=675, col_offset=15, end_lineno=675, end_col_offset=86), lineno=675, col_offset=8, end_lineno=675, end_col_offset=86)], lineno=673, col_offset=14, end_lineno=676, end_col_offset=5), lineno=673, col_offset=4, end_lineno=676, end_col_offset=5), AnnAssign(target=Name(id='scope', ctx=Store(), lineno=679, col_offset=4, end_lineno=679, end_col_offset=9), annotation=Name(id='ScopeIn', ctx=Load(), lineno=679, col_offset=11, end_lineno=679, end_col_offset=18), value=Dict(keys=[Constant(value='languages', lineno=679, col_offset=22, end_lineno=679, end_col_offset=33)], values=[List(elts=[Constant(value='python', lineno=679, col_offset=36, end_lineno=679, end_col_offset=44)], ctx=Load(), lineno=679, col_offset=35, end_lineno=679, end_col_offset=45)], lineno=679, col_offset=21, end_lineno=679, end_col_offset=46), simple=1, lineno=679, col_offset=4, end_lineno=679, end_col_offset=46), With(items=[withitem(context_expr=Call(func=Name(id='patch', ctx=Load(), lineno=682, col_offset=8, end_lineno=682, end_col_offset=13), args=[Constant(value='codeintel_rev.mcp_server.adapters.semantic.get_session_id', lineno=683, col_offset=12, end_lineno=683, end_col_offset=71)], keywords=[keyword(arg='return_value', value=Constant(value='test-session-123', lineno=684, col_offset=25, end_lineno=684, end_col_offset=43), lineno=684, col_offset=12, end_lineno=684, end_col_offset=43)], lineno=682, col_offset=8, end_lineno=685, end_col_offset=9)), withitem(context_expr=Call(func=Name(id='patch', ctx=Load(), lineno=686, col_offset=8, end_lineno=686, end_col_offset=13), args=[Constant(value='codeintel_rev.mcp_server.adapters.semantic.get_effective_scope', lineno=687, col_offset=12, end_lineno=687, end_col_offset=76)], keywords=[keyword(arg='return_value', value=Name(id='scope', ctx=Load(), lineno=688, col_offset=25, end_lineno=688, end_col_offset=30), lineno=688, col_offset=12, end_lineno=688, end_col_offset=30)], lineno=686, col_offset=8, end_lineno=689, end_col_offset=9))], body=[Assign(targets=[Name(id='result', ctx=Store(), lineno=691, col_offset=8, end_lineno=691, end_col_offset=14)], value=Await(value=Call(func=Name(id='semantic_search', ctx=Load(), lineno=691, col_offset=23, end_lineno=691, end_col_offset=38), args=[Call(func=Name(id='cast', ctx=Load(), lineno=691, col_offset=39, end_lineno=691, end_col_offset=43), args=[Constant(value='ApplicationContext', lineno=691, col_offset=44, end_lineno=691, end_col_offset=64), Name(id='context', ctx=Load(), lineno=691, col_offset=66, end_lineno=691, end_col_offset=73)], lineno=691, col_offset=39, end_lineno=691, end_col_offset=74), Constant(value='function', lineno=691, col_offset=76, end_lineno=691, end_col_offset=86)], keywords=[keyword(arg='limit', value=Constant(value=10, lineno=691, col_offset=94, end_lineno=691, end_col_offset=96), lineno=691, col_offset=88, end_lineno=691, end_col_offset=96)], lineno=691, col_offset=23, end_lineno=691, end_col_offset=97), lineno=691, col_offset=17, end_lineno=691, end_col_offset=97), lineno=691, col_offset=8, end_lineno=691, end_col_offset=97)], lineno=681, col_offset=4, end_lineno=691, end_col_offset=97), Assign(targets=[Name(id='findings', ctx=Store(), lineno=693, col_offset=4, end_lineno=693, end_col_offset=12)], value=Call(func=Attribute(value=Name(id='result', ctx=Load(), lineno=693, col_offset=15, end_lineno=693, end_col_offset=21), attr='get', ctx=Load(), lineno=693, col_offset=15, end_lineno=693, end_col_offset=25), args=[Constant(value='findings', lineno=693, col_offset=26, end_lineno=693, end_col_offset=36)], lineno=693, col_offset=15, end_lineno=693, end_col_offset=37), lineno=693, col_offset=4, end_lineno=693, end_col_offset=37), Assert(test=Compare(left=Name(id='findings', ctx=Load(), lineno=694, col_offset=11, end_lineno=694, end_col_offset=19), ops=[IsNot()], comparators=[Constant(value=None, lineno=694, col_offset=27, end_lineno=694, end_col_offset=31)], lineno=694, col_offset=11, end_lineno=694, end_col_offset=31), lineno=694, col_offset=4, end_lineno=694, end_col_offset=31), Assert(test=Compare(left=Call(func=Name(id='len', ctx=Load(), lineno=695, col_offset=11, end_lineno=695, end_col_offset=14), args=[Name(id='findings', ctx=Load(), lineno=695, col_offset=15, end_lineno=695, end_col_offset=23)], lineno=695, col_offset=11, end_lineno=695, end_col_offset=24), ops=[Eq()], comparators=[Constant(value=2, lineno=695, col_offset=28, end_lineno=695, end_col_offset=29)], lineno=695, col_offset=11, end_lineno=695, end_col_offset=29), lineno=695, col_offset=4, end_lineno=695, end_col_offset=29), Assign(targets=[Name(id='uris', ctx=Store(), lineno=698, col_offset=4, end_lineno=698, end_col_offset=8)], value=ListComp(elt=Call(func=Attribute(value=Call(func=Attribute(value=Name(id='finding', ctx=Load(), lineno=698, col_offset=12, end_lineno=698, end_col_offset=19), attr='get', ctx=Load(), lineno=698, col_offset=12, end_lineno=698, end_col_offset=23), args=[Constant(value='location', lineno=698, col_offset=24, end_lineno=698, end_col_offset=34), Dict(lineno=698, col_offset=36, end_lineno=698, end_col_offset=38)], lineno=698, col_offset=12, end_lineno=698, end_col_offset=39), attr='get', ctx=Load(), lineno=698, col_offset=12, end_lineno=698, end_col_offset=43), args=[Constant(value='uri', lineno=698, col_offset=44, end_lineno=698, end_col_offset=49), Constant(value='', lineno=698, col_offset=51, end_lineno=698, end_col_offset=53)], lineno=698, col_offset=12, end_lineno=698, end_col_offset=54), generators=[comprehension(target=Name(id='finding', ctx=Store(), lineno=698, col_offset=59, end_lineno=698, end_col_offset=66), iter=Name(id='findings', ctx=Load(), lineno=698, col_offset=70, end_lineno=698, end_col_offset=78), is_async=0)], lineno=698, col_offset=11, end_lineno=698, end_col_offset=79), lineno=698, col_offset=4, end_lineno=698, end_col_offset=79), Assert(test=Call(func=Name(id='all', ctx=Load(), lineno=699, col_offset=11, end_lineno=699, end_col_offset=14), args=[GeneratorExp(elt=Call(func=Attribute(value=Name(id='uri', ctx=Load(), lineno=699, col_offset=15, end_lineno=699, end_col_offset=18), attr='endswith', ctx=Load(), lineno=699, col_offset=15, end_lineno=699, end_col_offset=27), args=[Constant(value='.py', lineno=699, col_offset=28, end_lineno=699, end_col_offset=33)], lineno=699, col_offset=15, end_lineno=699, end_col_offset=34), generators=[comprehension(target=Name(id='uri', ctx=Store(), lineno=699, col_offset=39, end_lineno=699, end_col_offset=42), iter=Name(id='uris', ctx=Load(), lineno=699, col_offset=46, end_lineno=699, end_col_offset=50), is_async=0)], lineno=699, col_offset=14, end_lineno=699, end_col_offset=51)], lineno=699, col_offset=11, end_lineno=699, end_col_offset=51), lineno=699, col_offset=4, end_lineno=699, end_col_offset=51), Assert(test=Compare(left=Constant(value='src/main.py', lineno=700, col_offset=11, end_lineno=700, end_col_offset=24), ops=[In()], comparators=[Name(id='uris', ctx=Load(), lineno=700, col_offset=28, end_lineno=700, end_col_offset=32)], lineno=700, col_offset=11, end_lineno=700, end_col_offset=32), lineno=700, col_offset=4, end_lineno=700, end_col_offset=32), Assert(test=Compare(left=Constant(value='src/utils.py', lineno=701, col_offset=11, end_lineno=701, end_col_offset=25), ops=[In()], comparators=[Name(id='uris', ctx=Load(), lineno=701, col_offset=29, end_lineno=701, end_col_offset=33)], lineno=701, col_offset=11, end_lineno=701, end_col_offset=33), lineno=701, col_offset=4, end_lineno=701, end_col_offset=33), Assert(test=Compare(left=Constant(value='src/app.ts', lineno=702, col_offset=11, end_lineno=702, end_col_offset=23), ops=[NotIn()], comparators=[Name(id='uris', ctx=Load(), lineno=702, col_offset=31, end_lineno=702, end_col_offset=35)], lineno=702, col_offset=11, end_lineno=702, end_col_offset=35), lineno=702, col_offset=4, end_lineno=702, end_col_offset=35), Assert(test=Compare(left=Call(func=Attribute(value=Name(id='result', ctx=Load(), lineno=705, col_offset=11, end_lineno=705, end_col_offset=17), attr='get', ctx=Load(), lineno=705, col_offset=11, end_lineno=705, end_col_offset=21), args=[Constant(value='scope', lineno=705, col_offset=22, end_lineno=705, end_col_offset=29)], lineno=705, col_offset=11, end_lineno=705, end_col_offset=30), ops=[Eq()], comparators=[Name(id='scope', ctx=Load(), lineno=705, col_offset=34, end_lineno=705, end_col_offset=39)], lineno=705, col_offset=11, end_lineno=705, end_col_offset=39), lineno=705, col_offset=4, end_lineno=705, end_col_offset=39)], decorator_list=[Attribute(value=Attribute(value=Name(id='pytest', ctx=Load(), lineno=638, col_offset=1, end_lineno=638, end_col_offset=7), attr='mark', ctx=Load(), lineno=638, col_offset=1, end_lineno=638, end_col_offset=12), attr='asyncio', ctx=Load(), lineno=638, col_offset=1, end_lineno=638, end_col_offset=20)], returns=Constant(value=None, lineno=639, col_offset=55, end_lineno=639, end_col_offset=59), lineno=639, col_offset=0, end_lineno=705, end_col_offset=39), AsyncFunctionDef(name='test_semantic_search_no_scope', args=arguments(), body=[Expr(value=Constant(value='Test semantic search without scope filters returns all files.\n\n    Verifies that when no session scope is set, all chunks are returned\n    (no filtering applied).\n    ', lineno=710, col_offset=4, end_lineno=714, end_col_offset=7), lineno=710, col_offset=4, end_lineno=714, end_col_offset=7), Assign(targets=[Name(id='catalog_chunks', ctx=Store(), lineno=716, col_offset=4, end_lineno=716, end_col_offset=18)], value=List(elts=[Dict(keys=[Constant(value='id', lineno=718, col_offset=12, end_lineno=718, end_col_offset=16), Constant(value='uri', lineno=719, col_offset=12, end_lineno=719, end_col_offset=17), Constant(value='start_line', lineno=720, col_offset=12, end_lineno=720, end_col_offset=24), Constant(value='end_line', lineno=721, col_offset=12, end_lineno=721, end_col_offset=22), Constant(value='preview', lineno=722, col_offset=12, end_lineno=722, end_col_offset=21)], values=[Constant(value=123, lineno=718, col_offset=18, end_lineno=718, end_col_offset=21), Constant(value='src/main.py', lineno=719, col_offset=19, end_lineno=719, end_col_offset=32), Constant(value=0, lineno=720, col_offset=26, end_lineno=720, end_col_offset=27), Constant(value=10, lineno=721, col_offset=24, end_lineno=721, end_col_offset=26), Constant(value='def main():\n    pass', lineno=722, col_offset=23, end_lineno=722, end_col_offset=46)], lineno=717, col_offset=8, end_lineno=723, end_col_offset=9), Dict(keys=[Constant(value='id', lineno=725, col_offset=12, end_lineno=725, end_col_offset=16), Constant(value='uri', lineno=726, col_offset=12, end_lineno=726, end_col_offset=17), Constant(value='start_line', lineno=727, col_offset=12, end_lineno=727, end_col_offset=24), Constant(value='end_line', lineno=728, col_offset=12, end_lineno=728, end_col_offset=22), Constant(value='preview', lineno=729, col_offset=12, end_lineno=729, end_col_offset=21)], values=[Constant(value=456, lineno=725, col_offset=18, end_lineno=725, end_col_offset=21), Constant(value='src/app.ts', lineno=726, col_offset=19, end_lineno=726, end_col_offset=31), Constant(value=0, lineno=727, col_offset=26, end_lineno=727, end_col_offset=27), Constant(value=10, lineno=728, col_offset=24, end_lineno=728, end_col_offset=26), Constant(value='function app() {\n    return null;\n}', lineno=729, col_offset=23, end_lineno=729, end_col_offset=62)], lineno=724, col_offset=8, end_lineno=730, end_col_offset=9)], ctx=Load(), lineno=716, col_offset=21, end_lineno=731, end_col_offset=5), lineno=716, col_offset=4, end_lineno=731, end_col_offset=5), Assign(targets=[Name(id='faiss_manager', ctx=Store(), lineno=734, col_offset=4, end_lineno=734, end_col_offset=17)], value=Call(func=Name(id='_BaseStubFAISSManager', ctx=Load(), lineno=734, col_offset=20, end_lineno=734, end_col_offset=41), keywords=[keyword(arg='should_fail_gpu', value=Constant(value=False, lineno=734, col_offset=58, end_lineno=734, end_col_offset=63), lineno=734, col_offset=42, end_lineno=734, end_col_offset=63), keyword(arg='search_ids', value=List(elts=[Constant(value=123, lineno=734, col_offset=77, end_lineno=734, end_col_offset=80), Constant(value=456, lineno=734, col_offset=82, end_lineno=734, end_col_offset=85)], ctx=Load(), lineno=734, col_offset=76, end_lineno=734, end_col_offset=86), lineno=734, col_offset=65, end_lineno=734, end_col_offset=86)], lineno=734, col_offset=20, end_lineno=734, end_col_offset=87), lineno=734, col_offset=4, end_lineno=734, end_col_offset=87), Assign(targets=[Name(id='context', ctx=Store(), lineno=736, col_offset=4, end_lineno=736, end_col_offset=11)], value=Call(func=Name(id='StubContext', ctx=Load(), lineno=736, col_offset=14, end_lineno=736, end_col_offset=25), keywords=[keyword(arg='faiss_manager', value=Name(id='faiss_manager', ctx=Load(), lineno=737, col_offset=22, end_lineno=737, end_col_offset=35), lineno=737, col_offset=8, end_lineno=737, end_col_offset=35), keyword(arg='config', value=Call(func=Name(id='StubContextConfig', ctx=Load(), lineno=738, col_offset=15, end_lineno=738, end_col_offset=32), keywords=[keyword(arg='limits', value=List(ctx=Load(), lineno=738, col_offset=40, end_lineno=738, end_col_offset=42), lineno=738, col_offset=33, end_lineno=738, end_col_offset=42), keyword(arg='error', value=Constant(value=None, lineno=738, col_offset=50, end_lineno=738, end_col_offset=54), lineno=738, col_offset=44, end_lineno=738, end_col_offset=54), keyword(arg='catalog_chunks', value=Name(id='catalog_chunks', ctx=Load(), lineno=738, col_offset=71, end_lineno=738, end_col_offset=85), lineno=738, col_offset=56, end_lineno=738, end_col_offset=85)], lineno=738, col_offset=15, end_lineno=738, end_col_offset=86), lineno=738, col_offset=8, end_lineno=738, end_col_offset=86)], lineno=736, col_offset=14, end_lineno=739, end_col_offset=5), lineno=736, col_offset=4, end_lineno=739, end_col_offset=5), With(items=[withitem(context_expr=Call(func=Name(id='patch', ctx=Load(), lineno=743, col_offset=8, end_lineno=743, end_col_offset=13), args=[Constant(value='codeintel_rev.mcp_server.adapters.semantic.get_session_id', lineno=744, col_offset=12, end_lineno=744, end_col_offset=71)], keywords=[keyword(arg='return_value', value=Constant(value='test-session-123', lineno=745, col_offset=25, end_lineno=745, end_col_offset=43), lineno=745, col_offset=12, end_lineno=745, end_col_offset=43)], lineno=743, col_offset=8, end_lineno=746, end_col_offset=9)), withitem(context_expr=Call(func=Name(id='patch', ctx=Load(), lineno=747, col_offset=8, end_lineno=747, end_col_offset=13), args=[Constant(value='codeintel_rev.mcp_server.adapters.semantic.get_effective_scope', lineno=748, col_offset=12, end_lineno=748, end_col_offset=76)], keywords=[keyword(arg='return_value', value=Constant(value=None, lineno=749, col_offset=25, end_lineno=749, end_col_offset=29), lineno=749, col_offset=12, end_lineno=749, end_col_offset=29)], lineno=747, col_offset=8, end_lineno=750, end_col_offset=9))], body=[Assign(targets=[Name(id='result', ctx=Store(), lineno=752, col_offset=8, end_lineno=752, end_col_offset=14)], value=Await(value=Call(func=Name(id='semantic_search', ctx=Load(), lineno=752, col_offset=23, end_lineno=752, end_col_offset=38), args=[Call(func=Name(id='cast', ctx=Load(), lineno=752, col_offset=39, end_lineno=752, end_col_offset=43), args=[Constant(value='ApplicationContext', lineno=752, col_offset=44, end_lineno=752, end_col_offset=64), Name(id='context', ctx=Load(), lineno=752, col_offset=66, end_lineno=752, end_col_offset=73)], lineno=752, col_offset=39, end_lineno=752, end_col_offset=74), Constant(value='function', lineno=752, col_offset=76, end_lineno=752, end_col_offset=86)], keywords=[keyword(arg='limit', value=Constant(value=10, lineno=752, col_offset=94, end_lineno=752, end_col_offset=96), lineno=752, col_offset=88, end_lineno=752, end_col_offset=96)], lineno=752, col_offset=23, end_lineno=752, end_col_offset=97), lineno=752, col_offset=17, end_lineno=752, end_col_offset=97), lineno=752, col_offset=8, end_lineno=752, end_col_offset=97)], lineno=742, col_offset=4, end_lineno=752, end_col_offset=97), Assign(targets=[Name(id='findings', ctx=Store(), lineno=754, col_offset=4, end_lineno=754, end_col_offset=12)], value=Call(func=Attribute(value=Name(id='result', ctx=Load(), lineno=754, col_offset=15, end_lineno=754, end_col_offset=21), attr='get', ctx=Load(), lineno=754, col_offset=15, end_lineno=754, end_col_offset=25), args=[Constant(value='findings', lineno=754, col_offset=26, end_lineno=754, end_col_offset=36)], lineno=754, col_offset=15, end_lineno=754, end_col_offset=37), lineno=754, col_offset=4, end_lineno=754, end_col_offset=37), Assert(test=Compare(left=Name(id='findings', ctx=Load(), lineno=755, col_offset=11, end_lineno=755, end_col_offset=19), ops=[IsNot()], comparators=[Constant(value=None, lineno=755, col_offset=27, end_lineno=755, end_col_offset=31)], lineno=755, col_offset=11, end_lineno=755, end_col_offset=31), lineno=755, col_offset=4, end_lineno=755, end_col_offset=31), Assert(test=Compare(left=Call(func=Name(id='len', ctx=Load(), lineno=756, col_offset=11, end_lineno=756, end_col_offset=14), args=[Name(id='findings', ctx=Load(), lineno=756, col_offset=15, end_lineno=756, end_col_offset=23)], lineno=756, col_offset=11, end_lineno=756, end_col_offset=24), ops=[Eq()], comparators=[Constant(value=2, lineno=756, col_offset=28, end_lineno=756, end_col_offset=29)], lineno=756, col_offset=11, end_lineno=756, end_col_offset=29), lineno=756, col_offset=4, end_lineno=756, end_col_offset=29), Assign(targets=[Name(id='uris', ctx=Store(), lineno=759, col_offset=4, end_lineno=759, end_col_offset=8)], value=ListComp(elt=Call(func=Attribute(value=Call(func=Attribute(value=Name(id='finding', ctx=Load(), lineno=759, col_offset=12, end_lineno=759, end_col_offset=19), attr='get', ctx=Load(), lineno=759, col_offset=12, end_lineno=759, end_col_offset=23), args=[Constant(value='location', lineno=759, col_offset=24, end_lineno=759, end_col_offset=34), Dict(lineno=759, col_offset=36, end_lineno=759, end_col_offset=38)], lineno=759, col_offset=12, end_lineno=759, end_col_offset=39), attr='get', ctx=Load(), lineno=759, col_offset=12, end_lineno=759, end_col_offset=43), args=[Constant(value='uri', lineno=759, col_offset=44, end_lineno=759, end_col_offset=49), Constant(value='', lineno=759, col_offset=51, end_lineno=759, end_col_offset=53)], lineno=759, col_offset=12, end_lineno=759, end_col_offset=54), generators=[comprehension(target=Name(id='finding', ctx=Store(), lineno=759, col_offset=59, end_lineno=759, end_col_offset=66), iter=Name(id='findings', ctx=Load(), lineno=759, col_offset=70, end_lineno=759, end_col_offset=78), is_async=0)], lineno=759, col_offset=11, end_lineno=759, end_col_offset=79), lineno=759, col_offset=4, end_lineno=759, end_col_offset=79), Assert(test=Compare(left=Constant(value='src/main.py', lineno=760, col_offset=11, end_lineno=760, end_col_offset=24), ops=[In()], comparators=[Name(id='uris', ctx=Load(), lineno=760, col_offset=28, end_lineno=760, end_col_offset=32)], lineno=760, col_offset=11, end_lineno=760, end_col_offset=32), lineno=760, col_offset=4, end_lineno=760, end_col_offset=32), Assert(test=Compare(left=Constant(value='src/app.ts', lineno=761, col_offset=11, end_lineno=761, end_col_offset=23), ops=[In()], comparators=[Name(id='uris', ctx=Load(), lineno=761, col_offset=27, end_lineno=761, end_col_offset=31)], lineno=761, col_offset=11, end_lineno=761, end_col_offset=31), lineno=761, col_offset=4, end_lineno=761, end_col_offset=31)], decorator_list=[Attribute(value=Attribute(value=Name(id='pytest', ctx=Load(), lineno=708, col_offset=1, end_lineno=708, end_col_offset=7), attr='mark', ctx=Load(), lineno=708, col_offset=1, end_lineno=708, end_col_offset=12), attr='asyncio', ctx=Load(), lineno=708, col_offset=1, end_lineno=708, end_col_offset=20)], returns=Constant(value=None, lineno=709, col_offset=45, end_lineno=709, end_col_offset=49), lineno=709, col_offset=0, end_lineno=761, end_col_offset=31), AsyncFunctionDef(name='test_semantic_search_hybrid_merges_channels', args=arguments(), body=[ClassDef(name='_HybridStub', body=[FunctionDef(name='search', args=arguments(args=[arg(arg='self', lineno=771, col_offset=12, end_lineno=771, end_col_offset=16), arg(arg='query', annotation=Name(id='str', ctx=Load(), lineno=772, col_offset=19, end_lineno=772, end_col_offset=22), lineno=772, col_offset=12, end_lineno=772, end_col_offset=22)], kwonlyargs=[arg(arg='semantic_hits', annotation=Subscript(value=Name(id='Sequence', ctx=Load(), lineno=774, col_offset=27, end_lineno=774, end_col_offset=35), slice=Subscript(value=Name(id='tuple', ctx=Load(), lineno=774, col_offset=36, end_lineno=774, end_col_offset=41), slice=Tuple(elts=[Name(id='int', ctx=Load(), lineno=774, col_offset=42, end_lineno=774, end_col_offset=45), Name(id='float', ctx=Load(), lineno=774, col_offset=47, end_lineno=774, end_col_offset=52)], ctx=Load(), lineno=774, col_offset=42, end_lineno=774, end_col_offset=52), ctx=Load(), lineno=774, col_offset=36, end_lineno=774, end_col_offset=53), ctx=Load(), lineno=774, col_offset=27, end_lineno=774, end_col_offset=54), lineno=774, col_offset=12, end_lineno=774, end_col_offset=54), arg(arg='limit', annotation=Name(id='int', ctx=Load(), lineno=775, col_offset=19, end_lineno=775, end_col_offset=22), lineno=775, col_offset=12, end_lineno=775, end_col_offset=22)], kw_defaults=[None, None]), body=[Delete(targets=[Name(id='query', ctx=Del(), lineno=777, col_offset=16, end_lineno=777, end_col_offset=21), Name(id='semantic_hits', ctx=Del(), lineno=777, col_offset=23, end_lineno=777, end_col_offset=36), Name(id='limit', ctx=Del(), lineno=777, col_offset=38, end_lineno=777, end_col_offset=43)], lineno=777, col_offset=12, end_lineno=777, end_col_offset=43), Assign(targets=[Name(id='docs', ctx=Store(), lineno=778, col_offset=12, end_lineno=778, end_col_offset=16)], value=List(elts=[Call(func=Name(id='SimpleNamespace', ctx=Load(), lineno=779, col_offset=16, end_lineno=779, end_col_offset=31), keywords=[keyword(arg='doc_id', value=Constant(value='101', lineno=779, col_offset=39, end_lineno=779, end_col_offset=44), lineno=779, col_offset=32, end_lineno=779, end_col_offset=44), keyword(arg='score', value=Constant(value=0.42, lineno=779, col_offset=52, end_lineno=779, end_col_offset=56), lineno=779, col_offset=46, end_lineno=779, end_col_offset=56)], lineno=779, col_offset=16, end_lineno=779, end_col_offset=57), Call(func=Name(id='SimpleNamespace', ctx=Load(), lineno=780, col_offset=16, end_lineno=780, end_col_offset=31), keywords=[keyword(arg='doc_id', value=Constant(value='102', lineno=780, col_offset=39, end_lineno=780, end_col_offset=44), lineno=780, col_offset=32, end_lineno=780, end_col_offset=44), keyword(arg='score', value=Constant(value=0.35, lineno=780, col_offset=52, end_lineno=780, end_col_offset=56), lineno=780, col_offset=46, end_lineno=780, end_col_offset=56)], lineno=780, col_offset=16, end_lineno=780, end_col_offset=57)], ctx=Load(), lineno=778, col_offset=19, end_lineno=781, end_col_offset=13), lineno=778, col_offset=12, end_lineno=781, end_col_offset=13), Assign(targets=[Name(id='contributions', ctx=Store(), lineno=782, col_offset=12, end_lineno=782, end_col_offset=25)], value=Dict(keys=[Constant(value='101', lineno=783, col_offset=16, end_lineno=783, end_col_offset=21), Constant(value='102', lineno=784, col_offset=16, end_lineno=784, end_col_offset=21)], values=[List(elts=[Tuple(elts=[Constant(value='semantic', lineno=783, col_offset=25, end_lineno=783, end_col_offset=35), Constant(value=1, lineno=783, col_offset=37, end_lineno=783, end_col_offset=38), Constant(value=0.1, lineno=783, col_offset=40, end_lineno=783, end_col_offset=43)], ctx=Load(), lineno=783, col_offset=24, end_lineno=783, end_col_offset=44), Tuple(elts=[Constant(value='bm25', lineno=783, col_offset=47, end_lineno=783, end_col_offset=53), Constant(value=2, lineno=783, col_offset=55, end_lineno=783, end_col_offset=56), Constant(value=8.5, lineno=783, col_offset=58, end_lineno=783, end_col_offset=61)], ctx=Load(), lineno=783, col_offset=46, end_lineno=783, end_col_offset=62)], ctx=Load(), lineno=783, col_offset=23, end_lineno=783, end_col_offset=63), List(elts=[Tuple(elts=[Constant(value='splade', lineno=784, col_offset=25, end_lineno=784, end_col_offset=33), Constant(value=1, lineno=784, col_offset=35, end_lineno=784, end_col_offset=36), Constant(value=12.0, lineno=784, col_offset=38, end_lineno=784, end_col_offset=42)], ctx=Load(), lineno=784, col_offset=24, end_lineno=784, end_col_offset=43)], ctx=Load(), lineno=784, col_offset=23, end_lineno=784, end_col_offset=44)], lineno=782, col_offset=28, end_lineno=785, end_col_offset=13), lineno=782, col_offset=12, end_lineno=785, end_col_offset=13), Return(value=Call(func=Name(id='SimpleNamespace', ctx=Load(), lineno=786, col_offset=19, end_lineno=786, end_col_offset=34), keywords=[keyword(arg='docs', value=Name(id='docs', ctx=Load(), lineno=787, col_offset=21, end_lineno=787, end_col_offset=25), lineno=787, col_offset=16, end_lineno=787, end_col_offset=25), keyword(arg='contributions', value=Name(id='contributions', ctx=Load(), lineno=788, col_offset=30, end_lineno=788, end_col_offset=43), lineno=788, col_offset=16, end_lineno=788, end_col_offset=43), keyword(arg='channels', value=List(elts=[Constant(value='semantic', lineno=789, col_offset=26, end_lineno=789, end_col_offset=36), Constant(value='bm25', lineno=789, col_offset=38, end_lineno=789, end_col_offset=44), Constant(value='splade', lineno=789, col_offset=46, end_lineno=789, end_col_offset=54)], ctx=Load(), lineno=789, col_offset=25, end_lineno=789, end_col_offset=55), lineno=789, col_offset=16, end_lineno=789, end_col_offset=55), keyword(arg='warnings', value=List(elts=[Constant(value='bm25 warmed up', lineno=790, col_offset=26, end_lineno=790, end_col_offset=42)], ctx=Load(), lineno=790, col_offset=25, end_lineno=790, end_col_offset=43), lineno=790, col_offset=16, end_lineno=790, end_col_offset=43)], lineno=786, col_offset=19, end_lineno=791, end_col_offset=13), lineno=786, col_offset=12, end_lineno=791, end_col_offset=13)], returns=Name(id='SimpleNamespace', ctx=Load(), lineno=776, col_offset=13, end_lineno=776, end_col_offset=28), lineno=770, col_offset=8, end_lineno=791, end_col_offset=13)], lineno=769, col_offset=4, end_lineno=791, end_col_offset=13), Assign(targets=[Name(id='faiss_manager', ctx=Store(), lineno=793, col_offset=4, end_lineno=793, end_col_offset=17)], value=Call(func=Name(id='_BaseStubFAISSManager', ctx=Load(), lineno=793, col_offset=20, end_lineno=793, end_col_offset=41), keywords=[keyword(arg='should_fail_gpu', value=Constant(value=False, lineno=793, col_offset=58, end_lineno=793, end_col_offset=63), lineno=793, col_offset=42, end_lineno=793, end_col_offset=63), keyword(arg='search_ids', value=List(elts=[Constant(value=101, lineno=793, col_offset=77, end_lineno=793, end_col_offset=80), Constant(value=102, lineno=793, col_offset=82, end_lineno=793, end_col_offset=85)], ctx=Load(), lineno=793, col_offset=76, end_lineno=793, end_col_offset=86), lineno=793, col_offset=65, end_lineno=793, end_col_offset=86)], lineno=793, col_offset=20, end_lineno=793, end_col_offset=87), lineno=793, col_offset=4, end_lineno=793, end_col_offset=87), Assign(targets=[Name(id='chunks', ctx=Store(), lineno=794, col_offset=4, end_lineno=794, end_col_offset=10)], value=List(elts=[Dict(keys=[Constant(value='id', lineno=795, col_offset=9, end_lineno=795, end_col_offset=13), Constant(value='uri', lineno=795, col_offset=20, end_lineno=795, end_col_offset=25), Constant(value='start_line', lineno=795, col_offset=39, end_lineno=795, end_col_offset=51), Constant(value='end_line', lineno=795, col_offset=56, end_lineno=795, end_col_offset=66), Constant(value='preview', lineno=795, col_offset=71, end_lineno=795, end_col_offset=80)], values=[Constant(value=101, lineno=795, col_offset=15, end_lineno=795, end_col_offset=18), Constant(value='src/a.py', lineno=795, col_offset=27, end_lineno=795, end_col_offset=37), Constant(value=0, lineno=795, col_offset=53, end_lineno=795, end_col_offset=54), Constant(value=2, lineno=795, col_offset=68, end_lineno=795, end_col_offset=69), Constant(value='a', lineno=795, col_offset=82, end_lineno=795, end_col_offset=85)], lineno=795, col_offset=8, end_lineno=795, end_col_offset=86), Dict(keys=[Constant(value='id', lineno=796, col_offset=9, end_lineno=796, end_col_offset=13), Constant(value='uri', lineno=796, col_offset=20, end_lineno=796, end_col_offset=25), Constant(value='start_line', lineno=796, col_offset=39, end_lineno=796, end_col_offset=51), Constant(value='end_line', lineno=796, col_offset=56, end_lineno=796, end_col_offset=66), Constant(value='preview', lineno=796, col_offset=71, end_lineno=796, end_col_offset=80)], values=[Constant(value=102, lineno=796, col_offset=15, end_lineno=796, end_col_offset=18), Constant(value='src/b.py', lineno=796, col_offset=27, end_lineno=796, end_col_offset=37), Constant(value=5, lineno=796, col_offset=53, end_lineno=796, end_col_offset=54), Constant(value=9, lineno=796, col_offset=68, end_lineno=796, end_col_offset=69), Constant(value='b', lineno=796, col_offset=82, end_lineno=796, end_col_offset=85)], lineno=796, col_offset=8, end_lineno=796, end_col_offset=86)], ctx=Load(), lineno=794, col_offset=13, end_lineno=797, end_col_offset=5), lineno=794, col_offset=4, end_lineno=797, end_col_offset=5), Assign(targets=[Name(id='context', ctx=Store(), lineno=798, col_offset=4, end_lineno=798, end_col_offset=11)], value=Call(func=Name(id='StubContext', ctx=Load(), lineno=798, col_offset=14, end_lineno=798, end_col_offset=25), keywords=[keyword(arg='faiss_manager', value=Name(id='faiss_manager', ctx=Load(), lineno=799, col_offset=22, end_lineno=799, end_col_offset=35), lineno=799, col_offset=8, end_lineno=799, end_col_offset=35), keyword(arg='config', value=Call(func=Name(id='StubContextConfig', ctx=Load(), lineno=800, col_offset=15, end_lineno=800, end_col_offset=32), keywords=[keyword(arg='limits', value=List(ctx=Load(), lineno=801, col_offset=19, end_lineno=801, end_col_offset=21), lineno=801, col_offset=12, end_lineno=801, end_col_offset=21), keyword(arg='error', value=Constant(value=None, lineno=802, col_offset=18, end_lineno=802, end_col_offset=22), lineno=802, col_offset=12, end_lineno=802, end_col_offset=22), keyword(arg='catalog_chunks', value=Name(id='chunks', ctx=Load(), lineno=803, col_offset=27, end_lineno=803, end_col_offset=33), lineno=803, col_offset=12, end_lineno=803, end_col_offset=33), keyword(arg='hybrid_engine', value=Call(func=Name(id='_HybridStub', ctx=Load(), lineno=804, col_offset=26, end_lineno=804, end_col_offset=37), lineno=804, col_offset=26, end_lineno=804, end_col_offset=39), lineno=804, col_offset=12, end_lineno=804, end_col_offset=39)], lineno=800, col_offset=15, end_lineno=805, end_col_offset=9), lineno=800, col_offset=8, end_lineno=805, end_col_offset=9)], lineno=798, col_offset=14, end_lineno=806, end_col_offset=5), lineno=798, col_offset=4, end_lineno=806, end_col_offset=5), With(items=[withitem(context_expr=Call(func=Name(id='patch', ctx=Load(), lineno=809, col_offset=8, end_lineno=809, end_col_offset=13), args=[Constant(value='codeintel_rev.mcp_server.adapters.semantic.get_session_id', lineno=810, col_offset=12, end_lineno=810, end_col_offset=71)], keywords=[keyword(arg='return_value', value=Constant(value='hybrid-session', lineno=811, col_offset=25, end_lineno=811, end_col_offset=41), lineno=811, col_offset=12, end_lineno=811, end_col_offset=41)], lineno=809, col_offset=8, end_lineno=812, end_col_offset=9)), withitem(context_expr=Call(func=Name(id='patch', ctx=Load(), lineno=813, col_offset=8, end_lineno=813, end_col_offset=13), args=[Constant(value='codeintel_rev.mcp_server.adapters.semantic.get_effective_scope', lineno=814, col_offset=12, end_lineno=814, end_col_offset=76)], keywords=[keyword(arg='return_value', value=Constant(value=None, lineno=815, col_offset=25, end_lineno=815, end_col_offset=29), lineno=815, col_offset=12, end_lineno=815, end_col_offset=29)], lineno=813, col_offset=8, end_lineno=816, end_col_offset=9))], body=[Assign(targets=[Name(id='result', ctx=Store(), lineno=818, col_offset=8, end_lineno=818, end_col_offset=14)], value=Await(value=Call(func=Name(id='semantic_search', ctx=Load(), lineno=818, col_offset=23, end_lineno=818, end_col_offset=38), args=[Call(func=Name(id='cast', ctx=Load(), lineno=818, col_offset=39, end_lineno=818, end_col_offset=43), args=[Constant(value='ApplicationContext', lineno=818, col_offset=44, end_lineno=818, end_col_offset=64), Name(id='context', ctx=Load(), lineno=818, col_offset=66, end_lineno=818, end_col_offset=73)], lineno=818, col_offset=39, end_lineno=818, end_col_offset=74), Constant(value='hybrid query', lineno=818, col_offset=76, end_lineno=818, end_col_offset=90)], keywords=[keyword(arg='limit', value=Constant(value=2, lineno=818, col_offset=98, end_lineno=818, end_col_offset=99), lineno=818, col_offset=92, end_lineno=818, end_col_offset=99)], lineno=818, col_offset=23, end_lineno=818, end_col_offset=100), lineno=818, col_offset=17, end_lineno=818, end_col_offset=100), lineno=818, col_offset=8, end_lineno=818, end_col_offset=100)], lineno=808, col_offset=4, end_lineno=818, end_col_offset=100), Assign(targets=[Name(id='answer', ctx=Store(), lineno=820, col_offset=4, end_lineno=820, end_col_offset=10)], value=Call(func=Attribute(value=Name(id='result', ctx=Load(), lineno=820, col_offset=13, end_lineno=820, end_col_offset=19), attr='get', ctx=Load(), lineno=820, col_offset=13, end_lineno=820, end_col_offset=23), args=[Constant(value='answer', lineno=820, col_offset=24, end_lineno=820, end_col_offset=32)], lineno=820, col_offset=13, end_lineno=820, end_col_offset=33), lineno=820, col_offset=4, end_lineno=820, end_col_offset=33), Assert(test=Compare(left=Name(id='answer', ctx=Load(), lineno=821, col_offset=11, end_lineno=821, end_col_offset=17), ops=[IsNot()], comparators=[Constant(value=None, lineno=821, col_offset=25, end_lineno=821, end_col_offset=29)], lineno=821, col_offset=11, end_lineno=821, end_col_offset=29), lineno=821, col_offset=4, end_lineno=821, end_col_offset=29), Assert(test=Call(func=Attribute(value=Name(id='answer', ctx=Load(), lineno=822, col_offset=11, end_lineno=822, end_col_offset=17), attr='startswith', ctx=Load(), lineno=822, col_offset=11, end_lineno=822, end_col_offset=28), args=[Constant(value='Found 2 hybrid', lineno=822, col_offset=29, end_lineno=822, end_col_offset=45)], lineno=822, col_offset=11, end_lineno=822, end_col_offset=46), lineno=822, col_offset=4, end_lineno=822, end_col_offset=46), Assign(targets=[Name(id='limits', ctx=Store(), lineno=823, col_offset=4, end_lineno=823, end_col_offset=10)], value=Call(func=Attribute(value=Name(id='result', ctx=Load(), lineno=823, col_offset=13, end_lineno=823, end_col_offset=19), attr='get', ctx=Load(), lineno=823, col_offset=13, end_lineno=823, end_col_offset=23), args=[Constant(value='limits', lineno=823, col_offset=24, end_lineno=823, end_col_offset=32)], lineno=823, col_offset=13, end_lineno=823, end_col_offset=33), lineno=823, col_offset=4, end_lineno=823, end_col_offset=33), Assert(test=Compare(left=Name(id='limits', ctx=Load(), lineno=824, col_offset=11, end_lineno=824, end_col_offset=17), ops=[IsNot()], comparators=[Constant(value=None, lineno=824, col_offset=25, end_lineno=824, end_col_offset=29)], lineno=824, col_offset=11, end_lineno=824, end_col_offset=29), lineno=824, col_offset=4, end_lineno=824, end_col_offset=29), Assert(test=Compare(left=Constant(value='bm25 warmed up', lineno=825, col_offset=11, end_lineno=825, end_col_offset=27), ops=[In()], comparators=[Name(id='limits', ctx=Load(), lineno=825, col_offset=31, end_lineno=825, end_col_offset=37)], lineno=825, col_offset=11, end_lineno=825, end_col_offset=37), lineno=825, col_offset=4, end_lineno=825, end_col_offset=37), Assign(targets=[Name(id='findings', ctx=Store(), lineno=826, col_offset=4, end_lineno=826, end_col_offset=12)], value=Call(func=Attribute(value=Name(id='result', ctx=Load(), lineno=826, col_offset=15, end_lineno=826, end_col_offset=21), attr='get', ctx=Load(), lineno=826, col_offset=15, end_lineno=826, end_col_offset=25), args=[Constant(value='findings', lineno=826, col_offset=26, end_lineno=826, end_col_offset=36)], lineno=826, col_offset=15, end_lineno=826, end_col_offset=37), lineno=826, col_offset=4, end_lineno=826, end_col_offset=37), Assert(test=Compare(left=Name(id='findings', ctx=Load(), lineno=827, col_offset=11, end_lineno=827, end_col_offset=19), ops=[IsNot()], comparators=[Constant(value=None, lineno=827, col_offset=27, end_lineno=827, end_col_offset=31)], lineno=827, col_offset=11, end_lineno=827, end_col_offset=31), lineno=827, col_offset=4, end_lineno=827, end_col_offset=31), Assert(test=Compare(left=Call(func=Attribute(value=Subscript(value=Name(id='findings', ctx=Load(), lineno=828, col_offset=11, end_lineno=828, end_col_offset=19), slice=Constant(value=0, lineno=828, col_offset=20, end_lineno=828, end_col_offset=21), ctx=Load(), lineno=828, col_offset=11, end_lineno=828, end_col_offset=22), attr='get', ctx=Load(), lineno=828, col_offset=11, end_lineno=828, end_col_offset=26), args=[Constant(value='chunk_id', lineno=828, col_offset=27, end_lineno=828, end_col_offset=37)], lineno=828, col_offset=11, end_lineno=828, end_col_offset=38), ops=[Eq()], comparators=[Constant(value=101, lineno=828, col_offset=42, end_lineno=828, end_col_offset=45)], lineno=828, col_offset=11, end_lineno=828, end_col_offset=45), lineno=828, col_offset=4, end_lineno=828, end_col_offset=45), Assign(targets=[Name(id='why_message', ctx=Store(), lineno=829, col_offset=4, end_lineno=829, end_col_offset=15)], value=Call(func=Attribute(value=Subscript(value=Name(id='findings', ctx=Load(), lineno=829, col_offset=18, end_lineno=829, end_col_offset=26), slice=Constant(value=0, lineno=829, col_offset=27, end_lineno=829, end_col_offset=28), ctx=Load(), lineno=829, col_offset=18, end_lineno=829, end_col_offset=29), attr='get', ctx=Load(), lineno=829, col_offset=18, end_lineno=829, end_col_offset=33), args=[Constant(value='why', lineno=829, col_offset=34, end_lineno=829, end_col_offset=39)], lineno=829, col_offset=18, end_lineno=829, end_col_offset=40), lineno=829, col_offset=4, end_lineno=829, end_col_offset=40), Assert(test=Compare(left=Name(id='why_message', ctx=Load(), lineno=830, col_offset=11, end_lineno=830, end_col_offset=22), ops=[IsNot()], comparators=[Constant(value=None, lineno=830, col_offset=30, end_lineno=830, end_col_offset=34)], lineno=830, col_offset=11, end_lineno=830, end_col_offset=34), lineno=830, col_offset=4, end_lineno=830, end_col_offset=34), Assert(test=Compare(left=Constant(value='Hybrid RRF', lineno=831, col_offset=11, end_lineno=831, end_col_offset=23), ops=[In()], comparators=[Name(id='why_message', ctx=Load(), lineno=831, col_offset=27, end_lineno=831, end_col_offset=38)], lineno=831, col_offset=11, end_lineno=831, end_col_offset=38), lineno=831, col_offset=4, end_lineno=831, end_col_offset=38), Assert(test=Compare(left=Constant(value='bm25', lineno=832, col_offset=11, end_lineno=832, end_col_offset=17), ops=[In()], comparators=[Name(id='why_message', ctx=Load(), lineno=832, col_offset=21, end_lineno=832, end_col_offset=32)], lineno=832, col_offset=11, end_lineno=832, end_col_offset=32), lineno=832, col_offset=4, end_lineno=832, end_col_offset=32), Assign(targets=[Name(id='method', ctx=Store(), lineno=833, col_offset=4, end_lineno=833, end_col_offset=10)], value=Call(func=Attribute(value=Name(id='result', ctx=Load(), lineno=833, col_offset=13, end_lineno=833, end_col_offset=19), attr='get', ctx=Load(), lineno=833, col_offset=13, end_lineno=833, end_col_offset=23), args=[Constant(value='method', lineno=833, col_offset=24, end_lineno=833, end_col_offset=32)], lineno=833, col_offset=13, end_lineno=833, end_col_offset=33), lineno=833, col_offset=4, end_lineno=833, end_col_offset=33), Assert(test=Compare(left=Name(id='method', ctx=Load(), lineno=834, col_offset=11, end_lineno=834, end_col_offset=17), ops=[IsNot()], comparators=[Constant(value=None, lineno=834, col_offset=25, end_lineno=834, end_col_offset=29)], lineno=834, col_offset=11, end_lineno=834, end_col_offset=29), lineno=834, col_offset=4, end_lineno=834, end_col_offset=29), Assign(targets=[Name(id='retrieval', ctx=Store(), lineno=835, col_offset=4, end_lineno=835, end_col_offset=13)], value=Call(func=Attribute(value=Name(id='method', ctx=Load(), lineno=835, col_offset=16, end_lineno=835, end_col_offset=22), attr='get', ctx=Load(), lineno=835, col_offset=16, end_lineno=835, end_col_offset=26), args=[Constant(value='retrieval', lineno=835, col_offset=27, end_lineno=835, end_col_offset=38)], lineno=835, col_offset=16, end_lineno=835, end_col_offset=39), lineno=835, col_offset=4, end_lineno=835, end_col_offset=39), Assert(test=Compare(left=Name(id='retrieval', ctx=Load(), lineno=836, col_offset=11, end_lineno=836, end_col_offset=20), ops=[IsNot()], comparators=[Constant(value=None, lineno=836, col_offset=28, end_lineno=836, end_col_offset=32)], lineno=836, col_offset=11, end_lineno=836, end_col_offset=32), lineno=836, col_offset=4, end_lineno=836, end_col_offset=32), Assign(targets=[Name(id='retrieval_set', ctx=Store(), lineno=837, col_offset=4, end_lineno=837, end_col_offset=17)], value=Call(func=Name(id='set', ctx=Load(), lineno=837, col_offset=20, end_lineno=837, end_col_offset=23), args=[Name(id='retrieval', ctx=Load(), lineno=837, col_offset=24, end_lineno=837, end_col_offset=33)], lineno=837, col_offset=20, end_lineno=837, end_col_offset=34), lineno=837, col_offset=4, end_lineno=837, end_col_offset=34), Assign(targets=[Name(id='missing_channels', ctx=Store(), lineno=838, col_offset=4, end_lineno=838, end_col_offset=20)], value=BinOp(left=Set(elts=[Constant(value='semantic', lineno=838, col_offset=24, end_lineno=838, end_col_offset=34), Constant(value='faiss', lineno=838, col_offset=36, end_lineno=838, end_col_offset=43), Constant(value='bm25', lineno=838, col_offset=45, end_lineno=838, end_col_offset=51), Constant(value='splade', lineno=838, col_offset=53, end_lineno=838, end_col_offset=61)], lineno=838, col_offset=23, end_lineno=838, end_col_offset=62), op=Sub(), right=Name(id='retrieval_set', ctx=Load(), lineno=838, col_offset=65, end_lineno=838, end_col_offset=78), lineno=838, col_offset=23, end_lineno=838, end_col_offset=78), lineno=838, col_offset=4, end_lineno=838, end_col_offset=78), Assert(test=UnaryOp(op=Not(), operand=Name(id='missing_channels', ctx=Load(), lineno=839, col_offset=15, end_lineno=839, end_col_offset=31), lineno=839, col_offset=11, end_lineno=839, end_col_offset=31), lineno=839, col_offset=4, end_lineno=839, end_col_offset=31)], decorator_list=[Attribute(value=Attribute(value=Name(id='pytest', ctx=Load(), lineno=767, col_offset=1, end_lineno=767, end_col_offset=7), attr='mark', ctx=Load(), lineno=767, col_offset=1, end_lineno=767, end_col_offset=12), attr='asyncio', ctx=Load(), lineno=767, col_offset=1, end_lineno=767, end_col_offset=20)], returns=Constant(value=None, lineno=768, col_offset=59, end_lineno=768, end_col_offset=63), lineno=768, col_offset=0, end_lineno=839, end_col_offset=31), AsyncFunctionDef(name='test_semantic_search_faiss_not_ready', args=arguments(), body=[Expr(value=Constant(value='Test semantic_search raises VectorSearchError when FAISS is not ready.', lineno=846, col_offset=4, end_lineno=846, end_col_offset=80), lineno=846, col_offset=4, end_lineno=846, end_col_offset=80), Assign(targets=[Name(id='faiss_manager', ctx=Store(), lineno=847, col_offset=4, end_lineno=847, end_col_offset=17)], value=Call(func=Name(id='_BaseStubFAISSManager', ctx=Load(), lineno=847, col_offset=20, end_lineno=847, end_col_offset=41), keywords=[keyword(arg='should_fail_gpu', value=Constant(value=False, lineno=847, col_offset=58, end_lineno=847, end_col_offset=63), lineno=847, col_offset=42, end_lineno=847, end_col_offset=63)], lineno=847, col_offset=20, end_lineno=847, end_col_offset=64), lineno=847, col_offset=4, end_lineno=847, end_col_offset=64), Assign(targets=[Name(id='context', ctx=Store(), lineno=848, col_offset=4, end_lineno=848, end_col_offset=11)], value=Call(func=Name(id='StubContext', ctx=Load(), lineno=848, col_offset=14, end_lineno=848, end_col_offset=25), keywords=[keyword(arg='faiss_manager', value=Name(id='faiss_manager', ctx=Load(), lineno=849, col_offset=22, end_lineno=849, end_col_offset=35), lineno=849, col_offset=8, end_lineno=849, end_col_offset=35), keyword(arg='config', value=Call(func=Name(id='StubContextConfig', ctx=Load(), lineno=850, col_offset=15, end_lineno=850, end_col_offset=32), keywords=[keyword(arg='limits', value=List(ctx=Load(), lineno=850, col_offset=40, end_lineno=850, end_col_offset=42), lineno=850, col_offset=33, end_lineno=850, end_col_offset=42), keyword(arg='error', value=Constant(value='Index not built', lineno=850, col_offset=50, end_lineno=850, end_col_offset=67), lineno=850, col_offset=44, end_lineno=850, end_col_offset=67), keyword(arg='catalog_chunks', value=Constant(value=None, lineno=850, col_offset=84, end_lineno=850, end_col_offset=88), lineno=850, col_offset=69, end_lineno=850, end_col_offset=88)], lineno=850, col_offset=15, end_lineno=850, end_col_offset=89), lineno=850, col_offset=8, end_lineno=850, end_col_offset=89)], lineno=848, col_offset=14, end_lineno=851, end_col_offset=5), lineno=848, col_offset=4, end_lineno=851, end_col_offset=5), With(items=[withitem(context_expr=Call(func=Name(id='patch', ctx=Load(), lineno=854, col_offset=8, end_lineno=854, end_col_offset=13), args=[Constant(value='codeintel_rev.mcp_server.adapters.semantic.get_session_id', lineno=855, col_offset=12, end_lineno=855, end_col_offset=71)], keywords=[keyword(arg='return_value', value=Constant(value='test-session-error', lineno=856, col_offset=25, end_lineno=856, end_col_offset=45), lineno=856, col_offset=12, end_lineno=856, end_col_offset=45)], lineno=854, col_offset=8, end_lineno=857, end_col_offset=9)), withitem(context_expr=Call(func=Name(id='patch', ctx=Load(), lineno=858, col_offset=8, end_lineno=858, end_col_offset=13), args=[Constant(value='codeintel_rev.mcp_server.adapters.semantic.get_effective_scope', lineno=859, col_offset=12, end_lineno=859, end_col_offset=76)], keywords=[keyword(arg='return_value', value=Constant(value=None, lineno=860, col_offset=25, end_lineno=860, end_col_offset=29), lineno=860, col_offset=12, end_lineno=860, end_col_offset=29)], lineno=858, col_offset=8, end_lineno=861, end_col_offset=9)), withitem(context_expr=Call(func=Attribute(value=Name(id='pytest', ctx=Load(), lineno=862, col_offset=8, end_lineno=862, end_col_offset=14), attr='raises', ctx=Load(), lineno=862, col_offset=8, end_lineno=862, end_col_offset=21), args=[Name(id='VectorSearchError', ctx=Load(), lineno=862, col_offset=22, end_lineno=862, end_col_offset=39)], keywords=[keyword(arg='match', value=Constant(value='Index not built', lineno=862, col_offset=47, end_lineno=862, end_col_offset=64), lineno=862, col_offset=41, end_lineno=862, end_col_offset=64)], lineno=862, col_offset=8, end_lineno=862, end_col_offset=65))], body=[Expr(value=Await(value=Call(func=Name(id='semantic_search', ctx=Load(), lineno=864, col_offset=14, end_lineno=864, end_col_offset=29), args=[Call(func=Name(id='cast', ctx=Load(), lineno=864, col_offset=30, end_lineno=864, end_col_offset=34), args=[Constant(value='ApplicationContext', lineno=864, col_offset=35, end_lineno=864, end_col_offset=55), Name(id='context', ctx=Load(), lineno=864, col_offset=57, end_lineno=864, end_col_offset=64)], lineno=864, col_offset=30, end_lineno=864, end_col_offset=65), Constant(value='query', lineno=864, col_offset=67, end_lineno=864, end_col_offset=74)], keywords=[keyword(arg='limit', value=Constant(value=10, lineno=864, col_offset=82, end_lineno=864, end_col_offset=84), lineno=864, col_offset=76, end_lineno=864, end_col_offset=84)], lineno=864, col_offset=14, end_lineno=864, end_col_offset=85), lineno=864, col_offset=8, end_lineno=864, end_col_offset=85), lineno=864, col_offset=8, end_lineno=864, end_col_offset=85)], lineno=853, col_offset=4, end_lineno=864, end_col_offset=85)], returns=Constant(value=None, lineno=845, col_offset=52, end_lineno=845, end_col_offset=56), lineno=845, col_offset=0, end_lineno=864, end_col_offset=85), AsyncFunctionDef(name='test_semantic_search_embedding_error', args=arguments(), body=[Expr(value=Constant(value='Test semantic_search raises EmbeddingError when embedding fails.', lineno=868, col_offset=4, end_lineno=868, end_col_offset=74), lineno=868, col_offset=4, end_lineno=868, end_col_offset=74), Assign(targets=[Name(id='faiss_manager', ctx=Store(), lineno=869, col_offset=4, end_lineno=869, end_col_offset=17)], value=Call(func=Name(id='_BaseStubFAISSManager', ctx=Load(), lineno=869, col_offset=20, end_lineno=869, end_col_offset=41), keywords=[keyword(arg='should_fail_gpu', value=Constant(value=False, lineno=869, col_offset=58, end_lineno=869, end_col_offset=63), lineno=869, col_offset=42, end_lineno=869, end_col_offset=63)], lineno=869, col_offset=20, end_lineno=869, end_col_offset=64), lineno=869, col_offset=4, end_lineno=869, end_col_offset=64), Assign(targets=[Name(id='context', ctx=Store(), lineno=870, col_offset=4, end_lineno=870, end_col_offset=11)], value=Call(func=Name(id='StubContext', ctx=Load(), lineno=870, col_offset=14, end_lineno=870, end_col_offset=25), keywords=[keyword(arg='faiss_manager', value=Name(id='faiss_manager', ctx=Load(), lineno=871, col_offset=22, end_lineno=871, end_col_offset=35), lineno=871, col_offset=8, end_lineno=871, end_col_offset=35), keyword(arg='config', value=Call(func=Name(id='StubContextConfig', ctx=Load(), lineno=872, col_offset=15, end_lineno=872, end_col_offset=32), keywords=[keyword(arg='limits', value=List(ctx=Load(), lineno=872, col_offset=40, end_lineno=872, end_col_offset=42), lineno=872, col_offset=33, end_lineno=872, end_col_offset=42), keyword(arg='error', value=Constant(value=None, lineno=872, col_offset=50, end_lineno=872, end_col_offset=54), lineno=872, col_offset=44, end_lineno=872, end_col_offset=54), keyword(arg='catalog_chunks', value=Constant(value=None, lineno=872, col_offset=71, end_lineno=872, end_col_offset=75), lineno=872, col_offset=56, end_lineno=872, end_col_offset=75)], lineno=872, col_offset=15, end_lineno=872, end_col_offset=76), lineno=872, col_offset=8, end_lineno=872, end_col_offset=76)], lineno=870, col_offset=14, end_lineno=873, end_col_offset=5), lineno=870, col_offset=4, end_lineno=873, end_col_offset=5), With(items=[withitem(context_expr=Call(func=Name(id='patch', ctx=Load(), lineno=876, col_offset=8, end_lineno=876, end_col_offset=13), args=[Constant(value='codeintel_rev.mcp_server.adapters.semantic.get_session_id', lineno=877, col_offset=12, end_lineno=877, end_col_offset=71)], keywords=[keyword(arg='return_value', value=Constant(value='test-session-embedding-error', lineno=878, col_offset=25, end_lineno=878, end_col_offset=55), lineno=878, col_offset=12, end_lineno=878, end_col_offset=55)], lineno=876, col_offset=8, end_lineno=879, end_col_offset=9)), withitem(context_expr=Call(func=Name(id='patch', ctx=Load(), lineno=880, col_offset=8, end_lineno=880, end_col_offset=13), args=[Constant(value='codeintel_rev.mcp_server.adapters.semantic.get_effective_scope', lineno=881, col_offset=12, end_lineno=881, end_col_offset=76)], keywords=[keyword(arg='return_value', value=Constant(value=None, lineno=882, col_offset=25, end_lineno=882, end_col_offset=29), lineno=882, col_offset=12, end_lineno=882, end_col_offset=29)], lineno=880, col_offset=8, end_lineno=883, end_col_offset=9)), withitem(context_expr=Call(func=Attribute(value=Name(id='patch', ctx=Load(), lineno=884, col_offset=8, end_lineno=884, end_col_offset=13), attr='object', ctx=Load(), lineno=884, col_offset=8, end_lineno=884, end_col_offset=20), args=[Attribute(value=Name(id='context', ctx=Load(), lineno=885, col_offset=12, end_lineno=885, end_col_offset=19), attr='vllm_client', ctx=Load(), lineno=885, col_offset=12, end_lineno=885, end_col_offset=31), Constant(value='embed_single', lineno=886, col_offset=12, end_lineno=886, end_col_offset=26)], keywords=[keyword(arg='side_effect', value=Call(func=Name(id='RuntimeError', ctx=Load(), lineno=887, col_offset=24, end_lineno=887, end_col_offset=36), args=[Constant(value='vLLM service unavailable', lineno=887, col_offset=37, end_lineno=887, end_col_offset=63)], lineno=887, col_offset=24, end_lineno=887, end_col_offset=64), lineno=887, col_offset=12, end_lineno=887, end_col_offset=64)], lineno=884, col_offset=8, end_lineno=888, end_col_offset=9)), withitem(context_expr=Call(func=Attribute(value=Name(id='pytest', ctx=Load(), lineno=889, col_offset=8, end_lineno=889, end_col_offset=14), attr='raises', ctx=Load(), lineno=889, col_offset=8, end_lineno=889, end_col_offset=21), args=[Name(id='EmbeddingError', ctx=Load(), lineno=889, col_offset=22, end_lineno=889, end_col_offset=36)], keywords=[keyword(arg='match', value=Constant(value='vLLM service unavailable', lineno=889, col_offset=44, end_lineno=889, end_col_offset=70), lineno=889, col_offset=38, end_lineno=889, end_col_offset=70)], lineno=889, col_offset=8, end_lineno=889, end_col_offset=71))], body=[Expr(value=Await(value=Call(func=Name(id='semantic_search', ctx=Load(), lineno=891, col_offset=14, end_lineno=891, end_col_offset=29), args=[Call(func=Name(id='cast', ctx=Load(), lineno=891, col_offset=30, end_lineno=891, end_col_offset=34), args=[Constant(value='ApplicationContext', lineno=891, col_offset=35, end_lineno=891, end_col_offset=55), Name(id='context', ctx=Load(), lineno=891, col_offset=57, end_lineno=891, end_col_offset=64)], lineno=891, col_offset=30, end_lineno=891, end_col_offset=65), Constant(value='query', lineno=891, col_offset=67, end_lineno=891, end_col_offset=74)], keywords=[keyword(arg='limit', value=Constant(value=10, lineno=891, col_offset=82, end_lineno=891, end_col_offset=84), lineno=891, col_offset=76, end_lineno=891, end_col_offset=84)], lineno=891, col_offset=14, end_lineno=891, end_col_offset=85), lineno=891, col_offset=8, end_lineno=891, end_col_offset=85), lineno=891, col_offset=8, end_lineno=891, end_col_offset=85)], lineno=875, col_offset=4, end_lineno=891, end_col_offset=85)], returns=Constant(value=None, lineno=867, col_offset=52, end_lineno=867, end_col_offset=56), lineno=867, col_offset=0, end_lineno=891, end_col_offset=85), AsyncFunctionDef(name='test_semantic_search_faiss_search_error', args=arguments(), body=[Expr(value=Constant(value='Test semantic_search raises VectorSearchError when FAISS search fails.', lineno=895, col_offset=4, end_lineno=895, end_col_offset=80), lineno=895, col_offset=4, end_lineno=895, end_col_offset=80), Assign(targets=[Name(id='faiss_manager', ctx=Store(), lineno=896, col_offset=4, end_lineno=896, end_col_offset=17)], value=Call(func=Name(id='_BaseStubFAISSManager', ctx=Load(), lineno=896, col_offset=20, end_lineno=896, end_col_offset=41), keywords=[keyword(arg='should_fail_gpu', value=Constant(value=False, lineno=896, col_offset=58, end_lineno=896, end_col_offset=63), lineno=896, col_offset=42, end_lineno=896, end_col_offset=63)], lineno=896, col_offset=20, end_lineno=896, end_col_offset=64), lineno=896, col_offset=4, end_lineno=896, end_col_offset=64), Assign(targets=[Name(id='context', ctx=Store(), lineno=897, col_offset=4, end_lineno=897, end_col_offset=11)], value=Call(func=Name(id='StubContext', ctx=Load(), lineno=897, col_offset=14, end_lineno=897, end_col_offset=25), keywords=[keyword(arg='faiss_manager', value=Name(id='faiss_manager', ctx=Load(), lineno=898, col_offset=22, end_lineno=898, end_col_offset=35), lineno=898, col_offset=8, end_lineno=898, end_col_offset=35), keyword(arg='config', value=Call(func=Name(id='StubContextConfig', ctx=Load(), lineno=899, col_offset=15, end_lineno=899, end_col_offset=32), keywords=[keyword(arg='limits', value=List(ctx=Load(), lineno=899, col_offset=40, end_lineno=899, end_col_offset=42), lineno=899, col_offset=33, end_lineno=899, end_col_offset=42), keyword(arg='error', value=Constant(value=None, lineno=899, col_offset=50, end_lineno=899, end_col_offset=54), lineno=899, col_offset=44, end_lineno=899, end_col_offset=54), keyword(arg='catalog_chunks', value=Constant(value=None, lineno=899, col_offset=71, end_lineno=899, end_col_offset=75), lineno=899, col_offset=56, end_lineno=899, end_col_offset=75)], lineno=899, col_offset=15, end_lineno=899, end_col_offset=76), lineno=899, col_offset=8, end_lineno=899, end_col_offset=76)], lineno=897, col_offset=14, end_lineno=900, end_col_offset=5), lineno=897, col_offset=4, end_lineno=900, end_col_offset=5), With(items=[withitem(context_expr=Call(func=Name(id='patch', ctx=Load(), lineno=903, col_offset=8, end_lineno=903, end_col_offset=13), args=[Constant(value='codeintel_rev.mcp_server.adapters.semantic.get_session_id', lineno=904, col_offset=12, end_lineno=904, end_col_offset=71)], keywords=[keyword(arg='return_value', value=Constant(value='test-session-search-error', lineno=905, col_offset=25, end_lineno=905, end_col_offset=52), lineno=905, col_offset=12, end_lineno=905, end_col_offset=52)], lineno=903, col_offset=8, end_lineno=906, end_col_offset=9)), withitem(context_expr=Call(func=Name(id='patch', ctx=Load(), lineno=907, col_offset=8, end_lineno=907, end_col_offset=13), args=[Constant(value='codeintel_rev.mcp_server.adapters.semantic.get_effective_scope', lineno=908, col_offset=12, end_lineno=908, end_col_offset=76)], keywords=[keyword(arg='return_value', value=Constant(value=None, lineno=909, col_offset=25, end_lineno=909, end_col_offset=29), lineno=909, col_offset=12, end_lineno=909, end_col_offset=29)], lineno=907, col_offset=8, end_lineno=910, end_col_offset=9)), withitem(context_expr=Call(func=Attribute(value=Name(id='patch', ctx=Load(), lineno=911, col_offset=8, end_lineno=911, end_col_offset=13), attr='object', ctx=Load(), lineno=911, col_offset=8, end_lineno=911, end_col_offset=20), args=[Name(id='faiss_manager', ctx=Load(), lineno=912, col_offset=12, end_lineno=912, end_col_offset=25), Constant(value='search', lineno=913, col_offset=12, end_lineno=913, end_col_offset=20)], keywords=[keyword(arg='side_effect', value=Call(func=Name(id='RuntimeError', ctx=Load(), lineno=914, col_offset=24, end_lineno=914, end_col_offset=36), args=[Constant(value='FAISS search failed', lineno=914, col_offset=37, end_lineno=914, end_col_offset=58)], lineno=914, col_offset=24, end_lineno=914, end_col_offset=59), lineno=914, col_offset=12, end_lineno=914, end_col_offset=59)], lineno=911, col_offset=8, end_lineno=915, end_col_offset=9)), withitem(context_expr=Call(func=Attribute(value=Name(id='pytest', ctx=Load(), lineno=916, col_offset=8, end_lineno=916, end_col_offset=14), attr='raises', ctx=Load(), lineno=916, col_offset=8, end_lineno=916, end_col_offset=21), args=[Name(id='VectorSearchError', ctx=Load(), lineno=916, col_offset=22, end_lineno=916, end_col_offset=39)], keywords=[keyword(arg='match', value=Constant(value='FAISS search failed', lineno=916, col_offset=47, end_lineno=916, end_col_offset=68), lineno=916, col_offset=41, end_lineno=916, end_col_offset=68)], lineno=916, col_offset=8, end_lineno=916, end_col_offset=69))], body=[Expr(value=Await(value=Call(func=Name(id='semantic_search', ctx=Load(), lineno=918, col_offset=14, end_lineno=918, end_col_offset=29), args=[Call(func=Name(id='cast', ctx=Load(), lineno=918, col_offset=30, end_lineno=918, end_col_offset=34), args=[Constant(value='ApplicationContext', lineno=918, col_offset=35, end_lineno=918, end_col_offset=55), Name(id='context', ctx=Load(), lineno=918, col_offset=57, end_lineno=918, end_col_offset=64)], lineno=918, col_offset=30, end_lineno=918, end_col_offset=65), Constant(value='query', lineno=918, col_offset=67, end_lineno=918, end_col_offset=74)], keywords=[keyword(arg='limit', value=Constant(value=10, lineno=918, col_offset=82, end_lineno=918, end_col_offset=84), lineno=918, col_offset=76, end_lineno=918, end_col_offset=84)], lineno=918, col_offset=14, end_lineno=918, end_col_offset=85), lineno=918, col_offset=8, end_lineno=918, end_col_offset=85), lineno=918, col_offset=8, end_lineno=918, end_col_offset=85)], lineno=902, col_offset=4, end_lineno=918, end_col_offset=85)], returns=Constant(value=None, lineno=894, col_offset=55, end_lineno=894, end_col_offset=59), lineno=894, col_offset=0, end_lineno=918, end_col_offset=85)])