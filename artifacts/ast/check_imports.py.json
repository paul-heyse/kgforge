Module(body=[Expr(value=Constant(value='Run tooling architecture checks built on pytestarch.', lineno=2, col_offset=0, end_lineno=2, end_col_offset=58), lineno=2, col_offset=0, end_lineno=2, end_col_offset=58), ImportFrom(module='__future__', names=[alias(name='annotations', lineno=4, col_offset=23, end_lineno=4, end_col_offset=34)], level=0, lineno=4, col_offset=0, end_lineno=4, end_col_offset=34), Import(names=[alias(name='argparse', lineno=6, col_offset=7, end_lineno=6, end_col_offset=15)], lineno=6, col_offset=0, end_lineno=6, end_col_offset=15), Import(names=[alias(name='sys', lineno=7, col_offset=7, end_lineno=7, end_col_offset=10)], lineno=7, col_offset=0, end_lineno=7, end_col_offset=10), ImportFrom(module='typing', names=[alias(name='TYPE_CHECKING', lineno=8, col_offset=19, end_lineno=8, end_col_offset=32), alias(name='cast', lineno=8, col_offset=34, end_lineno=8, end_col_offset=38)], level=0, lineno=8, col_offset=0, end_lineno=8, end_col_offset=38), If(test=Compare(left=Name(id='__package__', ctx=Load(), lineno=10, col_offset=3, end_lineno=10, end_col_offset=14), ops=[In()], comparators=[Set(elts=[Constant(value=None, lineno=11, col_offset=4, end_lineno=11, end_col_offset=8), Constant(value='', lineno=12, col_offset=4, end_lineno=12, end_col_offset=6)], lineno=10, col_offset=18, end_lineno=13, end_col_offset=1)], lineno=10, col_offset=3, end_lineno=13, end_col_offset=1), body=[Assign(targets=[Name(id='message', ctx=Store(), lineno=14, col_offset=4, end_lineno=14, end_col_offset=11)], value=Constant(value='Run this command via `python -m tools.check_imports` or install kgfoundry[tools] so the tooling package is importable.', lineno=15, col_offset=8, end_lineno=16, end_col_offset=47), lineno=14, col_offset=4, end_lineno=17, end_col_offset=5), Raise(exc=Call(func=Name(id='RuntimeError', ctx=Load(), lineno=18, col_offset=10, end_lineno=18, end_col_offset=22), args=[Name(id='message', ctx=Load(), lineno=18, col_offset=23, end_lineno=18, end_col_offset=30)], lineno=18, col_offset=10, end_lineno=18, end_col_offset=31), lineno=18, col_offset=4, end_lineno=18, end_col_offset=31)], lineno=10, col_offset=0, end_lineno=18, end_col_offset=31), ImportFrom(module='tools', names=[alias(name='architecture', lineno=20, col_offset=18, end_lineno=20, end_col_offset=30)], level=0, lineno=20, col_offset=0, end_lineno=20, end_col_offset=30), ImportFrom(module='tools._shared.cli', names=[alias(name='CliEnvelopeBuilder', lineno=21, col_offset=30, end_lineno=21, end_col_offset=48), alias(name='render_cli_envelope', lineno=21, col_offset=50, end_lineno=21, end_col_offset=69)], level=0, lineno=21, col_offset=0, end_lineno=21, end_col_offset=69), ImportFrom(module='tools._shared.logging', names=[alias(name='get_logger', lineno=22, col_offset=34, end_lineno=22, end_col_offset=44)], level=0, lineno=22, col_offset=0, end_lineno=22, end_col_offset=44), If(test=Name(id='TYPE_CHECKING', ctx=Load(), lineno=24, col_offset=3, end_lineno=24, end_col_offset=16), body=[ImportFrom(module='tools._shared.cli', names=[alias(name='CliEnvelope', lineno=25, col_offset=34, end_lineno=25, end_col_offset=45), alias(name='CliStatus', lineno=25, col_offset=47, end_lineno=25, end_col_offset=56)], level=0, lineno=25, col_offset=4, end_lineno=25, end_col_offset=56)], lineno=24, col_offset=0, end_lineno=25, end_col_offset=56), Assign(targets=[Name(id='LOGGER', ctx=Store(), lineno=27, col_offset=0, end_lineno=27, end_col_offset=6)], value=Call(func=Name(id='get_logger', ctx=Load(), lineno=27, col_offset=9, end_lineno=27, end_col_offset=19), args=[Name(id='__name__', ctx=Load(), lineno=27, col_offset=20, end_lineno=27, end_col_offset=28)], lineno=27, col_offset=9, end_lineno=27, end_col_offset=29), lineno=27, col_offset=0, end_lineno=27, end_col_offset=29), FunctionDef(name='_build_envelope', args=arguments(args=[arg(arg='result', annotation=Attribute(value=Name(id='architecture', ctx=Load(), lineno=30, col_offset=28, end_lineno=30, end_col_offset=40), attr='ArchitectureResult', ctx=Load(), lineno=30, col_offset=28, end_lineno=30, end_col_offset=59), lineno=30, col_offset=20, end_lineno=30, end_col_offset=59)]), body=[AnnAssign(target=Name(id='status', ctx=Store(), lineno=31, col_offset=4, end_lineno=31, end_col_offset=10), annotation=Name(id='CliStatus', ctx=Load(), lineno=31, col_offset=12, end_lineno=31, end_col_offset=21), value=IfExp(test=Attribute(value=Name(id='result', ctx=Load(), lineno=31, col_offset=37, end_lineno=31, end_col_offset=43), attr='is_success', ctx=Load(), lineno=31, col_offset=37, end_lineno=31, end_col_offset=54), body=Constant(value='success', lineno=31, col_offset=24, end_lineno=31, end_col_offset=33), orelse=Constant(value='violation', lineno=31, col_offset=60, end_lineno=31, end_col_offset=71), lineno=31, col_offset=24, end_lineno=31, end_col_offset=71), simple=1, lineno=31, col_offset=4, end_lineno=31, end_col_offset=71), Assign(targets=[Name(id='builder', ctx=Store(), lineno=32, col_offset=4, end_lineno=32, end_col_offset=11)], value=Call(func=Attribute(value=Name(id='CliEnvelopeBuilder', ctx=Load(), lineno=32, col_offset=14, end_lineno=32, end_col_offset=32), attr='create', ctx=Load(), lineno=32, col_offset=14, end_lineno=32, end_col_offset=39), keywords=[keyword(arg='command', value=Constant(value='check_imports', lineno=32, col_offset=48, end_lineno=32, end_col_offset=63), lineno=32, col_offset=40, end_lineno=32, end_col_offset=63), keyword(arg='status', value=Name(id='status', ctx=Load(), lineno=32, col_offset=72, end_lineno=32, end_col_offset=78), lineno=32, col_offset=65, end_lineno=32, end_col_offset=78)], lineno=32, col_offset=14, end_lineno=32, end_col_offset=79), lineno=32, col_offset=4, end_lineno=32, end_col_offset=79), If(test=UnaryOp(op=Not(), operand=Attribute(value=Name(id='result', ctx=Load(), lineno=33, col_offset=11, end_lineno=33, end_col_offset=17), attr='is_success', ctx=Load(), lineno=33, col_offset=11, end_lineno=33, end_col_offset=28), lineno=33, col_offset=7, end_lineno=33, end_col_offset=28), body=[For(target=Name(id='violation', ctx=Store(), lineno=34, col_offset=12, end_lineno=34, end_col_offset=21), iter=Attribute(value=Name(id='result', ctx=Load(), lineno=34, col_offset=25, end_lineno=34, end_col_offset=31), attr='violations', ctx=Load(), lineno=34, col_offset=25, end_lineno=34, end_col_offset=42), body=[Assign(targets=[Name(id='builder', ctx=Store(), lineno=35, col_offset=12, end_lineno=35, end_col_offset=19)], value=Call(func=Attribute(value=Name(id='builder', ctx=Load(), lineno=35, col_offset=22, end_lineno=35, end_col_offset=29), attr='add_error', ctx=Load(), lineno=35, col_offset=22, end_lineno=35, end_col_offset=39), keywords=[keyword(arg='status', value=Constant(value='violation', lineno=35, col_offset=47, end_lineno=35, end_col_offset=58), lineno=35, col_offset=40, end_lineno=35, end_col_offset=58), keyword(arg='message', value=Name(id='violation', ctx=Load(), lineno=35, col_offset=68, end_lineno=35, end_col_offset=77), lineno=35, col_offset=60, end_lineno=35, end_col_offset=77)], lineno=35, col_offset=22, end_lineno=35, end_col_offset=78), lineno=35, col_offset=12, end_lineno=35, end_col_offset=78)], lineno=34, col_offset=8, end_lineno=35, end_col_offset=78)], lineno=33, col_offset=4, end_lineno=35, end_col_offset=78), Return(value=Call(func=Attribute(value=Name(id='builder', ctx=Load(), lineno=36, col_offset=11, end_lineno=36, end_col_offset=18), attr='finish', ctx=Load(), lineno=36, col_offset=11, end_lineno=36, end_col_offset=25), lineno=36, col_offset=11, end_lineno=36, end_col_offset=27), lineno=36, col_offset=4, end_lineno=36, end_col_offset=27)], returns=Name(id='CliEnvelope', ctx=Load(), lineno=30, col_offset=64, end_lineno=30, end_col_offset=75), lineno=30, col_offset=0, end_lineno=36, end_col_offset=27), FunctionDef(name='main', args=arguments(), body=[Expr(value=Constant(value='Execute the tooling architecture checks and emit a CLI envelope.\n\n    Returns\n    -------\n    int\n        Exit code: 0 on success, 1 on failure.\n    ', lineno=40, col_offset=4, end_lineno=46, end_col_offset=7), lineno=40, col_offset=4, end_lineno=46, end_col_offset=7), Assign(targets=[Name(id='parser', ctx=Store(), lineno=47, col_offset=4, end_lineno=47, end_col_offset=10)], value=Call(func=Attribute(value=Name(id='argparse', ctx=Load(), lineno=47, col_offset=13, end_lineno=47, end_col_offset=21), attr='ArgumentParser', ctx=Load(), lineno=47, col_offset=13, end_lineno=47, end_col_offset=36), keywords=[keyword(arg='description', value=Name(id='__doc__', ctx=Load(), lineno=47, col_offset=49, end_lineno=47, end_col_offset=56), lineno=47, col_offset=37, end_lineno=47, end_col_offset=56)], lineno=47, col_offset=13, end_lineno=47, end_col_offset=57), lineno=47, col_offset=4, end_lineno=47, end_col_offset=57), Expr(value=Call(func=Attribute(value=Name(id='parser', ctx=Load(), lineno=48, col_offset=4, end_lineno=48, end_col_offset=10), attr='add_argument', ctx=Load(), lineno=48, col_offset=4, end_lineno=48, end_col_offset=23), args=[Constant(value='--json', lineno=49, col_offset=8, end_lineno=49, end_col_offset=16)], keywords=[keyword(arg='action', value=Constant(value='store_true', lineno=50, col_offset=15, end_lineno=50, end_col_offset=27), lineno=50, col_offset=8, end_lineno=50, end_col_offset=27), keyword(arg='help', value=Constant(value='Write a JSON envelope to stdout with detailed violations.', lineno=51, col_offset=13, end_lineno=51, end_col_offset=72), lineno=51, col_offset=8, end_lineno=51, end_col_offset=72)], lineno=48, col_offset=4, end_lineno=52, end_col_offset=5), lineno=48, col_offset=4, end_lineno=52, end_col_offset=5), AnnAssign(target=Name(id='args', ctx=Store(), lineno=53, col_offset=4, end_lineno=53, end_col_offset=8), annotation=Attribute(value=Name(id='argparse', ctx=Load(), lineno=53, col_offset=10, end_lineno=53, end_col_offset=18), attr='Namespace', ctx=Load(), lineno=53, col_offset=10, end_lineno=53, end_col_offset=28), value=Call(func=Attribute(value=Name(id='parser', ctx=Load(), lineno=53, col_offset=31, end_lineno=53, end_col_offset=37), attr='parse_args', ctx=Load(), lineno=53, col_offset=31, end_lineno=53, end_col_offset=48), lineno=53, col_offset=31, end_lineno=53, end_col_offset=50), simple=1, lineno=53, col_offset=4, end_lineno=53, end_col_offset=50), Assign(targets=[Name(id='result', ctx=Store(), lineno=55, col_offset=4, end_lineno=55, end_col_offset=10)], value=Call(func=Attribute(value=Name(id='architecture', ctx=Load(), lineno=55, col_offset=13, end_lineno=55, end_col_offset=25), attr='enforce_tooling_layers', ctx=Load(), lineno=55, col_offset=13, end_lineno=55, end_col_offset=48), lineno=55, col_offset=13, end_lineno=55, end_col_offset=50), lineno=55, col_offset=4, end_lineno=55, end_col_offset=50), Assign(targets=[Name(id='envelope', ctx=Store(), lineno=56, col_offset=4, end_lineno=56, end_col_offset=12)], value=Call(func=Name(id='_build_envelope', ctx=Load(), lineno=56, col_offset=15, end_lineno=56, end_col_offset=30), args=[Name(id='result', ctx=Load(), lineno=56, col_offset=31, end_lineno=56, end_col_offset=37)], lineno=56, col_offset=15, end_lineno=56, end_col_offset=38), lineno=56, col_offset=4, end_lineno=56, end_col_offset=38), Assign(targets=[Name(id='output_json', ctx=Store(), lineno=58, col_offset=4, end_lineno=58, end_col_offset=15)], value=Call(func=Name(id='cast', ctx=Load(), lineno=58, col_offset=18, end_lineno=58, end_col_offset=22), args=[Constant(value='bool', lineno=58, col_offset=23, end_lineno=58, end_col_offset=29), Call(func=Name(id='getattr', ctx=Load(), lineno=58, col_offset=31, end_lineno=58, end_col_offset=38), args=[Name(id='args', ctx=Load(), lineno=58, col_offset=39, end_lineno=58, end_col_offset=43), Constant(value='json', lineno=58, col_offset=45, end_lineno=58, end_col_offset=51), Constant(value=False, lineno=58, col_offset=53, end_lineno=58, end_col_offset=58)], lineno=58, col_offset=31, end_lineno=58, end_col_offset=59)], lineno=58, col_offset=18, end_lineno=58, end_col_offset=60), lineno=58, col_offset=4, end_lineno=58, end_col_offset=60), If(test=Name(id='output_json', ctx=Load(), lineno=60, col_offset=7, end_lineno=60, end_col_offset=18), body=[Expr(value=Call(func=Attribute(value=Attribute(value=Name(id='sys', ctx=Load(), lineno=61, col_offset=8, end_lineno=61, end_col_offset=11), attr='stdout', ctx=Load(), lineno=61, col_offset=8, end_lineno=61, end_col_offset=18), attr='write', ctx=Load(), lineno=61, col_offset=8, end_lineno=61, end_col_offset=24), args=[BinOp(left=Call(func=Name(id='render_cli_envelope', ctx=Load(), lineno=61, col_offset=25, end_lineno=61, end_col_offset=44), args=[Name(id='envelope', ctx=Load(), lineno=61, col_offset=45, end_lineno=61, end_col_offset=53)], lineno=61, col_offset=25, end_lineno=61, end_col_offset=54), op=Add(), right=Constant(value='\n', lineno=61, col_offset=57, end_lineno=61, end_col_offset=61), lineno=61, col_offset=25, end_lineno=61, end_col_offset=61)], lineno=61, col_offset=8, end_lineno=61, end_col_offset=62), lineno=61, col_offset=8, end_lineno=61, end_col_offset=62)], orelse=[If(test=Attribute(value=Name(id='result', ctx=Load(), lineno=62, col_offset=9, end_lineno=62, end_col_offset=15), attr='is_success', ctx=Load(), lineno=62, col_offset=9, end_lineno=62, end_col_offset=26), body=[Expr(value=Call(func=Attribute(value=Name(id='LOGGER', ctx=Load(), lineno=63, col_offset=8, end_lineno=63, end_col_offset=14), attr='info', ctx=Load(), lineno=63, col_offset=8, end_lineno=63, end_col_offset=19), args=[Constant(value='Tooling import layering verified (domain → adapters → io/cli).', lineno=63, col_offset=20, end_lineno=63, end_col_offset=88)], lineno=63, col_offset=8, end_lineno=63, end_col_offset=89), lineno=63, col_offset=8, end_lineno=63, end_col_offset=89)], orelse=[For(target=Name(id='violation', ctx=Store(), lineno=65, col_offset=12, end_lineno=65, end_col_offset=21), iter=Attribute(value=Name(id='result', ctx=Load(), lineno=65, col_offset=25, end_lineno=65, end_col_offset=31), attr='violations', ctx=Load(), lineno=65, col_offset=25, end_lineno=65, end_col_offset=42), body=[Expr(value=Call(func=Attribute(value=Name(id='LOGGER', ctx=Load(), lineno=66, col_offset=12, end_lineno=66, end_col_offset=18), attr='error', ctx=Load(), lineno=66, col_offset=12, end_lineno=66, end_col_offset=24), args=[Name(id='violation', ctx=Load(), lineno=66, col_offset=25, end_lineno=66, end_col_offset=34)], lineno=66, col_offset=12, end_lineno=66, end_col_offset=35), lineno=66, col_offset=12, end_lineno=66, end_col_offset=35)], lineno=65, col_offset=8, end_lineno=66, end_col_offset=35)], lineno=62, col_offset=4, end_lineno=66, end_col_offset=35)], lineno=60, col_offset=4, end_lineno=66, end_col_offset=35), Return(value=IfExp(test=Attribute(value=Name(id='result', ctx=Load(), lineno=68, col_offset=16, end_lineno=68, end_col_offset=22), attr='is_success', ctx=Load(), lineno=68, col_offset=16, end_lineno=68, end_col_offset=33), body=Constant(value=0, lineno=68, col_offset=11, end_lineno=68, end_col_offset=12), orelse=Constant(value=1, lineno=68, col_offset=39, end_lineno=68, end_col_offset=40), lineno=68, col_offset=11, end_lineno=68, end_col_offset=40), lineno=68, col_offset=4, end_lineno=68, end_col_offset=40)], returns=Name(id='int', ctx=Load(), lineno=39, col_offset=14, end_lineno=39, end_col_offset=17), lineno=39, col_offset=0, end_lineno=68, end_col_offset=40), If(test=Compare(left=Name(id='__name__', ctx=Load(), lineno=71, col_offset=3, end_lineno=71, end_col_offset=11), ops=[Eq()], comparators=[Constant(value='__main__', lineno=71, col_offset=15, end_lineno=71, end_col_offset=25)], lineno=71, col_offset=3, end_lineno=71, end_col_offset=25), body=[Expr(value=Call(func=Attribute(value=Name(id='sys', ctx=Load(), lineno=72, col_offset=4, end_lineno=72, end_col_offset=7), attr='exit', ctx=Load(), lineno=72, col_offset=4, end_lineno=72, end_col_offset=12), args=[Call(func=Name(id='main', ctx=Load(), lineno=72, col_offset=13, end_lineno=72, end_col_offset=17), lineno=72, col_offset=13, end_lineno=72, end_col_offset=19)], lineno=72, col_offset=4, end_lineno=72, end_col_offset=20), lineno=72, col_offset=4, end_lineno=72, end_col_offset=20)], lineno=71, col_offset=0, end_lineno=72, end_col_offset=20)])