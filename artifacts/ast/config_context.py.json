Module(body=[Expr(value=Constant(value='Application-level configuration context manager.\n\nThis module provides centralized configuration lifecycle management for the\nCodeIntel MCP application. Instead of loading settings repeatedly from environment\nvariables on each request, configuration is loaded exactly once during FastAPI\napplication startup and shared across all request handlers via explicit dependency\ninjection.\n\nKey Components\n--------------\nResolvedPaths : dataclass\n    Canonicalized absolute filesystem paths for all application resources.\nApplicationContext : dataclass\n    Application-wide context holding configuration and long-lived clients.\nresolve_application_paths : function\n    Validates and resolves all configured paths relative to repository root.\n\nDesign Principles\n-----------------\n- **Load Once**: Configuration parsed from environment exactly once at startup\n- **Explicit Injection**: Context passed as parameter (no global state)\n- **Fail-Fast**: Invalid configuration prevents application startup\n- **Immutable**: Settings frozen after creation (thread-safe)\n- **RFC 9457**: All errors use Problem Details format\n\nExample Usage\n-------------\nDuring FastAPI application startup:\n\n>>> # In lifespan() function\n>>> context = ApplicationContext.create()\n>>> app.state.context = context\n\nIn request handlers:\n\n>>> # In MCP tool wrapper\n>>> context = request.app.state.context\n>>> files_adapter.list_paths(context, path="src")\n\nSee Also\n--------\ncodeintel_rev.app.readiness : Readiness probe system for health checks\ncodeintel_rev.config.settings : Settings dataclasses and environment loading\n', lineno=1, col_offset=0, end_lineno=44, end_col_offset=3), lineno=1, col_offset=0, end_lineno=44, end_col_offset=3), ImportFrom(module='__future__', names=[alias(name='annotations', lineno=46, col_offset=23, end_lineno=46, end_col_offset=34)], level=0, lineno=46, col_offset=0, end_lineno=46, end_col_offset=34), ImportFrom(module='contextlib', names=[alias(name='contextmanager', lineno=48, col_offset=23, end_lineno=48, end_col_offset=37)], level=0, lineno=48, col_offset=0, end_lineno=48, end_col_offset=37), ImportFrom(module='dataclasses', names=[alias(name='dataclass', lineno=49, col_offset=24, end_lineno=49, end_col_offset=33), alias(name='field', lineno=49, col_offset=35, end_lineno=49, end_col_offset=40)], level=0, lineno=49, col_offset=0, end_lineno=49, end_col_offset=40), ImportFrom(module='pathlib', names=[alias(name='Path', lineno=50, col_offset=20, end_lineno=50, end_col_offset=24)], level=0, lineno=50, col_offset=0, end_lineno=50, end_col_offset=24), ImportFrom(module='threading', names=[alias(name='Lock', lineno=51, col_offset=22, end_lineno=51, end_col_offset=26)], level=0, lineno=51, col_offset=0, end_lineno=51, end_col_offset=26), ImportFrom(module='typing', names=[alias(name='TYPE_CHECKING', lineno=52, col_offset=19, end_lineno=52, end_col_offset=32)], level=0, lineno=52, col_offset=0, end_lineno=52, end_col_offset=32), ImportFrom(module='codeintel_rev.config.settings', names=[alias(name='Settings', lineno=54, col_offset=42, end_lineno=54, end_col_offset=50), alias(name='load_settings', lineno=54, col_offset=52, end_lineno=54, end_col_offset=65)], level=0, lineno=54, col_offset=0, end_lineno=54, end_col_offset=65), ImportFrom(module='codeintel_rev.io.duckdb_catalog', names=[alias(name='DuckDBCatalog', lineno=55, col_offset=44, end_lineno=55, end_col_offset=57)], level=0, lineno=55, col_offset=0, end_lineno=55, end_col_offset=57), ImportFrom(module='codeintel_rev.io.faiss_manager', names=[alias(name='FAISSManager', lineno=56, col_offset=43, end_lineno=56, end_col_offset=55)], level=0, lineno=56, col_offset=0, end_lineno=56, end_col_offset=55), ImportFrom(module='codeintel_rev.io.vllm_client', names=[alias(name='VLLMClient', lineno=57, col_offset=41, end_lineno=57, end_col_offset=51)], level=0, lineno=57, col_offset=0, end_lineno=57, end_col_offset=51), ImportFrom(module='kgfoundry_common.errors', names=[alias(name='ConfigurationError', lineno=59, col_offset=36, end_lineno=59, end_col_offset=54)], level=0, lineno=59, col_offset=0, end_lineno=59, end_col_offset=54), ImportFrom(module='kgfoundry_common.logging', names=[alias(name='get_logger', lineno=60, col_offset=37, end_lineno=60, end_col_offset=47)], level=0, lineno=60, col_offset=0, end_lineno=60, end_col_offset=47), If(test=Name(id='TYPE_CHECKING', ctx=Load(), lineno=62, col_offset=3, end_lineno=62, end_col_offset=16), body=[ImportFrom(module='collections.abc', names=[alias(name='Iterator', lineno=63, col_offset=32, end_lineno=63, end_col_offset=40)], level=0, lineno=63, col_offset=4, end_lineno=63, end_col_offset=40)], lineno=62, col_offset=0, end_lineno=63, end_col_offset=40), Assign(targets=[Name(id='LOGGER', ctx=Store(), lineno=65, col_offset=0, end_lineno=65, end_col_offset=6)], value=Call(func=Name(id='get_logger', ctx=Load(), lineno=65, col_offset=9, end_lineno=65, end_col_offset=19), args=[Name(id='__name__', ctx=Load(), lineno=65, col_offset=20, end_lineno=65, end_col_offset=28)], lineno=65, col_offset=9, end_lineno=65, end_col_offset=29), lineno=65, col_offset=0, end_lineno=65, end_col_offset=29), ClassDef(name='ResolvedPaths', body=[Expr(value=Constant(value="Canonicalized filesystem paths for runtime operations.\n\n    All paths are absolute and resolved relative to repo_root. This eliminates\n    ambiguity and ensures consistent path handling throughout the application.\n    Path resolution is performed once at application startup rather than on\n    each request.\n\n    Attributes\n    ----------\n    repo_root : Path\n        Absolute path to repository root directory. This is the base directory\n        for all source code and must exist before application startup.\n    data_dir : Path\n        Absolute path to base data directory containing indexes and databases.\n    vectors_dir : Path\n        Absolute path to directory containing Parquet files with vector embeddings.\n    faiss_index : Path\n        Absolute path to FAISS IVF-PQ index file (CPU version).\n    duckdb_path : Path\n        Absolute path to DuckDB catalog database file.\n    scip_index : Path\n        Absolute path to SCIP index file (JSON or protobuf format).\n\n    Examples\n    --------\n    Paths are created during application startup:\n\n    >>> settings = load_settings()\n    >>> paths = resolve_application_paths(settings)\n    >>> paths.repo_root\n    PosixPath('/home/user/kgfoundry')\n    >>> paths.faiss_index\n    PosixPath('/home/user/kgfoundry/data/faiss/code.ivfpq.faiss')\n    ", lineno=70, col_offset=4, end_lineno=103, end_col_offset=7), lineno=70, col_offset=4, end_lineno=103, end_col_offset=7), AnnAssign(target=Name(id='repo_root', ctx=Store(), lineno=105, col_offset=4, end_lineno=105, end_col_offset=13), annotation=Name(id='Path', ctx=Load(), lineno=105, col_offset=15, end_lineno=105, end_col_offset=19), simple=1, lineno=105, col_offset=4, end_lineno=105, end_col_offset=19), AnnAssign(target=Name(id='data_dir', ctx=Store(), lineno=106, col_offset=4, end_lineno=106, end_col_offset=12), annotation=Name(id='Path', ctx=Load(), lineno=106, col_offset=14, end_lineno=106, end_col_offset=18), simple=1, lineno=106, col_offset=4, end_lineno=106, end_col_offset=18), AnnAssign(target=Name(id='vectors_dir', ctx=Store(), lineno=107, col_offset=4, end_lineno=107, end_col_offset=15), annotation=Name(id='Path', ctx=Load(), lineno=107, col_offset=17, end_lineno=107, end_col_offset=21), simple=1, lineno=107, col_offset=4, end_lineno=107, end_col_offset=21), AnnAssign(target=Name(id='faiss_index', ctx=Store(), lineno=108, col_offset=4, end_lineno=108, end_col_offset=15), annotation=Name(id='Path', ctx=Load(), lineno=108, col_offset=17, end_lineno=108, end_col_offset=21), simple=1, lineno=108, col_offset=4, end_lineno=108, end_col_offset=21), AnnAssign(target=Name(id='duckdb_path', ctx=Store(), lineno=109, col_offset=4, end_lineno=109, end_col_offset=15), annotation=Name(id='Path', ctx=Load(), lineno=109, col_offset=17, end_lineno=109, end_col_offset=21), simple=1, lineno=109, col_offset=4, end_lineno=109, end_col_offset=21), AnnAssign(target=Name(id='scip_index', ctx=Store(), lineno=110, col_offset=4, end_lineno=110, end_col_offset=14), annotation=Name(id='Path', ctx=Load(), lineno=110, col_offset=16, end_lineno=110, end_col_offset=20), simple=1, lineno=110, col_offset=4, end_lineno=110, end_col_offset=20)], decorator_list=[Call(func=Name(id='dataclass', ctx=Load(), lineno=68, col_offset=1, end_lineno=68, end_col_offset=10), keywords=[keyword(arg='slots', value=Constant(value=True, lineno=68, col_offset=17, end_lineno=68, end_col_offset=21), lineno=68, col_offset=11, end_lineno=68, end_col_offset=21), keyword(arg='frozen', value=Constant(value=True, lineno=68, col_offset=30, end_lineno=68, end_col_offset=34), lineno=68, col_offset=23, end_lineno=68, end_col_offset=34)], lineno=68, col_offset=1, end_lineno=68, end_col_offset=35)], lineno=69, col_offset=0, end_lineno=110, end_col_offset=20), FunctionDef(name='resolve_application_paths', args=arguments(args=[arg(arg='settings', annotation=Name(id='Settings', ctx=Load(), lineno=113, col_offset=40, end_lineno=113, end_col_offset=48), lineno=113, col_offset=30, end_lineno=113, end_col_offset=48)]), body=[Expr(value=Constant(value='Resolve all configured paths to absolute paths.\n\n    Converts relative paths to absolute paths relative to repo_root, validates\n    that repo_root exists and is a directory, and returns a frozen dataclass\n    containing all resolved paths.\n\n    This function is called once during application startup. Path resolution\n    failures cause ConfigurationError to be raised, which prevents the\n    application from starting.\n\n    Parameters\n    ----------\n    settings : Settings\n        Application settings containing path configuration loaded from\n        environment variables.\n\n    Returns\n    -------\n    ResolvedPaths\n        Fully resolved absolute paths for all application resources.\n\n    Raises\n    ------\n    ConfigurationError\n        If repo_root does not exist, is not a directory, or cannot be accessed.\n        Error includes RFC 9457 Problem Details with context fields for\n        debugging (repo_root value, source environment variable).\n\n    Examples\n    --------\n    >>> settings = Settings(\n    ...     paths=PathsConfig(\n    ...         repo_root="/home/user/kgfoundry",\n    ...         data_dir="data",\n    ...         faiss_index="data/faiss/code.ivfpq.faiss",\n    ...     ),\n    ...     # ... other settings\n    ... )\n    >>> paths = resolve_application_paths(settings)\n    >>> paths.data_dir.is_absolute()\n    True\n    >>> paths.data_dir.parent == paths.repo_root\n    True\n    ', lineno=114, col_offset=4, end_lineno=157, end_col_offset=7), lineno=114, col_offset=4, end_lineno=157, end_col_offset=7), Assign(targets=[Name(id='repo_root', ctx=Store(), lineno=158, col_offset=4, end_lineno=158, end_col_offset=13)], value=Call(func=Attribute(value=Call(func=Attribute(value=Call(func=Name(id='Path', ctx=Load(), lineno=158, col_offset=16, end_lineno=158, end_col_offset=20), args=[Attribute(value=Attribute(value=Name(id='settings', ctx=Load(), lineno=158, col_offset=21, end_lineno=158, end_col_offset=29), attr='paths', ctx=Load(), lineno=158, col_offset=21, end_lineno=158, end_col_offset=35), attr='repo_root', ctx=Load(), lineno=158, col_offset=21, end_lineno=158, end_col_offset=45)], lineno=158, col_offset=16, end_lineno=158, end_col_offset=46), attr='expanduser', ctx=Load(), lineno=158, col_offset=16, end_lineno=158, end_col_offset=57), lineno=158, col_offset=16, end_lineno=158, end_col_offset=59), attr='resolve', ctx=Load(), lineno=158, col_offset=16, end_lineno=158, end_col_offset=67), lineno=158, col_offset=16, end_lineno=158, end_col_offset=69), lineno=158, col_offset=4, end_lineno=158, end_col_offset=69), If(test=UnaryOp(op=Not(), operand=Call(func=Attribute(value=Name(id='repo_root', ctx=Load(), lineno=160, col_offset=11, end_lineno=160, end_col_offset=20), attr='exists', ctx=Load(), lineno=160, col_offset=11, end_lineno=160, end_col_offset=27), lineno=160, col_offset=11, end_lineno=160, end_col_offset=29), lineno=160, col_offset=7, end_lineno=160, end_col_offset=29), body=[Assign(targets=[Name(id='msg', ctx=Store(), lineno=161, col_offset=8, end_lineno=161, end_col_offset=11)], value=JoinedStr(values=[Constant(value='Repository root does not exist: ', lineno=161, col_offset=16, end_lineno=161, end_col_offset=48), FormattedValue(value=Name(id='repo_root', ctx=Load(), lineno=161, col_offset=49, end_lineno=161, end_col_offset=58), conversion=-1, lineno=161, col_offset=48, end_lineno=161, end_col_offset=59)], lineno=161, col_offset=14, end_lineno=161, end_col_offset=60), lineno=161, col_offset=8, end_lineno=161, end_col_offset=60), Raise(exc=Call(func=Name(id='ConfigurationError', ctx=Load(), lineno=162, col_offset=14, end_lineno=162, end_col_offset=32), args=[Name(id='msg', ctx=Load(), lineno=163, col_offset=12, end_lineno=163, end_col_offset=15)], keywords=[keyword(arg='context', value=Dict(keys=[Constant(value='repo_root', lineno=163, col_offset=26, end_lineno=163, end_col_offset=37), Constant(value='source', lineno=163, col_offset=55, end_lineno=163, end_col_offset=63)], values=[Call(func=Name(id='str', ctx=Load(), lineno=163, col_offset=39, end_lineno=163, end_col_offset=42), args=[Name(id='repo_root', ctx=Load(), lineno=163, col_offset=43, end_lineno=163, end_col_offset=52)], lineno=163, col_offset=39, end_lineno=163, end_col_offset=53), Constant(value='REPO_ROOT env var', lineno=163, col_offset=65, end_lineno=163, end_col_offset=84)], lineno=163, col_offset=25, end_lineno=163, end_col_offset=85), lineno=163, col_offset=17, end_lineno=163, end_col_offset=85)], lineno=162, col_offset=14, end_lineno=164, end_col_offset=9), lineno=162, col_offset=8, end_lineno=164, end_col_offset=9)], lineno=160, col_offset=4, end_lineno=164, end_col_offset=9), If(test=UnaryOp(op=Not(), operand=Call(func=Attribute(value=Name(id='repo_root', ctx=Load(), lineno=166, col_offset=11, end_lineno=166, end_col_offset=20), attr='is_dir', ctx=Load(), lineno=166, col_offset=11, end_lineno=166, end_col_offset=27), lineno=166, col_offset=11, end_lineno=166, end_col_offset=29), lineno=166, col_offset=7, end_lineno=166, end_col_offset=29), body=[Assign(targets=[Name(id='msg', ctx=Store(), lineno=167, col_offset=8, end_lineno=167, end_col_offset=11)], value=JoinedStr(values=[Constant(value='Repository root is not a directory: ', lineno=167, col_offset=16, end_lineno=167, end_col_offset=52), FormattedValue(value=Name(id='repo_root', ctx=Load(), lineno=167, col_offset=53, end_lineno=167, end_col_offset=62), conversion=-1, lineno=167, col_offset=52, end_lineno=167, end_col_offset=63)], lineno=167, col_offset=14, end_lineno=167, end_col_offset=64), lineno=167, col_offset=8, end_lineno=167, end_col_offset=64), Raise(exc=Call(func=Name(id='ConfigurationError', ctx=Load(), lineno=168, col_offset=14, end_lineno=168, end_col_offset=32), args=[Name(id='msg', ctx=Load(), lineno=168, col_offset=33, end_lineno=168, end_col_offset=36)], keywords=[keyword(arg='context', value=Dict(keys=[Constant(value='repo_root', lineno=168, col_offset=47, end_lineno=168, end_col_offset=58)], values=[Call(func=Name(id='str', ctx=Load(), lineno=168, col_offset=60, end_lineno=168, end_col_offset=63), args=[Name(id='repo_root', ctx=Load(), lineno=168, col_offset=64, end_lineno=168, end_col_offset=73)], lineno=168, col_offset=60, end_lineno=168, end_col_offset=74)], lineno=168, col_offset=46, end_lineno=168, end_col_offset=75), lineno=168, col_offset=38, end_lineno=168, end_col_offset=75)], lineno=168, col_offset=14, end_lineno=168, end_col_offset=76), lineno=168, col_offset=8, end_lineno=168, end_col_offset=76)], lineno=166, col_offset=4, end_lineno=168, end_col_offset=76), FunctionDef(name='_resolve', args=arguments(args=[arg(arg='path_str', annotation=Name(id='str', ctx=Load(), lineno=170, col_offset=27, end_lineno=170, end_col_offset=30), lineno=170, col_offset=17, end_lineno=170, end_col_offset=30)]), body=[Expr(value=Constant(value='Resolve a path string relative to repo_root.\n\n        Parameters\n        ----------\n        path_str : str\n            Path string that may be relative or absolute.\n\n        Returns\n        -------\n        Path\n            Absolute resolved path.\n        ', lineno=171, col_offset=8, end_lineno=182, end_col_offset=11), lineno=171, col_offset=8, end_lineno=182, end_col_offset=11), Assign(targets=[Name(id='path', ctx=Store(), lineno=183, col_offset=8, end_lineno=183, end_col_offset=12)], value=Call(func=Name(id='Path', ctx=Load(), lineno=183, col_offset=15, end_lineno=183, end_col_offset=19), args=[Name(id='path_str', ctx=Load(), lineno=183, col_offset=20, end_lineno=183, end_col_offset=28)], lineno=183, col_offset=15, end_lineno=183, end_col_offset=29), lineno=183, col_offset=8, end_lineno=183, end_col_offset=29), If(test=Call(func=Attribute(value=Name(id='path', ctx=Load(), lineno=184, col_offset=11, end_lineno=184, end_col_offset=15), attr='is_absolute', ctx=Load(), lineno=184, col_offset=11, end_lineno=184, end_col_offset=27), lineno=184, col_offset=11, end_lineno=184, end_col_offset=29), body=[Return(value=Call(func=Attribute(value=Call(func=Attribute(value=Name(id='path', ctx=Load(), lineno=185, col_offset=19, end_lineno=185, end_col_offset=23), attr='expanduser', ctx=Load(), lineno=185, col_offset=19, end_lineno=185, end_col_offset=34), lineno=185, col_offset=19, end_lineno=185, end_col_offset=36), attr='resolve', ctx=Load(), lineno=185, col_offset=19, end_lineno=185, end_col_offset=44), lineno=185, col_offset=19, end_lineno=185, end_col_offset=46), lineno=185, col_offset=12, end_lineno=185, end_col_offset=46)], lineno=184, col_offset=8, end_lineno=185, end_col_offset=46), Return(value=Call(func=Attribute(value=BinOp(left=Name(id='repo_root', ctx=Load(), lineno=186, col_offset=16, end_lineno=186, end_col_offset=25), op=Div(), right=Name(id='path', ctx=Load(), lineno=186, col_offset=28, end_lineno=186, end_col_offset=32), lineno=186, col_offset=16, end_lineno=186, end_col_offset=32), attr='resolve', ctx=Load(), lineno=186, col_offset=15, end_lineno=186, end_col_offset=41), lineno=186, col_offset=15, end_lineno=186, end_col_offset=43), lineno=186, col_offset=8, end_lineno=186, end_col_offset=43)], returns=Name(id='Path', ctx=Load(), lineno=170, col_offset=35, end_lineno=170, end_col_offset=39), lineno=170, col_offset=4, end_lineno=186, end_col_offset=43), Return(value=Call(func=Name(id='ResolvedPaths', ctx=Load(), lineno=188, col_offset=11, end_lineno=188, end_col_offset=24), keywords=[keyword(arg='repo_root', value=Name(id='repo_root', ctx=Load(), lineno=189, col_offset=18, end_lineno=189, end_col_offset=27), lineno=189, col_offset=8, end_lineno=189, end_col_offset=27), keyword(arg='data_dir', value=Call(func=Name(id='_resolve', ctx=Load(), lineno=190, col_offset=17, end_lineno=190, end_col_offset=25), args=[Attribute(value=Attribute(value=Name(id='settings', ctx=Load(), lineno=190, col_offset=26, end_lineno=190, end_col_offset=34), attr='paths', ctx=Load(), lineno=190, col_offset=26, end_lineno=190, end_col_offset=40), attr='data_dir', ctx=Load(), lineno=190, col_offset=26, end_lineno=190, end_col_offset=49)], lineno=190, col_offset=17, end_lineno=190, end_col_offset=50), lineno=190, col_offset=8, end_lineno=190, end_col_offset=50), keyword(arg='vectors_dir', value=Call(func=Name(id='_resolve', ctx=Load(), lineno=191, col_offset=20, end_lineno=191, end_col_offset=28), args=[Attribute(value=Attribute(value=Name(id='settings', ctx=Load(), lineno=191, col_offset=29, end_lineno=191, end_col_offset=37), attr='paths', ctx=Load(), lineno=191, col_offset=29, end_lineno=191, end_col_offset=43), attr='vectors_dir', ctx=Load(), lineno=191, col_offset=29, end_lineno=191, end_col_offset=55)], lineno=191, col_offset=20, end_lineno=191, end_col_offset=56), lineno=191, col_offset=8, end_lineno=191, end_col_offset=56), keyword(arg='faiss_index', value=Call(func=Name(id='_resolve', ctx=Load(), lineno=192, col_offset=20, end_lineno=192, end_col_offset=28), args=[Attribute(value=Attribute(value=Name(id='settings', ctx=Load(), lineno=192, col_offset=29, end_lineno=192, end_col_offset=37), attr='paths', ctx=Load(), lineno=192, col_offset=29, end_lineno=192, end_col_offset=43), attr='faiss_index', ctx=Load(), lineno=192, col_offset=29, end_lineno=192, end_col_offset=55)], lineno=192, col_offset=20, end_lineno=192, end_col_offset=56), lineno=192, col_offset=8, end_lineno=192, end_col_offset=56), keyword(arg='duckdb_path', value=Call(func=Name(id='_resolve', ctx=Load(), lineno=193, col_offset=20, end_lineno=193, end_col_offset=28), args=[Attribute(value=Attribute(value=Name(id='settings', ctx=Load(), lineno=193, col_offset=29, end_lineno=193, end_col_offset=37), attr='paths', ctx=Load(), lineno=193, col_offset=29, end_lineno=193, end_col_offset=43), attr='duckdb_path', ctx=Load(), lineno=193, col_offset=29, end_lineno=193, end_col_offset=55)], lineno=193, col_offset=20, end_lineno=193, end_col_offset=56), lineno=193, col_offset=8, end_lineno=193, end_col_offset=56), keyword(arg='scip_index', value=Call(func=Name(id='_resolve', ctx=Load(), lineno=194, col_offset=19, end_lineno=194, end_col_offset=27), args=[Attribute(value=Attribute(value=Name(id='settings', ctx=Load(), lineno=194, col_offset=28, end_lineno=194, end_col_offset=36), attr='paths', ctx=Load(), lineno=194, col_offset=28, end_lineno=194, end_col_offset=42), attr='scip_index', ctx=Load(), lineno=194, col_offset=28, end_lineno=194, end_col_offset=53)], lineno=194, col_offset=19, end_lineno=194, end_col_offset=54), lineno=194, col_offset=8, end_lineno=194, end_col_offset=54)], lineno=188, col_offset=11, end_lineno=195, end_col_offset=5), lineno=188, col_offset=4, end_lineno=195, end_col_offset=5)], returns=Name(id='ResolvedPaths', ctx=Load(), lineno=113, col_offset=53, end_lineno=113, end_col_offset=66), lineno=113, col_offset=0, end_lineno=195, end_col_offset=5), ClassDef(name='ApplicationContext', body=[Expr(value=Constant(value='Application-wide context holding all configuration and long-lived clients.\n\n    This is the single source of truth for configuration throughout the application.\n    It\'s initialized once during FastAPI startup (in lifespan() function) and\n    injected into request handlers via app.state.\n\n    The context is NOT a global singleton - it\'s explicitly passed as a parameter\n    to all functions that need it. This makes dependencies explicit and testing\n    straightforward.\n\n    Attributes\n    ----------\n    settings : Settings\n        Immutable application settings loaded from environment variables. Frozen\n        after creation to ensure thread-safe access.\n    paths : ResolvedPaths\n        Canonicalized filesystem paths for all resources (repo root, indexes, etc.).\n        All paths are absolute.\n    vllm_client : VLLMClient\n        vLLM embedding service client with persistent HTTP connection pool.\n        Shared across all requests for efficiency.\n    faiss_manager : FAISSManager\n        FAISS index manager that handles CPU and GPU indexes. GPU resources are\n        lazily initialized on first search or optionally pre-loaded at startup.\n\n    Examples\n    --------\n    Create context during application startup:\n\n    >>> context = ApplicationContext.create()\n    >>> context.settings.paths.repo_root\n    \'/home/user/kgfoundry\'\n\n    Use context in adapter functions:\n\n    >>> def list_paths(context: ApplicationContext, ...) -> dict:\n    ...     repo_root = context.paths.repo_root\n    ...     # ... use repo_root for file operations\n\n    Access from FastAPI request handler:\n\n    >>> @app.get("/api/endpoint")\n    >>> async def handler(request: Request):\n    ...     context = request.app.state.context\n    ...     # ... use context\n\n    Notes\n    -----\n    The context is designed to be immutable after creation (settings and paths\n    are frozen dataclasses). The FAISS manager and vLLM client maintain internal\n    state (connection pools, loaded indexes) but their configuration cannot be\n    changed after initialization.\n\n    See Also\n    --------\n    resolve_application_paths : Creates ResolvedPaths from Settings\n    ApplicationContext.create : Factory method for creating context\n    ', lineno=200, col_offset=4, end_lineno=257, end_col_offset=7), lineno=200, col_offset=4, end_lineno=257, end_col_offset=7), AnnAssign(target=Name(id='settings', ctx=Store(), lineno=259, col_offset=4, end_lineno=259, end_col_offset=12), annotation=Name(id='Settings', ctx=Load(), lineno=259, col_offset=14, end_lineno=259, end_col_offset=22), simple=1, lineno=259, col_offset=4, end_lineno=259, end_col_offset=22), AnnAssign(target=Name(id='paths', ctx=Store(), lineno=260, col_offset=4, end_lineno=260, end_col_offset=9), annotation=Name(id='ResolvedPaths', ctx=Load(), lineno=260, col_offset=11, end_lineno=260, end_col_offset=24), simple=1, lineno=260, col_offset=4, end_lineno=260, end_col_offset=24), AnnAssign(target=Name(id='vllm_client', ctx=Store(), lineno=261, col_offset=4, end_lineno=261, end_col_offset=15), annotation=Name(id='VLLMClient', ctx=Load(), lineno=261, col_offset=17, end_lineno=261, end_col_offset=27), simple=1, lineno=261, col_offset=4, end_lineno=261, end_col_offset=27), AnnAssign(target=Name(id='faiss_manager', ctx=Store(), lineno=262, col_offset=4, end_lineno=262, end_col_offset=17), annotation=Name(id='FAISSManager', ctx=Load(), lineno=262, col_offset=19, end_lineno=262, end_col_offset=31), simple=1, lineno=262, col_offset=4, end_lineno=262, end_col_offset=31), AnnAssign(target=Name(id='_faiss_lock', ctx=Store(), lineno=263, col_offset=4, end_lineno=263, end_col_offset=15), annotation=Name(id='Lock', ctx=Load(), lineno=263, col_offset=17, end_lineno=263, end_col_offset=21), value=Call(func=Name(id='field', ctx=Load(), lineno=263, col_offset=24, end_lineno=263, end_col_offset=29), keywords=[keyword(arg='default_factory', value=Name(id='Lock', ctx=Load(), lineno=263, col_offset=46, end_lineno=263, end_col_offset=50), lineno=263, col_offset=30, end_lineno=263, end_col_offset=50), keyword(arg='init', value=Constant(value=False, lineno=263, col_offset=57, end_lineno=263, end_col_offset=62), lineno=263, col_offset=52, end_lineno=263, end_col_offset=62)], lineno=263, col_offset=24, end_lineno=263, end_col_offset=63), simple=1, lineno=263, col_offset=4, end_lineno=263, end_col_offset=63), AnnAssign(target=Name(id='_faiss_loaded', ctx=Store(), lineno=264, col_offset=4, end_lineno=264, end_col_offset=17), annotation=Name(id='bool', ctx=Load(), lineno=264, col_offset=19, end_lineno=264, end_col_offset=23), value=Call(func=Name(id='field', ctx=Load(), lineno=264, col_offset=26, end_lineno=264, end_col_offset=31), keywords=[keyword(arg='default', value=Constant(value=False, lineno=264, col_offset=40, end_lineno=264, end_col_offset=45), lineno=264, col_offset=32, end_lineno=264, end_col_offset=45), keyword(arg='init', value=Constant(value=False, lineno=264, col_offset=52, end_lineno=264, end_col_offset=57), lineno=264, col_offset=47, end_lineno=264, end_col_offset=57)], lineno=264, col_offset=26, end_lineno=264, end_col_offset=58), simple=1, lineno=264, col_offset=4, end_lineno=264, end_col_offset=58), AnnAssign(target=Name(id='_faiss_gpu_attempted', ctx=Store(), lineno=265, col_offset=4, end_lineno=265, end_col_offset=24), annotation=Name(id='bool', ctx=Load(), lineno=265, col_offset=26, end_lineno=265, end_col_offset=30), value=Call(func=Name(id='field', ctx=Load(), lineno=265, col_offset=33, end_lineno=265, end_col_offset=38), keywords=[keyword(arg='default', value=Constant(value=False, lineno=265, col_offset=47, end_lineno=265, end_col_offset=52), lineno=265, col_offset=39, end_lineno=265, end_col_offset=52), keyword(arg='init', value=Constant(value=False, lineno=265, col_offset=59, end_lineno=265, end_col_offset=64), lineno=265, col_offset=54, end_lineno=265, end_col_offset=64)], lineno=265, col_offset=33, end_lineno=265, end_col_offset=65), simple=1, lineno=265, col_offset=4, end_lineno=265, end_col_offset=65), FunctionDef(name='create', args=arguments(args=[arg(arg='cls', lineno=268, col_offset=15, end_lineno=268, end_col_offset=18)]), body=[Expr(value=Constant(value='Create application context from environment variables.\n\n        This is the primary way to create an ApplicationContext. It:\n        1. Loads settings from environment variables (via load_settings())\n        2. Resolves and validates all filesystem paths\n        3. Creates long-lived HTTP and index manager clients\n        4. Logs successful initialization with key configuration values\n\n        This method should be called exactly once during application startup\n        (typically in the FastAPI lifespan() function). Configuration errors\n        cause ConfigurationError to be raised, preventing application startup.\n\n        Returns\n        -------\n        ApplicationContext\n            Initialized context with all clients and configuration ready.\n\n        Raises\n        ------\n        ConfigurationError\n            If configuration is invalid (missing repo root, invalid paths, etc.).\n            This exception is raised by `resolve_application_paths()` when paths\n            cannot be resolved or validated, and propagates through this method.\n            Error includes RFC 9457 Problem Details with context for debugging.\n\n        Notes\n        -----\n        The `ConfigurationError` is raised by `resolve_application_paths()` when\n        path validation fails and propagates through this method. This ensures\n        fail-fast behavior during application startup.\n\n        Examples\n        --------\n        >>> # In FastAPI lifespan() function\n        >>> @asynccontextmanager\n        >>> async def lifespan(app: FastAPI):\n        ...     context = ApplicationContext.create()\n        ...     app.state.context = context\n        ...     yield\n\n        See Also\n        --------\n        load_settings : Loads Settings from environment variables\n        resolve_application_paths : Validates and resolves paths\n        ', lineno=269, col_offset=8, end_lineno=313, end_col_offset=11), lineno=269, col_offset=8, end_lineno=313, end_col_offset=11), Expr(value=Call(func=Attribute(value=Name(id='LOGGER', ctx=Load(), lineno=314, col_offset=8, end_lineno=314, end_col_offset=14), attr='info', ctx=Load(), lineno=314, col_offset=8, end_lineno=314, end_col_offset=19), args=[Constant(value='Loading application configuration from environment', lineno=314, col_offset=20, end_lineno=314, end_col_offset=72)], lineno=314, col_offset=8, end_lineno=314, end_col_offset=73), lineno=314, col_offset=8, end_lineno=314, end_col_offset=73), Assign(targets=[Name(id='settings', ctx=Store(), lineno=315, col_offset=8, end_lineno=315, end_col_offset=16)], value=Call(func=Name(id='load_settings', ctx=Load(), lineno=315, col_offset=19, end_lineno=315, end_col_offset=32), lineno=315, col_offset=19, end_lineno=315, end_col_offset=34), lineno=315, col_offset=8, end_lineno=315, end_col_offset=34), Try(body=[Assign(targets=[Name(id='paths', ctx=Store(), lineno=317, col_offset=12, end_lineno=317, end_col_offset=17)], value=Call(func=Name(id='resolve_application_paths', ctx=Load(), lineno=317, col_offset=20, end_lineno=317, end_col_offset=45), args=[Name(id='settings', ctx=Load(), lineno=317, col_offset=46, end_lineno=317, end_col_offset=54)], lineno=317, col_offset=20, end_lineno=317, end_col_offset=55), lineno=317, col_offset=12, end_lineno=317, end_col_offset=55)], handlers=[ExceptHandler(type=Name(id='ConfigurationError', ctx=Load(), lineno=318, col_offset=15, end_lineno=318, end_col_offset=33), body=[Raise(lineno=319, col_offset=12, end_lineno=319, end_col_offset=17)], lineno=318, col_offset=8, end_lineno=319, end_col_offset=17)], lineno=316, col_offset=8, end_lineno=319, end_col_offset=17), Assign(targets=[Name(id='vllm_client', ctx=Store(), lineno=321, col_offset=8, end_lineno=321, end_col_offset=19)], value=Call(func=Name(id='VLLMClient', ctx=Load(), lineno=321, col_offset=22, end_lineno=321, end_col_offset=32), args=[Attribute(value=Name(id='settings', ctx=Load(), lineno=321, col_offset=33, end_lineno=321, end_col_offset=41), attr='vllm', ctx=Load(), lineno=321, col_offset=33, end_lineno=321, end_col_offset=46)], lineno=321, col_offset=22, end_lineno=321, end_col_offset=47), lineno=321, col_offset=8, end_lineno=321, end_col_offset=47), Assign(targets=[Name(id='faiss_manager', ctx=Store(), lineno=322, col_offset=8, end_lineno=322, end_col_offset=21)], value=Call(func=Name(id='FAISSManager', ctx=Load(), lineno=322, col_offset=24, end_lineno=322, end_col_offset=36), keywords=[keyword(arg='index_path', value=Attribute(value=Name(id='paths', ctx=Load(), lineno=323, col_offset=23, end_lineno=323, end_col_offset=28), attr='faiss_index', ctx=Load(), lineno=323, col_offset=23, end_lineno=323, end_col_offset=40), lineno=323, col_offset=12, end_lineno=323, end_col_offset=40), keyword(arg='vec_dim', value=Attribute(value=Attribute(value=Name(id='settings', ctx=Load(), lineno=324, col_offset=20, end_lineno=324, end_col_offset=28), attr='index', ctx=Load(), lineno=324, col_offset=20, end_lineno=324, end_col_offset=34), attr='vec_dim', ctx=Load(), lineno=324, col_offset=20, end_lineno=324, end_col_offset=42), lineno=324, col_offset=12, end_lineno=324, end_col_offset=42), keyword(arg='nlist', value=Attribute(value=Attribute(value=Name(id='settings', ctx=Load(), lineno=325, col_offset=18, end_lineno=325, end_col_offset=26), attr='index', ctx=Load(), lineno=325, col_offset=18, end_lineno=325, end_col_offset=32), attr='faiss_nlist', ctx=Load(), lineno=325, col_offset=18, end_lineno=325, end_col_offset=44), lineno=325, col_offset=12, end_lineno=325, end_col_offset=44), keyword(arg='use_cuvs', value=Attribute(value=Attribute(value=Name(id='settings', ctx=Load(), lineno=326, col_offset=21, end_lineno=326, end_col_offset=29), attr='index', ctx=Load(), lineno=326, col_offset=21, end_lineno=326, end_col_offset=35), attr='use_cuvs', ctx=Load(), lineno=326, col_offset=21, end_lineno=326, end_col_offset=44), lineno=326, col_offset=12, end_lineno=326, end_col_offset=44)], lineno=322, col_offset=24, end_lineno=327, end_col_offset=9), lineno=322, col_offset=8, end_lineno=327, end_col_offset=9), Expr(value=Call(func=Attribute(value=Name(id='LOGGER', ctx=Load(), lineno=329, col_offset=8, end_lineno=329, end_col_offset=14), attr='info', ctx=Load(), lineno=329, col_offset=8, end_lineno=329, end_col_offset=19), args=[Constant(value='Application context created', lineno=330, col_offset=12, end_lineno=330, end_col_offset=41)], keywords=[keyword(arg='extra', value=Dict(keys=[Constant(value='repo_root', lineno=332, col_offset=16, end_lineno=332, end_col_offset=27), Constant(value='faiss_index', lineno=333, col_offset=16, end_lineno=333, end_col_offset=29), Constant(value='vllm_url', lineno=334, col_offset=16, end_lineno=334, end_col_offset=26)], values=[Call(func=Name(id='str', ctx=Load(), lineno=332, col_offset=29, end_lineno=332, end_col_offset=32), args=[Attribute(value=Name(id='paths', ctx=Load(), lineno=332, col_offset=33, end_lineno=332, end_col_offset=38), attr='repo_root', ctx=Load(), lineno=332, col_offset=33, end_lineno=332, end_col_offset=48)], lineno=332, col_offset=29, end_lineno=332, end_col_offset=49), Call(func=Name(id='str', ctx=Load(), lineno=333, col_offset=31, end_lineno=333, end_col_offset=34), args=[Attribute(value=Name(id='paths', ctx=Load(), lineno=333, col_offset=35, end_lineno=333, end_col_offset=40), attr='faiss_index', ctx=Load(), lineno=333, col_offset=35, end_lineno=333, end_col_offset=52)], lineno=333, col_offset=31, end_lineno=333, end_col_offset=53), Attribute(value=Attribute(value=Name(id='settings', ctx=Load(), lineno=334, col_offset=28, end_lineno=334, end_col_offset=36), attr='vllm', ctx=Load(), lineno=334, col_offset=28, end_lineno=334, end_col_offset=41), attr='base_url', ctx=Load(), lineno=334, col_offset=28, end_lineno=334, end_col_offset=50)], lineno=331, col_offset=18, end_lineno=335, end_col_offset=13), lineno=331, col_offset=12, end_lineno=335, end_col_offset=13)], lineno=329, col_offset=8, end_lineno=336, end_col_offset=9), lineno=329, col_offset=8, end_lineno=336, end_col_offset=9), Return(value=Call(func=Name(id='cls', ctx=Load(), lineno=338, col_offset=15, end_lineno=338, end_col_offset=18), keywords=[keyword(arg='settings', value=Name(id='settings', ctx=Load(), lineno=339, col_offset=21, end_lineno=339, end_col_offset=29), lineno=339, col_offset=12, end_lineno=339, end_col_offset=29), keyword(arg='paths', value=Name(id='paths', ctx=Load(), lineno=340, col_offset=18, end_lineno=340, end_col_offset=23), lineno=340, col_offset=12, end_lineno=340, end_col_offset=23), keyword(arg='vllm_client', value=Name(id='vllm_client', ctx=Load(), lineno=341, col_offset=24, end_lineno=341, end_col_offset=35), lineno=341, col_offset=12, end_lineno=341, end_col_offset=35), keyword(arg='faiss_manager', value=Name(id='faiss_manager', ctx=Load(), lineno=342, col_offset=26, end_lineno=342, end_col_offset=39), lineno=342, col_offset=12, end_lineno=342, end_col_offset=39)], lineno=338, col_offset=15, end_lineno=343, end_col_offset=9), lineno=338, col_offset=8, end_lineno=343, end_col_offset=9)], decorator_list=[Name(id='classmethod', ctx=Load(), lineno=267, col_offset=5, end_lineno=267, end_col_offset=16)], returns=Name(id='ApplicationContext', ctx=Load(), lineno=268, col_offset=23, end_lineno=268, end_col_offset=41), lineno=268, col_offset=4, end_lineno=343, end_col_offset=9), FunctionDef(name='ensure_faiss_ready', args=arguments(args=[arg(arg='self', lineno=345, col_offset=27, end_lineno=345, end_col_offset=31)]), body=[Expr(value=Constant(value='Load FAISS index (once) and attempt GPU clone.\n\n        This method is thread-safe and idempotent. On first call, it loads the\n        CPU index from disk. On subsequent calls, it returns cached state.\n        GPU cloning is attempted once (if not already done during pre-loading).\n\n        The method is typically called from semantic search adapter on first\n        search request (lazy loading) or optionally during application startup\n        (eager loading controlled by FAISS_PRELOAD environment variable).\n\n        Returns\n        -------\n        tuple[bool, list[str], str | None]\n            Three-element tuple:\n            - ready (bool): True if FAISS index is available for searching\n            - limits (list[str]): Warning messages about degraded mode (e.g.,\n              "GPU unavailable", "Index not found"). Empty list if fully ready.\n            - error (str | None): Error message if index loading failed, None\n              if successful or already loaded.\n\n        Examples\n        --------\n        >>> context = ApplicationContext.create()\n        >>> ready, limits, error = context.ensure_faiss_ready()\n        >>> if ready:\n        ...     # Proceed with search\n        ...     results = context.faiss_manager.search(query_vector, k=20)\n        ... else:\n        ...     # Handle error (return error response to client)\n        ...     print(f"FAISS unavailable: {error}")\n\n        Notes\n        -----\n        The method uses a threading.Lock to ensure only one thread loads the\n        index even under concurrent requests. Subsequent calls skip loading\n        and immediately return the cached state.\n\n        GPU initialization failures are non-fatal - the method returns ready=True\n        with a warning in the limits list. Semantic search will fall back to\n        CPU index automatically.\n        ', lineno=346, col_offset=8, end_lineno=386, end_col_offset=11), lineno=346, col_offset=8, end_lineno=386, end_col_offset=11), AnnAssign(target=Name(id='limits', ctx=Store(), lineno=387, col_offset=8, end_lineno=387, end_col_offset=14), annotation=Subscript(value=Name(id='list', ctx=Load(), lineno=387, col_offset=16, end_lineno=387, end_col_offset=20), slice=Name(id='str', ctx=Load(), lineno=387, col_offset=21, end_lineno=387, end_col_offset=24), ctx=Load(), lineno=387, col_offset=16, end_lineno=387, end_col_offset=25), value=List(ctx=Load(), lineno=387, col_offset=28, end_lineno=387, end_col_offset=30), simple=1, lineno=387, col_offset=8, end_lineno=387, end_col_offset=30), If(test=UnaryOp(op=Not(), operand=Call(func=Attribute(value=Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=389, col_offset=15, end_lineno=389, end_col_offset=19), attr='paths', ctx=Load(), lineno=389, col_offset=15, end_lineno=389, end_col_offset=25), attr='faiss_index', ctx=Load(), lineno=389, col_offset=15, end_lineno=389, end_col_offset=37), attr='exists', ctx=Load(), lineno=389, col_offset=15, end_lineno=389, end_col_offset=44), lineno=389, col_offset=15, end_lineno=389, end_col_offset=46), lineno=389, col_offset=11, end_lineno=389, end_col_offset=46), body=[Return(value=Tuple(elts=[Constant(value=False, lineno=390, col_offset=19, end_lineno=390, end_col_offset=24), Name(id='limits', ctx=Load(), lineno=390, col_offset=26, end_lineno=390, end_col_offset=32), JoinedStr(values=[Constant(value='FAISS index not found at ', lineno=390, col_offset=36, end_lineno=390, end_col_offset=61), FormattedValue(value=Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=390, col_offset=62, end_lineno=390, end_col_offset=66), attr='paths', ctx=Load(), lineno=390, col_offset=62, end_lineno=390, end_col_offset=72), attr='faiss_index', ctx=Load(), lineno=390, col_offset=62, end_lineno=390, end_col_offset=84), conversion=-1, lineno=390, col_offset=61, end_lineno=390, end_col_offset=85)], lineno=390, col_offset=34, end_lineno=390, end_col_offset=86)], ctx=Load(), lineno=390, col_offset=19, end_lineno=390, end_col_offset=86), lineno=390, col_offset=12, end_lineno=390, end_col_offset=86)], lineno=389, col_offset=8, end_lineno=390, end_col_offset=86), With(items=[withitem(context_expr=Attribute(value=Name(id='self', ctx=Load(), lineno=392, col_offset=13, end_lineno=392, end_col_offset=17), attr='_faiss_lock', ctx=Load(), lineno=392, col_offset=13, end_lineno=392, end_col_offset=29))], body=[If(test=UnaryOp(op=Not(), operand=Attribute(value=Name(id='self', ctx=Load(), lineno=393, col_offset=19, end_lineno=393, end_col_offset=23), attr='_faiss_loaded', ctx=Load(), lineno=393, col_offset=19, end_lineno=393, end_col_offset=37), lineno=393, col_offset=15, end_lineno=393, end_col_offset=37), body=[Try(body=[Expr(value=Call(func=Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=395, col_offset=20, end_lineno=395, end_col_offset=24), attr='faiss_manager', ctx=Load(), lineno=395, col_offset=20, end_lineno=395, end_col_offset=38), attr='load_cpu_index', ctx=Load(), lineno=395, col_offset=20, end_lineno=395, end_col_offset=53), lineno=395, col_offset=20, end_lineno=395, end_col_offset=55), lineno=395, col_offset=20, end_lineno=395, end_col_offset=55)], handlers=[ExceptHandler(type=Tuple(elts=[Name(id='FileNotFoundError', ctx=Load(), lineno=396, col_offset=24, end_lineno=396, end_col_offset=41), Name(id='RuntimeError', ctx=Load(), lineno=396, col_offset=43, end_lineno=396, end_col_offset=55)], ctx=Load(), lineno=396, col_offset=23, end_lineno=396, end_col_offset=56), name='exc', body=[Return(value=Tuple(elts=[Constant(value=False, lineno=397, col_offset=27, end_lineno=397, end_col_offset=32), Name(id='limits', ctx=Load(), lineno=397, col_offset=34, end_lineno=397, end_col_offset=40), JoinedStr(values=[Constant(value='FAISS index load failed: ', lineno=397, col_offset=44, end_lineno=397, end_col_offset=69), FormattedValue(value=Name(id='exc', ctx=Load(), lineno=397, col_offset=70, end_lineno=397, end_col_offset=73), conversion=-1, lineno=397, col_offset=69, end_lineno=397, end_col_offset=74)], lineno=397, col_offset=42, end_lineno=397, end_col_offset=75)], ctx=Load(), lineno=397, col_offset=27, end_lineno=397, end_col_offset=75), lineno=397, col_offset=20, end_lineno=397, end_col_offset=75)], lineno=396, col_offset=16, end_lineno=397, end_col_offset=75)], lineno=394, col_offset=16, end_lineno=397, end_col_offset=75), Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=398, col_offset=16, end_lineno=398, end_col_offset=20), attr='_faiss_loaded', ctx=Store(), lineno=398, col_offset=16, end_lineno=398, end_col_offset=34)], value=Constant(value=True, lineno=398, col_offset=37, end_lineno=398, end_col_offset=41), lineno=398, col_offset=16, end_lineno=398, end_col_offset=41)], lineno=393, col_offset=12, end_lineno=398, end_col_offset=41), If(test=BoolOp(op=And(), values=[Compare(left=Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=400, col_offset=15, end_lineno=400, end_col_offset=19), attr='faiss_manager', ctx=Load(), lineno=400, col_offset=15, end_lineno=400, end_col_offset=33), attr='gpu_index', ctx=Load(), lineno=400, col_offset=15, end_lineno=400, end_col_offset=43), ops=[Is()], comparators=[Constant(value=None, lineno=400, col_offset=47, end_lineno=400, end_col_offset=51)], lineno=400, col_offset=15, end_lineno=400, end_col_offset=51), UnaryOp(op=Not(), operand=Attribute(value=Name(id='self', ctx=Load(), lineno=400, col_offset=60, end_lineno=400, end_col_offset=64), attr='_faiss_gpu_attempted', ctx=Load(), lineno=400, col_offset=60, end_lineno=400, end_col_offset=85), lineno=400, col_offset=56, end_lineno=400, end_col_offset=85)], lineno=400, col_offset=15, end_lineno=400, end_col_offset=85), body=[Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=401, col_offset=16, end_lineno=401, end_col_offset=20), attr='_faiss_gpu_attempted', ctx=Store(), lineno=401, col_offset=16, end_lineno=401, end_col_offset=41)], value=Constant(value=True, lineno=401, col_offset=44, end_lineno=401, end_col_offset=48), lineno=401, col_offset=16, end_lineno=401, end_col_offset=48), Try(body=[Assign(targets=[Name(id='gpu_enabled', ctx=Store(), lineno=403, col_offset=20, end_lineno=403, end_col_offset=31)], value=Call(func=Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=403, col_offset=34, end_lineno=403, end_col_offset=38), attr='faiss_manager', ctx=Load(), lineno=403, col_offset=34, end_lineno=403, end_col_offset=52), attr='clone_to_gpu', ctx=Load(), lineno=403, col_offset=34, end_lineno=403, end_col_offset=65), lineno=403, col_offset=34, end_lineno=403, end_col_offset=67), lineno=403, col_offset=20, end_lineno=403, end_col_offset=67)], handlers=[ExceptHandler(type=Name(id='RuntimeError', ctx=Load(), lineno=404, col_offset=23, end_lineno=404, end_col_offset=35), name='exc', body=[Expr(value=Call(func=Attribute(value=Name(id='limits', ctx=Load(), lineno=405, col_offset=20, end_lineno=405, end_col_offset=26), attr='append', ctx=Load(), lineno=405, col_offset=20, end_lineno=405, end_col_offset=33), args=[Call(func=Name(id='str', ctx=Load(), lineno=405, col_offset=34, end_lineno=405, end_col_offset=37), args=[Name(id='exc', ctx=Load(), lineno=405, col_offset=38, end_lineno=405, end_col_offset=41)], lineno=405, col_offset=34, end_lineno=405, end_col_offset=42)], lineno=405, col_offset=20, end_lineno=405, end_col_offset=43), lineno=405, col_offset=20, end_lineno=405, end_col_offset=43), Assign(targets=[Name(id='gpu_enabled', ctx=Store(), lineno=406, col_offset=20, end_lineno=406, end_col_offset=31)], value=Constant(value=False, lineno=406, col_offset=34, end_lineno=406, end_col_offset=39), lineno=406, col_offset=20, end_lineno=406, end_col_offset=39)], lineno=404, col_offset=16, end_lineno=406, end_col_offset=39)], lineno=402, col_offset=16, end_lineno=406, end_col_offset=39), If(test=BoolOp(op=And(), values=[UnaryOp(op=Not(), operand=Name(id='gpu_enabled', ctx=Load(), lineno=407, col_offset=23, end_lineno=407, end_col_offset=34), lineno=407, col_offset=19, end_lineno=407, end_col_offset=34), Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=407, col_offset=39, end_lineno=407, end_col_offset=43), attr='faiss_manager', ctx=Load(), lineno=407, col_offset=39, end_lineno=407, end_col_offset=57), attr='gpu_disabled_reason', ctx=Load(), lineno=407, col_offset=39, end_lineno=407, end_col_offset=77)], lineno=407, col_offset=19, end_lineno=407, end_col_offset=77), body=[Expr(value=Call(func=Attribute(value=Name(id='limits', ctx=Load(), lineno=408, col_offset=20, end_lineno=408, end_col_offset=26), attr='append', ctx=Load(), lineno=408, col_offset=20, end_lineno=408, end_col_offset=33), args=[Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=408, col_offset=34, end_lineno=408, end_col_offset=38), attr='faiss_manager', ctx=Load(), lineno=408, col_offset=34, end_lineno=408, end_col_offset=52), attr='gpu_disabled_reason', ctx=Load(), lineno=408, col_offset=34, end_lineno=408, end_col_offset=72)], lineno=408, col_offset=20, end_lineno=408, end_col_offset=73), lineno=408, col_offset=20, end_lineno=408, end_col_offset=73)], lineno=407, col_offset=16, end_lineno=408, end_col_offset=73)], orelse=[If(test=BoolOp(op=And(), values=[Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=410, col_offset=16, end_lineno=410, end_col_offset=20), attr='faiss_manager', ctx=Load(), lineno=410, col_offset=16, end_lineno=410, end_col_offset=34), attr='gpu_disabled_reason', ctx=Load(), lineno=410, col_offset=16, end_lineno=410, end_col_offset=54), Compare(left=Call(func=Attribute(value=Name(id='limits', ctx=Load(), lineno=411, col_offset=20, end_lineno=411, end_col_offset=26), attr='count', ctx=Load(), lineno=411, col_offset=20, end_lineno=411, end_col_offset=32), args=[Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=411, col_offset=33, end_lineno=411, end_col_offset=37), attr='faiss_manager', ctx=Load(), lineno=411, col_offset=33, end_lineno=411, end_col_offset=51), attr='gpu_disabled_reason', ctx=Load(), lineno=411, col_offset=33, end_lineno=411, end_col_offset=71)], lineno=411, col_offset=20, end_lineno=411, end_col_offset=72), ops=[Eq()], comparators=[Constant(value=0, lineno=411, col_offset=76, end_lineno=411, end_col_offset=77)], lineno=411, col_offset=20, end_lineno=411, end_col_offset=77)], lineno=410, col_offset=16, end_lineno=411, end_col_offset=77), body=[Expr(value=Call(func=Attribute(value=Name(id='limits', ctx=Load(), lineno=413, col_offset=16, end_lineno=413, end_col_offset=22), attr='append', ctx=Load(), lineno=413, col_offset=16, end_lineno=413, end_col_offset=29), args=[Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=413, col_offset=30, end_lineno=413, end_col_offset=34), attr='faiss_manager', ctx=Load(), lineno=413, col_offset=30, end_lineno=413, end_col_offset=48), attr='gpu_disabled_reason', ctx=Load(), lineno=413, col_offset=30, end_lineno=413, end_col_offset=68)], lineno=413, col_offset=16, end_lineno=413, end_col_offset=69), lineno=413, col_offset=16, end_lineno=413, end_col_offset=69)], lineno=409, col_offset=12, end_lineno=413, end_col_offset=69)], lineno=400, col_offset=12, end_lineno=413, end_col_offset=69)], lineno=392, col_offset=8, end_lineno=413, end_col_offset=69), Return(value=Tuple(elts=[Constant(value=True, lineno=415, col_offset=15, end_lineno=415, end_col_offset=19), Name(id='limits', ctx=Load(), lineno=415, col_offset=21, end_lineno=415, end_col_offset=27), Constant(value=None, lineno=415, col_offset=29, end_lineno=415, end_col_offset=33)], ctx=Load(), lineno=415, col_offset=15, end_lineno=415, end_col_offset=33), lineno=415, col_offset=8, end_lineno=415, end_col_offset=33)], returns=Subscript(value=Name(id='tuple', ctx=Load(), lineno=345, col_offset=36, end_lineno=345, end_col_offset=41), slice=Tuple(elts=[Name(id='bool', ctx=Load(), lineno=345, col_offset=42, end_lineno=345, end_col_offset=46), Subscript(value=Name(id='list', ctx=Load(), lineno=345, col_offset=48, end_lineno=345, end_col_offset=52), slice=Name(id='str', ctx=Load(), lineno=345, col_offset=53, end_lineno=345, end_col_offset=56), ctx=Load(), lineno=345, col_offset=48, end_lineno=345, end_col_offset=57), BinOp(left=Name(id='str', ctx=Load(), lineno=345, col_offset=59, end_lineno=345, end_col_offset=62), op=BitOr(), right=Constant(value=None, lineno=345, col_offset=65, end_lineno=345, end_col_offset=69), lineno=345, col_offset=59, end_lineno=345, end_col_offset=69)], ctx=Load(), lineno=345, col_offset=42, end_lineno=345, end_col_offset=69), ctx=Load(), lineno=345, col_offset=36, end_lineno=345, end_col_offset=70), lineno=345, col_offset=4, end_lineno=415, end_col_offset=33), FunctionDef(name='open_catalog', args=arguments(args=[arg(arg='self', lineno=418, col_offset=21, end_lineno=418, end_col_offset=25)]), body=[Expr(value=Constant(value='Yield a DuckDB catalog context manager.\n\n        Opens a connection to the DuckDB catalog containing chunk metadata,\n        yields the catalog instance for querying, and ensures the connection\n        is closed even if an exception occurs.\n\n        The catalog provides SQL access to chunk metadata (URIs, line numbers,\n        preview text) stored in Parquet files. It\'s used to hydrate FAISS\n        search results with full chunk information.\n\n        Yields\n        ------\n        DuckDBCatalog\n            Catalog instance with active database connection. Supports querying\n            by chunk IDs, URIs, and other metadata fields.\n\n        Examples\n        --------\n        >>> with context.open_catalog() as catalog:\n        ...     chunks = catalog.query_by_ids([1, 2, 3])\n        ...     for chunk in chunks:\n        ...         print(chunk["uri"], chunk["preview"])\n\n        Notes\n        -----\n        The catalog connection is automatically closed when the context manager\n        exits, even if an exception is raised. This ensures no connection leaks.\n\n        See Also\n        --------\n        codeintel_rev.io.duckdb_catalog.DuckDBCatalog : Catalog implementation\n        ', lineno=419, col_offset=8, end_lineno=450, end_col_offset=11), lineno=419, col_offset=8, end_lineno=450, end_col_offset=11), Assign(targets=[Name(id='catalog', ctx=Store(), lineno=451, col_offset=8, end_lineno=451, end_col_offset=15)], value=Call(func=Name(id='DuckDBCatalog', ctx=Load(), lineno=451, col_offset=18, end_lineno=451, end_col_offset=31), args=[Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=451, col_offset=32, end_lineno=451, end_col_offset=36), attr='paths', ctx=Load(), lineno=451, col_offset=32, end_lineno=451, end_col_offset=42), attr='duckdb_path', ctx=Load(), lineno=451, col_offset=32, end_lineno=451, end_col_offset=54), Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=451, col_offset=56, end_lineno=451, end_col_offset=60), attr='paths', ctx=Load(), lineno=451, col_offset=56, end_lineno=451, end_col_offset=66), attr='vectors_dir', ctx=Load(), lineno=451, col_offset=56, end_lineno=451, end_col_offset=78)], lineno=451, col_offset=18, end_lineno=451, end_col_offset=79), lineno=451, col_offset=8, end_lineno=451, end_col_offset=79), Try(body=[Expr(value=Call(func=Attribute(value=Name(id='catalog', ctx=Load(), lineno=453, col_offset=12, end_lineno=453, end_col_offset=19), attr='open', ctx=Load(), lineno=453, col_offset=12, end_lineno=453, end_col_offset=24), lineno=453, col_offset=12, end_lineno=453, end_col_offset=26), lineno=453, col_offset=12, end_lineno=453, end_col_offset=26), Expr(value=Yield(value=Name(id='catalog', ctx=Load(), lineno=454, col_offset=18, end_lineno=454, end_col_offset=25), lineno=454, col_offset=12, end_lineno=454, end_col_offset=25), lineno=454, col_offset=12, end_lineno=454, end_col_offset=25)], finalbody=[Expr(value=Call(func=Attribute(value=Name(id='catalog', ctx=Load(), lineno=456, col_offset=12, end_lineno=456, end_col_offset=19), attr='close', ctx=Load(), lineno=456, col_offset=12, end_lineno=456, end_col_offset=25), lineno=456, col_offset=12, end_lineno=456, end_col_offset=27), lineno=456, col_offset=12, end_lineno=456, end_col_offset=27)], lineno=452, col_offset=8, end_lineno=456, end_col_offset=27)], decorator_list=[Name(id='contextmanager', ctx=Load(), lineno=417, col_offset=5, end_lineno=417, end_col_offset=19)], returns=Subscript(value=Name(id='Iterator', ctx=Load(), lineno=418, col_offset=30, end_lineno=418, end_col_offset=38), slice=Name(id='DuckDBCatalog', ctx=Load(), lineno=418, col_offset=39, end_lineno=418, end_col_offset=52), ctx=Load(), lineno=418, col_offset=30, end_lineno=418, end_col_offset=53), lineno=418, col_offset=4, end_lineno=456, end_col_offset=27)], decorator_list=[Call(func=Name(id='dataclass', ctx=Load(), lineno=198, col_offset=1, end_lineno=198, end_col_offset=10), keywords=[keyword(arg='slots', value=Constant(value=True, lineno=198, col_offset=17, end_lineno=198, end_col_offset=21), lineno=198, col_offset=11, end_lineno=198, end_col_offset=21), keyword(arg='frozen', value=Constant(value=True, lineno=198, col_offset=30, end_lineno=198, end_col_offset=34), lineno=198, col_offset=23, end_lineno=198, end_col_offset=34)], lineno=198, col_offset=1, end_lineno=198, end_col_offset=35)], lineno=199, col_offset=0, end_lineno=456, end_col_offset=27)])