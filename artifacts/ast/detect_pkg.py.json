Module(body=[Expr(value=Constant(value='Identify canonical kgfoundry packages for repository automation.\n\nThis script scans the repository layout to discover eligible package directories and orders them so\nhelper tools can consistently select a primary target. It mirrors the behaviour of the historical\nshell script while filtering out non-package utilities.\n', lineno=1, col_offset=0, end_lineno=6, end_col_offset=3), lineno=1, col_offset=0, end_lineno=6, end_col_offset=3), ImportFrom(module='__future__', names=[alias(name='annotations', lineno=8, col_offset=23, end_lineno=8, end_col_offset=34)], level=0, lineno=8, col_offset=0, end_lineno=8, end_col_offset=34), Import(names=[alias(name='sys', lineno=10, col_offset=7, end_lineno=10, end_col_offset=10)], lineno=10, col_offset=0, end_lineno=10, end_col_offset=10), ImportFrom(module='pathlib', names=[alias(name='Path', lineno=11, col_offset=20, end_lineno=11, end_col_offset=24)], level=0, lineno=11, col_offset=0, end_lineno=11, end_col_offset=24), Assign(targets=[Name(id='ROOT', ctx=Store(), lineno=13, col_offset=0, end_lineno=13, end_col_offset=4)], value=Subscript(value=Attribute(value=Call(func=Attribute(value=Call(func=Name(id='Path', ctx=Load(), lineno=13, col_offset=7, end_lineno=13, end_col_offset=11), args=[Name(id='__file__', ctx=Load(), lineno=13, col_offset=12, end_lineno=13, end_col_offset=20)], lineno=13, col_offset=7, end_lineno=13, end_col_offset=21), attr='resolve', ctx=Load(), lineno=13, col_offset=7, end_lineno=13, end_col_offset=29), lineno=13, col_offset=7, end_lineno=13, end_col_offset=31), attr='parents', ctx=Load(), lineno=13, col_offset=7, end_lineno=13, end_col_offset=39), slice=Constant(value=1, lineno=13, col_offset=40, end_lineno=13, end_col_offset=41), ctx=Load(), lineno=13, col_offset=7, end_lineno=13, end_col_offset=42), lineno=13, col_offset=0, end_lineno=13, end_col_offset=42), Assign(targets=[Name(id='SRC', ctx=Store(), lineno=14, col_offset=0, end_lineno=14, end_col_offset=3)], value=BinOp(left=Name(id='ROOT', ctx=Load(), lineno=14, col_offset=6, end_lineno=14, end_col_offset=10), op=Div(), right=Constant(value='src', lineno=14, col_offset=13, end_lineno=14, end_col_offset=18), lineno=14, col_offset=6, end_lineno=14, end_col_offset=18), lineno=14, col_offset=0, end_lineno=14, end_col_offset=18), FunctionDef(name='_candidate_names', args=arguments(), body=[Expr(value=Constant(value='Collect package names discoverable from the repository layout.\n\n    The search considers ``src/<package>/__init__.py`` as well as top-level\n    packages that expose an ``__init__`` file. Utility directories such as\n    ``docs`` and ``tools`` are ignored.\n\n    Returns\n    -------\n    list[str]\n        Sorted list of unique package directory names.\n\n    Raises\n    ------\n    SystemExit\n        Raised when no package candidates are found, mirroring the behaviour of\n        the historical shell script this tool replaces.\n    ', lineno=18, col_offset=4, end_lineno=34, end_col_offset=7), lineno=18, col_offset=4, end_lineno=34, end_col_offset=7), AnnAssign(target=Name(id='names', ctx=Store(), lineno=35, col_offset=4, end_lineno=35, end_col_offset=9), annotation=Subscript(value=Name(id='set', ctx=Load(), lineno=35, col_offset=11, end_lineno=35, end_col_offset=14), slice=Name(id='str', ctx=Load(), lineno=35, col_offset=15, end_lineno=35, end_col_offset=18), ctx=Load(), lineno=35, col_offset=11, end_lineno=35, end_col_offset=19), value=Call(func=Name(id='set', ctx=Load(), lineno=35, col_offset=22, end_lineno=35, end_col_offset=25), lineno=35, col_offset=22, end_lineno=35, end_col_offset=27), simple=1, lineno=35, col_offset=4, end_lineno=35, end_col_offset=27), If(test=Call(func=Attribute(value=Name(id='SRC', ctx=Load(), lineno=36, col_offset=7, end_lineno=36, end_col_offset=10), attr='exists', ctx=Load(), lineno=36, col_offset=7, end_lineno=36, end_col_offset=17), lineno=36, col_offset=7, end_lineno=36, end_col_offset=19), body=[Expr(value=Call(func=Attribute(value=Name(id='names', ctx=Load(), lineno=37, col_offset=8, end_lineno=37, end_col_offset=13), attr='update', ctx=Load(), lineno=37, col_offset=8, end_lineno=37, end_col_offset=20), args=[GeneratorExp(elt=Attribute(value=Attribute(value=Name(id='p', ctx=Load(), lineno=37, col_offset=21, end_lineno=37, end_col_offset=22), attr='parent', ctx=Load(), lineno=37, col_offset=21, end_lineno=37, end_col_offset=29), attr='name', ctx=Load(), lineno=37, col_offset=21, end_lineno=37, end_col_offset=34), generators=[comprehension(target=Name(id='p', ctx=Store(), lineno=37, col_offset=39, end_lineno=37, end_col_offset=40), iter=Call(func=Attribute(value=Name(id='SRC', ctx=Load(), lineno=37, col_offset=44, end_lineno=37, end_col_offset=47), attr='glob', ctx=Load(), lineno=37, col_offset=44, end_lineno=37, end_col_offset=52), args=[Constant(value='*/__init__.py', lineno=37, col_offset=53, end_lineno=37, end_col_offset=68)], lineno=37, col_offset=44, end_lineno=37, end_col_offset=69), is_async=0)], lineno=37, col_offset=20, end_lineno=37, end_col_offset=70)], lineno=37, col_offset=8, end_lineno=37, end_col_offset=70), lineno=37, col_offset=8, end_lineno=37, end_col_offset=70)], lineno=36, col_offset=4, end_lineno=37, end_col_offset=70), Expr(value=Call(func=Attribute(value=Name(id='names', ctx=Load(), lineno=38, col_offset=4, end_lineno=38, end_col_offset=9), attr='update', ctx=Load(), lineno=38, col_offset=4, end_lineno=38, end_col_offset=16), args=[GeneratorExp(elt=Attribute(value=Attribute(value=Name(id='p', ctx=Load(), lineno=39, col_offset=8, end_lineno=39, end_col_offset=9), attr='parent', ctx=Load(), lineno=39, col_offset=8, end_lineno=39, end_col_offset=16), attr='name', ctx=Load(), lineno=39, col_offset=8, end_lineno=39, end_col_offset=21), generators=[comprehension(target=Name(id='p', ctx=Store(), lineno=40, col_offset=12, end_lineno=40, end_col_offset=13), iter=Call(func=Attribute(value=Name(id='ROOT', ctx=Load(), lineno=40, col_offset=17, end_lineno=40, end_col_offset=21), attr='glob', ctx=Load(), lineno=40, col_offset=17, end_lineno=40, end_col_offset=26), args=[Constant(value='*/__init__.py', lineno=40, col_offset=27, end_lineno=40, end_col_offset=42)], lineno=40, col_offset=17, end_lineno=40, end_col_offset=43), ifs=[Compare(left=Attribute(value=Attribute(value=Name(id='p', ctx=Load(), lineno=41, col_offset=11, end_lineno=41, end_col_offset=12), attr='parent', ctx=Load(), lineno=41, col_offset=11, end_lineno=41, end_col_offset=19), attr='name', ctx=Load(), lineno=41, col_offset=11, end_lineno=41, end_col_offset=24), ops=[NotIn()], comparators=[Set(elts=[Constant(value='docs', lineno=41, col_offset=33, end_lineno=41, end_col_offset=39), Constant(value='tools', lineno=41, col_offset=41, end_lineno=41, end_col_offset=48), Constant(value='optional', lineno=41, col_offset=50, end_lineno=41, end_col_offset=60)], lineno=41, col_offset=32, end_lineno=41, end_col_offset=61)], lineno=41, col_offset=11, end_lineno=41, end_col_offset=61)], is_async=0)], lineno=38, col_offset=16, end_lineno=42, end_col_offset=5)], lineno=38, col_offset=4, end_lineno=42, end_col_offset=5), lineno=38, col_offset=4, end_lineno=42, end_col_offset=5), If(test=UnaryOp(op=Not(), operand=Name(id='names', ctx=Load(), lineno=43, col_offset=11, end_lineno=43, end_col_offset=16), lineno=43, col_offset=7, end_lineno=43, end_col_offset=16), body=[Raise(exc=Call(func=Name(id='SystemExit', ctx=Load(), lineno=44, col_offset=14, end_lineno=44, end_col_offset=24), args=[Constant(value=1, lineno=44, col_offset=25, end_lineno=44, end_col_offset=26)], lineno=44, col_offset=14, end_lineno=44, end_col_offset=27), lineno=44, col_offset=8, end_lineno=44, end_col_offset=27)], lineno=43, col_offset=4, end_lineno=44, end_col_offset=27), Expr(value=Call(func=Attribute(value=Name(id='names', ctx=Load(), lineno=45, col_offset=4, end_lineno=45, end_col_offset=9), attr='discard', ctx=Load(), lineno=45, col_offset=4, end_lineno=45, end_col_offset=17), args=[Constant(value='src', lineno=45, col_offset=18, end_lineno=45, end_col_offset=23)], lineno=45, col_offset=4, end_lineno=45, end_col_offset=24), lineno=45, col_offset=4, end_lineno=45, end_col_offset=24), Return(value=Call(func=Name(id='sorted', ctx=Load(), lineno=46, col_offset=11, end_lineno=46, end_col_offset=17), args=[Name(id='names', ctx=Load(), lineno=46, col_offset=18, end_lineno=46, end_col_offset=23)], lineno=46, col_offset=11, end_lineno=46, end_col_offset=24), lineno=46, col_offset=4, end_lineno=46, end_col_offset=24)], returns=Subscript(value=Name(id='list', ctx=Load(), lineno=17, col_offset=26, end_lineno=17, end_col_offset=30), slice=Name(id='str', ctx=Load(), lineno=17, col_offset=31, end_lineno=17, end_col_offset=34), ctx=Load(), lineno=17, col_offset=26, end_lineno=17, end_col_offset=35), lineno=17, col_offset=0, end_lineno=46, end_col_offset=24), FunctionDef(name='detect_packages', args=arguments(), body=[Expr(value=Constant(value='Return preferred package names ordered by namespace relevance.\n\n    Packages containing ``kgfoundry`` bubble to the front, followed by other\n    lowercase candidates. The ordering matches the expectations of scripts that\n    need a deterministic primary package name.\n\n    Returns\n    -------\n    list[str]\n        Package names ordered by preference.\n    ', lineno=50, col_offset=4, end_lineno=60, end_col_offset=7), lineno=50, col_offset=4, end_lineno=60, end_col_offset=7), Assign(targets=[Name(id='candidates', ctx=Store(), lineno=61, col_offset=4, end_lineno=61, end_col_offset=14)], value=Call(func=Name(id='_candidate_names', ctx=Load(), lineno=61, col_offset=17, end_lineno=61, end_col_offset=33), lineno=61, col_offset=17, end_lineno=61, end_col_offset=35), lineno=61, col_offset=4, end_lineno=61, end_col_offset=35), Assign(targets=[Name(id='lowers', ctx=Store(), lineno=62, col_offset=4, end_lineno=62, end_col_offset=10)], value=ListComp(elt=Name(id='c', ctx=Load(), lineno=62, col_offset=14, end_lineno=62, end_col_offset=15), generators=[comprehension(target=Name(id='c', ctx=Store(), lineno=62, col_offset=20, end_lineno=62, end_col_offset=21), iter=Name(id='candidates', ctx=Load(), lineno=62, col_offset=25, end_lineno=62, end_col_offset=35), ifs=[Call(func=Attribute(value=Name(id='c', ctx=Load(), lineno=62, col_offset=39, end_lineno=62, end_col_offset=40), attr='islower', ctx=Load(), lineno=62, col_offset=39, end_lineno=62, end_col_offset=48), lineno=62, col_offset=39, end_lineno=62, end_col_offset=50)], is_async=0)], lineno=62, col_offset=13, end_lineno=62, end_col_offset=51), lineno=62, col_offset=4, end_lineno=62, end_col_offset=51), Assign(targets=[Name(id='base', ctx=Store(), lineno=63, col_offset=4, end_lineno=63, end_col_offset=8)], value=BoolOp(op=Or(), values=[Name(id='lowers', ctx=Load(), lineno=63, col_offset=11, end_lineno=63, end_col_offset=17), Name(id='candidates', ctx=Load(), lineno=63, col_offset=21, end_lineno=63, end_col_offset=31)], lineno=63, col_offset=11, end_lineno=63, end_col_offset=31), lineno=63, col_offset=4, end_lineno=63, end_col_offset=31), Assign(targets=[Name(id='preferred', ctx=Store(), lineno=64, col_offset=4, end_lineno=64, end_col_offset=13)], value=ListComp(elt=Name(id='c', ctx=Load(), lineno=64, col_offset=17, end_lineno=64, end_col_offset=18), generators=[comprehension(target=Name(id='c', ctx=Store(), lineno=64, col_offset=23, end_lineno=64, end_col_offset=24), iter=Name(id='base', ctx=Load(), lineno=64, col_offset=28, end_lineno=64, end_col_offset=32), ifs=[Compare(left=Constant(value='kgfoundry', lineno=64, col_offset=36, end_lineno=64, end_col_offset=47), ops=[In()], comparators=[Name(id='c', ctx=Load(), lineno=64, col_offset=51, end_lineno=64, end_col_offset=52)], lineno=64, col_offset=36, end_lineno=64, end_col_offset=52)], is_async=0)], lineno=64, col_offset=16, end_lineno=64, end_col_offset=53), lineno=64, col_offset=4, end_lineno=64, end_col_offset=53), Return(value=BinOp(left=Name(id='preferred', ctx=Load(), lineno=65, col_offset=11, end_lineno=65, end_col_offset=20), op=Add(), right=ListComp(elt=Name(id='c', ctx=Load(), lineno=65, col_offset=24, end_lineno=65, end_col_offset=25), generators=[comprehension(target=Name(id='c', ctx=Store(), lineno=65, col_offset=30, end_lineno=65, end_col_offset=31), iter=Name(id='base', ctx=Load(), lineno=65, col_offset=35, end_lineno=65, end_col_offset=39), ifs=[Compare(left=Name(id='c', ctx=Load(), lineno=65, col_offset=43, end_lineno=65, end_col_offset=44), ops=[NotIn()], comparators=[Name(id='preferred', ctx=Load(), lineno=65, col_offset=52, end_lineno=65, end_col_offset=61)], lineno=65, col_offset=43, end_lineno=65, end_col_offset=61)], is_async=0)], lineno=65, col_offset=23, end_lineno=65, end_col_offset=62), lineno=65, col_offset=11, end_lineno=65, end_col_offset=62), lineno=65, col_offset=4, end_lineno=65, end_col_offset=62)], returns=Subscript(value=Name(id='list', ctx=Load(), lineno=49, col_offset=25, end_lineno=49, end_col_offset=29), slice=Name(id='str', ctx=Load(), lineno=49, col_offset=30, end_lineno=49, end_col_offset=33), ctx=Load(), lineno=49, col_offset=25, end_lineno=49, end_col_offset=34), lineno=49, col_offset=0, end_lineno=65, end_col_offset=62), FunctionDef(name='detect_primary', args=arguments(), body=[Expr(value=Constant(value='Return the first preferred package name.\n\n    Returns\n    -------\n    str\n        The canonical package name used by tooling that only supports a single\n        package.\n    ', lineno=69, col_offset=4, end_lineno=76, end_col_offset=7), lineno=69, col_offset=4, end_lineno=76, end_col_offset=7), Assign(targets=[Name(id='packages', ctx=Store(), lineno=77, col_offset=4, end_lineno=77, end_col_offset=12)], value=Call(func=Name(id='detect_packages', ctx=Load(), lineno=77, col_offset=15, end_lineno=77, end_col_offset=30), lineno=77, col_offset=15, end_lineno=77, end_col_offset=32), lineno=77, col_offset=4, end_lineno=77, end_col_offset=32), Return(value=Subscript(value=Name(id='packages', ctx=Load(), lineno=78, col_offset=11, end_lineno=78, end_col_offset=19), slice=Constant(value=0, lineno=78, col_offset=20, end_lineno=78, end_col_offset=21), ctx=Load(), lineno=78, col_offset=11, end_lineno=78, end_col_offset=22), lineno=78, col_offset=4, end_lineno=78, end_col_offset=22)], returns=Name(id='str', ctx=Load(), lineno=68, col_offset=24, end_lineno=68, end_col_offset=27), lineno=68, col_offset=0, end_lineno=78, end_col_offset=22), If(test=Compare(left=Name(id='__name__', ctx=Load(), lineno=81, col_offset=3, end_lineno=81, end_col_offset=11), ops=[Eq()], comparators=[Constant(value='__main__', lineno=81, col_offset=15, end_lineno=81, end_col_offset=25)], lineno=81, col_offset=3, end_lineno=81, end_col_offset=25), body=[If(test=Compare(left=Constant(value='--all', lineno=82, col_offset=7, end_lineno=82, end_col_offset=14), ops=[In()], comparators=[Attribute(value=Name(id='sys', ctx=Load(), lineno=82, col_offset=18, end_lineno=82, end_col_offset=21), attr='argv', ctx=Load(), lineno=82, col_offset=18, end_lineno=82, end_col_offset=26)], lineno=82, col_offset=7, end_lineno=82, end_col_offset=26), body=[For(target=Name(id='name', ctx=Store(), lineno=83, col_offset=12, end_lineno=83, end_col_offset=16), iter=Call(func=Name(id='detect_packages', ctx=Load(), lineno=83, col_offset=20, end_lineno=83, end_col_offset=35), lineno=83, col_offset=20, end_lineno=83, end_col_offset=37), body=[Expr(value=Call(func=Attribute(value=Attribute(value=Name(id='sys', ctx=Load(), lineno=84, col_offset=12, end_lineno=84, end_col_offset=15), attr='stdout', ctx=Load(), lineno=84, col_offset=12, end_lineno=84, end_col_offset=22), attr='write', ctx=Load(), lineno=84, col_offset=12, end_lineno=84, end_col_offset=28), args=[JoinedStr(values=[FormattedValue(value=Name(id='name', ctx=Load(), lineno=84, col_offset=32, end_lineno=84, end_col_offset=36), conversion=-1, lineno=84, col_offset=31, end_lineno=84, end_col_offset=37), Constant(value='\n', lineno=84, col_offset=37, end_lineno=84, end_col_offset=39)], lineno=84, col_offset=29, end_lineno=84, end_col_offset=40)], lineno=84, col_offset=12, end_lineno=84, end_col_offset=41), lineno=84, col_offset=12, end_lineno=84, end_col_offset=41)], lineno=83, col_offset=8, end_lineno=84, end_col_offset=41)], orelse=[Expr(value=Call(func=Attribute(value=Attribute(value=Name(id='sys', ctx=Load(), lineno=86, col_offset=8, end_lineno=86, end_col_offset=11), attr='stdout', ctx=Load(), lineno=86, col_offset=8, end_lineno=86, end_col_offset=18), attr='write', ctx=Load(), lineno=86, col_offset=8, end_lineno=86, end_col_offset=24), args=[JoinedStr(values=[FormattedValue(value=Call(func=Name(id='detect_primary', ctx=Load(), lineno=86, col_offset=28, end_lineno=86, end_col_offset=42), lineno=86, col_offset=28, end_lineno=86, end_col_offset=44), conversion=-1, lineno=86, col_offset=27, end_lineno=86, end_col_offset=45), Constant(value='\n', lineno=86, col_offset=45, end_lineno=86, end_col_offset=47)], lineno=86, col_offset=25, end_lineno=86, end_col_offset=48)], lineno=86, col_offset=8, end_lineno=86, end_col_offset=49), lineno=86, col_offset=8, end_lineno=86, end_col_offset=49)], lineno=82, col_offset=4, end_lineno=86, end_col_offset=49)], lineno=81, col_offset=0, end_lineno=86, end_col_offset=49)])