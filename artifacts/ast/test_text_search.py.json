Module(body=[Expr(value=Constant(value='Unit tests for the text search adapter.', lineno=1, col_offset=0, end_lineno=1, end_col_offset=45), lineno=1, col_offset=0, end_lineno=1, end_col_offset=45), ImportFrom(module='__future__', names=[alias(name='annotations', lineno=3, col_offset=23, end_lineno=3, end_col_offset=34)], level=0, lineno=3, col_offset=0, end_lineno=3, end_col_offset=34), Import(names=[alias(name='json', lineno=5, col_offset=7, end_lineno=5, end_col_offset=11)], lineno=5, col_offset=0, end_lineno=5, end_col_offset=11), ImportFrom(module='pathlib', names=[alias(name='Path', lineno=6, col_offset=20, end_lineno=6, end_col_offset=24)], level=0, lineno=6, col_offset=0, end_lineno=6, end_col_offset=24), Import(names=[alias(name='pytest', lineno=8, col_offset=7, end_lineno=8, end_col_offset=13)], lineno=8, col_offset=0, end_lineno=8, end_col_offset=13), ImportFrom(module='codeintel_rev.mcp_server.adapters', names=[alias(name='text_search', lineno=9, col_offset=46, end_lineno=9, end_col_offset=57)], level=0, lineno=9, col_offset=0, end_lineno=9, end_col_offset=57), ImportFrom(module='kgfoundry_common.errors', names=[alias(name='VectorSearchError', lineno=11, col_offset=36, end_lineno=11, end_col_offset=53)], level=0, lineno=11, col_offset=0, end_lineno=11, end_col_offset=53), ImportFrom(module='kgfoundry_common.subprocess_utils', names=[alias(name='SubprocessError', lineno=12, col_offset=46, end_lineno=12, end_col_offset=61)], level=0, lineno=12, col_offset=0, end_lineno=12, end_col_offset=61), Assign(targets=[Name(id='RG_FAILURE_CODE', ctx=Store(), lineno=14, col_offset=0, end_lineno=14, end_col_offset=15)], value=Constant(value=2, lineno=14, col_offset=18, end_lineno=14, end_col_offset=19), lineno=14, col_offset=0, end_lineno=14, end_col_offset=19), Assign(targets=[Name(id='EXPECTED_SUBPROCESS_INVOCATIONS', ctx=Store(), lineno=15, col_offset=0, end_lineno=15, end_col_offset=31)], value=Constant(value=2, lineno=15, col_offset=34, end_lineno=15, end_col_offset=35), lineno=15, col_offset=0, end_lineno=15, end_col_offset=35), FunctionDef(name='_expect', args=arguments(kwonlyargs=[arg(arg='condition', annotation=Name(id='bool', ctx=Load(), lineno=18, col_offset=26, end_lineno=18, end_col_offset=30), lineno=18, col_offset=15, end_lineno=18, end_col_offset=30), arg(arg='message', annotation=Name(id='str', ctx=Load(), lineno=18, col_offset=41, end_lineno=18, end_col_offset=44), lineno=18, col_offset=32, end_lineno=18, end_col_offset=44)], kw_defaults=[None, None]), body=[If(test=UnaryOp(op=Not(), operand=Name(id='condition', ctx=Load(), lineno=19, col_offset=11, end_lineno=19, end_col_offset=20), lineno=19, col_offset=7, end_lineno=19, end_col_offset=20), body=[Expr(value=Call(func=Attribute(value=Name(id='pytest', ctx=Load(), lineno=20, col_offset=8, end_lineno=20, end_col_offset=14), attr='fail', ctx=Load(), lineno=20, col_offset=8, end_lineno=20, end_col_offset=19), args=[Name(id='message', ctx=Load(), lineno=20, col_offset=20, end_lineno=20, end_col_offset=27)], lineno=20, col_offset=8, end_lineno=20, end_col_offset=28), lineno=20, col_offset=8, end_lineno=20, end_col_offset=28)], lineno=19, col_offset=4, end_lineno=20, end_col_offset=28)], returns=Constant(value=None, lineno=18, col_offset=49, end_lineno=18, end_col_offset=53), lineno=18, col_offset=0, end_lineno=20, end_col_offset=28), FunctionDef(name='_build_match_line', args=arguments(args=[arg(arg='path', annotation=Name(id='Path', ctx=Load(), lineno=23, col_offset=28, end_lineno=23, end_col_offset=32), lineno=23, col_offset=22, end_lineno=23, end_col_offset=32)]), body=[Return(value=Call(func=Attribute(value=Name(id='json', ctx=Load(), lineno=24, col_offset=11, end_lineno=24, end_col_offset=15), attr='dumps', ctx=Load(), lineno=24, col_offset=11, end_lineno=24, end_col_offset=21), args=[Dict(keys=[Constant(value='type', lineno=26, col_offset=12, end_lineno=26, end_col_offset=18), Constant(value='data', lineno=27, col_offset=12, end_lineno=27, end_col_offset=18)], values=[Constant(value='match', lineno=26, col_offset=20, end_lineno=26, end_col_offset=27), Dict(keys=[Constant(value='path', lineno=28, col_offset=16, end_lineno=28, end_col_offset=22), Constant(value='line_number', lineno=29, col_offset=16, end_lineno=29, end_col_offset=29), Constant(value='lines', lineno=30, col_offset=16, end_lineno=30, end_col_offset=23), Constant(value='submatches', lineno=31, col_offset=16, end_lineno=31, end_col_offset=28)], values=[Dict(keys=[Constant(value='text', lineno=28, col_offset=25, end_lineno=28, end_col_offset=31)], values=[Call(func=Name(id='str', ctx=Load(), lineno=28, col_offset=33, end_lineno=28, end_col_offset=36), args=[Name(id='path', ctx=Load(), lineno=28, col_offset=37, end_lineno=28, end_col_offset=41)], lineno=28, col_offset=33, end_lineno=28, end_col_offset=42)], lineno=28, col_offset=24, end_lineno=28, end_col_offset=43), Constant(value=1, lineno=29, col_offset=31, end_lineno=29, end_col_offset=32), Dict(keys=[Constant(value='text', lineno=30, col_offset=26, end_lineno=30, end_col_offset=32)], values=[Constant(value='example', lineno=30, col_offset=34, end_lineno=30, end_col_offset=43)], lineno=30, col_offset=25, end_lineno=30, end_col_offset=44), List(elts=[Dict(keys=[Constant(value='start', lineno=31, col_offset=32, end_lineno=31, end_col_offset=39), Constant(value='end', lineno=31, col_offset=44, end_lineno=31, end_col_offset=49)], values=[Constant(value=0, lineno=31, col_offset=41, end_lineno=31, end_col_offset=42), Constant(value=1, lineno=31, col_offset=51, end_lineno=31, end_col_offset=52)], lineno=31, col_offset=31, end_lineno=31, end_col_offset=53)], ctx=Load(), lineno=31, col_offset=30, end_lineno=31, end_col_offset=54)], lineno=27, col_offset=20, end_lineno=32, end_col_offset=13)], lineno=25, col_offset=8, end_lineno=33, end_col_offset=9)], lineno=24, col_offset=11, end_lineno=34, end_col_offset=5), lineno=24, col_offset=4, end_lineno=34, end_col_offset=5)], returns=Name(id='str', ctx=Load(), lineno=23, col_offset=37, end_lineno=23, end_col_offset=40), lineno=23, col_offset=0, end_lineno=34, end_col_offset=5), AsyncFunctionDef(name='test_search_text_flag_prefixed_query', args=arguments(args=[arg(arg='mock_application_context', lineno=40, col_offset=4, end_lineno=40, end_col_offset=28), arg(arg='monkeypatch', annotation=Attribute(value=Name(id='pytest', ctx=Load(), lineno=40, col_offset=43, end_lineno=40, end_col_offset=49), attr='MonkeyPatch', ctx=Load(), lineno=40, col_offset=43, end_lineno=40, end_col_offset=61), lineno=40, col_offset=30, end_lineno=40, end_col_offset=61)]), body=[Expr(value=Constant(value='Queries beginning with a dash should be passed after the `--` sentinel.', lineno=42, col_offset=4, end_lineno=42, end_col_offset=81), lineno=42, col_offset=4, end_lineno=42, end_col_offset=81), AnnAssign(target=Name(id='captured_commands', ctx=Store(), lineno=43, col_offset=4, end_lineno=43, end_col_offset=21), annotation=Subscript(value=Name(id='list', ctx=Load(), lineno=43, col_offset=23, end_lineno=43, end_col_offset=27), slice=Subscript(value=Name(id='list', ctx=Load(), lineno=43, col_offset=28, end_lineno=43, end_col_offset=32), slice=Name(id='str', ctx=Load(), lineno=43, col_offset=33, end_lineno=43, end_col_offset=36), ctx=Load(), lineno=43, col_offset=28, end_lineno=43, end_col_offset=37), ctx=Load(), lineno=43, col_offset=23, end_lineno=43, end_col_offset=38), value=List(ctx=Load(), lineno=43, col_offset=41, end_lineno=43, end_col_offset=43), simple=1, lineno=43, col_offset=4, end_lineno=43, end_col_offset=43), Assign(targets=[Name(id='repo_root', ctx=Store(), lineno=44, col_offset=4, end_lineno=44, end_col_offset=13)], value=Attribute(value=Attribute(value=Name(id='mock_application_context', ctx=Load(), lineno=44, col_offset=16, end_lineno=44, end_col_offset=40), attr='paths', ctx=Load(), lineno=44, col_offset=16, end_lineno=44, end_col_offset=46), attr='repo_root', ctx=Load(), lineno=44, col_offset=16, end_lineno=44, end_col_offset=56), lineno=44, col_offset=4, end_lineno=44, end_col_offset=56), Assign(targets=[Name(id='target_path', ctx=Store(), lineno=45, col_offset=4, end_lineno=45, end_col_offset=15)], value=BinOp(left=Name(id='repo_root', ctx=Load(), lineno=45, col_offset=18, end_lineno=45, end_col_offset=27), op=Div(), right=Constant(value='pyproject.toml', lineno=45, col_offset=30, end_lineno=45, end_col_offset=46), lineno=45, col_offset=18, end_lineno=45, end_col_offset=46), lineno=45, col_offset=4, end_lineno=45, end_col_offset=46), FunctionDef(name='fake_run_subprocess', args=arguments(args=[arg(arg='cmd', annotation=Subscript(value=Name(id='list', ctx=Load(), lineno=48, col_offset=13, end_lineno=48, end_col_offset=17), slice=Name(id='str', ctx=Load(), lineno=48, col_offset=18, end_lineno=48, end_col_offset=21), ctx=Load(), lineno=48, col_offset=13, end_lineno=48, end_col_offset=22), lineno=48, col_offset=8, end_lineno=48, end_col_offset=22)], kwonlyargs=[arg(arg='timeout', annotation=BinOp(left=Name(id='int', ctx=Load(), lineno=48, col_offset=36, end_lineno=48, end_col_offset=39), op=BitOr(), right=Constant(value=None, lineno=48, col_offset=42, end_lineno=48, end_col_offset=46), lineno=48, col_offset=36, end_lineno=48, end_col_offset=46), lineno=48, col_offset=27, end_lineno=48, end_col_offset=46), arg(arg='cwd', annotation=BinOp(left=Name(id='Path', ctx=Load(), lineno=48, col_offset=60, end_lineno=48, end_col_offset=64), op=BitOr(), right=Constant(value=None, lineno=48, col_offset=67, end_lineno=48, end_col_offset=71), lineno=48, col_offset=60, end_lineno=48, end_col_offset=71), lineno=48, col_offset=55, end_lineno=48, end_col_offset=71)], kw_defaults=[Constant(value=None, lineno=48, col_offset=49, end_lineno=48, end_col_offset=53), Constant(value=None, lineno=48, col_offset=74, end_lineno=48, end_col_offset=78)]), body=[Expr(value=Call(func=Attribute(value=Name(id='captured_commands', ctx=Load(), lineno=50, col_offset=8, end_lineno=50, end_col_offset=25), attr='append', ctx=Load(), lineno=50, col_offset=8, end_lineno=50, end_col_offset=32), args=[Call(func=Name(id='list', ctx=Load(), lineno=50, col_offset=33, end_lineno=50, end_col_offset=37), args=[Name(id='cmd', ctx=Load(), lineno=50, col_offset=38, end_lineno=50, end_col_offset=41)], lineno=50, col_offset=33, end_lineno=50, end_col_offset=42)], lineno=50, col_offset=8, end_lineno=50, end_col_offset=43), lineno=50, col_offset=8, end_lineno=50, end_col_offset=43), Assign(targets=[Name(id='_', ctx=Store(), lineno=51, col_offset=8, end_lineno=51, end_col_offset=9)], value=Tuple(elts=[Name(id='timeout', ctx=Load(), lineno=51, col_offset=12, end_lineno=51, end_col_offset=19), Name(id='cwd', ctx=Load(), lineno=51, col_offset=21, end_lineno=51, end_col_offset=24)], ctx=Load(), lineno=51, col_offset=12, end_lineno=51, end_col_offset=24), lineno=51, col_offset=8, end_lineno=51, end_col_offset=24), Return(value=Call(func=Name(id='_build_match_line', ctx=Load(), lineno=52, col_offset=15, end_lineno=52, end_col_offset=32), args=[Name(id='target_path', ctx=Load(), lineno=52, col_offset=33, end_lineno=52, end_col_offset=44)], lineno=52, col_offset=15, end_lineno=52, end_col_offset=45), lineno=52, col_offset=8, end_lineno=52, end_col_offset=45)], returns=Name(id='str', ctx=Load(), lineno=49, col_offset=9, end_lineno=49, end_col_offset=12), lineno=47, col_offset=4, end_lineno=52, end_col_offset=45), Expr(value=Call(func=Attribute(value=Name(id='monkeypatch', ctx=Load(), lineno=54, col_offset=4, end_lineno=54, end_col_offset=15), attr='setattr', ctx=Load(), lineno=54, col_offset=4, end_lineno=54, end_col_offset=23), args=[Name(id='text_search', ctx=Load(), lineno=54, col_offset=24, end_lineno=54, end_col_offset=35), Constant(value='run_subprocess', lineno=54, col_offset=37, end_lineno=54, end_col_offset=53), Name(id='fake_run_subprocess', ctx=Load(), lineno=54, col_offset=55, end_lineno=54, end_col_offset=74)], lineno=54, col_offset=4, end_lineno=54, end_col_offset=75), lineno=54, col_offset=4, end_lineno=54, end_col_offset=75), Assign(targets=[Name(id='result', ctx=Store(), lineno=56, col_offset=4, end_lineno=56, end_col_offset=10)], value=Await(value=Call(func=Attribute(value=Name(id='text_search', ctx=Load(), lineno=56, col_offset=19, end_lineno=56, end_col_offset=30), attr='search_text', ctx=Load(), lineno=56, col_offset=19, end_lineno=56, end_col_offset=42), args=[Name(id='mock_application_context', ctx=Load(), lineno=57, col_offset=8, end_lineno=57, end_col_offset=32), Constant(value='-def', lineno=58, col_offset=8, end_lineno=58, end_col_offset=14)], keywords=[keyword(arg='regex', value=Constant(value=False, lineno=59, col_offset=14, end_lineno=59, end_col_offset=19), lineno=59, col_offset=8, end_lineno=59, end_col_offset=19), keyword(arg='case_sensitive', value=Constant(value=False, lineno=60, col_offset=23, end_lineno=60, end_col_offset=28), lineno=60, col_offset=8, end_lineno=60, end_col_offset=28), keyword(arg='paths', value=List(elts=[Constant(value='pyproject.toml', lineno=61, col_offset=15, end_lineno=61, end_col_offset=31)], ctx=Load(), lineno=61, col_offset=14, end_lineno=61, end_col_offset=32), lineno=61, col_offset=8, end_lineno=61, end_col_offset=32), keyword(arg='max_results', value=Constant(value=1, lineno=62, col_offset=20, end_lineno=62, end_col_offset=21), lineno=62, col_offset=8, end_lineno=62, end_col_offset=21)], lineno=56, col_offset=19, end_lineno=63, end_col_offset=5), lineno=56, col_offset=13, end_lineno=63, end_col_offset=5), lineno=56, col_offset=4, end_lineno=63, end_col_offset=5), Expr(value=Call(func=Name(id='_expect', ctx=Load(), lineno=65, col_offset=4, end_lineno=65, end_col_offset=11), keywords=[keyword(arg='condition', value=Call(func=Name(id='bool', ctx=Load(), lineno=65, col_offset=22, end_lineno=65, end_col_offset=26), args=[Name(id='captured_commands', ctx=Load(), lineno=65, col_offset=27, end_lineno=65, end_col_offset=44)], lineno=65, col_offset=22, end_lineno=65, end_col_offset=45), lineno=65, col_offset=12, end_lineno=65, end_col_offset=45), keyword(arg='message', value=Constant(value='Expected ripgrep to be invoked', lineno=65, col_offset=55, end_lineno=65, end_col_offset=87), lineno=65, col_offset=47, end_lineno=65, end_col_offset=87)], lineno=65, col_offset=4, end_lineno=65, end_col_offset=88), lineno=65, col_offset=4, end_lineno=65, end_col_offset=88), Assign(targets=[Name(id='arguments', ctx=Store(), lineno=66, col_offset=4, end_lineno=66, end_col_offset=13)], value=Subscript(value=Name(id='captured_commands', ctx=Load(), lineno=66, col_offset=16, end_lineno=66, end_col_offset=33), slice=Constant(value=0, lineno=66, col_offset=34, end_lineno=66, end_col_offset=35), ctx=Load(), lineno=66, col_offset=16, end_lineno=66, end_col_offset=36), lineno=66, col_offset=4, end_lineno=66, end_col_offset=36), Assign(targets=[Name(id='sentinel_index', ctx=Store(), lineno=67, col_offset=4, end_lineno=67, end_col_offset=18)], value=Call(func=Attribute(value=Name(id='arguments', ctx=Load(), lineno=67, col_offset=21, end_lineno=67, end_col_offset=30), attr='index', ctx=Load(), lineno=67, col_offset=21, end_lineno=67, end_col_offset=36), args=[Constant(value='--', lineno=67, col_offset=37, end_lineno=67, end_col_offset=41)], lineno=67, col_offset=21, end_lineno=67, end_col_offset=42), lineno=67, col_offset=4, end_lineno=67, end_col_offset=42), Expr(value=Call(func=Name(id='_expect', ctx=Load(), lineno=68, col_offset=4, end_lineno=68, end_col_offset=11), keywords=[keyword(arg='condition', value=Compare(left=Subscript(value=Name(id='arguments', ctx=Load(), lineno=69, col_offset=18, end_lineno=69, end_col_offset=27), slice=BinOp(left=Name(id='sentinel_index', ctx=Load(), lineno=69, col_offset=28, end_lineno=69, end_col_offset=42), op=Add(), right=Constant(value=1, lineno=69, col_offset=45, end_lineno=69, end_col_offset=46), lineno=69, col_offset=28, end_lineno=69, end_col_offset=46), ctx=Load(), lineno=69, col_offset=18, end_lineno=69, end_col_offset=47), ops=[Eq()], comparators=[Constant(value='-def', lineno=69, col_offset=51, end_lineno=69, end_col_offset=57)], lineno=69, col_offset=18, end_lineno=69, end_col_offset=57), lineno=69, col_offset=8, end_lineno=69, end_col_offset=57), keyword(arg='message', value=Constant(value='Query should appear immediately after the sentinel', lineno=70, col_offset=16, end_lineno=70, end_col_offset=68), lineno=70, col_offset=8, end_lineno=70, end_col_offset=68)], lineno=68, col_offset=4, end_lineno=71, end_col_offset=5), lineno=68, col_offset=4, end_lineno=71, end_col_offset=5), Expr(value=Call(func=Name(id='_expect', ctx=Load(), lineno=72, col_offset=4, end_lineno=72, end_col_offset=11), keywords=[keyword(arg='condition', value=Subscript(value=Name(id='result', ctx=Load(), lineno=72, col_offset=22, end_lineno=72, end_col_offset=28), slice=Constant(value='matches', lineno=72, col_offset=29, end_lineno=72, end_col_offset=38), ctx=Load(), lineno=72, col_offset=22, end_lineno=72, end_col_offset=39), lineno=72, col_offset=12, end_lineno=72, end_col_offset=39), keyword(arg='message', value=Constant(value='Expected at least one match', lineno=72, col_offset=49, end_lineno=72, end_col_offset=78), lineno=72, col_offset=41, end_lineno=72, end_col_offset=78)], lineno=72, col_offset=4, end_lineno=72, end_col_offset=79), lineno=72, col_offset=4, end_lineno=72, end_col_offset=79), Expr(value=Call(func=Name(id='_expect', ctx=Load(), lineno=73, col_offset=4, end_lineno=73, end_col_offset=11), keywords=[keyword(arg='condition', value=Call(func=Attribute(value=Subscript(value=Subscript(value=Subscript(value=Name(id='result', ctx=Load(), lineno=74, col_offset=18, end_lineno=74, end_col_offset=24), slice=Constant(value='matches', lineno=74, col_offset=25, end_lineno=74, end_col_offset=34), ctx=Load(), lineno=74, col_offset=18, end_lineno=74, end_col_offset=35), slice=Constant(value=0, lineno=74, col_offset=36, end_lineno=74, end_col_offset=37), ctx=Load(), lineno=74, col_offset=18, end_lineno=74, end_col_offset=38), slice=Constant(value='path', lineno=74, col_offset=39, end_lineno=74, end_col_offset=45), ctx=Load(), lineno=74, col_offset=18, end_lineno=74, end_col_offset=46), attr='endswith', ctx=Load(), lineno=74, col_offset=18, end_lineno=74, end_col_offset=55), args=[Constant(value='pyproject.toml', lineno=74, col_offset=56, end_lineno=74, end_col_offset=72)], lineno=74, col_offset=18, end_lineno=74, end_col_offset=73), lineno=74, col_offset=8, end_lineno=74, end_col_offset=73), keyword(arg='message', value=Constant(value='Match path should end with the queried file', lineno=75, col_offset=16, end_lineno=75, end_col_offset=61), lineno=75, col_offset=8, end_lineno=75, end_col_offset=61)], lineno=73, col_offset=4, end_lineno=76, end_col_offset=5), lineno=73, col_offset=4, end_lineno=76, end_col_offset=5)], decorator_list=[Attribute(value=Attribute(value=Name(id='pytest', ctx=Load(), lineno=37, col_offset=1, end_lineno=37, end_col_offset=7), attr='mark', ctx=Load(), lineno=37, col_offset=1, end_lineno=37, end_col_offset=12), attr='asyncio', ctx=Load(), lineno=37, col_offset=1, end_lineno=37, end_col_offset=20), Call(func=Attribute(value=Attribute(value=Name(id='pytest', ctx=Load(), lineno=38, col_offset=1, end_lineno=38, end_col_offset=7), attr='mark', ctx=Load(), lineno=38, col_offset=1, end_lineno=38, end_col_offset=12), attr='usefixtures', ctx=Load(), lineno=38, col_offset=1, end_lineno=38, end_col_offset=24), args=[Constant(value='mock_session_id', lineno=38, col_offset=25, end_lineno=38, end_col_offset=42)], lineno=38, col_offset=1, end_lineno=38, end_col_offset=43)], returns=Constant(value=None, lineno=41, col_offset=5, end_lineno=41, end_col_offset=9), lineno=39, col_offset=0, end_lineno=76, end_col_offset=5), AsyncFunctionDef(name='test_search_text_surfaces_ripgrep_failure', args=arguments(args=[arg(arg='mock_application_context', lineno=82, col_offset=4, end_lineno=82, end_col_offset=28), arg(arg='monkeypatch', annotation=Attribute(value=Name(id='pytest', ctx=Load(), lineno=82, col_offset=43, end_lineno=82, end_col_offset=49), attr='MonkeyPatch', ctx=Load(), lineno=82, col_offset=43, end_lineno=82, end_col_offset=61), lineno=82, col_offset=30, end_lineno=82, end_col_offset=61)]), body=[Expr(value=Constant(value='Return-code > 1 from ripgrep should surface an error message.', lineno=84, col_offset=4, end_lineno=84, end_col_offset=71), lineno=84, col_offset=4, end_lineno=84, end_col_offset=71), FunctionDef(name='fake_run_subprocess', args=arguments(args=[arg(arg='cmd', annotation=Subscript(value=Name(id='list', ctx=Load(), lineno=87, col_offset=13, end_lineno=87, end_col_offset=17), slice=Name(id='str', ctx=Load(), lineno=87, col_offset=18, end_lineno=87, end_col_offset=21), ctx=Load(), lineno=87, col_offset=13, end_lineno=87, end_col_offset=22), lineno=87, col_offset=8, end_lineno=87, end_col_offset=22)], kwonlyargs=[arg(arg='timeout', annotation=BinOp(left=Name(id='int', ctx=Load(), lineno=87, col_offset=36, end_lineno=87, end_col_offset=39), op=BitOr(), right=Constant(value=None, lineno=87, col_offset=42, end_lineno=87, end_col_offset=46), lineno=87, col_offset=36, end_lineno=87, end_col_offset=46), lineno=87, col_offset=27, end_lineno=87, end_col_offset=46), arg(arg='cwd', annotation=BinOp(left=Name(id='Path', ctx=Load(), lineno=87, col_offset=60, end_lineno=87, end_col_offset=64), op=BitOr(), right=Constant(value=None, lineno=87, col_offset=67, end_lineno=87, end_col_offset=71), lineno=87, col_offset=60, end_lineno=87, end_col_offset=71), lineno=87, col_offset=55, end_lineno=87, end_col_offset=71)], kw_defaults=[Constant(value=None, lineno=87, col_offset=49, end_lineno=87, end_col_offset=53), Constant(value=None, lineno=87, col_offset=74, end_lineno=87, end_col_offset=78)]), body=[Assign(targets=[Name(id='_', ctx=Store(), lineno=89, col_offset=8, end_lineno=89, end_col_offset=9)], value=Tuple(elts=[Name(id='cmd', ctx=Load(), lineno=89, col_offset=12, end_lineno=89, end_col_offset=15), Name(id='timeout', ctx=Load(), lineno=89, col_offset=17, end_lineno=89, end_col_offset=24), Name(id='cwd', ctx=Load(), lineno=89, col_offset=26, end_lineno=89, end_col_offset=29)], ctx=Load(), lineno=89, col_offset=12, end_lineno=89, end_col_offset=29), lineno=89, col_offset=8, end_lineno=89, end_col_offset=29), Assign(targets=[Name(id='error_message', ctx=Store(), lineno=90, col_offset=8, end_lineno=90, end_col_offset=21)], value=Constant(value='rg failed', lineno=90, col_offset=24, end_lineno=90, end_col_offset=35), lineno=90, col_offset=8, end_lineno=90, end_col_offset=35), Raise(exc=Call(func=Name(id='SubprocessError', ctx=Load(), lineno=91, col_offset=14, end_lineno=91, end_col_offset=29), args=[Name(id='error_message', ctx=Load(), lineno=91, col_offset=30, end_lineno=91, end_col_offset=43)], keywords=[keyword(arg='returncode', value=Name(id='RG_FAILURE_CODE', ctx=Load(), lineno=91, col_offset=56, end_lineno=91, end_col_offset=71), lineno=91, col_offset=45, end_lineno=91, end_col_offset=71), keyword(arg='stderr', value=Name(id='error_message', ctx=Load(), lineno=91, col_offset=80, end_lineno=91, end_col_offset=93), lineno=91, col_offset=73, end_lineno=91, end_col_offset=93)], lineno=91, col_offset=14, end_lineno=91, end_col_offset=94), lineno=91, col_offset=8, end_lineno=91, end_col_offset=94)], returns=Name(id='str', ctx=Load(), lineno=88, col_offset=9, end_lineno=88, end_col_offset=12), lineno=86, col_offset=4, end_lineno=91, end_col_offset=94), Expr(value=Call(func=Attribute(value=Name(id='monkeypatch', ctx=Load(), lineno=93, col_offset=4, end_lineno=93, end_col_offset=15), attr='setattr', ctx=Load(), lineno=93, col_offset=4, end_lineno=93, end_col_offset=23), args=[Name(id='text_search', ctx=Load(), lineno=93, col_offset=24, end_lineno=93, end_col_offset=35), Constant(value='run_subprocess', lineno=93, col_offset=37, end_lineno=93, end_col_offset=53), Name(id='fake_run_subprocess', ctx=Load(), lineno=93, col_offset=55, end_lineno=93, end_col_offset=74)], lineno=93, col_offset=4, end_lineno=93, end_col_offset=75), lineno=93, col_offset=4, end_lineno=93, end_col_offset=75), With(items=[withitem(context_expr=Call(func=Attribute(value=Name(id='pytest', ctx=Load(), lineno=95, col_offset=9, end_lineno=95, end_col_offset=15), attr='raises', ctx=Load(), lineno=95, col_offset=9, end_lineno=95, end_col_offset=22), args=[Name(id='VectorSearchError', ctx=Load(), lineno=95, col_offset=23, end_lineno=95, end_col_offset=40)], lineno=95, col_offset=9, end_lineno=95, end_col_offset=41), optional_vars=Name(id='excinfo', ctx=Store(), lineno=95, col_offset=45, end_lineno=95, end_col_offset=52))], body=[Expr(value=Await(value=Call(func=Attribute(value=Name(id='text_search', ctx=Load(), lineno=96, col_offset=14, end_lineno=96, end_col_offset=25), attr='search_text', ctx=Load(), lineno=96, col_offset=14, end_lineno=96, end_col_offset=37), args=[Name(id='mock_application_context', ctx=Load(), lineno=96, col_offset=38, end_lineno=96, end_col_offset=62), Constant(value='pattern', lineno=96, col_offset=64, end_lineno=96, end_col_offset=73)], lineno=96, col_offset=14, end_lineno=96, end_col_offset=74), lineno=96, col_offset=8, end_lineno=96, end_col_offset=74), lineno=96, col_offset=8, end_lineno=96, end_col_offset=74)], lineno=95, col_offset=4, end_lineno=96, end_col_offset=74), Assign(targets=[Name(id='error', ctx=Store(), lineno=98, col_offset=4, end_lineno=98, end_col_offset=9)], value=Call(func=Name(id='str', ctx=Load(), lineno=98, col_offset=12, end_lineno=98, end_col_offset=15), args=[Attribute(value=Name(id='excinfo', ctx=Load(), lineno=98, col_offset=16, end_lineno=98, end_col_offset=23), attr='value', ctx=Load(), lineno=98, col_offset=16, end_lineno=98, end_col_offset=29)], lineno=98, col_offset=12, end_lineno=98, end_col_offset=30), lineno=98, col_offset=4, end_lineno=98, end_col_offset=30), Expr(value=Call(func=Name(id='_expect', ctx=Load(), lineno=99, col_offset=4, end_lineno=99, end_col_offset=11), keywords=[keyword(arg='condition', value=Compare(left=Constant(value='rg failed', lineno=99, col_offset=22, end_lineno=99, end_col_offset=33), ops=[In()], comparators=[Name(id='error', ctx=Load(), lineno=99, col_offset=37, end_lineno=99, end_col_offset=42)], lineno=99, col_offset=22, end_lineno=99, end_col_offset=42), lineno=99, col_offset=12, end_lineno=99, end_col_offset=42), keyword(arg='message', value=Constant(value='Expected error message to surface', lineno=99, col_offset=52, end_lineno=99, end_col_offset=87), lineno=99, col_offset=44, end_lineno=99, end_col_offset=87)], lineno=99, col_offset=4, end_lineno=99, end_col_offset=88), lineno=99, col_offset=4, end_lineno=99, end_col_offset=88)], decorator_list=[Attribute(value=Attribute(value=Name(id='pytest', ctx=Load(), lineno=79, col_offset=1, end_lineno=79, end_col_offset=7), attr='mark', ctx=Load(), lineno=79, col_offset=1, end_lineno=79, end_col_offset=12), attr='asyncio', ctx=Load(), lineno=79, col_offset=1, end_lineno=79, end_col_offset=20), Call(func=Attribute(value=Attribute(value=Name(id='pytest', ctx=Load(), lineno=80, col_offset=1, end_lineno=80, end_col_offset=7), attr='mark', ctx=Load(), lineno=80, col_offset=1, end_lineno=80, end_col_offset=12), attr='usefixtures', ctx=Load(), lineno=80, col_offset=1, end_lineno=80, end_col_offset=24), args=[Constant(value='mock_session_id', lineno=80, col_offset=25, end_lineno=80, end_col_offset=42)], lineno=80, col_offset=1, end_lineno=80, end_col_offset=43)], returns=Constant(value=None, lineno=83, col_offset=5, end_lineno=83, end_col_offset=9), lineno=81, col_offset=0, end_lineno=99, end_col_offset=88), AsyncFunctionDef(name='test_search_text_falls_back_to_grep', args=arguments(args=[arg(arg='mock_application_context', lineno=105, col_offset=4, end_lineno=105, end_col_offset=28), arg(arg='monkeypatch', annotation=Attribute(value=Name(id='pytest', ctx=Load(), lineno=105, col_offset=43, end_lineno=105, end_col_offset=49), attr='MonkeyPatch', ctx=Load(), lineno=105, col_offset=43, end_lineno=105, end_col_offset=61), lineno=105, col_offset=30, end_lineno=105, end_col_offset=61)]), body=[Expr(value=Constant(value='Missing ripgrep binary should trigger the grep fallback.', lineno=107, col_offset=4, end_lineno=107, end_col_offset=66), lineno=107, col_offset=4, end_lineno=107, end_col_offset=66), AnnAssign(target=Name(id='captured_commands', ctx=Store(), lineno=108, col_offset=4, end_lineno=108, end_col_offset=21), annotation=Subscript(value=Name(id='list', ctx=Load(), lineno=108, col_offset=23, end_lineno=108, end_col_offset=27), slice=Subscript(value=Name(id='list', ctx=Load(), lineno=108, col_offset=28, end_lineno=108, end_col_offset=32), slice=Name(id='str', ctx=Load(), lineno=108, col_offset=33, end_lineno=108, end_col_offset=36), ctx=Load(), lineno=108, col_offset=28, end_lineno=108, end_col_offset=37), ctx=Load(), lineno=108, col_offset=23, end_lineno=108, end_col_offset=38), value=List(ctx=Load(), lineno=108, col_offset=41, end_lineno=108, end_col_offset=43), simple=1, lineno=108, col_offset=4, end_lineno=108, end_col_offset=43), FunctionDef(name='fake_run_subprocess', args=arguments(args=[arg(arg='cmd', annotation=Subscript(value=Name(id='list', ctx=Load(), lineno=111, col_offset=13, end_lineno=111, end_col_offset=17), slice=Name(id='str', ctx=Load(), lineno=111, col_offset=18, end_lineno=111, end_col_offset=21), ctx=Load(), lineno=111, col_offset=13, end_lineno=111, end_col_offset=22), lineno=111, col_offset=8, end_lineno=111, end_col_offset=22)], kwonlyargs=[arg(arg='timeout', annotation=BinOp(left=Name(id='int', ctx=Load(), lineno=111, col_offset=36, end_lineno=111, end_col_offset=39), op=BitOr(), right=Constant(value=None, lineno=111, col_offset=42, end_lineno=111, end_col_offset=46), lineno=111, col_offset=36, end_lineno=111, end_col_offset=46), lineno=111, col_offset=27, end_lineno=111, end_col_offset=46), arg(arg='cwd', annotation=BinOp(left=Name(id='Path', ctx=Load(), lineno=111, col_offset=60, end_lineno=111, end_col_offset=64), op=BitOr(), right=Constant(value=None, lineno=111, col_offset=67, end_lineno=111, end_col_offset=71), lineno=111, col_offset=60, end_lineno=111, end_col_offset=71), lineno=111, col_offset=55, end_lineno=111, end_col_offset=71)], kw_defaults=[Constant(value=None, lineno=111, col_offset=49, end_lineno=111, end_col_offset=53), Constant(value=None, lineno=111, col_offset=74, end_lineno=111, end_col_offset=78)]), body=[Assign(targets=[Name(id='_', ctx=Store(), lineno=113, col_offset=8, end_lineno=113, end_col_offset=9)], value=Tuple(elts=[Name(id='timeout', ctx=Load(), lineno=113, col_offset=12, end_lineno=113, end_col_offset=19), Name(id='cwd', ctx=Load(), lineno=113, col_offset=21, end_lineno=113, end_col_offset=24)], ctx=Load(), lineno=113, col_offset=12, end_lineno=113, end_col_offset=24), lineno=113, col_offset=8, end_lineno=113, end_col_offset=24), Expr(value=Call(func=Attribute(value=Name(id='captured_commands', ctx=Load(), lineno=114, col_offset=8, end_lineno=114, end_col_offset=25), attr='append', ctx=Load(), lineno=114, col_offset=8, end_lineno=114, end_col_offset=32), args=[Call(func=Name(id='list', ctx=Load(), lineno=114, col_offset=33, end_lineno=114, end_col_offset=37), args=[Name(id='cmd', ctx=Load(), lineno=114, col_offset=38, end_lineno=114, end_col_offset=41)], lineno=114, col_offset=33, end_lineno=114, end_col_offset=42)], lineno=114, col_offset=8, end_lineno=114, end_col_offset=43), lineno=114, col_offset=8, end_lineno=114, end_col_offset=43), If(test=Compare(left=Subscript(value=Name(id='cmd', ctx=Load(), lineno=115, col_offset=11, end_lineno=115, end_col_offset=14), slice=Constant(value=0, lineno=115, col_offset=15, end_lineno=115, end_col_offset=16), ctx=Load(), lineno=115, col_offset=11, end_lineno=115, end_col_offset=17), ops=[Eq()], comparators=[Constant(value='rg', lineno=115, col_offset=21, end_lineno=115, end_col_offset=25)], lineno=115, col_offset=11, end_lineno=115, end_col_offset=25), body=[Assign(targets=[Name(id='error_message', ctx=Store(), lineno=116, col_offset=12, end_lineno=116, end_col_offset=25)], value=Constant(value='rg missing', lineno=116, col_offset=28, end_lineno=116, end_col_offset=40), lineno=116, col_offset=12, end_lineno=116, end_col_offset=40), Raise(exc=Call(func=Name(id='SubprocessError', ctx=Load(), lineno=117, col_offset=18, end_lineno=117, end_col_offset=33), args=[Name(id='error_message', ctx=Load(), lineno=117, col_offset=34, end_lineno=117, end_col_offset=47)], keywords=[keyword(arg='returncode', value=Constant(value=127, lineno=117, col_offset=60, end_lineno=117, end_col_offset=63), lineno=117, col_offset=49, end_lineno=117, end_col_offset=63), keyword(arg='stderr', value=Name(id='error_message', ctx=Load(), lineno=117, col_offset=72, end_lineno=117, end_col_offset=85), lineno=117, col_offset=65, end_lineno=117, end_col_offset=85)], lineno=117, col_offset=18, end_lineno=117, end_col_offset=86), lineno=117, col_offset=12, end_lineno=117, end_col_offset=86)], lineno=115, col_offset=8, end_lineno=117, end_col_offset=86), Assign(targets=[Name(id='repo_root', ctx=Store(), lineno=118, col_offset=8, end_lineno=118, end_col_offset=17)], value=Attribute(value=Attribute(value=Name(id='mock_application_context', ctx=Load(), lineno=118, col_offset=20, end_lineno=118, end_col_offset=44), attr='paths', ctx=Load(), lineno=118, col_offset=20, end_lineno=118, end_col_offset=50), attr='repo_root', ctx=Load(), lineno=118, col_offset=20, end_lineno=118, end_col_offset=60), lineno=118, col_offset=8, end_lineno=118, end_col_offset=60), Return(value=JoinedStr(values=[FormattedValue(value=Name(id='repo_root', ctx=Load(), lineno=119, col_offset=18, end_lineno=119, end_col_offset=27), conversion=-1, lineno=119, col_offset=17, end_lineno=119, end_col_offset=28), Constant(value='/README.md:1:example', lineno=119, col_offset=28, end_lineno=119, end_col_offset=48)], lineno=119, col_offset=15, end_lineno=119, end_col_offset=49), lineno=119, col_offset=8, end_lineno=119, end_col_offset=49)], returns=Name(id='str', ctx=Load(), lineno=112, col_offset=9, end_lineno=112, end_col_offset=12), lineno=110, col_offset=4, end_lineno=119, end_col_offset=49), Expr(value=Call(func=Attribute(value=Name(id='monkeypatch', ctx=Load(), lineno=121, col_offset=4, end_lineno=121, end_col_offset=15), attr='setattr', ctx=Load(), lineno=121, col_offset=4, end_lineno=121, end_col_offset=23), args=[Name(id='text_search', ctx=Load(), lineno=121, col_offset=24, end_lineno=121, end_col_offset=35), Constant(value='run_subprocess', lineno=121, col_offset=37, end_lineno=121, end_col_offset=53), Name(id='fake_run_subprocess', ctx=Load(), lineno=121, col_offset=55, end_lineno=121, end_col_offset=74)], lineno=121, col_offset=4, end_lineno=121, end_col_offset=75), lineno=121, col_offset=4, end_lineno=121, end_col_offset=75), Assign(targets=[Name(id='result', ctx=Store(), lineno=123, col_offset=4, end_lineno=123, end_col_offset=10)], value=Await(value=Call(func=Attribute(value=Name(id='text_search', ctx=Load(), lineno=123, col_offset=19, end_lineno=123, end_col_offset=30), attr='search_text', ctx=Load(), lineno=123, col_offset=19, end_lineno=123, end_col_offset=42), args=[Name(id='mock_application_context', ctx=Load(), lineno=123, col_offset=43, end_lineno=123, end_col_offset=67), Constant(value='example', lineno=123, col_offset=69, end_lineno=123, end_col_offset=78)], keywords=[keyword(arg='max_results', value=Constant(value=1, lineno=123, col_offset=92, end_lineno=123, end_col_offset=93), lineno=123, col_offset=80, end_lineno=123, end_col_offset=93)], lineno=123, col_offset=19, end_lineno=123, end_col_offset=94), lineno=123, col_offset=13, end_lineno=123, end_col_offset=94), lineno=123, col_offset=4, end_lineno=123, end_col_offset=94), Expr(value=Call(func=Name(id='_expect', ctx=Load(), lineno=125, col_offset=4, end_lineno=125, end_col_offset=11), keywords=[keyword(arg='condition', value=Compare(left=Call(func=Name(id='len', ctx=Load(), lineno=126, col_offset=18, end_lineno=126, end_col_offset=21), args=[Name(id='captured_commands', ctx=Load(), lineno=126, col_offset=22, end_lineno=126, end_col_offset=39)], lineno=126, col_offset=18, end_lineno=126, end_col_offset=40), ops=[Eq()], comparators=[Name(id='EXPECTED_SUBPROCESS_INVOCATIONS', ctx=Load(), lineno=126, col_offset=44, end_lineno=126, end_col_offset=75)], lineno=126, col_offset=18, end_lineno=126, end_col_offset=75), lineno=126, col_offset=8, end_lineno=126, end_col_offset=75), keyword(arg='message', value=Constant(value='Expected two subprocess invocations', lineno=127, col_offset=16, end_lineno=127, end_col_offset=53), lineno=127, col_offset=8, end_lineno=127, end_col_offset=53)], lineno=125, col_offset=4, end_lineno=128, end_col_offset=5), lineno=125, col_offset=4, end_lineno=128, end_col_offset=5), Expr(value=Call(func=Name(id='_expect', ctx=Load(), lineno=129, col_offset=4, end_lineno=129, end_col_offset=11), keywords=[keyword(arg='condition', value=Compare(left=Subscript(value=Subscript(value=Name(id='captured_commands', ctx=Load(), lineno=130, col_offset=18, end_lineno=130, end_col_offset=35), slice=Constant(value=1, lineno=130, col_offset=36, end_lineno=130, end_col_offset=37), ctx=Load(), lineno=130, col_offset=18, end_lineno=130, end_col_offset=38), slice=Constant(value=0, lineno=130, col_offset=39, end_lineno=130, end_col_offset=40), ctx=Load(), lineno=130, col_offset=18, end_lineno=130, end_col_offset=41), ops=[Eq()], comparators=[Constant(value='grep', lineno=130, col_offset=45, end_lineno=130, end_col_offset=51)], lineno=130, col_offset=18, end_lineno=130, end_col_offset=51), lineno=130, col_offset=8, end_lineno=130, end_col_offset=51), keyword(arg='message', value=Constant(value='Fallback should invoke grep', lineno=131, col_offset=16, end_lineno=131, end_col_offset=45), lineno=131, col_offset=8, end_lineno=131, end_col_offset=45)], lineno=129, col_offset=4, end_lineno=132, end_col_offset=5), lineno=129, col_offset=4, end_lineno=132, end_col_offset=5), Expr(value=Call(func=Name(id='_expect', ctx=Load(), lineno=133, col_offset=4, end_lineno=133, end_col_offset=11), keywords=[keyword(arg='condition', value=Subscript(value=Name(id='result', ctx=Load(), lineno=133, col_offset=22, end_lineno=133, end_col_offset=28), slice=Constant(value='matches', lineno=133, col_offset=29, end_lineno=133, end_col_offset=38), ctx=Load(), lineno=133, col_offset=22, end_lineno=133, end_col_offset=39), lineno=133, col_offset=12, end_lineno=133, end_col_offset=39), keyword(arg='message', value=Constant(value='Fallback grep should produce matches', lineno=133, col_offset=49, end_lineno=133, end_col_offset=87), lineno=133, col_offset=41, end_lineno=133, end_col_offset=87)], lineno=133, col_offset=4, end_lineno=133, end_col_offset=88), lineno=133, col_offset=4, end_lineno=133, end_col_offset=88)], decorator_list=[Attribute(value=Attribute(value=Name(id='pytest', ctx=Load(), lineno=102, col_offset=1, end_lineno=102, end_col_offset=7), attr='mark', ctx=Load(), lineno=102, col_offset=1, end_lineno=102, end_col_offset=12), attr='asyncio', ctx=Load(), lineno=102, col_offset=1, end_lineno=102, end_col_offset=20), Call(func=Attribute(value=Attribute(value=Name(id='pytest', ctx=Load(), lineno=103, col_offset=1, end_lineno=103, end_col_offset=7), attr='mark', ctx=Load(), lineno=103, col_offset=1, end_lineno=103, end_col_offset=12), attr='usefixtures', ctx=Load(), lineno=103, col_offset=1, end_lineno=103, end_col_offset=24), args=[Constant(value='mock_session_id', lineno=103, col_offset=25, end_lineno=103, end_col_offset=42)], lineno=103, col_offset=1, end_lineno=103, end_col_offset=43)], returns=Constant(value=None, lineno=106, col_offset=5, end_lineno=106, end_col_offset=9), lineno=104, col_offset=0, end_lineno=133, end_col_offset=88), AsyncFunctionDef(name='test_search_text_fallback_normalizes_relative_paths', args=arguments(args=[arg(arg='mock_application_context', lineno=139, col_offset=4, end_lineno=139, end_col_offset=28), arg(arg='monkeypatch', annotation=Attribute(value=Name(id='pytest', ctx=Load(), lineno=139, col_offset=43, end_lineno=139, end_col_offset=49), attr='MonkeyPatch', ctx=Load(), lineno=139, col_offset=43, end_lineno=139, end_col_offset=61), lineno=139, col_offset=30, end_lineno=139, end_col_offset=61)]), body=[Expr(value=Constant(value='Relative grep results should be normalized to repo-relative paths.', lineno=141, col_offset=4, end_lineno=141, end_col_offset=76), lineno=141, col_offset=4, end_lineno=141, end_col_offset=76), FunctionDef(name='fake_run_subprocess', args=arguments(args=[arg(arg='cmd', annotation=Subscript(value=Name(id='list', ctx=Load(), lineno=144, col_offset=13, end_lineno=144, end_col_offset=17), slice=Name(id='str', ctx=Load(), lineno=144, col_offset=18, end_lineno=144, end_col_offset=21), ctx=Load(), lineno=144, col_offset=13, end_lineno=144, end_col_offset=22), lineno=144, col_offset=8, end_lineno=144, end_col_offset=22)], kwonlyargs=[arg(arg='timeout', annotation=BinOp(left=Name(id='int', ctx=Load(), lineno=144, col_offset=36, end_lineno=144, end_col_offset=39), op=BitOr(), right=Constant(value=None, lineno=144, col_offset=42, end_lineno=144, end_col_offset=46), lineno=144, col_offset=36, end_lineno=144, end_col_offset=46), lineno=144, col_offset=27, end_lineno=144, end_col_offset=46), arg(arg='cwd', annotation=BinOp(left=Name(id='Path', ctx=Load(), lineno=144, col_offset=60, end_lineno=144, end_col_offset=64), op=BitOr(), right=Constant(value=None, lineno=144, col_offset=67, end_lineno=144, end_col_offset=71), lineno=144, col_offset=60, end_lineno=144, end_col_offset=71), lineno=144, col_offset=55, end_lineno=144, end_col_offset=71)], kw_defaults=[Constant(value=None, lineno=144, col_offset=49, end_lineno=144, end_col_offset=53), Constant(value=None, lineno=144, col_offset=74, end_lineno=144, end_col_offset=78)]), body=[Assign(targets=[Name(id='_', ctx=Store(), lineno=146, col_offset=8, end_lineno=146, end_col_offset=9)], value=Tuple(elts=[Name(id='timeout', ctx=Load(), lineno=146, col_offset=12, end_lineno=146, end_col_offset=19), Name(id='cwd', ctx=Load(), lineno=146, col_offset=21, end_lineno=146, end_col_offset=24)], ctx=Load(), lineno=146, col_offset=12, end_lineno=146, end_col_offset=24), lineno=146, col_offset=8, end_lineno=146, end_col_offset=24), If(test=Compare(left=Subscript(value=Name(id='cmd', ctx=Load(), lineno=147, col_offset=11, end_lineno=147, end_col_offset=14), slice=Constant(value=0, lineno=147, col_offset=15, end_lineno=147, end_col_offset=16), ctx=Load(), lineno=147, col_offset=11, end_lineno=147, end_col_offset=17), ops=[Eq()], comparators=[Constant(value='rg', lineno=147, col_offset=21, end_lineno=147, end_col_offset=25)], lineno=147, col_offset=11, end_lineno=147, end_col_offset=25), body=[Assign(targets=[Name(id='error_message', ctx=Store(), lineno=148, col_offset=12, end_lineno=148, end_col_offset=25)], value=Constant(value='rg missing', lineno=148, col_offset=28, end_lineno=148, end_col_offset=40), lineno=148, col_offset=12, end_lineno=148, end_col_offset=40), Raise(exc=Call(func=Name(id='SubprocessError', ctx=Load(), lineno=149, col_offset=18, end_lineno=149, end_col_offset=33), args=[Name(id='error_message', ctx=Load(), lineno=149, col_offset=34, end_lineno=149, end_col_offset=47)], keywords=[keyword(arg='returncode', value=Constant(value=127, lineno=149, col_offset=60, end_lineno=149, end_col_offset=63), lineno=149, col_offset=49, end_lineno=149, end_col_offset=63), keyword(arg='stderr', value=Name(id='error_message', ctx=Load(), lineno=149, col_offset=72, end_lineno=149, end_col_offset=85), lineno=149, col_offset=65, end_lineno=149, end_col_offset=85)], lineno=149, col_offset=18, end_lineno=149, end_col_offset=86), lineno=149, col_offset=12, end_lineno=149, end_col_offset=86)], lineno=147, col_offset=8, end_lineno=149, end_col_offset=86), Return(value=Call(func=Attribute(value=Constant(value='\n', lineno=150, col_offset=15, end_lineno=150, end_col_offset=19), attr='join', ctx=Load(), lineno=150, col_offset=15, end_lineno=150, end_col_offset=24), args=[List(elts=[Constant(value='README.md:1:example', lineno=152, col_offset=16, end_lineno=152, end_col_offset=37), Constant(value='./README.md:2:example', lineno=153, col_offset=16, end_lineno=153, end_col_offset=39)], ctx=Load(), lineno=151, col_offset=12, end_lineno=154, end_col_offset=13)], lineno=150, col_offset=15, end_lineno=155, end_col_offset=9), lineno=150, col_offset=8, end_lineno=155, end_col_offset=9)], returns=Name(id='str', ctx=Load(), lineno=145, col_offset=9, end_lineno=145, end_col_offset=12), lineno=143, col_offset=4, end_lineno=155, end_col_offset=9), Expr(value=Call(func=Attribute(value=Name(id='monkeypatch', ctx=Load(), lineno=157, col_offset=4, end_lineno=157, end_col_offset=15), attr='setattr', ctx=Load(), lineno=157, col_offset=4, end_lineno=157, end_col_offset=23), args=[Name(id='text_search', ctx=Load(), lineno=157, col_offset=24, end_lineno=157, end_col_offset=35), Constant(value='run_subprocess', lineno=157, col_offset=37, end_lineno=157, end_col_offset=53), Name(id='fake_run_subprocess', ctx=Load(), lineno=157, col_offset=55, end_lineno=157, end_col_offset=74)], lineno=157, col_offset=4, end_lineno=157, end_col_offset=75), lineno=157, col_offset=4, end_lineno=157, end_col_offset=75), Assign(targets=[Name(id='result', ctx=Store(), lineno=159, col_offset=4, end_lineno=159, end_col_offset=10)], value=Await(value=Call(func=Attribute(value=Name(id='text_search', ctx=Load(), lineno=159, col_offset=19, end_lineno=159, end_col_offset=30), attr='search_text', ctx=Load(), lineno=159, col_offset=19, end_lineno=159, end_col_offset=42), args=[Name(id='mock_application_context', ctx=Load(), lineno=159, col_offset=43, end_lineno=159, end_col_offset=67), Constant(value='example', lineno=159, col_offset=69, end_lineno=159, end_col_offset=78)], keywords=[keyword(arg='max_results', value=Constant(value=5, lineno=159, col_offset=92, end_lineno=159, end_col_offset=93), lineno=159, col_offset=80, end_lineno=159, end_col_offset=93)], lineno=159, col_offset=19, end_lineno=159, end_col_offset=94), lineno=159, col_offset=13, end_lineno=159, end_col_offset=94), lineno=159, col_offset=4, end_lineno=159, end_col_offset=94), Assign(targets=[Name(id='expected_match_count', ctx=Store(), lineno=161, col_offset=4, end_lineno=161, end_col_offset=24)], value=Constant(value=2, lineno=161, col_offset=27, end_lineno=161, end_col_offset=28), lineno=161, col_offset=4, end_lineno=161, end_col_offset=28), Expr(value=Call(func=Name(id='_expect', ctx=Load(), lineno=162, col_offset=4, end_lineno=162, end_col_offset=11), keywords=[keyword(arg='condition', value=Compare(left=Call(func=Name(id='len', ctx=Load(), lineno=163, col_offset=18, end_lineno=163, end_col_offset=21), args=[Subscript(value=Name(id='result', ctx=Load(), lineno=163, col_offset=22, end_lineno=163, end_col_offset=28), slice=Constant(value='matches', lineno=163, col_offset=29, end_lineno=163, end_col_offset=38), ctx=Load(), lineno=163, col_offset=22, end_lineno=163, end_col_offset=39)], lineno=163, col_offset=18, end_lineno=163, end_col_offset=40), ops=[Eq()], comparators=[Name(id='expected_match_count', ctx=Load(), lineno=163, col_offset=44, end_lineno=163, end_col_offset=64)], lineno=163, col_offset=18, end_lineno=163, end_col_offset=64), lineno=163, col_offset=8, end_lineno=163, end_col_offset=64), keyword(arg='message', value=Constant(value='Expected two normalized matches', lineno=164, col_offset=16, end_lineno=164, end_col_offset=49), lineno=164, col_offset=8, end_lineno=164, end_col_offset=49)], lineno=162, col_offset=4, end_lineno=165, end_col_offset=5), lineno=162, col_offset=4, end_lineno=165, end_col_offset=5), Expr(value=Call(func=Name(id='_expect', ctx=Load(), lineno=166, col_offset=4, end_lineno=166, end_col_offset=11), keywords=[keyword(arg='condition', value=Compare(left=SetComp(elt=Subscript(value=Name(id='match', ctx=Load(), lineno=167, col_offset=19, end_lineno=167, end_col_offset=24), slice=Constant(value='line', lineno=167, col_offset=25, end_lineno=167, end_col_offset=31), ctx=Load(), lineno=167, col_offset=19, end_lineno=167, end_col_offset=32), generators=[comprehension(target=Name(id='match', ctx=Store(), lineno=167, col_offset=37, end_lineno=167, end_col_offset=42), iter=Subscript(value=Name(id='result', ctx=Load(), lineno=167, col_offset=46, end_lineno=167, end_col_offset=52), slice=Constant(value='matches', lineno=167, col_offset=53, end_lineno=167, end_col_offset=62), ctx=Load(), lineno=167, col_offset=46, end_lineno=167, end_col_offset=63), is_async=0)], lineno=167, col_offset=18, end_lineno=167, end_col_offset=64), ops=[Eq()], comparators=[Set(elts=[Constant(value=1, lineno=167, col_offset=69, end_lineno=167, end_col_offset=70), Constant(value=2, lineno=167, col_offset=72, end_lineno=167, end_col_offset=73)], lineno=167, col_offset=68, end_lineno=167, end_col_offset=74)], lineno=167, col_offset=18, end_lineno=167, end_col_offset=74), lineno=167, col_offset=8, end_lineno=167, end_col_offset=74), keyword(arg='message', value=Constant(value='Expected both relative paths to be preserved', lineno=168, col_offset=16, end_lineno=168, end_col_offset=62), lineno=168, col_offset=8, end_lineno=168, end_col_offset=62)], lineno=166, col_offset=4, end_lineno=169, end_col_offset=5), lineno=166, col_offset=4, end_lineno=169, end_col_offset=5), Expr(value=Call(func=Name(id='_expect', ctx=Load(), lineno=170, col_offset=4, end_lineno=170, end_col_offset=11), keywords=[keyword(arg='condition', value=Call(func=Name(id='all', ctx=Load(), lineno=171, col_offset=18, end_lineno=171, end_col_offset=21), args=[GeneratorExp(elt=Compare(left=Subscript(value=Name(id='match', ctx=Load(), lineno=171, col_offset=22, end_lineno=171, end_col_offset=27), slice=Constant(value='path', lineno=171, col_offset=28, end_lineno=171, end_col_offset=34), ctx=Load(), lineno=171, col_offset=22, end_lineno=171, end_col_offset=35), ops=[Eq()], comparators=[Constant(value='README.md', lineno=171, col_offset=39, end_lineno=171, end_col_offset=50)], lineno=171, col_offset=22, end_lineno=171, end_col_offset=50), generators=[comprehension(target=Name(id='match', ctx=Store(), lineno=171, col_offset=55, end_lineno=171, end_col_offset=60), iter=Subscript(value=Name(id='result', ctx=Load(), lineno=171, col_offset=64, end_lineno=171, end_col_offset=70), slice=Constant(value='matches', lineno=171, col_offset=71, end_lineno=171, end_col_offset=80), ctx=Load(), lineno=171, col_offset=64, end_lineno=171, end_col_offset=81), is_async=0)], lineno=171, col_offset=21, end_lineno=171, end_col_offset=82)], lineno=171, col_offset=18, end_lineno=171, end_col_offset=82), lineno=171, col_offset=8, end_lineno=171, end_col_offset=82), keyword(arg='message', value=Constant(value='Expected normalized repo-relative paths', lineno=172, col_offset=16, end_lineno=172, end_col_offset=57), lineno=172, col_offset=8, end_lineno=172, end_col_offset=57)], lineno=170, col_offset=4, end_lineno=173, end_col_offset=5), lineno=170, col_offset=4, end_lineno=173, end_col_offset=5)], decorator_list=[Attribute(value=Attribute(value=Name(id='pytest', ctx=Load(), lineno=136, col_offset=1, end_lineno=136, end_col_offset=7), attr='mark', ctx=Load(), lineno=136, col_offset=1, end_lineno=136, end_col_offset=12), attr='asyncio', ctx=Load(), lineno=136, col_offset=1, end_lineno=136, end_col_offset=20), Call(func=Attribute(value=Attribute(value=Name(id='pytest', ctx=Load(), lineno=137, col_offset=1, end_lineno=137, end_col_offset=7), attr='mark', ctx=Load(), lineno=137, col_offset=1, end_lineno=137, end_col_offset=12), attr='usefixtures', ctx=Load(), lineno=137, col_offset=1, end_lineno=137, end_col_offset=24), args=[Constant(value='mock_session_id', lineno=137, col_offset=25, end_lineno=137, end_col_offset=42)], lineno=137, col_offset=1, end_lineno=137, end_col_offset=43)], returns=Constant(value=None, lineno=140, col_offset=5, end_lineno=140, end_col_offset=9), lineno=138, col_offset=0, end_lineno=173, end_col_offset=5)])