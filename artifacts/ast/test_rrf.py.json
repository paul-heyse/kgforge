Module(body=[ImportFrom(module='__future__', names=[alias(name='annotations', lineno=1, col_offset=23, end_lineno=1, end_col_offset=34)], level=0, lineno=1, col_offset=0, end_lineno=1, end_col_offset=34), Import(names=[alias(name='pytest', lineno=3, col_offset=7, end_lineno=3, end_col_offset=13)], lineno=3, col_offset=0, end_lineno=3, end_col_offset=13), ImportFrom(module='codeintel_rev.io.rrf', names=[alias(name='weighted_rrf', lineno=4, col_offset=33, end_lineno=4, end_col_offset=45)], level=0, lineno=4, col_offset=0, end_lineno=4, end_col_offset=45), FunctionDef(name='test_weighted_rrf_combines_channels', args=arguments(), body=[Assign(targets=[Tuple(elts=[Name(id='fused_ids', ctx=Store(), lineno=8, col_offset=4, end_lineno=8, end_col_offset=13), Name(id='contributions', ctx=Store(), lineno=8, col_offset=15, end_lineno=8, end_col_offset=28), Name(id='scores', ctx=Store(), lineno=8, col_offset=30, end_lineno=8, end_col_offset=36)], ctx=Store(), lineno=8, col_offset=4, end_lineno=8, end_col_offset=36)], value=Call(func=Name(id='weighted_rrf', ctx=Load(), lineno=8, col_offset=39, end_lineno=8, end_col_offset=51), args=[Dict(keys=[Constant(value='coderank', lineno=10, col_offset=12, end_lineno=10, end_col_offset=22), Constant(value='warp', lineno=11, col_offset=12, end_lineno=11, end_col_offset=18)], values=[List(elts=[Tuple(elts=[Constant(value=1, lineno=10, col_offset=26, end_lineno=10, end_col_offset=27), Constant(value=0.9, lineno=10, col_offset=29, end_lineno=10, end_col_offset=32)], ctx=Load(), lineno=10, col_offset=25, end_lineno=10, end_col_offset=33), Tuple(elts=[Constant(value=2, lineno=10, col_offset=36, end_lineno=10, end_col_offset=37), Constant(value=0.8, lineno=10, col_offset=39, end_lineno=10, end_col_offset=42)], ctx=Load(), lineno=10, col_offset=35, end_lineno=10, end_col_offset=43)], ctx=Load(), lineno=10, col_offset=24, end_lineno=10, end_col_offset=44), List(elts=[Tuple(elts=[Constant(value=2, lineno=11, col_offset=22, end_lineno=11, end_col_offset=23), Constant(value=0.95, lineno=11, col_offset=25, end_lineno=11, end_col_offset=29)], ctx=Load(), lineno=11, col_offset=21, end_lineno=11, end_col_offset=30)], ctx=Load(), lineno=11, col_offset=20, end_lineno=11, end_col_offset=31)], lineno=9, col_offset=8, end_lineno=12, end_col_offset=9)], keywords=[keyword(arg='weights', value=Dict(keys=[Constant(value='coderank', lineno=13, col_offset=17, end_lineno=13, end_col_offset=27), Constant(value='warp', lineno=13, col_offset=34, end_lineno=13, end_col_offset=40)], values=[Constant(value=1.0, lineno=13, col_offset=29, end_lineno=13, end_col_offset=32), Constant(value=2.0, lineno=13, col_offset=42, end_lineno=13, end_col_offset=45)], lineno=13, col_offset=16, end_lineno=13, end_col_offset=46), lineno=13, col_offset=8, end_lineno=13, end_col_offset=46), keyword(arg='k', value=Constant(value=60, lineno=14, col_offset=10, end_lineno=14, end_col_offset=12), lineno=14, col_offset=8, end_lineno=14, end_col_offset=12), keyword(arg='top_k', value=Constant(value=2, lineno=15, col_offset=14, end_lineno=15, end_col_offset=15), lineno=15, col_offset=8, end_lineno=15, end_col_offset=15)], lineno=8, col_offset=39, end_lineno=16, end_col_offset=5), lineno=8, col_offset=4, end_lineno=16, end_col_offset=5), Assert(test=Compare(left=Name(id='fused_ids', ctx=Load(), lineno=18, col_offset=11, end_lineno=18, end_col_offset=20), ops=[Eq()], comparators=[List(elts=[Constant(value=2, lineno=18, col_offset=25, end_lineno=18, end_col_offset=26), Constant(value=1, lineno=18, col_offset=28, end_lineno=18, end_col_offset=29)], ctx=Load(), lineno=18, col_offset=24, end_lineno=18, end_col_offset=30)], lineno=18, col_offset=11, end_lineno=18, end_col_offset=30), lineno=18, col_offset=4, end_lineno=18, end_col_offset=30), Assert(test=Compare(left=Subscript(value=Name(id='scores', ctx=Load(), lineno=19, col_offset=11, end_lineno=19, end_col_offset=17), slice=Constant(value=2, lineno=19, col_offset=18, end_lineno=19, end_col_offset=19), ctx=Load(), lineno=19, col_offset=11, end_lineno=19, end_col_offset=20), ops=[Gt()], comparators=[Subscript(value=Name(id='scores', ctx=Load(), lineno=19, col_offset=23, end_lineno=19, end_col_offset=29), slice=Constant(value=1, lineno=19, col_offset=30, end_lineno=19, end_col_offset=31), ctx=Load(), lineno=19, col_offset=23, end_lineno=19, end_col_offset=32)], lineno=19, col_offset=11, end_lineno=19, end_col_offset=32), lineno=19, col_offset=4, end_lineno=19, end_col_offset=32), Assign(targets=[Name(id='channel_names', ctx=Store(), lineno=20, col_offset=4, end_lineno=20, end_col_offset=17)], value=ListComp(elt=Subscript(value=Name(id='entry', ctx=Load(), lineno=20, col_offset=21, end_lineno=20, end_col_offset=26), slice=Constant(value=0, lineno=20, col_offset=27, end_lineno=20, end_col_offset=28), ctx=Load(), lineno=20, col_offset=21, end_lineno=20, end_col_offset=29), generators=[comprehension(target=Name(id='entry', ctx=Store(), lineno=20, col_offset=34, end_lineno=20, end_col_offset=39), iter=Subscript(value=Name(id='contributions', ctx=Load(), lineno=20, col_offset=43, end_lineno=20, end_col_offset=56), slice=Constant(value=2, lineno=20, col_offset=57, end_lineno=20, end_col_offset=58), ctx=Load(), lineno=20, col_offset=43, end_lineno=20, end_col_offset=59), is_async=0)], lineno=20, col_offset=20, end_lineno=20, end_col_offset=60), lineno=20, col_offset=4, end_lineno=20, end_col_offset=60), Assert(test=Compare(left=Constant(value='warp', lineno=21, col_offset=11, end_lineno=21, end_col_offset=17), ops=[In()], comparators=[Name(id='channel_names', ctx=Load(), lineno=21, col_offset=21, end_lineno=21, end_col_offset=34)], lineno=21, col_offset=11, end_lineno=21, end_col_offset=34), lineno=21, col_offset=4, end_lineno=21, end_col_offset=34), Assert(test=Compare(left=Constant(value='coderank', lineno=22, col_offset=11, end_lineno=22, end_col_offset=21), ops=[In()], comparators=[Name(id='channel_names', ctx=Load(), lineno=22, col_offset=25, end_lineno=22, end_col_offset=38)], lineno=22, col_offset=11, end_lineno=22, end_col_offset=38), lineno=22, col_offset=4, end_lineno=22, end_col_offset=38)], returns=Constant(value=None, lineno=7, col_offset=45, end_lineno=7, end_col_offset=49), lineno=7, col_offset=0, end_lineno=22, end_col_offset=38), FunctionDef(name='test_weighted_rrf_rejects_invalid_topk', args=arguments(), body=[With(items=[withitem(context_expr=Call(func=Attribute(value=Name(id='pytest', ctx=Load(), lineno=26, col_offset=9, end_lineno=26, end_col_offset=15), attr='raises', ctx=Load(), lineno=26, col_offset=9, end_lineno=26, end_col_offset=22), args=[Name(id='ValueError', ctx=Load(), lineno=26, col_offset=23, end_lineno=26, end_col_offset=33)], keywords=[keyword(arg='match', value=Constant(value='top_k', lineno=26, col_offset=41, end_lineno=26, end_col_offset=48), lineno=26, col_offset=35, end_lineno=26, end_col_offset=48)], lineno=26, col_offset=9, end_lineno=26, end_col_offset=49))], body=[Expr(value=Call(func=Name(id='weighted_rrf', ctx=Load(), lineno=27, col_offset=8, end_lineno=27, end_col_offset=20), args=[Dict(keys=[Constant(value='coderank', lineno=27, col_offset=22, end_lineno=27, end_col_offset=32)], values=[List(ctx=Load(), lineno=27, col_offset=34, end_lineno=27, end_col_offset=36)], lineno=27, col_offset=21, end_lineno=27, end_col_offset=37)], keywords=[keyword(arg='weights', value=Dict(keys=[Constant(value='coderank', lineno=27, col_offset=48, end_lineno=27, end_col_offset=58)], values=[Constant(value=1.0, lineno=27, col_offset=60, end_lineno=27, end_col_offset=63)], lineno=27, col_offset=47, end_lineno=27, end_col_offset=64), lineno=27, col_offset=39, end_lineno=27, end_col_offset=64), keyword(arg='k', value=Constant(value=60, lineno=27, col_offset=68, end_lineno=27, end_col_offset=70), lineno=27, col_offset=66, end_lineno=27, end_col_offset=70), keyword(arg='top_k', value=Constant(value=0, lineno=27, col_offset=78, end_lineno=27, end_col_offset=79), lineno=27, col_offset=72, end_lineno=27, end_col_offset=79)], lineno=27, col_offset=8, end_lineno=27, end_col_offset=80), lineno=27, col_offset=8, end_lineno=27, end_col_offset=80)], lineno=26, col_offset=4, end_lineno=27, end_col_offset=80)], returns=Constant(value=None, lineno=25, col_offset=48, end_lineno=25, end_col_offset=52), lineno=25, col_offset=0, end_lineno=27, end_col_offset=80), FunctionDef(name='test_weighted_rrf_applies_minmax_normalization', args=arguments(), body=[Assign(targets=[Tuple(elts=[Name(id='_', ctx=Store(), lineno=31, col_offset=4, end_lineno=31, end_col_offset=5), Name(id='contributions', ctx=Store(), lineno=31, col_offset=7, end_lineno=31, end_col_offset=20), Name(id='_scores', ctx=Store(), lineno=31, col_offset=22, end_lineno=31, end_col_offset=29)], ctx=Store(), lineno=31, col_offset=4, end_lineno=31, end_col_offset=29)], value=Call(func=Name(id='weighted_rrf', ctx=Load(), lineno=31, col_offset=32, end_lineno=31, end_col_offset=44), args=[Dict(keys=[Constant(value='coderank', lineno=32, col_offset=9, end_lineno=32, end_col_offset=19)], values=[List(elts=[Tuple(elts=[Constant(value=1, lineno=32, col_offset=23, end_lineno=32, end_col_offset=24), Constant(value=10.0, lineno=32, col_offset=26, end_lineno=32, end_col_offset=30)], ctx=Load(), lineno=32, col_offset=22, end_lineno=32, end_col_offset=31), Tuple(elts=[Constant(value=2, lineno=32, col_offset=34, end_lineno=32, end_col_offset=35), Constant(value=11.0, lineno=32, col_offset=37, end_lineno=32, end_col_offset=41)], ctx=Load(), lineno=32, col_offset=33, end_lineno=32, end_col_offset=42)], ctx=Load(), lineno=32, col_offset=21, end_lineno=32, end_col_offset=43)], lineno=32, col_offset=8, end_lineno=32, end_col_offset=44)], keywords=[keyword(arg='weights', value=Dict(keys=[Constant(value='coderank', lineno=33, col_offset=17, end_lineno=33, end_col_offset=27)], values=[Constant(value=1.0, lineno=33, col_offset=29, end_lineno=33, end_col_offset=32)], lineno=33, col_offset=16, end_lineno=33, end_col_offset=33), lineno=33, col_offset=8, end_lineno=33, end_col_offset=33), keyword(arg='k', value=Constant(value=60, lineno=34, col_offset=10, end_lineno=34, end_col_offset=12), lineno=34, col_offset=8, end_lineno=34, end_col_offset=12), keyword(arg='top_k', value=Constant(value=2, lineno=35, col_offset=14, end_lineno=35, end_col_offset=15), lineno=35, col_offset=8, end_lineno=35, end_col_offset=15), keyword(arg='normalize', value=Constant(value='minmax', lineno=36, col_offset=18, end_lineno=36, end_col_offset=26), lineno=36, col_offset=8, end_lineno=36, end_col_offset=26)], lineno=31, col_offset=32, end_lineno=37, end_col_offset=5), lineno=31, col_offset=4, end_lineno=37, end_col_offset=5), Assign(targets=[Name(id='coderank_entries', ctx=Store(), lineno=38, col_offset=4, end_lineno=38, end_col_offset=20)], value=DictComp(key=Name(id='doc_id', ctx=Load(), lineno=38, col_offset=24, end_lineno=38, end_col_offset=30), value=Subscript(value=Subscript(value=Name(id='contribs', ctx=Load(), lineno=38, col_offset=32, end_lineno=38, end_col_offset=40), slice=Constant(value=0, lineno=38, col_offset=41, end_lineno=38, end_col_offset=42), ctx=Load(), lineno=38, col_offset=32, end_lineno=38, end_col_offset=43), slice=Constant(value=2, lineno=38, col_offset=44, end_lineno=38, end_col_offset=45), ctx=Load(), lineno=38, col_offset=32, end_lineno=38, end_col_offset=46), generators=[comprehension(target=Tuple(elts=[Name(id='doc_id', ctx=Store(), lineno=38, col_offset=51, end_lineno=38, end_col_offset=57), Name(id='contribs', ctx=Store(), lineno=38, col_offset=59, end_lineno=38, end_col_offset=67)], ctx=Store(), lineno=38, col_offset=51, end_lineno=38, end_col_offset=67), iter=Call(func=Attribute(value=Name(id='contributions', ctx=Load(), lineno=38, col_offset=71, end_lineno=38, end_col_offset=84), attr='items', ctx=Load(), lineno=38, col_offset=71, end_lineno=38, end_col_offset=90), lineno=38, col_offset=71, end_lineno=38, end_col_offset=92), is_async=0)], lineno=38, col_offset=23, end_lineno=38, end_col_offset=93), lineno=38, col_offset=4, end_lineno=38, end_col_offset=93), Assert(test=Compare(left=Subscript(value=Name(id='coderank_entries', ctx=Load(), lineno=39, col_offset=11, end_lineno=39, end_col_offset=27), slice=Constant(value=1, lineno=39, col_offset=28, end_lineno=39, end_col_offset=29), ctx=Load(), lineno=39, col_offset=11, end_lineno=39, end_col_offset=30), ops=[Eq()], comparators=[Constant(value=0.0, lineno=39, col_offset=34, end_lineno=39, end_col_offset=37)], lineno=39, col_offset=11, end_lineno=39, end_col_offset=37), lineno=39, col_offset=4, end_lineno=39, end_col_offset=37), Assert(test=Compare(left=Subscript(value=Name(id='coderank_entries', ctx=Load(), lineno=40, col_offset=11, end_lineno=40, end_col_offset=27), slice=Constant(value=2, lineno=40, col_offset=28, end_lineno=40, end_col_offset=29), ctx=Load(), lineno=40, col_offset=11, end_lineno=40, end_col_offset=30), ops=[Eq()], comparators=[Constant(value=1.0, lineno=40, col_offset=34, end_lineno=40, end_col_offset=37)], lineno=40, col_offset=11, end_lineno=40, end_col_offset=37), lineno=40, col_offset=4, end_lineno=40, end_col_offset=37)], returns=Constant(value=None, lineno=30, col_offset=56, end_lineno=30, end_col_offset=60), lineno=30, col_offset=0, end_lineno=40, end_col_offset=37)])