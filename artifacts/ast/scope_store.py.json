Module(body=[Expr(value=Constant(value='Scope store utilities for session state management.', lineno=1, col_offset=0, end_lineno=1, end_col_offset=57), lineno=1, col_offset=0, end_lineno=1, end_col_offset=57), ImportFrom(module='__future__', names=[alias(name='annotations', lineno=3, col_offset=23, end_lineno=3, end_col_offset=34)], level=0, lineno=3, col_offset=0, end_lineno=3, end_col_offset=34), Import(names=[alias(name='asyncio', lineno=5, col_offset=7, end_lineno=5, end_col_offset=14)], lineno=5, col_offset=0, end_lineno=5, end_col_offset=14), Import(names=[alias(name='time', lineno=6, col_offset=7, end_lineno=6, end_col_offset=11)], lineno=6, col_offset=0, end_lineno=6, end_col_offset=11), ImportFrom(module='collections', names=[alias(name='OrderedDict', lineno=7, col_offset=24, end_lineno=7, end_col_offset=35)], level=0, lineno=7, col_offset=0, end_lineno=7, end_col_offset=35), ImportFrom(module='collections.abc', names=[alias(name='Awaitable', lineno=8, col_offset=28, end_lineno=8, end_col_offset=37), alias(name='Callable', lineno=8, col_offset=39, end_lineno=8, end_col_offset=47), alias(name='Hashable', lineno=8, col_offset=49, end_lineno=8, end_col_offset=57), alias(name='Iterator', lineno=8, col_offset=59, end_lineno=8, end_col_offset=67), alias(name='MutableMapping', lineno=8, col_offset=69, end_lineno=8, end_col_offset=83)], level=0, lineno=8, col_offset=0, end_lineno=8, end_col_offset=83), ImportFrom(module='dataclasses', names=[alias(name='dataclass', lineno=9, col_offset=24, end_lineno=9, end_col_offset=33)], level=0, lineno=9, col_offset=0, end_lineno=9, end_col_offset=33), ImportFrom(module='threading', names=[alias(name='RLock', lineno=10, col_offset=22, end_lineno=10, end_col_offset=27)], level=0, lineno=10, col_offset=0, end_lineno=10, end_col_offset=27), ImportFrom(module='typing', names=[alias(name='TYPE_CHECKING', lineno=11, col_offset=19, end_lineno=11, end_col_offset=32), alias(name='Any', lineno=11, col_offset=34, end_lineno=11, end_col_offset=37), alias(name='Protocol', lineno=11, col_offset=39, end_lineno=11, end_col_offset=47), alias(name='cast', lineno=11, col_offset=49, end_lineno=11, end_col_offset=53)], level=0, lineno=11, col_offset=0, end_lineno=11, end_col_offset=53), Import(names=[alias(name='msgspec', lineno=13, col_offset=7, end_lineno=13, end_col_offset=14)], lineno=13, col_offset=0, end_lineno=13, end_col_offset=14), If(test=Name(id='TYPE_CHECKING', ctx=Load(), lineno=15, col_offset=3, end_lineno=15, end_col_offset=16), body=[ImportFrom(module='codeintel_rev.mcp_server.schemas', names=[alias(name='ScopeIn', asname='ScopeMapping', lineno=16, col_offset=49, end_lineno=16, end_col_offset=72)], level=0, lineno=16, col_offset=4, end_lineno=16, end_col_offset=72)], orelse=[Assign(targets=[Name(id='ScopeMapping', ctx=Store(), lineno=18, col_offset=4, end_lineno=18, end_col_offset=16)], value=Subscript(value=Name(id='dict', ctx=Load(), lineno=18, col_offset=19, end_lineno=18, end_col_offset=23), slice=Tuple(elts=[Name(id='str', ctx=Load(), lineno=18, col_offset=24, end_lineno=18, end_col_offset=27), Name(id='Any', ctx=Load(), lineno=18, col_offset=29, end_lineno=18, end_col_offset=32)], ctx=Load(), lineno=18, col_offset=24, end_lineno=18, end_col_offset=32), ctx=Load(), lineno=18, col_offset=19, end_lineno=18, end_col_offset=33), lineno=18, col_offset=4, end_lineno=18, end_col_offset=33)], lineno=15, col_offset=0, end_lineno=18, end_col_offset=33), Assign(targets=[Name(id='ScopeIn', ctx=Store(), lineno=20, col_offset=0, end_lineno=20, end_col_offset=7)], value=Name(id='ScopeMapping', ctx=Load(), lineno=20, col_offset=10, end_lineno=20, end_col_offset=22), lineno=20, col_offset=0, end_lineno=20, end_col_offset=22), ClassDef(name='SupportsAsyncRedis', bases=[Name(id='Protocol', ctx=Load(), lineno=23, col_offset=25, end_lineno=23, end_col_offset=33)], body=[Expr(value=Constant(value='Protocol describing the Redis operations required by ``ScopeStore``.', lineno=24, col_offset=4, end_lineno=24, end_col_offset=78), lineno=24, col_offset=4, end_lineno=24, end_col_offset=78), AsyncFunctionDef(name='get', args=arguments(args=[arg(arg='self', lineno=26, col_offset=18, end_lineno=26, end_col_offset=22), arg(arg='name', annotation=Name(id='str', ctx=Load(), lineno=26, col_offset=30, end_lineno=26, end_col_offset=33), lineno=26, col_offset=24, end_lineno=26, end_col_offset=33)]), body=[Expr(value=Constant(value='Retrieve a value by ``key``.', lineno=27, col_offset=8, end_lineno=27, end_col_offset=42), lineno=27, col_offset=8, end_lineno=27, end_col_offset=42)], returns=BinOp(left=Name(id='bytes', ctx=Load(), lineno=26, col_offset=38, end_lineno=26, end_col_offset=43), op=BitOr(), right=Constant(value=None, lineno=26, col_offset=46, end_lineno=26, end_col_offset=50), lineno=26, col_offset=38, end_lineno=26, end_col_offset=50), lineno=26, col_offset=4, end_lineno=27, end_col_offset=42), AsyncFunctionDef(name='setex', args=arguments(args=[arg(arg='self', lineno=29, col_offset=20, end_lineno=29, end_col_offset=24), arg(arg='name', annotation=Name(id='str', ctx=Load(), lineno=29, col_offset=32, end_lineno=29, end_col_offset=35), lineno=29, col_offset=26, end_lineno=29, end_col_offset=35), arg(arg='time', annotation=Name(id='int', ctx=Load(), lineno=29, col_offset=43, end_lineno=29, end_col_offset=46), lineno=29, col_offset=37, end_lineno=29, end_col_offset=46), arg(arg='value', annotation=Name(id='bytes', ctx=Load(), lineno=29, col_offset=55, end_lineno=29, end_col_offset=60), lineno=29, col_offset=48, end_lineno=29, end_col_offset=60)]), body=[Expr(value=Constant(value='Set ``key`` to ``value`` with the provided TTL in seconds.', lineno=30, col_offset=8, end_lineno=30, end_col_offset=72), lineno=30, col_offset=8, end_lineno=30, end_col_offset=72)], returns=BinOp(left=Name(id='bool', ctx=Load(), lineno=29, col_offset=65, end_lineno=29, end_col_offset=69), op=BitOr(), right=Constant(value=None, lineno=29, col_offset=72, end_lineno=29, end_col_offset=76), lineno=29, col_offset=65, end_lineno=29, end_col_offset=76), lineno=29, col_offset=4, end_lineno=30, end_col_offset=72), AsyncFunctionDef(name='set', args=arguments(args=[arg(arg='self', lineno=32, col_offset=18, end_lineno=32, end_col_offset=22), arg(arg='name', annotation=Name(id='str', ctx=Load(), lineno=32, col_offset=30, end_lineno=32, end_col_offset=33), lineno=32, col_offset=24, end_lineno=32, end_col_offset=33), arg(arg='value', annotation=Name(id='bytes', ctx=Load(), lineno=32, col_offset=42, end_lineno=32, end_col_offset=47), lineno=32, col_offset=35, end_lineno=32, end_col_offset=47)]), body=[Expr(value=Constant(value='Set ``key`` to ``value`` without TTL semantics.', lineno=33, col_offset=8, end_lineno=33, end_col_offset=61), lineno=33, col_offset=8, end_lineno=33, end_col_offset=61)], returns=BinOp(left=Name(id='bool', ctx=Load(), lineno=32, col_offset=52, end_lineno=32, end_col_offset=56), op=BitOr(), right=Constant(value=None, lineno=32, col_offset=59, end_lineno=32, end_col_offset=63), lineno=32, col_offset=52, end_lineno=32, end_col_offset=63), lineno=32, col_offset=4, end_lineno=33, end_col_offset=61), AsyncFunctionDef(name='delete', args=arguments(args=[arg(arg='self', lineno=35, col_offset=21, end_lineno=35, end_col_offset=25)], vararg=arg(arg='names', annotation=Name(id='str', ctx=Load(), lineno=35, col_offset=35, end_lineno=35, end_col_offset=38), lineno=35, col_offset=28, end_lineno=35, end_col_offset=38)), body=[Expr(value=Constant(value='Delete ``key`` if present.', lineno=36, col_offset=8, end_lineno=36, end_col_offset=40), lineno=36, col_offset=8, end_lineno=36, end_col_offset=40)], returns=BinOp(left=Name(id='int', ctx=Load(), lineno=35, col_offset=43, end_lineno=35, end_col_offset=46), op=BitOr(), right=Constant(value=None, lineno=35, col_offset=49, end_lineno=35, end_col_offset=53), lineno=35, col_offset=43, end_lineno=35, end_col_offset=53), lineno=35, col_offset=4, end_lineno=36, end_col_offset=40), AsyncFunctionDef(name='close', args=arguments(args=[arg(arg='self', lineno=38, col_offset=20, end_lineno=38, end_col_offset=24)]), body=[Expr(value=Constant(value='Close open Redis connections.', lineno=39, col_offset=8, end_lineno=39, end_col_offset=43), lineno=39, col_offset=8, end_lineno=39, end_col_offset=43)], returns=Constant(value=None, lineno=38, col_offset=29, end_lineno=38, end_col_offset=33), lineno=38, col_offset=4, end_lineno=39, end_col_offset=43)], lineno=23, col_offset=0, end_lineno=39, end_col_offset=43), ClassDef(name='_CacheRecord', body=[Expr(value=Constant(value='Internal cache record containing a value and its insertion timestamp.', lineno=44, col_offset=4, end_lineno=44, end_col_offset=79), lineno=44, col_offset=4, end_lineno=44, end_col_offset=79), AnnAssign(target=Name(id='value', ctx=Store(), lineno=46, col_offset=4, end_lineno=46, end_col_offset=9), annotation=Name(id='ValueT', ctx=Load(), lineno=46, col_offset=11, end_lineno=46, end_col_offset=17), simple=1, lineno=46, col_offset=4, end_lineno=46, end_col_offset=17), AnnAssign(target=Name(id='inserted_at', ctx=Store(), lineno=47, col_offset=4, end_lineno=47, end_col_offset=15), annotation=Name(id='float', ctx=Load(), lineno=47, col_offset=17, end_lineno=47, end_col_offset=22), simple=1, lineno=47, col_offset=4, end_lineno=47, end_col_offset=22)], decorator_list=[Call(func=Name(id='dataclass', ctx=Load(), lineno=42, col_offset=1, end_lineno=42, end_col_offset=10), keywords=[keyword(arg='slots', value=Constant(value=True, lineno=42, col_offset=17, end_lineno=42, end_col_offset=21), lineno=42, col_offset=11, end_lineno=42, end_col_offset=21), keyword(arg='frozen', value=Constant(value=True, lineno=42, col_offset=30, end_lineno=42, end_col_offset=34), lineno=42, col_offset=23, end_lineno=42, end_col_offset=34)], lineno=42, col_offset=1, end_lineno=42, end_col_offset=35)], type_params=[TypeVar(name='ValueT', lineno=43, col_offset=19, end_lineno=43, end_col_offset=25)], lineno=43, col_offset=0, end_lineno=47, end_col_offset=22), ClassDef(name='LRUCache', body=[Expr(value=Constant(value='Thread-safe least-recently-used cache with TTL-based eviction.\n\n    Parameters\n    ----------\n    maxsize : int, optional\n        Maximum number of entries to retain. Must be positive.\n    ttl_seconds : float | None, optional\n        Time-to-live for each entry in seconds. When ``None``, entries never\n        expire due to age.\n    now_fn : Callable[[], float], optional\n        Injectable monotonic time source, primarily for testing. Defaults to\n        ``time.monotonic``.\n\n    Raises\n    ------\n    ValueError\n        If ``maxsize`` is not positive or if ``ttl_seconds`` is provided but\n        not positive (when not ``None``).\n    ', lineno=51, col_offset=4, end_lineno=69, end_col_offset=7), lineno=51, col_offset=4, end_lineno=69, end_col_offset=7), FunctionDef(name='__init__', args=arguments(args=[arg(arg='self', lineno=72, col_offset=8, end_lineno=72, end_col_offset=12), arg(arg='maxsize', annotation=Name(id='int', ctx=Load(), lineno=73, col_offset=17, end_lineno=73, end_col_offset=20), lineno=73, col_offset=8, end_lineno=73, end_col_offset=20), arg(arg='ttl_seconds', annotation=BinOp(left=Name(id='float', ctx=Load(), lineno=74, col_offset=21, end_lineno=74, end_col_offset=26), op=BitOr(), right=Constant(value=None, lineno=74, col_offset=29, end_lineno=74, end_col_offset=33), lineno=74, col_offset=21, end_lineno=74, end_col_offset=33), lineno=74, col_offset=8, end_lineno=74, end_col_offset=33)], kwonlyargs=[arg(arg='now_fn', annotation=Subscript(value=Name(id='Callable', ctx=Load(), lineno=76, col_offset=16, end_lineno=76, end_col_offset=24), slice=Tuple(elts=[List(ctx=Load(), lineno=76, col_offset=25, end_lineno=76, end_col_offset=27), Name(id='float', ctx=Load(), lineno=76, col_offset=29, end_lineno=76, end_col_offset=34)], ctx=Load(), lineno=76, col_offset=25, end_lineno=76, end_col_offset=34), ctx=Load(), lineno=76, col_offset=16, end_lineno=76, end_col_offset=35), lineno=76, col_offset=8, end_lineno=76, end_col_offset=35)], kw_defaults=[Attribute(value=Name(id='time', ctx=Load(), lineno=76, col_offset=38, end_lineno=76, end_col_offset=42), attr='monotonic', ctx=Load(), lineno=76, col_offset=38, end_lineno=76, end_col_offset=52)], defaults=[Constant(value=256, lineno=73, col_offset=23, end_lineno=73, end_col_offset=26), Constant(value=300.0, lineno=74, col_offset=36, end_lineno=74, end_col_offset=41)]), body=[If(test=Compare(left=Name(id='maxsize', ctx=Load(), lineno=78, col_offset=11, end_lineno=78, end_col_offset=18), ops=[LtE()], comparators=[Constant(value=0, lineno=78, col_offset=22, end_lineno=78, end_col_offset=23)], lineno=78, col_offset=11, end_lineno=78, end_col_offset=23), body=[Assign(targets=[Name(id='msg', ctx=Store(), lineno=79, col_offset=12, end_lineno=79, end_col_offset=15)], value=JoinedStr(values=[Constant(value='maxsize must be positive, got ', lineno=79, col_offset=20, end_lineno=79, end_col_offset=50), FormattedValue(value=Name(id='maxsize', ctx=Load(), lineno=79, col_offset=51, end_lineno=79, end_col_offset=58), conversion=-1, lineno=79, col_offset=50, end_lineno=79, end_col_offset=59)], lineno=79, col_offset=18, end_lineno=79, end_col_offset=60), lineno=79, col_offset=12, end_lineno=79, end_col_offset=60), Raise(exc=Call(func=Name(id='ValueError', ctx=Load(), lineno=80, col_offset=18, end_lineno=80, end_col_offset=28), args=[Name(id='msg', ctx=Load(), lineno=80, col_offset=29, end_lineno=80, end_col_offset=32)], lineno=80, col_offset=18, end_lineno=80, end_col_offset=33), lineno=80, col_offset=12, end_lineno=80, end_col_offset=33)], lineno=78, col_offset=8, end_lineno=80, end_col_offset=33), If(test=BoolOp(op=And(), values=[Compare(left=Name(id='ttl_seconds', ctx=Load(), lineno=82, col_offset=11, end_lineno=82, end_col_offset=22), ops=[IsNot()], comparators=[Constant(value=None, lineno=82, col_offset=30, end_lineno=82, end_col_offset=34)], lineno=82, col_offset=11, end_lineno=82, end_col_offset=34), Compare(left=Name(id='ttl_seconds', ctx=Load(), lineno=82, col_offset=39, end_lineno=82, end_col_offset=50), ops=[LtE()], comparators=[Constant(value=0, lineno=82, col_offset=54, end_lineno=82, end_col_offset=55)], lineno=82, col_offset=39, end_lineno=82, end_col_offset=55)], lineno=82, col_offset=11, end_lineno=82, end_col_offset=55), body=[Assign(targets=[Name(id='msg', ctx=Store(), lineno=83, col_offset=12, end_lineno=83, end_col_offset=15)], value=JoinedStr(values=[Constant(value='ttl_seconds must be positive or None, got ', lineno=83, col_offset=20, end_lineno=83, end_col_offset=62), FormattedValue(value=Name(id='ttl_seconds', ctx=Load(), lineno=83, col_offset=63, end_lineno=83, end_col_offset=74), conversion=-1, lineno=83, col_offset=62, end_lineno=83, end_col_offset=75)], lineno=83, col_offset=18, end_lineno=83, end_col_offset=76), lineno=83, col_offset=12, end_lineno=83, end_col_offset=76), Raise(exc=Call(func=Name(id='ValueError', ctx=Load(), lineno=84, col_offset=18, end_lineno=84, end_col_offset=28), args=[Name(id='msg', ctx=Load(), lineno=84, col_offset=29, end_lineno=84, end_col_offset=32)], lineno=84, col_offset=18, end_lineno=84, end_col_offset=33), lineno=84, col_offset=12, end_lineno=84, end_col_offset=33)], lineno=82, col_offset=8, end_lineno=84, end_col_offset=33), Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=86, col_offset=8, end_lineno=86, end_col_offset=12), attr='_maxsize', ctx=Store(), lineno=86, col_offset=8, end_lineno=86, end_col_offset=21)], value=Name(id='maxsize', ctx=Load(), lineno=86, col_offset=24, end_lineno=86, end_col_offset=31), lineno=86, col_offset=8, end_lineno=86, end_col_offset=31), Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=87, col_offset=8, end_lineno=87, end_col_offset=12), attr='_ttl_seconds', ctx=Store(), lineno=87, col_offset=8, end_lineno=87, end_col_offset=25)], value=Name(id='ttl_seconds', ctx=Load(), lineno=87, col_offset=28, end_lineno=87, end_col_offset=39), lineno=87, col_offset=8, end_lineno=87, end_col_offset=39), Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=88, col_offset=8, end_lineno=88, end_col_offset=12), attr='_now', ctx=Store(), lineno=88, col_offset=8, end_lineno=88, end_col_offset=17)], value=Name(id='now_fn', ctx=Load(), lineno=88, col_offset=20, end_lineno=88, end_col_offset=26), lineno=88, col_offset=8, end_lineno=88, end_col_offset=26), Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=89, col_offset=8, end_lineno=89, end_col_offset=12), attr='_lock', ctx=Store(), lineno=89, col_offset=8, end_lineno=89, end_col_offset=18)], value=Call(func=Name(id='RLock', ctx=Load(), lineno=89, col_offset=21, end_lineno=89, end_col_offset=26), lineno=89, col_offset=21, end_lineno=89, end_col_offset=28), lineno=89, col_offset=8, end_lineno=89, end_col_offset=28), AnnAssign(target=Attribute(value=Name(id='self', ctx=Load(), lineno=90, col_offset=8, end_lineno=90, end_col_offset=12), attr='_store', ctx=Store(), lineno=90, col_offset=8, end_lineno=90, end_col_offset=19), annotation=Subscript(value=Name(id='OrderedDict', ctx=Load(), lineno=90, col_offset=21, end_lineno=90, end_col_offset=32), slice=Tuple(elts=[Name(id='KeyT', ctx=Load(), lineno=90, col_offset=33, end_lineno=90, end_col_offset=37), Subscript(value=Name(id='_CacheRecord', ctx=Load(), lineno=90, col_offset=39, end_lineno=90, end_col_offset=51), slice=Name(id='ValueT', ctx=Load(), lineno=90, col_offset=52, end_lineno=90, end_col_offset=58), ctx=Load(), lineno=90, col_offset=39, end_lineno=90, end_col_offset=59)], ctx=Load(), lineno=90, col_offset=33, end_lineno=90, end_col_offset=59), ctx=Load(), lineno=90, col_offset=21, end_lineno=90, end_col_offset=60), value=Call(func=Name(id='OrderedDict', ctx=Load(), lineno=90, col_offset=63, end_lineno=90, end_col_offset=74), lineno=90, col_offset=63, end_lineno=90, end_col_offset=76), simple=0, lineno=90, col_offset=8, end_lineno=90, end_col_offset=76)], returns=Constant(value=None, lineno=77, col_offset=9, end_lineno=77, end_col_offset=13), lineno=71, col_offset=4, end_lineno=90, end_col_offset=76), FunctionDef(name='get', args=arguments(args=[arg(arg='self', lineno=92, col_offset=12, end_lineno=92, end_col_offset=16), arg(arg='key', annotation=Name(id='KeyT', ctx=Load(), lineno=92, col_offset=23, end_lineno=92, end_col_offset=27), lineno=92, col_offset=18, end_lineno=92, end_col_offset=27)]), body=[Expr(value=Constant(value='\n        Return the cached value for ``key`` or ``None`` if it is missing or stale.\n\n        Parameters\n        ----------\n        key : KeyT\n            Cache key to retrieve.\n\n        Returns\n        -------\n        ValueT | None\n            Cached value when present and not expired; otherwise ``None``.\n        ', lineno=93, col_offset=8, end_lineno=105, end_col_offset=11), lineno=93, col_offset=8, end_lineno=105, end_col_offset=11), With(items=[withitem(context_expr=Attribute(value=Name(id='self', ctx=Load(), lineno=106, col_offset=13, end_lineno=106, end_col_offset=17), attr='_lock', ctx=Load(), lineno=106, col_offset=13, end_lineno=106, end_col_offset=23))], body=[Assign(targets=[Name(id='record', ctx=Store(), lineno=107, col_offset=12, end_lineno=107, end_col_offset=18)], value=Call(func=Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=107, col_offset=21, end_lineno=107, end_col_offset=25), attr='_store', ctx=Load(), lineno=107, col_offset=21, end_lineno=107, end_col_offset=32), attr='get', ctx=Load(), lineno=107, col_offset=21, end_lineno=107, end_col_offset=36), args=[Name(id='key', ctx=Load(), lineno=107, col_offset=37, end_lineno=107, end_col_offset=40)], lineno=107, col_offset=21, end_lineno=107, end_col_offset=41), lineno=107, col_offset=12, end_lineno=107, end_col_offset=41), If(test=Compare(left=Name(id='record', ctx=Load(), lineno=108, col_offset=15, end_lineno=108, end_col_offset=21), ops=[Is()], comparators=[Constant(value=None, lineno=108, col_offset=25, end_lineno=108, end_col_offset=29)], lineno=108, col_offset=15, end_lineno=108, end_col_offset=29), body=[Return(value=Constant(value=None, lineno=109, col_offset=23, end_lineno=109, end_col_offset=27), lineno=109, col_offset=16, end_lineno=109, end_col_offset=27)], lineno=108, col_offset=12, end_lineno=109, end_col_offset=27), If(test=Call(func=Attribute(value=Name(id='self', ctx=Load(), lineno=111, col_offset=15, end_lineno=111, end_col_offset=19), attr='_is_expired', ctx=Load(), lineno=111, col_offset=15, end_lineno=111, end_col_offset=31), args=[Name(id='record', ctx=Load(), lineno=111, col_offset=32, end_lineno=111, end_col_offset=38)], lineno=111, col_offset=15, end_lineno=111, end_col_offset=39), body=[Expr(value=Call(func=Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=112, col_offset=16, end_lineno=112, end_col_offset=20), attr='_store', ctx=Load(), lineno=112, col_offset=16, end_lineno=112, end_col_offset=27), attr='pop', ctx=Load(), lineno=112, col_offset=16, end_lineno=112, end_col_offset=31), args=[Name(id='key', ctx=Load(), lineno=112, col_offset=32, end_lineno=112, end_col_offset=35), Constant(value=None, lineno=112, col_offset=37, end_lineno=112, end_col_offset=41)], lineno=112, col_offset=16, end_lineno=112, end_col_offset=42), lineno=112, col_offset=16, end_lineno=112, end_col_offset=42), Return(value=Constant(value=None, lineno=113, col_offset=23, end_lineno=113, end_col_offset=27), lineno=113, col_offset=16, end_lineno=113, end_col_offset=27)], lineno=111, col_offset=12, end_lineno=113, end_col_offset=27), Expr(value=Call(func=Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=115, col_offset=12, end_lineno=115, end_col_offset=16), attr='_store', ctx=Load(), lineno=115, col_offset=12, end_lineno=115, end_col_offset=23), attr='move_to_end', ctx=Load(), lineno=115, col_offset=12, end_lineno=115, end_col_offset=35), args=[Name(id='key', ctx=Load(), lineno=115, col_offset=36, end_lineno=115, end_col_offset=39)], keywords=[keyword(arg='last', value=Constant(value=True, lineno=115, col_offset=46, end_lineno=115, end_col_offset=50), lineno=115, col_offset=41, end_lineno=115, end_col_offset=50)], lineno=115, col_offset=12, end_lineno=115, end_col_offset=51), lineno=115, col_offset=12, end_lineno=115, end_col_offset=51), Return(value=Attribute(value=Name(id='record', ctx=Load(), lineno=116, col_offset=19, end_lineno=116, end_col_offset=25), attr='value', ctx=Load(), lineno=116, col_offset=19, end_lineno=116, end_col_offset=31), lineno=116, col_offset=12, end_lineno=116, end_col_offset=31)], lineno=106, col_offset=8, end_lineno=116, end_col_offset=31)], returns=BinOp(left=Name(id='ValueT', ctx=Load(), lineno=92, col_offset=32, end_lineno=92, end_col_offset=38), op=BitOr(), right=Constant(value=None, lineno=92, col_offset=41, end_lineno=92, end_col_offset=45), lineno=92, col_offset=32, end_lineno=92, end_col_offset=45), lineno=92, col_offset=4, end_lineno=116, end_col_offset=31), FunctionDef(name='set', args=arguments(args=[arg(arg='self', lineno=118, col_offset=12, end_lineno=118, end_col_offset=16), arg(arg='key', annotation=Name(id='KeyT', ctx=Load(), lineno=118, col_offset=23, end_lineno=118, end_col_offset=27), lineno=118, col_offset=18, end_lineno=118, end_col_offset=27), arg(arg='value', annotation=Name(id='ValueT', ctx=Load(), lineno=118, col_offset=36, end_lineno=118, end_col_offset=42), lineno=118, col_offset=29, end_lineno=118, end_col_offset=42)]), body=[Expr(value=Constant(value='Insert or update ``key`` with ``value`` and refresh its recency.', lineno=119, col_offset=8, end_lineno=119, end_col_offset=78), lineno=119, col_offset=8, end_lineno=119, end_col_offset=78), With(items=[withitem(context_expr=Attribute(value=Name(id='self', ctx=Load(), lineno=120, col_offset=13, end_lineno=120, end_col_offset=17), attr='_lock', ctx=Load(), lineno=120, col_offset=13, end_lineno=120, end_col_offset=23))], body=[If(test=Compare(left=Name(id='key', ctx=Load(), lineno=121, col_offset=15, end_lineno=121, end_col_offset=18), ops=[In()], comparators=[Attribute(value=Name(id='self', ctx=Load(), lineno=121, col_offset=22, end_lineno=121, end_col_offset=26), attr='_store', ctx=Load(), lineno=121, col_offset=22, end_lineno=121, end_col_offset=33)], lineno=121, col_offset=15, end_lineno=121, end_col_offset=33), body=[Expr(value=Call(func=Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=122, col_offset=16, end_lineno=122, end_col_offset=20), attr='_store', ctx=Load(), lineno=122, col_offset=16, end_lineno=122, end_col_offset=27), attr='pop', ctx=Load(), lineno=122, col_offset=16, end_lineno=122, end_col_offset=31), args=[Name(id='key', ctx=Load(), lineno=122, col_offset=32, end_lineno=122, end_col_offset=35), Constant(value=None, lineno=122, col_offset=37, end_lineno=122, end_col_offset=41)], lineno=122, col_offset=16, end_lineno=122, end_col_offset=42), lineno=122, col_offset=16, end_lineno=122, end_col_offset=42)], lineno=121, col_offset=12, end_lineno=122, end_col_offset=42), Assign(targets=[Subscript(value=Attribute(value=Name(id='self', ctx=Load(), lineno=124, col_offset=12, end_lineno=124, end_col_offset=16), attr='_store', ctx=Load(), lineno=124, col_offset=12, end_lineno=124, end_col_offset=23), slice=Name(id='key', ctx=Load(), lineno=124, col_offset=24, end_lineno=124, end_col_offset=27), ctx=Store(), lineno=124, col_offset=12, end_lineno=124, end_col_offset=28)], value=Call(func=Name(id='_CacheRecord', ctx=Load(), lineno=124, col_offset=31, end_lineno=124, end_col_offset=43), keywords=[keyword(arg='value', value=Name(id='value', ctx=Load(), lineno=124, col_offset=50, end_lineno=124, end_col_offset=55), lineno=124, col_offset=44, end_lineno=124, end_col_offset=55), keyword(arg='inserted_at', value=Call(func=Attribute(value=Name(id='self', ctx=Load(), lineno=124, col_offset=69, end_lineno=124, end_col_offset=73), attr='_now', ctx=Load(), lineno=124, col_offset=69, end_lineno=124, end_col_offset=78), lineno=124, col_offset=69, end_lineno=124, end_col_offset=80), lineno=124, col_offset=57, end_lineno=124, end_col_offset=80)], lineno=124, col_offset=31, end_lineno=124, end_col_offset=81), lineno=124, col_offset=12, end_lineno=124, end_col_offset=81), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load(), lineno=125, col_offset=12, end_lineno=125, end_col_offset=16), attr='_enforce_size', ctx=Load(), lineno=125, col_offset=12, end_lineno=125, end_col_offset=30), lineno=125, col_offset=12, end_lineno=125, end_col_offset=32), lineno=125, col_offset=12, end_lineno=125, end_col_offset=32)], lineno=120, col_offset=8, end_lineno=125, end_col_offset=32)], returns=Constant(value=None, lineno=118, col_offset=47, end_lineno=118, end_col_offset=51), lineno=118, col_offset=4, end_lineno=125, end_col_offset=32), FunctionDef(name='delete', args=arguments(args=[arg(arg='self', lineno=127, col_offset=15, end_lineno=127, end_col_offset=19), arg(arg='key', annotation=Name(id='KeyT', ctx=Load(), lineno=127, col_offset=26, end_lineno=127, end_col_offset=30), lineno=127, col_offset=21, end_lineno=127, end_col_offset=30)]), body=[Expr(value=Constant(value='Remove ``key`` from the cache if present.', lineno=128, col_offset=8, end_lineno=128, end_col_offset=55), lineno=128, col_offset=8, end_lineno=128, end_col_offset=55), With(items=[withitem(context_expr=Attribute(value=Name(id='self', ctx=Load(), lineno=129, col_offset=13, end_lineno=129, end_col_offset=17), attr='_lock', ctx=Load(), lineno=129, col_offset=13, end_lineno=129, end_col_offset=23))], body=[Expr(value=Call(func=Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=130, col_offset=12, end_lineno=130, end_col_offset=16), attr='_store', ctx=Load(), lineno=130, col_offset=12, end_lineno=130, end_col_offset=23), attr='pop', ctx=Load(), lineno=130, col_offset=12, end_lineno=130, end_col_offset=27), args=[Name(id='key', ctx=Load(), lineno=130, col_offset=28, end_lineno=130, end_col_offset=31), Constant(value=None, lineno=130, col_offset=33, end_lineno=130, end_col_offset=37)], lineno=130, col_offset=12, end_lineno=130, end_col_offset=38), lineno=130, col_offset=12, end_lineno=130, end_col_offset=38)], lineno=129, col_offset=8, end_lineno=130, end_col_offset=38)], returns=Constant(value=None, lineno=127, col_offset=35, end_lineno=127, end_col_offset=39), lineno=127, col_offset=4, end_lineno=130, end_col_offset=38), FunctionDef(name='clear', args=arguments(args=[arg(arg='self', lineno=132, col_offset=14, end_lineno=132, end_col_offset=18)]), body=[Expr(value=Constant(value='Remove all entries from the cache.', lineno=133, col_offset=8, end_lineno=133, end_col_offset=48), lineno=133, col_offset=8, end_lineno=133, end_col_offset=48), With(items=[withitem(context_expr=Attribute(value=Name(id='self', ctx=Load(), lineno=134, col_offset=13, end_lineno=134, end_col_offset=17), attr='_lock', ctx=Load(), lineno=134, col_offset=13, end_lineno=134, end_col_offset=23))], body=[Expr(value=Call(func=Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=135, col_offset=12, end_lineno=135, end_col_offset=16), attr='_store', ctx=Load(), lineno=135, col_offset=12, end_lineno=135, end_col_offset=23), attr='clear', ctx=Load(), lineno=135, col_offset=12, end_lineno=135, end_col_offset=29), lineno=135, col_offset=12, end_lineno=135, end_col_offset=31), lineno=135, col_offset=12, end_lineno=135, end_col_offset=31)], lineno=134, col_offset=8, end_lineno=135, end_col_offset=31)], returns=Constant(value=None, lineno=132, col_offset=23, end_lineno=132, end_col_offset=27), lineno=132, col_offset=4, end_lineno=135, end_col_offset=31), FunctionDef(name='__contains__', args=arguments(args=[arg(arg='self', lineno=137, col_offset=21, end_lineno=137, end_col_offset=25), arg(arg='key', annotation=Name(id='object', ctx=Load(), lineno=137, col_offset=32, end_lineno=137, end_col_offset=38), lineno=137, col_offset=27, end_lineno=137, end_col_offset=38)]), body=[Expr(value=Constant(value='\n        Return ``True`` when ``key`` is present and not expired.\n\n        Parameters\n        ----------\n        key : object\n            Candidate cache key.\n\n        Returns\n        -------\n        bool\n            ``True`` if the key exists and has not expired; otherwise ``False``.\n        ', lineno=138, col_offset=8, end_lineno=150, end_col_offset=11), lineno=138, col_offset=8, end_lineno=150, end_col_offset=11), With(items=[withitem(context_expr=Attribute(value=Name(id='self', ctx=Load(), lineno=151, col_offset=13, end_lineno=151, end_col_offset=17), attr='_lock', ctx=Load(), lineno=151, col_offset=13, end_lineno=151, end_col_offset=23))], body=[If(test=BoolOp(op=Or(), values=[UnaryOp(op=Not(), operand=Call(func=Name(id='isinstance', ctx=Load(), lineno=152, col_offset=19, end_lineno=152, end_col_offset=29), args=[Name(id='key', ctx=Load(), lineno=152, col_offset=30, end_lineno=152, end_col_offset=33), Name(id='Hashable', ctx=Load(), lineno=152, col_offset=35, end_lineno=152, end_col_offset=43)], lineno=152, col_offset=19, end_lineno=152, end_col_offset=44), lineno=152, col_offset=15, end_lineno=152, end_col_offset=44), Compare(left=Name(id='key', ctx=Load(), lineno=152, col_offset=48, end_lineno=152, end_col_offset=51), ops=[NotIn()], comparators=[Attribute(value=Name(id='self', ctx=Load(), lineno=152, col_offset=59, end_lineno=152, end_col_offset=63), attr='_store', ctx=Load(), lineno=152, col_offset=59, end_lineno=152, end_col_offset=70)], lineno=152, col_offset=48, end_lineno=152, end_col_offset=70)], lineno=152, col_offset=15, end_lineno=152, end_col_offset=70), body=[Return(value=Constant(value=False, lineno=153, col_offset=23, end_lineno=153, end_col_offset=28), lineno=153, col_offset=16, end_lineno=153, end_col_offset=28)], lineno=152, col_offset=12, end_lineno=153, end_col_offset=28), Assign(targets=[Name(id='typed_key', ctx=Store(), lineno=155, col_offset=12, end_lineno=155, end_col_offset=21)], value=Call(func=Name(id='cast', ctx=Load(), lineno=155, col_offset=24, end_lineno=155, end_col_offset=28), args=[Constant(value='KeyT', lineno=155, col_offset=29, end_lineno=155, end_col_offset=35), Name(id='key', ctx=Load(), lineno=155, col_offset=37, end_lineno=155, end_col_offset=40)], lineno=155, col_offset=24, end_lineno=155, end_col_offset=41), lineno=155, col_offset=12, end_lineno=155, end_col_offset=41), Assign(targets=[Name(id='record', ctx=Store(), lineno=156, col_offset=12, end_lineno=156, end_col_offset=18)], value=Call(func=Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=156, col_offset=21, end_lineno=156, end_col_offset=25), attr='_store', ctx=Load(), lineno=156, col_offset=21, end_lineno=156, end_col_offset=32), attr='get', ctx=Load(), lineno=156, col_offset=21, end_lineno=156, end_col_offset=36), args=[Name(id='typed_key', ctx=Load(), lineno=156, col_offset=37, end_lineno=156, end_col_offset=46)], lineno=156, col_offset=21, end_lineno=156, end_col_offset=47), lineno=156, col_offset=12, end_lineno=156, end_col_offset=47), If(test=Compare(left=Name(id='record', ctx=Load(), lineno=157, col_offset=15, end_lineno=157, end_col_offset=21), ops=[Is()], comparators=[Constant(value=None, lineno=157, col_offset=25, end_lineno=157, end_col_offset=29)], lineno=157, col_offset=15, end_lineno=157, end_col_offset=29), body=[Return(value=Constant(value=False, lineno=158, col_offset=23, end_lineno=158, end_col_offset=28), lineno=158, col_offset=16, end_lineno=158, end_col_offset=28)], lineno=157, col_offset=12, end_lineno=158, end_col_offset=28), If(test=Call(func=Attribute(value=Name(id='self', ctx=Load(), lineno=160, col_offset=15, end_lineno=160, end_col_offset=19), attr='_is_expired', ctx=Load(), lineno=160, col_offset=15, end_lineno=160, end_col_offset=31), args=[Name(id='record', ctx=Load(), lineno=160, col_offset=32, end_lineno=160, end_col_offset=38)], lineno=160, col_offset=15, end_lineno=160, end_col_offset=39), body=[Expr(value=Call(func=Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=161, col_offset=16, end_lineno=161, end_col_offset=20), attr='_store', ctx=Load(), lineno=161, col_offset=16, end_lineno=161, end_col_offset=27), attr='pop', ctx=Load(), lineno=161, col_offset=16, end_lineno=161, end_col_offset=31), args=[Name(id='typed_key', ctx=Load(), lineno=161, col_offset=32, end_lineno=161, end_col_offset=41), Constant(value=None, lineno=161, col_offset=43, end_lineno=161, end_col_offset=47)], lineno=161, col_offset=16, end_lineno=161, end_col_offset=48), lineno=161, col_offset=16, end_lineno=161, end_col_offset=48), Return(value=Constant(value=False, lineno=162, col_offset=23, end_lineno=162, end_col_offset=28), lineno=162, col_offset=16, end_lineno=162, end_col_offset=28)], lineno=160, col_offset=12, end_lineno=162, end_col_offset=28), Return(value=Constant(value=True, lineno=164, col_offset=19, end_lineno=164, end_col_offset=23), lineno=164, col_offset=12, end_lineno=164, end_col_offset=23)], lineno=151, col_offset=8, end_lineno=164, end_col_offset=23)], returns=Name(id='bool', ctx=Load(), lineno=137, col_offset=43, end_lineno=137, end_col_offset=47), lineno=137, col_offset=4, end_lineno=164, end_col_offset=23), FunctionDef(name='__len__', args=arguments(args=[arg(arg='self', lineno=166, col_offset=16, end_lineno=166, end_col_offset=20)]), body=[Expr(value=Constant(value='\n        Return the number of live entries in the cache.\n\n        Returns\n        -------\n        int\n            Count of entries that have not expired.\n        ', lineno=167, col_offset=8, end_lineno=174, end_col_offset=11), lineno=167, col_offset=8, end_lineno=174, end_col_offset=11), With(items=[withitem(context_expr=Attribute(value=Name(id='self', ctx=Load(), lineno=175, col_offset=13, end_lineno=175, end_col_offset=17), attr='_lock', ctx=Load(), lineno=175, col_offset=13, end_lineno=175, end_col_offset=23))], body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load(), lineno=176, col_offset=12, end_lineno=176, end_col_offset=16), attr='_purge_expired_entries', ctx=Load(), lineno=176, col_offset=12, end_lineno=176, end_col_offset=39), lineno=176, col_offset=12, end_lineno=176, end_col_offset=41), lineno=176, col_offset=12, end_lineno=176, end_col_offset=41), Return(value=Call(func=Name(id='len', ctx=Load(), lineno=177, col_offset=19, end_lineno=177, end_col_offset=22), args=[Attribute(value=Name(id='self', ctx=Load(), lineno=177, col_offset=23, end_lineno=177, end_col_offset=27), attr='_store', ctx=Load(), lineno=177, col_offset=23, end_lineno=177, end_col_offset=34)], lineno=177, col_offset=19, end_lineno=177, end_col_offset=35), lineno=177, col_offset=12, end_lineno=177, end_col_offset=35)], lineno=175, col_offset=8, end_lineno=177, end_col_offset=35)], returns=Name(id='int', ctx=Load(), lineno=166, col_offset=25, end_lineno=166, end_col_offset=28), lineno=166, col_offset=4, end_lineno=177, end_col_offset=35), FunctionDef(name='items', args=arguments(args=[arg(arg='self', lineno=179, col_offset=14, end_lineno=179, end_col_offset=18)]), body=[Expr(value=Constant(value='\n        Yield current cache entries, purging expired ones as needed.\n\n        Yields\n        ------\n        tuple[KeyT, ValueT]\n            Key-value pairs for each live cache entry in LRU order.\n        ', lineno=180, col_offset=8, end_lineno=187, end_col_offset=11), lineno=180, col_offset=8, end_lineno=187, end_col_offset=11), With(items=[withitem(context_expr=Attribute(value=Name(id='self', ctx=Load(), lineno=188, col_offset=13, end_lineno=188, end_col_offset=17), attr='_lock', ctx=Load(), lineno=188, col_offset=13, end_lineno=188, end_col_offset=23))], body=[For(target=Name(id='key', ctx=Store(), lineno=189, col_offset=16, end_lineno=189, end_col_offset=19), iter=Call(func=Name(id='list', ctx=Load(), lineno=189, col_offset=23, end_lineno=189, end_col_offset=27), args=[Call(func=Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=189, col_offset=28, end_lineno=189, end_col_offset=32), attr='_store', ctx=Load(), lineno=189, col_offset=28, end_lineno=189, end_col_offset=39), attr='keys', ctx=Load(), lineno=189, col_offset=28, end_lineno=189, end_col_offset=44), lineno=189, col_offset=28, end_lineno=189, end_col_offset=46)], lineno=189, col_offset=23, end_lineno=189, end_col_offset=47), body=[Assign(targets=[Name(id='record', ctx=Store(), lineno=190, col_offset=16, end_lineno=190, end_col_offset=22)], value=Call(func=Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=190, col_offset=25, end_lineno=190, end_col_offset=29), attr='_store', ctx=Load(), lineno=190, col_offset=25, end_lineno=190, end_col_offset=36), attr='get', ctx=Load(), lineno=190, col_offset=25, end_lineno=190, end_col_offset=40), args=[Name(id='key', ctx=Load(), lineno=190, col_offset=41, end_lineno=190, end_col_offset=44)], lineno=190, col_offset=25, end_lineno=190, end_col_offset=45), lineno=190, col_offset=16, end_lineno=190, end_col_offset=45), If(test=BoolOp(op=Or(), values=[Compare(left=Name(id='record', ctx=Load(), lineno=191, col_offset=19, end_lineno=191, end_col_offset=25), ops=[Is()], comparators=[Constant(value=None, lineno=191, col_offset=29, end_lineno=191, end_col_offset=33)], lineno=191, col_offset=19, end_lineno=191, end_col_offset=33), Call(func=Attribute(value=Name(id='self', ctx=Load(), lineno=191, col_offset=37, end_lineno=191, end_col_offset=41), attr='_is_expired', ctx=Load(), lineno=191, col_offset=37, end_lineno=191, end_col_offset=53), args=[Name(id='record', ctx=Load(), lineno=191, col_offset=54, end_lineno=191, end_col_offset=60)], lineno=191, col_offset=37, end_lineno=191, end_col_offset=61)], lineno=191, col_offset=19, end_lineno=191, end_col_offset=61), body=[Expr(value=Call(func=Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=192, col_offset=20, end_lineno=192, end_col_offset=24), attr='_store', ctx=Load(), lineno=192, col_offset=20, end_lineno=192, end_col_offset=31), attr='pop', ctx=Load(), lineno=192, col_offset=20, end_lineno=192, end_col_offset=35), args=[Name(id='key', ctx=Load(), lineno=192, col_offset=36, end_lineno=192, end_col_offset=39), Constant(value=None, lineno=192, col_offset=41, end_lineno=192, end_col_offset=45)], lineno=192, col_offset=20, end_lineno=192, end_col_offset=46), lineno=192, col_offset=20, end_lineno=192, end_col_offset=46), Continue(lineno=193, col_offset=20, end_lineno=193, end_col_offset=28)], lineno=191, col_offset=16, end_lineno=193, end_col_offset=28), Expr(value=Yield(value=Tuple(elts=[Name(id='key', ctx=Load(), lineno=194, col_offset=22, end_lineno=194, end_col_offset=25), Attribute(value=Name(id='record', ctx=Load(), lineno=194, col_offset=27, end_lineno=194, end_col_offset=33), attr='value', ctx=Load(), lineno=194, col_offset=27, end_lineno=194, end_col_offset=39)], ctx=Load(), lineno=194, col_offset=22, end_lineno=194, end_col_offset=39), lineno=194, col_offset=16, end_lineno=194, end_col_offset=39), lineno=194, col_offset=16, end_lineno=194, end_col_offset=39)], lineno=189, col_offset=12, end_lineno=194, end_col_offset=39)], lineno=188, col_offset=8, end_lineno=194, end_col_offset=39)], returns=Subscript(value=Name(id='Iterator', ctx=Load(), lineno=179, col_offset=23, end_lineno=179, end_col_offset=31), slice=Subscript(value=Name(id='tuple', ctx=Load(), lineno=179, col_offset=32, end_lineno=179, end_col_offset=37), slice=Tuple(elts=[Name(id='KeyT', ctx=Load(), lineno=179, col_offset=38, end_lineno=179, end_col_offset=42), Name(id='ValueT', ctx=Load(), lineno=179, col_offset=44, end_lineno=179, end_col_offset=50)], ctx=Load(), lineno=179, col_offset=38, end_lineno=179, end_col_offset=50), ctx=Load(), lineno=179, col_offset=32, end_lineno=179, end_col_offset=51), ctx=Load(), lineno=179, col_offset=23, end_lineno=179, end_col_offset=52), lineno=179, col_offset=4, end_lineno=194, end_col_offset=39), FunctionDef(name='snapshot', args=arguments(args=[arg(arg='self', lineno=196, col_offset=17, end_lineno=196, end_col_offset=21)]), body=[Expr(value=Constant(value='\n        Return a shallow copy of the cache contents.\n\n        Returns\n        -------\n        MutableMapping[KeyT, ValueT]\n            Ordered mapping containing live cache entries.\n        ', lineno=197, col_offset=8, end_lineno=204, end_col_offset=11), lineno=197, col_offset=8, end_lineno=204, end_col_offset=11), With(items=[withitem(context_expr=Attribute(value=Name(id='self', ctx=Load(), lineno=205, col_offset=13, end_lineno=205, end_col_offset=17), attr='_lock', ctx=Load(), lineno=205, col_offset=13, end_lineno=205, end_col_offset=23))], body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load(), lineno=206, col_offset=12, end_lineno=206, end_col_offset=16), attr='_purge_expired_entries', ctx=Load(), lineno=206, col_offset=12, end_lineno=206, end_col_offset=39), lineno=206, col_offset=12, end_lineno=206, end_col_offset=41), lineno=206, col_offset=12, end_lineno=206, end_col_offset=41), Return(value=Call(func=Name(id='OrderedDict', ctx=Load(), lineno=207, col_offset=19, end_lineno=207, end_col_offset=30), args=[GeneratorExp(elt=Tuple(elts=[Name(id='key', ctx=Load(), lineno=207, col_offset=32, end_lineno=207, end_col_offset=35), Attribute(value=Name(id='record', ctx=Load(), lineno=207, col_offset=37, end_lineno=207, end_col_offset=43), attr='value', ctx=Load(), lineno=207, col_offset=37, end_lineno=207, end_col_offset=49)], ctx=Load(), lineno=207, col_offset=31, end_lineno=207, end_col_offset=50), generators=[comprehension(target=Tuple(elts=[Name(id='key', ctx=Store(), lineno=207, col_offset=55, end_lineno=207, end_col_offset=58), Name(id='record', ctx=Store(), lineno=207, col_offset=60, end_lineno=207, end_col_offset=66)], ctx=Store(), lineno=207, col_offset=55, end_lineno=207, end_col_offset=66), iter=Call(func=Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=207, col_offset=70, end_lineno=207, end_col_offset=74), attr='_store', ctx=Load(), lineno=207, col_offset=70, end_lineno=207, end_col_offset=81), attr='items', ctx=Load(), lineno=207, col_offset=70, end_lineno=207, end_col_offset=87), lineno=207, col_offset=70, end_lineno=207, end_col_offset=89), is_async=0)], lineno=207, col_offset=30, end_lineno=207, end_col_offset=90)], lineno=207, col_offset=19, end_lineno=207, end_col_offset=90), lineno=207, col_offset=12, end_lineno=207, end_col_offset=90)], lineno=205, col_offset=8, end_lineno=207, end_col_offset=90)], returns=Subscript(value=Name(id='MutableMapping', ctx=Load(), lineno=196, col_offset=26, end_lineno=196, end_col_offset=40), slice=Tuple(elts=[Name(id='KeyT', ctx=Load(), lineno=196, col_offset=41, end_lineno=196, end_col_offset=45), Name(id='ValueT', ctx=Load(), lineno=196, col_offset=47, end_lineno=196, end_col_offset=53)], ctx=Load(), lineno=196, col_offset=41, end_lineno=196, end_col_offset=53), ctx=Load(), lineno=196, col_offset=26, end_lineno=196, end_col_offset=54), lineno=196, col_offset=4, end_lineno=207, end_col_offset=90), FunctionDef(name='_enforce_size', args=arguments(args=[arg(arg='self', lineno=209, col_offset=22, end_lineno=209, end_col_offset=26)]), body=[While(test=Compare(left=Call(func=Name(id='len', ctx=Load(), lineno=210, col_offset=14, end_lineno=210, end_col_offset=17), args=[Attribute(value=Name(id='self', ctx=Load(), lineno=210, col_offset=18, end_lineno=210, end_col_offset=22), attr='_store', ctx=Load(), lineno=210, col_offset=18, end_lineno=210, end_col_offset=29)], lineno=210, col_offset=14, end_lineno=210, end_col_offset=30), ops=[Gt()], comparators=[Attribute(value=Name(id='self', ctx=Load(), lineno=210, col_offset=33, end_lineno=210, end_col_offset=37), attr='_maxsize', ctx=Load(), lineno=210, col_offset=33, end_lineno=210, end_col_offset=46)], lineno=210, col_offset=14, end_lineno=210, end_col_offset=46), body=[Expr(value=Call(func=Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=211, col_offset=12, end_lineno=211, end_col_offset=16), attr='_store', ctx=Load(), lineno=211, col_offset=12, end_lineno=211, end_col_offset=23), attr='popitem', ctx=Load(), lineno=211, col_offset=12, end_lineno=211, end_col_offset=31), keywords=[keyword(arg='last', value=Constant(value=False, lineno=211, col_offset=37, end_lineno=211, end_col_offset=42), lineno=211, col_offset=32, end_lineno=211, end_col_offset=42)], lineno=211, col_offset=12, end_lineno=211, end_col_offset=43), lineno=211, col_offset=12, end_lineno=211, end_col_offset=43)], lineno=210, col_offset=8, end_lineno=211, end_col_offset=43)], returns=Constant(value=None, lineno=209, col_offset=31, end_lineno=209, end_col_offset=35), lineno=209, col_offset=4, end_lineno=211, end_col_offset=43), FunctionDef(name='_purge_expired_entries', args=arguments(args=[arg(arg='self', lineno=213, col_offset=31, end_lineno=213, end_col_offset=35)]), body=[If(test=Compare(left=Attribute(value=Name(id='self', ctx=Load(), lineno=214, col_offset=11, end_lineno=214, end_col_offset=15), attr='_ttl_seconds', ctx=Load(), lineno=214, col_offset=11, end_lineno=214, end_col_offset=28), ops=[Is()], comparators=[Constant(value=None, lineno=214, col_offset=32, end_lineno=214, end_col_offset=36)], lineno=214, col_offset=11, end_lineno=214, end_col_offset=36), body=[Return(lineno=215, col_offset=12, end_lineno=215, end_col_offset=18)], lineno=214, col_offset=8, end_lineno=215, end_col_offset=18), Assign(targets=[Name(id='now', ctx=Store(), lineno=217, col_offset=8, end_lineno=217, end_col_offset=11)], value=Call(func=Attribute(value=Name(id='self', ctx=Load(), lineno=217, col_offset=14, end_lineno=217, end_col_offset=18), attr='_now', ctx=Load(), lineno=217, col_offset=14, end_lineno=217, end_col_offset=23), lineno=217, col_offset=14, end_lineno=217, end_col_offset=25), lineno=217, col_offset=8, end_lineno=217, end_col_offset=25), Assign(targets=[Name(id='expired_keys', ctx=Store(), lineno=218, col_offset=8, end_lineno=218, end_col_offset=20)], value=ListComp(elt=Name(id='key', ctx=Load(), lineno=219, col_offset=12, end_lineno=219, end_col_offset=15), generators=[comprehension(target=Tuple(elts=[Name(id='key', ctx=Store(), lineno=219, col_offset=20, end_lineno=219, end_col_offset=23), Name(id='record', ctx=Store(), lineno=219, col_offset=25, end_lineno=219, end_col_offset=31)], ctx=Store(), lineno=219, col_offset=20, end_lineno=219, end_col_offset=31), iter=Call(func=Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=219, col_offset=35, end_lineno=219, end_col_offset=39), attr='_store', ctx=Load(), lineno=219, col_offset=35, end_lineno=219, end_col_offset=46), attr='items', ctx=Load(), lineno=219, col_offset=35, end_lineno=219, end_col_offset=52), lineno=219, col_offset=35, end_lineno=219, end_col_offset=54), ifs=[Call(func=Attribute(value=Name(id='self', ctx=Load(), lineno=219, col_offset=58, end_lineno=219, end_col_offset=62), attr='_has_expired', ctx=Load(), lineno=219, col_offset=58, end_lineno=219, end_col_offset=75), args=[Attribute(value=Name(id='record', ctx=Load(), lineno=219, col_offset=76, end_lineno=219, end_col_offset=82), attr='inserted_at', ctx=Load(), lineno=219, col_offset=76, end_lineno=219, end_col_offset=94), Name(id='now', ctx=Load(), lineno=219, col_offset=96, end_lineno=219, end_col_offset=99)], lineno=219, col_offset=58, end_lineno=219, end_col_offset=100)], is_async=0)], lineno=218, col_offset=23, end_lineno=220, end_col_offset=9), lineno=218, col_offset=8, end_lineno=220, end_col_offset=9), For(target=Name(id='key', ctx=Store(), lineno=221, col_offset=12, end_lineno=221, end_col_offset=15), iter=Name(id='expired_keys', ctx=Load(), lineno=221, col_offset=19, end_lineno=221, end_col_offset=31), body=[Expr(value=Call(func=Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=222, col_offset=12, end_lineno=222, end_col_offset=16), attr='_store', ctx=Load(), lineno=222, col_offset=12, end_lineno=222, end_col_offset=23), attr='pop', ctx=Load(), lineno=222, col_offset=12, end_lineno=222, end_col_offset=27), args=[Name(id='key', ctx=Load(), lineno=222, col_offset=28, end_lineno=222, end_col_offset=31), Constant(value=None, lineno=222, col_offset=33, end_lineno=222, end_col_offset=37)], lineno=222, col_offset=12, end_lineno=222, end_col_offset=38), lineno=222, col_offset=12, end_lineno=222, end_col_offset=38)], lineno=221, col_offset=8, end_lineno=222, end_col_offset=38)], returns=Constant(value=None, lineno=213, col_offset=40, end_lineno=213, end_col_offset=44), lineno=213, col_offset=4, end_lineno=222, end_col_offset=38), FunctionDef(name='_is_expired', args=arguments(args=[arg(arg='self', lineno=224, col_offset=20, end_lineno=224, end_col_offset=24), arg(arg='record', annotation=Subscript(value=Name(id='_CacheRecord', ctx=Load(), lineno=224, col_offset=34, end_lineno=224, end_col_offset=46), slice=Name(id='ValueT', ctx=Load(), lineno=224, col_offset=47, end_lineno=224, end_col_offset=53), ctx=Load(), lineno=224, col_offset=34, end_lineno=224, end_col_offset=54), lineno=224, col_offset=26, end_lineno=224, end_col_offset=54)]), body=[If(test=Compare(left=Attribute(value=Name(id='self', ctx=Load(), lineno=225, col_offset=11, end_lineno=225, end_col_offset=15), attr='_ttl_seconds', ctx=Load(), lineno=225, col_offset=11, end_lineno=225, end_col_offset=28), ops=[Is()], comparators=[Constant(value=None, lineno=225, col_offset=32, end_lineno=225, end_col_offset=36)], lineno=225, col_offset=11, end_lineno=225, end_col_offset=36), body=[Return(value=Constant(value=False, lineno=226, col_offset=19, end_lineno=226, end_col_offset=24), lineno=226, col_offset=12, end_lineno=226, end_col_offset=24)], lineno=225, col_offset=8, end_lineno=226, end_col_offset=24), Return(value=Call(func=Attribute(value=Name(id='self', ctx=Load(), lineno=227, col_offset=15, end_lineno=227, end_col_offset=19), attr='_has_expired', ctx=Load(), lineno=227, col_offset=15, end_lineno=227, end_col_offset=32), args=[Attribute(value=Name(id='record', ctx=Load(), lineno=227, col_offset=33, end_lineno=227, end_col_offset=39), attr='inserted_at', ctx=Load(), lineno=227, col_offset=33, end_lineno=227, end_col_offset=51), Call(func=Attribute(value=Name(id='self', ctx=Load(), lineno=227, col_offset=53, end_lineno=227, end_col_offset=57), attr='_now', ctx=Load(), lineno=227, col_offset=53, end_lineno=227, end_col_offset=62), lineno=227, col_offset=53, end_lineno=227, end_col_offset=64)], lineno=227, col_offset=15, end_lineno=227, end_col_offset=65), lineno=227, col_offset=8, end_lineno=227, end_col_offset=65)], returns=Name(id='bool', ctx=Load(), lineno=224, col_offset=59, end_lineno=224, end_col_offset=63), lineno=224, col_offset=4, end_lineno=227, end_col_offset=65), FunctionDef(name='_has_expired', args=arguments(args=[arg(arg='self', lineno=229, col_offset=21, end_lineno=229, end_col_offset=25), arg(arg='inserted_at', annotation=Name(id='float', ctx=Load(), lineno=229, col_offset=40, end_lineno=229, end_col_offset=45), lineno=229, col_offset=27, end_lineno=229, end_col_offset=45), arg(arg='now', annotation=Name(id='float', ctx=Load(), lineno=229, col_offset=52, end_lineno=229, end_col_offset=57), lineno=229, col_offset=47, end_lineno=229, end_col_offset=57)]), body=[If(test=Compare(left=Attribute(value=Name(id='self', ctx=Load(), lineno=230, col_offset=11, end_lineno=230, end_col_offset=15), attr='_ttl_seconds', ctx=Load(), lineno=230, col_offset=11, end_lineno=230, end_col_offset=28), ops=[Is()], comparators=[Constant(value=None, lineno=230, col_offset=32, end_lineno=230, end_col_offset=36)], lineno=230, col_offset=11, end_lineno=230, end_col_offset=36), body=[Return(value=Constant(value=False, lineno=231, col_offset=19, end_lineno=231, end_col_offset=24), lineno=231, col_offset=12, end_lineno=231, end_col_offset=24)], lineno=230, col_offset=8, end_lineno=231, end_col_offset=24), Return(value=Compare(left=BinOp(left=Name(id='now', ctx=Load(), lineno=232, col_offset=15, end_lineno=232, end_col_offset=18), op=Sub(), right=Name(id='inserted_at', ctx=Load(), lineno=232, col_offset=21, end_lineno=232, end_col_offset=32), lineno=232, col_offset=15, end_lineno=232, end_col_offset=32), ops=[GtE()], comparators=[Attribute(value=Name(id='self', ctx=Load(), lineno=232, col_offset=36, end_lineno=232, end_col_offset=40), attr='_ttl_seconds', ctx=Load(), lineno=232, col_offset=36, end_lineno=232, end_col_offset=53)], lineno=232, col_offset=15, end_lineno=232, end_col_offset=53), lineno=232, col_offset=8, end_lineno=232, end_col_offset=53)], returns=Name(id='bool', ctx=Load(), lineno=229, col_offset=62, end_lineno=229, end_col_offset=66), lineno=229, col_offset=4, end_lineno=232, end_col_offset=53)], type_params=[TypeVar(name='KeyT', bound=Name(id='Hashable', ctx=Load(), lineno=50, col_offset=21, end_lineno=50, end_col_offset=29), lineno=50, col_offset=15, end_lineno=50, end_col_offset=29), TypeVar(name='ValueT', lineno=50, col_offset=31, end_lineno=50, end_col_offset=37)], lineno=50, col_offset=0, end_lineno=232, end_col_offset=53), ClassDef(name='AsyncSingleFlight', body=[Expr(value=Constant(value='Deduplicate concurrent coroutine execution keyed by ``KeyT``.', lineno=236, col_offset=4, end_lineno=236, end_col_offset=71), lineno=236, col_offset=4, end_lineno=236, end_col_offset=71), FunctionDef(name='__init__', args=arguments(args=[arg(arg='self', lineno=238, col_offset=17, end_lineno=238, end_col_offset=21)]), body=[Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=239, col_offset=8, end_lineno=239, end_col_offset=12), attr='_lock', ctx=Store(), lineno=239, col_offset=8, end_lineno=239, end_col_offset=18)], value=Call(func=Attribute(value=Name(id='asyncio', ctx=Load(), lineno=239, col_offset=21, end_lineno=239, end_col_offset=28), attr='Lock', ctx=Load(), lineno=239, col_offset=21, end_lineno=239, end_col_offset=33), lineno=239, col_offset=21, end_lineno=239, end_col_offset=35), lineno=239, col_offset=8, end_lineno=239, end_col_offset=35), AnnAssign(target=Attribute(value=Name(id='self', ctx=Load(), lineno=240, col_offset=8, end_lineno=240, end_col_offset=12), attr='_inflight', ctx=Store(), lineno=240, col_offset=8, end_lineno=240, end_col_offset=22), annotation=Subscript(value=Name(id='dict', ctx=Load(), lineno=240, col_offset=24, end_lineno=240, end_col_offset=28), slice=Tuple(elts=[Name(id='KeyT', ctx=Load(), lineno=240, col_offset=29, end_lineno=240, end_col_offset=33), Subscript(value=Attribute(value=Name(id='asyncio', ctx=Load(), lineno=240, col_offset=35, end_lineno=240, end_col_offset=42), attr='Future', ctx=Load(), lineno=240, col_offset=35, end_lineno=240, end_col_offset=49), slice=Name(id='ValueT', ctx=Load(), lineno=240, col_offset=50, end_lineno=240, end_col_offset=56), ctx=Load(), lineno=240, col_offset=35, end_lineno=240, end_col_offset=57)], ctx=Load(), lineno=240, col_offset=29, end_lineno=240, end_col_offset=57), ctx=Load(), lineno=240, col_offset=24, end_lineno=240, end_col_offset=58), value=Dict(lineno=240, col_offset=61, end_lineno=240, end_col_offset=63), simple=0, lineno=240, col_offset=8, end_lineno=240, end_col_offset=63)], returns=Constant(value=None, lineno=238, col_offset=26, end_lineno=238, end_col_offset=30), lineno=238, col_offset=4, end_lineno=240, end_col_offset=63), AsyncFunctionDef(name='do', args=arguments(args=[arg(arg='self', lineno=242, col_offset=17, end_lineno=242, end_col_offset=21), arg(arg='key', annotation=Name(id='KeyT', ctx=Load(), lineno=242, col_offset=28, end_lineno=242, end_col_offset=32), lineno=242, col_offset=23, end_lineno=242, end_col_offset=32), arg(arg='fn', annotation=Subscript(value=Name(id='Callable', ctx=Load(), lineno=242, col_offset=38, end_lineno=242, end_col_offset=46), slice=Tuple(elts=[List(ctx=Load(), lineno=242, col_offset=47, end_lineno=242, end_col_offset=49), Subscript(value=Name(id='Awaitable', ctx=Load(), lineno=242, col_offset=51, end_lineno=242, end_col_offset=60), slice=Name(id='ValueT', ctx=Load(), lineno=242, col_offset=61, end_lineno=242, end_col_offset=67), ctx=Load(), lineno=242, col_offset=51, end_lineno=242, end_col_offset=68)], ctx=Load(), lineno=242, col_offset=47, end_lineno=242, end_col_offset=68), ctx=Load(), lineno=242, col_offset=38, end_lineno=242, end_col_offset=69), lineno=242, col_offset=34, end_lineno=242, end_col_offset=69)]), body=[Expr(value=Constant(value='\n        Execute ``fn`` once for all concurrent callers associated with ``key``.\n\n        Parameters\n        ----------\n        key : KeyT\n            Deduplication key.\n        fn : Callable[[], Awaitable[ValueT]]\n            Awaitable factory executed at most once while in-flight for ``key``.\n\n        Returns\n        -------\n        ValueT\n            Result produced by ``fn``.\n        ', lineno=243, col_offset=8, end_lineno=257, end_col_offset=11), lineno=243, col_offset=8, end_lineno=257, end_col_offset=11), AsyncWith(items=[withitem(context_expr=Attribute(value=Name(id='self', ctx=Load(), lineno=258, col_offset=19, end_lineno=258, end_col_offset=23), attr='_lock', ctx=Load(), lineno=258, col_offset=19, end_lineno=258, end_col_offset=29))], body=[Assign(targets=[Name(id='inflight', ctx=Store(), lineno=259, col_offset=12, end_lineno=259, end_col_offset=20)], value=Call(func=Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=259, col_offset=23, end_lineno=259, end_col_offset=27), attr='_inflight', ctx=Load(), lineno=259, col_offset=23, end_lineno=259, end_col_offset=37), attr='get', ctx=Load(), lineno=259, col_offset=23, end_lineno=259, end_col_offset=41), args=[Name(id='key', ctx=Load(), lineno=259, col_offset=42, end_lineno=259, end_col_offset=45)], lineno=259, col_offset=23, end_lineno=259, end_col_offset=46), lineno=259, col_offset=12, end_lineno=259, end_col_offset=46), If(test=Compare(left=Name(id='inflight', ctx=Load(), lineno=260, col_offset=15, end_lineno=260, end_col_offset=23), ops=[Is()], comparators=[Constant(value=None, lineno=260, col_offset=27, end_lineno=260, end_col_offset=31)], lineno=260, col_offset=15, end_lineno=260, end_col_offset=31), body=[Assign(targets=[Name(id='inflight', ctx=Store(), lineno=261, col_offset=16, end_lineno=261, end_col_offset=24)], value=Call(func=Attribute(value=Name(id='asyncio', ctx=Load(), lineno=261, col_offset=27, end_lineno=261, end_col_offset=34), attr='create_task', ctx=Load(), lineno=261, col_offset=27, end_lineno=261, end_col_offset=46), args=[Call(func=Attribute(value=Name(id='self', ctx=Load(), lineno=261, col_offset=47, end_lineno=261, end_col_offset=51), attr='_execute', ctx=Load(), lineno=261, col_offset=47, end_lineno=261, end_col_offset=60), args=[Name(id='key', ctx=Load(), lineno=261, col_offset=61, end_lineno=261, end_col_offset=64), Name(id='fn', ctx=Load(), lineno=261, col_offset=66, end_lineno=261, end_col_offset=68)], lineno=261, col_offset=47, end_lineno=261, end_col_offset=69)], lineno=261, col_offset=27, end_lineno=261, end_col_offset=70), lineno=261, col_offset=16, end_lineno=261, end_col_offset=70), Assign(targets=[Subscript(value=Attribute(value=Name(id='self', ctx=Load(), lineno=262, col_offset=16, end_lineno=262, end_col_offset=20), attr='_inflight', ctx=Load(), lineno=262, col_offset=16, end_lineno=262, end_col_offset=30), slice=Name(id='key', ctx=Load(), lineno=262, col_offset=31, end_lineno=262, end_col_offset=34), ctx=Store(), lineno=262, col_offset=16, end_lineno=262, end_col_offset=35)], value=Name(id='inflight', ctx=Load(), lineno=262, col_offset=38, end_lineno=262, end_col_offset=46), lineno=262, col_offset=16, end_lineno=262, end_col_offset=46)], lineno=260, col_offset=12, end_lineno=262, end_col_offset=46)], lineno=258, col_offset=8, end_lineno=262, end_col_offset=46), Return(value=Await(value=Call(func=Attribute(value=Name(id='asyncio', ctx=Load(), lineno=264, col_offset=21, end_lineno=264, end_col_offset=28), attr='shield', ctx=Load(), lineno=264, col_offset=21, end_lineno=264, end_col_offset=35), args=[Name(id='inflight', ctx=Load(), lineno=264, col_offset=36, end_lineno=264, end_col_offset=44)], lineno=264, col_offset=21, end_lineno=264, end_col_offset=45), lineno=264, col_offset=15, end_lineno=264, end_col_offset=45), lineno=264, col_offset=8, end_lineno=264, end_col_offset=45)], returns=Name(id='ValueT', ctx=Load(), lineno=242, col_offset=74, end_lineno=242, end_col_offset=80), lineno=242, col_offset=4, end_lineno=264, end_col_offset=45), AsyncFunctionDef(name='_execute', args=arguments(args=[arg(arg='self', lineno=266, col_offset=23, end_lineno=266, end_col_offset=27), arg(arg='key', annotation=Name(id='KeyT', ctx=Load(), lineno=266, col_offset=34, end_lineno=266, end_col_offset=38), lineno=266, col_offset=29, end_lineno=266, end_col_offset=38), arg(arg='fn', annotation=Subscript(value=Name(id='Callable', ctx=Load(), lineno=266, col_offset=44, end_lineno=266, end_col_offset=52), slice=Tuple(elts=[List(ctx=Load(), lineno=266, col_offset=53, end_lineno=266, end_col_offset=55), Subscript(value=Name(id='Awaitable', ctx=Load(), lineno=266, col_offset=57, end_lineno=266, end_col_offset=66), slice=Name(id='ValueT', ctx=Load(), lineno=266, col_offset=67, end_lineno=266, end_col_offset=73), ctx=Load(), lineno=266, col_offset=57, end_lineno=266, end_col_offset=74)], ctx=Load(), lineno=266, col_offset=53, end_lineno=266, end_col_offset=74), ctx=Load(), lineno=266, col_offset=44, end_lineno=266, end_col_offset=75), lineno=266, col_offset=40, end_lineno=266, end_col_offset=75)]), body=[Try(body=[Return(value=Await(value=Call(func=Name(id='fn', ctx=Load(), lineno=268, col_offset=25, end_lineno=268, end_col_offset=27), lineno=268, col_offset=25, end_lineno=268, end_col_offset=29), lineno=268, col_offset=19, end_lineno=268, end_col_offset=29), lineno=268, col_offset=12, end_lineno=268, end_col_offset=29)], finalbody=[AsyncWith(items=[withitem(context_expr=Attribute(value=Name(id='self', ctx=Load(), lineno=270, col_offset=23, end_lineno=270, end_col_offset=27), attr='_lock', ctx=Load(), lineno=270, col_offset=23, end_lineno=270, end_col_offset=33))], body=[Expr(value=Call(func=Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=271, col_offset=16, end_lineno=271, end_col_offset=20), attr='_inflight', ctx=Load(), lineno=271, col_offset=16, end_lineno=271, end_col_offset=30), attr='pop', ctx=Load(), lineno=271, col_offset=16, end_lineno=271, end_col_offset=34), args=[Name(id='key', ctx=Load(), lineno=271, col_offset=35, end_lineno=271, end_col_offset=38), Constant(value=None, lineno=271, col_offset=40, end_lineno=271, end_col_offset=44)], lineno=271, col_offset=16, end_lineno=271, end_col_offset=45), lineno=271, col_offset=16, end_lineno=271, end_col_offset=45)], lineno=270, col_offset=12, end_lineno=271, end_col_offset=45)], lineno=267, col_offset=8, end_lineno=271, end_col_offset=45)], returns=Name(id='ValueT', ctx=Load(), lineno=266, col_offset=80, end_lineno=266, end_col_offset=86), lineno=266, col_offset=4, end_lineno=271, end_col_offset=45)], type_params=[TypeVar(name='KeyT', bound=Name(id='Hashable', ctx=Load(), lineno=235, col_offset=30, end_lineno=235, end_col_offset=38), lineno=235, col_offset=24, end_lineno=235, end_col_offset=38), TypeVar(name='ValueT', lineno=235, col_offset=40, end_lineno=235, end_col_offset=46)], lineno=235, col_offset=0, end_lineno=271, end_col_offset=45), ClassDef(name='ScopeStoreMetrics', body=[Expr(value=Constant(value='Runtime counters describing scope store cache performance.', lineno=276, col_offset=4, end_lineno=276, end_col_offset=68), lineno=276, col_offset=4, end_lineno=276, end_col_offset=68), AnnAssign(target=Name(id='l1_hits', ctx=Store(), lineno=278, col_offset=4, end_lineno=278, end_col_offset=11), annotation=Name(id='int', ctx=Load(), lineno=278, col_offset=13, end_lineno=278, end_col_offset=16), value=Constant(value=0, lineno=278, col_offset=19, end_lineno=278, end_col_offset=20), simple=1, lineno=278, col_offset=4, end_lineno=278, end_col_offset=20), AnnAssign(target=Name(id='l1_misses', ctx=Store(), lineno=279, col_offset=4, end_lineno=279, end_col_offset=13), annotation=Name(id='int', ctx=Load(), lineno=279, col_offset=15, end_lineno=279, end_col_offset=18), value=Constant(value=0, lineno=279, col_offset=21, end_lineno=279, end_col_offset=22), simple=1, lineno=279, col_offset=4, end_lineno=279, end_col_offset=22), AnnAssign(target=Name(id='l2_hits', ctx=Store(), lineno=280, col_offset=4, end_lineno=280, end_col_offset=11), annotation=Name(id='int', ctx=Load(), lineno=280, col_offset=13, end_lineno=280, end_col_offset=16), value=Constant(value=0, lineno=280, col_offset=19, end_lineno=280, end_col_offset=20), simple=1, lineno=280, col_offset=4, end_lineno=280, end_col_offset=20), AnnAssign(target=Name(id='l2_misses', ctx=Store(), lineno=281, col_offset=4, end_lineno=281, end_col_offset=13), annotation=Name(id='int', ctx=Load(), lineno=281, col_offset=15, end_lineno=281, end_col_offset=18), value=Constant(value=0, lineno=281, col_offset=21, end_lineno=281, end_col_offset=22), simple=1, lineno=281, col_offset=4, end_lineno=281, end_col_offset=22), FunctionDef(name='record_l1_hit', args=arguments(args=[arg(arg='self', lineno=283, col_offset=22, end_lineno=283, end_col_offset=26)]), body=[Expr(value=Constant(value='\n        Return a new metrics instance with an incremented L1 hit counter.\n\n        Returns\n        -------\n        ScopeStoreMetrics\n            Fresh metrics snapshot reflecting the increment.\n        ', lineno=284, col_offset=8, end_lineno=291, end_col_offset=11), lineno=284, col_offset=8, end_lineno=291, end_col_offset=11), Return(value=Call(func=Name(id='ScopeStoreMetrics', ctx=Load(), lineno=292, col_offset=15, end_lineno=292, end_col_offset=32), keywords=[keyword(arg='l1_hits', value=BinOp(left=Attribute(value=Name(id='self', ctx=Load(), lineno=293, col_offset=20, end_lineno=293, end_col_offset=24), attr='l1_hits', ctx=Load(), lineno=293, col_offset=20, end_lineno=293, end_col_offset=32), op=Add(), right=Constant(value=1, lineno=293, col_offset=35, end_lineno=293, end_col_offset=36), lineno=293, col_offset=20, end_lineno=293, end_col_offset=36), lineno=293, col_offset=12, end_lineno=293, end_col_offset=36), keyword(arg='l1_misses', value=Attribute(value=Name(id='self', ctx=Load(), lineno=294, col_offset=22, end_lineno=294, end_col_offset=26), attr='l1_misses', ctx=Load(), lineno=294, col_offset=22, end_lineno=294, end_col_offset=36), lineno=294, col_offset=12, end_lineno=294, end_col_offset=36), keyword(arg='l2_hits', value=Attribute(value=Name(id='self', ctx=Load(), lineno=295, col_offset=20, end_lineno=295, end_col_offset=24), attr='l2_hits', ctx=Load(), lineno=295, col_offset=20, end_lineno=295, end_col_offset=32), lineno=295, col_offset=12, end_lineno=295, end_col_offset=32), keyword(arg='l2_misses', value=Attribute(value=Name(id='self', ctx=Load(), lineno=296, col_offset=22, end_lineno=296, end_col_offset=26), attr='l2_misses', ctx=Load(), lineno=296, col_offset=22, end_lineno=296, end_col_offset=36), lineno=296, col_offset=12, end_lineno=296, end_col_offset=36)], lineno=292, col_offset=15, end_lineno=297, end_col_offset=9), lineno=292, col_offset=8, end_lineno=297, end_col_offset=9)], returns=Name(id='ScopeStoreMetrics', ctx=Load(), lineno=283, col_offset=31, end_lineno=283, end_col_offset=48), lineno=283, col_offset=4, end_lineno=297, end_col_offset=9), FunctionDef(name='record_l1_miss', args=arguments(args=[arg(arg='self', lineno=299, col_offset=23, end_lineno=299, end_col_offset=27)]), body=[Expr(value=Constant(value='\n        Return a new metrics instance with an incremented L1 miss counter.\n\n        Returns\n        -------\n        ScopeStoreMetrics\n            Fresh metrics snapshot reflecting the increment.\n        ', lineno=300, col_offset=8, end_lineno=307, end_col_offset=11), lineno=300, col_offset=8, end_lineno=307, end_col_offset=11), Return(value=Call(func=Name(id='ScopeStoreMetrics', ctx=Load(), lineno=308, col_offset=15, end_lineno=308, end_col_offset=32), keywords=[keyword(arg='l1_hits', value=Attribute(value=Name(id='self', ctx=Load(), lineno=309, col_offset=20, end_lineno=309, end_col_offset=24), attr='l1_hits', ctx=Load(), lineno=309, col_offset=20, end_lineno=309, end_col_offset=32), lineno=309, col_offset=12, end_lineno=309, end_col_offset=32), keyword(arg='l1_misses', value=BinOp(left=Attribute(value=Name(id='self', ctx=Load(), lineno=310, col_offset=22, end_lineno=310, end_col_offset=26), attr='l1_misses', ctx=Load(), lineno=310, col_offset=22, end_lineno=310, end_col_offset=36), op=Add(), right=Constant(value=1, lineno=310, col_offset=39, end_lineno=310, end_col_offset=40), lineno=310, col_offset=22, end_lineno=310, end_col_offset=40), lineno=310, col_offset=12, end_lineno=310, end_col_offset=40), keyword(arg='l2_hits', value=Attribute(value=Name(id='self', ctx=Load(), lineno=311, col_offset=20, end_lineno=311, end_col_offset=24), attr='l2_hits', ctx=Load(), lineno=311, col_offset=20, end_lineno=311, end_col_offset=32), lineno=311, col_offset=12, end_lineno=311, end_col_offset=32), keyword(arg='l2_misses', value=Attribute(value=Name(id='self', ctx=Load(), lineno=312, col_offset=22, end_lineno=312, end_col_offset=26), attr='l2_misses', ctx=Load(), lineno=312, col_offset=22, end_lineno=312, end_col_offset=36), lineno=312, col_offset=12, end_lineno=312, end_col_offset=36)], lineno=308, col_offset=15, end_lineno=313, end_col_offset=9), lineno=308, col_offset=8, end_lineno=313, end_col_offset=9)], returns=Name(id='ScopeStoreMetrics', ctx=Load(), lineno=299, col_offset=32, end_lineno=299, end_col_offset=49), lineno=299, col_offset=4, end_lineno=313, end_col_offset=9), FunctionDef(name='record_l2_hit', args=arguments(args=[arg(arg='self', lineno=315, col_offset=22, end_lineno=315, end_col_offset=26)]), body=[Expr(value=Constant(value='\n        Return a new metrics instance with an incremented L2 hit counter.\n\n        Returns\n        -------\n        ScopeStoreMetrics\n            Fresh metrics snapshot reflecting the increment.\n        ', lineno=316, col_offset=8, end_lineno=323, end_col_offset=11), lineno=316, col_offset=8, end_lineno=323, end_col_offset=11), Return(value=Call(func=Name(id='ScopeStoreMetrics', ctx=Load(), lineno=324, col_offset=15, end_lineno=324, end_col_offset=32), keywords=[keyword(arg='l1_hits', value=Attribute(value=Name(id='self', ctx=Load(), lineno=325, col_offset=20, end_lineno=325, end_col_offset=24), attr='l1_hits', ctx=Load(), lineno=325, col_offset=20, end_lineno=325, end_col_offset=32), lineno=325, col_offset=12, end_lineno=325, end_col_offset=32), keyword(arg='l1_misses', value=Attribute(value=Name(id='self', ctx=Load(), lineno=326, col_offset=22, end_lineno=326, end_col_offset=26), attr='l1_misses', ctx=Load(), lineno=326, col_offset=22, end_lineno=326, end_col_offset=36), lineno=326, col_offset=12, end_lineno=326, end_col_offset=36), keyword(arg='l2_hits', value=BinOp(left=Attribute(value=Name(id='self', ctx=Load(), lineno=327, col_offset=20, end_lineno=327, end_col_offset=24), attr='l2_hits', ctx=Load(), lineno=327, col_offset=20, end_lineno=327, end_col_offset=32), op=Add(), right=Constant(value=1, lineno=327, col_offset=35, end_lineno=327, end_col_offset=36), lineno=327, col_offset=20, end_lineno=327, end_col_offset=36), lineno=327, col_offset=12, end_lineno=327, end_col_offset=36), keyword(arg='l2_misses', value=Attribute(value=Name(id='self', ctx=Load(), lineno=328, col_offset=22, end_lineno=328, end_col_offset=26), attr='l2_misses', ctx=Load(), lineno=328, col_offset=22, end_lineno=328, end_col_offset=36), lineno=328, col_offset=12, end_lineno=328, end_col_offset=36)], lineno=324, col_offset=15, end_lineno=329, end_col_offset=9), lineno=324, col_offset=8, end_lineno=329, end_col_offset=9)], returns=Name(id='ScopeStoreMetrics', ctx=Load(), lineno=315, col_offset=31, end_lineno=315, end_col_offset=48), lineno=315, col_offset=4, end_lineno=329, end_col_offset=9), FunctionDef(name='record_l2_miss', args=arguments(args=[arg(arg='self', lineno=331, col_offset=23, end_lineno=331, end_col_offset=27)]), body=[Expr(value=Constant(value='\n        Return a new metrics instance with an incremented L2 miss counter.\n\n        Returns\n        -------\n        ScopeStoreMetrics\n            Fresh metrics snapshot reflecting the increment.\n        ', lineno=332, col_offset=8, end_lineno=339, end_col_offset=11), lineno=332, col_offset=8, end_lineno=339, end_col_offset=11), Return(value=Call(func=Name(id='ScopeStoreMetrics', ctx=Load(), lineno=340, col_offset=15, end_lineno=340, end_col_offset=32), keywords=[keyword(arg='l1_hits', value=Attribute(value=Name(id='self', ctx=Load(), lineno=341, col_offset=20, end_lineno=341, end_col_offset=24), attr='l1_hits', ctx=Load(), lineno=341, col_offset=20, end_lineno=341, end_col_offset=32), lineno=341, col_offset=12, end_lineno=341, end_col_offset=32), keyword(arg='l1_misses', value=Attribute(value=Name(id='self', ctx=Load(), lineno=342, col_offset=22, end_lineno=342, end_col_offset=26), attr='l1_misses', ctx=Load(), lineno=342, col_offset=22, end_lineno=342, end_col_offset=36), lineno=342, col_offset=12, end_lineno=342, end_col_offset=36), keyword(arg='l2_hits', value=Attribute(value=Name(id='self', ctx=Load(), lineno=343, col_offset=20, end_lineno=343, end_col_offset=24), attr='l2_hits', ctx=Load(), lineno=343, col_offset=20, end_lineno=343, end_col_offset=32), lineno=343, col_offset=12, end_lineno=343, end_col_offset=32), keyword(arg='l2_misses', value=BinOp(left=Attribute(value=Name(id='self', ctx=Load(), lineno=344, col_offset=22, end_lineno=344, end_col_offset=26), attr='l2_misses', ctx=Load(), lineno=344, col_offset=22, end_lineno=344, end_col_offset=36), op=Add(), right=Constant(value=1, lineno=344, col_offset=39, end_lineno=344, end_col_offset=40), lineno=344, col_offset=22, end_lineno=344, end_col_offset=40), lineno=344, col_offset=12, end_lineno=344, end_col_offset=40)], lineno=340, col_offset=15, end_lineno=345, end_col_offset=9), lineno=340, col_offset=8, end_lineno=345, end_col_offset=9)], returns=Name(id='ScopeStoreMetrics', ctx=Load(), lineno=331, col_offset=32, end_lineno=331, end_col_offset=49), lineno=331, col_offset=4, end_lineno=345, end_col_offset=9), FunctionDef(name='l1_hit_rate', args=arguments(args=[arg(arg='self', lineno=348, col_offset=20, end_lineno=348, end_col_offset=24)]), body=[Expr(value=Constant(value='Return the L1 hit rate as a floating point ratio.', lineno=349, col_offset=8, end_lineno=349, end_col_offset=63), lineno=349, col_offset=8, end_lineno=349, end_col_offset=63), Assign(targets=[Name(id='total', ctx=Store(), lineno=350, col_offset=8, end_lineno=350, end_col_offset=13)], value=BinOp(left=Attribute(value=Name(id='self', ctx=Load(), lineno=350, col_offset=16, end_lineno=350, end_col_offset=20), attr='l1_hits', ctx=Load(), lineno=350, col_offset=16, end_lineno=350, end_col_offset=28), op=Add(), right=Attribute(value=Name(id='self', ctx=Load(), lineno=350, col_offset=31, end_lineno=350, end_col_offset=35), attr='l1_misses', ctx=Load(), lineno=350, col_offset=31, end_lineno=350, end_col_offset=45), lineno=350, col_offset=16, end_lineno=350, end_col_offset=45), lineno=350, col_offset=8, end_lineno=350, end_col_offset=45), Return(value=IfExp(test=Name(id='total', ctx=Load(), lineno=351, col_offset=39, end_lineno=351, end_col_offset=44), body=BinOp(left=Attribute(value=Name(id='self', ctx=Load(), lineno=351, col_offset=15, end_lineno=351, end_col_offset=19), attr='l1_hits', ctx=Load(), lineno=351, col_offset=15, end_lineno=351, end_col_offset=27), op=Div(), right=Name(id='total', ctx=Load(), lineno=351, col_offset=30, end_lineno=351, end_col_offset=35), lineno=351, col_offset=15, end_lineno=351, end_col_offset=35), orelse=Constant(value=0.0, lineno=351, col_offset=50, end_lineno=351, end_col_offset=53), lineno=351, col_offset=15, end_lineno=351, end_col_offset=53), lineno=351, col_offset=8, end_lineno=351, end_col_offset=53)], decorator_list=[Name(id='property', ctx=Load(), lineno=347, col_offset=5, end_lineno=347, end_col_offset=13)], returns=Name(id='float', ctx=Load(), lineno=348, col_offset=29, end_lineno=348, end_col_offset=34), lineno=348, col_offset=4, end_lineno=351, end_col_offset=53), FunctionDef(name='l2_hit_rate', args=arguments(args=[arg(arg='self', lineno=354, col_offset=20, end_lineno=354, end_col_offset=24)]), body=[Expr(value=Constant(value='Return the L2 hit rate as a floating point ratio.', lineno=355, col_offset=8, end_lineno=355, end_col_offset=63), lineno=355, col_offset=8, end_lineno=355, end_col_offset=63), Assign(targets=[Name(id='total', ctx=Store(), lineno=356, col_offset=8, end_lineno=356, end_col_offset=13)], value=BinOp(left=Attribute(value=Name(id='self', ctx=Load(), lineno=356, col_offset=16, end_lineno=356, end_col_offset=20), attr='l2_hits', ctx=Load(), lineno=356, col_offset=16, end_lineno=356, end_col_offset=28), op=Add(), right=Attribute(value=Name(id='self', ctx=Load(), lineno=356, col_offset=31, end_lineno=356, end_col_offset=35), attr='l2_misses', ctx=Load(), lineno=356, col_offset=31, end_lineno=356, end_col_offset=45), lineno=356, col_offset=16, end_lineno=356, end_col_offset=45), lineno=356, col_offset=8, end_lineno=356, end_col_offset=45), Return(value=IfExp(test=Name(id='total', ctx=Load(), lineno=357, col_offset=39, end_lineno=357, end_col_offset=44), body=BinOp(left=Attribute(value=Name(id='self', ctx=Load(), lineno=357, col_offset=15, end_lineno=357, end_col_offset=19), attr='l2_hits', ctx=Load(), lineno=357, col_offset=15, end_lineno=357, end_col_offset=27), op=Div(), right=Name(id='total', ctx=Load(), lineno=357, col_offset=30, end_lineno=357, end_col_offset=35), lineno=357, col_offset=15, end_lineno=357, end_col_offset=35), orelse=Constant(value=0.0, lineno=357, col_offset=50, end_lineno=357, end_col_offset=53), lineno=357, col_offset=15, end_lineno=357, end_col_offset=53), lineno=357, col_offset=8, end_lineno=357, end_col_offset=53)], decorator_list=[Name(id='property', ctx=Load(), lineno=353, col_offset=5, end_lineno=353, end_col_offset=13)], returns=Name(id='float', ctx=Load(), lineno=354, col_offset=29, end_lineno=354, end_col_offset=34), lineno=354, col_offset=4, end_lineno=357, end_col_offset=53), FunctionDef(name='as_dict', args=arguments(args=[arg(arg='self', lineno=359, col_offset=16, end_lineno=359, end_col_offset=20)]), body=[Expr(value=Constant(value='\n        Return a serialisable snapshot of the metrics.\n\n        Returns\n        -------\n        dict[str, float | int]\n            Dictionary containing counters and hit rates.\n        ', lineno=360, col_offset=8, end_lineno=367, end_col_offset=11), lineno=360, col_offset=8, end_lineno=367, end_col_offset=11), Return(value=Dict(keys=[Constant(value='l1_hits', lineno=369, col_offset=12, end_lineno=369, end_col_offset=21), Constant(value='l1_misses', lineno=370, col_offset=12, end_lineno=370, end_col_offset=23), Constant(value='l1_hit_rate', lineno=371, col_offset=12, end_lineno=371, end_col_offset=25), Constant(value='l2_hits', lineno=372, col_offset=12, end_lineno=372, end_col_offset=21), Constant(value='l2_misses', lineno=373, col_offset=12, end_lineno=373, end_col_offset=23), Constant(value='l2_hit_rate', lineno=374, col_offset=12, end_lineno=374, end_col_offset=25)], values=[Attribute(value=Name(id='self', ctx=Load(), lineno=369, col_offset=23, end_lineno=369, end_col_offset=27), attr='l1_hits', ctx=Load(), lineno=369, col_offset=23, end_lineno=369, end_col_offset=35), Attribute(value=Name(id='self', ctx=Load(), lineno=370, col_offset=25, end_lineno=370, end_col_offset=29), attr='l1_misses', ctx=Load(), lineno=370, col_offset=25, end_lineno=370, end_col_offset=39), Attribute(value=Name(id='self', ctx=Load(), lineno=371, col_offset=27, end_lineno=371, end_col_offset=31), attr='l1_hit_rate', ctx=Load(), lineno=371, col_offset=27, end_lineno=371, end_col_offset=43), Attribute(value=Name(id='self', ctx=Load(), lineno=372, col_offset=23, end_lineno=372, end_col_offset=27), attr='l2_hits', ctx=Load(), lineno=372, col_offset=23, end_lineno=372, end_col_offset=35), Attribute(value=Name(id='self', ctx=Load(), lineno=373, col_offset=25, end_lineno=373, end_col_offset=29), attr='l2_misses', ctx=Load(), lineno=373, col_offset=25, end_lineno=373, end_col_offset=39), Attribute(value=Name(id='self', ctx=Load(), lineno=374, col_offset=27, end_lineno=374, end_col_offset=31), attr='l2_hit_rate', ctx=Load(), lineno=374, col_offset=27, end_lineno=374, end_col_offset=43)], lineno=368, col_offset=15, end_lineno=375, end_col_offset=9), lineno=368, col_offset=8, end_lineno=375, end_col_offset=9)], returns=Subscript(value=Name(id='dict', ctx=Load(), lineno=359, col_offset=25, end_lineno=359, end_col_offset=29), slice=Tuple(elts=[Name(id='str', ctx=Load(), lineno=359, col_offset=30, end_lineno=359, end_col_offset=33), BinOp(left=Name(id='float', ctx=Load(), lineno=359, col_offset=35, end_lineno=359, end_col_offset=40), op=BitOr(), right=Name(id='int', ctx=Load(), lineno=359, col_offset=43, end_lineno=359, end_col_offset=46), lineno=359, col_offset=35, end_lineno=359, end_col_offset=46)], ctx=Load(), lineno=359, col_offset=30, end_lineno=359, end_col_offset=46), ctx=Load(), lineno=359, col_offset=25, end_lineno=359, end_col_offset=47), lineno=359, col_offset=4, end_lineno=375, end_col_offset=9)], decorator_list=[Call(func=Name(id='dataclass', ctx=Load(), lineno=274, col_offset=1, end_lineno=274, end_col_offset=10), keywords=[keyword(arg='slots', value=Constant(value=True, lineno=274, col_offset=17, end_lineno=274, end_col_offset=21), lineno=274, col_offset=11, end_lineno=274, end_col_offset=21), keyword(arg='frozen', value=Constant(value=True, lineno=274, col_offset=30, end_lineno=274, end_col_offset=34), lineno=274, col_offset=23, end_lineno=274, end_col_offset=34)], lineno=274, col_offset=1, end_lineno=274, end_col_offset=35)], lineno=275, col_offset=0, end_lineno=375, end_col_offset=9), ClassDef(name='ScopeStore', body=[Expr(value=Constant(value='Redis-backed scope store with L1/L2 caching and single-flight coalescing.', lineno=379, col_offset=4, end_lineno=379, end_col_offset=83), lineno=379, col_offset=4, end_lineno=379, end_col_offset=83), FunctionDef(name='__init__', args=arguments(args=[arg(arg='self', lineno=382, col_offset=8, end_lineno=382, end_col_offset=12), arg(arg='redis_client', annotation=Name(id='SupportsAsyncRedis', ctx=Load(), lineno=383, col_offset=22, end_lineno=383, end_col_offset=40), lineno=383, col_offset=8, end_lineno=383, end_col_offset=40)], kwonlyargs=[arg(arg='l1_maxsize', annotation=Name(id='int', ctx=Load(), lineno=385, col_offset=20, end_lineno=385, end_col_offset=23), lineno=385, col_offset=8, end_lineno=385, end_col_offset=23), arg(arg='l1_ttl_seconds', annotation=BinOp(left=Name(id='float', ctx=Load(), lineno=386, col_offset=24, end_lineno=386, end_col_offset=29), op=BitOr(), right=Constant(value=None, lineno=386, col_offset=32, end_lineno=386, end_col_offset=36), lineno=386, col_offset=24, end_lineno=386, end_col_offset=36), lineno=386, col_offset=8, end_lineno=386, end_col_offset=36), arg(arg='l2_ttl_seconds', annotation=BinOp(left=Name(id='int', ctx=Load(), lineno=387, col_offset=24, end_lineno=387, end_col_offset=27), op=BitOr(), right=Constant(value=None, lineno=387, col_offset=30, end_lineno=387, end_col_offset=34), lineno=387, col_offset=24, end_lineno=387, end_col_offset=34), lineno=387, col_offset=8, end_lineno=387, end_col_offset=34), arg(arg='key_prefix', annotation=Name(id='str', ctx=Load(), lineno=388, col_offset=20, end_lineno=388, end_col_offset=23), lineno=388, col_offset=8, end_lineno=388, end_col_offset=23)], kw_defaults=[Constant(value=256, lineno=385, col_offset=26, end_lineno=385, end_col_offset=29), Constant(value=300.0, lineno=386, col_offset=39, end_lineno=386, end_col_offset=44), Constant(value=3600, lineno=387, col_offset=37, end_lineno=387, end_col_offset=41), Constant(value='scope', lineno=388, col_offset=26, end_lineno=388, end_col_offset=33)]), body=[If(test=UnaryOp(op=Not(), operand=Name(id='key_prefix', ctx=Load(), lineno=390, col_offset=15, end_lineno=390, end_col_offset=25), lineno=390, col_offset=11, end_lineno=390, end_col_offset=25), body=[Assign(targets=[Name(id='msg', ctx=Store(), lineno=391, col_offset=12, end_lineno=391, end_col_offset=15)], value=Constant(value='key_prefix must be non-empty', lineno=391, col_offset=18, end_lineno=391, end_col_offset=48), lineno=391, col_offset=12, end_lineno=391, end_col_offset=48), Raise(exc=Call(func=Name(id='ValueError', ctx=Load(), lineno=392, col_offset=18, end_lineno=392, end_col_offset=28), args=[Name(id='msg', ctx=Load(), lineno=392, col_offset=29, end_lineno=392, end_col_offset=32)], lineno=392, col_offset=18, end_lineno=392, end_col_offset=33), lineno=392, col_offset=12, end_lineno=392, end_col_offset=33)], lineno=390, col_offset=8, end_lineno=392, end_col_offset=33), Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=394, col_offset=8, end_lineno=394, end_col_offset=12), attr='_redis', ctx=Store(), lineno=394, col_offset=8, end_lineno=394, end_col_offset=19)], value=Name(id='redis_client', ctx=Load(), lineno=394, col_offset=22, end_lineno=394, end_col_offset=34), lineno=394, col_offset=8, end_lineno=394, end_col_offset=34), AnnAssign(target=Attribute(value=Name(id='self', ctx=Load(), lineno=395, col_offset=8, end_lineno=395, end_col_offset=12), attr='_l1', ctx=Store(), lineno=395, col_offset=8, end_lineno=395, end_col_offset=16), annotation=Subscript(value=Name(id='LRUCache', ctx=Load(), lineno=395, col_offset=18, end_lineno=395, end_col_offset=26), slice=Tuple(elts=[Name(id='str', ctx=Load(), lineno=395, col_offset=27, end_lineno=395, end_col_offset=30), Name(id='ScopeIn', ctx=Load(), lineno=395, col_offset=32, end_lineno=395, end_col_offset=39)], ctx=Load(), lineno=395, col_offset=27, end_lineno=395, end_col_offset=39), ctx=Load(), lineno=395, col_offset=18, end_lineno=395, end_col_offset=40), value=Call(func=Name(id='LRUCache', ctx=Load(), lineno=395, col_offset=43, end_lineno=395, end_col_offset=51), keywords=[keyword(arg='maxsize', value=Name(id='l1_maxsize', ctx=Load(), lineno=395, col_offset=60, end_lineno=395, end_col_offset=70), lineno=395, col_offset=52, end_lineno=395, end_col_offset=70), keyword(arg='ttl_seconds', value=Name(id='l1_ttl_seconds', ctx=Load(), lineno=395, col_offset=84, end_lineno=395, end_col_offset=98), lineno=395, col_offset=72, end_lineno=395, end_col_offset=98)], lineno=395, col_offset=43, end_lineno=395, end_col_offset=99), simple=0, lineno=395, col_offset=8, end_lineno=395, end_col_offset=99), AnnAssign(target=Attribute(value=Name(id='self', ctx=Load(), lineno=396, col_offset=8, end_lineno=396, end_col_offset=12), attr='_flight', ctx=Store(), lineno=396, col_offset=8, end_lineno=396, end_col_offset=20), annotation=Subscript(value=Name(id='AsyncSingleFlight', ctx=Load(), lineno=396, col_offset=22, end_lineno=396, end_col_offset=39), slice=Tuple(elts=[Name(id='str', ctx=Load(), lineno=396, col_offset=40, end_lineno=396, end_col_offset=43), BinOp(left=Name(id='ScopeIn', ctx=Load(), lineno=396, col_offset=45, end_lineno=396, end_col_offset=52), op=BitOr(), right=Constant(value=None, lineno=396, col_offset=55, end_lineno=396, end_col_offset=59), lineno=396, col_offset=45, end_lineno=396, end_col_offset=59)], ctx=Load(), lineno=396, col_offset=40, end_lineno=396, end_col_offset=59), ctx=Load(), lineno=396, col_offset=22, end_lineno=396, end_col_offset=60), value=Call(func=Name(id='AsyncSingleFlight', ctx=Load(), lineno=396, col_offset=63, end_lineno=396, end_col_offset=80), lineno=396, col_offset=63, end_lineno=396, end_col_offset=82), simple=0, lineno=396, col_offset=8, end_lineno=396, end_col_offset=82), Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=397, col_offset=8, end_lineno=397, end_col_offset=12), attr='_metrics', ctx=Store(), lineno=397, col_offset=8, end_lineno=397, end_col_offset=21)], value=Call(func=Name(id='ScopeStoreMetrics', ctx=Load(), lineno=397, col_offset=24, end_lineno=397, end_col_offset=41), lineno=397, col_offset=24, end_lineno=397, end_col_offset=43), lineno=397, col_offset=8, end_lineno=397, end_col_offset=43), Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=398, col_offset=8, end_lineno=398, end_col_offset=12), attr='_l2_ttl_seconds', ctx=Store(), lineno=398, col_offset=8, end_lineno=398, end_col_offset=28)], value=Name(id='l2_ttl_seconds', ctx=Load(), lineno=398, col_offset=31, end_lineno=398, end_col_offset=45), lineno=398, col_offset=8, end_lineno=398, end_col_offset=45), Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=399, col_offset=8, end_lineno=399, end_col_offset=12), attr='_key_prefix', ctx=Store(), lineno=399, col_offset=8, end_lineno=399, end_col_offset=24)], value=Name(id='key_prefix', ctx=Load(), lineno=399, col_offset=27, end_lineno=399, end_col_offset=37), lineno=399, col_offset=8, end_lineno=399, end_col_offset=37)], returns=Constant(value=None, lineno=389, col_offset=9, end_lineno=389, end_col_offset=13), lineno=381, col_offset=4, end_lineno=399, end_col_offset=37), FunctionDef(name='metrics', args=arguments(args=[arg(arg='self', lineno=402, col_offset=16, end_lineno=402, end_col_offset=20)]), body=[Expr(value=Constant(value='Return live cache metrics.', lineno=403, col_offset=8, end_lineno=403, end_col_offset=40), lineno=403, col_offset=8, end_lineno=403, end_col_offset=40), Return(value=Attribute(value=Name(id='self', ctx=Load(), lineno=404, col_offset=15, end_lineno=404, end_col_offset=19), attr='_metrics', ctx=Load(), lineno=404, col_offset=15, end_lineno=404, end_col_offset=28), lineno=404, col_offset=8, end_lineno=404, end_col_offset=28)], decorator_list=[Name(id='property', ctx=Load(), lineno=401, col_offset=5, end_lineno=401, end_col_offset=13)], returns=Name(id='ScopeStoreMetrics', ctx=Load(), lineno=402, col_offset=25, end_lineno=402, end_col_offset=42), lineno=402, col_offset=4, end_lineno=404, end_col_offset=28), AsyncFunctionDef(name='get', args=arguments(args=[arg(arg='self', lineno=406, col_offset=18, end_lineno=406, end_col_offset=22), arg(arg='session_id', annotation=Name(id='str', ctx=Load(), lineno=406, col_offset=36, end_lineno=406, end_col_offset=39), lineno=406, col_offset=24, end_lineno=406, end_col_offset=39)]), body=[Expr(value=Constant(value='\n        Retrieve scope for ``session_id``, favouring the L1 cache.\n\n        Parameters\n        ----------\n        session_id : str\n            Session identifier to retrieve.\n\n        Returns\n        -------\n        ScopeIn | None\n            Scope data when present; otherwise ``None``.\n\n        Raises\n        ------\n        ValueError\n            If ``session_id`` is empty.\n        ', lineno=407, col_offset=8, end_lineno=424, end_col_offset=11), lineno=407, col_offset=8, end_lineno=424, end_col_offset=11), If(test=UnaryOp(op=Not(), operand=Name(id='session_id', ctx=Load(), lineno=425, col_offset=15, end_lineno=425, end_col_offset=25), lineno=425, col_offset=11, end_lineno=425, end_col_offset=25), body=[Assign(targets=[Name(id='msg', ctx=Store(), lineno=426, col_offset=12, end_lineno=426, end_col_offset=15)], value=Constant(value='session_id must be non-empty', lineno=426, col_offset=18, end_lineno=426, end_col_offset=48), lineno=426, col_offset=12, end_lineno=426, end_col_offset=48), Raise(exc=Call(func=Name(id='ValueError', ctx=Load(), lineno=427, col_offset=18, end_lineno=427, end_col_offset=28), args=[Name(id='msg', ctx=Load(), lineno=427, col_offset=29, end_lineno=427, end_col_offset=32)], lineno=427, col_offset=18, end_lineno=427, end_col_offset=33), lineno=427, col_offset=12, end_lineno=427, end_col_offset=33)], lineno=425, col_offset=8, end_lineno=427, end_col_offset=33), Assign(targets=[Name(id='cached', ctx=Store(), lineno=429, col_offset=8, end_lineno=429, end_col_offset=14)], value=Call(func=Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=429, col_offset=17, end_lineno=429, end_col_offset=21), attr='_l1', ctx=Load(), lineno=429, col_offset=17, end_lineno=429, end_col_offset=25), attr='get', ctx=Load(), lineno=429, col_offset=17, end_lineno=429, end_col_offset=29), args=[Name(id='session_id', ctx=Load(), lineno=429, col_offset=30, end_lineno=429, end_col_offset=40)], lineno=429, col_offset=17, end_lineno=429, end_col_offset=41), lineno=429, col_offset=8, end_lineno=429, end_col_offset=41), If(test=Compare(left=Name(id='cached', ctx=Load(), lineno=430, col_offset=11, end_lineno=430, end_col_offset=17), ops=[IsNot()], comparators=[Constant(value=None, lineno=430, col_offset=25, end_lineno=430, end_col_offset=29)], lineno=430, col_offset=11, end_lineno=430, end_col_offset=29), body=[Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=431, col_offset=12, end_lineno=431, end_col_offset=16), attr='_metrics', ctx=Store(), lineno=431, col_offset=12, end_lineno=431, end_col_offset=25)], value=Call(func=Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=431, col_offset=28, end_lineno=431, end_col_offset=32), attr='_metrics', ctx=Load(), lineno=431, col_offset=28, end_lineno=431, end_col_offset=41), attr='record_l1_hit', ctx=Load(), lineno=431, col_offset=28, end_lineno=431, end_col_offset=55), lineno=431, col_offset=28, end_lineno=431, end_col_offset=57), lineno=431, col_offset=12, end_lineno=431, end_col_offset=57), Return(value=Name(id='cached', ctx=Load(), lineno=432, col_offset=19, end_lineno=432, end_col_offset=25), lineno=432, col_offset=12, end_lineno=432, end_col_offset=25)], lineno=430, col_offset=8, end_lineno=432, end_col_offset=25), Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=434, col_offset=8, end_lineno=434, end_col_offset=12), attr='_metrics', ctx=Store(), lineno=434, col_offset=8, end_lineno=434, end_col_offset=21)], value=Call(func=Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=434, col_offset=24, end_lineno=434, end_col_offset=28), attr='_metrics', ctx=Load(), lineno=434, col_offset=24, end_lineno=434, end_col_offset=37), attr='record_l1_miss', ctx=Load(), lineno=434, col_offset=24, end_lineno=434, end_col_offset=52), lineno=434, col_offset=24, end_lineno=434, end_col_offset=54), lineno=434, col_offset=8, end_lineno=434, end_col_offset=54), Return(value=Await(value=Call(func=Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=435, col_offset=21, end_lineno=435, end_col_offset=25), attr='_flight', ctx=Load(), lineno=435, col_offset=21, end_lineno=435, end_col_offset=33), attr='do', ctx=Load(), lineno=435, col_offset=21, end_lineno=435, end_col_offset=36), args=[Name(id='session_id', ctx=Load(), lineno=435, col_offset=37, end_lineno=435, end_col_offset=47), Lambda(args=arguments(), body=Call(func=Attribute(value=Name(id='self', ctx=Load(), lineno=435, col_offset=57, end_lineno=435, end_col_offset=61), attr='_fetch_from_l2', ctx=Load(), lineno=435, col_offset=57, end_lineno=435, end_col_offset=76), args=[Name(id='session_id', ctx=Load(), lineno=435, col_offset=77, end_lineno=435, end_col_offset=87)], lineno=435, col_offset=57, end_lineno=435, end_col_offset=88), lineno=435, col_offset=49, end_lineno=435, end_col_offset=88)], lineno=435, col_offset=21, end_lineno=435, end_col_offset=89), lineno=435, col_offset=15, end_lineno=435, end_col_offset=89), lineno=435, col_offset=8, end_lineno=435, end_col_offset=89)], returns=BinOp(left=Name(id='ScopeIn', ctx=Load(), lineno=406, col_offset=44, end_lineno=406, end_col_offset=51), op=BitOr(), right=Constant(value=None, lineno=406, col_offset=54, end_lineno=406, end_col_offset=58), lineno=406, col_offset=44, end_lineno=406, end_col_offset=58), lineno=406, col_offset=4, end_lineno=435, end_col_offset=89), AsyncFunctionDef(name='set', args=arguments(args=[arg(arg='self', lineno=437, col_offset=18, end_lineno=437, end_col_offset=22), arg(arg='session_id', annotation=Name(id='str', ctx=Load(), lineno=437, col_offset=36, end_lineno=437, end_col_offset=39), lineno=437, col_offset=24, end_lineno=437, end_col_offset=39), arg(arg='scope', annotation=Name(id='ScopeIn', ctx=Load(), lineno=437, col_offset=48, end_lineno=437, end_col_offset=55), lineno=437, col_offset=41, end_lineno=437, end_col_offset=55)]), body=[Expr(value=Constant(value='\n        Persist scope for ``session_id`` in both caches.\n\n        Parameters\n        ----------\n        session_id : str\n            Session identifier to update.\n        scope : ScopeIn\n            Scope payload to cache.\n\n        Raises\n        ------\n        ValueError\n            If ``session_id`` is empty.\n        ', lineno=438, col_offset=8, end_lineno=452, end_col_offset=11), lineno=438, col_offset=8, end_lineno=452, end_col_offset=11), If(test=UnaryOp(op=Not(), operand=Name(id='session_id', ctx=Load(), lineno=453, col_offset=15, end_lineno=453, end_col_offset=25), lineno=453, col_offset=11, end_lineno=453, end_col_offset=25), body=[Assign(targets=[Name(id='msg', ctx=Store(), lineno=454, col_offset=12, end_lineno=454, end_col_offset=15)], value=Constant(value='session_id must be non-empty', lineno=454, col_offset=18, end_lineno=454, end_col_offset=48), lineno=454, col_offset=12, end_lineno=454, end_col_offset=48), Raise(exc=Call(func=Name(id='ValueError', ctx=Load(), lineno=455, col_offset=18, end_lineno=455, end_col_offset=28), args=[Name(id='msg', ctx=Load(), lineno=455, col_offset=29, end_lineno=455, end_col_offset=32)], lineno=455, col_offset=18, end_lineno=455, end_col_offset=33), lineno=455, col_offset=12, end_lineno=455, end_col_offset=33)], lineno=453, col_offset=8, end_lineno=455, end_col_offset=33), Assign(targets=[Name(id='scope_copy', ctx=Store(), lineno=457, col_offset=8, end_lineno=457, end_col_offset=18)], value=Call(func=Name(id='dict', ctx=Load(), lineno=457, col_offset=21, end_lineno=457, end_col_offset=25), args=[Name(id='scope', ctx=Load(), lineno=457, col_offset=26, end_lineno=457, end_col_offset=31)], lineno=457, col_offset=21, end_lineno=457, end_col_offset=32), lineno=457, col_offset=8, end_lineno=457, end_col_offset=32), Expr(value=Call(func=Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=458, col_offset=8, end_lineno=458, end_col_offset=12), attr='_l1', ctx=Load(), lineno=458, col_offset=8, end_lineno=458, end_col_offset=16), attr='set', ctx=Load(), lineno=458, col_offset=8, end_lineno=458, end_col_offset=20), args=[Name(id='session_id', ctx=Load(), lineno=458, col_offset=21, end_lineno=458, end_col_offset=31), Call(func=Name(id='cast', ctx=Load(), lineno=458, col_offset=33, end_lineno=458, end_col_offset=37), args=[Constant(value='ScopeIn', lineno=458, col_offset=38, end_lineno=458, end_col_offset=47), Name(id='scope_copy', ctx=Load(), lineno=458, col_offset=49, end_lineno=458, end_col_offset=59)], lineno=458, col_offset=33, end_lineno=458, end_col_offset=60)], lineno=458, col_offset=8, end_lineno=458, end_col_offset=61), lineno=458, col_offset=8, end_lineno=458, end_col_offset=61), Assign(targets=[Name(id='key', ctx=Store(), lineno=460, col_offset=8, end_lineno=460, end_col_offset=11)], value=Call(func=Attribute(value=Name(id='self', ctx=Load(), lineno=460, col_offset=14, end_lineno=460, end_col_offset=18), attr='_redis_key', ctx=Load(), lineno=460, col_offset=14, end_lineno=460, end_col_offset=29), args=[Name(id='session_id', ctx=Load(), lineno=460, col_offset=30, end_lineno=460, end_col_offset=40)], lineno=460, col_offset=14, end_lineno=460, end_col_offset=41), lineno=460, col_offset=8, end_lineno=460, end_col_offset=41), Assign(targets=[Name(id='payload', ctx=Store(), lineno=461, col_offset=8, end_lineno=461, end_col_offset=15)], value=Call(func=Attribute(value=Attribute(value=Name(id='msgspec', ctx=Load(), lineno=461, col_offset=18, end_lineno=461, end_col_offset=25), attr='json', ctx=Load(), lineno=461, col_offset=18, end_lineno=461, end_col_offset=30), attr='encode', ctx=Load(), lineno=461, col_offset=18, end_lineno=461, end_col_offset=37), args=[Name(id='scope_copy', ctx=Load(), lineno=461, col_offset=38, end_lineno=461, end_col_offset=48)], lineno=461, col_offset=18, end_lineno=461, end_col_offset=49), lineno=461, col_offset=8, end_lineno=461, end_col_offset=49), If(test=Compare(left=Attribute(value=Name(id='self', ctx=Load(), lineno=463, col_offset=11, end_lineno=463, end_col_offset=15), attr='_l2_ttl_seconds', ctx=Load(), lineno=463, col_offset=11, end_lineno=463, end_col_offset=31), ops=[Is()], comparators=[Constant(value=None, lineno=463, col_offset=35, end_lineno=463, end_col_offset=39)], lineno=463, col_offset=11, end_lineno=463, end_col_offset=39), body=[Expr(value=Await(value=Call(func=Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=464, col_offset=18, end_lineno=464, end_col_offset=22), attr='_redis', ctx=Load(), lineno=464, col_offset=18, end_lineno=464, end_col_offset=29), attr='set', ctx=Load(), lineno=464, col_offset=18, end_lineno=464, end_col_offset=33), args=[Name(id='key', ctx=Load(), lineno=464, col_offset=34, end_lineno=464, end_col_offset=37), Name(id='payload', ctx=Load(), lineno=464, col_offset=39, end_lineno=464, end_col_offset=46)], lineno=464, col_offset=18, end_lineno=464, end_col_offset=47), lineno=464, col_offset=12, end_lineno=464, end_col_offset=47), lineno=464, col_offset=12, end_lineno=464, end_col_offset=47)], orelse=[If(test=Compare(left=Attribute(value=Name(id='self', ctx=Load(), lineno=465, col_offset=13, end_lineno=465, end_col_offset=17), attr='_l2_ttl_seconds', ctx=Load(), lineno=465, col_offset=13, end_lineno=465, end_col_offset=33), ops=[Gt()], comparators=[Constant(value=0, lineno=465, col_offset=36, end_lineno=465, end_col_offset=37)], lineno=465, col_offset=13, end_lineno=465, end_col_offset=37), body=[Expr(value=Await(value=Call(func=Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=466, col_offset=18, end_lineno=466, end_col_offset=22), attr='_redis', ctx=Load(), lineno=466, col_offset=18, end_lineno=466, end_col_offset=29), attr='setex', ctx=Load(), lineno=466, col_offset=18, end_lineno=466, end_col_offset=35), args=[Name(id='key', ctx=Load(), lineno=466, col_offset=36, end_lineno=466, end_col_offset=39), Attribute(value=Name(id='self', ctx=Load(), lineno=466, col_offset=41, end_lineno=466, end_col_offset=45), attr='_l2_ttl_seconds', ctx=Load(), lineno=466, col_offset=41, end_lineno=466, end_col_offset=61), Name(id='payload', ctx=Load(), lineno=466, col_offset=63, end_lineno=466, end_col_offset=70)], lineno=466, col_offset=18, end_lineno=466, end_col_offset=71), lineno=466, col_offset=12, end_lineno=466, end_col_offset=71), lineno=466, col_offset=12, end_lineno=466, end_col_offset=71)], orelse=[Expr(value=Await(value=Call(func=Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=468, col_offset=18, end_lineno=468, end_col_offset=22), attr='_redis', ctx=Load(), lineno=468, col_offset=18, end_lineno=468, end_col_offset=29), attr='delete', ctx=Load(), lineno=468, col_offset=18, end_lineno=468, end_col_offset=36), args=[Name(id='key', ctx=Load(), lineno=468, col_offset=37, end_lineno=468, end_col_offset=40)], lineno=468, col_offset=18, end_lineno=468, end_col_offset=41), lineno=468, col_offset=12, end_lineno=468, end_col_offset=41), lineno=468, col_offset=12, end_lineno=468, end_col_offset=41)], lineno=465, col_offset=8, end_lineno=468, end_col_offset=41)], lineno=463, col_offset=8, end_lineno=468, end_col_offset=41)], returns=Constant(value=None, lineno=437, col_offset=60, end_lineno=437, end_col_offset=64), lineno=437, col_offset=4, end_lineno=468, end_col_offset=41), AsyncFunctionDef(name='delete', args=arguments(args=[arg(arg='self', lineno=470, col_offset=21, end_lineno=470, end_col_offset=25), arg(arg='session_id', annotation=Name(id='str', ctx=Load(), lineno=470, col_offset=39, end_lineno=470, end_col_offset=42), lineno=470, col_offset=27, end_lineno=470, end_col_offset=42)]), body=[Expr(value=Constant(value='\n        Remove cached scope for ``session_id`` from both layers.\n\n        Parameters\n        ----------\n        session_id : str\n            Session identifier to remove.\n\n        Raises\n        ------\n        ValueError\n            If ``session_id`` is empty.\n        ', lineno=471, col_offset=8, end_lineno=483, end_col_offset=11), lineno=471, col_offset=8, end_lineno=483, end_col_offset=11), If(test=UnaryOp(op=Not(), operand=Name(id='session_id', ctx=Load(), lineno=484, col_offset=15, end_lineno=484, end_col_offset=25), lineno=484, col_offset=11, end_lineno=484, end_col_offset=25), body=[Assign(targets=[Name(id='msg', ctx=Store(), lineno=485, col_offset=12, end_lineno=485, end_col_offset=15)], value=Constant(value='session_id must be non-empty', lineno=485, col_offset=18, end_lineno=485, end_col_offset=48), lineno=485, col_offset=12, end_lineno=485, end_col_offset=48), Raise(exc=Call(func=Name(id='ValueError', ctx=Load(), lineno=486, col_offset=18, end_lineno=486, end_col_offset=28), args=[Name(id='msg', ctx=Load(), lineno=486, col_offset=29, end_lineno=486, end_col_offset=32)], lineno=486, col_offset=18, end_lineno=486, end_col_offset=33), lineno=486, col_offset=12, end_lineno=486, end_col_offset=33)], lineno=484, col_offset=8, end_lineno=486, end_col_offset=33), Expr(value=Call(func=Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=488, col_offset=8, end_lineno=488, end_col_offset=12), attr='_l1', ctx=Load(), lineno=488, col_offset=8, end_lineno=488, end_col_offset=16), attr='delete', ctx=Load(), lineno=488, col_offset=8, end_lineno=488, end_col_offset=23), args=[Name(id='session_id', ctx=Load(), lineno=488, col_offset=24, end_lineno=488, end_col_offset=34)], lineno=488, col_offset=8, end_lineno=488, end_col_offset=35), lineno=488, col_offset=8, end_lineno=488, end_col_offset=35), Expr(value=Await(value=Call(func=Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=489, col_offset=14, end_lineno=489, end_col_offset=18), attr='_redis', ctx=Load(), lineno=489, col_offset=14, end_lineno=489, end_col_offset=25), attr='delete', ctx=Load(), lineno=489, col_offset=14, end_lineno=489, end_col_offset=32), args=[Call(func=Attribute(value=Name(id='self', ctx=Load(), lineno=489, col_offset=33, end_lineno=489, end_col_offset=37), attr='_redis_key', ctx=Load(), lineno=489, col_offset=33, end_lineno=489, end_col_offset=48), args=[Name(id='session_id', ctx=Load(), lineno=489, col_offset=49, end_lineno=489, end_col_offset=59)], lineno=489, col_offset=33, end_lineno=489, end_col_offset=60)], lineno=489, col_offset=14, end_lineno=489, end_col_offset=61), lineno=489, col_offset=8, end_lineno=489, end_col_offset=61), lineno=489, col_offset=8, end_lineno=489, end_col_offset=61)], returns=Constant(value=None, lineno=470, col_offset=47, end_lineno=470, end_col_offset=51), lineno=470, col_offset=4, end_lineno=489, end_col_offset=61), FunctionDef(name='evict_l1', args=arguments(args=[arg(arg='self', lineno=491, col_offset=17, end_lineno=491, end_col_offset=21), arg(arg='session_id', annotation=Name(id='str', ctx=Load(), lineno=491, col_offset=35, end_lineno=491, end_col_offset=38), lineno=491, col_offset=23, end_lineno=491, end_col_offset=38)]), body=[Expr(value=Constant(value='\n        Remove ``session_id`` from the L1 cache only.\n\n        Parameters\n        ----------\n        session_id : str\n            Session identifier to evict.\n\n        Raises\n        ------\n        ValueError\n            If ``session_id`` is empty.\n        ', lineno=492, col_offset=8, end_lineno=504, end_col_offset=11), lineno=492, col_offset=8, end_lineno=504, end_col_offset=11), If(test=UnaryOp(op=Not(), operand=Name(id='session_id', ctx=Load(), lineno=505, col_offset=15, end_lineno=505, end_col_offset=25), lineno=505, col_offset=11, end_lineno=505, end_col_offset=25), body=[Assign(targets=[Name(id='msg', ctx=Store(), lineno=506, col_offset=12, end_lineno=506, end_col_offset=15)], value=Constant(value='session_id must be non-empty', lineno=506, col_offset=18, end_lineno=506, end_col_offset=48), lineno=506, col_offset=12, end_lineno=506, end_col_offset=48), Raise(exc=Call(func=Name(id='ValueError', ctx=Load(), lineno=507, col_offset=18, end_lineno=507, end_col_offset=28), args=[Name(id='msg', ctx=Load(), lineno=507, col_offset=29, end_lineno=507, end_col_offset=32)], lineno=507, col_offset=18, end_lineno=507, end_col_offset=33), lineno=507, col_offset=12, end_lineno=507, end_col_offset=33)], lineno=505, col_offset=8, end_lineno=507, end_col_offset=33), Expr(value=Call(func=Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=509, col_offset=8, end_lineno=509, end_col_offset=12), attr='_l1', ctx=Load(), lineno=509, col_offset=8, end_lineno=509, end_col_offset=16), attr='delete', ctx=Load(), lineno=509, col_offset=8, end_lineno=509, end_col_offset=23), args=[Name(id='session_id', ctx=Load(), lineno=509, col_offset=24, end_lineno=509, end_col_offset=34)], lineno=509, col_offset=8, end_lineno=509, end_col_offset=35), lineno=509, col_offset=8, end_lineno=509, end_col_offset=35)], returns=Constant(value=None, lineno=491, col_offset=43, end_lineno=491, end_col_offset=47), lineno=491, col_offset=4, end_lineno=509, end_col_offset=35), AsyncFunctionDef(name='close', args=arguments(args=[arg(arg='self', lineno=511, col_offset=20, end_lineno=511, end_col_offset=24)]), body=[Expr(value=Constant(value='Close underlying Redis resources.', lineno=512, col_offset=8, end_lineno=512, end_col_offset=47), lineno=512, col_offset=8, end_lineno=512, end_col_offset=47), Expr(value=Await(value=Call(func=Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=513, col_offset=14, end_lineno=513, end_col_offset=18), attr='_redis', ctx=Load(), lineno=513, col_offset=14, end_lineno=513, end_col_offset=25), attr='close', ctx=Load(), lineno=513, col_offset=14, end_lineno=513, end_col_offset=31), lineno=513, col_offset=14, end_lineno=513, end_col_offset=33), lineno=513, col_offset=8, end_lineno=513, end_col_offset=33), lineno=513, col_offset=8, end_lineno=513, end_col_offset=33)], returns=Constant(value=None, lineno=511, col_offset=29, end_lineno=511, end_col_offset=33), lineno=511, col_offset=4, end_lineno=513, end_col_offset=33), FunctionDef(name='_redis_key', args=arguments(args=[arg(arg='self', lineno=515, col_offset=19, end_lineno=515, end_col_offset=23), arg(arg='session_id', annotation=Name(id='str', ctx=Load(), lineno=515, col_offset=37, end_lineno=515, end_col_offset=40), lineno=515, col_offset=25, end_lineno=515, end_col_offset=40)]), body=[Return(value=JoinedStr(values=[FormattedValue(value=Attribute(value=Name(id='self', ctx=Load(), lineno=516, col_offset=18, end_lineno=516, end_col_offset=22), attr='_key_prefix', ctx=Load(), lineno=516, col_offset=18, end_lineno=516, end_col_offset=34), conversion=-1, lineno=516, col_offset=17, end_lineno=516, end_col_offset=35), Constant(value=':', lineno=516, col_offset=35, end_lineno=516, end_col_offset=36), FormattedValue(value=Name(id='session_id', ctx=Load(), lineno=516, col_offset=37, end_lineno=516, end_col_offset=47), conversion=-1, lineno=516, col_offset=36, end_lineno=516, end_col_offset=48)], lineno=516, col_offset=15, end_lineno=516, end_col_offset=49), lineno=516, col_offset=8, end_lineno=516, end_col_offset=49)], returns=Name(id='str', ctx=Load(), lineno=515, col_offset=45, end_lineno=515, end_col_offset=48), lineno=515, col_offset=4, end_lineno=516, end_col_offset=49), AsyncFunctionDef(name='_fetch_from_l2', args=arguments(args=[arg(arg='self', lineno=518, col_offset=29, end_lineno=518, end_col_offset=33), arg(arg='session_id', annotation=Name(id='str', ctx=Load(), lineno=518, col_offset=47, end_lineno=518, end_col_offset=50), lineno=518, col_offset=35, end_lineno=518, end_col_offset=50)]), body=[Assign(targets=[Name(id='key', ctx=Store(), lineno=519, col_offset=8, end_lineno=519, end_col_offset=11)], value=Call(func=Attribute(value=Name(id='self', ctx=Load(), lineno=519, col_offset=14, end_lineno=519, end_col_offset=18), attr='_redis_key', ctx=Load(), lineno=519, col_offset=14, end_lineno=519, end_col_offset=29), args=[Name(id='session_id', ctx=Load(), lineno=519, col_offset=30, end_lineno=519, end_col_offset=40)], lineno=519, col_offset=14, end_lineno=519, end_col_offset=41), lineno=519, col_offset=8, end_lineno=519, end_col_offset=41), Assign(targets=[Name(id='data', ctx=Store(), lineno=520, col_offset=8, end_lineno=520, end_col_offset=12)], value=Await(value=Call(func=Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=520, col_offset=21, end_lineno=520, end_col_offset=25), attr='_redis', ctx=Load(), lineno=520, col_offset=21, end_lineno=520, end_col_offset=32), attr='get', ctx=Load(), lineno=520, col_offset=21, end_lineno=520, end_col_offset=36), args=[Name(id='key', ctx=Load(), lineno=520, col_offset=37, end_lineno=520, end_col_offset=40)], lineno=520, col_offset=21, end_lineno=520, end_col_offset=41), lineno=520, col_offset=15, end_lineno=520, end_col_offset=41), lineno=520, col_offset=8, end_lineno=520, end_col_offset=41), If(test=Compare(left=Name(id='data', ctx=Load(), lineno=522, col_offset=11, end_lineno=522, end_col_offset=15), ops=[Is()], comparators=[Constant(value=None, lineno=522, col_offset=19, end_lineno=522, end_col_offset=23)], lineno=522, col_offset=11, end_lineno=522, end_col_offset=23), body=[Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=523, col_offset=12, end_lineno=523, end_col_offset=16), attr='_metrics', ctx=Store(), lineno=523, col_offset=12, end_lineno=523, end_col_offset=25)], value=Call(func=Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=523, col_offset=28, end_lineno=523, end_col_offset=32), attr='_metrics', ctx=Load(), lineno=523, col_offset=28, end_lineno=523, end_col_offset=41), attr='record_l2_miss', ctx=Load(), lineno=523, col_offset=28, end_lineno=523, end_col_offset=56), lineno=523, col_offset=28, end_lineno=523, end_col_offset=58), lineno=523, col_offset=12, end_lineno=523, end_col_offset=58), Return(value=Constant(value=None, lineno=524, col_offset=19, end_lineno=524, end_col_offset=23), lineno=524, col_offset=12, end_lineno=524, end_col_offset=23)], lineno=522, col_offset=8, end_lineno=524, end_col_offset=23), Try(body=[Assign(targets=[Name(id='scope', ctx=Store(), lineno=527, col_offset=12, end_lineno=527, end_col_offset=17)], value=Call(func=Name(id='cast', ctx=Load(), lineno=527, col_offset=20, end_lineno=527, end_col_offset=24), args=[Constant(value='ScopeIn', lineno=527, col_offset=25, end_lineno=527, end_col_offset=34), Call(func=Attribute(value=Attribute(value=Name(id='msgspec', ctx=Load(), lineno=527, col_offset=36, end_lineno=527, end_col_offset=43), attr='json', ctx=Load(), lineno=527, col_offset=36, end_lineno=527, end_col_offset=48), attr='decode', ctx=Load(), lineno=527, col_offset=36, end_lineno=527, end_col_offset=55), args=[Name(id='data', ctx=Load(), lineno=527, col_offset=56, end_lineno=527, end_col_offset=60)], keywords=[keyword(arg='type', value=Subscript(value=Name(id='dict', ctx=Load(), lineno=527, col_offset=67, end_lineno=527, end_col_offset=71), slice=Tuple(elts=[Name(id='str', ctx=Load(), lineno=527, col_offset=72, end_lineno=527, end_col_offset=75), Name(id='Any', ctx=Load(), lineno=527, col_offset=77, end_lineno=527, end_col_offset=80)], ctx=Load(), lineno=527, col_offset=72, end_lineno=527, end_col_offset=80), ctx=Load(), lineno=527, col_offset=67, end_lineno=527, end_col_offset=81), lineno=527, col_offset=62, end_lineno=527, end_col_offset=81)], lineno=527, col_offset=36, end_lineno=527, end_col_offset=82)], lineno=527, col_offset=20, end_lineno=527, end_col_offset=83), lineno=527, col_offset=12, end_lineno=527, end_col_offset=83)], handlers=[ExceptHandler(type=Attribute(value=Name(id='msgspec', ctx=Load(), lineno=528, col_offset=15, end_lineno=528, end_col_offset=22), attr='DecodeError', ctx=Load(), lineno=528, col_offset=15, end_lineno=528, end_col_offset=34), body=[Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=529, col_offset=12, end_lineno=529, end_col_offset=16), attr='_metrics', ctx=Store(), lineno=529, col_offset=12, end_lineno=529, end_col_offset=25)], value=Call(func=Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=529, col_offset=28, end_lineno=529, end_col_offset=32), attr='_metrics', ctx=Load(), lineno=529, col_offset=28, end_lineno=529, end_col_offset=41), attr='record_l2_miss', ctx=Load(), lineno=529, col_offset=28, end_lineno=529, end_col_offset=56), lineno=529, col_offset=28, end_lineno=529, end_col_offset=58), lineno=529, col_offset=12, end_lineno=529, end_col_offset=58), Expr(value=Await(value=Call(func=Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=530, col_offset=18, end_lineno=530, end_col_offset=22), attr='_redis', ctx=Load(), lineno=530, col_offset=18, end_lineno=530, end_col_offset=29), attr='delete', ctx=Load(), lineno=530, col_offset=18, end_lineno=530, end_col_offset=36), args=[Name(id='key', ctx=Load(), lineno=530, col_offset=37, end_lineno=530, end_col_offset=40)], lineno=530, col_offset=18, end_lineno=530, end_col_offset=41), lineno=530, col_offset=12, end_lineno=530, end_col_offset=41), lineno=530, col_offset=12, end_lineno=530, end_col_offset=41), Return(value=Constant(value=None, lineno=531, col_offset=19, end_lineno=531, end_col_offset=23), lineno=531, col_offset=12, end_lineno=531, end_col_offset=23)], lineno=528, col_offset=8, end_lineno=531, end_col_offset=23)], lineno=526, col_offset=8, end_lineno=531, end_col_offset=23), Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=533, col_offset=8, end_lineno=533, end_col_offset=12), attr='_metrics', ctx=Store(), lineno=533, col_offset=8, end_lineno=533, end_col_offset=21)], value=Call(func=Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=533, col_offset=24, end_lineno=533, end_col_offset=28), attr='_metrics', ctx=Load(), lineno=533, col_offset=24, end_lineno=533, end_col_offset=37), attr='record_l2_hit', ctx=Load(), lineno=533, col_offset=24, end_lineno=533, end_col_offset=51), lineno=533, col_offset=24, end_lineno=533, end_col_offset=53), lineno=533, col_offset=8, end_lineno=533, end_col_offset=53), Expr(value=Call(func=Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=534, col_offset=8, end_lineno=534, end_col_offset=12), attr='_l1', ctx=Load(), lineno=534, col_offset=8, end_lineno=534, end_col_offset=16), attr='set', ctx=Load(), lineno=534, col_offset=8, end_lineno=534, end_col_offset=20), args=[Name(id='session_id', ctx=Load(), lineno=534, col_offset=21, end_lineno=534, end_col_offset=31), Name(id='scope', ctx=Load(), lineno=534, col_offset=33, end_lineno=534, end_col_offset=38)], lineno=534, col_offset=8, end_lineno=534, end_col_offset=39), lineno=534, col_offset=8, end_lineno=534, end_col_offset=39), Return(value=Name(id='scope', ctx=Load(), lineno=535, col_offset=15, end_lineno=535, end_col_offset=20), lineno=535, col_offset=8, end_lineno=535, end_col_offset=20)], returns=BinOp(left=Name(id='ScopeIn', ctx=Load(), lineno=518, col_offset=55, end_lineno=518, end_col_offset=62), op=BitOr(), right=Constant(value=None, lineno=518, col_offset=65, end_lineno=518, end_col_offset=69), lineno=518, col_offset=55, end_lineno=518, end_col_offset=69), lineno=518, col_offset=4, end_lineno=535, end_col_offset=20)], lineno=378, col_offset=0, end_lineno=535, end_col_offset=20), Assign(targets=[Name(id='__all__', ctx=Store(), lineno=538, col_offset=0, end_lineno=538, end_col_offset=7)], value=List(elts=[Constant(value='AsyncSingleFlight', lineno=538, col_offset=11, end_lineno=538, end_col_offset=30), Constant(value='LRUCache', lineno=538, col_offset=32, end_lineno=538, end_col_offset=42), Constant(value='ScopeStore', lineno=538, col_offset=44, end_lineno=538, end_col_offset=56), Constant(value='ScopeStoreMetrics', lineno=538, col_offset=58, end_lineno=538, end_col_offset=77)], ctx=Load(), lineno=538, col_offset=10, end_lineno=538, end_col_offset=78), lineno=538, col_offset=0, end_lineno=538, end_col_offset=78)])