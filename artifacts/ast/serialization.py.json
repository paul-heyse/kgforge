Module(body=[Expr(value=Constant(value='Safe serialization helpers with schema validation and checksums.\n\nThis module provides JSON serialization with schema validation and SHA256\nchecksums to replace unsafe `pickle` usage. All serialized data is validated\nagainst JSON Schema 2020-12 before persistence.\n\nExamples\n--------\n>>> from pathlib import Path\n>>> from kgfoundry_common.serialization import serialize_json, deserialize_json\n>>> data = {"k1": 0.9, "b": 0.4, "N": 100}\n>>> schema_path = Path("schema/bm25_metadata.v1.json")\n>>> output_path = Path("/tmp/index.json")\n>>> checksum = serialize_json(data, schema_path, output_path)\n>>> loaded = deserialize_json(output_path, schema_path)\n>>> assert loaded == data\n', lineno=1, col_offset=0, end_lineno=17, end_col_offset=3), lineno=1, col_offset=0, end_lineno=17, end_col_offset=3), ImportFrom(module='__future__', names=[alias(name='annotations', lineno=21, col_offset=23, end_lineno=21, end_col_offset=34)], level=0, lineno=21, col_offset=0, end_lineno=21, end_col_offset=34), Import(names=[alias(name='hashlib', lineno=23, col_offset=7, end_lineno=23, end_col_offset=14)], lineno=23, col_offset=0, end_lineno=23, end_col_offset=14), Import(names=[alias(name='json', lineno=24, col_offset=7, end_lineno=24, end_col_offset=11)], lineno=24, col_offset=0, end_lineno=24, end_col_offset=11), ImportFrom(module='collections.abc', names=[alias(name='Mapping', lineno=25, col_offset=28, end_lineno=25, end_col_offset=35)], level=0, lineno=25, col_offset=0, end_lineno=25, end_col_offset=35), ImportFrom(module='pathlib', names=[alias(name='Path', lineno=26, col_offset=20, end_lineno=26, end_col_offset=24)], level=0, lineno=26, col_offset=0, end_lineno=26, end_col_offset=24), ImportFrom(module='typing', names=[alias(name='cast', lineno=27, col_offset=19, end_lineno=27, end_col_offset=23)], level=0, lineno=27, col_offset=0, end_lineno=27, end_col_offset=23), ImportFrom(module='kgfoundry_common.errors', names=[alias(name='DeserializationError', lineno=30, col_offset=4, end_lineno=30, end_col_offset=24), alias(name='SchemaValidationError', lineno=31, col_offset=4, end_lineno=31, end_col_offset=25), alias(name='SerializationError', lineno=32, col_offset=4, end_lineno=32, end_col_offset=22)], level=0, lineno=29, col_offset=0, end_lineno=33, end_col_offset=1), ImportFrom(module='kgfoundry_common.fs', names=[alias(name='atomic_write', lineno=34, col_offset=32, end_lineno=34, end_col_offset=44), alias(name='read_text', lineno=34, col_offset=46, end_lineno=34, end_col_offset=55), alias(name='write_text', lineno=34, col_offset=57, end_lineno=34, end_col_offset=67)], level=0, lineno=34, col_offset=0, end_lineno=34, end_col_offset=67), ImportFrom(module='kgfoundry_common.jsonschema_utils', names=[alias(name='SchemaError', lineno=36, col_offset=4, end_lineno=36, end_col_offset=15), alias(name='ValidationError', lineno=37, col_offset=4, end_lineno=37, end_col_offset=19)], level=0, lineno=35, col_offset=0, end_lineno=38, end_col_offset=1), ImportFrom(module='kgfoundry_common.jsonschema_utils', names=[alias(name='validate', asname='jsonschema_validate', lineno=40, col_offset=4, end_lineno=40, end_col_offset=35)], level=0, lineno=39, col_offset=0, end_lineno=41, end_col_offset=1), ImportFrom(module='kgfoundry_common.logging', names=[alias(name='get_logger', lineno=42, col_offset=37, end_lineno=42, end_col_offset=47)], level=0, lineno=42, col_offset=0, end_lineno=42, end_col_offset=47), ImportFrom(module='kgfoundry_common.navmap_loader', names=[alias(name='load_nav_metadata', lineno=43, col_offset=43, end_lineno=43, end_col_offset=60)], level=0, lineno=43, col_offset=0, end_lineno=43, end_col_offset=60), Assign(targets=[Name(id='JsonSchema', ctx=Store(), lineno=46, col_offset=0, end_lineno=46, end_col_offset=10)], value=Subscript(value=Name(id='Mapping', ctx=Load(), lineno=46, col_offset=13, end_lineno=46, end_col_offset=20), slice=Tuple(elts=[Name(id='str', ctx=Load(), lineno=46, col_offset=21, end_lineno=46, end_col_offset=24), Name(id='object', ctx=Load(), lineno=46, col_offset=26, end_lineno=46, end_col_offset=32)], ctx=Load(), lineno=46, col_offset=21, end_lineno=46, end_col_offset=32), ctx=Load(), lineno=46, col_offset=13, end_lineno=46, end_col_offset=33), lineno=46, col_offset=0, end_lineno=46, end_col_offset=33), Assign(targets=[Name(id='__all__', ctx=Store(), lineno=48, col_offset=0, end_lineno=48, end_col_offset=7)], value=List(elts=[Constant(value='compute_checksum', lineno=49, col_offset=4, end_lineno=49, end_col_offset=22), Constant(value='deserialize_json', lineno=50, col_offset=4, end_lineno=50, end_col_offset=22), Constant(value='serialize_json', lineno=51, col_offset=4, end_lineno=51, end_col_offset=20), Constant(value='validate_payload', lineno=52, col_offset=4, end_lineno=52, end_col_offset=22), Constant(value='verify_checksum', lineno=53, col_offset=4, end_lineno=53, end_col_offset=21)], ctx=Load(), lineno=48, col_offset=10, end_lineno=54, end_col_offset=1), lineno=48, col_offset=0, end_lineno=54, end_col_offset=1), Assign(targets=[Name(id='__navmap__', ctx=Store(), lineno=55, col_offset=0, end_lineno=55, end_col_offset=10)], value=Call(func=Name(id='load_nav_metadata', ctx=Load(), lineno=55, col_offset=13, end_lineno=55, end_col_offset=30), args=[Name(id='__name__', ctx=Load(), lineno=55, col_offset=31, end_lineno=55, end_col_offset=39), Call(func=Name(id='tuple', ctx=Load(), lineno=55, col_offset=41, end_lineno=55, end_col_offset=46), args=[Name(id='__all__', ctx=Load(), lineno=55, col_offset=47, end_lineno=55, end_col_offset=54)], lineno=55, col_offset=41, end_lineno=55, end_col_offset=55)], lineno=55, col_offset=13, end_lineno=55, end_col_offset=56), lineno=55, col_offset=0, end_lineno=55, end_col_offset=56), Assign(targets=[Name(id='logger', ctx=Store(), lineno=58, col_offset=0, end_lineno=58, end_col_offset=6)], value=Call(func=Name(id='get_logger', ctx=Load(), lineno=58, col_offset=9, end_lineno=58, end_col_offset=19), args=[Name(id='__name__', ctx=Load(), lineno=58, col_offset=20, end_lineno=58, end_col_offset=28)], lineno=58, col_offset=9, end_lineno=58, end_col_offset=29), lineno=58, col_offset=0, end_lineno=58, end_col_offset=29), AnnAssign(target=Name(id='_schema_cache', ctx=Store(), lineno=61, col_offset=0, end_lineno=61, end_col_offset=13), annotation=Subscript(value=Name(id='dict', ctx=Load(), lineno=61, col_offset=15, end_lineno=61, end_col_offset=19), slice=Tuple(elts=[Name(id='str', ctx=Load(), lineno=61, col_offset=20, end_lineno=61, end_col_offset=23), Subscript(value=Name(id='dict', ctx=Load(), lineno=61, col_offset=25, end_lineno=61, end_col_offset=29), slice=Tuple(elts=[Name(id='str', ctx=Load(), lineno=61, col_offset=30, end_lineno=61, end_col_offset=33), Name(id='object', ctx=Load(), lineno=61, col_offset=35, end_lineno=61, end_col_offset=41)], ctx=Load(), lineno=61, col_offset=30, end_lineno=61, end_col_offset=41), ctx=Load(), lineno=61, col_offset=25, end_lineno=61, end_col_offset=42)], ctx=Load(), lineno=61, col_offset=20, end_lineno=61, end_col_offset=42), ctx=Load(), lineno=61, col_offset=15, end_lineno=61, end_col_offset=43), value=Dict(lineno=61, col_offset=46, end_lineno=61, end_col_offset=48), simple=1, lineno=61, col_offset=0, end_lineno=61, end_col_offset=48), FunctionDef(name='_load_schema_by_path_str_impl', args=arguments(args=[arg(arg='schema_path_str', annotation=Name(id='str', ctx=Load(), lineno=64, col_offset=51, end_lineno=64, end_col_offset=54), lineno=64, col_offset=34, end_lineno=64, end_col_offset=54)]), body=[Expr(value=Constant(value='Load and parse a JSON Schema file with caching by string path.\n\n    This internal helper caches by string path to avoid lru_cache descriptor\n    typing issues with Path objects. Public API converts Path to string.\n\n    Parameters\n    ----------\n    schema_path_str : str\n        Path to JSON Schema 2020-12 file (as string).\n\n    Returns\n    -------\n    dict[str, object]\n        Parsed schema dictionary.\n\n    Raises\n    ------\n    FileNotFoundError\n        If schema file does not exist.\n    SchemaValidationError\n        If schema is invalid JSON or fails schema validation.\n    ', lineno=65, col_offset=4, end_lineno=86, end_col_offset=7), lineno=65, col_offset=4, end_lineno=86, end_col_offset=7), Assign(targets=[Name(id='schema_path', ctx=Store(), lineno=87, col_offset=4, end_lineno=87, end_col_offset=15)], value=Call(func=Name(id='Path', ctx=Load(), lineno=87, col_offset=18, end_lineno=87, end_col_offset=22), args=[Name(id='schema_path_str', ctx=Load(), lineno=87, col_offset=23, end_lineno=87, end_col_offset=38)], lineno=87, col_offset=18, end_lineno=87, end_col_offset=39), lineno=87, col_offset=4, end_lineno=87, end_col_offset=39), If(test=UnaryOp(op=Not(), operand=Call(func=Attribute(value=Name(id='schema_path', ctx=Load(), lineno=88, col_offset=11, end_lineno=88, end_col_offset=22), attr='exists', ctx=Load(), lineno=88, col_offset=11, end_lineno=88, end_col_offset=29), lineno=88, col_offset=11, end_lineno=88, end_col_offset=31), lineno=88, col_offset=7, end_lineno=88, end_col_offset=31), body=[Assign(targets=[Name(id='msg', ctx=Store(), lineno=89, col_offset=8, end_lineno=89, end_col_offset=11)], value=JoinedStr(values=[Constant(value='Schema file not found: ', lineno=89, col_offset=16, end_lineno=89, end_col_offset=39), FormattedValue(value=Name(id='schema_path', ctx=Load(), lineno=89, col_offset=40, end_lineno=89, end_col_offset=51), conversion=-1, lineno=89, col_offset=39, end_lineno=89, end_col_offset=52)], lineno=89, col_offset=14, end_lineno=89, end_col_offset=53), lineno=89, col_offset=8, end_lineno=89, end_col_offset=53), Raise(exc=Call(func=Name(id='FileNotFoundError', ctx=Load(), lineno=90, col_offset=14, end_lineno=90, end_col_offset=31), args=[Name(id='msg', ctx=Load(), lineno=90, col_offset=32, end_lineno=90, end_col_offset=35)], lineno=90, col_offset=14, end_lineno=90, end_col_offset=36), lineno=90, col_offset=8, end_lineno=90, end_col_offset=36)], lineno=88, col_offset=4, end_lineno=90, end_col_offset=36), Assign(targets=[Name(id='schema_text', ctx=Store(), lineno=91, col_offset=4, end_lineno=91, end_col_offset=15)], value=Call(func=Name(id='read_text', ctx=Load(), lineno=91, col_offset=18, end_lineno=91, end_col_offset=27), args=[Name(id='schema_path', ctx=Load(), lineno=91, col_offset=28, end_lineno=91, end_col_offset=39)], lineno=91, col_offset=18, end_lineno=91, end_col_offset=40), lineno=91, col_offset=4, end_lineno=91, end_col_offset=40), Try(body=[AnnAssign(target=Name(id='schema_raw', ctx=Store(), lineno=93, col_offset=8, end_lineno=93, end_col_offset=18), annotation=Name(id='object', ctx=Load(), lineno=93, col_offset=20, end_lineno=93, end_col_offset=26), value=Call(func=Attribute(value=Name(id='json', ctx=Load(), lineno=93, col_offset=29, end_lineno=93, end_col_offset=33), attr='loads', ctx=Load(), lineno=93, col_offset=29, end_lineno=93, end_col_offset=39), args=[Name(id='schema_text', ctx=Load(), lineno=93, col_offset=40, end_lineno=93, end_col_offset=51)], lineno=93, col_offset=29, end_lineno=93, end_col_offset=52), simple=1, lineno=93, col_offset=8, end_lineno=93, end_col_offset=52), If(test=UnaryOp(op=Not(), operand=Call(func=Name(id='isinstance', ctx=Load(), lineno=94, col_offset=15, end_lineno=94, end_col_offset=25), args=[Name(id='schema_raw', ctx=Load(), lineno=94, col_offset=26, end_lineno=94, end_col_offset=36), Name(id='dict', ctx=Load(), lineno=94, col_offset=38, end_lineno=94, end_col_offset=42)], lineno=94, col_offset=15, end_lineno=94, end_col_offset=43), lineno=94, col_offset=11, end_lineno=94, end_col_offset=43), body=[Assign(targets=[Name(id='msg', ctx=Store(), lineno=95, col_offset=12, end_lineno=95, end_col_offset=15)], value=JoinedStr(values=[Constant(value='Schema must be a JSON object at root, got ', lineno=95, col_offset=20, end_lineno=95, end_col_offset=62), FormattedValue(value=Attribute(value=Call(func=Name(id='type', ctx=Load(), lineno=95, col_offset=63, end_lineno=95, end_col_offset=67), args=[Name(id='schema_raw', ctx=Load(), lineno=95, col_offset=68, end_lineno=95, end_col_offset=78)], lineno=95, col_offset=63, end_lineno=95, end_col_offset=79), attr='__name__', ctx=Load(), lineno=95, col_offset=63, end_lineno=95, end_col_offset=88), conversion=-1, lineno=95, col_offset=62, end_lineno=95, end_col_offset=89)], lineno=95, col_offset=18, end_lineno=95, end_col_offset=90), lineno=95, col_offset=12, end_lineno=95, end_col_offset=90), Raise(exc=Call(func=Name(id='SchemaValidationError', ctx=Load(), lineno=96, col_offset=18, end_lineno=96, end_col_offset=39), args=[Name(id='msg', ctx=Load(), lineno=96, col_offset=40, end_lineno=96, end_col_offset=43)], lineno=96, col_offset=18, end_lineno=96, end_col_offset=44), lineno=96, col_offset=12, end_lineno=96, end_col_offset=44)], lineno=94, col_offset=8, end_lineno=96, end_col_offset=44), Assign(targets=[Name(id='schema_obj', ctx=Store(), lineno=97, col_offset=8, end_lineno=97, end_col_offset=18)], value=Call(func=Name(id='cast', ctx=Load(), lineno=97, col_offset=21, end_lineno=97, end_col_offset=25), args=[Constant(value='dict[str, object]', lineno=97, col_offset=26, end_lineno=97, end_col_offset=45), Name(id='schema_raw', ctx=Load(), lineno=97, col_offset=47, end_lineno=97, end_col_offset=57)], lineno=97, col_offset=21, end_lineno=97, end_col_offset=58), lineno=97, col_offset=8, end_lineno=97, end_col_offset=58)], handlers=[ExceptHandler(type=Attribute(value=Name(id='json', ctx=Load(), lineno=98, col_offset=11, end_lineno=98, end_col_offset=15), attr='JSONDecodeError', ctx=Load(), lineno=98, col_offset=11, end_lineno=98, end_col_offset=31), name='e', body=[Assign(targets=[Name(id='msg', ctx=Store(), lineno=99, col_offset=8, end_lineno=99, end_col_offset=11)], value=JoinedStr(values=[Constant(value='Failed to load schema from ', lineno=99, col_offset=16, end_lineno=99, end_col_offset=43), FormattedValue(value=Name(id='schema_path_str', ctx=Load(), lineno=99, col_offset=44, end_lineno=99, end_col_offset=59), conversion=-1, lineno=99, col_offset=43, end_lineno=99, end_col_offset=60), Constant(value=': ', lineno=99, col_offset=60, end_lineno=99, end_col_offset=62), FormattedValue(value=Name(id='e', ctx=Load(), lineno=99, col_offset=63, end_lineno=99, end_col_offset=64), conversion=-1, lineno=99, col_offset=62, end_lineno=99, end_col_offset=65)], lineno=99, col_offset=14, end_lineno=99, end_col_offset=66), lineno=99, col_offset=8, end_lineno=99, end_col_offset=66), Raise(exc=Call(func=Name(id='SchemaValidationError', ctx=Load(), lineno=100, col_offset=14, end_lineno=100, end_col_offset=35), args=[Name(id='msg', ctx=Load(), lineno=100, col_offset=36, end_lineno=100, end_col_offset=39)], lineno=100, col_offset=14, end_lineno=100, end_col_offset=40), cause=Name(id='e', ctx=Load(), lineno=100, col_offset=46, end_lineno=100, end_col_offset=47), lineno=100, col_offset=8, end_lineno=100, end_col_offset=47)], lineno=98, col_offset=4, end_lineno=100, end_col_offset=47)], orelse=[Return(value=Name(id='schema_obj', ctx=Load(), lineno=102, col_offset=15, end_lineno=102, end_col_offset=25), lineno=102, col_offset=8, end_lineno=102, end_col_offset=25)], lineno=92, col_offset=4, end_lineno=102, end_col_offset=25)], returns=Subscript(value=Name(id='dict', ctx=Load(), lineno=64, col_offset=59, end_lineno=64, end_col_offset=63), slice=Tuple(elts=[Name(id='str', ctx=Load(), lineno=64, col_offset=64, end_lineno=64, end_col_offset=67), Name(id='object', ctx=Load(), lineno=64, col_offset=69, end_lineno=64, end_col_offset=75)], ctx=Load(), lineno=64, col_offset=64, end_lineno=64, end_col_offset=75), ctx=Load(), lineno=64, col_offset=59, end_lineno=64, end_col_offset=76), lineno=64, col_offset=0, end_lineno=102, end_col_offset=25), FunctionDef(name='_load_schema_cached', args=arguments(args=[arg(arg='schema_path', annotation=Name(id='Path', ctx=Load(), lineno=105, col_offset=37, end_lineno=105, end_col_offset=41), lineno=105, col_offset=24, end_lineno=105, end_col_offset=41)]), body=[Expr(value=Constant(value='Load and parse a JSON Schema file with caching.\n\n    Uses an in-memory cache keyed by resolved path to avoid repeated I/O\n    for the same schema file. The cache persists for the lifetime of the\n    module.\n\n    Parameters\n    ----------\n    schema_path : Path\n        Path to JSON Schema 2020-12 file. Must exist and be readable.\n\n    Returns\n    -------\n    dict[str, object]\n        Parsed schema dictionary ready for validation.\n\n    Raises\n    ------\n    FileNotFoundError\n        If schema file does not exist.\n    SchemaValidationError\n        If schema is invalid JSON or fails schema validation.\n    ', lineno=106, col_offset=4, end_lineno=128, end_col_offset=7), lineno=106, col_offset=4, end_lineno=128, end_col_offset=7), If(test=UnaryOp(op=Not(), operand=Call(func=Attribute(value=Name(id='schema_path', ctx=Load(), lineno=129, col_offset=11, end_lineno=129, end_col_offset=22), attr='exists', ctx=Load(), lineno=129, col_offset=11, end_lineno=129, end_col_offset=29), lineno=129, col_offset=11, end_lineno=129, end_col_offset=31), lineno=129, col_offset=7, end_lineno=129, end_col_offset=31), body=[Assign(targets=[Name(id='msg', ctx=Store(), lineno=130, col_offset=8, end_lineno=130, end_col_offset=11)], value=JoinedStr(values=[Constant(value='Schema file not found: ', lineno=130, col_offset=16, end_lineno=130, end_col_offset=39), FormattedValue(value=Name(id='schema_path', ctx=Load(), lineno=130, col_offset=40, end_lineno=130, end_col_offset=51), conversion=-1, lineno=130, col_offset=39, end_lineno=130, end_col_offset=52)], lineno=130, col_offset=14, end_lineno=130, end_col_offset=53), lineno=130, col_offset=8, end_lineno=130, end_col_offset=53), Raise(exc=Call(func=Name(id='FileNotFoundError', ctx=Load(), lineno=131, col_offset=14, end_lineno=131, end_col_offset=31), args=[Name(id='msg', ctx=Load(), lineno=131, col_offset=32, end_lineno=131, end_col_offset=35)], lineno=131, col_offset=14, end_lineno=131, end_col_offset=36), lineno=131, col_offset=8, end_lineno=131, end_col_offset=36)], lineno=129, col_offset=4, end_lineno=131, end_col_offset=36), Assign(targets=[Name(id='schema_key', ctx=Store(), lineno=133, col_offset=4, end_lineno=133, end_col_offset=14)], value=Call(func=Name(id='str', ctx=Load(), lineno=133, col_offset=17, end_lineno=133, end_col_offset=20), args=[Call(func=Attribute(value=Name(id='schema_path', ctx=Load(), lineno=133, col_offset=21, end_lineno=133, end_col_offset=32), attr='resolve', ctx=Load(), lineno=133, col_offset=21, end_lineno=133, end_col_offset=40), lineno=133, col_offset=21, end_lineno=133, end_col_offset=42)], lineno=133, col_offset=17, end_lineno=133, end_col_offset=43), lineno=133, col_offset=4, end_lineno=133, end_col_offset=43), Assign(targets=[Name(id='cached', ctx=Store(), lineno=134, col_offset=4, end_lineno=134, end_col_offset=10)], value=Call(func=Attribute(value=Name(id='_schema_cache', ctx=Load(), lineno=134, col_offset=13, end_lineno=134, end_col_offset=26), attr='get', ctx=Load(), lineno=134, col_offset=13, end_lineno=134, end_col_offset=30), args=[Name(id='schema_key', ctx=Load(), lineno=134, col_offset=31, end_lineno=134, end_col_offset=41)], lineno=134, col_offset=13, end_lineno=134, end_col_offset=42), lineno=134, col_offset=4, end_lineno=134, end_col_offset=42), If(test=Compare(left=Name(id='cached', ctx=Load(), lineno=135, col_offset=7, end_lineno=135, end_col_offset=13), ops=[IsNot()], comparators=[Constant(value=None, lineno=135, col_offset=21, end_lineno=135, end_col_offset=25)], lineno=135, col_offset=7, end_lineno=135, end_col_offset=25), body=[Return(value=Name(id='cached', ctx=Load(), lineno=136, col_offset=15, end_lineno=136, end_col_offset=21), lineno=136, col_offset=8, end_lineno=136, end_col_offset=21)], lineno=135, col_offset=4, end_lineno=136, end_col_offset=21), Try(body=[Assign(targets=[Name(id='schema_obj', ctx=Store(), lineno=139, col_offset=8, end_lineno=139, end_col_offset=18)], value=Call(func=Name(id='_load_schema_by_path_str_impl', ctx=Load(), lineno=139, col_offset=21, end_lineno=139, end_col_offset=50), args=[Name(id='schema_key', ctx=Load(), lineno=139, col_offset=51, end_lineno=139, end_col_offset=61)], lineno=139, col_offset=21, end_lineno=139, end_col_offset=62), lineno=139, col_offset=8, end_lineno=139, end_col_offset=62)], handlers=[ExceptHandler(type=Name(id='SchemaValidationError', ctx=Load(), lineno=140, col_offset=11, end_lineno=140, end_col_offset=32), name='exc', body=[Assign(targets=[Name(id='msg', ctx=Store(), lineno=141, col_offset=8, end_lineno=141, end_col_offset=11)], value=JoinedStr(values=[Constant(value='Failed to load schema ', lineno=141, col_offset=16, end_lineno=141, end_col_offset=38), FormattedValue(value=Name(id='schema_path', ctx=Load(), lineno=141, col_offset=39, end_lineno=141, end_col_offset=50), conversion=-1, lineno=141, col_offset=38, end_lineno=141, end_col_offset=51), Constant(value=': ', lineno=141, col_offset=51, end_lineno=141, end_col_offset=53), FormattedValue(value=Name(id='exc', ctx=Load(), lineno=141, col_offset=54, end_lineno=141, end_col_offset=57), conversion=-1, lineno=141, col_offset=53, end_lineno=141, end_col_offset=58)], lineno=141, col_offset=14, end_lineno=141, end_col_offset=59), lineno=141, col_offset=8, end_lineno=141, end_col_offset=59), Raise(exc=Call(func=Name(id='SchemaValidationError', ctx=Load(), lineno=142, col_offset=14, end_lineno=142, end_col_offset=35), args=[Name(id='msg', ctx=Load(), lineno=142, col_offset=36, end_lineno=142, end_col_offset=39)], lineno=142, col_offset=14, end_lineno=142, end_col_offset=40), cause=Name(id='exc', ctx=Load(), lineno=142, col_offset=46, end_lineno=142, end_col_offset=49), lineno=142, col_offset=8, end_lineno=142, end_col_offset=49)], lineno=140, col_offset=4, end_lineno=142, end_col_offset=49)], lineno=138, col_offset=4, end_lineno=142, end_col_offset=49), Assign(targets=[Subscript(value=Name(id='_schema_cache', ctx=Load(), lineno=143, col_offset=4, end_lineno=143, end_col_offset=17), slice=Name(id='schema_key', ctx=Load(), lineno=143, col_offset=18, end_lineno=143, end_col_offset=28), ctx=Store(), lineno=143, col_offset=4, end_lineno=143, end_col_offset=29)], value=Name(id='schema_obj', ctx=Load(), lineno=143, col_offset=32, end_lineno=143, end_col_offset=42), lineno=143, col_offset=4, end_lineno=143, end_col_offset=42), Return(value=Name(id='schema_obj', ctx=Load(), lineno=144, col_offset=11, end_lineno=144, end_col_offset=21), lineno=144, col_offset=4, end_lineno=144, end_col_offset=21)], returns=Subscript(value=Name(id='dict', ctx=Load(), lineno=105, col_offset=46, end_lineno=105, end_col_offset=50), slice=Tuple(elts=[Name(id='str', ctx=Load(), lineno=105, col_offset=51, end_lineno=105, end_col_offset=54), Name(id='object', ctx=Load(), lineno=105, col_offset=56, end_lineno=105, end_col_offset=62)], ctx=Load(), lineno=105, col_offset=51, end_lineno=105, end_col_offset=62), ctx=Load(), lineno=105, col_offset=46, end_lineno=105, end_col_offset=63), lineno=105, col_offset=0, end_lineno=144, end_col_offset=21), FunctionDef(name='validate_payload', args=arguments(args=[arg(arg='payload', annotation=Subscript(value=Name(id='Mapping', ctx=Load(), lineno=148, col_offset=30, end_lineno=148, end_col_offset=37), slice=Tuple(elts=[Name(id='str', ctx=Load(), lineno=148, col_offset=38, end_lineno=148, end_col_offset=41), Name(id='object', ctx=Load(), lineno=148, col_offset=43, end_lineno=148, end_col_offset=49)], ctx=Load(), lineno=148, col_offset=38, end_lineno=148, end_col_offset=49), ctx=Load(), lineno=148, col_offset=30, end_lineno=148, end_col_offset=50), lineno=148, col_offset=21, end_lineno=148, end_col_offset=50), arg(arg='schema_path', annotation=Name(id='Path', ctx=Load(), lineno=148, col_offset=65, end_lineno=148, end_col_offset=69), lineno=148, col_offset=52, end_lineno=148, end_col_offset=69)]), body=[Expr(value=Constant(value='Validate a payload against a JSON Schema 2020-12.\n\n    Loads the schema (with caching), validates the payload against it, and\n    raises SchemaValidationError if validation fails. Used for validating\n    JSON-serializable data structures before persistence.\n\n    Parameters\n    ----------\n    payload : Mapping[str, object]\n        Payload to validate. Must be JSON-serializable and conform to the\n        schema structure (dict, list, or primitive types).\n    schema_path : Path\n        Path to JSON Schema 2020-12 file. Must exist and be readable.\n\n    Raises\n    ------\n    FileNotFoundError\n        If schema file does not exist.\n    SchemaValidationError\n        If payload does not match schema constraints or if the schema\n        itself is invalid.\n\n    Examples\n    --------\n    >>> from pathlib import Path\n    >>> import tempfile\n    >>> with tempfile.TemporaryDirectory() as tmpdir:\n    ...     tmp = Path(tmpdir)\n    ...     schema = tmp / "schema.json"\n    ...     schema.write_text(\'{"type": "object", "properties": {"k1": {"type": "number"}}}\')\n    ...     validate_payload({"k1": 0.9}, schema)\n    ...     validate_payload({"k1": "invalid"}, schema)  # doctest: +SKIP\n    SchemaValidationError: Schema validation failed\n    ', lineno=149, col_offset=4, end_lineno=182, end_col_offset=7), lineno=149, col_offset=4, end_lineno=182, end_col_offset=7), If(test=UnaryOp(op=Not(), operand=Call(func=Attribute(value=Name(id='schema_path', ctx=Load(), lineno=183, col_offset=11, end_lineno=183, end_col_offset=22), attr='exists', ctx=Load(), lineno=183, col_offset=11, end_lineno=183, end_col_offset=29), lineno=183, col_offset=11, end_lineno=183, end_col_offset=31), lineno=183, col_offset=7, end_lineno=183, end_col_offset=31), body=[Assign(targets=[Name(id='msg', ctx=Store(), lineno=184, col_offset=8, end_lineno=184, end_col_offset=11)], value=JoinedStr(values=[Constant(value='Schema file not found: ', lineno=184, col_offset=16, end_lineno=184, end_col_offset=39), FormattedValue(value=Name(id='schema_path', ctx=Load(), lineno=184, col_offset=40, end_lineno=184, end_col_offset=51), conversion=-1, lineno=184, col_offset=39, end_lineno=184, end_col_offset=52)], lineno=184, col_offset=14, end_lineno=184, end_col_offset=53), lineno=184, col_offset=8, end_lineno=184, end_col_offset=53), Raise(exc=Call(func=Name(id='FileNotFoundError', ctx=Load(), lineno=185, col_offset=14, end_lineno=185, end_col_offset=31), args=[Name(id='msg', ctx=Load(), lineno=185, col_offset=32, end_lineno=185, end_col_offset=35)], lineno=185, col_offset=14, end_lineno=185, end_col_offset=36), lineno=185, col_offset=8, end_lineno=185, end_col_offset=36)], lineno=183, col_offset=4, end_lineno=185, end_col_offset=36), Assign(targets=[Name(id='schema_obj', ctx=Store(), lineno=187, col_offset=4, end_lineno=187, end_col_offset=14)], value=Call(func=Name(id='_load_schema_cached', ctx=Load(), lineno=187, col_offset=17, end_lineno=187, end_col_offset=36), args=[Name(id='schema_path', ctx=Load(), lineno=187, col_offset=37, end_lineno=187, end_col_offset=48)], lineno=187, col_offset=17, end_lineno=187, end_col_offset=49), lineno=187, col_offset=4, end_lineno=187, end_col_offset=49), Try(body=[Expr(value=Call(func=Name(id='jsonschema_validate', ctx=Load(), lineno=189, col_offset=8, end_lineno=189, end_col_offset=27), keywords=[keyword(arg='instance', value=Name(id='payload', ctx=Load(), lineno=189, col_offset=37, end_lineno=189, end_col_offset=44), lineno=189, col_offset=28, end_lineno=189, end_col_offset=44), keyword(arg='schema', value=Name(id='schema_obj', ctx=Load(), lineno=189, col_offset=53, end_lineno=189, end_col_offset=63), lineno=189, col_offset=46, end_lineno=189, end_col_offset=63)], lineno=189, col_offset=8, end_lineno=189, end_col_offset=64), lineno=189, col_offset=8, end_lineno=189, end_col_offset=64)], handlers=[ExceptHandler(type=Name(id='ValidationError', ctx=Load(), lineno=190, col_offset=11, end_lineno=190, end_col_offset=26), name='exc', body=[Assign(targets=[Name(id='msg', ctx=Store(), lineno=191, col_offset=8, end_lineno=191, end_col_offset=11)], value=JoinedStr(values=[Constant(value='Schema validation failed: ', lineno=191, col_offset=16, end_lineno=191, end_col_offset=42), FormattedValue(value=Name(id='exc', ctx=Load(), lineno=191, col_offset=43, end_lineno=191, end_col_offset=46), conversion=-1, lineno=191, col_offset=42, end_lineno=191, end_col_offset=47)], lineno=191, col_offset=14, end_lineno=191, end_col_offset=48), lineno=191, col_offset=8, end_lineno=191, end_col_offset=48), Raise(exc=Call(func=Name(id='SchemaValidationError', ctx=Load(), lineno=192, col_offset=14, end_lineno=192, end_col_offset=35), args=[Name(id='msg', ctx=Load(), lineno=192, col_offset=36, end_lineno=192, end_col_offset=39)], lineno=192, col_offset=14, end_lineno=192, end_col_offset=40), cause=Name(id='exc', ctx=Load(), lineno=192, col_offset=46, end_lineno=192, end_col_offset=49), lineno=192, col_offset=8, end_lineno=192, end_col_offset=49)], lineno=190, col_offset=4, end_lineno=192, end_col_offset=49), ExceptHandler(type=Name(id='SchemaError', ctx=Load(), lineno=193, col_offset=11, end_lineno=193, end_col_offset=22), name='exc', body=[Assign(targets=[Name(id='msg', ctx=Store(), lineno=194, col_offset=8, end_lineno=194, end_col_offset=11)], value=JoinedStr(values=[Constant(value='Invalid schema: ', lineno=194, col_offset=16, end_lineno=194, end_col_offset=32), FormattedValue(value=Name(id='exc', ctx=Load(), lineno=194, col_offset=33, end_lineno=194, end_col_offset=36), conversion=-1, lineno=194, col_offset=32, end_lineno=194, end_col_offset=37)], lineno=194, col_offset=14, end_lineno=194, end_col_offset=38), lineno=194, col_offset=8, end_lineno=194, end_col_offset=38), Raise(exc=Call(func=Name(id='SchemaValidationError', ctx=Load(), lineno=195, col_offset=14, end_lineno=195, end_col_offset=35), args=[Name(id='msg', ctx=Load(), lineno=195, col_offset=36, end_lineno=195, end_col_offset=39)], lineno=195, col_offset=14, end_lineno=195, end_col_offset=40), cause=Name(id='exc', ctx=Load(), lineno=195, col_offset=46, end_lineno=195, end_col_offset=49), lineno=195, col_offset=8, end_lineno=195, end_col_offset=49)], lineno=193, col_offset=4, end_lineno=195, end_col_offset=49)], lineno=188, col_offset=4, end_lineno=195, end_col_offset=49)], returns=Constant(value=None, lineno=148, col_offset=74, end_lineno=148, end_col_offset=78), lineno=148, col_offset=0, end_lineno=195, end_col_offset=49), FunctionDef(name='compute_checksum', args=arguments(args=[arg(arg='data', annotation=Name(id='bytes', ctx=Load(), lineno=199, col_offset=27, end_lineno=199, end_col_offset=32), lineno=199, col_offset=21, end_lineno=199, end_col_offset=32)]), body=[Expr(value=Constant(value='Compute SHA256 checksum of binary data.\n\n    Computes the SHA256 hash of the input bytes and returns it as a\n    hexadecimal string. Used for data integrity verification.\n\n    Parameters\n    ----------\n    data : bytes\n        Binary data to checksum.\n\n    Returns\n    -------\n    str\n        Hexadecimal SHA256 checksum (64 characters, lowercase).\n\n    Examples\n    --------\n    >>> checksum = compute_checksum(b"test data")\n    >>> len(checksum) == 64\n    True\n    >>> checksum.startswith("9")\n    True\n    ', lineno=200, col_offset=4, end_lineno=222, end_col_offset=7), lineno=200, col_offset=4, end_lineno=222, end_col_offset=7), Return(value=Call(func=Attribute(value=Call(func=Attribute(value=Name(id='hashlib', ctx=Load(), lineno=223, col_offset=11, end_lineno=223, end_col_offset=18), attr='sha256', ctx=Load(), lineno=223, col_offset=11, end_lineno=223, end_col_offset=25), args=[Name(id='data', ctx=Load(), lineno=223, col_offset=26, end_lineno=223, end_col_offset=30)], lineno=223, col_offset=11, end_lineno=223, end_col_offset=31), attr='hexdigest', ctx=Load(), lineno=223, col_offset=11, end_lineno=223, end_col_offset=41), lineno=223, col_offset=11, end_lineno=223, end_col_offset=43), lineno=223, col_offset=4, end_lineno=223, end_col_offset=43)], returns=Name(id='str', ctx=Load(), lineno=199, col_offset=37, end_lineno=199, end_col_offset=40), lineno=199, col_offset=0, end_lineno=223, end_col_offset=43), FunctionDef(name='verify_checksum', args=arguments(args=[arg(arg='data', annotation=Name(id='bytes', ctx=Load(), lineno=227, col_offset=26, end_lineno=227, end_col_offset=31), lineno=227, col_offset=20, end_lineno=227, end_col_offset=31), arg(arg='expected', annotation=Name(id='str', ctx=Load(), lineno=227, col_offset=43, end_lineno=227, end_col_offset=46), lineno=227, col_offset=33, end_lineno=227, end_col_offset=46)]), body=[Expr(value=Constant(value='Verify SHA256 checksum matches expected value.\n\n    Computes the SHA256 checksum of the data and compares it to the expected\n    value. Raises an exception if they do not match.\n\n    Parameters\n    ----------\n    data : bytes\n        Binary data to verify.\n    expected : str\n        Expected hexadecimal SHA256 checksum (64 characters).\n\n    Raises\n    ------\n    SerializationError\n        If computed checksum does not match expected value. The error message\n        includes truncated checksums for debugging.\n\n    Examples\n    --------\n    >>> verify_checksum(b"test", compute_checksum(b"test"))\n    >>> verify_checksum(b"wrong", compute_checksum(b"test"))  # doctest: +SKIP\n    SerializationError: Checksum mismatch\n    ', lineno=228, col_offset=4, end_lineno=251, end_col_offset=7), lineno=228, col_offset=4, end_lineno=251, end_col_offset=7), Assign(targets=[Name(id='actual', ctx=Store(), lineno=252, col_offset=4, end_lineno=252, end_col_offset=10)], value=Call(func=Name(id='compute_checksum', ctx=Load(), lineno=252, col_offset=13, end_lineno=252, end_col_offset=29), args=[Name(id='data', ctx=Load(), lineno=252, col_offset=30, end_lineno=252, end_col_offset=34)], lineno=252, col_offset=13, end_lineno=252, end_col_offset=35), lineno=252, col_offset=4, end_lineno=252, end_col_offset=35), If(test=Compare(left=Name(id='actual', ctx=Load(), lineno=253, col_offset=7, end_lineno=253, end_col_offset=13), ops=[NotEq()], comparators=[Name(id='expected', ctx=Load(), lineno=253, col_offset=17, end_lineno=253, end_col_offset=25)], lineno=253, col_offset=7, end_lineno=253, end_col_offset=25), body=[Assign(targets=[Name(id='msg', ctx=Store(), lineno=254, col_offset=8, end_lineno=254, end_col_offset=11)], value=JoinedStr(values=[Constant(value='Checksum mismatch: expected ', lineno=254, col_offset=16, end_lineno=254, end_col_offset=44), FormattedValue(value=Subscript(value=Name(id='expected', ctx=Load(), lineno=254, col_offset=45, end_lineno=254, end_col_offset=53), slice=Slice(upper=Constant(value=16, lineno=254, col_offset=55, end_lineno=254, end_col_offset=57), lineno=254, col_offset=54, end_lineno=254, end_col_offset=57), ctx=Load(), lineno=254, col_offset=45, end_lineno=254, end_col_offset=58), conversion=-1, lineno=254, col_offset=44, end_lineno=254, end_col_offset=59), Constant(value='..., got ', lineno=254, col_offset=59, end_lineno=254, end_col_offset=68), FormattedValue(value=Subscript(value=Name(id='actual', ctx=Load(), lineno=254, col_offset=69, end_lineno=254, end_col_offset=75), slice=Slice(upper=Constant(value=16, lineno=254, col_offset=77, end_lineno=254, end_col_offset=79), lineno=254, col_offset=76, end_lineno=254, end_col_offset=79), ctx=Load(), lineno=254, col_offset=69, end_lineno=254, end_col_offset=80), conversion=-1, lineno=254, col_offset=68, end_lineno=254, end_col_offset=81), Constant(value='...', lineno=254, col_offset=81, end_lineno=254, end_col_offset=84)], lineno=254, col_offset=14, end_lineno=254, end_col_offset=85), lineno=254, col_offset=8, end_lineno=254, end_col_offset=85), Raise(exc=Call(func=Name(id='SerializationError', ctx=Load(), lineno=255, col_offset=14, end_lineno=255, end_col_offset=32), args=[Name(id='msg', ctx=Load(), lineno=255, col_offset=33, end_lineno=255, end_col_offset=36)], lineno=255, col_offset=14, end_lineno=255, end_col_offset=37), lineno=255, col_offset=8, end_lineno=255, end_col_offset=37)], lineno=253, col_offset=4, end_lineno=255, end_col_offset=37)], returns=Constant(value=None, lineno=227, col_offset=51, end_lineno=227, end_col_offset=55), lineno=227, col_offset=0, end_lineno=255, end_col_offset=37), FunctionDef(name='serialize_json', args=arguments(args=[arg(arg='obj', annotation=Name(id='object', ctx=Load(), lineno=260, col_offset=9, end_lineno=260, end_col_offset=15), lineno=260, col_offset=4, end_lineno=260, end_col_offset=15), arg(arg='schema_path', annotation=Name(id='Path', ctx=Load(), lineno=261, col_offset=17, end_lineno=261, end_col_offset=21), lineno=261, col_offset=4, end_lineno=261, end_col_offset=21), arg(arg='output_path', annotation=Name(id='Path', ctx=Load(), lineno=262, col_offset=17, end_lineno=262, end_col_offset=21), lineno=262, col_offset=4, end_lineno=262, end_col_offset=21)], kwonlyargs=[arg(arg='include_checksum', annotation=Name(id='bool', ctx=Load(), lineno=264, col_offset=22, end_lineno=264, end_col_offset=26), lineno=264, col_offset=4, end_lineno=264, end_col_offset=26), arg(arg='indent', annotation=BinOp(left=Name(id='int', ctx=Load(), lineno=265, col_offset=12, end_lineno=265, end_col_offset=15), op=BitOr(), right=Constant(value=None, lineno=265, col_offset=18, end_lineno=265, end_col_offset=22), lineno=265, col_offset=12, end_lineno=265, end_col_offset=22), lineno=265, col_offset=4, end_lineno=265, end_col_offset=22)], kw_defaults=[Constant(value=True, lineno=264, col_offset=29, end_lineno=264, end_col_offset=33), Constant(value=2, lineno=265, col_offset=25, end_lineno=265, end_col_offset=26)]), body=[Expr(value=Constant(value='Serialize object to JSON with schema validation and optional checksum.\n\n    Serializes a Python object to JSON format, validates it against the\n    provided JSON Schema 2020-12, and optionally writes a SHA256 checksum\n    file alongside the JSON output. Uses atomic writes to prevent corruption.\n\n    Parameters\n    ----------\n    obj : object\n        Python object to serialize. Must be JSON-serializable (dict, list,\n        str, int, float, bool, None, or nested combinations).\n    schema_path : Path\n        Path to JSON Schema 2020-12 file for validation. Must exist.\n    output_path : Path\n        Output file path for JSON data. Parent directory must exist or be\n        creatable.\n    include_checksum : bool, optional\n        If True, write a `.sha256` checksum file alongside the JSON file.\n        Defaults to True.\n    indent : int | None, optional\n        JSON indentation level. Use None for compact (minified) output.\n        Defaults to 2.\n\n    Returns\n    -------\n    str\n        SHA256 checksum of the serialized JSON (hexadecimal, 64 characters).\n        Returns the checksum even if include_checksum=False.\n\n    Raises\n    ------\n    SerializationError\n        If JSON serialization fails or file write fails.\n    SchemaValidationError\n        If the object does not conform to the schema.\n    FileNotFoundError\n        If schema file does not exist.\n\n    Examples\n    --------\n    >>> from pathlib import Path\n    >>> import tempfile\n    >>> with tempfile.TemporaryDirectory() as tmpdir:\n    ...     tmp = Path(tmpdir)\n    ...     schema = tmp / "schema.json"\n    ...     schema.write_text(\'{"type": "object", "properties": {"k1": {"type": "number"}}}\')\n    ...     data = {"k1": 0.9}\n    ...     output = tmp / "data.json"\n    ...     checksum = serialize_json(data, schema, output)\n    ...     assert len(checksum) == 64\n    ...     assert output.exists()\n    ', lineno=267, col_offset=4, end_lineno=318, end_col_offset=7), lineno=267, col_offset=4, end_lineno=318, end_col_offset=7), If(test=UnaryOp(op=Not(), operand=Call(func=Attribute(value=Name(id='schema_path', ctx=Load(), lineno=319, col_offset=11, end_lineno=319, end_col_offset=22), attr='exists', ctx=Load(), lineno=319, col_offset=11, end_lineno=319, end_col_offset=29), lineno=319, col_offset=11, end_lineno=319, end_col_offset=31), lineno=319, col_offset=7, end_lineno=319, end_col_offset=31), body=[Assign(targets=[Name(id='msg', ctx=Store(), lineno=320, col_offset=8, end_lineno=320, end_col_offset=11)], value=JoinedStr(values=[Constant(value='Schema file not found: ', lineno=320, col_offset=16, end_lineno=320, end_col_offset=39), FormattedValue(value=Name(id='schema_path', ctx=Load(), lineno=320, col_offset=40, end_lineno=320, end_col_offset=51), conversion=-1, lineno=320, col_offset=39, end_lineno=320, end_col_offset=52)], lineno=320, col_offset=14, end_lineno=320, end_col_offset=53), lineno=320, col_offset=8, end_lineno=320, end_col_offset=53), Raise(exc=Call(func=Name(id='FileNotFoundError', ctx=Load(), lineno=321, col_offset=14, end_lineno=321, end_col_offset=31), args=[Name(id='msg', ctx=Load(), lineno=321, col_offset=32, end_lineno=321, end_col_offset=35)], lineno=321, col_offset=14, end_lineno=321, end_col_offset=36), lineno=321, col_offset=8, end_lineno=321, end_col_offset=36)], lineno=319, col_offset=4, end_lineno=321, end_col_offset=36), Try(body=[If(test=Call(func=Name(id='isinstance', ctx=Load(), lineno=324, col_offset=11, end_lineno=324, end_col_offset=21), args=[Name(id='obj', ctx=Load(), lineno=324, col_offset=22, end_lineno=324, end_col_offset=25), Name(id='Mapping', ctx=Load(), lineno=324, col_offset=27, end_lineno=324, end_col_offset=34)], lineno=324, col_offset=11, end_lineno=324, end_col_offset=35), body=[Expr(value=Call(func=Name(id='validate_payload', ctx=Load(), lineno=325, col_offset=12, end_lineno=325, end_col_offset=28), args=[Name(id='obj', ctx=Load(), lineno=325, col_offset=29, end_lineno=325, end_col_offset=32), Name(id='schema_path', ctx=Load(), lineno=325, col_offset=34, end_lineno=325, end_col_offset=45)], lineno=325, col_offset=12, end_lineno=325, end_col_offset=46), lineno=325, col_offset=12, end_lineno=325, end_col_offset=46)], orelse=[Assign(targets=[Name(id='schema_obj', ctx=Store(), lineno=327, col_offset=12, end_lineno=327, end_col_offset=22)], value=Call(func=Name(id='_load_schema_cached', ctx=Load(), lineno=327, col_offset=25, end_lineno=327, end_col_offset=44), args=[Name(id='schema_path', ctx=Load(), lineno=327, col_offset=45, end_lineno=327, end_col_offset=56)], lineno=327, col_offset=25, end_lineno=327, end_col_offset=57), lineno=327, col_offset=12, end_lineno=327, end_col_offset=57), Try(body=[Expr(value=Call(func=Name(id='jsonschema_validate', ctx=Load(), lineno=329, col_offset=16, end_lineno=329, end_col_offset=35), keywords=[keyword(arg='instance', value=Name(id='obj', ctx=Load(), lineno=329, col_offset=45, end_lineno=329, end_col_offset=48), lineno=329, col_offset=36, end_lineno=329, end_col_offset=48), keyword(arg='schema', value=Name(id='schema_obj', ctx=Load(), lineno=329, col_offset=57, end_lineno=329, end_col_offset=67), lineno=329, col_offset=50, end_lineno=329, end_col_offset=67)], lineno=329, col_offset=16, end_lineno=329, end_col_offset=68), lineno=329, col_offset=16, end_lineno=329, end_col_offset=68)], handlers=[ExceptHandler(type=Name(id='ValidationError', ctx=Load(), lineno=330, col_offset=19, end_lineno=330, end_col_offset=34), name='exc', body=[Assign(targets=[Name(id='msg', ctx=Store(), lineno=331, col_offset=16, end_lineno=331, end_col_offset=19)], value=JoinedStr(values=[Constant(value='Schema validation failed: ', lineno=331, col_offset=24, end_lineno=331, end_col_offset=50), FormattedValue(value=Name(id='exc', ctx=Load(), lineno=331, col_offset=51, end_lineno=331, end_col_offset=54), conversion=-1, lineno=331, col_offset=50, end_lineno=331, end_col_offset=55)], lineno=331, col_offset=22, end_lineno=331, end_col_offset=56), lineno=331, col_offset=16, end_lineno=331, end_col_offset=56), Raise(exc=Call(func=Name(id='SchemaValidationError', ctx=Load(), lineno=332, col_offset=22, end_lineno=332, end_col_offset=43), args=[Name(id='msg', ctx=Load(), lineno=332, col_offset=44, end_lineno=332, end_col_offset=47)], lineno=332, col_offset=22, end_lineno=332, end_col_offset=48), cause=Name(id='exc', ctx=Load(), lineno=332, col_offset=54, end_lineno=332, end_col_offset=57), lineno=332, col_offset=16, end_lineno=332, end_col_offset=57)], lineno=330, col_offset=12, end_lineno=332, end_col_offset=57)], lineno=328, col_offset=12, end_lineno=332, end_col_offset=57)], lineno=324, col_offset=8, end_lineno=332, end_col_offset=57)], handlers=[ExceptHandler(type=Name(id='SchemaValidationError', ctx=Load(), lineno=333, col_offset=11, end_lineno=333, end_col_offset=32), name='exc', body=[Assign(targets=[Name(id='msg', ctx=Store(), lineno=334, col_offset=8, end_lineno=334, end_col_offset=11)], value=JoinedStr(values=[Constant(value='Schema validation failed for payload written to ', lineno=334, col_offset=16, end_lineno=334, end_col_offset=64), FormattedValue(value=Name(id='output_path', ctx=Load(), lineno=334, col_offset=65, end_lineno=334, end_col_offset=76), conversion=-1, lineno=334, col_offset=64, end_lineno=334, end_col_offset=77), Constant(value=': ', lineno=334, col_offset=77, end_lineno=334, end_col_offset=79), FormattedValue(value=Name(id='exc', ctx=Load(), lineno=334, col_offset=80, end_lineno=334, end_col_offset=83), conversion=-1, lineno=334, col_offset=79, end_lineno=334, end_col_offset=84)], lineno=334, col_offset=14, end_lineno=334, end_col_offset=85), lineno=334, col_offset=8, end_lineno=334, end_col_offset=85), Raise(exc=Call(func=Name(id='SchemaValidationError', ctx=Load(), lineno=335, col_offset=14, end_lineno=335, end_col_offset=35), args=[Name(id='msg', ctx=Load(), lineno=335, col_offset=36, end_lineno=335, end_col_offset=39)], lineno=335, col_offset=14, end_lineno=335, end_col_offset=40), cause=Name(id='exc', ctx=Load(), lineno=335, col_offset=46, end_lineno=335, end_col_offset=49), lineno=335, col_offset=8, end_lineno=335, end_col_offset=49)], lineno=333, col_offset=4, end_lineno=335, end_col_offset=49)], lineno=323, col_offset=4, end_lineno=335, end_col_offset=49), Try(body=[AnnAssign(target=Name(id='json_text', ctx=Store(), lineno=338, col_offset=8, end_lineno=338, end_col_offset=17), annotation=Name(id='str', ctx=Load(), lineno=338, col_offset=19, end_lineno=338, end_col_offset=22), value=Call(func=Attribute(value=Name(id='json', ctx=Load(), lineno=338, col_offset=25, end_lineno=338, end_col_offset=29), attr='dumps', ctx=Load(), lineno=338, col_offset=25, end_lineno=338, end_col_offset=35), args=[Name(id='obj', ctx=Load(), lineno=338, col_offset=36, end_lineno=338, end_col_offset=39)], keywords=[keyword(arg='indent', value=Name(id='indent', ctx=Load(), lineno=338, col_offset=48, end_lineno=338, end_col_offset=54), lineno=338, col_offset=41, end_lineno=338, end_col_offset=54), keyword(arg='ensure_ascii', value=Constant(value=False, lineno=338, col_offset=69, end_lineno=338, end_col_offset=74), lineno=338, col_offset=56, end_lineno=338, end_col_offset=74)], lineno=338, col_offset=25, end_lineno=338, end_col_offset=75), simple=1, lineno=338, col_offset=8, end_lineno=338, end_col_offset=75)], handlers=[ExceptHandler(type=Tuple(elts=[Name(id='TypeError', ctx=Load(), lineno=339, col_offset=12, end_lineno=339, end_col_offset=21), Name(id='ValueError', ctx=Load(), lineno=339, col_offset=23, end_lineno=339, end_col_offset=33)], ctx=Load(), lineno=339, col_offset=11, end_lineno=339, end_col_offset=34), name='exc', body=[Assign(targets=[Name(id='msg', ctx=Store(), lineno=340, col_offset=8, end_lineno=340, end_col_offset=11)], value=JoinedStr(values=[Constant(value='Failed to serialize object to JSON: ', lineno=340, col_offset=16, end_lineno=340, end_col_offset=52), FormattedValue(value=Name(id='exc', ctx=Load(), lineno=340, col_offset=53, end_lineno=340, end_col_offset=56), conversion=-1, lineno=340, col_offset=52, end_lineno=340, end_col_offset=57)], lineno=340, col_offset=14, end_lineno=340, end_col_offset=58), lineno=340, col_offset=8, end_lineno=340, end_col_offset=58), Raise(exc=Call(func=Name(id='SerializationError', ctx=Load(), lineno=341, col_offset=14, end_lineno=341, end_col_offset=32), args=[Name(id='msg', ctx=Load(), lineno=341, col_offset=33, end_lineno=341, end_col_offset=36)], lineno=341, col_offset=14, end_lineno=341, end_col_offset=37), cause=Name(id='exc', ctx=Load(), lineno=341, col_offset=43, end_lineno=341, end_col_offset=46), lineno=341, col_offset=8, end_lineno=341, end_col_offset=46)], lineno=339, col_offset=4, end_lineno=341, end_col_offset=46)], lineno=337, col_offset=4, end_lineno=341, end_col_offset=46), Assign(targets=[Name(id='json_bytes', ctx=Store(), lineno=343, col_offset=4, end_lineno=343, end_col_offset=14)], value=Call(func=Attribute(value=Name(id='json_text', ctx=Load(), lineno=343, col_offset=17, end_lineno=343, end_col_offset=26), attr='encode', ctx=Load(), lineno=343, col_offset=17, end_lineno=343, end_col_offset=33), args=[Constant(value='utf-8', lineno=343, col_offset=34, end_lineno=343, end_col_offset=41)], lineno=343, col_offset=17, end_lineno=343, end_col_offset=42), lineno=343, col_offset=4, end_lineno=343, end_col_offset=42), Assign(targets=[Name(id='checksum', ctx=Store(), lineno=344, col_offset=4, end_lineno=344, end_col_offset=12)], value=Call(func=Name(id='compute_checksum', ctx=Load(), lineno=344, col_offset=15, end_lineno=344, end_col_offset=31), args=[Name(id='json_bytes', ctx=Load(), lineno=344, col_offset=32, end_lineno=344, end_col_offset=42)], lineno=344, col_offset=15, end_lineno=344, end_col_offset=43), lineno=344, col_offset=4, end_lineno=344, end_col_offset=43), Try(body=[Expr(value=Call(func=Name(id='atomic_write', ctx=Load(), lineno=347, col_offset=8, end_lineno=347, end_col_offset=20), args=[Name(id='output_path', ctx=Load(), lineno=347, col_offset=21, end_lineno=347, end_col_offset=32), Name(id='json_text', ctx=Load(), lineno=347, col_offset=34, end_lineno=347, end_col_offset=43)], keywords=[keyword(arg='mode', value=Constant(value='text', lineno=347, col_offset=50, end_lineno=347, end_col_offset=56), lineno=347, col_offset=45, end_lineno=347, end_col_offset=56)], lineno=347, col_offset=8, end_lineno=347, end_col_offset=57), lineno=347, col_offset=8, end_lineno=347, end_col_offset=57)], handlers=[ExceptHandler(type=Name(id='OSError', ctx=Load(), lineno=348, col_offset=11, end_lineno=348, end_col_offset=18), name='exc', body=[Assign(targets=[Name(id='msg', ctx=Store(), lineno=349, col_offset=8, end_lineno=349, end_col_offset=11)], value=JoinedStr(values=[Constant(value='Failed to write JSON output to ', lineno=349, col_offset=16, end_lineno=349, end_col_offset=47), FormattedValue(value=Name(id='output_path', ctx=Load(), lineno=349, col_offset=48, end_lineno=349, end_col_offset=59), conversion=-1, lineno=349, col_offset=47, end_lineno=349, end_col_offset=60), Constant(value=': ', lineno=349, col_offset=60, end_lineno=349, end_col_offset=62), FormattedValue(value=Name(id='exc', ctx=Load(), lineno=349, col_offset=63, end_lineno=349, end_col_offset=66), conversion=-1, lineno=349, col_offset=62, end_lineno=349, end_col_offset=67)], lineno=349, col_offset=14, end_lineno=349, end_col_offset=68), lineno=349, col_offset=8, end_lineno=349, end_col_offset=68), Raise(exc=Call(func=Name(id='SerializationError', ctx=Load(), lineno=350, col_offset=14, end_lineno=350, end_col_offset=32), args=[Name(id='msg', ctx=Load(), lineno=350, col_offset=33, end_lineno=350, end_col_offset=36)], lineno=350, col_offset=14, end_lineno=350, end_col_offset=37), cause=Name(id='exc', ctx=Load(), lineno=350, col_offset=43, end_lineno=350, end_col_offset=46), lineno=350, col_offset=8, end_lineno=350, end_col_offset=46)], lineno=348, col_offset=4, end_lineno=350, end_col_offset=46)], lineno=346, col_offset=4, end_lineno=350, end_col_offset=46), If(test=Name(id='include_checksum', ctx=Load(), lineno=352, col_offset=7, end_lineno=352, end_col_offset=23), body=[Assign(targets=[Name(id='checksum_path', ctx=Store(), lineno=353, col_offset=8, end_lineno=353, end_col_offset=21)], value=Call(func=Attribute(value=Name(id='output_path', ctx=Load(), lineno=353, col_offset=24, end_lineno=353, end_col_offset=35), attr='with_suffix', ctx=Load(), lineno=353, col_offset=24, end_lineno=353, end_col_offset=47), args=[BinOp(left=Attribute(value=Name(id='output_path', ctx=Load(), lineno=353, col_offset=48, end_lineno=353, end_col_offset=59), attr='suffix', ctx=Load(), lineno=353, col_offset=48, end_lineno=353, end_col_offset=66), op=Add(), right=Constant(value='.sha256', lineno=353, col_offset=69, end_lineno=353, end_col_offset=78), lineno=353, col_offset=48, end_lineno=353, end_col_offset=78)], lineno=353, col_offset=24, end_lineno=353, end_col_offset=79), lineno=353, col_offset=8, end_lineno=353, end_col_offset=79), Try(body=[Expr(value=Call(func=Name(id='write_text', ctx=Load(), lineno=355, col_offset=12, end_lineno=355, end_col_offset=22), args=[Name(id='checksum_path', ctx=Load(), lineno=355, col_offset=23, end_lineno=355, end_col_offset=36), Name(id='checksum', ctx=Load(), lineno=355, col_offset=38, end_lineno=355, end_col_offset=46)], lineno=355, col_offset=12, end_lineno=355, end_col_offset=47), lineno=355, col_offset=12, end_lineno=355, end_col_offset=47)], handlers=[ExceptHandler(type=Name(id='OSError', ctx=Load(), lineno=356, col_offset=15, end_lineno=356, end_col_offset=22), name='exc', body=[Assign(targets=[Name(id='msg', ctx=Store(), lineno=357, col_offset=12, end_lineno=357, end_col_offset=15)], value=JoinedStr(values=[Constant(value='Failed to write checksum file ', lineno=357, col_offset=20, end_lineno=357, end_col_offset=50), FormattedValue(value=Name(id='checksum_path', ctx=Load(), lineno=357, col_offset=51, end_lineno=357, end_col_offset=64), conversion=-1, lineno=357, col_offset=50, end_lineno=357, end_col_offset=65), Constant(value=': ', lineno=357, col_offset=65, end_lineno=357, end_col_offset=67), FormattedValue(value=Name(id='exc', ctx=Load(), lineno=357, col_offset=68, end_lineno=357, end_col_offset=71), conversion=-1, lineno=357, col_offset=67, end_lineno=357, end_col_offset=72)], lineno=357, col_offset=18, end_lineno=357, end_col_offset=73), lineno=357, col_offset=12, end_lineno=357, end_col_offset=73), Raise(exc=Call(func=Name(id='SerializationError', ctx=Load(), lineno=358, col_offset=18, end_lineno=358, end_col_offset=36), args=[Name(id='msg', ctx=Load(), lineno=358, col_offset=37, end_lineno=358, end_col_offset=40)], lineno=358, col_offset=18, end_lineno=358, end_col_offset=41), cause=Name(id='exc', ctx=Load(), lineno=358, col_offset=47, end_lineno=358, end_col_offset=50), lineno=358, col_offset=12, end_lineno=358, end_col_offset=50)], lineno=356, col_offset=8, end_lineno=358, end_col_offset=50)], lineno=354, col_offset=8, end_lineno=358, end_col_offset=50)], lineno=352, col_offset=4, end_lineno=358, end_col_offset=50), Expr(value=Call(func=Attribute(value=Name(id='logger', ctx=Load(), lineno=360, col_offset=4, end_lineno=360, end_col_offset=10), attr='debug', ctx=Load(), lineno=360, col_offset=4, end_lineno=360, end_col_offset=16), args=[Constant(value='Serialized JSON', lineno=361, col_offset=8, end_lineno=361, end_col_offset=25)], keywords=[keyword(arg='extra', value=Dict(keys=[Constant(value='output_path', lineno=363, col_offset=12, end_lineno=363, end_col_offset=25), Constant(value='schema_path', lineno=364, col_offset=12, end_lineno=364, end_col_offset=25), Constant(value='checksum', lineno=365, col_offset=12, end_lineno=365, end_col_offset=22)], values=[Call(func=Name(id='str', ctx=Load(), lineno=363, col_offset=27, end_lineno=363, end_col_offset=30), args=[Name(id='output_path', ctx=Load(), lineno=363, col_offset=31, end_lineno=363, end_col_offset=42)], lineno=363, col_offset=27, end_lineno=363, end_col_offset=43), Call(func=Name(id='str', ctx=Load(), lineno=364, col_offset=27, end_lineno=364, end_col_offset=30), args=[Name(id='schema_path', ctx=Load(), lineno=364, col_offset=31, end_lineno=364, end_col_offset=42)], lineno=364, col_offset=27, end_lineno=364, end_col_offset=43), Name(id='checksum', ctx=Load(), lineno=365, col_offset=24, end_lineno=365, end_col_offset=32)], lineno=362, col_offset=14, end_lineno=366, end_col_offset=9), lineno=362, col_offset=8, end_lineno=366, end_col_offset=9)], lineno=360, col_offset=4, end_lineno=367, end_col_offset=5), lineno=360, col_offset=4, end_lineno=367, end_col_offset=5), Return(value=Name(id='checksum', ctx=Load(), lineno=369, col_offset=11, end_lineno=369, end_col_offset=19), lineno=369, col_offset=4, end_lineno=369, end_col_offset=19)], returns=Name(id='str', ctx=Load(), lineno=266, col_offset=5, end_lineno=266, end_col_offset=8), lineno=259, col_offset=0, end_lineno=369, end_col_offset=19), FunctionDef(name='_verify_checksum_file', args=arguments(args=[arg(arg='data_path', annotation=Name(id='Path', ctx=Load(), lineno=372, col_offset=37, end_lineno=372, end_col_offset=41), lineno=372, col_offset=26, end_lineno=372, end_col_offset=41)]), body=[Expr(value=Constant(value='Verify data against checksum file if it exists.\n\n    Parameters\n    ----------\n    data_path : Path\n        Path to JSON file.\n\n    Raises\n    ------\n    DeserializationError\n        If checksum verification fails.\n    ', lineno=373, col_offset=4, end_lineno=384, end_col_offset=7), lineno=373, col_offset=4, end_lineno=384, end_col_offset=7), Assign(targets=[Name(id='checksum_path', ctx=Store(), lineno=385, col_offset=4, end_lineno=385, end_col_offset=17)], value=Call(func=Attribute(value=Name(id='data_path', ctx=Load(), lineno=385, col_offset=20, end_lineno=385, end_col_offset=29), attr='with_suffix', ctx=Load(), lineno=385, col_offset=20, end_lineno=385, end_col_offset=41), args=[BinOp(left=Attribute(value=Name(id='data_path', ctx=Load(), lineno=385, col_offset=42, end_lineno=385, end_col_offset=51), attr='suffix', ctx=Load(), lineno=385, col_offset=42, end_lineno=385, end_col_offset=58), op=Add(), right=Constant(value='.sha256', lineno=385, col_offset=61, end_lineno=385, end_col_offset=70), lineno=385, col_offset=42, end_lineno=385, end_col_offset=70)], lineno=385, col_offset=20, end_lineno=385, end_col_offset=71), lineno=385, col_offset=4, end_lineno=385, end_col_offset=71), If(test=UnaryOp(op=Not(), operand=Call(func=Attribute(value=Name(id='checksum_path', ctx=Load(), lineno=386, col_offset=11, end_lineno=386, end_col_offset=24), attr='exists', ctx=Load(), lineno=386, col_offset=11, end_lineno=386, end_col_offset=31), lineno=386, col_offset=11, end_lineno=386, end_col_offset=33), lineno=386, col_offset=7, end_lineno=386, end_col_offset=33), body=[Expr(value=Call(func=Attribute(value=Name(id='logger', ctx=Load(), lineno=387, col_offset=8, end_lineno=387, end_col_offset=14), attr='warning', ctx=Load(), lineno=387, col_offset=8, end_lineno=387, end_col_offset=22), args=[Constant(value='Checksum file not found, skipping verification', lineno=388, col_offset=12, end_lineno=388, end_col_offset=60)], keywords=[keyword(arg='extra', value=Dict(keys=[Constant(value='data_path', lineno=389, col_offset=19, end_lineno=389, end_col_offset=30), Constant(value='checksum_path', lineno=389, col_offset=48, end_lineno=389, end_col_offset=63)], values=[Call(func=Name(id='str', ctx=Load(), lineno=389, col_offset=32, end_lineno=389, end_col_offset=35), args=[Name(id='data_path', ctx=Load(), lineno=389, col_offset=36, end_lineno=389, end_col_offset=45)], lineno=389, col_offset=32, end_lineno=389, end_col_offset=46), Call(func=Name(id='str', ctx=Load(), lineno=389, col_offset=65, end_lineno=389, end_col_offset=68), args=[Name(id='checksum_path', ctx=Load(), lineno=389, col_offset=69, end_lineno=389, end_col_offset=82)], lineno=389, col_offset=65, end_lineno=389, end_col_offset=83)], lineno=389, col_offset=18, end_lineno=389, end_col_offset=84), lineno=389, col_offset=12, end_lineno=389, end_col_offset=84)], lineno=387, col_offset=8, end_lineno=390, end_col_offset=9), lineno=387, col_offset=8, end_lineno=390, end_col_offset=9), Return(lineno=391, col_offset=8, end_lineno=391, end_col_offset=14)], lineno=386, col_offset=4, end_lineno=391, end_col_offset=14), Assign(targets=[Name(id='expected_checksum', ctx=Store(), lineno=393, col_offset=4, end_lineno=393, end_col_offset=21)], value=Call(func=Attribute(value=Call(func=Name(id='read_text', ctx=Load(), lineno=393, col_offset=24, end_lineno=393, end_col_offset=33), args=[Name(id='checksum_path', ctx=Load(), lineno=393, col_offset=34, end_lineno=393, end_col_offset=47)], lineno=393, col_offset=24, end_lineno=393, end_col_offset=48), attr='strip', ctx=Load(), lineno=393, col_offset=24, end_lineno=393, end_col_offset=54), lineno=393, col_offset=24, end_lineno=393, end_col_offset=56), lineno=393, col_offset=4, end_lineno=393, end_col_offset=56), Assign(targets=[Name(id='data_bytes', ctx=Store(), lineno=394, col_offset=4, end_lineno=394, end_col_offset=14)], value=Call(func=Attribute(value=Name(id='data_path', ctx=Load(), lineno=394, col_offset=17, end_lineno=394, end_col_offset=26), attr='read_bytes', ctx=Load(), lineno=394, col_offset=17, end_lineno=394, end_col_offset=37), lineno=394, col_offset=17, end_lineno=394, end_col_offset=39), lineno=394, col_offset=4, end_lineno=394, end_col_offset=39), Try(body=[Expr(value=Call(func=Name(id='verify_checksum', ctx=Load(), lineno=396, col_offset=8, end_lineno=396, end_col_offset=23), args=[Name(id='data_bytes', ctx=Load(), lineno=396, col_offset=24, end_lineno=396, end_col_offset=34), Name(id='expected_checksum', ctx=Load(), lineno=396, col_offset=36, end_lineno=396, end_col_offset=53)], lineno=396, col_offset=8, end_lineno=396, end_col_offset=54), lineno=396, col_offset=8, end_lineno=396, end_col_offset=54)], handlers=[ExceptHandler(type=Name(id='SerializationError', ctx=Load(), lineno=397, col_offset=11, end_lineno=397, end_col_offset=29), name='exc', body=[Assign(targets=[Name(id='msg', ctx=Store(), lineno=398, col_offset=8, end_lineno=398, end_col_offset=11)], value=JoinedStr(values=[Constant(value='Checksum verification failed for ', lineno=398, col_offset=16, end_lineno=398, end_col_offset=49), FormattedValue(value=Name(id='data_path', ctx=Load(), lineno=398, col_offset=50, end_lineno=398, end_col_offset=59), conversion=-1, lineno=398, col_offset=49, end_lineno=398, end_col_offset=60)], lineno=398, col_offset=14, end_lineno=398, end_col_offset=61), lineno=398, col_offset=8, end_lineno=398, end_col_offset=61), Raise(exc=Call(func=Name(id='DeserializationError', ctx=Load(), lineno=399, col_offset=14, end_lineno=399, end_col_offset=34), args=[Name(id='msg', ctx=Load(), lineno=399, col_offset=35, end_lineno=399, end_col_offset=38)], lineno=399, col_offset=14, end_lineno=399, end_col_offset=39), cause=Name(id='exc', ctx=Load(), lineno=399, col_offset=45, end_lineno=399, end_col_offset=48), lineno=399, col_offset=8, end_lineno=399, end_col_offset=48)], lineno=397, col_offset=4, end_lineno=399, end_col_offset=48)], lineno=395, col_offset=4, end_lineno=399, end_col_offset=48)], returns=Constant(value=None, lineno=372, col_offset=46, end_lineno=372, end_col_offset=50), lineno=372, col_offset=0, end_lineno=399, end_col_offset=48), FunctionDef(name='_validate_json_against_schema', args=arguments(args=[arg(arg='obj', annotation=Name(id='object', ctx=Load(), lineno=402, col_offset=39, end_lineno=402, end_col_offset=45), lineno=402, col_offset=34, end_lineno=402, end_col_offset=45), arg(arg='schema_path', annotation=Name(id='Path', ctx=Load(), lineno=402, col_offset=60, end_lineno=402, end_col_offset=64), lineno=402, col_offset=47, end_lineno=402, end_col_offset=64)]), body=[Expr(value=Constant(value='Validate JSON object against schema.\n\n    Parameters\n    ----------\n    obj : object\n        Parsed JSON object.\n    schema_path : Path\n        Path to JSON Schema 2020-12 file.\n\n    Raises\n    ------\n    SchemaValidationError\n        If validation fails.\n    FileNotFoundError\n        If schema file does not exist.\n    ', lineno=403, col_offset=4, end_lineno=418, end_col_offset=7), lineno=403, col_offset=4, end_lineno=418, end_col_offset=7), If(test=UnaryOp(op=Not(), operand=Call(func=Attribute(value=Name(id='schema_path', ctx=Load(), lineno=419, col_offset=11, end_lineno=419, end_col_offset=22), attr='exists', ctx=Load(), lineno=419, col_offset=11, end_lineno=419, end_col_offset=29), lineno=419, col_offset=11, end_lineno=419, end_col_offset=31), lineno=419, col_offset=7, end_lineno=419, end_col_offset=31), body=[Assign(targets=[Name(id='msg', ctx=Store(), lineno=420, col_offset=8, end_lineno=420, end_col_offset=11)], value=JoinedStr(values=[Constant(value='Schema file not found: ', lineno=420, col_offset=16, end_lineno=420, end_col_offset=39), FormattedValue(value=Name(id='schema_path', ctx=Load(), lineno=420, col_offset=40, end_lineno=420, end_col_offset=51), conversion=-1, lineno=420, col_offset=39, end_lineno=420, end_col_offset=52)], lineno=420, col_offset=14, end_lineno=420, end_col_offset=53), lineno=420, col_offset=8, end_lineno=420, end_col_offset=53), Raise(exc=Call(func=Name(id='FileNotFoundError', ctx=Load(), lineno=421, col_offset=14, end_lineno=421, end_col_offset=31), args=[Name(id='msg', ctx=Load(), lineno=421, col_offset=32, end_lineno=421, end_col_offset=35)], lineno=421, col_offset=14, end_lineno=421, end_col_offset=36), lineno=421, col_offset=8, end_lineno=421, end_col_offset=36)], lineno=419, col_offset=4, end_lineno=421, end_col_offset=36), If(test=Call(func=Name(id='isinstance', ctx=Load(), lineno=423, col_offset=7, end_lineno=423, end_col_offset=17), args=[Name(id='obj', ctx=Load(), lineno=423, col_offset=18, end_lineno=423, end_col_offset=21), Name(id='Mapping', ctx=Load(), lineno=423, col_offset=23, end_lineno=423, end_col_offset=30)], lineno=423, col_offset=7, end_lineno=423, end_col_offset=31), body=[Expr(value=Call(func=Name(id='validate_payload', ctx=Load(), lineno=424, col_offset=8, end_lineno=424, end_col_offset=24), args=[Name(id='obj', ctx=Load(), lineno=424, col_offset=25, end_lineno=424, end_col_offset=28), Name(id='schema_path', ctx=Load(), lineno=424, col_offset=30, end_lineno=424, end_col_offset=41)], lineno=424, col_offset=8, end_lineno=424, end_col_offset=42), lineno=424, col_offset=8, end_lineno=424, end_col_offset=42), Return(lineno=425, col_offset=8, end_lineno=425, end_col_offset=14)], lineno=423, col_offset=4, end_lineno=425, end_col_offset=14), Assign(targets=[Name(id='schema_obj', ctx=Store(), lineno=427, col_offset=4, end_lineno=427, end_col_offset=14)], value=Call(func=Name(id='_load_schema_cached', ctx=Load(), lineno=427, col_offset=17, end_lineno=427, end_col_offset=36), args=[Name(id='schema_path', ctx=Load(), lineno=427, col_offset=37, end_lineno=427, end_col_offset=48)], lineno=427, col_offset=17, end_lineno=427, end_col_offset=49), lineno=427, col_offset=4, end_lineno=427, end_col_offset=49), Try(body=[Expr(value=Call(func=Name(id='jsonschema_validate', ctx=Load(), lineno=429, col_offset=8, end_lineno=429, end_col_offset=27), keywords=[keyword(arg='instance', value=Name(id='obj', ctx=Load(), lineno=429, col_offset=37, end_lineno=429, end_col_offset=40), lineno=429, col_offset=28, end_lineno=429, end_col_offset=40), keyword(arg='schema', value=Name(id='schema_obj', ctx=Load(), lineno=429, col_offset=49, end_lineno=429, end_col_offset=59), lineno=429, col_offset=42, end_lineno=429, end_col_offset=59)], lineno=429, col_offset=8, end_lineno=429, end_col_offset=60), lineno=429, col_offset=8, end_lineno=429, end_col_offset=60)], handlers=[ExceptHandler(type=Name(id='ValidationError', ctx=Load(), lineno=430, col_offset=11, end_lineno=430, end_col_offset=26), name='exc', body=[Assign(targets=[Name(id='msg', ctx=Store(), lineno=431, col_offset=8, end_lineno=431, end_col_offset=11)], value=JoinedStr(values=[Constant(value='Schema validation failed: ', lineno=431, col_offset=16, end_lineno=431, end_col_offset=42), FormattedValue(value=Name(id='exc', ctx=Load(), lineno=431, col_offset=43, end_lineno=431, end_col_offset=46), conversion=-1, lineno=431, col_offset=42, end_lineno=431, end_col_offset=47)], lineno=431, col_offset=14, end_lineno=431, end_col_offset=48), lineno=431, col_offset=8, end_lineno=431, end_col_offset=48), Raise(exc=Call(func=Name(id='SchemaValidationError', ctx=Load(), lineno=432, col_offset=14, end_lineno=432, end_col_offset=35), args=[Name(id='msg', ctx=Load(), lineno=432, col_offset=36, end_lineno=432, end_col_offset=39)], lineno=432, col_offset=14, end_lineno=432, end_col_offset=40), cause=Name(id='exc', ctx=Load(), lineno=432, col_offset=46, end_lineno=432, end_col_offset=49), lineno=432, col_offset=8, end_lineno=432, end_col_offset=49)], lineno=430, col_offset=4, end_lineno=432, end_col_offset=49), ExceptHandler(type=Name(id='SchemaError', ctx=Load(), lineno=433, col_offset=11, end_lineno=433, end_col_offset=22), name='exc', body=[Assign(targets=[Name(id='msg', ctx=Store(), lineno=434, col_offset=8, end_lineno=434, end_col_offset=11)], value=JoinedStr(values=[Constant(value='Invalid schema: ', lineno=434, col_offset=16, end_lineno=434, end_col_offset=32), FormattedValue(value=Name(id='exc', ctx=Load(), lineno=434, col_offset=33, end_lineno=434, end_col_offset=36), conversion=-1, lineno=434, col_offset=32, end_lineno=434, end_col_offset=37)], lineno=434, col_offset=14, end_lineno=434, end_col_offset=38), lineno=434, col_offset=8, end_lineno=434, end_col_offset=38), Raise(exc=Call(func=Name(id='SchemaValidationError', ctx=Load(), lineno=435, col_offset=14, end_lineno=435, end_col_offset=35), args=[Name(id='msg', ctx=Load(), lineno=435, col_offset=36, end_lineno=435, end_col_offset=39)], lineno=435, col_offset=14, end_lineno=435, end_col_offset=40), cause=Name(id='exc', ctx=Load(), lineno=435, col_offset=46, end_lineno=435, end_col_offset=49), lineno=435, col_offset=8, end_lineno=435, end_col_offset=49)], lineno=433, col_offset=4, end_lineno=435, end_col_offset=49)], lineno=428, col_offset=4, end_lineno=435, end_col_offset=49)], returns=Constant(value=None, lineno=402, col_offset=69, end_lineno=402, end_col_offset=73), lineno=402, col_offset=0, end_lineno=435, end_col_offset=49), FunctionDef(name='_load_data_file', args=arguments(args=[arg(arg='data_path', annotation=Name(id='Path', ctx=Load(), lineno=438, col_offset=31, end_lineno=438, end_col_offset=35), lineno=438, col_offset=20, end_lineno=438, end_col_offset=35)]), body=[Expr(value=Constant(value='Load data file as text.\n\n    Parameters\n    ----------\n    data_path : Path\n        Path to JSON file.\n\n    Returns\n    -------\n    str\n        File contents as text.\n\n    Raises\n    ------\n    FileNotFoundError\n        If data file does not exist.\n    ', lineno=439, col_offset=4, end_lineno=455, end_col_offset=7), lineno=439, col_offset=4, end_lineno=455, end_col_offset=7), If(test=UnaryOp(op=Not(), operand=Call(func=Attribute(value=Name(id='data_path', ctx=Load(), lineno=456, col_offset=11, end_lineno=456, end_col_offset=20), attr='exists', ctx=Load(), lineno=456, col_offset=11, end_lineno=456, end_col_offset=27), lineno=456, col_offset=11, end_lineno=456, end_col_offset=29), lineno=456, col_offset=7, end_lineno=456, end_col_offset=29), body=[Assign(targets=[Name(id='msg', ctx=Store(), lineno=457, col_offset=8, end_lineno=457, end_col_offset=11)], value=JoinedStr(values=[Constant(value='Data file not found: ', lineno=457, col_offset=16, end_lineno=457, end_col_offset=37), FormattedValue(value=Name(id='data_path', ctx=Load(), lineno=457, col_offset=38, end_lineno=457, end_col_offset=47), conversion=-1, lineno=457, col_offset=37, end_lineno=457, end_col_offset=48)], lineno=457, col_offset=14, end_lineno=457, end_col_offset=49), lineno=457, col_offset=8, end_lineno=457, end_col_offset=49), Raise(exc=Call(func=Name(id='FileNotFoundError', ctx=Load(), lineno=458, col_offset=14, end_lineno=458, end_col_offset=31), args=[Name(id='msg', ctx=Load(), lineno=458, col_offset=32, end_lineno=458, end_col_offset=35)], lineno=458, col_offset=14, end_lineno=458, end_col_offset=36), lineno=458, col_offset=8, end_lineno=458, end_col_offset=36)], lineno=456, col_offset=4, end_lineno=458, end_col_offset=36), Return(value=Call(func=Name(id='read_text', ctx=Load(), lineno=459, col_offset=11, end_lineno=459, end_col_offset=20), args=[Name(id='data_path', ctx=Load(), lineno=459, col_offset=21, end_lineno=459, end_col_offset=30)], lineno=459, col_offset=11, end_lineno=459, end_col_offset=31), lineno=459, col_offset=4, end_lineno=459, end_col_offset=31)], returns=Name(id='str', ctx=Load(), lineno=438, col_offset=40, end_lineno=438, end_col_offset=43), lineno=438, col_offset=0, end_lineno=459, end_col_offset=31), FunctionDef(name='deserialize_json', args=arguments(args=[arg(arg='data_path', annotation=Name(id='Path', ctx=Load(), lineno=464, col_offset=15, end_lineno=464, end_col_offset=19), lineno=464, col_offset=4, end_lineno=464, end_col_offset=19), arg(arg='schema_path', annotation=Name(id='Path', ctx=Load(), lineno=465, col_offset=17, end_lineno=465, end_col_offset=21), lineno=465, col_offset=4, end_lineno=465, end_col_offset=21)], kwonlyargs=[arg(arg='verify_checksum_file', annotation=Name(id='bool', ctx=Load(), lineno=467, col_offset=26, end_lineno=467, end_col_offset=30), lineno=467, col_offset=4, end_lineno=467, end_col_offset=30)], kw_defaults=[Constant(value=True, lineno=467, col_offset=33, end_lineno=467, end_col_offset=37)]), body=[Expr(value=Constant(value='Deserialize JSON with schema validation and checksum verification.\n\n    Loads a JSON file, optionally verifies its SHA256 checksum against a\n    `.sha256` file, validates the parsed object against the provided schema,\n    and returns the deserialized Python object.\n\n    Parameters\n    ----------\n    data_path : Path\n        Path to JSON file to deserialize. Must exist and be readable.\n    schema_path : Path\n        Path to JSON Schema 2020-12 file for validation. Must exist.\n    verify_checksum_file : bool, optional\n        If True, verify against `.sha256` checksum file (if present).\n        If the checksum file is missing, logs a warning but continues.\n        Defaults to True.\n\n    Returns\n    -------\n    object\n        Deserialized Python object (JSON-serializable types: dict, list, str,\n        int, float, bool, None, or nested combinations).\n\n    Raises\n    ------\n    DeserializationError\n        If JSON parsing fails, checksum verification fails, or file read fails.\n    SchemaValidationError\n        If the parsed object does not conform to the schema.\n    FileNotFoundError\n        If data or schema file does not exist.\n\n    Examples\n    --------\n    >>> from pathlib import Path\n    >>> import tempfile\n    >>> with tempfile.TemporaryDirectory() as tmpdir:\n    ...     tmp = Path(tmpdir)\n    ...     schema = tmp / "schema.json"\n    ...     schema.write_text(\'{"type": "object", "properties": {"k1": {"type": "number"}}}\')\n    ...     data_path = tmp / "data.json"\n    ...     data_path.write_text(\'{"k1": 0.9}\')\n    ...     loaded = deserialize_json(data_path, schema)\n    ...     assert loaded == {"k1": 0.9}\n    ', lineno=469, col_offset=4, end_lineno=513, end_col_offset=7), lineno=469, col_offset=4, end_lineno=513, end_col_offset=7), If(test=UnaryOp(op=Not(), operand=Call(func=Attribute(value=Name(id='data_path', ctx=Load(), lineno=514, col_offset=11, end_lineno=514, end_col_offset=20), attr='exists', ctx=Load(), lineno=514, col_offset=11, end_lineno=514, end_col_offset=27), lineno=514, col_offset=11, end_lineno=514, end_col_offset=29), lineno=514, col_offset=7, end_lineno=514, end_col_offset=29), body=[Assign(targets=[Name(id='msg', ctx=Store(), lineno=515, col_offset=8, end_lineno=515, end_col_offset=11)], value=JoinedStr(values=[Constant(value='Data file not found: ', lineno=515, col_offset=16, end_lineno=515, end_col_offset=37), FormattedValue(value=Name(id='data_path', ctx=Load(), lineno=515, col_offset=38, end_lineno=515, end_col_offset=47), conversion=-1, lineno=515, col_offset=37, end_lineno=515, end_col_offset=48)], lineno=515, col_offset=14, end_lineno=515, end_col_offset=49), lineno=515, col_offset=8, end_lineno=515, end_col_offset=49), Raise(exc=Call(func=Name(id='FileNotFoundError', ctx=Load(), lineno=516, col_offset=14, end_lineno=516, end_col_offset=31), args=[Name(id='msg', ctx=Load(), lineno=516, col_offset=32, end_lineno=516, end_col_offset=35)], lineno=516, col_offset=14, end_lineno=516, end_col_offset=36), lineno=516, col_offset=8, end_lineno=516, end_col_offset=36)], lineno=514, col_offset=4, end_lineno=516, end_col_offset=36), If(test=UnaryOp(op=Not(), operand=Call(func=Attribute(value=Name(id='schema_path', ctx=Load(), lineno=517, col_offset=11, end_lineno=517, end_col_offset=22), attr='exists', ctx=Load(), lineno=517, col_offset=11, end_lineno=517, end_col_offset=29), lineno=517, col_offset=11, end_lineno=517, end_col_offset=31), lineno=517, col_offset=7, end_lineno=517, end_col_offset=31), body=[Assign(targets=[Name(id='msg', ctx=Store(), lineno=518, col_offset=8, end_lineno=518, end_col_offset=11)], value=JoinedStr(values=[Constant(value='Schema file not found: ', lineno=518, col_offset=16, end_lineno=518, end_col_offset=39), FormattedValue(value=Name(id='schema_path', ctx=Load(), lineno=518, col_offset=40, end_lineno=518, end_col_offset=51), conversion=-1, lineno=518, col_offset=39, end_lineno=518, end_col_offset=52)], lineno=518, col_offset=14, end_lineno=518, end_col_offset=53), lineno=518, col_offset=8, end_lineno=518, end_col_offset=53), Raise(exc=Call(func=Name(id='FileNotFoundError', ctx=Load(), lineno=519, col_offset=14, end_lineno=519, end_col_offset=31), args=[Name(id='msg', ctx=Load(), lineno=519, col_offset=32, end_lineno=519, end_col_offset=35)], lineno=519, col_offset=14, end_lineno=519, end_col_offset=36), lineno=519, col_offset=8, end_lineno=519, end_col_offset=36)], lineno=517, col_offset=4, end_lineno=519, end_col_offset=36), If(test=Name(id='verify_checksum_file', ctx=Load(), lineno=521, col_offset=7, end_lineno=521, end_col_offset=27), body=[Expr(value=Call(func=Name(id='_verify_checksum_file', ctx=Load(), lineno=522, col_offset=8, end_lineno=522, end_col_offset=29), args=[Name(id='data_path', ctx=Load(), lineno=522, col_offset=30, end_lineno=522, end_col_offset=39)], lineno=522, col_offset=8, end_lineno=522, end_col_offset=40), lineno=522, col_offset=8, end_lineno=522, end_col_offset=40)], lineno=521, col_offset=4, end_lineno=522, end_col_offset=40), Assign(targets=[Name(id='json_text', ctx=Store(), lineno=524, col_offset=4, end_lineno=524, end_col_offset=13)], value=Call(func=Name(id='_load_data_file', ctx=Load(), lineno=524, col_offset=16, end_lineno=524, end_col_offset=31), args=[Name(id='data_path', ctx=Load(), lineno=524, col_offset=32, end_lineno=524, end_col_offset=41)], lineno=524, col_offset=16, end_lineno=524, end_col_offset=42), lineno=524, col_offset=4, end_lineno=524, end_col_offset=42), Try(body=[AnnAssign(target=Name(id='obj', ctx=Store(), lineno=526, col_offset=8, end_lineno=526, end_col_offset=11), annotation=Name(id='object', ctx=Load(), lineno=526, col_offset=13, end_lineno=526, end_col_offset=19), value=Call(func=Attribute(value=Name(id='json', ctx=Load(), lineno=526, col_offset=22, end_lineno=526, end_col_offset=26), attr='loads', ctx=Load(), lineno=526, col_offset=22, end_lineno=526, end_col_offset=32), args=[Name(id='json_text', ctx=Load(), lineno=526, col_offset=33, end_lineno=526, end_col_offset=42)], lineno=526, col_offset=22, end_lineno=526, end_col_offset=43), simple=1, lineno=526, col_offset=8, end_lineno=526, end_col_offset=43)], handlers=[ExceptHandler(type=Attribute(value=Name(id='json', ctx=Load(), lineno=527, col_offset=11, end_lineno=527, end_col_offset=15), attr='JSONDecodeError', ctx=Load(), lineno=527, col_offset=11, end_lineno=527, end_col_offset=31), name='exc', body=[Assign(targets=[Name(id='msg', ctx=Store(), lineno=528, col_offset=8, end_lineno=528, end_col_offset=11)], value=JoinedStr(values=[Constant(value='Invalid JSON in ', lineno=528, col_offset=16, end_lineno=528, end_col_offset=32), FormattedValue(value=Name(id='data_path', ctx=Load(), lineno=528, col_offset=33, end_lineno=528, end_col_offset=42), conversion=-1, lineno=528, col_offset=32, end_lineno=528, end_col_offset=43), Constant(value=': ', lineno=528, col_offset=43, end_lineno=528, end_col_offset=45), FormattedValue(value=Name(id='exc', ctx=Load(), lineno=528, col_offset=46, end_lineno=528, end_col_offset=49), conversion=-1, lineno=528, col_offset=45, end_lineno=528, end_col_offset=50)], lineno=528, col_offset=14, end_lineno=528, end_col_offset=51), lineno=528, col_offset=8, end_lineno=528, end_col_offset=51), Raise(exc=Call(func=Name(id='DeserializationError', ctx=Load(), lineno=529, col_offset=14, end_lineno=529, end_col_offset=34), args=[Name(id='msg', ctx=Load(), lineno=529, col_offset=35, end_lineno=529, end_col_offset=38)], lineno=529, col_offset=14, end_lineno=529, end_col_offset=39), cause=Name(id='exc', ctx=Load(), lineno=529, col_offset=45, end_lineno=529, end_col_offset=48), lineno=529, col_offset=8, end_lineno=529, end_col_offset=48)], lineno=527, col_offset=4, end_lineno=529, end_col_offset=48)], lineno=525, col_offset=4, end_lineno=529, end_col_offset=48), Try(body=[Expr(value=Call(func=Name(id='_validate_json_against_schema', ctx=Load(), lineno=532, col_offset=8, end_lineno=532, end_col_offset=37), args=[Name(id='obj', ctx=Load(), lineno=532, col_offset=38, end_lineno=532, end_col_offset=41), Name(id='schema_path', ctx=Load(), lineno=532, col_offset=43, end_lineno=532, end_col_offset=54)], lineno=532, col_offset=8, end_lineno=532, end_col_offset=55), lineno=532, col_offset=8, end_lineno=532, end_col_offset=55)], handlers=[ExceptHandler(type=Name(id='SchemaValidationError', ctx=Load(), lineno=533, col_offset=11, end_lineno=533, end_col_offset=32), name='exc', body=[Assign(targets=[Name(id='msg', ctx=Store(), lineno=534, col_offset=8, end_lineno=534, end_col_offset=11)], value=JoinedStr(values=[Constant(value='Schema validation failed for ', lineno=534, col_offset=16, end_lineno=534, end_col_offset=45), FormattedValue(value=Name(id='data_path', ctx=Load(), lineno=534, col_offset=46, end_lineno=534, end_col_offset=55), conversion=-1, lineno=534, col_offset=45, end_lineno=534, end_col_offset=56), Constant(value=' against ', lineno=534, col_offset=56, end_lineno=534, end_col_offset=65), FormattedValue(value=Name(id='schema_path', ctx=Load(), lineno=534, col_offset=66, end_lineno=534, end_col_offset=77), conversion=-1, lineno=534, col_offset=65, end_lineno=534, end_col_offset=78), Constant(value=': ', lineno=534, col_offset=78, end_lineno=534, end_col_offset=80), FormattedValue(value=Name(id='exc', ctx=Load(), lineno=534, col_offset=81, end_lineno=534, end_col_offset=84), conversion=-1, lineno=534, col_offset=80, end_lineno=534, end_col_offset=85)], lineno=534, col_offset=14, end_lineno=534, end_col_offset=86), lineno=534, col_offset=8, end_lineno=534, end_col_offset=86), Raise(exc=Call(func=Name(id='SchemaValidationError', ctx=Load(), lineno=535, col_offset=14, end_lineno=535, end_col_offset=35), args=[Name(id='msg', ctx=Load(), lineno=535, col_offset=36, end_lineno=535, end_col_offset=39)], lineno=535, col_offset=14, end_lineno=535, end_col_offset=40), cause=Name(id='exc', ctx=Load(), lineno=535, col_offset=46, end_lineno=535, end_col_offset=49), lineno=535, col_offset=8, end_lineno=535, end_col_offset=49)], lineno=533, col_offset=4, end_lineno=535, end_col_offset=49)], lineno=531, col_offset=4, end_lineno=535, end_col_offset=49), Expr(value=Call(func=Attribute(value=Name(id='logger', ctx=Load(), lineno=537, col_offset=4, end_lineno=537, end_col_offset=10), attr='debug', ctx=Load(), lineno=537, col_offset=4, end_lineno=537, end_col_offset=16), args=[Constant(value='Deserialized JSON', lineno=538, col_offset=8, end_lineno=538, end_col_offset=27)], keywords=[keyword(arg='extra', value=Dict(keys=[Constant(value='data_path', lineno=540, col_offset=12, end_lineno=540, end_col_offset=23), Constant(value='schema_path', lineno=541, col_offset=12, end_lineno=541, end_col_offset=25)], values=[Call(func=Name(id='str', ctx=Load(), lineno=540, col_offset=25, end_lineno=540, end_col_offset=28), args=[Name(id='data_path', ctx=Load(), lineno=540, col_offset=29, end_lineno=540, end_col_offset=38)], lineno=540, col_offset=25, end_lineno=540, end_col_offset=39), Call(func=Name(id='str', ctx=Load(), lineno=541, col_offset=27, end_lineno=541, end_col_offset=30), args=[Name(id='schema_path', ctx=Load(), lineno=541, col_offset=31, end_lineno=541, end_col_offset=42)], lineno=541, col_offset=27, end_lineno=541, end_col_offset=43)], lineno=539, col_offset=14, end_lineno=542, end_col_offset=9), lineno=539, col_offset=8, end_lineno=542, end_col_offset=9)], lineno=537, col_offset=4, end_lineno=543, end_col_offset=5), lineno=537, col_offset=4, end_lineno=543, end_col_offset=5), Return(value=Name(id='obj', ctx=Load(), lineno=545, col_offset=11, end_lineno=545, end_col_offset=14), lineno=545, col_offset=4, end_lineno=545, end_col_offset=14)], returns=Name(id='object', ctx=Load(), lineno=468, col_offset=5, end_lineno=468, end_col_offset=11), lineno=463, col_offset=0, end_lineno=545, end_col_offset=14)])