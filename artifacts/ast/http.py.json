Module(body=[Expr(value=Constant(value='HTTP adapters for Problem Details exception handling.\n\nThis module provides FastAPI exception handlers and helpers for converting\nKgFoundryError exceptions to RFC 9457 Problem Details responses.\n\nExamples\n--------\n>>> from fastapi import FastAPI\n>>> from kgfoundry_common.errors.http import register_problem_details_handler\n>>> app = FastAPI()\n>>> register_problem_details_handler(app)\n', lineno=1, col_offset=0, end_lineno=12, end_col_offset=3), lineno=1, col_offset=0, end_lineno=12, end_col_offset=3), ImportFrom(module='__future__', names=[alias(name='annotations', lineno=16, col_offset=23, end_lineno=16, end_col_offset=34)], level=0, lineno=16, col_offset=0, end_lineno=16, end_col_offset=34), Import(names=[alias(name='asyncio', lineno=18, col_offset=7, end_lineno=18, end_col_offset=14)], lineno=18, col_offset=0, end_lineno=18, end_col_offset=14), ImportFrom(module='typing', names=[alias(name='TYPE_CHECKING', lineno=19, col_offset=19, end_lineno=19, end_col_offset=32)], level=0, lineno=19, col_offset=0, end_lineno=19, end_col_offset=32), ImportFrom(module='fastapi.responses', names=[alias(name='JSONResponse', lineno=21, col_offset=30, end_lineno=21, end_col_offset=42)], level=0, lineno=21, col_offset=0, end_lineno=21, end_col_offset=42), ImportFrom(module='kgfoundry_common.errors.exceptions', names=[alias(name='KgFoundryError', lineno=23, col_offset=47, end_lineno=23, end_col_offset=61)], level=0, lineno=23, col_offset=0, end_lineno=23, end_col_offset=61), ImportFrom(module='kgfoundry_common.fastapi_helpers', names=[alias(name='typed_exception_handler', lineno=24, col_offset=45, end_lineno=24, end_col_offset=68)], level=0, lineno=24, col_offset=0, end_lineno=24, end_col_offset=68), ImportFrom(module='kgfoundry_common.logging', names=[alias(name='get_logger', lineno=25, col_offset=37, end_lineno=25, end_col_offset=47)], level=0, lineno=25, col_offset=0, end_lineno=25, end_col_offset=47), ImportFrom(module='kgfoundry_common.navmap_loader', names=[alias(name='load_nav_metadata', lineno=26, col_offset=43, end_lineno=26, end_col_offset=60)], level=0, lineno=26, col_offset=0, end_lineno=26, end_col_offset=60), If(test=Name(id='TYPE_CHECKING', ctx=Load(), lineno=28, col_offset=3, end_lineno=28, end_col_offset=16), body=[ImportFrom(module='fastapi', names=[alias(name='FastAPI', lineno=29, col_offset=24, end_lineno=29, end_col_offset=31), alias(name='Request', lineno=29, col_offset=33, end_lineno=29, end_col_offset=40)], level=0, lineno=29, col_offset=4, end_lineno=29, end_col_offset=40), ImportFrom(module='kgfoundry_common.problem_details', names=[alias(name='ProblemDetails', lineno=31, col_offset=49, end_lineno=31, end_col_offset=63)], level=0, lineno=31, col_offset=4, end_lineno=31, end_col_offset=63)], lineno=28, col_offset=0, end_lineno=31, end_col_offset=63), Assign(targets=[Name(id='__all__', ctx=Store(), lineno=34, col_offset=0, end_lineno=34, end_col_offset=7)], value=List(elts=[Constant(value='problem_details_response', lineno=35, col_offset=4, end_lineno=35, end_col_offset=30), Constant(value='register_problem_details_handler', lineno=36, col_offset=4, end_lineno=36, end_col_offset=38)], ctx=Load(), lineno=34, col_offset=10, end_lineno=37, end_col_offset=1), lineno=34, col_offset=0, end_lineno=37, end_col_offset=1), Assign(targets=[Name(id='__navmap__', ctx=Store(), lineno=38, col_offset=0, end_lineno=38, end_col_offset=10)], value=Call(func=Name(id='load_nav_metadata', ctx=Load(), lineno=38, col_offset=13, end_lineno=38, end_col_offset=30), args=[Name(id='__name__', ctx=Load(), lineno=38, col_offset=31, end_lineno=38, end_col_offset=39), Call(func=Name(id='tuple', ctx=Load(), lineno=38, col_offset=41, end_lineno=38, end_col_offset=46), args=[Name(id='__all__', ctx=Load(), lineno=38, col_offset=47, end_lineno=38, end_col_offset=54)], lineno=38, col_offset=41, end_lineno=38, end_col_offset=55)], lineno=38, col_offset=13, end_lineno=38, end_col_offset=56), lineno=38, col_offset=0, end_lineno=38, end_col_offset=56), Assign(targets=[Name(id='logger', ctx=Store(), lineno=41, col_offset=0, end_lineno=41, end_col_offset=6)], value=Call(func=Name(id='get_logger', ctx=Load(), lineno=41, col_offset=9, end_lineno=41, end_col_offset=19), args=[Name(id='__name__', ctx=Load(), lineno=41, col_offset=20, end_lineno=41, end_col_offset=28)], lineno=41, col_offset=9, end_lineno=41, end_col_offset=29), lineno=41, col_offset=0, end_lineno=41, end_col_offset=29), FunctionDef(name='problem_details_response', args=arguments(args=[arg(arg='error', annotation=Name(id='KgFoundryError', ctx=Load(), lineno=46, col_offset=11, end_lineno=46, end_col_offset=25), lineno=46, col_offset=4, end_lineno=46, end_col_offset=25), arg(arg='request', annotation=BinOp(left=Name(id='Request', ctx=Load(), lineno=47, col_offset=13, end_lineno=47, end_col_offset=20), op=BitOr(), right=Constant(value=None, lineno=47, col_offset=23, end_lineno=47, end_col_offset=27), lineno=47, col_offset=13, end_lineno=47, end_col_offset=27), lineno=47, col_offset=4, end_lineno=47, end_col_offset=27)], defaults=[Constant(value=None, lineno=47, col_offset=30, end_lineno=47, end_col_offset=34)]), body=[Expr(value=Constant(value='Convert KgFoundryError to RFC 9457 Problem Details JSONResponse.\n\n    Converts a KgFoundryError exception into a FastAPI JSONResponse\n    conforming to RFC 9457 Problem Details format, including appropriate\n    HTTP status code and content type headers.\n\n    Parameters\n    ----------\n    error : KgFoundryError\n        Exception to convert to Problem Details response.\n    request : Request | None, optional\n        FastAPI request object for generating instance URI. Defaults to None.\n\n    Returns\n    -------\n    JSONResponse\n        Problem Details JSON response with appropriate status code and\n        Content-Type header.\n\n    Examples\n    --------\n    >>> from kgfoundry_common.errors import DownloadError\n    >>> from kgfoundry_common.errors.http import problem_details_response\n    >>> error = DownloadError("Download failed")\n    >>> response = problem_details_response(error)\n    >>> assert response.status_code == 503\n    >>> assert "type" in response.body.decode()\n    ', lineno=49, col_offset=4, end_lineno=76, end_col_offset=7), lineno=49, col_offset=4, end_lineno=76, end_col_offset=7), Assign(targets=[Name(id='instance', ctx=Store(), lineno=77, col_offset=4, end_lineno=77, end_col_offset=12)], value=Constant(value=None, lineno=77, col_offset=15, end_lineno=77, end_col_offset=19), lineno=77, col_offset=4, end_lineno=77, end_col_offset=19), If(test=Name(id='request', ctx=Load(), lineno=78, col_offset=7, end_lineno=78, end_col_offset=14), body=[Assign(targets=[Name(id='instance', ctx=Store(), lineno=79, col_offset=8, end_lineno=79, end_col_offset=16)], value=Call(func=Name(id='str', ctx=Load(), lineno=79, col_offset=19, end_lineno=79, end_col_offset=22), args=[Attribute(value=Attribute(value=Name(id='request', ctx=Load(), lineno=79, col_offset=23, end_lineno=79, end_col_offset=30), attr='url', ctx=Load(), lineno=79, col_offset=23, end_lineno=79, end_col_offset=34), attr='path', ctx=Load(), lineno=79, col_offset=23, end_lineno=79, end_col_offset=39)], lineno=79, col_offset=19, end_lineno=79, end_col_offset=40), lineno=79, col_offset=8, end_lineno=79, end_col_offset=40), If(test=Attribute(value=Attribute(value=Name(id='request', ctx=Load(), lineno=80, col_offset=11, end_lineno=80, end_col_offset=18), attr='url', ctx=Load(), lineno=80, col_offset=11, end_lineno=80, end_col_offset=22), attr='query', ctx=Load(), lineno=80, col_offset=11, end_lineno=80, end_col_offset=28), body=[AugAssign(target=Name(id='instance', ctx=Store(), lineno=81, col_offset=12, end_lineno=81, end_col_offset=20), op=Add(), value=JoinedStr(values=[Constant(value='?', lineno=81, col_offset=26, end_lineno=81, end_col_offset=27), FormattedValue(value=Attribute(value=Attribute(value=Name(id='request', ctx=Load(), lineno=81, col_offset=28, end_lineno=81, end_col_offset=35), attr='url', ctx=Load(), lineno=81, col_offset=28, end_lineno=81, end_col_offset=39), attr='query', ctx=Load(), lineno=81, col_offset=28, end_lineno=81, end_col_offset=45), conversion=-1, lineno=81, col_offset=27, end_lineno=81, end_col_offset=46)], lineno=81, col_offset=24, end_lineno=81, end_col_offset=47), lineno=81, col_offset=12, end_lineno=81, end_col_offset=47)], lineno=80, col_offset=8, end_lineno=81, end_col_offset=47)], lineno=78, col_offset=4, end_lineno=81, end_col_offset=47), AnnAssign(target=Name(id='details', ctx=Store(), lineno=83, col_offset=4, end_lineno=83, end_col_offset=11), annotation=Name(id='ProblemDetails', ctx=Load(), lineno=83, col_offset=13, end_lineno=83, end_col_offset=27), value=Call(func=Attribute(value=Name(id='error', ctx=Load(), lineno=83, col_offset=30, end_lineno=83, end_col_offset=35), attr='to_problem_details', ctx=Load(), lineno=83, col_offset=30, end_lineno=83, end_col_offset=54), keywords=[keyword(arg='instance', value=Name(id='instance', ctx=Load(), lineno=83, col_offset=64, end_lineno=83, end_col_offset=72), lineno=83, col_offset=55, end_lineno=83, end_col_offset=72)], lineno=83, col_offset=30, end_lineno=83, end_col_offset=73), simple=1, lineno=83, col_offset=4, end_lineno=83, end_col_offset=73), Expr(value=Call(func=Attribute(value=Name(id='logger', ctx=Load(), lineno=86, col_offset=4, end_lineno=86, end_col_offset=10), attr='log', ctx=Load(), lineno=86, col_offset=4, end_lineno=86, end_col_offset=14), args=[Attribute(value=Name(id='error', ctx=Load(), lineno=86, col_offset=15, end_lineno=86, end_col_offset=20), attr='log_level', ctx=Load(), lineno=86, col_offset=15, end_lineno=86, end_col_offset=30), Constant(value='Error: %s', lineno=86, col_offset=32, end_lineno=86, end_col_offset=43), Attribute(value=Name(id='error', ctx=Load(), lineno=86, col_offset=45, end_lineno=86, end_col_offset=50), attr='message', ctx=Load(), lineno=86, col_offset=45, end_lineno=86, end_col_offset=58)], keywords=[keyword(arg='exc_info', value=Attribute(value=Name(id='error', ctx=Load(), lineno=86, col_offset=69, end_lineno=86, end_col_offset=74), attr='__cause__', ctx=Load(), lineno=86, col_offset=69, end_lineno=86, end_col_offset=84), lineno=86, col_offset=60, end_lineno=86, end_col_offset=84)], lineno=86, col_offset=4, end_lineno=86, end_col_offset=85), lineno=86, col_offset=4, end_lineno=86, end_col_offset=85), Return(value=Call(func=Name(id='JSONResponse', ctx=Load(), lineno=88, col_offset=11, end_lineno=88, end_col_offset=23), keywords=[keyword(arg='status_code', value=Attribute(value=Name(id='error', ctx=Load(), lineno=89, col_offset=20, end_lineno=89, end_col_offset=25), attr='http_status', ctx=Load(), lineno=89, col_offset=20, end_lineno=89, end_col_offset=37), lineno=89, col_offset=8, end_lineno=89, end_col_offset=37), keyword(arg='content', value=Name(id='details', ctx=Load(), lineno=90, col_offset=16, end_lineno=90, end_col_offset=23), lineno=90, col_offset=8, end_lineno=90, end_col_offset=23), keyword(arg='headers', value=Dict(keys=[Constant(value='Content-Type', lineno=92, col_offset=12, end_lineno=92, end_col_offset=26)], values=[Constant(value='application/problem+json', lineno=92, col_offset=28, end_lineno=92, end_col_offset=54)], lineno=91, col_offset=16, end_lineno=93, end_col_offset=9), lineno=91, col_offset=8, end_lineno=93, end_col_offset=9)], lineno=88, col_offset=11, end_lineno=94, end_col_offset=5), lineno=88, col_offset=4, end_lineno=94, end_col_offset=5)], returns=Name(id='JSONResponse', ctx=Load(), lineno=48, col_offset=5, end_lineno=48, end_col_offset=17), lineno=45, col_offset=0, end_lineno=94, end_col_offset=5), FunctionDef(name='register_problem_details_handler', args=arguments(args=[arg(arg='app', annotation=Name(id='FastAPI', ctx=Load(), lineno=98, col_offset=42, end_lineno=98, end_col_offset=49), lineno=98, col_offset=37, end_lineno=98, end_col_offset=49)]), body=[Expr(value=Constant(value='Register FastAPI exception handler for KgFoundryError.', lineno=99, col_offset=4, end_lineno=99, end_col_offset=64), lineno=99, col_offset=4, end_lineno=99, end_col_offset=64), AsyncFunctionDef(name='_handler', args=arguments(args=[arg(arg='request', annotation=Name(id='Request', ctx=Load(), lineno=101, col_offset=32, end_lineno=101, end_col_offset=39), lineno=101, col_offset=23, end_lineno=101, end_col_offset=39), arg(arg='exc', annotation=Name(id='KgFoundryError', ctx=Load(), lineno=101, col_offset=46, end_lineno=101, end_col_offset=60), lineno=101, col_offset=41, end_lineno=101, end_col_offset=60)]), body=[Return(value=Await(value=Call(func=Attribute(value=Name(id='asyncio', ctx=Load(), lineno=102, col_offset=21, end_lineno=102, end_col_offset=28), attr='to_thread', ctx=Load(), lineno=102, col_offset=21, end_lineno=102, end_col_offset=38), args=[Name(id='problem_details_response', ctx=Load(), lineno=102, col_offset=39, end_lineno=102, end_col_offset=63), Name(id='exc', ctx=Load(), lineno=102, col_offset=65, end_lineno=102, end_col_offset=68), Name(id='request', ctx=Load(), lineno=102, col_offset=70, end_lineno=102, end_col_offset=77)], lineno=102, col_offset=21, end_lineno=102, end_col_offset=78), lineno=102, col_offset=15, end_lineno=102, end_col_offset=78), lineno=102, col_offset=8, end_lineno=102, end_col_offset=78)], returns=Name(id='JSONResponse', ctx=Load(), lineno=101, col_offset=65, end_lineno=101, end_col_offset=77), lineno=101, col_offset=4, end_lineno=102, end_col_offset=78), Expr(value=Call(func=Name(id='typed_exception_handler', ctx=Load(), lineno=104, col_offset=4, end_lineno=104, end_col_offset=27), args=[Name(id='app', ctx=Load(), lineno=105, col_offset=8, end_lineno=105, end_col_offset=11), Name(id='KgFoundryError', ctx=Load(), lineno=106, col_offset=8, end_lineno=106, end_col_offset=22), Name(id='_handler', ctx=Load(), lineno=107, col_offset=8, end_lineno=107, end_col_offset=16)], keywords=[keyword(arg='name', value=Constant(value='kgfoundry_error_handler', lineno=108, col_offset=13, end_lineno=108, end_col_offset=38), lineno=108, col_offset=8, end_lineno=108, end_col_offset=38)], lineno=104, col_offset=4, end_lineno=109, end_col_offset=5), lineno=104, col_offset=4, end_lineno=109, end_col_offset=5)], returns=Constant(value=None, lineno=98, col_offset=54, end_lineno=98, end_col_offset=58), lineno=98, col_offset=0, end_lineno=109, end_col_offset=5)])