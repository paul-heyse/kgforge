Module(body=[Expr(value=Constant(value='DuckDB catalog for querying Parquet chunks.\n\nProvides SQL views over Parquet directories and query helpers for fast\nchunk retrieval and joins.\n', lineno=1, col_offset=0, end_lineno=5, end_col_offset=3), lineno=1, col_offset=0, end_lineno=5, end_col_offset=3), ImportFrom(module='__future__', names=[alias(name='annotations', lineno=7, col_offset=23, end_lineno=7, end_col_offset=34)], level=0, lineno=7, col_offset=0, end_lineno=7, end_col_offset=34), ImportFrom(module='collections.abc', names=[alias(name='Iterator', lineno=9, col_offset=28, end_lineno=9, end_col_offset=36), alias(name='Sequence', lineno=9, col_offset=38, end_lineno=9, end_col_offset=46)], level=0, lineno=9, col_offset=0, end_lineno=9, end_col_offset=46), ImportFrom(module='contextlib', names=[alias(name='contextmanager', lineno=10, col_offset=23, end_lineno=10, end_col_offset=37), alias(name='suppress', lineno=10, col_offset=39, end_lineno=10, end_col_offset=47)], level=0, lineno=10, col_offset=0, end_lineno=10, end_col_offset=47), ImportFrom(module='dataclasses', names=[alias(name='dataclass', lineno=11, col_offset=24, end_lineno=11, end_col_offset=33)], level=0, lineno=11, col_offset=0, end_lineno=11, end_col_offset=33), ImportFrom(module='pathlib', names=[alias(name='Path', lineno=12, col_offset=20, end_lineno=12, end_col_offset=24)], level=0, lineno=12, col_offset=0, end_lineno=12, end_col_offset=24), ImportFrom(module='threading', names=[alias(name='Lock', lineno=13, col_offset=22, end_lineno=13, end_col_offset=26)], level=0, lineno=13, col_offset=0, end_lineno=13, end_col_offset=26), ImportFrom(module='time', names=[alias(name='perf_counter', lineno=14, col_offset=17, end_lineno=14, end_col_offset=29)], level=0, lineno=14, col_offset=0, end_lineno=14, end_col_offset=29), ImportFrom(module='typing', names=[alias(name='Self', lineno=15, col_offset=19, end_lineno=15, end_col_offset=23)], level=0, lineno=15, col_offset=0, end_lineno=15, end_col_offset=23), Import(names=[alias(name='duckdb', lineno=17, col_offset=7, end_lineno=17, end_col_offset=13)], lineno=17, col_offset=0, end_lineno=17, end_col_offset=13), Import(names=[alias(name='numpy', asname='np', lineno=18, col_offset=7, end_lineno=18, end_col_offset=18)], lineno=18, col_offset=0, end_lineno=18, end_col_offset=18), ImportFrom(module='codeintel_rev.io.duckdb_manager', names=[alias(name='DuckDBManager', lineno=21, col_offset=4, end_lineno=21, end_col_offset=17), alias(name='DuckDBQueryBuilder', lineno=22, col_offset=4, end_lineno=22, end_col_offset=22), alias(name='DuckDBQueryOptions', lineno=23, col_offset=4, end_lineno=23, end_col_offset=22)], level=0, lineno=20, col_offset=0, end_lineno=24, end_col_offset=1), ImportFrom(module='codeintel_rev.mcp_server.scope_utils', names=[alias(name='LANGUAGE_EXTENSIONS', lineno=26, col_offset=4, end_lineno=26, end_col_offset=23), alias(name='path_matches_glob', lineno=27, col_offset=4, end_lineno=27, end_col_offset=21)], level=0, lineno=25, col_offset=0, end_lineno=28, end_col_offset=1), ImportFrom(module='kgfoundry_common.logging', names=[alias(name='get_logger', lineno=29, col_offset=37, end_lineno=29, end_col_offset=47)], level=0, lineno=29, col_offset=0, end_lineno=29, end_col_offset=47), ImportFrom(module='kgfoundry_common.prometheus', names=[alias(name='build_histogram', lineno=30, col_offset=40, end_lineno=30, end_col_offset=55)], level=0, lineno=30, col_offset=0, end_lineno=30, end_col_offset=55), Assign(targets=[Name(id='LOGGER', ctx=Store(), lineno=32, col_offset=0, end_lineno=32, end_col_offset=6)], value=Call(func=Name(id='get_logger', ctx=Load(), lineno=32, col_offset=9, end_lineno=32, end_col_offset=19), args=[Name(id='__name__', ctx=Load(), lineno=32, col_offset=20, end_lineno=32, end_col_offset=28)], lineno=32, col_offset=9, end_lineno=32, end_col_offset=29), lineno=32, col_offset=0, end_lineno=32, end_col_offset=29), Assign(targets=[Name(id='_scope_filter_duration_seconds', ctx=Store(), lineno=35, col_offset=0, end_lineno=35, end_col_offset=30)], value=Call(func=Name(id='build_histogram', ctx=Load(), lineno=35, col_offset=33, end_lineno=35, end_col_offset=48), args=[Constant(value='codeintel_scope_filter_duration_seconds', lineno=36, col_offset=4, end_lineno=36, end_col_offset=45), Constant(value='Time to apply scope filters', lineno=37, col_offset=4, end_lineno=37, end_col_offset=33)], keywords=[keyword(arg='labelnames', value=Tuple(elts=[Constant(value='filter_type', lineno=38, col_offset=16, end_lineno=38, end_col_offset=29)], ctx=Load(), lineno=38, col_offset=15, end_lineno=38, end_col_offset=31), lineno=38, col_offset=4, end_lineno=38, end_col_offset=31)], lineno=35, col_offset=33, end_lineno=39, end_col_offset=1), lineno=35, col_offset=0, end_lineno=39, end_col_offset=1), Assign(targets=[Name(id='_EMPTY_CHUNKS_SELECT', ctx=Store(), lineno=41, col_offset=0, end_lineno=41, end_col_offset=20)], value=Constant(value='\nSELECT\n    CAST(NULL AS BIGINT) AS id,\n    CAST(NULL AS VARCHAR) AS uri,\n    CAST(NULL AS INTEGER) AS start_line,\n    CAST(NULL AS INTEGER) AS end_line,\n    CAST(NULL AS BIGINT) AS start_byte,\n    CAST(NULL AS BIGINT) AS end_byte,\n    CAST(NULL AS VARCHAR) AS preview,\n    CAST(NULL AS VARCHAR) AS content,\n    CAST(NULL AS VARCHAR) AS lang,\n            CAST(NULL AS FLOAT[]) AS embedding\nWHERE 1 = 0\n', lineno=41, col_offset=23, end_lineno=54, end_col_offset=3), lineno=41, col_offset=0, end_lineno=54, end_col_offset=3), ClassDef(name='_ScopeFilterSpec', body=[Expr(value=Constant(value='Structured scope filter metadata used during scoped queries.', lineno=59, col_offset=4, end_lineno=59, end_col_offset=70), lineno=59, col_offset=4, end_lineno=59, end_col_offset=70), AnnAssign(target=Name(id='chunk_ids', ctx=Store(), lineno=61, col_offset=4, end_lineno=61, end_col_offset=13), annotation=Subscript(value=Name(id='tuple', ctx=Load(), lineno=61, col_offset=15, end_lineno=61, end_col_offset=20), slice=Tuple(elts=[Name(id='int', ctx=Load(), lineno=61, col_offset=21, end_lineno=61, end_col_offset=24), Constant(value=Ellipsis, lineno=61, col_offset=26, end_lineno=61, end_col_offset=29)], ctx=Load(), lineno=61, col_offset=21, end_lineno=61, end_col_offset=29), ctx=Load(), lineno=61, col_offset=15, end_lineno=61, end_col_offset=30), simple=1, lineno=61, col_offset=4, end_lineno=61, end_col_offset=30), AnnAssign(target=Name(id='simple_include_globs', ctx=Store(), lineno=62, col_offset=4, end_lineno=62, end_col_offset=24), annotation=BinOp(left=Subscript(value=Name(id='tuple', ctx=Load(), lineno=62, col_offset=26, end_lineno=62, end_col_offset=31), slice=Tuple(elts=[Name(id='str', ctx=Load(), lineno=62, col_offset=32, end_lineno=62, end_col_offset=35), Constant(value=Ellipsis, lineno=62, col_offset=37, end_lineno=62, end_col_offset=40)], ctx=Load(), lineno=62, col_offset=32, end_lineno=62, end_col_offset=40), ctx=Load(), lineno=62, col_offset=26, end_lineno=62, end_col_offset=41), op=BitOr(), right=Constant(value=None, lineno=62, col_offset=44, end_lineno=62, end_col_offset=48), lineno=62, col_offset=26, end_lineno=62, end_col_offset=48), simple=1, lineno=62, col_offset=4, end_lineno=62, end_col_offset=48), AnnAssign(target=Name(id='simple_exclude_globs', ctx=Store(), lineno=63, col_offset=4, end_lineno=63, end_col_offset=24), annotation=BinOp(left=Subscript(value=Name(id='tuple', ctx=Load(), lineno=63, col_offset=26, end_lineno=63, end_col_offset=31), slice=Tuple(elts=[Name(id='str', ctx=Load(), lineno=63, col_offset=32, end_lineno=63, end_col_offset=35), Constant(value=Ellipsis, lineno=63, col_offset=37, end_lineno=63, end_col_offset=40)], ctx=Load(), lineno=63, col_offset=32, end_lineno=63, end_col_offset=40), ctx=Load(), lineno=63, col_offset=26, end_lineno=63, end_col_offset=41), op=BitOr(), right=Constant(value=None, lineno=63, col_offset=44, end_lineno=63, end_col_offset=48), lineno=63, col_offset=26, end_lineno=63, end_col_offset=48), simple=1, lineno=63, col_offset=4, end_lineno=63, end_col_offset=48), AnnAssign(target=Name(id='complex_include_patterns', ctx=Store(), lineno=64, col_offset=4, end_lineno=64, end_col_offset=28), annotation=Subscript(value=Name(id='tuple', ctx=Load(), lineno=64, col_offset=30, end_lineno=64, end_col_offset=35), slice=Tuple(elts=[Name(id='str', ctx=Load(), lineno=64, col_offset=36, end_lineno=64, end_col_offset=39), Constant(value=Ellipsis, lineno=64, col_offset=41, end_lineno=64, end_col_offset=44)], ctx=Load(), lineno=64, col_offset=36, end_lineno=64, end_col_offset=44), ctx=Load(), lineno=64, col_offset=30, end_lineno=64, end_col_offset=45), simple=1, lineno=64, col_offset=4, end_lineno=64, end_col_offset=45), AnnAssign(target=Name(id='complex_exclude_patterns', ctx=Store(), lineno=65, col_offset=4, end_lineno=65, end_col_offset=28), annotation=Subscript(value=Name(id='tuple', ctx=Load(), lineno=65, col_offset=30, end_lineno=65, end_col_offset=35), slice=Tuple(elts=[Name(id='str', ctx=Load(), lineno=65, col_offset=36, end_lineno=65, end_col_offset=39), Constant(value=Ellipsis, lineno=65, col_offset=41, end_lineno=65, end_col_offset=44)], ctx=Load(), lineno=65, col_offset=36, end_lineno=65, end_col_offset=44), ctx=Load(), lineno=65, col_offset=30, end_lineno=65, end_col_offset=45), simple=1, lineno=65, col_offset=4, end_lineno=65, end_col_offset=45), AnnAssign(target=Name(id='language_extensions', ctx=Store(), lineno=66, col_offset=4, end_lineno=66, end_col_offset=23), annotation=Subscript(value=Name(id='frozenset', ctx=Load(), lineno=66, col_offset=25, end_lineno=66, end_col_offset=34), slice=Name(id='str', ctx=Load(), lineno=66, col_offset=35, end_lineno=66, end_col_offset=38), ctx=Load(), lineno=66, col_offset=25, end_lineno=66, end_col_offset=39), simple=1, lineno=66, col_offset=4, end_lineno=66, end_col_offset=39), FunctionDef(name='has_complex_globs', args=arguments(args=[arg(arg='self', lineno=69, col_offset=26, end_lineno=69, end_col_offset=30)]), body=[Expr(value=Constant(value='Return ``True`` when complex include/exclude patterns exist.', lineno=70, col_offset=8, end_lineno=70, end_col_offset=74), lineno=70, col_offset=8, end_lineno=70, end_col_offset=74), Return(value=Call(func=Name(id='bool', ctx=Load(), lineno=71, col_offset=15, end_lineno=71, end_col_offset=19), args=[BoolOp(op=Or(), values=[Attribute(value=Name(id='self', ctx=Load(), lineno=71, col_offset=20, end_lineno=71, end_col_offset=24), attr='complex_include_patterns', ctx=Load(), lineno=71, col_offset=20, end_lineno=71, end_col_offset=49), Attribute(value=Name(id='self', ctx=Load(), lineno=71, col_offset=53, end_lineno=71, end_col_offset=57), attr='complex_exclude_patterns', ctx=Load(), lineno=71, col_offset=53, end_lineno=71, end_col_offset=82)], lineno=71, col_offset=20, end_lineno=71, end_col_offset=82)], lineno=71, col_offset=15, end_lineno=71, end_col_offset=83), lineno=71, col_offset=8, end_lineno=71, end_col_offset=83)], decorator_list=[Name(id='property', ctx=Load(), lineno=68, col_offset=5, end_lineno=68, end_col_offset=13)], returns=Name(id='bool', ctx=Load(), lineno=69, col_offset=35, end_lineno=69, end_col_offset=39), lineno=69, col_offset=4, end_lineno=71, end_col_offset=83)], decorator_list=[Call(func=Name(id='dataclass', ctx=Load(), lineno=57, col_offset=1, end_lineno=57, end_col_offset=10), keywords=[keyword(arg='frozen', value=Constant(value=True, lineno=57, col_offset=18, end_lineno=57, end_col_offset=22), lineno=57, col_offset=11, end_lineno=57, end_col_offset=22)], lineno=57, col_offset=1, end_lineno=57, end_col_offset=23)], lineno=58, col_offset=0, end_lineno=71, end_col_offset=83), ClassDef(name='DuckDBCatalog', body=[Expr(value=Constant(value='DuckDB catalog for querying chunks.\n\n    Parameters\n    ----------\n    db_path : Path\n        DuckDB database path.\n    vectors_dir : Path\n        Directory containing Parquet files.\n    materialize : bool, optional\n        When ``True``, chunk metadata is materialized into a persisted DuckDB\n        table (``chunks_materialized``) with a secondary index on ``uri``. When\n        ``False`` (default), the catalog exposes Parquet files through a view for\n        zero-copy queries.\n    manager : DuckDBManager | None, optional\n        DuckDB connection manager instance. If ``None``, creates a new manager\n        with default configuration. Defaults to ``None``.\n    log_queries : bool | None, optional\n        Enable debug logging of executed SQL statements when ``True``. Defaults to\n        ``None`` which inherits the global logging configuration.\n    ', lineno=75, col_offset=4, end_lineno=94, end_col_offset=7), lineno=75, col_offset=4, end_lineno=94, end_col_offset=7), FunctionDef(name='__init__', args=arguments(args=[arg(arg='self', lineno=97, col_offset=8, end_lineno=97, end_col_offset=12), arg(arg='db_path', annotation=Name(id='Path', ctx=Load(), lineno=98, col_offset=17, end_lineno=98, end_col_offset=21), lineno=98, col_offset=8, end_lineno=98, end_col_offset=21), arg(arg='vectors_dir', annotation=Name(id='Path', ctx=Load(), lineno=99, col_offset=21, end_lineno=99, end_col_offset=25), lineno=99, col_offset=8, end_lineno=99, end_col_offset=25)], kwonlyargs=[arg(arg='materialize', annotation=Name(id='bool', ctx=Load(), lineno=101, col_offset=21, end_lineno=101, end_col_offset=25), lineno=101, col_offset=8, end_lineno=101, end_col_offset=25), arg(arg='manager', annotation=BinOp(left=Name(id='DuckDBManager', ctx=Load(), lineno=102, col_offset=17, end_lineno=102, end_col_offset=30), op=BitOr(), right=Constant(value=None, lineno=102, col_offset=33, end_lineno=102, end_col_offset=37), lineno=102, col_offset=17, end_lineno=102, end_col_offset=37), lineno=102, col_offset=8, end_lineno=102, end_col_offset=37), arg(arg='log_queries', annotation=BinOp(left=Name(id='bool', ctx=Load(), lineno=103, col_offset=21, end_lineno=103, end_col_offset=25), op=BitOr(), right=Constant(value=None, lineno=103, col_offset=28, end_lineno=103, end_col_offset=32), lineno=103, col_offset=21, end_lineno=103, end_col_offset=32), lineno=103, col_offset=8, end_lineno=103, end_col_offset=32)], kw_defaults=[Constant(value=False, lineno=101, col_offset=28, end_lineno=101, end_col_offset=33), Constant(value=None, lineno=102, col_offset=40, end_lineno=102, end_col_offset=44), Constant(value=None, lineno=103, col_offset=35, end_lineno=103, end_col_offset=39)]), body=[Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=105, col_offset=8, end_lineno=105, end_col_offset=12), attr='db_path', ctx=Store(), lineno=105, col_offset=8, end_lineno=105, end_col_offset=20)], value=Name(id='db_path', ctx=Load(), lineno=105, col_offset=23, end_lineno=105, end_col_offset=30), lineno=105, col_offset=8, end_lineno=105, end_col_offset=30), Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=106, col_offset=8, end_lineno=106, end_col_offset=12), attr='vectors_dir', ctx=Store(), lineno=106, col_offset=8, end_lineno=106, end_col_offset=24)], value=Name(id='vectors_dir', ctx=Load(), lineno=106, col_offset=27, end_lineno=106, end_col_offset=38), lineno=106, col_offset=8, end_lineno=106, end_col_offset=38), Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=107, col_offset=8, end_lineno=107, end_col_offset=12), attr='materialize', ctx=Store(), lineno=107, col_offset=8, end_lineno=107, end_col_offset=24)], value=Name(id='materialize', ctx=Load(), lineno=107, col_offset=27, end_lineno=107, end_col_offset=38), lineno=107, col_offset=8, end_lineno=107, end_col_offset=38), Assign(targets=[Name(id='manager', ctx=Store(), lineno=108, col_offset=8, end_lineno=108, end_col_offset=15)], value=BoolOp(op=Or(), values=[Name(id='manager', ctx=Load(), lineno=108, col_offset=18, end_lineno=108, end_col_offset=25), Call(func=Name(id='DuckDBManager', ctx=Load(), lineno=108, col_offset=29, end_lineno=108, end_col_offset=42), args=[Name(id='db_path', ctx=Load(), lineno=108, col_offset=43, end_lineno=108, end_col_offset=50)], lineno=108, col_offset=29, end_lineno=108, end_col_offset=51)], lineno=108, col_offset=18, end_lineno=108, end_col_offset=51), lineno=108, col_offset=8, end_lineno=108, end_col_offset=51), Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=109, col_offset=8, end_lineno=109, end_col_offset=12), attr='_manager', ctx=Store(), lineno=109, col_offset=8, end_lineno=109, end_col_offset=21)], value=Name(id='manager', ctx=Load(), lineno=109, col_offset=24, end_lineno=109, end_col_offset=31), lineno=109, col_offset=8, end_lineno=109, end_col_offset=31), Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=110, col_offset=8, end_lineno=110, end_col_offset=12), attr='_query_builder', ctx=Store(), lineno=110, col_offset=8, end_lineno=110, end_col_offset=27)], value=Call(func=Name(id='DuckDBQueryBuilder', ctx=Load(), lineno=110, col_offset=30, end_lineno=110, end_col_offset=48), lineno=110, col_offset=30, end_lineno=110, end_col_offset=50), lineno=110, col_offset=8, end_lineno=110, end_col_offset=50), AnnAssign(target=Attribute(value=Name(id='self', ctx=Load(), lineno=111, col_offset=8, end_lineno=111, end_col_offset=12), attr='_embedding_dim_cache', ctx=Store(), lineno=111, col_offset=8, end_lineno=111, end_col_offset=33), annotation=BinOp(left=Name(id='int', ctx=Load(), lineno=111, col_offset=35, end_lineno=111, end_col_offset=38), op=BitOr(), right=Constant(value=None, lineno=111, col_offset=41, end_lineno=111, end_col_offset=45), lineno=111, col_offset=35, end_lineno=111, end_col_offset=45), value=Constant(value=None, lineno=111, col_offset=48, end_lineno=111, end_col_offset=52), simple=0, lineno=111, col_offset=8, end_lineno=111, end_col_offset=52), Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=112, col_offset=8, end_lineno=112, end_col_offset=12), attr='_init_lock', ctx=Store(), lineno=112, col_offset=8, end_lineno=112, end_col_offset=23)], value=Call(func=Name(id='Lock', ctx=Load(), lineno=112, col_offset=26, end_lineno=112, end_col_offset=30), lineno=112, col_offset=26, end_lineno=112, end_col_offset=32), lineno=112, col_offset=8, end_lineno=112, end_col_offset=32), Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=113, col_offset=8, end_lineno=113, end_col_offset=12), attr='_views_ready', ctx=Store(), lineno=113, col_offset=8, end_lineno=113, end_col_offset=25)], value=Constant(value=False, lineno=113, col_offset=28, end_lineno=113, end_col_offset=33), lineno=113, col_offset=8, end_lineno=113, end_col_offset=33), Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=114, col_offset=8, end_lineno=114, end_col_offset=12), attr='_log_queries', ctx=Store(), lineno=114, col_offset=8, end_lineno=114, end_col_offset=25)], value=IfExp(test=Compare(left=Name(id='log_queries', ctx=Load(), lineno=114, col_offset=43, end_lineno=114, end_col_offset=54), ops=[IsNot()], comparators=[Constant(value=None, lineno=114, col_offset=62, end_lineno=114, end_col_offset=66)], lineno=114, col_offset=43, end_lineno=114, end_col_offset=66), body=Name(id='log_queries', ctx=Load(), lineno=114, col_offset=28, end_lineno=114, end_col_offset=39), orelse=Attribute(value=Attribute(value=Name(id='manager', ctx=Load(), lineno=114, col_offset=72, end_lineno=114, end_col_offset=79), attr='config', ctx=Load(), lineno=114, col_offset=72, end_lineno=114, end_col_offset=86), attr='log_queries', ctx=Load(), lineno=114, col_offset=72, end_lineno=114, end_col_offset=98), lineno=114, col_offset=28, end_lineno=114, end_col_offset=98), lineno=114, col_offset=8, end_lineno=114, end_col_offset=98)], returns=Constant(value=None, lineno=104, col_offset=9, end_lineno=104, end_col_offset=13), lineno=96, col_offset=4, end_lineno=114, end_col_offset=98), FunctionDef(name='open', args=arguments(args=[arg(arg='self', lineno=116, col_offset=13, end_lineno=116, end_col_offset=17)]), body=[Expr(value=Constant(value='Ensure catalog views are initialized.', lineno=117, col_offset=8, end_lineno=117, end_col_offset=51), lineno=117, col_offset=8, end_lineno=117, end_col_offset=51), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load(), lineno=118, col_offset=8, end_lineno=118, end_col_offset=12), attr='_ensure_ready', ctx=Load(), lineno=118, col_offset=8, end_lineno=118, end_col_offset=26), lineno=118, col_offset=8, end_lineno=118, end_col_offset=28), lineno=118, col_offset=8, end_lineno=118, end_col_offset=28)], returns=Constant(value=None, lineno=116, col_offset=22, end_lineno=116, end_col_offset=26), lineno=116, col_offset=4, end_lineno=118, end_col_offset=28), FunctionDef(name='close', args=arguments(args=[arg(arg='self', lineno=120, col_offset=14, end_lineno=120, end_col_offset=18)]), body=[Expr(value=Constant(value='No-op for compatibility; connections are per-use via the manager.', lineno=121, col_offset=8, end_lineno=121, end_col_offset=79), lineno=121, col_offset=8, end_lineno=121, end_col_offset=79), Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=122, col_offset=8, end_lineno=122, end_col_offset=12), attr='_embedding_dim_cache', ctx=Store(), lineno=122, col_offset=8, end_lineno=122, end_col_offset=33)], value=Constant(value=None, lineno=122, col_offset=36, end_lineno=122, end_col_offset=40), lineno=122, col_offset=8, end_lineno=122, end_col_offset=40)], returns=Constant(value=None, lineno=120, col_offset=23, end_lineno=120, end_col_offset=27), lineno=120, col_offset=4, end_lineno=122, end_col_offset=40), FunctionDef(name='__enter__', args=arguments(args=[arg(arg='self', lineno=124, col_offset=18, end_lineno=124, end_col_offset=22)]), body=[Expr(value=Constant(value='Enter context manager.\n\n        Returns\n        -------\n        Self\n            The catalog instance with an active DuckDB connection.\n        ', lineno=125, col_offset=8, end_lineno=131, end_col_offset=11), lineno=125, col_offset=8, end_lineno=131, end_col_offset=11), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load(), lineno=132, col_offset=8, end_lineno=132, end_col_offset=12), attr='open', ctx=Load(), lineno=132, col_offset=8, end_lineno=132, end_col_offset=17), lineno=132, col_offset=8, end_lineno=132, end_col_offset=19), lineno=132, col_offset=8, end_lineno=132, end_col_offset=19), Return(value=Name(id='self', ctx=Load(), lineno=133, col_offset=15, end_lineno=133, end_col_offset=19), lineno=133, col_offset=8, end_lineno=133, end_col_offset=19)], returns=Name(id='Self', ctx=Load(), lineno=124, col_offset=27, end_lineno=124, end_col_offset=31), lineno=124, col_offset=4, end_lineno=133, end_col_offset=19), FunctionDef(name='__exit__', args=arguments(args=[arg(arg='self', lineno=135, col_offset=17, end_lineno=135, end_col_offset=21)], vararg=arg(arg='exc', annotation=Name(id='object', ctx=Load(), lineno=135, col_offset=29, end_lineno=135, end_col_offset=35), lineno=135, col_offset=24, end_lineno=135, end_col_offset=35)), body=[Expr(value=Constant(value='Exit context manager.', lineno=136, col_offset=8, end_lineno=136, end_col_offset=35), lineno=136, col_offset=8, end_lineno=136, end_col_offset=35), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load(), lineno=137, col_offset=8, end_lineno=137, end_col_offset=12), attr='close', ctx=Load(), lineno=137, col_offset=8, end_lineno=137, end_col_offset=18), lineno=137, col_offset=8, end_lineno=137, end_col_offset=20), lineno=137, col_offset=8, end_lineno=137, end_col_offset=20)], returns=Constant(value=None, lineno=135, col_offset=40, end_lineno=135, end_col_offset=44), lineno=135, col_offset=4, end_lineno=137, end_col_offset=20), FunctionDef(name='manager', args=arguments(args=[arg(arg='self', lineno=140, col_offset=16, end_lineno=140, end_col_offset=20)]), body=[Expr(value=Constant(value='Return the underlying DuckDB manager.', lineno=141, col_offset=8, end_lineno=141, end_col_offset=51), lineno=141, col_offset=8, end_lineno=141, end_col_offset=51), Return(value=Attribute(value=Name(id='self', ctx=Load(), lineno=142, col_offset=15, end_lineno=142, end_col_offset=19), attr='_manager', ctx=Load(), lineno=142, col_offset=15, end_lineno=142, end_col_offset=28), lineno=142, col_offset=8, end_lineno=142, end_col_offset=28)], decorator_list=[Name(id='property', ctx=Load(), lineno=139, col_offset=5, end_lineno=139, end_col_offset=13)], returns=Name(id='DuckDBManager', ctx=Load(), lineno=140, col_offset=25, end_lineno=140, end_col_offset=38), lineno=140, col_offset=4, end_lineno=142, end_col_offset=28), FunctionDef(name='_ensure_ready', args=arguments(args=[arg(arg='self', lineno=144, col_offset=22, end_lineno=144, end_col_offset=26)]), body=[Expr(value=Constant(value='Initialize catalog views once in a threadsafe manner.', lineno=145, col_offset=8, end_lineno=145, end_col_offset=67), lineno=145, col_offset=8, end_lineno=145, end_col_offset=67), If(test=Attribute(value=Name(id='self', ctx=Load(), lineno=146, col_offset=11, end_lineno=146, end_col_offset=15), attr='_views_ready', ctx=Load(), lineno=146, col_offset=11, end_lineno=146, end_col_offset=28), body=[Return(lineno=147, col_offset=12, end_lineno=147, end_col_offset=18)], lineno=146, col_offset=8, end_lineno=147, end_col_offset=18), With(items=[withitem(context_expr=Attribute(value=Name(id='self', ctx=Load(), lineno=148, col_offset=13, end_lineno=148, end_col_offset=17), attr='_init_lock', ctx=Load(), lineno=148, col_offset=13, end_lineno=148, end_col_offset=28))], body=[If(test=Attribute(value=Name(id='self', ctx=Load(), lineno=149, col_offset=15, end_lineno=149, end_col_offset=19), attr='_views_ready', ctx=Load(), lineno=149, col_offset=15, end_lineno=149, end_col_offset=32), body=[Return(lineno=150, col_offset=16, end_lineno=150, end_col_offset=22)], lineno=149, col_offset=12, end_lineno=150, end_col_offset=22), With(items=[withitem(context_expr=Call(func=Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=151, col_offset=17, end_lineno=151, end_col_offset=21), attr='_manager', ctx=Load(), lineno=151, col_offset=17, end_lineno=151, end_col_offset=30), attr='connection', ctx=Load(), lineno=151, col_offset=17, end_lineno=151, end_col_offset=41), lineno=151, col_offset=17, end_lineno=151, end_col_offset=43), optional_vars=Name(id='conn', ctx=Store(), lineno=151, col_offset=47, end_lineno=151, end_col_offset=51))], body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load(), lineno=152, col_offset=16, end_lineno=152, end_col_offset=20), attr='_ensure_views', ctx=Load(), lineno=152, col_offset=16, end_lineno=152, end_col_offset=34), args=[Name(id='conn', ctx=Load(), lineno=152, col_offset=35, end_lineno=152, end_col_offset=39)], lineno=152, col_offset=16, end_lineno=152, end_col_offset=40), lineno=152, col_offset=16, end_lineno=152, end_col_offset=40)], lineno=151, col_offset=12, end_lineno=152, end_col_offset=40), Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=153, col_offset=12, end_lineno=153, end_col_offset=16), attr='_views_ready', ctx=Store(), lineno=153, col_offset=12, end_lineno=153, end_col_offset=29)], value=Constant(value=True, lineno=153, col_offset=32, end_lineno=153, end_col_offset=36), lineno=153, col_offset=12, end_lineno=153, end_col_offset=36)], lineno=148, col_offset=8, end_lineno=153, end_col_offset=36)], returns=Constant(value=None, lineno=144, col_offset=31, end_lineno=144, end_col_offset=35), lineno=144, col_offset=4, end_lineno=153, end_col_offset=36), FunctionDef(name='connection', args=arguments(args=[arg(arg='self', lineno=156, col_offset=19, end_lineno=156, end_col_offset=23)]), body=[Expr(value=Constant(value='Yield a configured DuckDB connection.\n\n        Yields\n        ------\n        duckdb.DuckDBPyConnection\n            Connection configured with catalog pragmas and ready for queries.\n        ', lineno=157, col_offset=8, end_lineno=163, end_col_offset=11), lineno=157, col_offset=8, end_lineno=163, end_col_offset=11), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load(), lineno=164, col_offset=8, end_lineno=164, end_col_offset=12), attr='_ensure_ready', ctx=Load(), lineno=164, col_offset=8, end_lineno=164, end_col_offset=26), lineno=164, col_offset=8, end_lineno=164, end_col_offset=28), lineno=164, col_offset=8, end_lineno=164, end_col_offset=28), With(items=[withitem(context_expr=Call(func=Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=165, col_offset=13, end_lineno=165, end_col_offset=17), attr='_manager', ctx=Load(), lineno=165, col_offset=13, end_lineno=165, end_col_offset=26), attr='connection', ctx=Load(), lineno=165, col_offset=13, end_lineno=165, end_col_offset=37), lineno=165, col_offset=13, end_lineno=165, end_col_offset=39), optional_vars=Name(id='conn', ctx=Store(), lineno=165, col_offset=43, end_lineno=165, end_col_offset=47))], body=[Expr(value=Yield(value=Name(id='conn', ctx=Load(), lineno=166, col_offset=18, end_lineno=166, end_col_offset=22), lineno=166, col_offset=12, end_lineno=166, end_col_offset=22), lineno=166, col_offset=12, end_lineno=166, end_col_offset=22)], lineno=165, col_offset=8, end_lineno=166, end_col_offset=22)], decorator_list=[Name(id='contextmanager', ctx=Load(), lineno=155, col_offset=5, end_lineno=155, end_col_offset=19)], returns=Subscript(value=Name(id='Iterator', ctx=Load(), lineno=156, col_offset=28, end_lineno=156, end_col_offset=36), slice=Attribute(value=Name(id='duckdb', ctx=Load(), lineno=156, col_offset=37, end_lineno=156, end_col_offset=43), attr='DuckDBPyConnection', ctx=Load(), lineno=156, col_offset=37, end_lineno=156, end_col_offset=62), ctx=Load(), lineno=156, col_offset=28, end_lineno=156, end_col_offset=63), lineno=156, col_offset=4, end_lineno=166, end_col_offset=22), FunctionDef(name='_log_query', args=arguments(args=[arg(arg='self', lineno=168, col_offset=19, end_lineno=168, end_col_offset=23), arg(arg='sql', annotation=Name(id='str', ctx=Load(), lineno=168, col_offset=30, end_lineno=168, end_col_offset=33), lineno=168, col_offset=25, end_lineno=168, end_col_offset=33), arg(arg='params', annotation=BinOp(left=Name(id='object', ctx=Load(), lineno=168, col_offset=43, end_lineno=168, end_col_offset=49), op=BitOr(), right=Constant(value=None, lineno=168, col_offset=52, end_lineno=168, end_col_offset=56), lineno=168, col_offset=43, end_lineno=168, end_col_offset=56), lineno=168, col_offset=35, end_lineno=168, end_col_offset=56)], defaults=[Constant(value=None, lineno=168, col_offset=59, end_lineno=168, end_col_offset=63)]), body=[Expr(value=Constant(value='Emit debug log for executed DuckDB statement when enabled.', lineno=169, col_offset=8, end_lineno=169, end_col_offset=72), lineno=169, col_offset=8, end_lineno=169, end_col_offset=72), If(test=UnaryOp(op=Not(), operand=Attribute(value=Name(id='self', ctx=Load(), lineno=170, col_offset=15, end_lineno=170, end_col_offset=19), attr='_log_queries', ctx=Load(), lineno=170, col_offset=15, end_lineno=170, end_col_offset=32), lineno=170, col_offset=11, end_lineno=170, end_col_offset=32), body=[Return(lineno=171, col_offset=12, end_lineno=171, end_col_offset=18)], lineno=170, col_offset=8, end_lineno=171, end_col_offset=18), Expr(value=Call(func=Attribute(value=Name(id='LOGGER', ctx=Load(), lineno=172, col_offset=8, end_lineno=172, end_col_offset=14), attr='debug', ctx=Load(), lineno=172, col_offset=8, end_lineno=172, end_col_offset=20), args=[Constant(value='duckdb_query', lineno=173, col_offset=12, end_lineno=173, end_col_offset=26)], keywords=[keyword(arg='extra', value=Dict(keys=[Constant(value='sql', lineno=175, col_offset=16, end_lineno=175, end_col_offset=21), Constant(value='params', lineno=176, col_offset=16, end_lineno=176, end_col_offset=24), Constant(value='duckdb_path', lineno=177, col_offset=16, end_lineno=177, end_col_offset=29)], values=[Call(func=Attribute(value=Name(id='sql', ctx=Load(), lineno=175, col_offset=23, end_lineno=175, end_col_offset=26), attr='strip', ctx=Load(), lineno=175, col_offset=23, end_lineno=175, end_col_offset=32), lineno=175, col_offset=23, end_lineno=175, end_col_offset=34), Name(id='params', ctx=Load(), lineno=176, col_offset=26, end_lineno=176, end_col_offset=32), Call(func=Name(id='str', ctx=Load(), lineno=177, col_offset=31, end_lineno=177, end_col_offset=34), args=[Attribute(value=Name(id='self', ctx=Load(), lineno=177, col_offset=35, end_lineno=177, end_col_offset=39), attr='db_path', ctx=Load(), lineno=177, col_offset=35, end_lineno=177, end_col_offset=47)], lineno=177, col_offset=31, end_lineno=177, end_col_offset=48)], lineno=174, col_offset=18, end_lineno=178, end_col_offset=13), lineno=174, col_offset=12, end_lineno=178, end_col_offset=13)], lineno=172, col_offset=8, end_lineno=179, end_col_offset=9), lineno=172, col_offset=8, end_lineno=179, end_col_offset=9)], returns=Constant(value=None, lineno=168, col_offset=68, end_lineno=168, end_col_offset=72), lineno=168, col_offset=4, end_lineno=179, end_col_offset=9), FunctionDef(name='_ensure_views', args=arguments(args=[arg(arg='self', lineno=181, col_offset=22, end_lineno=181, end_col_offset=26), arg(arg='conn', annotation=Attribute(value=Name(id='duckdb', ctx=Load(), lineno=181, col_offset=34, end_lineno=181, end_col_offset=40), attr='DuckDBPyConnection', ctx=Load(), lineno=181, col_offset=34, end_lineno=181, end_col_offset=59), lineno=181, col_offset=28, end_lineno=181, end_col_offset=59)]), body=[Expr(value=Constant(value='Create views over Parquet directories if they do not already exist.', lineno=182, col_offset=8, end_lineno=182, end_col_offset=81), lineno=182, col_offset=8, end_lineno=182, end_col_offset=81), If(test=Call(func=Attribute(value=Name(id='self', ctx=Load(), lineno=183, col_offset=11, end_lineno=183, end_col_offset=15), attr='_relation_exists', ctx=Load(), lineno=183, col_offset=11, end_lineno=183, end_col_offset=32), args=[Name(id='conn', ctx=Load(), lineno=183, col_offset=33, end_lineno=183, end_col_offset=37), Constant(value='chunks', lineno=183, col_offset=39, end_lineno=183, end_col_offset=47)], lineno=183, col_offset=11, end_lineno=183, end_col_offset=48), body=[Return(lineno=184, col_offset=12, end_lineno=184, end_col_offset=18)], lineno=183, col_offset=8, end_lineno=184, end_col_offset=18), Assign(targets=[Name(id='parquet_pattern', ctx=Store(), lineno=186, col_offset=8, end_lineno=186, end_col_offset=23)], value=Call(func=Name(id='str', ctx=Load(), lineno=186, col_offset=26, end_lineno=186, end_col_offset=29), args=[BinOp(left=Attribute(value=Name(id='self', ctx=Load(), lineno=186, col_offset=30, end_lineno=186, end_col_offset=34), attr='vectors_dir', ctx=Load(), lineno=186, col_offset=30, end_lineno=186, end_col_offset=46), op=Div(), right=Constant(value='**/*.parquet', lineno=186, col_offset=49, end_lineno=186, end_col_offset=63), lineno=186, col_offset=30, end_lineno=186, end_col_offset=63)], lineno=186, col_offset=26, end_lineno=186, end_col_offset=64), lineno=186, col_offset=8, end_lineno=186, end_col_offset=64), Assign(targets=[Name(id='parquet_exists', ctx=Store(), lineno=187, col_offset=8, end_lineno=187, end_col_offset=22)], value=Call(func=Name(id='any', ctx=Load(), lineno=187, col_offset=25, end_lineno=187, end_col_offset=28), args=[Call(func=Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=187, col_offset=29, end_lineno=187, end_col_offset=33), attr='vectors_dir', ctx=Load(), lineno=187, col_offset=29, end_lineno=187, end_col_offset=45), attr='rglob', ctx=Load(), lineno=187, col_offset=29, end_lineno=187, end_col_offset=51), args=[Constant(value='*.parquet', lineno=187, col_offset=52, end_lineno=187, end_col_offset=63)], lineno=187, col_offset=29, end_lineno=187, end_col_offset=64)], lineno=187, col_offset=25, end_lineno=187, end_col_offset=65), lineno=187, col_offset=8, end_lineno=187, end_col_offset=65), If(test=Attribute(value=Name(id='self', ctx=Load(), lineno=189, col_offset=11, end_lineno=189, end_col_offset=15), attr='materialize', ctx=Load(), lineno=189, col_offset=11, end_lineno=189, end_col_offset=27), body=[If(test=Name(id='parquet_exists', ctx=Load(), lineno=190, col_offset=15, end_lineno=190, end_col_offset=29), body=[Assign(targets=[Name(id='sql', ctx=Store(), lineno=191, col_offset=16, end_lineno=191, end_col_offset=19)], value=Constant(value='\n                    CREATE OR REPLACE TABLE chunks_materialized AS\n                    SELECT * FROM read_parquet(?)\n                    ', lineno=191, col_offset=22, end_lineno=194, end_col_offset=23), lineno=191, col_offset=16, end_lineno=194, end_col_offset=23), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load(), lineno=195, col_offset=16, end_lineno=195, end_col_offset=20), attr='_log_query', ctx=Load(), lineno=195, col_offset=16, end_lineno=195, end_col_offset=31), args=[Name(id='sql', ctx=Load(), lineno=195, col_offset=32, end_lineno=195, end_col_offset=35), List(elts=[Name(id='parquet_pattern', ctx=Load(), lineno=195, col_offset=38, end_lineno=195, end_col_offset=53)], ctx=Load(), lineno=195, col_offset=37, end_lineno=195, end_col_offset=54)], lineno=195, col_offset=16, end_lineno=195, end_col_offset=55), lineno=195, col_offset=16, end_lineno=195, end_col_offset=55), Expr(value=Call(func=Attribute(value=Name(id='conn', ctx=Load(), lineno=196, col_offset=16, end_lineno=196, end_col_offset=20), attr='execute', ctx=Load(), lineno=196, col_offset=16, end_lineno=196, end_col_offset=28), args=[Name(id='sql', ctx=Load(), lineno=196, col_offset=29, end_lineno=196, end_col_offset=32), List(elts=[Name(id='parquet_pattern', ctx=Load(), lineno=196, col_offset=35, end_lineno=196, end_col_offset=50)], ctx=Load(), lineno=196, col_offset=34, end_lineno=196, end_col_offset=51)], lineno=196, col_offset=16, end_lineno=196, end_col_offset=52), lineno=196, col_offset=16, end_lineno=196, end_col_offset=52)], orelse=[Assign(targets=[Name(id='sql', ctx=Store(), lineno=198, col_offset=16, end_lineno=198, end_col_offset=19)], value=JoinedStr(values=[Constant(value='CREATE OR REPLACE TABLE chunks_materialized AS ', lineno=198, col_offset=24, end_lineno=198, end_col_offset=71), FormattedValue(value=Name(id='_EMPTY_CHUNKS_SELECT', ctx=Load(), lineno=198, col_offset=72, end_lineno=198, end_col_offset=92), conversion=-1, lineno=198, col_offset=71, end_lineno=198, end_col_offset=93)], lineno=198, col_offset=22, end_lineno=198, end_col_offset=94), lineno=198, col_offset=16, end_lineno=198, end_col_offset=94), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load(), lineno=199, col_offset=16, end_lineno=199, end_col_offset=20), attr='_log_query', ctx=Load(), lineno=199, col_offset=16, end_lineno=199, end_col_offset=31), args=[Name(id='sql', ctx=Load(), lineno=199, col_offset=32, end_lineno=199, end_col_offset=35), Constant(value=None, lineno=199, col_offset=37, end_lineno=199, end_col_offset=41)], lineno=199, col_offset=16, end_lineno=199, end_col_offset=42), lineno=199, col_offset=16, end_lineno=199, end_col_offset=42), Expr(value=Call(func=Attribute(value=Name(id='conn', ctx=Load(), lineno=200, col_offset=16, end_lineno=200, end_col_offset=20), attr='execute', ctx=Load(), lineno=200, col_offset=16, end_lineno=200, end_col_offset=28), args=[Name(id='sql', ctx=Load(), lineno=200, col_offset=29, end_lineno=200, end_col_offset=32)], lineno=200, col_offset=16, end_lineno=200, end_col_offset=33), lineno=200, col_offset=16, end_lineno=200, end_col_offset=33)], lineno=190, col_offset=12, end_lineno=200, end_col_offset=33), Assign(targets=[Name(id='view_sql', ctx=Store(), lineno=202, col_offset=12, end_lineno=202, end_col_offset=20)], value=Constant(value='CREATE OR REPLACE VIEW chunks AS SELECT * FROM chunks_materialized', lineno=202, col_offset=23, end_lineno=202, end_col_offset=91), lineno=202, col_offset=12, end_lineno=202, end_col_offset=91), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load(), lineno=203, col_offset=12, end_lineno=203, end_col_offset=16), attr='_log_query', ctx=Load(), lineno=203, col_offset=12, end_lineno=203, end_col_offset=27), args=[Name(id='view_sql', ctx=Load(), lineno=203, col_offset=28, end_lineno=203, end_col_offset=36), Constant(value=None, lineno=203, col_offset=38, end_lineno=203, end_col_offset=42)], lineno=203, col_offset=12, end_lineno=203, end_col_offset=43), lineno=203, col_offset=12, end_lineno=203, end_col_offset=43), Expr(value=Call(func=Attribute(value=Name(id='conn', ctx=Load(), lineno=204, col_offset=12, end_lineno=204, end_col_offset=16), attr='execute', ctx=Load(), lineno=204, col_offset=12, end_lineno=204, end_col_offset=24), args=[Name(id='view_sql', ctx=Load(), lineno=204, col_offset=25, end_lineno=204, end_col_offset=33)], lineno=204, col_offset=12, end_lineno=204, end_col_offset=34), lineno=204, col_offset=12, end_lineno=204, end_col_offset=34), Assign(targets=[Name(id='index_sql', ctx=Store(), lineno=206, col_offset=12, end_lineno=206, end_col_offset=21)], value=Constant(value='CREATE INDEX IF NOT EXISTS idx_chunks_materialized_uri ON chunks_materialized(uri)', lineno=207, col_offset=16, end_lineno=207, end_col_offset=100), lineno=206, col_offset=12, end_lineno=208, end_col_offset=13), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load(), lineno=209, col_offset=12, end_lineno=209, end_col_offset=16), attr='_log_query', ctx=Load(), lineno=209, col_offset=12, end_lineno=209, end_col_offset=27), args=[Name(id='index_sql', ctx=Load(), lineno=209, col_offset=28, end_lineno=209, end_col_offset=37), Constant(value=None, lineno=209, col_offset=39, end_lineno=209, end_col_offset=43)], lineno=209, col_offset=12, end_lineno=209, end_col_offset=44), lineno=209, col_offset=12, end_lineno=209, end_col_offset=44), Expr(value=Call(func=Attribute(value=Name(id='conn', ctx=Load(), lineno=210, col_offset=12, end_lineno=210, end_col_offset=16), attr='execute', ctx=Load(), lineno=210, col_offset=12, end_lineno=210, end_col_offset=24), args=[Name(id='index_sql', ctx=Load(), lineno=210, col_offset=25, end_lineno=210, end_col_offset=34)], lineno=210, col_offset=12, end_lineno=210, end_col_offset=35), lineno=210, col_offset=12, end_lineno=210, end_col_offset=35), Expr(value=Call(func=Attribute(value=Name(id='LOGGER', ctx=Load(), lineno=211, col_offset=12, end_lineno=211, end_col_offset=18), attr='info', ctx=Load(), lineno=211, col_offset=12, end_lineno=211, end_col_offset=23), args=[Constant(value='Materialized DuckDB chunks table', lineno=212, col_offset=16, end_lineno=212, end_col_offset=50)], keywords=[keyword(arg='extra', value=Dict(keys=[Constant(value='materialized', lineno=214, col_offset=20, end_lineno=214, end_col_offset=34), Constant(value='parquet_found', lineno=215, col_offset=20, end_lineno=215, end_col_offset=35), Constant(value='db_path', lineno=216, col_offset=20, end_lineno=216, end_col_offset=29)], values=[Constant(value=True, lineno=214, col_offset=36, end_lineno=214, end_col_offset=40), Name(id='parquet_exists', ctx=Load(), lineno=215, col_offset=37, end_lineno=215, end_col_offset=51), Call(func=Name(id='str', ctx=Load(), lineno=216, col_offset=31, end_lineno=216, end_col_offset=34), args=[Attribute(value=Name(id='self', ctx=Load(), lineno=216, col_offset=35, end_lineno=216, end_col_offset=39), attr='db_path', ctx=Load(), lineno=216, col_offset=35, end_lineno=216, end_col_offset=47)], lineno=216, col_offset=31, end_lineno=216, end_col_offset=48)], lineno=213, col_offset=22, end_lineno=217, end_col_offset=17), lineno=213, col_offset=16, end_lineno=217, end_col_offset=17)], lineno=211, col_offset=12, end_lineno=218, end_col_offset=13), lineno=211, col_offset=12, end_lineno=218, end_col_offset=13)], orelse=[If(test=Name(id='parquet_exists', ctx=Load(), lineno=220, col_offset=15, end_lineno=220, end_col_offset=29), body=[Assign(targets=[Name(id='sql', ctx=Store(), lineno=221, col_offset=16, end_lineno=221, end_col_offset=19)], value=Constant(value='SELECT * FROM read_parquet(?)', lineno=221, col_offset=22, end_lineno=221, end_col_offset=53), lineno=221, col_offset=16, end_lineno=221, end_col_offset=53), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load(), lineno=222, col_offset=16, end_lineno=222, end_col_offset=20), attr='_log_query', ctx=Load(), lineno=222, col_offset=16, end_lineno=222, end_col_offset=31), args=[Name(id='sql', ctx=Load(), lineno=222, col_offset=32, end_lineno=222, end_col_offset=35), List(elts=[Name(id='parquet_pattern', ctx=Load(), lineno=222, col_offset=38, end_lineno=222, end_col_offset=53)], ctx=Load(), lineno=222, col_offset=37, end_lineno=222, end_col_offset=54)], lineno=222, col_offset=16, end_lineno=222, end_col_offset=55), lineno=222, col_offset=16, end_lineno=222, end_col_offset=55), Assign(targets=[Name(id='relation', ctx=Store(), lineno=223, col_offset=16, end_lineno=223, end_col_offset=24)], value=Call(func=Attribute(value=Name(id='conn', ctx=Load(), lineno=223, col_offset=27, end_lineno=223, end_col_offset=31), attr='sql', ctx=Load(), lineno=223, col_offset=27, end_lineno=223, end_col_offset=35), args=[Name(id='sql', ctx=Load(), lineno=223, col_offset=36, end_lineno=223, end_col_offset=39)], keywords=[keyword(arg='params', value=List(elts=[Name(id='parquet_pattern', ctx=Load(), lineno=223, col_offset=49, end_lineno=223, end_col_offset=64)], ctx=Load(), lineno=223, col_offset=48, end_lineno=223, end_col_offset=65), lineno=223, col_offset=41, end_lineno=223, end_col_offset=65)], lineno=223, col_offset=27, end_lineno=223, end_col_offset=66), lineno=223, col_offset=16, end_lineno=223, end_col_offset=66), Expr(value=Call(func=Attribute(value=Name(id='relation', ctx=Load(), lineno=224, col_offset=16, end_lineno=224, end_col_offset=24), attr='create_view', ctx=Load(), lineno=224, col_offset=16, end_lineno=224, end_col_offset=36), args=[Constant(value='chunks', lineno=224, col_offset=37, end_lineno=224, end_col_offset=45)], keywords=[keyword(arg='replace', value=Constant(value=True, lineno=224, col_offset=55, end_lineno=224, end_col_offset=59), lineno=224, col_offset=47, end_lineno=224, end_col_offset=59)], lineno=224, col_offset=16, end_lineno=224, end_col_offset=60), lineno=224, col_offset=16, end_lineno=224, end_col_offset=60)], orelse=[Assign(targets=[Name(id='sql', ctx=Store(), lineno=226, col_offset=16, end_lineno=226, end_col_offset=19)], value=JoinedStr(values=[Constant(value='CREATE OR REPLACE VIEW chunks AS ', lineno=226, col_offset=24, end_lineno=226, end_col_offset=57), FormattedValue(value=Name(id='_EMPTY_CHUNKS_SELECT', ctx=Load(), lineno=226, col_offset=58, end_lineno=226, end_col_offset=78), conversion=-1, lineno=226, col_offset=57, end_lineno=226, end_col_offset=79)], lineno=226, col_offset=22, end_lineno=226, end_col_offset=80), lineno=226, col_offset=16, end_lineno=226, end_col_offset=80), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load(), lineno=227, col_offset=16, end_lineno=227, end_col_offset=20), attr='_log_query', ctx=Load(), lineno=227, col_offset=16, end_lineno=227, end_col_offset=31), args=[Name(id='sql', ctx=Load(), lineno=227, col_offset=32, end_lineno=227, end_col_offset=35), Constant(value=None, lineno=227, col_offset=37, end_lineno=227, end_col_offset=41)], lineno=227, col_offset=16, end_lineno=227, end_col_offset=42), lineno=227, col_offset=16, end_lineno=227, end_col_offset=42), Expr(value=Call(func=Attribute(value=Name(id='conn', ctx=Load(), lineno=228, col_offset=16, end_lineno=228, end_col_offset=20), attr='execute', ctx=Load(), lineno=228, col_offset=16, end_lineno=228, end_col_offset=28), args=[Name(id='sql', ctx=Load(), lineno=228, col_offset=29, end_lineno=228, end_col_offset=32)], lineno=228, col_offset=16, end_lineno=228, end_col_offset=33), lineno=228, col_offset=16, end_lineno=228, end_col_offset=33)], lineno=220, col_offset=12, end_lineno=228, end_col_offset=33), Expr(value=Call(func=Attribute(value=Name(id='LOGGER', ctx=Load(), lineno=229, col_offset=12, end_lineno=229, end_col_offset=18), attr='debug', ctx=Load(), lineno=229, col_offset=12, end_lineno=229, end_col_offset=24), args=[Constant(value='Configured DuckDB chunks view', lineno=230, col_offset=16, end_lineno=230, end_col_offset=47)], keywords=[keyword(arg='extra', value=Dict(keys=[Constant(value='materialized', lineno=232, col_offset=20, end_lineno=232, end_col_offset=34), Constant(value='parquet_found', lineno=233, col_offset=20, end_lineno=233, end_col_offset=35), Constant(value='db_path', lineno=234, col_offset=20, end_lineno=234, end_col_offset=29)], values=[Constant(value=False, lineno=232, col_offset=36, end_lineno=232, end_col_offset=41), Name(id='parquet_exists', ctx=Load(), lineno=233, col_offset=37, end_lineno=233, end_col_offset=51), Call(func=Name(id='str', ctx=Load(), lineno=234, col_offset=31, end_lineno=234, end_col_offset=34), args=[Attribute(value=Name(id='self', ctx=Load(), lineno=234, col_offset=35, end_lineno=234, end_col_offset=39), attr='db_path', ctx=Load(), lineno=234, col_offset=35, end_lineno=234, end_col_offset=47)], lineno=234, col_offset=31, end_lineno=234, end_col_offset=48)], lineno=231, col_offset=22, end_lineno=235, end_col_offset=17), lineno=231, col_offset=16, end_lineno=235, end_col_offset=17)], lineno=229, col_offset=12, end_lineno=236, end_col_offset=13), lineno=229, col_offset=12, end_lineno=236, end_col_offset=13)], lineno=189, col_offset=8, end_lineno=236, end_col_offset=13)], returns=Constant(value=None, lineno=181, col_offset=64, end_lineno=181, end_col_offset=68), lineno=181, col_offset=4, end_lineno=236, end_col_offset=13), FunctionDef(name='_relation_exists', args=arguments(args=[arg(arg='conn', annotation=Attribute(value=Name(id='duckdb', ctx=Load(), lineno=239, col_offset=31, end_lineno=239, end_col_offset=37), attr='DuckDBPyConnection', ctx=Load(), lineno=239, col_offset=31, end_lineno=239, end_col_offset=56), lineno=239, col_offset=25, end_lineno=239, end_col_offset=56), arg(arg='name', annotation=Name(id='str', ctx=Load(), lineno=239, col_offset=64, end_lineno=239, end_col_offset=67), lineno=239, col_offset=58, end_lineno=239, end_col_offset=67)]), body=[Expr(value=Constant(value='Return True when a table or view with ``name`` exists in the main schema.\n\n        Parameters\n        ----------\n        conn : duckdb.DuckDBPyConnection\n            DuckDB connection used to inspect the catalog.\n        name : str\n            Table or view name to look up within the ``main`` schema.\n\n        Returns\n        -------\n        bool\n            ``True`` when the relation exists, otherwise ``False``.\n        ', lineno=240, col_offset=8, end_lineno=253, end_col_offset=11), lineno=240, col_offset=8, end_lineno=253, end_col_offset=11), Assign(targets=[Name(id='row', ctx=Store(), lineno=254, col_offset=8, end_lineno=254, end_col_offset=11)], value=Call(func=Attribute(value=Call(func=Attribute(value=Name(id='conn', ctx=Load(), lineno=254, col_offset=14, end_lineno=254, end_col_offset=18), attr='execute', ctx=Load(), lineno=254, col_offset=14, end_lineno=254, end_col_offset=26), args=[Constant(value="\n            SELECT COUNT(*)\n            FROM information_schema.tables\n            WHERE table_schema = 'main'\n              AND table_name = ?\n            ", lineno=255, col_offset=12, end_lineno=260, end_col_offset=15), List(elts=[Name(id='name', ctx=Load(), lineno=261, col_offset=13, end_lineno=261, end_col_offset=17)], ctx=Load(), lineno=261, col_offset=12, end_lineno=261, end_col_offset=18)], lineno=254, col_offset=14, end_lineno=262, end_col_offset=9), attr='fetchone', ctx=Load(), lineno=254, col_offset=14, end_lineno=262, end_col_offset=18), lineno=254, col_offset=14, end_lineno=262, end_col_offset=20), lineno=254, col_offset=8, end_lineno=262, end_col_offset=20), Return(value=Call(func=Name(id='bool', ctx=Load(), lineno=263, col_offset=15, end_lineno=263, end_col_offset=19), args=[BoolOp(op=And(), values=[Name(id='row', ctx=Load(), lineno=263, col_offset=20, end_lineno=263, end_col_offset=23), Subscript(value=Name(id='row', ctx=Load(), lineno=263, col_offset=28, end_lineno=263, end_col_offset=31), slice=Constant(value=0, lineno=263, col_offset=32, end_lineno=263, end_col_offset=33), ctx=Load(), lineno=263, col_offset=28, end_lineno=263, end_col_offset=34)], lineno=263, col_offset=20, end_lineno=263, end_col_offset=34)], lineno=263, col_offset=15, end_lineno=263, end_col_offset=35), lineno=263, col_offset=8, end_lineno=263, end_col_offset=35)], decorator_list=[Name(id='staticmethod', ctx=Load(), lineno=238, col_offset=5, end_lineno=238, end_col_offset=17)], returns=Name(id='bool', ctx=Load(), lineno=239, col_offset=72, end_lineno=239, end_col_offset=76), lineno=239, col_offset=4, end_lineno=263, end_col_offset=35), FunctionDef(name='query_by_ids', args=arguments(args=[arg(arg='self', lineno=265, col_offset=21, end_lineno=265, end_col_offset=25), arg(arg='ids', annotation=Subscript(value=Name(id='Sequence', ctx=Load(), lineno=265, col_offset=32, end_lineno=265, end_col_offset=40), slice=Name(id='int', ctx=Load(), lineno=265, col_offset=41, end_lineno=265, end_col_offset=44), ctx=Load(), lineno=265, col_offset=32, end_lineno=265, end_col_offset=45), lineno=265, col_offset=27, end_lineno=265, end_col_offset=45)]), body=[Expr(value=Constant(value='Query chunks by their unique IDs.\n\n        Retrieves chunk metadata (text, URI, line numbers, etc.) for a list of\n        chunk IDs. This is typically used after a FAISS search returns chunk IDs\n        to hydrate the results with full chunk information.\n\n        The function constructs a SQL IN clause to efficiently fetch multiple\n        chunks in a single query. Results are returned as dictionaries with column\n        names as keys, matching the Parquet schema.\n\n        Parameters\n        ----------\n        ids : Sequence[int]\n            Sequence of chunk IDs to retrieve. IDs must exist in the chunks table.\n            Empty sequence returns empty list.\n\n        Returns\n        -------\n        list[dict]\n            List of chunk records as dictionaries. Each dict contains all columns\n            from the chunks Parquet file (id, uri, text, start_line, end_line,\n            symbols, etc.). Returns empty list if no IDs provided or no matches.\n\n        ', lineno=266, col_offset=8, end_lineno=289, end_col_offset=11), lineno=266, col_offset=8, end_lineno=289, end_col_offset=11), If(test=UnaryOp(op=Not(), operand=Name(id='ids', ctx=Load(), lineno=290, col_offset=15, end_lineno=290, end_col_offset=18), lineno=290, col_offset=11, end_lineno=290, end_col_offset=18), body=[Return(value=List(ctx=Load(), lineno=291, col_offset=19, end_lineno=291, end_col_offset=21), lineno=291, col_offset=12, end_lineno=291, end_col_offset=21)], lineno=290, col_offset=8, end_lineno=291, end_col_offset=21), Assign(targets=[Name(id='sql', ctx=Store(), lineno=293, col_offset=8, end_lineno=293, end_col_offset=11)], value=Constant(value='\n            SELECT c.*\n            FROM chunks AS c\n            JOIN UNNEST(?) WITH ORDINALITY AS ids(id, position)\n                ON c.id = ids.id\n            ORDER BY ids.position\n            ', lineno=293, col_offset=14, end_lineno=299, end_col_offset=15), lineno=293, col_offset=8, end_lineno=299, end_col_offset=15), Assign(targets=[Name(id='params', ctx=Store(), lineno=300, col_offset=8, end_lineno=300, end_col_offset=14)], value=List(elts=[Call(func=Name(id='list', ctx=Load(), lineno=300, col_offset=18, end_lineno=300, end_col_offset=22), args=[Name(id='ids', ctx=Load(), lineno=300, col_offset=23, end_lineno=300, end_col_offset=26)], lineno=300, col_offset=18, end_lineno=300, end_col_offset=27)], ctx=Load(), lineno=300, col_offset=17, end_lineno=300, end_col_offset=28), lineno=300, col_offset=8, end_lineno=300, end_col_offset=28), With(items=[withitem(context_expr=Call(func=Attribute(value=Name(id='self', ctx=Load(), lineno=301, col_offset=13, end_lineno=301, end_col_offset=17), attr='connection', ctx=Load(), lineno=301, col_offset=13, end_lineno=301, end_col_offset=28), lineno=301, col_offset=13, end_lineno=301, end_col_offset=30), optional_vars=Name(id='conn', ctx=Store(), lineno=301, col_offset=34, end_lineno=301, end_col_offset=38))], body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load(), lineno=302, col_offset=12, end_lineno=302, end_col_offset=16), attr='_log_query', ctx=Load(), lineno=302, col_offset=12, end_lineno=302, end_col_offset=27), args=[Name(id='sql', ctx=Load(), lineno=302, col_offset=28, end_lineno=302, end_col_offset=31), Name(id='params', ctx=Load(), lineno=302, col_offset=33, end_lineno=302, end_col_offset=39)], lineno=302, col_offset=12, end_lineno=302, end_col_offset=40), lineno=302, col_offset=12, end_lineno=302, end_col_offset=40), Assign(targets=[Name(id='relation', ctx=Store(), lineno=303, col_offset=12, end_lineno=303, end_col_offset=20)], value=Call(func=Attribute(value=Name(id='conn', ctx=Load(), lineno=303, col_offset=23, end_lineno=303, end_col_offset=27), attr='execute', ctx=Load(), lineno=303, col_offset=23, end_lineno=303, end_col_offset=35), args=[Name(id='sql', ctx=Load(), lineno=303, col_offset=36, end_lineno=303, end_col_offset=39), Name(id='params', ctx=Load(), lineno=303, col_offset=41, end_lineno=303, end_col_offset=47)], lineno=303, col_offset=23, end_lineno=303, end_col_offset=48), lineno=303, col_offset=12, end_lineno=303, end_col_offset=48), Assign(targets=[Name(id='rows', ctx=Store(), lineno=304, col_offset=12, end_lineno=304, end_col_offset=16)], value=Call(func=Attribute(value=Name(id='relation', ctx=Load(), lineno=304, col_offset=19, end_lineno=304, end_col_offset=27), attr='fetchall', ctx=Load(), lineno=304, col_offset=19, end_lineno=304, end_col_offset=36), lineno=304, col_offset=19, end_lineno=304, end_col_offset=38), lineno=304, col_offset=12, end_lineno=304, end_col_offset=38), Assign(targets=[Name(id='cols', ctx=Store(), lineno=305, col_offset=12, end_lineno=305, end_col_offset=16)], value=ListComp(elt=Subscript(value=Name(id='desc', ctx=Load(), lineno=305, col_offset=20, end_lineno=305, end_col_offset=24), slice=Constant(value=0, lineno=305, col_offset=25, end_lineno=305, end_col_offset=26), ctx=Load(), lineno=305, col_offset=20, end_lineno=305, end_col_offset=27), generators=[comprehension(target=Name(id='desc', ctx=Store(), lineno=305, col_offset=32, end_lineno=305, end_col_offset=36), iter=Attribute(value=Name(id='relation', ctx=Load(), lineno=305, col_offset=40, end_lineno=305, end_col_offset=48), attr='description', ctx=Load(), lineno=305, col_offset=40, end_lineno=305, end_col_offset=60), is_async=0)], lineno=305, col_offset=19, end_lineno=305, end_col_offset=61), lineno=305, col_offset=12, end_lineno=305, end_col_offset=61)], lineno=301, col_offset=8, end_lineno=305, end_col_offset=61), Return(value=ListComp(elt=Call(func=Name(id='dict', ctx=Load(), lineno=306, col_offset=16, end_lineno=306, end_col_offset=20), args=[Call(func=Name(id='zip', ctx=Load(), lineno=306, col_offset=21, end_lineno=306, end_col_offset=24), args=[Name(id='cols', ctx=Load(), lineno=306, col_offset=25, end_lineno=306, end_col_offset=29), Name(id='row', ctx=Load(), lineno=306, col_offset=31, end_lineno=306, end_col_offset=34)], keywords=[keyword(arg='strict', value=Constant(value=True, lineno=306, col_offset=43, end_lineno=306, end_col_offset=47), lineno=306, col_offset=36, end_lineno=306, end_col_offset=47)], lineno=306, col_offset=21, end_lineno=306, end_col_offset=48)], lineno=306, col_offset=16, end_lineno=306, end_col_offset=49), generators=[comprehension(target=Name(id='row', ctx=Store(), lineno=306, col_offset=54, end_lineno=306, end_col_offset=57), iter=Name(id='rows', ctx=Load(), lineno=306, col_offset=61, end_lineno=306, end_col_offset=65), is_async=0)], lineno=306, col_offset=15, end_lineno=306, end_col_offset=66), lineno=306, col_offset=8, end_lineno=306, end_col_offset=66)], returns=Subscript(value=Name(id='list', ctx=Load(), lineno=265, col_offset=50, end_lineno=265, end_col_offset=54), slice=Name(id='dict', ctx=Load(), lineno=265, col_offset=55, end_lineno=265, end_col_offset=59), ctx=Load(), lineno=265, col_offset=50, end_lineno=265, end_col_offset=60), lineno=265, col_offset=4, end_lineno=306, end_col_offset=66), FunctionDef(name='query_by_filters', args=arguments(args=[arg(arg='self', lineno=309, col_offset=8, end_lineno=309, end_col_offset=12), arg(arg='ids', annotation=Subscript(value=Name(id='Sequence', ctx=Load(), lineno=310, col_offset=13, end_lineno=310, end_col_offset=21), slice=Name(id='int', ctx=Load(), lineno=310, col_offset=22, end_lineno=310, end_col_offset=25), ctx=Load(), lineno=310, col_offset=13, end_lineno=310, end_col_offset=26), lineno=310, col_offset=8, end_lineno=310, end_col_offset=26)], kwonlyargs=[arg(arg='include_globs', annotation=BinOp(left=Subscript(value=Name(id='list', ctx=Load(), lineno=312, col_offset=23, end_lineno=312, end_col_offset=27), slice=Name(id='str', ctx=Load(), lineno=312, col_offset=28, end_lineno=312, end_col_offset=31), ctx=Load(), lineno=312, col_offset=23, end_lineno=312, end_col_offset=32), op=BitOr(), right=Constant(value=None, lineno=312, col_offset=35, end_lineno=312, end_col_offset=39), lineno=312, col_offset=23, end_lineno=312, end_col_offset=39), lineno=312, col_offset=8, end_lineno=312, end_col_offset=39), arg(arg='exclude_globs', annotation=BinOp(left=Subscript(value=Name(id='list', ctx=Load(), lineno=313, col_offset=23, end_lineno=313, end_col_offset=27), slice=Name(id='str', ctx=Load(), lineno=313, col_offset=28, end_lineno=313, end_col_offset=31), ctx=Load(), lineno=313, col_offset=23, end_lineno=313, end_col_offset=32), op=BitOr(), right=Constant(value=None, lineno=313, col_offset=35, end_lineno=313, end_col_offset=39), lineno=313, col_offset=23, end_lineno=313, end_col_offset=39), lineno=313, col_offset=8, end_lineno=313, end_col_offset=39), arg(arg='languages', annotation=BinOp(left=Subscript(value=Name(id='list', ctx=Load(), lineno=314, col_offset=19, end_lineno=314, end_col_offset=23), slice=Name(id='str', ctx=Load(), lineno=314, col_offset=24, end_lineno=314, end_col_offset=27), ctx=Load(), lineno=314, col_offset=19, end_lineno=314, end_col_offset=28), op=BitOr(), right=Constant(value=None, lineno=314, col_offset=31, end_lineno=314, end_col_offset=35), lineno=314, col_offset=19, end_lineno=314, end_col_offset=35), lineno=314, col_offset=8, end_lineno=314, end_col_offset=35)], kw_defaults=[Constant(value=None, lineno=312, col_offset=42, end_lineno=312, end_col_offset=46), Constant(value=None, lineno=313, col_offset=42, end_lineno=313, end_col_offset=46), Constant(value=None, lineno=314, col_offset=38, end_lineno=314, end_col_offset=42)]), body=[Expr(value=Constant(value='Query chunks by IDs with path and language filtering.\n\n        Retrieves chunk metadata for a list of chunk IDs, applying optional filters\n        for path patterns (include/exclude globs) and programming languages. This\n        method is used after FAISS search to filter results by scope constraints.\n\n        Filtering Strategy:\n        - Simple globs (e.g., `*.py`, `src/**`) are converted to SQL `LIKE` patterns\n          for efficient database-side filtering.\n        - Complex globs (e.g., `src/**/test_*.py`) fall back to Python `fnmatch`\n          post-filtering after SQL query execution.\n        - Language filtering uses file extension mapping (e.g., `python`  `.py`, `.pyi`).\n\n        Parameters\n        ----------\n        ids : Sequence[int]\n            Sequence of chunk IDs to retrieve. Empty sequence returns empty list.\n        include_globs : list[str] | None, optional\n            Glob patterns to include. Chunks must match at least one pattern.\n            Empty list means "include all" (no filtering). Defaults to None.\n        exclude_globs : list[str] | None, optional\n            Glob patterns to exclude. Chunks matching any pattern are removed.\n            Empty list means "exclude none". Defaults to None.\n        languages : list[str] | None, optional\n            Programming language names (e.g., ["python", "typescript"]).\n            Filters chunks by file extension. Defaults to None.\n\n        Returns\n        -------\n        list[dict]\n            List of filtered chunk records as dictionaries. Each dict contains all\n            columns from the chunks Parquet file. Results preserve input ID order\n            (via JOIN with UNNEST ordinality). Returns empty list if no IDs provided\n            or all chunks filtered out.\n\n        Examples\n        --------\n        Filter by language:\n\n        >>> catalog.query_by_filters([1, 2, 3], languages=["python"])\n        [{\'id\': 1, \'uri\': \'src/main.py\', ...}, {\'id\': 2, \'uri\': \'src/utils.py\', ...}]\n\n        Filter by include globs:\n\n        >>> catalog.query_by_filters([1, 2, 3], include_globs=["src/**/*.py"])\n        [{\'id\': 1, \'uri\': \'src/main.py\', ...}]\n\n        Combined filters:\n\n        >>> catalog.query_by_filters(\n        ...     [1, 2, 3],\n        ...     include_globs=["**/*.py"],\n        ...     exclude_globs=["**/test_*.py"],\n        ...     languages=["python"],\n        ... )\n        [{\'id\': 1, \'uri\': \'src/main.py\', ...}]\n\n        Notes\n        -----\n        SQL LIKE Pattern Conversion:\n        - `**/*.py`  `%.py` (matches any path ending in .py)\n        - `src/**`  `src/%` (matches paths starting with src/)\n        - `*.py`  `%.py` (same as **/*.py in our implementation)\n\n        Complex Glob Detection:\n        - Patterns with `**` in the middle (e.g., `src/**/test_*.py`) are detected\n          as complex and use Python post-filtering.\n        - Patterns with bracket expressions `[...]` or `[!...]` use Python filtering.\n        - Simple prefix/suffix patterns use SQL LIKE for performance.\n\n        Language Extension Mapping:\n        - Uses `LANGUAGE_EXTENSIONS` from `scope_utils` module.\n        - Unknown languages are silently ignored (no error raised).\n        - Extension matching is case-insensitive (normalizes to lowercase).\n\n        Performance:\n        - SQL filtering is preferred for large result sets (avoids transferring\n          filtered-out chunks from database).\n        - Python post-filtering adds ~1-2ms overhead per 1000 chunks.\n        - Consider adding index on `uri` column for faster LIKE queries (see Task 14).\n        ', lineno=316, col_offset=8, end_lineno=396, end_col_offset=11), lineno=316, col_offset=8, end_lineno=396, end_col_offset=11), If(test=UnaryOp(op=Not(), operand=Name(id='ids', ctx=Load(), lineno=397, col_offset=15, end_lineno=397, end_col_offset=18), lineno=397, col_offset=11, end_lineno=397, end_col_offset=18), body=[Return(value=List(ctx=Load(), lineno=398, col_offset=19, end_lineno=398, end_col_offset=21), lineno=398, col_offset=12, end_lineno=398, end_col_offset=21)], lineno=397, col_offset=8, end_lineno=398, end_col_offset=21), Assign(targets=[Name(id='start_time', ctx=Store(), lineno=400, col_offset=8, end_lineno=400, end_col_offset=18)], value=Call(func=Name(id='perf_counter', ctx=Load(), lineno=400, col_offset=21, end_lineno=400, end_col_offset=33), lineno=400, col_offset=21, end_lineno=400, end_col_offset=35), lineno=400, col_offset=8, end_lineno=400, end_col_offset=35), Assign(targets=[Name(id='spec', ctx=Store(), lineno=401, col_offset=8, end_lineno=401, end_col_offset=12)], value=Call(func=Attribute(value=Name(id='self', ctx=Load(), lineno=401, col_offset=15, end_lineno=401, end_col_offset=19), attr='_build_scope_filter_spec', ctx=Load(), lineno=401, col_offset=15, end_lineno=401, end_col_offset=44), args=[Name(id='ids', ctx=Load(), lineno=402, col_offset=12, end_lineno=402, end_col_offset=15)], keywords=[keyword(arg='include_globs', value=Name(id='include_globs', ctx=Load(), lineno=403, col_offset=26, end_lineno=403, end_col_offset=39), lineno=403, col_offset=12, end_lineno=403, end_col_offset=39), keyword(arg='exclude_globs', value=Name(id='exclude_globs', ctx=Load(), lineno=404, col_offset=26, end_lineno=404, end_col_offset=39), lineno=404, col_offset=12, end_lineno=404, end_col_offset=39), keyword(arg='languages', value=Name(id='languages', ctx=Load(), lineno=405, col_offset=22, end_lineno=405, end_col_offset=31), lineno=405, col_offset=12, end_lineno=405, end_col_offset=31)], lineno=401, col_offset=15, end_lineno=406, end_col_offset=9), lineno=401, col_offset=8, end_lineno=406, end_col_offset=9), If(test=BoolOp(op=And(), values=[Name(id='languages', ctx=Load(), lineno=408, col_offset=11, end_lineno=408, end_col_offset=20), UnaryOp(op=Not(), operand=Attribute(value=Name(id='spec', ctx=Load(), lineno=408, col_offset=29, end_lineno=408, end_col_offset=33), attr='language_extensions', ctx=Load(), lineno=408, col_offset=29, end_lineno=408, end_col_offset=53), lineno=408, col_offset=25, end_lineno=408, end_col_offset=53)], lineno=408, col_offset=11, end_lineno=408, end_col_offset=53), body=[Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load(), lineno=409, col_offset=12, end_lineno=409, end_col_offset=16), attr='_observe_scope_filter_duration', ctx=Load(), lineno=409, col_offset=12, end_lineno=409, end_col_offset=47), args=[Name(id='start_time', ctx=Load(), lineno=409, col_offset=48, end_lineno=409, end_col_offset=58), Name(id='include_globs', ctx=Load(), lineno=409, col_offset=60, end_lineno=409, end_col_offset=73), Name(id='exclude_globs', ctx=Load(), lineno=409, col_offset=75, end_lineno=409, end_col_offset=88), Name(id='languages', ctx=Load(), lineno=409, col_offset=90, end_lineno=409, end_col_offset=99)], lineno=409, col_offset=12, end_lineno=409, end_col_offset=100), lineno=409, col_offset=12, end_lineno=409, end_col_offset=100), Return(value=List(ctx=Load(), lineno=410, col_offset=19, end_lineno=410, end_col_offset=21), lineno=410, col_offset=12, end_lineno=410, end_col_offset=21)], lineno=408, col_offset=8, end_lineno=410, end_col_offset=21), Assign(targets=[Name(id='options', ctx=Store(), lineno=412, col_offset=8, end_lineno=412, end_col_offset=15)], value=Call(func=Name(id='DuckDBQueryOptions', ctx=Load(), lineno=412, col_offset=18, end_lineno=412, end_col_offset=36), keywords=[keyword(arg='include_globs', value=Attribute(value=Name(id='spec', ctx=Load(), lineno=413, col_offset=26, end_lineno=413, end_col_offset=30), attr='simple_include_globs', ctx=Load(), lineno=413, col_offset=26, end_lineno=413, end_col_offset=51), lineno=413, col_offset=12, end_lineno=413, end_col_offset=51), keyword(arg='exclude_globs', value=Attribute(value=Name(id='spec', ctx=Load(), lineno=414, col_offset=26, end_lineno=414, end_col_offset=30), attr='simple_exclude_globs', ctx=Load(), lineno=414, col_offset=26, end_lineno=414, end_col_offset=51), lineno=414, col_offset=12, end_lineno=414, end_col_offset=51), keyword(arg='select_columns', value=Tuple(elts=[Constant(value='c.*', lineno=415, col_offset=28, end_lineno=415, end_col_offset=33)], ctx=Load(), lineno=415, col_offset=27, end_lineno=415, end_col_offset=35), lineno=415, col_offset=12, end_lineno=415, end_col_offset=35), keyword(arg='preserve_order', value=Constant(value=True, lineno=416, col_offset=27, end_lineno=416, end_col_offset=31), lineno=416, col_offset=12, end_lineno=416, end_col_offset=31)], lineno=412, col_offset=18, end_lineno=417, end_col_offset=9), lineno=412, col_offset=8, end_lineno=417, end_col_offset=9), Assign(targets=[Tuple(elts=[Name(id='sql', ctx=Store(), lineno=419, col_offset=8, end_lineno=419, end_col_offset=11), Name(id='sql_params', ctx=Store(), lineno=419, col_offset=13, end_lineno=419, end_col_offset=23)], ctx=Store(), lineno=419, col_offset=8, end_lineno=419, end_col_offset=23)], value=Call(func=Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=419, col_offset=26, end_lineno=419, end_col_offset=30), attr='_query_builder', ctx=Load(), lineno=419, col_offset=26, end_lineno=419, end_col_offset=45), attr='build_filter_query', ctx=Load(), lineno=419, col_offset=26, end_lineno=419, end_col_offset=64), keywords=[keyword(arg='chunk_ids', value=Attribute(value=Name(id='spec', ctx=Load(), lineno=420, col_offset=22, end_lineno=420, end_col_offset=26), attr='chunk_ids', ctx=Load(), lineno=420, col_offset=22, end_lineno=420, end_col_offset=36), lineno=420, col_offset=12, end_lineno=420, end_col_offset=36), keyword(arg='options', value=Name(id='options', ctx=Load(), lineno=421, col_offset=20, end_lineno=421, end_col_offset=27), lineno=421, col_offset=12, end_lineno=421, end_col_offset=27)], lineno=419, col_offset=26, end_lineno=422, end_col_offset=9), lineno=419, col_offset=8, end_lineno=422, end_col_offset=9), With(items=[withitem(context_expr=Call(func=Attribute(value=Name(id='self', ctx=Load(), lineno=424, col_offset=13, end_lineno=424, end_col_offset=17), attr='connection', ctx=Load(), lineno=424, col_offset=13, end_lineno=424, end_col_offset=28), lineno=424, col_offset=13, end_lineno=424, end_col_offset=30), optional_vars=Name(id='conn', ctx=Store(), lineno=424, col_offset=34, end_lineno=424, end_col_offset=38))], body=[Assign(targets=[Name(id='relation', ctx=Store(), lineno=425, col_offset=12, end_lineno=425, end_col_offset=20)], value=Call(func=Attribute(value=Name(id='conn', ctx=Load(), lineno=425, col_offset=23, end_lineno=425, end_col_offset=27), attr='execute', ctx=Load(), lineno=425, col_offset=23, end_lineno=425, end_col_offset=35), args=[Name(id='sql', ctx=Load(), lineno=425, col_offset=36, end_lineno=425, end_col_offset=39), Name(id='sql_params', ctx=Load(), lineno=425, col_offset=41, end_lineno=425, end_col_offset=51)], lineno=425, col_offset=23, end_lineno=425, end_col_offset=52), lineno=425, col_offset=12, end_lineno=425, end_col_offset=52), Assign(targets=[Name(id='rows', ctx=Store(), lineno=426, col_offset=12, end_lineno=426, end_col_offset=16)], value=Call(func=Attribute(value=Name(id='relation', ctx=Load(), lineno=426, col_offset=19, end_lineno=426, end_col_offset=27), attr='fetchall', ctx=Load(), lineno=426, col_offset=19, end_lineno=426, end_col_offset=36), lineno=426, col_offset=19, end_lineno=426, end_col_offset=38), lineno=426, col_offset=12, end_lineno=426, end_col_offset=38), Assign(targets=[Name(id='cols', ctx=Store(), lineno=427, col_offset=12, end_lineno=427, end_col_offset=16)], value=ListComp(elt=Subscript(value=Name(id='desc', ctx=Load(), lineno=427, col_offset=20, end_lineno=427, end_col_offset=24), slice=Constant(value=0, lineno=427, col_offset=25, end_lineno=427, end_col_offset=26), ctx=Load(), lineno=427, col_offset=20, end_lineno=427, end_col_offset=27), generators=[comprehension(target=Name(id='desc', ctx=Store(), lineno=427, col_offset=32, end_lineno=427, end_col_offset=36), iter=Attribute(value=Name(id='relation', ctx=Load(), lineno=427, col_offset=40, end_lineno=427, end_col_offset=48), attr='description', ctx=Load(), lineno=427, col_offset=40, end_lineno=427, end_col_offset=60), is_async=0)], lineno=427, col_offset=19, end_lineno=427, end_col_offset=61), lineno=427, col_offset=12, end_lineno=427, end_col_offset=61)], lineno=424, col_offset=8, end_lineno=427, end_col_offset=61), Assign(targets=[Name(id='results', ctx=Store(), lineno=428, col_offset=8, end_lineno=428, end_col_offset=15)], value=ListComp(elt=Call(func=Name(id='dict', ctx=Load(), lineno=428, col_offset=19, end_lineno=428, end_col_offset=23), args=[Call(func=Name(id='zip', ctx=Load(), lineno=428, col_offset=24, end_lineno=428, end_col_offset=27), args=[Name(id='cols', ctx=Load(), lineno=428, col_offset=28, end_lineno=428, end_col_offset=32), Name(id='row', ctx=Load(), lineno=428, col_offset=34, end_lineno=428, end_col_offset=37)], keywords=[keyword(arg='strict', value=Constant(value=True, lineno=428, col_offset=46, end_lineno=428, end_col_offset=50), lineno=428, col_offset=39, end_lineno=428, end_col_offset=50)], lineno=428, col_offset=24, end_lineno=428, end_col_offset=51)], lineno=428, col_offset=19, end_lineno=428, end_col_offset=52), generators=[comprehension(target=Name(id='row', ctx=Store(), lineno=428, col_offset=57, end_lineno=428, end_col_offset=60), iter=Name(id='rows', ctx=Load(), lineno=428, col_offset=64, end_lineno=428, end_col_offset=68), is_async=0)], lineno=428, col_offset=18, end_lineno=428, end_col_offset=69), lineno=428, col_offset=8, end_lineno=428, end_col_offset=69), Assign(targets=[Name(id='results', ctx=Store(), lineno=430, col_offset=8, end_lineno=430, end_col_offset=15)], value=Call(func=Attribute(value=Name(id='self', ctx=Load(), lineno=430, col_offset=18, end_lineno=430, end_col_offset=22), attr='_apply_complex_glob_filters', ctx=Load(), lineno=430, col_offset=18, end_lineno=430, end_col_offset=50), args=[Name(id='results', ctx=Load(), lineno=431, col_offset=12, end_lineno=431, end_col_offset=19), Attribute(value=Name(id='spec', ctx=Load(), lineno=432, col_offset=12, end_lineno=432, end_col_offset=16), attr='complex_include_patterns', ctx=Load(), lineno=432, col_offset=12, end_lineno=432, end_col_offset=41), Attribute(value=Name(id='spec', ctx=Load(), lineno=433, col_offset=12, end_lineno=433, end_col_offset=16), attr='complex_exclude_patterns', ctx=Load(), lineno=433, col_offset=12, end_lineno=433, end_col_offset=41)], lineno=430, col_offset=18, end_lineno=434, end_col_offset=9), lineno=430, col_offset=8, end_lineno=434, end_col_offset=9), Assign(targets=[Name(id='results', ctx=Store(), lineno=435, col_offset=8, end_lineno=435, end_col_offset=15)], value=Call(func=Attribute(value=Name(id='self', ctx=Load(), lineno=435, col_offset=18, end_lineno=435, end_col_offset=22), attr='_apply_language_filters', ctx=Load(), lineno=435, col_offset=18, end_lineno=435, end_col_offset=46), args=[Name(id='results', ctx=Load(), lineno=435, col_offset=47, end_lineno=435, end_col_offset=54), Attribute(value=Name(id='spec', ctx=Load(), lineno=435, col_offset=56, end_lineno=435, end_col_offset=60), attr='language_extensions', ctx=Load(), lineno=435, col_offset=56, end_lineno=435, end_col_offset=80)], lineno=435, col_offset=18, end_lineno=435, end_col_offset=81), lineno=435, col_offset=8, end_lineno=435, end_col_offset=81), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load(), lineno=437, col_offset=8, end_lineno=437, end_col_offset=12), attr='_observe_scope_filter_duration', ctx=Load(), lineno=437, col_offset=8, end_lineno=437, end_col_offset=43), args=[Name(id='start_time', ctx=Load(), lineno=437, col_offset=44, end_lineno=437, end_col_offset=54), Name(id='include_globs', ctx=Load(), lineno=437, col_offset=56, end_lineno=437, end_col_offset=69), Name(id='exclude_globs', ctx=Load(), lineno=437, col_offset=71, end_lineno=437, end_col_offset=84), Name(id='languages', ctx=Load(), lineno=437, col_offset=86, end_lineno=437, end_col_offset=95)], lineno=437, col_offset=8, end_lineno=437, end_col_offset=96), lineno=437, col_offset=8, end_lineno=437, end_col_offset=96), Return(value=Name(id='results', ctx=Load(), lineno=438, col_offset=15, end_lineno=438, end_col_offset=22), lineno=438, col_offset=8, end_lineno=438, end_col_offset=22)], returns=Subscript(value=Name(id='list', ctx=Load(), lineno=315, col_offset=9, end_lineno=315, end_col_offset=13), slice=Name(id='dict', ctx=Load(), lineno=315, col_offset=14, end_lineno=315, end_col_offset=18), ctx=Load(), lineno=315, col_offset=9, end_lineno=315, end_col_offset=19), lineno=308, col_offset=4, end_lineno=438, end_col_offset=22), FunctionDef(name='_build_scope_filter_spec', args=arguments(args=[arg(arg='self', lineno=441, col_offset=8, end_lineno=441, end_col_offset=12), arg(arg='ids', annotation=Subscript(value=Name(id='Sequence', ctx=Load(), lineno=442, col_offset=13, end_lineno=442, end_col_offset=21), slice=Name(id='int', ctx=Load(), lineno=442, col_offset=22, end_lineno=442, end_col_offset=25), ctx=Load(), lineno=442, col_offset=13, end_lineno=442, end_col_offset=26), lineno=442, col_offset=8, end_lineno=442, end_col_offset=26)], kwonlyargs=[arg(arg='include_globs', annotation=BinOp(left=Subscript(value=Name(id='list', ctx=Load(), lineno=444, col_offset=23, end_lineno=444, end_col_offset=27), slice=Name(id='str', ctx=Load(), lineno=444, col_offset=28, end_lineno=444, end_col_offset=31), ctx=Load(), lineno=444, col_offset=23, end_lineno=444, end_col_offset=32), op=BitOr(), right=Constant(value=None, lineno=444, col_offset=35, end_lineno=444, end_col_offset=39), lineno=444, col_offset=23, end_lineno=444, end_col_offset=39), lineno=444, col_offset=8, end_lineno=444, end_col_offset=39), arg(arg='exclude_globs', annotation=BinOp(left=Subscript(value=Name(id='list', ctx=Load(), lineno=445, col_offset=23, end_lineno=445, end_col_offset=27), slice=Name(id='str', ctx=Load(), lineno=445, col_offset=28, end_lineno=445, end_col_offset=31), ctx=Load(), lineno=445, col_offset=23, end_lineno=445, end_col_offset=32), op=BitOr(), right=Constant(value=None, lineno=445, col_offset=35, end_lineno=445, end_col_offset=39), lineno=445, col_offset=23, end_lineno=445, end_col_offset=39), lineno=445, col_offset=8, end_lineno=445, end_col_offset=39), arg(arg='languages', annotation=BinOp(left=Subscript(value=Name(id='list', ctx=Load(), lineno=446, col_offset=19, end_lineno=446, end_col_offset=23), slice=Name(id='str', ctx=Load(), lineno=446, col_offset=24, end_lineno=446, end_col_offset=27), ctx=Load(), lineno=446, col_offset=19, end_lineno=446, end_col_offset=28), op=BitOr(), right=Constant(value=None, lineno=446, col_offset=31, end_lineno=446, end_col_offset=35), lineno=446, col_offset=19, end_lineno=446, end_col_offset=35), lineno=446, col_offset=8, end_lineno=446, end_col_offset=35)], kw_defaults=[None, None, None]), body=[Expr(value=Constant(value='Categorize scope filters and language extensions for later processing.\n\n        Parameters\n        ----------\n        ids : Sequence[int]\n            Chunk identifiers provided by FAISS.\n        include_globs : list[str] | None\n            Glob patterns to include via SQL LIKE.\n        exclude_globs : list[str] | None\n            Glob patterns to exclude via SQL LIKE.\n        languages : list[str] | None\n            Language names for extension-based filtering.\n\n        Returns\n        -------\n        _ScopeFilterSpec\n            Structured metadata describing how to materialize the query.\n        ', lineno=448, col_offset=8, end_lineno=465, end_col_offset=11), lineno=448, col_offset=8, end_lineno=465, end_col_offset=11), AnnAssign(target=Name(id='simple_include_globs', ctx=Store(), lineno=466, col_offset=8, end_lineno=466, end_col_offset=28), annotation=Subscript(value=Name(id='list', ctx=Load(), lineno=466, col_offset=30, end_lineno=466, end_col_offset=34), slice=Name(id='str', ctx=Load(), lineno=466, col_offset=35, end_lineno=466, end_col_offset=38), ctx=Load(), lineno=466, col_offset=30, end_lineno=466, end_col_offset=39), value=List(ctx=Load(), lineno=466, col_offset=42, end_lineno=466, end_col_offset=44), simple=1, lineno=466, col_offset=8, end_lineno=466, end_col_offset=44), AnnAssign(target=Name(id='complex_include_patterns', ctx=Store(), lineno=467, col_offset=8, end_lineno=467, end_col_offset=32), annotation=Subscript(value=Name(id='list', ctx=Load(), lineno=467, col_offset=34, end_lineno=467, end_col_offset=38), slice=Name(id='str', ctx=Load(), lineno=467, col_offset=39, end_lineno=467, end_col_offset=42), ctx=Load(), lineno=467, col_offset=34, end_lineno=467, end_col_offset=43), value=List(ctx=Load(), lineno=467, col_offset=46, end_lineno=467, end_col_offset=48), simple=1, lineno=467, col_offset=8, end_lineno=467, end_col_offset=48), AnnAssign(target=Name(id='simple_exclude_globs', ctx=Store(), lineno=468, col_offset=8, end_lineno=468, end_col_offset=28), annotation=Subscript(value=Name(id='list', ctx=Load(), lineno=468, col_offset=30, end_lineno=468, end_col_offset=34), slice=Name(id='str', ctx=Load(), lineno=468, col_offset=35, end_lineno=468, end_col_offset=38), ctx=Load(), lineno=468, col_offset=30, end_lineno=468, end_col_offset=39), value=List(ctx=Load(), lineno=468, col_offset=42, end_lineno=468, end_col_offset=44), simple=1, lineno=468, col_offset=8, end_lineno=468, end_col_offset=44), AnnAssign(target=Name(id='complex_exclude_patterns', ctx=Store(), lineno=469, col_offset=8, end_lineno=469, end_col_offset=32), annotation=Subscript(value=Name(id='list', ctx=Load(), lineno=469, col_offset=34, end_lineno=469, end_col_offset=38), slice=Name(id='str', ctx=Load(), lineno=469, col_offset=39, end_lineno=469, end_col_offset=42), ctx=Load(), lineno=469, col_offset=34, end_lineno=469, end_col_offset=43), value=List(ctx=Load(), lineno=469, col_offset=46, end_lineno=469, end_col_offset=48), simple=1, lineno=469, col_offset=8, end_lineno=469, end_col_offset=48), For(target=Tuple(elts=[Name(id='patterns', ctx=Store(), lineno=471, col_offset=12, end_lineno=471, end_col_offset=20), Name(id='target_simple', ctx=Store(), lineno=471, col_offset=22, end_lineno=471, end_col_offset=35), Name(id='target_complex', ctx=Store(), lineno=471, col_offset=37, end_lineno=471, end_col_offset=51)], ctx=Store(), lineno=471, col_offset=12, end_lineno=471, end_col_offset=51), iter=Tuple(elts=[Tuple(elts=[Name(id='include_globs', ctx=Load(), lineno=472, col_offset=13, end_lineno=472, end_col_offset=26), Name(id='simple_include_globs', ctx=Load(), lineno=472, col_offset=28, end_lineno=472, end_col_offset=48), Name(id='complex_include_patterns', ctx=Load(), lineno=472, col_offset=50, end_lineno=472, end_col_offset=74)], ctx=Load(), lineno=472, col_offset=12, end_lineno=472, end_col_offset=75), Tuple(elts=[Name(id='exclude_globs', ctx=Load(), lineno=473, col_offset=13, end_lineno=473, end_col_offset=26), Name(id='simple_exclude_globs', ctx=Load(), lineno=473, col_offset=28, end_lineno=473, end_col_offset=48), Name(id='complex_exclude_patterns', ctx=Load(), lineno=473, col_offset=50, end_lineno=473, end_col_offset=74)], ctx=Load(), lineno=473, col_offset=12, end_lineno=473, end_col_offset=75)], ctx=Load(), lineno=471, col_offset=55, end_lineno=474, end_col_offset=9), body=[If(test=UnaryOp(op=Not(), operand=Name(id='patterns', ctx=Load(), lineno=475, col_offset=19, end_lineno=475, end_col_offset=27), lineno=475, col_offset=15, end_lineno=475, end_col_offset=27), body=[Continue(lineno=476, col_offset=16, end_lineno=476, end_col_offset=24)], lineno=475, col_offset=12, end_lineno=476, end_col_offset=24), For(target=Name(id='pattern', ctx=Store(), lineno=477, col_offset=16, end_lineno=477, end_col_offset=23), iter=Name(id='patterns', ctx=Load(), lineno=477, col_offset=27, end_lineno=477, end_col_offset=35), body=[If(test=Call(func=Attribute(value=Name(id='self', ctx=Load(), lineno=478, col_offset=19, end_lineno=478, end_col_offset=23), attr='_is_simple_glob', ctx=Load(), lineno=478, col_offset=19, end_lineno=478, end_col_offset=39), args=[Name(id='pattern', ctx=Load(), lineno=478, col_offset=40, end_lineno=478, end_col_offset=47)], lineno=478, col_offset=19, end_lineno=478, end_col_offset=48), body=[Expr(value=Call(func=Attribute(value=Name(id='target_simple', ctx=Load(), lineno=479, col_offset=20, end_lineno=479, end_col_offset=33), attr='append', ctx=Load(), lineno=479, col_offset=20, end_lineno=479, end_col_offset=40), args=[Name(id='pattern', ctx=Load(), lineno=479, col_offset=41, end_lineno=479, end_col_offset=48)], lineno=479, col_offset=20, end_lineno=479, end_col_offset=49), lineno=479, col_offset=20, end_lineno=479, end_col_offset=49)], orelse=[Expr(value=Call(func=Attribute(value=Name(id='target_complex', ctx=Load(), lineno=481, col_offset=20, end_lineno=481, end_col_offset=34), attr='append', ctx=Load(), lineno=481, col_offset=20, end_lineno=481, end_col_offset=41), args=[Name(id='pattern', ctx=Load(), lineno=481, col_offset=42, end_lineno=481, end_col_offset=49)], lineno=481, col_offset=20, end_lineno=481, end_col_offset=50), lineno=481, col_offset=20, end_lineno=481, end_col_offset=50)], lineno=478, col_offset=16, end_lineno=481, end_col_offset=50)], lineno=477, col_offset=12, end_lineno=481, end_col_offset=50)], lineno=471, col_offset=8, end_lineno=481, end_col_offset=50), AnnAssign(target=Name(id='language_extensions', ctx=Store(), lineno=483, col_offset=8, end_lineno=483, end_col_offset=27), annotation=Subscript(value=Name(id='set', ctx=Load(), lineno=483, col_offset=29, end_lineno=483, end_col_offset=32), slice=Name(id='str', ctx=Load(), lineno=483, col_offset=33, end_lineno=483, end_col_offset=36), ctx=Load(), lineno=483, col_offset=29, end_lineno=483, end_col_offset=37), value=Call(func=Name(id='set', ctx=Load(), lineno=483, col_offset=40, end_lineno=483, end_col_offset=43), lineno=483, col_offset=40, end_lineno=483, end_col_offset=45), simple=1, lineno=483, col_offset=8, end_lineno=483, end_col_offset=45), If(test=Name(id='languages', ctx=Load(), lineno=484, col_offset=11, end_lineno=484, end_col_offset=20), body=[For(target=Name(id='lang', ctx=Store(), lineno=485, col_offset=16, end_lineno=485, end_col_offset=20), iter=Name(id='languages', ctx=Load(), lineno=485, col_offset=24, end_lineno=485, end_col_offset=33), body=[Assign(targets=[Name(id='extensions', ctx=Store(), lineno=486, col_offset=16, end_lineno=486, end_col_offset=26)], value=Call(func=Attribute(value=Name(id='LANGUAGE_EXTENSIONS', ctx=Load(), lineno=486, col_offset=29, end_lineno=486, end_col_offset=48), attr='get', ctx=Load(), lineno=486, col_offset=29, end_lineno=486, end_col_offset=52), args=[Call(func=Attribute(value=Name(id='lang', ctx=Load(), lineno=486, col_offset=53, end_lineno=486, end_col_offset=57), attr='lower', ctx=Load(), lineno=486, col_offset=53, end_lineno=486, end_col_offset=63), lineno=486, col_offset=53, end_lineno=486, end_col_offset=65), List(ctx=Load(), lineno=486, col_offset=67, end_lineno=486, end_col_offset=69)], lineno=486, col_offset=29, end_lineno=486, end_col_offset=70), lineno=486, col_offset=16, end_lineno=486, end_col_offset=70), Expr(value=Call(func=Attribute(value=Name(id='language_extensions', ctx=Load(), lineno=487, col_offset=16, end_lineno=487, end_col_offset=35), attr='update', ctx=Load(), lineno=487, col_offset=16, end_lineno=487, end_col_offset=42), args=[GeneratorExp(elt=Call(func=Attribute(value=Name(id='ext', ctx=Load(), lineno=487, col_offset=43, end_lineno=487, end_col_offset=46), attr='lower', ctx=Load(), lineno=487, col_offset=43, end_lineno=487, end_col_offset=52), lineno=487, col_offset=43, end_lineno=487, end_col_offset=54), generators=[comprehension(target=Name(id='ext', ctx=Store(), lineno=487, col_offset=59, end_lineno=487, end_col_offset=62), iter=Name(id='extensions', ctx=Load(), lineno=487, col_offset=66, end_lineno=487, end_col_offset=76), is_async=0)], lineno=487, col_offset=42, end_lineno=487, end_col_offset=77)], lineno=487, col_offset=16, end_lineno=487, end_col_offset=77), lineno=487, col_offset=16, end_lineno=487, end_col_offset=77)], lineno=485, col_offset=12, end_lineno=487, end_col_offset=77)], lineno=484, col_offset=8, end_lineno=487, end_col_offset=77), Assign(targets=[Name(id='chunk_ids', ctx=Store(), lineno=489, col_offset=8, end_lineno=489, end_col_offset=17)], value=Call(func=Name(id='tuple', ctx=Load(), lineno=489, col_offset=20, end_lineno=489, end_col_offset=25), args=[GeneratorExp(elt=Call(func=Name(id='int', ctx=Load(), lineno=489, col_offset=26, end_lineno=489, end_col_offset=29), args=[Name(id='chunk_id', ctx=Load(), lineno=489, col_offset=30, end_lineno=489, end_col_offset=38)], lineno=489, col_offset=26, end_lineno=489, end_col_offset=39), generators=[comprehension(target=Name(id='chunk_id', ctx=Store(), lineno=489, col_offset=44, end_lineno=489, end_col_offset=52), iter=Name(id='ids', ctx=Load(), lineno=489, col_offset=56, end_lineno=489, end_col_offset=59), is_async=0)], lineno=489, col_offset=25, end_lineno=489, end_col_offset=60)], lineno=489, col_offset=20, end_lineno=489, end_col_offset=60), lineno=489, col_offset=8, end_lineno=489, end_col_offset=60), Return(value=Call(func=Name(id='_ScopeFilterSpec', ctx=Load(), lineno=491, col_offset=15, end_lineno=491, end_col_offset=31), keywords=[keyword(arg='chunk_ids', value=Name(id='chunk_ids', ctx=Load(), lineno=492, col_offset=22, end_lineno=492, end_col_offset=31), lineno=492, col_offset=12, end_lineno=492, end_col_offset=31), keyword(arg='simple_include_globs', value=IfExp(test=Name(id='simple_include_globs', ctx=Load(), lineno=493, col_offset=65, end_lineno=493, end_col_offset=85), body=Call(func=Name(id='tuple', ctx=Load(), lineno=493, col_offset=34, end_lineno=493, end_col_offset=39), args=[Name(id='simple_include_globs', ctx=Load(), lineno=493, col_offset=40, end_lineno=493, end_col_offset=60)], lineno=493, col_offset=34, end_lineno=493, end_col_offset=61), orelse=Constant(value=None, lineno=493, col_offset=91, end_lineno=493, end_col_offset=95), lineno=493, col_offset=34, end_lineno=493, end_col_offset=95), lineno=493, col_offset=12, end_lineno=493, end_col_offset=96), keyword(arg='simple_exclude_globs', value=IfExp(test=Name(id='simple_exclude_globs', ctx=Load(), lineno=494, col_offset=65, end_lineno=494, end_col_offset=85), body=Call(func=Name(id='tuple', ctx=Load(), lineno=494, col_offset=34, end_lineno=494, end_col_offset=39), args=[Name(id='simple_exclude_globs', ctx=Load(), lineno=494, col_offset=40, end_lineno=494, end_col_offset=60)], lineno=494, col_offset=34, end_lineno=494, end_col_offset=61), orelse=Constant(value=None, lineno=494, col_offset=91, end_lineno=494, end_col_offset=95), lineno=494, col_offset=34, end_lineno=494, end_col_offset=95), lineno=494, col_offset=12, end_lineno=494, end_col_offset=96), keyword(arg='complex_include_patterns', value=Call(func=Name(id='tuple', ctx=Load(), lineno=495, col_offset=37, end_lineno=495, end_col_offset=42), args=[Name(id='complex_include_patterns', ctx=Load(), lineno=495, col_offset=43, end_lineno=495, end_col_offset=67)], lineno=495, col_offset=37, end_lineno=495, end_col_offset=68), lineno=495, col_offset=12, end_lineno=495, end_col_offset=68), keyword(arg='complex_exclude_patterns', value=Call(func=Name(id='tuple', ctx=Load(), lineno=496, col_offset=37, end_lineno=496, end_col_offset=42), args=[Name(id='complex_exclude_patterns', ctx=Load(), lineno=496, col_offset=43, end_lineno=496, end_col_offset=67)], lineno=496, col_offset=37, end_lineno=496, end_col_offset=68), lineno=496, col_offset=12, end_lineno=496, end_col_offset=68), keyword(arg='language_extensions', value=Call(func=Name(id='frozenset', ctx=Load(), lineno=497, col_offset=32, end_lineno=497, end_col_offset=41), args=[Name(id='language_extensions', ctx=Load(), lineno=497, col_offset=42, end_lineno=497, end_col_offset=61)], lineno=497, col_offset=32, end_lineno=497, end_col_offset=62), lineno=497, col_offset=12, end_lineno=497, end_col_offset=62)], lineno=491, col_offset=15, end_lineno=498, end_col_offset=9), lineno=491, col_offset=8, end_lineno=498, end_col_offset=9)], returns=Name(id='_ScopeFilterSpec', ctx=Load(), lineno=447, col_offset=9, end_lineno=447, end_col_offset=25), lineno=440, col_offset=4, end_lineno=498, end_col_offset=9), FunctionDef(name='_apply_complex_glob_filters', args=arguments(args=[arg(arg='results', annotation=Subscript(value=Name(id='list', ctx=Load(), lineno=502, col_offset=17, end_lineno=502, end_col_offset=21), slice=Name(id='dict', ctx=Load(), lineno=502, col_offset=22, end_lineno=502, end_col_offset=26), ctx=Load(), lineno=502, col_offset=17, end_lineno=502, end_col_offset=27), lineno=502, col_offset=8, end_lineno=502, end_col_offset=27), arg(arg='include_patterns', annotation=Subscript(value=Name(id='tuple', ctx=Load(), lineno=503, col_offset=26, end_lineno=503, end_col_offset=31), slice=Tuple(elts=[Name(id='str', ctx=Load(), lineno=503, col_offset=32, end_lineno=503, end_col_offset=35), Constant(value=Ellipsis, lineno=503, col_offset=37, end_lineno=503, end_col_offset=40)], ctx=Load(), lineno=503, col_offset=32, end_lineno=503, end_col_offset=40), ctx=Load(), lineno=503, col_offset=26, end_lineno=503, end_col_offset=41), lineno=503, col_offset=8, end_lineno=503, end_col_offset=41), arg(arg='exclude_patterns', annotation=Subscript(value=Name(id='tuple', ctx=Load(), lineno=504, col_offset=26, end_lineno=504, end_col_offset=31), slice=Tuple(elts=[Name(id='str', ctx=Load(), lineno=504, col_offset=32, end_lineno=504, end_col_offset=35), Constant(value=Ellipsis, lineno=504, col_offset=37, end_lineno=504, end_col_offset=40)], ctx=Load(), lineno=504, col_offset=32, end_lineno=504, end_col_offset=40), ctx=Load(), lineno=504, col_offset=26, end_lineno=504, end_col_offset=41), lineno=504, col_offset=8, end_lineno=504, end_col_offset=41)]), body=[Expr(value=Constant(value='Run Python filtering for complex glob patterns not expressible in SQL.\n\n        This method filters results by applying include and exclude glob patterns\n        to the URI field of each result dictionary. Patterns that cannot be\n        efficiently expressed in SQL (e.g., complex wildcards, multiple patterns)\n        are handled here using Python\'s path matching logic.\n\n        Parameters\n        ----------\n        results : list[dict]\n            List of result dictionaries, each containing at least a "uri" key.\n        include_patterns : tuple[str, ...]\n            Glob patterns that URIs must match to be included. Empty tuple means\n            no inclusion filter is applied.\n        exclude_patterns : tuple[str, ...]\n            Glob patterns that URIs must not match to be included. Empty tuple\n            means no exclusion filter is applied.\n\n        Returns\n        -------\n        list[dict]\n            Filtered results matching include/exclude glob patterns. Results\n            matching exclude patterns or not matching include patterns are removed.\n        ', lineno=506, col_offset=8, end_lineno=529, end_col_offset=11), lineno=506, col_offset=8, end_lineno=529, end_col_offset=11), If(test=BoolOp(op=And(), values=[UnaryOp(op=Not(), operand=Name(id='include_patterns', ctx=Load(), lineno=530, col_offset=15, end_lineno=530, end_col_offset=31), lineno=530, col_offset=11, end_lineno=530, end_col_offset=31), UnaryOp(op=Not(), operand=Name(id='exclude_patterns', ctx=Load(), lineno=530, col_offset=40, end_lineno=530, end_col_offset=56), lineno=530, col_offset=36, end_lineno=530, end_col_offset=56)], lineno=530, col_offset=11, end_lineno=530, end_col_offset=56), body=[Return(value=Name(id='results', ctx=Load(), lineno=531, col_offset=19, end_lineno=531, end_col_offset=26), lineno=531, col_offset=12, end_lineno=531, end_col_offset=26)], lineno=530, col_offset=8, end_lineno=531, end_col_offset=26), AnnAssign(target=Name(id='filtered_results', ctx=Store(), lineno=533, col_offset=8, end_lineno=533, end_col_offset=24), annotation=Subscript(value=Name(id='list', ctx=Load(), lineno=533, col_offset=26, end_lineno=533, end_col_offset=30), slice=Name(id='dict', ctx=Load(), lineno=533, col_offset=31, end_lineno=533, end_col_offset=35), ctx=Load(), lineno=533, col_offset=26, end_lineno=533, end_col_offset=36), value=List(ctx=Load(), lineno=533, col_offset=39, end_lineno=533, end_col_offset=41), simple=1, lineno=533, col_offset=8, end_lineno=533, end_col_offset=41), For(target=Name(id='chunk', ctx=Store(), lineno=534, col_offset=12, end_lineno=534, end_col_offset=17), iter=Name(id='results', ctx=Load(), lineno=534, col_offset=21, end_lineno=534, end_col_offset=28), body=[Assign(targets=[Name(id='uri', ctx=Store(), lineno=535, col_offset=12, end_lineno=535, end_col_offset=15)], value=Call(func=Attribute(value=Name(id='chunk', ctx=Load(), lineno=535, col_offset=18, end_lineno=535, end_col_offset=23), attr='get', ctx=Load(), lineno=535, col_offset=18, end_lineno=535, end_col_offset=27), args=[Constant(value='uri', lineno=535, col_offset=28, end_lineno=535, end_col_offset=33), Constant(value='', lineno=535, col_offset=35, end_lineno=535, end_col_offset=37)], lineno=535, col_offset=18, end_lineno=535, end_col_offset=38), lineno=535, col_offset=12, end_lineno=535, end_col_offset=38), If(test=UnaryOp(op=Not(), operand=Call(func=Name(id='isinstance', ctx=Load(), lineno=536, col_offset=19, end_lineno=536, end_col_offset=29), args=[Name(id='uri', ctx=Load(), lineno=536, col_offset=30, end_lineno=536, end_col_offset=33), Name(id='str', ctx=Load(), lineno=536, col_offset=35, end_lineno=536, end_col_offset=38)], lineno=536, col_offset=19, end_lineno=536, end_col_offset=39), lineno=536, col_offset=15, end_lineno=536, end_col_offset=39), body=[Continue(lineno=537, col_offset=16, end_lineno=537, end_col_offset=24)], lineno=536, col_offset=12, end_lineno=537, end_col_offset=24), If(test=BoolOp(op=And(), values=[Name(id='include_patterns', ctx=Load(), lineno=539, col_offset=15, end_lineno=539, end_col_offset=31), UnaryOp(op=Not(), operand=Call(func=Name(id='any', ctx=Load(), lineno=539, col_offset=40, end_lineno=539, end_col_offset=43), args=[GeneratorExp(elt=Call(func=Name(id='path_matches_glob', ctx=Load(), lineno=540, col_offset=16, end_lineno=540, end_col_offset=33), args=[Name(id='uri', ctx=Load(), lineno=540, col_offset=34, end_lineno=540, end_col_offset=37), Name(id='pattern', ctx=Load(), lineno=540, col_offset=39, end_lineno=540, end_col_offset=46)], lineno=540, col_offset=16, end_lineno=540, end_col_offset=47), generators=[comprehension(target=Name(id='pattern', ctx=Store(), lineno=540, col_offset=52, end_lineno=540, end_col_offset=59), iter=Name(id='include_patterns', ctx=Load(), lineno=540, col_offset=63, end_lineno=540, end_col_offset=79), is_async=0)], lineno=539, col_offset=43, end_lineno=541, end_col_offset=13)], lineno=539, col_offset=40, end_lineno=541, end_col_offset=13), lineno=539, col_offset=36, end_lineno=541, end_col_offset=13)], lineno=539, col_offset=15, end_lineno=541, end_col_offset=13), body=[Continue(lineno=542, col_offset=16, end_lineno=542, end_col_offset=24)], lineno=539, col_offset=12, end_lineno=542, end_col_offset=24), If(test=BoolOp(op=And(), values=[Name(id='exclude_patterns', ctx=Load(), lineno=544, col_offset=15, end_lineno=544, end_col_offset=31), Call(func=Name(id='any', ctx=Load(), lineno=544, col_offset=36, end_lineno=544, end_col_offset=39), args=[GeneratorExp(elt=Call(func=Name(id='path_matches_glob', ctx=Load(), lineno=545, col_offset=16, end_lineno=545, end_col_offset=33), args=[Name(id='uri', ctx=Load(), lineno=545, col_offset=34, end_lineno=545, end_col_offset=37), Name(id='pattern', ctx=Load(), lineno=545, col_offset=39, end_lineno=545, end_col_offset=46)], lineno=545, col_offset=16, end_lineno=545, end_col_offset=47), generators=[comprehension(target=Name(id='pattern', ctx=Store(), lineno=545, col_offset=52, end_lineno=545, end_col_offset=59), iter=Name(id='exclude_patterns', ctx=Load(), lineno=545, col_offset=63, end_lineno=545, end_col_offset=79), is_async=0)], lineno=544, col_offset=39, end_lineno=546, end_col_offset=13)], lineno=544, col_offset=36, end_lineno=546, end_col_offset=13)], lineno=544, col_offset=15, end_lineno=546, end_col_offset=13), body=[Continue(lineno=547, col_offset=16, end_lineno=547, end_col_offset=24)], lineno=544, col_offset=12, end_lineno=547, end_col_offset=24), Expr(value=Call(func=Attribute(value=Name(id='filtered_results', ctx=Load(), lineno=549, col_offset=12, end_lineno=549, end_col_offset=28), attr='append', ctx=Load(), lineno=549, col_offset=12, end_lineno=549, end_col_offset=35), args=[Name(id='chunk', ctx=Load(), lineno=549, col_offset=36, end_lineno=549, end_col_offset=41)], lineno=549, col_offset=12, end_lineno=549, end_col_offset=42), lineno=549, col_offset=12, end_lineno=549, end_col_offset=42)], lineno=534, col_offset=8, end_lineno=549, end_col_offset=42), Return(value=Name(id='filtered_results', ctx=Load(), lineno=551, col_offset=15, end_lineno=551, end_col_offset=31), lineno=551, col_offset=8, end_lineno=551, end_col_offset=31)], decorator_list=[Name(id='staticmethod', ctx=Load(), lineno=500, col_offset=5, end_lineno=500, end_col_offset=17)], returns=Subscript(value=Name(id='list', ctx=Load(), lineno=505, col_offset=9, end_lineno=505, end_col_offset=13), slice=Name(id='dict', ctx=Load(), lineno=505, col_offset=14, end_lineno=505, end_col_offset=18), ctx=Load(), lineno=505, col_offset=9, end_lineno=505, end_col_offset=19), lineno=501, col_offset=4, end_lineno=551, end_col_offset=31), FunctionDef(name='_apply_language_filters', args=arguments(args=[arg(arg='results', annotation=Subscript(value=Name(id='list', ctx=Load(), lineno=555, col_offset=17, end_lineno=555, end_col_offset=21), slice=Name(id='dict', ctx=Load(), lineno=555, col_offset=22, end_lineno=555, end_col_offset=26), ctx=Load(), lineno=555, col_offset=17, end_lineno=555, end_col_offset=27), lineno=555, col_offset=8, end_lineno=555, end_col_offset=27), arg(arg='language_extensions', annotation=Subscript(value=Name(id='frozenset', ctx=Load(), lineno=556, col_offset=29, end_lineno=556, end_col_offset=38), slice=Name(id='str', ctx=Load(), lineno=556, col_offset=39, end_lineno=556, end_col_offset=42), ctx=Load(), lineno=556, col_offset=29, end_lineno=556, end_col_offset=43), lineno=556, col_offset=8, end_lineno=556, end_col_offset=43)]), body=[Expr(value=Constant(value='Filter results by normalized file extensions.\n\n        This method filters results to include only those whose URI ends with\n        one of the specified language extensions. Extensions are matched\n        case-insensitively against the lowercase URI.\n\n        Parameters\n        ----------\n        results : list[dict]\n            List of result dictionaries, each containing at least a "uri" key.\n        language_extensions : frozenset[str]\n            Set of normalized file extensions (e.g., {".py", ".js", ".ts"}).\n            Extensions should include the leading dot. Empty set means no\n            language filter is applied.\n\n        Returns\n        -------\n        list[dict]\n            Filtered results matching language extensions. Only results whose\n            URI ends with one of the specified extensions are included.\n        ', lineno=558, col_offset=8, end_lineno=578, end_col_offset=11), lineno=558, col_offset=8, end_lineno=578, end_col_offset=11), If(test=UnaryOp(op=Not(), operand=Name(id='language_extensions', ctx=Load(), lineno=579, col_offset=15, end_lineno=579, end_col_offset=34), lineno=579, col_offset=11, end_lineno=579, end_col_offset=34), body=[Return(value=Name(id='results', ctx=Load(), lineno=580, col_offset=19, end_lineno=580, end_col_offset=26), lineno=580, col_offset=12, end_lineno=580, end_col_offset=26)], lineno=579, col_offset=8, end_lineno=580, end_col_offset=26), AnnAssign(target=Name(id='filtered_results', ctx=Store(), lineno=582, col_offset=8, end_lineno=582, end_col_offset=24), annotation=Subscript(value=Name(id='list', ctx=Load(), lineno=582, col_offset=26, end_lineno=582, end_col_offset=30), slice=Name(id='dict', ctx=Load(), lineno=582, col_offset=31, end_lineno=582, end_col_offset=35), ctx=Load(), lineno=582, col_offset=26, end_lineno=582, end_col_offset=36), value=List(ctx=Load(), lineno=582, col_offset=39, end_lineno=582, end_col_offset=41), simple=1, lineno=582, col_offset=8, end_lineno=582, end_col_offset=41), For(target=Name(id='chunk', ctx=Store(), lineno=583, col_offset=12, end_lineno=583, end_col_offset=17), iter=Name(id='results', ctx=Load(), lineno=583, col_offset=21, end_lineno=583, end_col_offset=28), body=[Assign(targets=[Name(id='uri', ctx=Store(), lineno=584, col_offset=12, end_lineno=584, end_col_offset=15)], value=Call(func=Attribute(value=Name(id='chunk', ctx=Load(), lineno=584, col_offset=18, end_lineno=584, end_col_offset=23), attr='get', ctx=Load(), lineno=584, col_offset=18, end_lineno=584, end_col_offset=27), args=[Constant(value='uri', lineno=584, col_offset=28, end_lineno=584, end_col_offset=33), Constant(value='', lineno=584, col_offset=35, end_lineno=584, end_col_offset=37)], lineno=584, col_offset=18, end_lineno=584, end_col_offset=38), lineno=584, col_offset=12, end_lineno=584, end_col_offset=38), If(test=UnaryOp(op=Not(), operand=Call(func=Name(id='isinstance', ctx=Load(), lineno=585, col_offset=19, end_lineno=585, end_col_offset=29), args=[Name(id='uri', ctx=Load(), lineno=585, col_offset=30, end_lineno=585, end_col_offset=33), Name(id='str', ctx=Load(), lineno=585, col_offset=35, end_lineno=585, end_col_offset=38)], lineno=585, col_offset=19, end_lineno=585, end_col_offset=39), lineno=585, col_offset=15, end_lineno=585, end_col_offset=39), body=[Continue(lineno=586, col_offset=16, end_lineno=586, end_col_offset=24)], lineno=585, col_offset=12, end_lineno=586, end_col_offset=24), Assign(targets=[Name(id='uri_lower', ctx=Store(), lineno=587, col_offset=12, end_lineno=587, end_col_offset=21)], value=Call(func=Attribute(value=Name(id='uri', ctx=Load(), lineno=587, col_offset=24, end_lineno=587, end_col_offset=27), attr='lower', ctx=Load(), lineno=587, col_offset=24, end_lineno=587, end_col_offset=33), lineno=587, col_offset=24, end_lineno=587, end_col_offset=35), lineno=587, col_offset=12, end_lineno=587, end_col_offset=35), If(test=Call(func=Name(id='any', ctx=Load(), lineno=588, col_offset=15, end_lineno=588, end_col_offset=18), args=[GeneratorExp(elt=Call(func=Attribute(value=Name(id='uri_lower', ctx=Load(), lineno=588, col_offset=19, end_lineno=588, end_col_offset=28), attr='endswith', ctx=Load(), lineno=588, col_offset=19, end_lineno=588, end_col_offset=37), args=[Name(id='ext', ctx=Load(), lineno=588, col_offset=38, end_lineno=588, end_col_offset=41)], lineno=588, col_offset=19, end_lineno=588, end_col_offset=42), generators=[comprehension(target=Name(id='ext', ctx=Store(), lineno=588, col_offset=47, end_lineno=588, end_col_offset=50), iter=Name(id='language_extensions', ctx=Load(), lineno=588, col_offset=54, end_lineno=588, end_col_offset=73), is_async=0)], lineno=588, col_offset=18, end_lineno=588, end_col_offset=74)], lineno=588, col_offset=15, end_lineno=588, end_col_offset=74), body=[Expr(value=Call(func=Attribute(value=Name(id='filtered_results', ctx=Load(), lineno=589, col_offset=16, end_lineno=589, end_col_offset=32), attr='append', ctx=Load(), lineno=589, col_offset=16, end_lineno=589, end_col_offset=39), args=[Name(id='chunk', ctx=Load(), lineno=589, col_offset=40, end_lineno=589, end_col_offset=45)], lineno=589, col_offset=16, end_lineno=589, end_col_offset=46), lineno=589, col_offset=16, end_lineno=589, end_col_offset=46)], lineno=588, col_offset=12, end_lineno=589, end_col_offset=46)], lineno=583, col_offset=8, end_lineno=589, end_col_offset=46), Return(value=Name(id='filtered_results', ctx=Load(), lineno=590, col_offset=15, end_lineno=590, end_col_offset=31), lineno=590, col_offset=8, end_lineno=590, end_col_offset=31)], decorator_list=[Name(id='staticmethod', ctx=Load(), lineno=553, col_offset=5, end_lineno=553, end_col_offset=17)], returns=Subscript(value=Name(id='list', ctx=Load(), lineno=557, col_offset=9, end_lineno=557, end_col_offset=13), slice=Name(id='dict', ctx=Load(), lineno=557, col_offset=14, end_lineno=557, end_col_offset=18), ctx=Load(), lineno=557, col_offset=9, end_lineno=557, end_col_offset=19), lineno=554, col_offset=4, end_lineno=590, end_col_offset=31), FunctionDef(name='_observe_scope_filter_duration', args=arguments(args=[arg(arg='self', lineno=593, col_offset=8, end_lineno=593, end_col_offset=12), arg(arg='start_time', annotation=Name(id='float', ctx=Load(), lineno=594, col_offset=20, end_lineno=594, end_col_offset=25), lineno=594, col_offset=8, end_lineno=594, end_col_offset=25), arg(arg='include_globs', annotation=BinOp(left=Subscript(value=Name(id='list', ctx=Load(), lineno=595, col_offset=23, end_lineno=595, end_col_offset=27), slice=Name(id='str', ctx=Load(), lineno=595, col_offset=28, end_lineno=595, end_col_offset=31), ctx=Load(), lineno=595, col_offset=23, end_lineno=595, end_col_offset=32), op=BitOr(), right=Constant(value=None, lineno=595, col_offset=35, end_lineno=595, end_col_offset=39), lineno=595, col_offset=23, end_lineno=595, end_col_offset=39), lineno=595, col_offset=8, end_lineno=595, end_col_offset=39), arg(arg='exclude_globs', annotation=BinOp(left=Subscript(value=Name(id='list', ctx=Load(), lineno=596, col_offset=23, end_lineno=596, end_col_offset=27), slice=Name(id='str', ctx=Load(), lineno=596, col_offset=28, end_lineno=596, end_col_offset=31), ctx=Load(), lineno=596, col_offset=23, end_lineno=596, end_col_offset=32), op=BitOr(), right=Constant(value=None, lineno=596, col_offset=35, end_lineno=596, end_col_offset=39), lineno=596, col_offset=23, end_lineno=596, end_col_offset=39), lineno=596, col_offset=8, end_lineno=596, end_col_offset=39), arg(arg='languages', annotation=BinOp(left=Subscript(value=Name(id='list', ctx=Load(), lineno=597, col_offset=19, end_lineno=597, end_col_offset=23), slice=Name(id='str', ctx=Load(), lineno=597, col_offset=24, end_lineno=597, end_col_offset=27), ctx=Load(), lineno=597, col_offset=19, end_lineno=597, end_col_offset=28), op=BitOr(), right=Constant(value=None, lineno=597, col_offset=31, end_lineno=597, end_col_offset=35), lineno=597, col_offset=19, end_lineno=597, end_col_offset=35), lineno=597, col_offset=8, end_lineno=597, end_col_offset=35)]), body=[Expr(value=Constant(value='Record how long scope filtering took for observability.', lineno=599, col_offset=8, end_lineno=599, end_col_offset=69), lineno=599, col_offset=8, end_lineno=599, end_col_offset=69), Assign(targets=[Name(id='duration', ctx=Store(), lineno=600, col_offset=8, end_lineno=600, end_col_offset=16)], value=BinOp(left=Call(func=Name(id='perf_counter', ctx=Load(), lineno=600, col_offset=19, end_lineno=600, end_col_offset=31), lineno=600, col_offset=19, end_lineno=600, end_col_offset=33), op=Sub(), right=Name(id='start_time', ctx=Load(), lineno=600, col_offset=36, end_lineno=600, end_col_offset=46), lineno=600, col_offset=19, end_lineno=600, end_col_offset=46), lineno=600, col_offset=8, end_lineno=600, end_col_offset=46), Assign(targets=[Name(id='filter_type', ctx=Store(), lineno=601, col_offset=8, end_lineno=601, end_col_offset=19)], value=Call(func=Attribute(value=Name(id='self', ctx=Load(), lineno=601, col_offset=22, end_lineno=601, end_col_offset=26), attr='_determine_filter_type', ctx=Load(), lineno=601, col_offset=22, end_lineno=601, end_col_offset=49), args=[Name(id='include_globs', ctx=Load(), lineno=601, col_offset=50, end_lineno=601, end_col_offset=63), Name(id='exclude_globs', ctx=Load(), lineno=601, col_offset=65, end_lineno=601, end_col_offset=78), Name(id='languages', ctx=Load(), lineno=601, col_offset=80, end_lineno=601, end_col_offset=89)], lineno=601, col_offset=22, end_lineno=601, end_col_offset=90), lineno=601, col_offset=8, end_lineno=601, end_col_offset=90), With(items=[withitem(context_expr=Call(func=Name(id='suppress', ctx=Load(), lineno=602, col_offset=13, end_lineno=602, end_col_offset=21), args=[Name(id='ValueError', ctx=Load(), lineno=602, col_offset=22, end_lineno=602, end_col_offset=32)], lineno=602, col_offset=13, end_lineno=602, end_col_offset=33))], body=[Expr(value=Call(func=Attribute(value=Call(func=Attribute(value=Name(id='_scope_filter_duration_seconds', ctx=Load(), lineno=603, col_offset=12, end_lineno=603, end_col_offset=42), attr='labels', ctx=Load(), lineno=603, col_offset=12, end_lineno=603, end_col_offset=49), keywords=[keyword(arg='filter_type', value=Name(id='filter_type', ctx=Load(), lineno=603, col_offset=62, end_lineno=603, end_col_offset=73), lineno=603, col_offset=50, end_lineno=603, end_col_offset=73)], lineno=603, col_offset=12, end_lineno=603, end_col_offset=74), attr='observe', ctx=Load(), lineno=603, col_offset=12, end_lineno=603, end_col_offset=82), args=[Name(id='duration', ctx=Load(), lineno=603, col_offset=83, end_lineno=603, end_col_offset=91)], lineno=603, col_offset=12, end_lineno=603, end_col_offset=92), lineno=603, col_offset=12, end_lineno=603, end_col_offset=92)], lineno=602, col_offset=8, end_lineno=603, end_col_offset=92)], returns=Constant(value=None, lineno=598, col_offset=9, end_lineno=598, end_col_offset=13), lineno=592, col_offset=4, end_lineno=603, end_col_offset=92), FunctionDef(name='_determine_filter_type', args=arguments(args=[arg(arg='include_globs', annotation=BinOp(left=Subscript(value=Name(id='list', ctx=Load(), lineno=607, col_offset=23, end_lineno=607, end_col_offset=27), slice=Name(id='str', ctx=Load(), lineno=607, col_offset=28, end_lineno=607, end_col_offset=31), ctx=Load(), lineno=607, col_offset=23, end_lineno=607, end_col_offset=32), op=BitOr(), right=Constant(value=None, lineno=607, col_offset=35, end_lineno=607, end_col_offset=39), lineno=607, col_offset=23, end_lineno=607, end_col_offset=39), lineno=607, col_offset=8, end_lineno=607, end_col_offset=39), arg(arg='exclude_globs', annotation=BinOp(left=Subscript(value=Name(id='list', ctx=Load(), lineno=608, col_offset=23, end_lineno=608, end_col_offset=27), slice=Name(id='str', ctx=Load(), lineno=608, col_offset=28, end_lineno=608, end_col_offset=31), ctx=Load(), lineno=608, col_offset=23, end_lineno=608, end_col_offset=32), op=BitOr(), right=Constant(value=None, lineno=608, col_offset=35, end_lineno=608, end_col_offset=39), lineno=608, col_offset=23, end_lineno=608, end_col_offset=39), lineno=608, col_offset=8, end_lineno=608, end_col_offset=39), arg(arg='languages', annotation=BinOp(left=Subscript(value=Name(id='list', ctx=Load(), lineno=609, col_offset=19, end_lineno=609, end_col_offset=23), slice=Name(id='str', ctx=Load(), lineno=609, col_offset=24, end_lineno=609, end_col_offset=27), ctx=Load(), lineno=609, col_offset=19, end_lineno=609, end_col_offset=28), op=BitOr(), right=Constant(value=None, lineno=609, col_offset=31, end_lineno=609, end_col_offset=35), lineno=609, col_offset=19, end_lineno=609, end_col_offset=35), lineno=609, col_offset=8, end_lineno=609, end_col_offset=35)]), body=[Expr(value=Constant(value='Format the filter type label used for Prometheus metrics.\n\n        Determines the type of scope filtering being applied based on the\n        presence of glob patterns and language filters. Used to label metrics\n        for observability.\n\n        Parameters\n        ----------\n        include_globs : list[str] | None\n            List of include glob patterns, or None if not specified.\n        exclude_globs : list[str] | None\n            List of exclude glob patterns, or None if not specified.\n        languages : list[str] | None\n            List of language filters, or None if not specified.\n\n        Returns\n        -------\n        str\n            Filter type label: "combined" (both globs and languages),\n            "glob" (only glob patterns), "language" (only language filters),\n            or "none" (no filters).\n        ', lineno=611, col_offset=8, end_lineno=632, end_col_offset=11), lineno=611, col_offset=8, end_lineno=632, end_col_offset=11), If(test=BoolOp(op=Or(), values=[Name(id='include_globs', ctx=Load(), lineno=633, col_offset=11, end_lineno=633, end_col_offset=24), Name(id='exclude_globs', ctx=Load(), lineno=633, col_offset=28, end_lineno=633, end_col_offset=41)], lineno=633, col_offset=11, end_lineno=633, end_col_offset=41), body=[Return(value=IfExp(test=Name(id='languages', ctx=Load(), lineno=634, col_offset=33, end_lineno=634, end_col_offset=42), body=Constant(value='combined', lineno=634, col_offset=19, end_lineno=634, end_col_offset=29), orelse=Constant(value='glob', lineno=634, col_offset=48, end_lineno=634, end_col_offset=54), lineno=634, col_offset=19, end_lineno=634, end_col_offset=54), lineno=634, col_offset=12, end_lineno=634, end_col_offset=54)], lineno=633, col_offset=8, end_lineno=634, end_col_offset=54), If(test=Name(id='languages', ctx=Load(), lineno=635, col_offset=11, end_lineno=635, end_col_offset=20), body=[Return(value=Constant(value='language', lineno=636, col_offset=19, end_lineno=636, end_col_offset=29), lineno=636, col_offset=12, end_lineno=636, end_col_offset=29)], lineno=635, col_offset=8, end_lineno=636, end_col_offset=29), Return(value=Constant(value='none', lineno=637, col_offset=15, end_lineno=637, end_col_offset=21), lineno=637, col_offset=8, end_lineno=637, end_col_offset=21)], decorator_list=[Name(id='staticmethod', ctx=Load(), lineno=605, col_offset=5, end_lineno=605, end_col_offset=17)], returns=Name(id='str', ctx=Load(), lineno=610, col_offset=9, end_lineno=610, end_col_offset=12), lineno=606, col_offset=4, end_lineno=637, end_col_offset=21), FunctionDef(name='_is_simple_glob', args=arguments(args=[arg(arg='pattern', annotation=Name(id='str', ctx=Load(), lineno=640, col_offset=33, end_lineno=640, end_col_offset=36), lineno=640, col_offset=24, end_lineno=640, end_col_offset=36)]), body=[Expr(value=Constant(value='Check if glob pattern can be converted to SQL LIKE.\n\n        Simple patterns:\n        - `*.py` (suffix match)\n        - `**/*.py` (suffix match, equivalent to `*.py`)\n        - `src/**` (prefix match)\n        - `src/*.py` (prefix + suffix)\n\n        Complex patterns (require Python filtering):\n        - `src/**/test_*.py` (recursive in middle)\n        - `src/[abc]/*.py` (bracket expressions)\n        - `src/{a,b}/*.py` (brace expansion)\n\n        Parameters\n        ----------\n        pattern : str\n            Glob pattern to check.\n\n        Returns\n        -------\n        bool\n            True if pattern can be converted to SQL LIKE, False otherwise.\n        ', lineno=641, col_offset=8, end_lineno=663, end_col_offset=11), lineno=641, col_offset=8, end_lineno=663, end_col_offset=11), Assign(targets=[Name(id='normalized', ctx=Store(), lineno=665, col_offset=8, end_lineno=665, end_col_offset=18)], value=Call(func=Attribute(value=Name(id='pattern', ctx=Load(), lineno=665, col_offset=21, end_lineno=665, end_col_offset=28), attr='replace', ctx=Load(), lineno=665, col_offset=21, end_lineno=665, end_col_offset=36), args=[Constant(value='\\', lineno=665, col_offset=37, end_lineno=665, end_col_offset=41), Constant(value='/', lineno=665, col_offset=43, end_lineno=665, end_col_offset=46)], lineno=665, col_offset=21, end_lineno=665, end_col_offset=47), lineno=665, col_offset=8, end_lineno=665, end_col_offset=47), If(test=BoolOp(op=Or(), values=[Compare(left=Constant(value='[', lineno=668, col_offset=11, end_lineno=668, end_col_offset=14), ops=[In()], comparators=[Name(id='normalized', ctx=Load(), lineno=668, col_offset=18, end_lineno=668, end_col_offset=28)], lineno=668, col_offset=11, end_lineno=668, end_col_offset=28), Compare(left=Constant(value='{', lineno=668, col_offset=32, end_lineno=668, end_col_offset=35), ops=[In()], comparators=[Name(id='normalized', ctx=Load(), lineno=668, col_offset=39, end_lineno=668, end_col_offset=49)], lineno=668, col_offset=32, end_lineno=668, end_col_offset=49)], lineno=668, col_offset=11, end_lineno=668, end_col_offset=49), body=[Return(value=Constant(value=False, lineno=669, col_offset=19, end_lineno=669, end_col_offset=24), lineno=669, col_offset=12, end_lineno=669, end_col_offset=24)], lineno=668, col_offset=8, end_lineno=669, end_col_offset=24), If(test=Compare(left=Constant(value='**', lineno=672, col_offset=11, end_lineno=672, end_col_offset=15), ops=[In()], comparators=[Name(id='normalized', ctx=Load(), lineno=672, col_offset=19, end_lineno=672, end_col_offset=29)], lineno=672, col_offset=11, end_lineno=672, end_col_offset=29), body=[Assign(targets=[Name(id='parts', ctx=Store(), lineno=673, col_offset=12, end_lineno=673, end_col_offset=17)], value=Call(func=Attribute(value=Name(id='normalized', ctx=Load(), lineno=673, col_offset=20, end_lineno=673, end_col_offset=30), attr='split', ctx=Load(), lineno=673, col_offset=20, end_lineno=673, end_col_offset=36), args=[Constant(value='**', lineno=673, col_offset=37, end_lineno=673, end_col_offset=41)], lineno=673, col_offset=20, end_lineno=673, end_col_offset=42), lineno=673, col_offset=12, end_lineno=673, end_col_offset=42), Assign(targets=[Name(id='expected_parts', ctx=Store(), lineno=674, col_offset=12, end_lineno=674, end_col_offset=26)], value=Constant(value=2, lineno=674, col_offset=29, end_lineno=674, end_col_offset=30), lineno=674, col_offset=12, end_lineno=674, end_col_offset=30), If(test=Compare(left=Call(func=Name(id='len', ctx=Load(), lineno=675, col_offset=15, end_lineno=675, end_col_offset=18), args=[Name(id='parts', ctx=Load(), lineno=675, col_offset=19, end_lineno=675, end_col_offset=24)], lineno=675, col_offset=15, end_lineno=675, end_col_offset=25), ops=[Gt()], comparators=[Name(id='expected_parts', ctx=Load(), lineno=675, col_offset=28, end_lineno=675, end_col_offset=42)], lineno=675, col_offset=15, end_lineno=675, end_col_offset=42), body=[Return(value=Constant(value=False, lineno=676, col_offset=23, end_lineno=676, end_col_offset=28), lineno=676, col_offset=16, end_lineno=676, end_col_offset=28)], lineno=675, col_offset=12, end_lineno=676, end_col_offset=28), If(test=BoolOp(op=And(), values=[Compare(left=Call(func=Name(id='len', ctx=Load(), lineno=677, col_offset=15, end_lineno=677, end_col_offset=18), args=[Name(id='parts', ctx=Load(), lineno=677, col_offset=19, end_lineno=677, end_col_offset=24)], lineno=677, col_offset=15, end_lineno=677, end_col_offset=25), ops=[Eq()], comparators=[Name(id='expected_parts', ctx=Load(), lineno=677, col_offset=29, end_lineno=677, end_col_offset=43)], lineno=677, col_offset=15, end_lineno=677, end_col_offset=43), Subscript(value=Name(id='parts', ctx=Load(), lineno=677, col_offset=48, end_lineno=677, end_col_offset=53), slice=Constant(value=0, lineno=677, col_offset=54, end_lineno=677, end_col_offset=55), ctx=Load(), lineno=677, col_offset=48, end_lineno=677, end_col_offset=56), Subscript(value=Name(id='parts', ctx=Load(), lineno=677, col_offset=61, end_lineno=677, end_col_offset=66), slice=Constant(value=1, lineno=677, col_offset=67, end_lineno=677, end_col_offset=68), ctx=Load(), lineno=677, col_offset=61, end_lineno=677, end_col_offset=69)], lineno=677, col_offset=15, end_lineno=677, end_col_offset=69), body=[Return(value=Constant(value=False, lineno=679, col_offset=23, end_lineno=679, end_col_offset=28), lineno=679, col_offset=16, end_lineno=679, end_col_offset=28)], lineno=677, col_offset=12, end_lineno=679, end_col_offset=28)], lineno=672, col_offset=8, end_lineno=679, end_col_offset=28), Return(value=Constant(value=True, lineno=681, col_offset=15, end_lineno=681, end_col_offset=19), lineno=681, col_offset=8, end_lineno=681, end_col_offset=19)], decorator_list=[Name(id='staticmethod', ctx=Load(), lineno=639, col_offset=5, end_lineno=639, end_col_offset=17)], returns=Name(id='bool', ctx=Load(), lineno=640, col_offset=41, end_lineno=640, end_col_offset=45), lineno=640, col_offset=4, end_lineno=681, end_col_offset=19), FunctionDef(name='get_chunk_by_id', args=arguments(args=[arg(arg='self', lineno=683, col_offset=24, end_lineno=683, end_col_offset=28), arg(arg='chunk_id', annotation=Name(id='int', ctx=Load(), lineno=683, col_offset=40, end_lineno=683, end_col_offset=43), lineno=683, col_offset=30, end_lineno=683, end_col_offset=43)]), body=[Expr(value=Constant(value='Return a single chunk record by ID.\n\n        Parameters\n        ----------\n        chunk_id : int\n            Chunk identifier to retrieve from the catalog.\n\n        Returns\n        -------\n        dict | None\n            Chunk metadata dictionary when the ID exists, otherwise ``None``.\n        ', lineno=684, col_offset=8, end_lineno=695, end_col_offset=11), lineno=684, col_offset=8, end_lineno=695, end_col_offset=11), Assign(targets=[Name(id='results', ctx=Store(), lineno=696, col_offset=8, end_lineno=696, end_col_offset=15)], value=Call(func=Attribute(value=Name(id='self', ctx=Load(), lineno=696, col_offset=18, end_lineno=696, end_col_offset=22), attr='query_by_ids', ctx=Load(), lineno=696, col_offset=18, end_lineno=696, end_col_offset=35), args=[List(elts=[Name(id='chunk_id', ctx=Load(), lineno=696, col_offset=37, end_lineno=696, end_col_offset=45)], ctx=Load(), lineno=696, col_offset=36, end_lineno=696, end_col_offset=46)], lineno=696, col_offset=18, end_lineno=696, end_col_offset=47), lineno=696, col_offset=8, end_lineno=696, end_col_offset=47), If(test=UnaryOp(op=Not(), operand=Name(id='results', ctx=Load(), lineno=697, col_offset=15, end_lineno=697, end_col_offset=22), lineno=697, col_offset=11, end_lineno=697, end_col_offset=22), body=[Return(value=Constant(value=None, lineno=698, col_offset=19, end_lineno=698, end_col_offset=23), lineno=698, col_offset=12, end_lineno=698, end_col_offset=23)], lineno=697, col_offset=8, end_lineno=698, end_col_offset=23), Return(value=Subscript(value=Name(id='results', ctx=Load(), lineno=699, col_offset=15, end_lineno=699, end_col_offset=22), slice=Constant(value=0, lineno=699, col_offset=23, end_lineno=699, end_col_offset=24), ctx=Load(), lineno=699, col_offset=15, end_lineno=699, end_col_offset=25), lineno=699, col_offset=8, end_lineno=699, end_col_offset=25)], returns=BinOp(left=Name(id='dict', ctx=Load(), lineno=683, col_offset=48, end_lineno=683, end_col_offset=52), op=BitOr(), right=Constant(value=None, lineno=683, col_offset=55, end_lineno=683, end_col_offset=59), lineno=683, col_offset=48, end_lineno=683, end_col_offset=59), lineno=683, col_offset=4, end_lineno=699, end_col_offset=25), FunctionDef(name='get_symbols_for_chunk', args=arguments(args=[arg(arg='self', lineno=701, col_offset=30, end_lineno=701, end_col_offset=34), arg(arg='chunk_id', annotation=Name(id='int', ctx=Load(), lineno=701, col_offset=46, end_lineno=701, end_col_offset=49), lineno=701, col_offset=36, end_lineno=701, end_col_offset=49)]), body=[Expr(value=Constant(value="Return all symbols associated with a chunk.\n\n        Parameters\n        ----------\n        chunk_id : int\n            Chunk ID to query symbols for.\n\n        Returns\n        -------\n        list[str]\n            List of symbol identifiers associated with the chunk. Returns empty\n            list if chunk has no symbols or chunk_id doesn't exist.\n        ", lineno=702, col_offset=8, end_lineno=714, end_col_offset=11), lineno=702, col_offset=8, end_lineno=714, end_col_offset=11), With(items=[withitem(context_expr=Call(func=Attribute(value=Name(id='self', ctx=Load(), lineno=715, col_offset=13, end_lineno=715, end_col_offset=17), attr='connection', ctx=Load(), lineno=715, col_offset=13, end_lineno=715, end_col_offset=28), lineno=715, col_offset=13, end_lineno=715, end_col_offset=30), optional_vars=Name(id='conn', ctx=Store(), lineno=715, col_offset=34, end_lineno=715, end_col_offset=38))], body=[Assign(targets=[Name(id='relation', ctx=Store(), lineno=716, col_offset=12, end_lineno=716, end_col_offset=20)], value=Call(func=Attribute(value=Name(id='conn', ctx=Load(), lineno=716, col_offset=23, end_lineno=716, end_col_offset=27), attr='execute', ctx=Load(), lineno=716, col_offset=23, end_lineno=716, end_col_offset=35), args=[Constant(value='SELECT symbol FROM chunk_symbols WHERE chunk_id = ?', lineno=717, col_offset=16, end_lineno=717, end_col_offset=69), List(elts=[Name(id='chunk_id', ctx=Load(), lineno=717, col_offset=72, end_lineno=717, end_col_offset=80)], ctx=Load(), lineno=717, col_offset=71, end_lineno=717, end_col_offset=81)], lineno=716, col_offset=23, end_lineno=718, end_col_offset=13), lineno=716, col_offset=12, end_lineno=718, end_col_offset=13), Assign(targets=[Name(id='rows', ctx=Store(), lineno=719, col_offset=12, end_lineno=719, end_col_offset=16)], value=Call(func=Attribute(value=Name(id='relation', ctx=Load(), lineno=719, col_offset=19, end_lineno=719, end_col_offset=27), attr='fetchall', ctx=Load(), lineno=719, col_offset=19, end_lineno=719, end_col_offset=36), lineno=719, col_offset=19, end_lineno=719, end_col_offset=38), lineno=719, col_offset=12, end_lineno=719, end_col_offset=38)], lineno=715, col_offset=8, end_lineno=719, end_col_offset=38), Return(value=ListComp(elt=Subscript(value=Name(id='row', ctx=Load(), lineno=720, col_offset=16, end_lineno=720, end_col_offset=19), slice=Constant(value=0, lineno=720, col_offset=20, end_lineno=720, end_col_offset=21), ctx=Load(), lineno=720, col_offset=16, end_lineno=720, end_col_offset=22), generators=[comprehension(target=Name(id='row', ctx=Store(), lineno=720, col_offset=27, end_lineno=720, end_col_offset=30), iter=Name(id='rows', ctx=Load(), lineno=720, col_offset=34, end_lineno=720, end_col_offset=38), is_async=0)], lineno=720, col_offset=15, end_lineno=720, end_col_offset=39), lineno=720, col_offset=8, end_lineno=720, end_col_offset=39)], returns=Subscript(value=Name(id='list', ctx=Load(), lineno=701, col_offset=54, end_lineno=701, end_col_offset=58), slice=Name(id='str', ctx=Load(), lineno=701, col_offset=59, end_lineno=701, end_col_offset=62), ctx=Load(), lineno=701, col_offset=54, end_lineno=701, end_col_offset=63), lineno=701, col_offset=4, end_lineno=720, end_col_offset=39), FunctionDef(name='query_by_uri', args=arguments(args=[arg(arg='self', lineno=722, col_offset=21, end_lineno=722, end_col_offset=25), arg(arg='uri', annotation=Name(id='str', ctx=Load(), lineno=722, col_offset=32, end_lineno=722, end_col_offset=35), lineno=722, col_offset=27, end_lineno=722, end_col_offset=35), arg(arg='limit', annotation=Name(id='int', ctx=Load(), lineno=722, col_offset=44, end_lineno=722, end_col_offset=47), lineno=722, col_offset=37, end_lineno=722, end_col_offset=47)], defaults=[Constant(value=100, lineno=722, col_offset=50, end_lineno=722, end_col_offset=53)]), body=[Expr(value=Constant(value='Query chunks by file URI/path.\n\n        Retrieves all chunks from a specific file. Useful for file-level operations\n        like displaying all chunks in a file or filtering search results by file.\n\n        The query uses parameterized SQL to prevent injection and efficiently\n        filters by URI. Results are limited to prevent excessive memory usage\n        for large files. Pass ``limit <= 0`` to disable the limit entirely\n        while still preserving deterministic ordering by chunk ID.\n\n        Parameters\n        ----------\n        uri : str\n            File URI or path to query. Should match the uri field in the chunks\n            table (typically a relative path from repo root).\n        limit : int, optional\n            Maximum number of chunks to return. Defaults to 100. Set higher for\n            large files, but be aware of memory usage. Pass 0 or a negative value\n            to disable the limit (not recommended for production).\n\n        Returns\n        -------\n        list[dict]\n            List of chunk records from the specified file. Each dict contains\n            all chunk columns. Results are ordered by chunk ID (which typically\n            corresponds to file order). Returns empty list if file not found or\n            no chunks in file.\n\n        ', lineno=723, col_offset=8, end_lineno=751, end_col_offset=11), lineno=723, col_offset=8, end_lineno=751, end_col_offset=11), Assign(targets=[Name(id='sql', ctx=Store(), lineno=752, col_offset=8, end_lineno=752, end_col_offset=11)], value=Constant(value='SELECT * FROM chunks WHERE uri = ? ORDER BY id', lineno=752, col_offset=14, end_lineno=752, end_col_offset=62), lineno=752, col_offset=8, end_lineno=752, end_col_offset=62), AnnAssign(target=Name(id='params', ctx=Store(), lineno=753, col_offset=8, end_lineno=753, end_col_offset=14), annotation=Subscript(value=Name(id='list', ctx=Load(), lineno=753, col_offset=16, end_lineno=753, end_col_offset=20), slice=Name(id='object', ctx=Load(), lineno=753, col_offset=21, end_lineno=753, end_col_offset=27), ctx=Load(), lineno=753, col_offset=16, end_lineno=753, end_col_offset=28), value=List(elts=[Name(id='uri', ctx=Load(), lineno=753, col_offset=32, end_lineno=753, end_col_offset=35)], ctx=Load(), lineno=753, col_offset=31, end_lineno=753, end_col_offset=36), simple=1, lineno=753, col_offset=8, end_lineno=753, end_col_offset=36), If(test=Compare(left=Name(id='limit', ctx=Load(), lineno=754, col_offset=11, end_lineno=754, end_col_offset=16), ops=[Gt()], comparators=[Constant(value=0, lineno=754, col_offset=19, end_lineno=754, end_col_offset=20)], lineno=754, col_offset=11, end_lineno=754, end_col_offset=20), body=[Assign(targets=[Name(id='sql', ctx=Store(), lineno=755, col_offset=12, end_lineno=755, end_col_offset=15)], value=Constant(value='SELECT * FROM chunks WHERE uri = ? ORDER BY id LIMIT ?', lineno=755, col_offset=18, end_lineno=755, end_col_offset=74), lineno=755, col_offset=12, end_lineno=755, end_col_offset=74), Expr(value=Call(func=Attribute(value=Name(id='params', ctx=Load(), lineno=756, col_offset=12, end_lineno=756, end_col_offset=18), attr='append', ctx=Load(), lineno=756, col_offset=12, end_lineno=756, end_col_offset=25), args=[Name(id='limit', ctx=Load(), lineno=756, col_offset=26, end_lineno=756, end_col_offset=31)], lineno=756, col_offset=12, end_lineno=756, end_col_offset=32), lineno=756, col_offset=12, end_lineno=756, end_col_offset=32)], lineno=754, col_offset=8, end_lineno=756, end_col_offset=32), With(items=[withitem(context_expr=Call(func=Attribute(value=Name(id='self', ctx=Load(), lineno=758, col_offset=13, end_lineno=758, end_col_offset=17), attr='connection', ctx=Load(), lineno=758, col_offset=13, end_lineno=758, end_col_offset=28), lineno=758, col_offset=13, end_lineno=758, end_col_offset=30), optional_vars=Name(id='conn', ctx=Store(), lineno=758, col_offset=34, end_lineno=758, end_col_offset=38))], body=[Assign(targets=[Name(id='relation', ctx=Store(), lineno=759, col_offset=12, end_lineno=759, end_col_offset=20)], value=Call(func=Attribute(value=Name(id='conn', ctx=Load(), lineno=759, col_offset=23, end_lineno=759, end_col_offset=27), attr='execute', ctx=Load(), lineno=759, col_offset=23, end_lineno=759, end_col_offset=35), args=[Name(id='sql', ctx=Load(), lineno=759, col_offset=36, end_lineno=759, end_col_offset=39), Name(id='params', ctx=Load(), lineno=759, col_offset=41, end_lineno=759, end_col_offset=47)], lineno=759, col_offset=23, end_lineno=759, end_col_offset=48), lineno=759, col_offset=12, end_lineno=759, end_col_offset=48), Assign(targets=[Name(id='rows', ctx=Store(), lineno=760, col_offset=12, end_lineno=760, end_col_offset=16)], value=Call(func=Attribute(value=Name(id='relation', ctx=Load(), lineno=760, col_offset=19, end_lineno=760, end_col_offset=27), attr='fetchall', ctx=Load(), lineno=760, col_offset=19, end_lineno=760, end_col_offset=36), lineno=760, col_offset=19, end_lineno=760, end_col_offset=38), lineno=760, col_offset=12, end_lineno=760, end_col_offset=38), Assign(targets=[Name(id='cols', ctx=Store(), lineno=761, col_offset=12, end_lineno=761, end_col_offset=16)], value=ListComp(elt=Subscript(value=Name(id='desc', ctx=Load(), lineno=761, col_offset=20, end_lineno=761, end_col_offset=24), slice=Constant(value=0, lineno=761, col_offset=25, end_lineno=761, end_col_offset=26), ctx=Load(), lineno=761, col_offset=20, end_lineno=761, end_col_offset=27), generators=[comprehension(target=Name(id='desc', ctx=Store(), lineno=761, col_offset=32, end_lineno=761, end_col_offset=36), iter=Attribute(value=Name(id='relation', ctx=Load(), lineno=761, col_offset=40, end_lineno=761, end_col_offset=48), attr='description', ctx=Load(), lineno=761, col_offset=40, end_lineno=761, end_col_offset=60), is_async=0)], lineno=761, col_offset=19, end_lineno=761, end_col_offset=61), lineno=761, col_offset=12, end_lineno=761, end_col_offset=61)], lineno=758, col_offset=8, end_lineno=761, end_col_offset=61), Return(value=ListComp(elt=Call(func=Name(id='dict', ctx=Load(), lineno=762, col_offset=16, end_lineno=762, end_col_offset=20), args=[Call(func=Name(id='zip', ctx=Load(), lineno=762, col_offset=21, end_lineno=762, end_col_offset=24), args=[Name(id='cols', ctx=Load(), lineno=762, col_offset=25, end_lineno=762, end_col_offset=29), Name(id='row', ctx=Load(), lineno=762, col_offset=31, end_lineno=762, end_col_offset=34)], keywords=[keyword(arg='strict', value=Constant(value=True, lineno=762, col_offset=43, end_lineno=762, end_col_offset=47), lineno=762, col_offset=36, end_lineno=762, end_col_offset=47)], lineno=762, col_offset=21, end_lineno=762, end_col_offset=48)], lineno=762, col_offset=16, end_lineno=762, end_col_offset=49), generators=[comprehension(target=Name(id='row', ctx=Store(), lineno=762, col_offset=54, end_lineno=762, end_col_offset=57), iter=Name(id='rows', ctx=Load(), lineno=762, col_offset=61, end_lineno=762, end_col_offset=65), is_async=0)], lineno=762, col_offset=15, end_lineno=762, end_col_offset=66), lineno=762, col_offset=8, end_lineno=762, end_col_offset=66)], returns=Subscript(value=Name(id='list', ctx=Load(), lineno=722, col_offset=58, end_lineno=722, end_col_offset=62), slice=Name(id='dict', ctx=Load(), lineno=722, col_offset=63, end_lineno=722, end_col_offset=67), ctx=Load(), lineno=722, col_offset=58, end_lineno=722, end_col_offset=68), lineno=722, col_offset=4, end_lineno=762, end_col_offset=66), FunctionDef(name='get_embeddings_by_ids', args=arguments(args=[arg(arg='self', lineno=764, col_offset=30, end_lineno=764, end_col_offset=34), arg(arg='ids', annotation=Subscript(value=Name(id='Sequence', ctx=Load(), lineno=764, col_offset=41, end_lineno=764, end_col_offset=49), slice=Name(id='int', ctx=Load(), lineno=764, col_offset=50, end_lineno=764, end_col_offset=53), ctx=Load(), lineno=764, col_offset=41, end_lineno=764, end_col_offset=54), lineno=764, col_offset=36, end_lineno=764, end_col_offset=54)]), body=[Expr(value=Constant(value="Extract embedding vectors for given chunk IDs.\n\n        Retrieves the pre-computed embedding vectors for chunks, typically used\n        after a FAISS search to get the actual vectors for re-ranking or analysis.\n        The embeddings are stored in Parquet as FixedSizeList arrays and are\n        converted to NumPy arrays for efficient computation.\n\n        The function preserves the order of input IDs in the output array. If\n        an ID is not found, it's silently skipped (the output will have fewer\n        rows than input IDs).\n\n        Parameters\n        ----------\n        ids : Sequence[int]\n            Sequence of chunk IDs to retrieve embeddings for. IDs must exist\n            in the chunks table. Empty sequence returns empty array.\n\n        Returns\n        -------\n        np.ndarray\n            Embedding vectors as a 2D NumPy array of shape (n_found, vec_dim)\n            where n_found <= len(ids). Dtype is float32 for memory efficiency.\n            Returns empty array (shape (0, vec_dim)) if no IDs provided or no\n            matches found. The array is ordered by the input ID sequence.\n\n        ", lineno=765, col_offset=8, end_lineno=790, end_col_offset=11), lineno=765, col_offset=8, end_lineno=790, end_col_offset=11), If(test=UnaryOp(op=Not(), operand=Name(id='ids', ctx=Load(), lineno=791, col_offset=15, end_lineno=791, end_col_offset=18), lineno=791, col_offset=11, end_lineno=791, end_col_offset=18), body=[Assign(targets=[Name(id='dim', ctx=Store(), lineno=792, col_offset=12, end_lineno=792, end_col_offset=15)], value=Call(func=Attribute(value=Name(id='self', ctx=Load(), lineno=792, col_offset=18, end_lineno=792, end_col_offset=22), attr='_embedding_dim', ctx=Load(), lineno=792, col_offset=18, end_lineno=792, end_col_offset=37), lineno=792, col_offset=18, end_lineno=792, end_col_offset=39), lineno=792, col_offset=12, end_lineno=792, end_col_offset=39), Return(value=Call(func=Attribute(value=Name(id='np', ctx=Load(), lineno=793, col_offset=19, end_lineno=793, end_col_offset=21), attr='empty', ctx=Load(), lineno=793, col_offset=19, end_lineno=793, end_col_offset=27), args=[Tuple(elts=[Constant(value=0, lineno=793, col_offset=29, end_lineno=793, end_col_offset=30), Name(id='dim', ctx=Load(), lineno=793, col_offset=32, end_lineno=793, end_col_offset=35)], ctx=Load(), lineno=793, col_offset=28, end_lineno=793, end_col_offset=36)], keywords=[keyword(arg='dtype', value=Attribute(value=Name(id='np', ctx=Load(), lineno=793, col_offset=44, end_lineno=793, end_col_offset=46), attr='float32', ctx=Load(), lineno=793, col_offset=44, end_lineno=793, end_col_offset=54), lineno=793, col_offset=38, end_lineno=793, end_col_offset=54)], lineno=793, col_offset=19, end_lineno=793, end_col_offset=55), lineno=793, col_offset=12, end_lineno=793, end_col_offset=55)], lineno=791, col_offset=8, end_lineno=793, end_col_offset=55), With(items=[withitem(context_expr=Call(func=Attribute(value=Name(id='self', ctx=Load(), lineno=795, col_offset=13, end_lineno=795, end_col_offset=17), attr='connection', ctx=Load(), lineno=795, col_offset=13, end_lineno=795, end_col_offset=28), lineno=795, col_offset=13, end_lineno=795, end_col_offset=30), optional_vars=Name(id='conn', ctx=Store(), lineno=795, col_offset=34, end_lineno=795, end_col_offset=38))], body=[Assign(targets=[Name(id='relation', ctx=Store(), lineno=796, col_offset=12, end_lineno=796, end_col_offset=20)], value=Call(func=Attribute(value=Name(id='conn', ctx=Load(), lineno=796, col_offset=23, end_lineno=796, end_col_offset=27), attr='execute', ctx=Load(), lineno=796, col_offset=23, end_lineno=796, end_col_offset=35), args=[Constant(value='\n                SELECT c.id, c.embedding, ids.position\n                FROM chunks AS c\n                JOIN UNNEST(?) WITH ORDINALITY AS ids(id, position)\n                    ON c.id = ids.id\n                ORDER BY ids.position\n                ', lineno=797, col_offset=16, end_lineno=803, end_col_offset=19), List(elts=[Call(func=Name(id='list', ctx=Load(), lineno=804, col_offset=17, end_lineno=804, end_col_offset=21), args=[Name(id='ids', ctx=Load(), lineno=804, col_offset=22, end_lineno=804, end_col_offset=25)], lineno=804, col_offset=17, end_lineno=804, end_col_offset=26)], ctx=Load(), lineno=804, col_offset=16, end_lineno=804, end_col_offset=27)], lineno=796, col_offset=23, end_lineno=805, end_col_offset=13), lineno=796, col_offset=12, end_lineno=805, end_col_offset=13), Assign(targets=[Name(id='rows', ctx=Store(), lineno=806, col_offset=12, end_lineno=806, end_col_offset=16)], value=Call(func=Attribute(value=Name(id='relation', ctx=Load(), lineno=806, col_offset=19, end_lineno=806, end_col_offset=27), attr='fetchall', ctx=Load(), lineno=806, col_offset=19, end_lineno=806, end_col_offset=36), lineno=806, col_offset=19, end_lineno=806, end_col_offset=38), lineno=806, col_offset=12, end_lineno=806, end_col_offset=38)], lineno=795, col_offset=8, end_lineno=806, end_col_offset=38), Assign(targets=[Name(id='dim', ctx=Store(), lineno=807, col_offset=8, end_lineno=807, end_col_offset=11)], value=Call(func=Attribute(value=Name(id='self', ctx=Load(), lineno=807, col_offset=14, end_lineno=807, end_col_offset=18), attr='_embedding_dim', ctx=Load(), lineno=807, col_offset=14, end_lineno=807, end_col_offset=33), lineno=807, col_offset=14, end_lineno=807, end_col_offset=35), lineno=807, col_offset=8, end_lineno=807, end_col_offset=35), If(test=UnaryOp(op=Not(), operand=Name(id='rows', ctx=Load(), lineno=808, col_offset=15, end_lineno=808, end_col_offset=19), lineno=808, col_offset=11, end_lineno=808, end_col_offset=19), body=[Return(value=Call(func=Attribute(value=Name(id='np', ctx=Load(), lineno=809, col_offset=19, end_lineno=809, end_col_offset=21), attr='empty', ctx=Load(), lineno=809, col_offset=19, end_lineno=809, end_col_offset=27), args=[Tuple(elts=[Constant(value=0, lineno=809, col_offset=29, end_lineno=809, end_col_offset=30), Name(id='dim', ctx=Load(), lineno=809, col_offset=32, end_lineno=809, end_col_offset=35)], ctx=Load(), lineno=809, col_offset=28, end_lineno=809, end_col_offset=36)], keywords=[keyword(arg='dtype', value=Attribute(value=Name(id='np', ctx=Load(), lineno=809, col_offset=44, end_lineno=809, end_col_offset=46), attr='float32', ctx=Load(), lineno=809, col_offset=44, end_lineno=809, end_col_offset=54), lineno=809, col_offset=38, end_lineno=809, end_col_offset=54)], lineno=809, col_offset=19, end_lineno=809, end_col_offset=55), lineno=809, col_offset=12, end_lineno=809, end_col_offset=55)], lineno=808, col_offset=8, end_lineno=809, end_col_offset=55), AnnAssign(target=Name(id='embeddings', ctx=Store(), lineno=811, col_offset=8, end_lineno=811, end_col_offset=18), annotation=Subscript(value=Name(id='list', ctx=Load(), lineno=811, col_offset=20, end_lineno=811, end_col_offset=24), slice=Attribute(value=Name(id='np', ctx=Load(), lineno=811, col_offset=25, end_lineno=811, end_col_offset=27), attr='ndarray', ctx=Load(), lineno=811, col_offset=25, end_lineno=811, end_col_offset=35), ctx=Load(), lineno=811, col_offset=20, end_lineno=811, end_col_offset=36), value=List(ctx=Load(), lineno=811, col_offset=39, end_lineno=811, end_col_offset=41), simple=1, lineno=811, col_offset=8, end_lineno=811, end_col_offset=41), For(target=Tuple(elts=[Name(id='_', ctx=Store(), lineno=812, col_offset=12, end_lineno=812, end_col_offset=13), Name(id='embedding', ctx=Store(), lineno=812, col_offset=15, end_lineno=812, end_col_offset=24), Name(id='_', ctx=Store(), lineno=812, col_offset=26, end_lineno=812, end_col_offset=27)], ctx=Store(), lineno=812, col_offset=12, end_lineno=812, end_col_offset=27), iter=Name(id='rows', ctx=Load(), lineno=812, col_offset=31, end_lineno=812, end_col_offset=35), body=[If(test=Compare(left=Name(id='embedding', ctx=Load(), lineno=813, col_offset=15, end_lineno=813, end_col_offset=24), ops=[Is()], comparators=[Constant(value=None, lineno=813, col_offset=28, end_lineno=813, end_col_offset=32)], lineno=813, col_offset=15, end_lineno=813, end_col_offset=32), body=[Continue(lineno=814, col_offset=16, end_lineno=814, end_col_offset=24)], lineno=813, col_offset=12, end_lineno=814, end_col_offset=24), Assign(targets=[Name(id='array', ctx=Store(), lineno=815, col_offset=12, end_lineno=815, end_col_offset=17)], value=Call(func=Attribute(value=Name(id='np', ctx=Load(), lineno=815, col_offset=20, end_lineno=815, end_col_offset=22), attr='asarray', ctx=Load(), lineno=815, col_offset=20, end_lineno=815, end_col_offset=30), args=[Name(id='embedding', ctx=Load(), lineno=815, col_offset=31, end_lineno=815, end_col_offset=40)], keywords=[keyword(arg='dtype', value=Attribute(value=Name(id='np', ctx=Load(), lineno=815, col_offset=48, end_lineno=815, end_col_offset=50), attr='float32', ctx=Load(), lineno=815, col_offset=48, end_lineno=815, end_col_offset=58), lineno=815, col_offset=42, end_lineno=815, end_col_offset=58)], lineno=815, col_offset=20, end_lineno=815, end_col_offset=59), lineno=815, col_offset=12, end_lineno=815, end_col_offset=59), If(test=Compare(left=Attribute(value=Name(id='array', ctx=Load(), lineno=816, col_offset=15, end_lineno=816, end_col_offset=20), attr='ndim', ctx=Load(), lineno=816, col_offset=15, end_lineno=816, end_col_offset=25), ops=[NotEq()], comparators=[Constant(value=1, lineno=816, col_offset=29, end_lineno=816, end_col_offset=30)], lineno=816, col_offset=15, end_lineno=816, end_col_offset=30), body=[Continue(lineno=817, col_offset=16, end_lineno=817, end_col_offset=24)], lineno=816, col_offset=12, end_lineno=817, end_col_offset=24), Expr(value=Call(func=Attribute(value=Name(id='embeddings', ctx=Load(), lineno=818, col_offset=12, end_lineno=818, end_col_offset=22), attr='append', ctx=Load(), lineno=818, col_offset=12, end_lineno=818, end_col_offset=29), args=[Name(id='array', ctx=Load(), lineno=818, col_offset=30, end_lineno=818, end_col_offset=35)], lineno=818, col_offset=12, end_lineno=818, end_col_offset=36), lineno=818, col_offset=12, end_lineno=818, end_col_offset=36)], lineno=812, col_offset=8, end_lineno=818, end_col_offset=36), If(test=UnaryOp(op=Not(), operand=Name(id='embeddings', ctx=Load(), lineno=820, col_offset=15, end_lineno=820, end_col_offset=25), lineno=820, col_offset=11, end_lineno=820, end_col_offset=25), body=[Return(value=Call(func=Attribute(value=Name(id='np', ctx=Load(), lineno=821, col_offset=19, end_lineno=821, end_col_offset=21), attr='empty', ctx=Load(), lineno=821, col_offset=19, end_lineno=821, end_col_offset=27), args=[Tuple(elts=[Constant(value=0, lineno=821, col_offset=29, end_lineno=821, end_col_offset=30), Name(id='dim', ctx=Load(), lineno=821, col_offset=32, end_lineno=821, end_col_offset=35)], ctx=Load(), lineno=821, col_offset=28, end_lineno=821, end_col_offset=36)], keywords=[keyword(arg='dtype', value=Attribute(value=Name(id='np', ctx=Load(), lineno=821, col_offset=44, end_lineno=821, end_col_offset=46), attr='float32', ctx=Load(), lineno=821, col_offset=44, end_lineno=821, end_col_offset=54), lineno=821, col_offset=38, end_lineno=821, end_col_offset=54)], lineno=821, col_offset=19, end_lineno=821, end_col_offset=55), lineno=821, col_offset=12, end_lineno=821, end_col_offset=55)], lineno=820, col_offset=8, end_lineno=821, end_col_offset=55), Return(value=Call(func=Attribute(value=Name(id='np', ctx=Load(), lineno=823, col_offset=15, end_lineno=823, end_col_offset=17), attr='vstack', ctx=Load(), lineno=823, col_offset=15, end_lineno=823, end_col_offset=24), args=[Name(id='embeddings', ctx=Load(), lineno=823, col_offset=25, end_lineno=823, end_col_offset=35)], lineno=823, col_offset=15, end_lineno=823, end_col_offset=36), lineno=823, col_offset=8, end_lineno=823, end_col_offset=36)], returns=Attribute(value=Name(id='np', ctx=Load(), lineno=764, col_offset=59, end_lineno=764, end_col_offset=61), attr='ndarray', ctx=Load(), lineno=764, col_offset=59, end_lineno=764, end_col_offset=69), lineno=764, col_offset=4, end_lineno=823, end_col_offset=36), FunctionDef(name='count_chunks', args=arguments(args=[arg(arg='self', lineno=825, col_offset=21, end_lineno=825, end_col_offset=25)]), body=[Expr(value=Constant(value="Count total number of chunks in the index.\n\n        Returns the total number of chunks across all files. Useful for monitoring\n        index size and validating that indexing completed successfully.\n\n        The count is computed efficiently using DuckDB's COUNT aggregation over\n        the chunks view, which reads directly from Parquet files.\n\n        Returns\n        -------\n        int\n            Total number of chunks in the index. Returns 0 if the chunks view\n            is empty or no Parquet files exist.\n\n        ", lineno=826, col_offset=8, end_lineno=840, end_col_offset=11), lineno=826, col_offset=8, end_lineno=840, end_col_offset=11), With(items=[withitem(context_expr=Call(func=Attribute(value=Name(id='self', ctx=Load(), lineno=841, col_offset=13, end_lineno=841, end_col_offset=17), attr='connection', ctx=Load(), lineno=841, col_offset=13, end_lineno=841, end_col_offset=28), lineno=841, col_offset=13, end_lineno=841, end_col_offset=30), optional_vars=Name(id='conn', ctx=Store(), lineno=841, col_offset=34, end_lineno=841, end_col_offset=38))], body=[Assign(targets=[Name(id='result', ctx=Store(), lineno=842, col_offset=12, end_lineno=842, end_col_offset=18)], value=Call(func=Attribute(value=Call(func=Attribute(value=Name(id='conn', ctx=Load(), lineno=842, col_offset=21, end_lineno=842, end_col_offset=25), attr='execute', ctx=Load(), lineno=842, col_offset=21, end_lineno=842, end_col_offset=33), args=[Constant(value='SELECT COUNT(*) FROM chunks', lineno=842, col_offset=34, end_lineno=842, end_col_offset=63)], lineno=842, col_offset=21, end_lineno=842, end_col_offset=64), attr='fetchone', ctx=Load(), lineno=842, col_offset=21, end_lineno=842, end_col_offset=73), lineno=842, col_offset=21, end_lineno=842, end_col_offset=75), lineno=842, col_offset=12, end_lineno=842, end_col_offset=75)], lineno=841, col_offset=8, end_lineno=842, end_col_offset=75), Return(value=IfExp(test=Name(id='result', ctx=Load(), lineno=843, col_offset=28, end_lineno=843, end_col_offset=34), body=Subscript(value=Name(id='result', ctx=Load(), lineno=843, col_offset=15, end_lineno=843, end_col_offset=21), slice=Constant(value=0, lineno=843, col_offset=22, end_lineno=843, end_col_offset=23), ctx=Load(), lineno=843, col_offset=15, end_lineno=843, end_col_offset=24), orelse=Constant(value=0, lineno=843, col_offset=40, end_lineno=843, end_col_offset=41), lineno=843, col_offset=15, end_lineno=843, end_col_offset=41), lineno=843, col_offset=8, end_lineno=843, end_col_offset=41)], returns=Name(id='int', ctx=Load(), lineno=825, col_offset=30, end_lineno=825, end_col_offset=33), lineno=825, col_offset=4, end_lineno=843, end_col_offset=41), FunctionDef(name='_embedding_dim', args=arguments(args=[arg(arg='self', lineno=845, col_offset=23, end_lineno=845, end_col_offset=27)]), body=[Expr(value=Constant(value='Return the embedding dimension, caching when possible.\n\n        Returns\n        -------\n        int\n            Embedding dimension for the chunks table, or ``0`` when no rows exist.\n        ', lineno=846, col_offset=8, end_lineno=852, end_col_offset=11), lineno=846, col_offset=8, end_lineno=852, end_col_offset=11), If(test=Compare(left=Attribute(value=Name(id='self', ctx=Load(), lineno=853, col_offset=11, end_lineno=853, end_col_offset=15), attr='_embedding_dim_cache', ctx=Load(), lineno=853, col_offset=11, end_lineno=853, end_col_offset=36), ops=[IsNot()], comparators=[Constant(value=None, lineno=853, col_offset=44, end_lineno=853, end_col_offset=48)], lineno=853, col_offset=11, end_lineno=853, end_col_offset=48), body=[Return(value=Attribute(value=Name(id='self', ctx=Load(), lineno=854, col_offset=19, end_lineno=854, end_col_offset=23), attr='_embedding_dim_cache', ctx=Load(), lineno=854, col_offset=19, end_lineno=854, end_col_offset=44), lineno=854, col_offset=12, end_lineno=854, end_col_offset=44)], lineno=853, col_offset=8, end_lineno=854, end_col_offset=44), With(items=[withitem(context_expr=Call(func=Attribute(value=Name(id='self', ctx=Load(), lineno=855, col_offset=13, end_lineno=855, end_col_offset=17), attr='connection', ctx=Load(), lineno=855, col_offset=13, end_lineno=855, end_col_offset=28), lineno=855, col_offset=13, end_lineno=855, end_col_offset=30), optional_vars=Name(id='conn', ctx=Store(), lineno=855, col_offset=34, end_lineno=855, end_col_offset=38))], body=[Assign(targets=[Name(id='result', ctx=Store(), lineno=856, col_offset=12, end_lineno=856, end_col_offset=18)], value=Call(func=Attribute(value=Call(func=Attribute(value=Name(id='conn', ctx=Load(), lineno=856, col_offset=21, end_lineno=856, end_col_offset=25), attr='execute', ctx=Load(), lineno=856, col_offset=21, end_lineno=856, end_col_offset=33), args=[Constant(value='SELECT embedding FROM chunks LIMIT 1', lineno=856, col_offset=34, end_lineno=856, end_col_offset=72)], lineno=856, col_offset=21, end_lineno=856, end_col_offset=73), attr='fetchone', ctx=Load(), lineno=856, col_offset=21, end_lineno=856, end_col_offset=82), lineno=856, col_offset=21, end_lineno=856, end_col_offset=84), lineno=856, col_offset=12, end_lineno=856, end_col_offset=84)], lineno=855, col_offset=8, end_lineno=856, end_col_offset=84), If(test=BoolOp(op=And(), values=[Name(id='result', ctx=Load(), lineno=857, col_offset=11, end_lineno=857, end_col_offset=17), Compare(left=Subscript(value=Name(id='result', ctx=Load(), lineno=857, col_offset=22, end_lineno=857, end_col_offset=28), slice=Constant(value=0, lineno=857, col_offset=29, end_lineno=857, end_col_offset=30), ctx=Load(), lineno=857, col_offset=22, end_lineno=857, end_col_offset=31), ops=[IsNot()], comparators=[Constant(value=None, lineno=857, col_offset=39, end_lineno=857, end_col_offset=43)], lineno=857, col_offset=22, end_lineno=857, end_col_offset=43)], lineno=857, col_offset=11, end_lineno=857, end_col_offset=43), body=[Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=858, col_offset=12, end_lineno=858, end_col_offset=16), attr='_embedding_dim_cache', ctx=Store(), lineno=858, col_offset=12, end_lineno=858, end_col_offset=37)], value=Call(func=Name(id='len', ctx=Load(), lineno=858, col_offset=40, end_lineno=858, end_col_offset=43), args=[Subscript(value=Name(id='result', ctx=Load(), lineno=858, col_offset=44, end_lineno=858, end_col_offset=50), slice=Constant(value=0, lineno=858, col_offset=51, end_lineno=858, end_col_offset=52), ctx=Load(), lineno=858, col_offset=44, end_lineno=858, end_col_offset=53)], lineno=858, col_offset=40, end_lineno=858, end_col_offset=54), lineno=858, col_offset=12, end_lineno=858, end_col_offset=54)], orelse=[Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=860, col_offset=12, end_lineno=860, end_col_offset=16), attr='_embedding_dim_cache', ctx=Store(), lineno=860, col_offset=12, end_lineno=860, end_col_offset=37)], value=Constant(value=0, lineno=860, col_offset=40, end_lineno=860, end_col_offset=41), lineno=860, col_offset=12, end_lineno=860, end_col_offset=41)], lineno=857, col_offset=8, end_lineno=860, end_col_offset=41), Return(value=Attribute(value=Name(id='self', ctx=Load(), lineno=861, col_offset=15, end_lineno=861, end_col_offset=19), attr='_embedding_dim_cache', ctx=Load(), lineno=861, col_offset=15, end_lineno=861, end_col_offset=40), lineno=861, col_offset=8, end_lineno=861, end_col_offset=40)], returns=Name(id='int', ctx=Load(), lineno=845, col_offset=32, end_lineno=845, end_col_offset=35), lineno=845, col_offset=4, end_lineno=861, end_col_offset=40)], lineno=74, col_offset=0, end_lineno=861, end_col_offset=40), Assign(targets=[Name(id='__all__', ctx=Store(), lineno=864, col_offset=0, end_lineno=864, end_col_offset=7)], value=List(elts=[Constant(value='DuckDBCatalog', lineno=864, col_offset=11, end_lineno=864, end_col_offset=26)], ctx=Load(), lineno=864, col_offset=10, end_lineno=864, end_col_offset=27), lineno=864, col_offset=0, end_lineno=864, end_col_offset=27)])