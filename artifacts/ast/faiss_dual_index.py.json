Module(body=[Expr(value=Constant(value='FAISS dual-index utilities and metadata helpers.', lineno=1, col_offset=0, end_lineno=1, end_col_offset=54), lineno=1, col_offset=0, end_lineno=1, end_col_offset=54), ImportFrom(module='__future__', names=[alias(name='annotations', lineno=3, col_offset=23, end_lineno=3, end_col_offset=34)], level=0, lineno=3, col_offset=0, end_lineno=3, end_col_offset=34), Import(names=[alias(name='asyncio', lineno=5, col_offset=7, end_lineno=5, end_col_offset=14)], lineno=5, col_offset=0, end_lineno=5, end_col_offset=14), Import(names=[alias(name='importlib', lineno=6, col_offset=7, end_lineno=6, end_col_offset=16)], lineno=6, col_offset=0, end_lineno=6, end_col_offset=16), Import(names=[alias(name='json', lineno=7, col_offset=7, end_lineno=7, end_col_offset=11)], lineno=7, col_offset=0, end_lineno=7, end_col_offset=11), ImportFrom(module='dataclasses', names=[alias(name='asdict', lineno=8, col_offset=24, end_lineno=8, end_col_offset=30), alias(name='dataclass', lineno=8, col_offset=32, end_lineno=8, end_col_offset=41)], level=0, lineno=8, col_offset=0, end_lineno=8, end_col_offset=41), ImportFrom(module='pathlib', names=[alias(name='Path', lineno=9, col_offset=20, end_lineno=9, end_col_offset=24)], level=0, lineno=9, col_offset=0, end_lineno=9, end_col_offset=24), ImportFrom(module='types', names=[alias(name='ModuleType', lineno=10, col_offset=18, end_lineno=10, end_col_offset=28)], level=0, lineno=10, col_offset=0, end_lineno=10, end_col_offset=28), ImportFrom(module='typing', names=[alias(name='TYPE_CHECKING', lineno=11, col_offset=19, end_lineno=11, end_col_offset=32)], level=0, lineno=11, col_offset=0, end_lineno=11, end_col_offset=32), Import(names=[alias(name='numpy', asname='np', lineno=13, col_offset=7, end_lineno=13, end_col_offset=18)], lineno=13, col_offset=0, end_lineno=13, end_col_offset=18), ImportFrom(module='kgfoundry_common.logging', names=[alias(name='get_logger', lineno=15, col_offset=37, end_lineno=15, end_col_offset=47)], level=0, lineno=15, col_offset=0, end_lineno=15, end_col_offset=47), If(test=Name(id='TYPE_CHECKING', ctx=Load(), lineno=17, col_offset=3, end_lineno=17, end_col_offset=16), body=[Import(names=[alias(name='faiss', lineno=18, col_offset=11, end_lineno=18, end_col_offset=16)], lineno=18, col_offset=4, end_lineno=18, end_col_offset=16), ImportFrom(module='codeintel_rev.config.settings', names=[alias(name='IndexConfig', lineno=20, col_offset=46, end_lineno=20, end_col_offset=57)], level=0, lineno=20, col_offset=4, end_lineno=20, end_col_offset=57)], lineno=17, col_offset=0, end_lineno=20, end_col_offset=57), Assign(targets=[Name(id='LOGGER', ctx=Store(), lineno=22, col_offset=0, end_lineno=22, end_col_offset=6)], value=Call(func=Name(id='get_logger', ctx=Load(), lineno=22, col_offset=9, end_lineno=22, end_col_offset=19), args=[Name(id='__name__', ctx=Load(), lineno=22, col_offset=20, end_lineno=22, end_col_offset=28)], lineno=22, col_offset=9, end_lineno=22, end_col_offset=29), lineno=22, col_offset=0, end_lineno=22, end_col_offset=29), Assign(targets=[Name(id='__all__', ctx=Store(), lineno=24, col_offset=0, end_lineno=24, end_col_offset=7)], value=List(elts=[Constant(value='FAISSDualIndexManager', lineno=24, col_offset=11, end_lineno=24, end_col_offset=34), Constant(value='IndexManifest', lineno=24, col_offset=36, end_lineno=24, end_col_offset=51)], ctx=Load(), lineno=24, col_offset=10, end_lineno=24, end_col_offset=52), lineno=24, col_offset=0, end_lineno=24, end_col_offset=52), ClassDef(name='IndexManifest', body=[Expr(value=Constant(value='Persisted metadata for FAISS dual-index deployments.', lineno=29, col_offset=4, end_lineno=29, end_col_offset=62), lineno=29, col_offset=4, end_lineno=29, end_col_offset=62), AnnAssign(target=Name(id='version', ctx=Store(), lineno=31, col_offset=4, end_lineno=31, end_col_offset=11), annotation=Name(id='str', ctx=Load(), lineno=31, col_offset=13, end_lineno=31, end_col_offset=16), simple=1, lineno=31, col_offset=4, end_lineno=31, end_col_offset=16), AnnAssign(target=Name(id='vec_dim', ctx=Store(), lineno=32, col_offset=4, end_lineno=32, end_col_offset=11), annotation=Name(id='int', ctx=Load(), lineno=32, col_offset=13, end_lineno=32, end_col_offset=16), simple=1, lineno=32, col_offset=4, end_lineno=32, end_col_offset=16), AnnAssign(target=Name(id='index_type', ctx=Store(), lineno=33, col_offset=4, end_lineno=33, end_col_offset=14), annotation=Name(id='str', ctx=Load(), lineno=33, col_offset=16, end_lineno=33, end_col_offset=19), simple=1, lineno=33, col_offset=4, end_lineno=33, end_col_offset=19), AnnAssign(target=Name(id='metric', ctx=Store(), lineno=34, col_offset=4, end_lineno=34, end_col_offset=10), annotation=Name(id='str', ctx=Load(), lineno=34, col_offset=12, end_lineno=34, end_col_offset=15), simple=1, lineno=34, col_offset=4, end_lineno=34, end_col_offset=15), AnnAssign(target=Name(id='trained_on', ctx=Store(), lineno=35, col_offset=4, end_lineno=35, end_col_offset=14), annotation=Name(id='str', ctx=Load(), lineno=35, col_offset=16, end_lineno=35, end_col_offset=19), simple=1, lineno=35, col_offset=4, end_lineno=35, end_col_offset=19), AnnAssign(target=Name(id='built_at', ctx=Store(), lineno=36, col_offset=4, end_lineno=36, end_col_offset=12), annotation=Name(id='str', ctx=Load(), lineno=36, col_offset=14, end_lineno=36, end_col_offset=17), simple=1, lineno=36, col_offset=4, end_lineno=36, end_col_offset=17), AnnAssign(target=Name(id='gpu_enabled', ctx=Store(), lineno=37, col_offset=4, end_lineno=37, end_col_offset=15), annotation=Name(id='bool', ctx=Load(), lineno=37, col_offset=17, end_lineno=37, end_col_offset=21), simple=1, lineno=37, col_offset=4, end_lineno=37, end_col_offset=21), AnnAssign(target=Name(id='primary_count', ctx=Store(), lineno=38, col_offset=4, end_lineno=38, end_col_offset=17), annotation=Name(id='int', ctx=Load(), lineno=38, col_offset=19, end_lineno=38, end_col_offset=22), simple=1, lineno=38, col_offset=4, end_lineno=38, end_col_offset=22), AnnAssign(target=Name(id='secondary_count', ctx=Store(), lineno=39, col_offset=4, end_lineno=39, end_col_offset=19), annotation=Name(id='int', ctx=Load(), lineno=39, col_offset=21, end_lineno=39, end_col_offset=24), simple=1, lineno=39, col_offset=4, end_lineno=39, end_col_offset=24), AnnAssign(target=Name(id='nlist', ctx=Store(), lineno=40, col_offset=4, end_lineno=40, end_col_offset=9), annotation=BinOp(left=Name(id='int', ctx=Load(), lineno=40, col_offset=11, end_lineno=40, end_col_offset=14), op=BitOr(), right=Constant(value=None, lineno=40, col_offset=17, end_lineno=40, end_col_offset=21), lineno=40, col_offset=11, end_lineno=40, end_col_offset=21), value=Constant(value=None, lineno=40, col_offset=24, end_lineno=40, end_col_offset=28), simple=1, lineno=40, col_offset=4, end_lineno=40, end_col_offset=28), AnnAssign(target=Name(id='pq_m', ctx=Store(), lineno=41, col_offset=4, end_lineno=41, end_col_offset=8), annotation=BinOp(left=Name(id='int', ctx=Load(), lineno=41, col_offset=10, end_lineno=41, end_col_offset=13), op=BitOr(), right=Constant(value=None, lineno=41, col_offset=16, end_lineno=41, end_col_offset=20), lineno=41, col_offset=10, end_lineno=41, end_col_offset=20), value=Constant(value=None, lineno=41, col_offset=23, end_lineno=41, end_col_offset=27), simple=1, lineno=41, col_offset=4, end_lineno=41, end_col_offset=27), AnnAssign(target=Name(id='cuvs_version', ctx=Store(), lineno=42, col_offset=4, end_lineno=42, end_col_offset=16), annotation=BinOp(left=Name(id='str', ctx=Load(), lineno=42, col_offset=18, end_lineno=42, end_col_offset=21), op=BitOr(), right=Constant(value=None, lineno=42, col_offset=24, end_lineno=42, end_col_offset=28), lineno=42, col_offset=18, end_lineno=42, end_col_offset=28), value=Constant(value=None, lineno=42, col_offset=31, end_lineno=42, end_col_offset=35), simple=1, lineno=42, col_offset=4, end_lineno=42, end_col_offset=35), FunctionDef(name='from_file', args=arguments(args=[arg(arg='cls', lineno=45, col_offset=18, end_lineno=45, end_col_offset=21), arg(arg='path', annotation=Name(id='Path', ctx=Load(), lineno=45, col_offset=29, end_lineno=45, end_col_offset=33), lineno=45, col_offset=23, end_lineno=45, end_col_offset=33)]), body=[Expr(value=Constant(value='Load manifest metadata from a JSON document.\n\n        Parameters\n        ----------\n        path : Path\n            Filesystem path to the manifest JSON file.\n\n        Returns\n        -------\n        IndexManifest\n            Parsed manifest instance populated with the JSON payload.\n\n        Raises\n        ------\n        TypeError\n            If the JSON payload is not a mapping object.\n        ValueError\n            If required fields are missing or have incompatible types.\n        ', lineno=46, col_offset=8, end_lineno=64, end_col_offset=11), lineno=46, col_offset=8, end_lineno=64, end_col_offset=11), With(items=[withitem(context_expr=Call(func=Attribute(value=Name(id='path', ctx=Load(), lineno=65, col_offset=13, end_lineno=65, end_col_offset=17), attr='open', ctx=Load(), lineno=65, col_offset=13, end_lineno=65, end_col_offset=22), args=[Constant(value='r', lineno=65, col_offset=23, end_lineno=65, end_col_offset=26)], keywords=[keyword(arg='encoding', value=Constant(value='utf-8', lineno=65, col_offset=37, end_lineno=65, end_col_offset=44), lineno=65, col_offset=28, end_lineno=65, end_col_offset=44)], lineno=65, col_offset=13, end_lineno=65, end_col_offset=45), optional_vars=Name(id='handle', ctx=Store(), lineno=65, col_offset=49, end_lineno=65, end_col_offset=55))], body=[Assign(targets=[Name(id='payload', ctx=Store(), lineno=66, col_offset=12, end_lineno=66, end_col_offset=19)], value=Call(func=Attribute(value=Name(id='json', ctx=Load(), lineno=66, col_offset=22, end_lineno=66, end_col_offset=26), attr='load', ctx=Load(), lineno=66, col_offset=22, end_lineno=66, end_col_offset=31), args=[Name(id='handle', ctx=Load(), lineno=66, col_offset=32, end_lineno=66, end_col_offset=38)], lineno=66, col_offset=22, end_lineno=66, end_col_offset=39), lineno=66, col_offset=12, end_lineno=66, end_col_offset=39)], lineno=65, col_offset=8, end_lineno=66, end_col_offset=39), If(test=UnaryOp(op=Not(), operand=Call(func=Name(id='isinstance', ctx=Load(), lineno=68, col_offset=15, end_lineno=68, end_col_offset=25), args=[Name(id='payload', ctx=Load(), lineno=68, col_offset=26, end_lineno=68, end_col_offset=33), Name(id='dict', ctx=Load(), lineno=68, col_offset=35, end_lineno=68, end_col_offset=39)], lineno=68, col_offset=15, end_lineno=68, end_col_offset=40), lineno=68, col_offset=11, end_lineno=68, end_col_offset=40), body=[Assign(targets=[Name(id='msg', ctx=Store(), lineno=69, col_offset=12, end_lineno=69, end_col_offset=15)], value=Constant(value='Manifest JSON must be an object', lineno=69, col_offset=18, end_lineno=69, end_col_offset=51), lineno=69, col_offset=12, end_lineno=69, end_col_offset=51), Raise(exc=Call(func=Name(id='TypeError', ctx=Load(), lineno=70, col_offset=18, end_lineno=70, end_col_offset=27), args=[Name(id='msg', ctx=Load(), lineno=70, col_offset=28, end_lineno=70, end_col_offset=31)], lineno=70, col_offset=18, end_lineno=70, end_col_offset=32), lineno=70, col_offset=12, end_lineno=70, end_col_offset=32)], lineno=68, col_offset=8, end_lineno=70, end_col_offset=32), Try(body=[Return(value=Call(func=Name(id='cls', ctx=Load(), lineno=73, col_offset=19, end_lineno=73, end_col_offset=22), keywords=[keyword(value=Name(id='payload', ctx=Load(), lineno=73, col_offset=25, end_lineno=73, end_col_offset=32), lineno=73, col_offset=23, end_lineno=73, end_col_offset=32)], lineno=73, col_offset=19, end_lineno=73, end_col_offset=33), lineno=73, col_offset=12, end_lineno=73, end_col_offset=33)], handlers=[ExceptHandler(type=Name(id='TypeError', ctx=Load(), lineno=74, col_offset=15, end_lineno=74, end_col_offset=24), name='exc', body=[Assign(targets=[Name(id='msg', ctx=Store(), lineno=75, col_offset=12, end_lineno=75, end_col_offset=15)], value=JoinedStr(values=[Constant(value='Manifest file has unexpected structure: ', lineno=75, col_offset=20, end_lineno=75, end_col_offset=60), FormattedValue(value=Name(id='exc', ctx=Load(), lineno=75, col_offset=61, end_lineno=75, end_col_offset=64), conversion=-1, lineno=75, col_offset=60, end_lineno=75, end_col_offset=65)], lineno=75, col_offset=18, end_lineno=75, end_col_offset=66), lineno=75, col_offset=12, end_lineno=75, end_col_offset=66), Raise(exc=Call(func=Name(id='ValueError', ctx=Load(), lineno=76, col_offset=18, end_lineno=76, end_col_offset=28), args=[Name(id='msg', ctx=Load(), lineno=76, col_offset=29, end_lineno=76, end_col_offset=32)], lineno=76, col_offset=18, end_lineno=76, end_col_offset=33), cause=Name(id='exc', ctx=Load(), lineno=76, col_offset=39, end_lineno=76, end_col_offset=42), lineno=76, col_offset=12, end_lineno=76, end_col_offset=42)], lineno=74, col_offset=8, end_lineno=76, end_col_offset=42)], lineno=72, col_offset=8, end_lineno=76, end_col_offset=42)], decorator_list=[Name(id='classmethod', ctx=Load(), lineno=44, col_offset=5, end_lineno=44, end_col_offset=16)], returns=Name(id='IndexManifest', ctx=Load(), lineno=45, col_offset=38, end_lineno=45, end_col_offset=51), lineno=45, col_offset=4, end_lineno=76, end_col_offset=42), FunctionDef(name='to_file', args=arguments(args=[arg(arg='self', lineno=78, col_offset=16, end_lineno=78, end_col_offset=20), arg(arg='path', annotation=Name(id='Path', ctx=Load(), lineno=78, col_offset=28, end_lineno=78, end_col_offset=32), lineno=78, col_offset=22, end_lineno=78, end_col_offset=32)]), body=[Expr(value=Constant(value='Serialize the manifest to ``path`` as formatted JSON.', lineno=79, col_offset=8, end_lineno=79, end_col_offset=67), lineno=79, col_offset=8, end_lineno=79, end_col_offset=67), With(items=[withitem(context_expr=Call(func=Attribute(value=Name(id='path', ctx=Load(), lineno=80, col_offset=13, end_lineno=80, end_col_offset=17), attr='open', ctx=Load(), lineno=80, col_offset=13, end_lineno=80, end_col_offset=22), args=[Constant(value='w', lineno=80, col_offset=23, end_lineno=80, end_col_offset=26)], keywords=[keyword(arg='encoding', value=Constant(value='utf-8', lineno=80, col_offset=37, end_lineno=80, end_col_offset=44), lineno=80, col_offset=28, end_lineno=80, end_col_offset=44)], lineno=80, col_offset=13, end_lineno=80, end_col_offset=45), optional_vars=Name(id='handle', ctx=Store(), lineno=80, col_offset=49, end_lineno=80, end_col_offset=55))], body=[Expr(value=Call(func=Attribute(value=Name(id='json', ctx=Load(), lineno=81, col_offset=12, end_lineno=81, end_col_offset=16), attr='dump', ctx=Load(), lineno=81, col_offset=12, end_lineno=81, end_col_offset=21), args=[Call(func=Name(id='asdict', ctx=Load(), lineno=81, col_offset=22, end_lineno=81, end_col_offset=28), args=[Name(id='self', ctx=Load(), lineno=81, col_offset=29, end_lineno=81, end_col_offset=33)], lineno=81, col_offset=22, end_lineno=81, end_col_offset=34), Name(id='handle', ctx=Load(), lineno=81, col_offset=36, end_lineno=81, end_col_offset=42)], keywords=[keyword(arg='indent', value=Constant(value=2, lineno=81, col_offset=51, end_lineno=81, end_col_offset=52), lineno=81, col_offset=44, end_lineno=81, end_col_offset=52), keyword(arg='sort_keys', value=Constant(value=True, lineno=81, col_offset=64, end_lineno=81, end_col_offset=68), lineno=81, col_offset=54, end_lineno=81, end_col_offset=68)], lineno=81, col_offset=12, end_lineno=81, end_col_offset=69), lineno=81, col_offset=12, end_lineno=81, end_col_offset=69), Expr(value=Call(func=Attribute(value=Name(id='handle', ctx=Load(), lineno=82, col_offset=12, end_lineno=82, end_col_offset=18), attr='write', ctx=Load(), lineno=82, col_offset=12, end_lineno=82, end_col_offset=24), args=[Constant(value='\n', lineno=82, col_offset=25, end_lineno=82, end_col_offset=29)], lineno=82, col_offset=12, end_lineno=82, end_col_offset=30), lineno=82, col_offset=12, end_lineno=82, end_col_offset=30)], lineno=80, col_offset=8, end_lineno=82, end_col_offset=30)], returns=Constant(value=None, lineno=78, col_offset=37, end_lineno=78, end_col_offset=41), lineno=78, col_offset=4, end_lineno=82, end_col_offset=30)], decorator_list=[Call(func=Name(id='dataclass', ctx=Load(), lineno=27, col_offset=1, end_lineno=27, end_col_offset=10), keywords=[keyword(arg='slots', value=Constant(value=True, lineno=27, col_offset=17, end_lineno=27, end_col_offset=21), lineno=27, col_offset=11, end_lineno=27, end_col_offset=21), keyword(arg='frozen', value=Constant(value=True, lineno=27, col_offset=30, end_lineno=27, end_col_offset=34), lineno=27, col_offset=23, end_lineno=27, end_col_offset=34)], lineno=27, col_offset=1, end_lineno=27, end_col_offset=35)], lineno=28, col_offset=0, end_lineno=82, end_col_offset=30), ClassDef(name='FAISSDualIndexManager', body=[Expr(value=Constant(value='Manage dual FAISS indexes with CPU/GPU coordination.', lineno=86, col_offset=4, end_lineno=86, end_col_offset=62), lineno=86, col_offset=4, end_lineno=86, end_col_offset=62), FunctionDef(name='__init__', args=arguments(args=[arg(arg='self', lineno=88, col_offset=17, end_lineno=88, end_col_offset=21), arg(arg='index_dir', annotation=Name(id='Path', ctx=Load(), lineno=88, col_offset=34, end_lineno=88, end_col_offset=38), lineno=88, col_offset=23, end_lineno=88, end_col_offset=38), arg(arg='settings', annotation=Name(id='IndexConfig', ctx=Load(), lineno=88, col_offset=50, end_lineno=88, end_col_offset=61), lineno=88, col_offset=40, end_lineno=88, end_col_offset=61), arg(arg='vec_dim', annotation=Name(id='int', ctx=Load(), lineno=88, col_offset=72, end_lineno=88, end_col_offset=75), lineno=88, col_offset=63, end_lineno=88, end_col_offset=75)]), body=[Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=89, col_offset=8, end_lineno=89, end_col_offset=12), attr='_index_dir', ctx=Store(), lineno=89, col_offset=8, end_lineno=89, end_col_offset=23)], value=Name(id='index_dir', ctx=Load(), lineno=89, col_offset=26, end_lineno=89, end_col_offset=35), lineno=89, col_offset=8, end_lineno=89, end_col_offset=35), Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=90, col_offset=8, end_lineno=90, end_col_offset=12), attr='_settings', ctx=Store(), lineno=90, col_offset=8, end_lineno=90, end_col_offset=22)], value=Name(id='settings', ctx=Load(), lineno=90, col_offset=25, end_lineno=90, end_col_offset=33), lineno=90, col_offset=8, end_lineno=90, end_col_offset=33), Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=91, col_offset=8, end_lineno=91, end_col_offset=12), attr='_vec_dim', ctx=Store(), lineno=91, col_offset=8, end_lineno=91, end_col_offset=21)], value=Name(id='vec_dim', ctx=Load(), lineno=91, col_offset=24, end_lineno=91, end_col_offset=31), lineno=91, col_offset=8, end_lineno=91, end_col_offset=31), AnnAssign(target=Attribute(value=Name(id='self', ctx=Load(), lineno=93, col_offset=8, end_lineno=93, end_col_offset=12), attr='_primary_cpu', ctx=Store(), lineno=93, col_offset=8, end_lineno=93, end_col_offset=25), annotation=BinOp(left=Attribute(value=Name(id='faiss', ctx=Load(), lineno=93, col_offset=27, end_lineno=93, end_col_offset=32), attr='Index', ctx=Load(), lineno=93, col_offset=27, end_lineno=93, end_col_offset=38), op=BitOr(), right=Constant(value=None, lineno=93, col_offset=41, end_lineno=93, end_col_offset=45), lineno=93, col_offset=27, end_lineno=93, end_col_offset=45), value=Constant(value=None, lineno=93, col_offset=48, end_lineno=93, end_col_offset=52), simple=0, lineno=93, col_offset=8, end_lineno=93, end_col_offset=52), AnnAssign(target=Attribute(value=Name(id='self', ctx=Load(), lineno=94, col_offset=8, end_lineno=94, end_col_offset=12), attr='_primary_gpu', ctx=Store(), lineno=94, col_offset=8, end_lineno=94, end_col_offset=25), annotation=BinOp(left=Attribute(value=Name(id='faiss', ctx=Load(), lineno=94, col_offset=27, end_lineno=94, end_col_offset=32), attr='Index', ctx=Load(), lineno=94, col_offset=27, end_lineno=94, end_col_offset=38), op=BitOr(), right=Constant(value=None, lineno=94, col_offset=41, end_lineno=94, end_col_offset=45), lineno=94, col_offset=27, end_lineno=94, end_col_offset=45), value=Constant(value=None, lineno=94, col_offset=48, end_lineno=94, end_col_offset=52), simple=0, lineno=94, col_offset=8, end_lineno=94, end_col_offset=52), AnnAssign(target=Attribute(value=Name(id='self', ctx=Load(), lineno=95, col_offset=8, end_lineno=95, end_col_offset=12), attr='_secondary_cpu', ctx=Store(), lineno=95, col_offset=8, end_lineno=95, end_col_offset=27), annotation=BinOp(left=Attribute(value=Name(id='faiss', ctx=Load(), lineno=95, col_offset=29, end_lineno=95, end_col_offset=34), attr='Index', ctx=Load(), lineno=95, col_offset=29, end_lineno=95, end_col_offset=40), op=BitOr(), right=Constant(value=None, lineno=95, col_offset=43, end_lineno=95, end_col_offset=47), lineno=95, col_offset=29, end_lineno=95, end_col_offset=47), value=Constant(value=None, lineno=95, col_offset=50, end_lineno=95, end_col_offset=54), simple=0, lineno=95, col_offset=8, end_lineno=95, end_col_offset=54), AnnAssign(target=Attribute(value=Name(id='self', ctx=Load(), lineno=96, col_offset=8, end_lineno=96, end_col_offset=12), attr='_secondary_gpu', ctx=Store(), lineno=96, col_offset=8, end_lineno=96, end_col_offset=27), annotation=BinOp(left=Attribute(value=Name(id='faiss', ctx=Load(), lineno=96, col_offset=29, end_lineno=96, end_col_offset=34), attr='Index', ctx=Load(), lineno=96, col_offset=29, end_lineno=96, end_col_offset=40), op=BitOr(), right=Constant(value=None, lineno=96, col_offset=43, end_lineno=96, end_col_offset=47), lineno=96, col_offset=29, end_lineno=96, end_col_offset=47), value=Constant(value=None, lineno=96, col_offset=50, end_lineno=96, end_col_offset=54), simple=0, lineno=96, col_offset=8, end_lineno=96, end_col_offset=54), AnnAssign(target=Attribute(value=Name(id='self', ctx=Load(), lineno=97, col_offset=8, end_lineno=97, end_col_offset=12), attr='_manifest', ctx=Store(), lineno=97, col_offset=8, end_lineno=97, end_col_offset=22), annotation=BinOp(left=Name(id='IndexManifest', ctx=Load(), lineno=97, col_offset=24, end_lineno=97, end_col_offset=37), op=BitOr(), right=Constant(value=None, lineno=97, col_offset=40, end_lineno=97, end_col_offset=44), lineno=97, col_offset=24, end_lineno=97, end_col_offset=44), value=Constant(value=None, lineno=97, col_offset=47, end_lineno=97, end_col_offset=51), simple=0, lineno=97, col_offset=8, end_lineno=97, end_col_offset=51), AnnAssign(target=Attribute(value=Name(id='self', ctx=Load(), lineno=98, col_offset=8, end_lineno=98, end_col_offset=12), attr='_faiss_module', ctx=Store(), lineno=98, col_offset=8, end_lineno=98, end_col_offset=26), annotation=BinOp(left=Name(id='ModuleType', ctx=Load(), lineno=98, col_offset=28, end_lineno=98, end_col_offset=38), op=BitOr(), right=Constant(value=None, lineno=98, col_offset=41, end_lineno=98, end_col_offset=45), lineno=98, col_offset=28, end_lineno=98, end_col_offset=45), value=Constant(value=None, lineno=98, col_offset=48, end_lineno=98, end_col_offset=52), simple=0, lineno=98, col_offset=8, end_lineno=98, end_col_offset=52), AnnAssign(target=Attribute(value=Name(id='self', ctx=Load(), lineno=100, col_offset=8, end_lineno=100, end_col_offset=12), attr='_gpu_resources', ctx=Store(), lineno=100, col_offset=8, end_lineno=100, end_col_offset=27), annotation=BinOp(left=Attribute(value=Name(id='faiss', ctx=Load(), lineno=100, col_offset=29, end_lineno=100, end_col_offset=34), attr='StandardGpuResources', ctx=Load(), lineno=100, col_offset=29, end_lineno=100, end_col_offset=55), op=BitOr(), right=Constant(value=None, lineno=100, col_offset=58, end_lineno=100, end_col_offset=62), lineno=100, col_offset=29, end_lineno=100, end_col_offset=62), value=Constant(value=None, lineno=100, col_offset=65, end_lineno=100, end_col_offset=69), simple=0, lineno=100, col_offset=8, end_lineno=100, end_col_offset=69), AnnAssign(target=Attribute(value=Name(id='self', ctx=Load(), lineno=101, col_offset=8, end_lineno=101, end_col_offset=12), attr='_gpu_enabled', ctx=Store(), lineno=101, col_offset=8, end_lineno=101, end_col_offset=25), annotation=Name(id='bool', ctx=Load(), lineno=101, col_offset=27, end_lineno=101, end_col_offset=31), value=Constant(value=False, lineno=101, col_offset=34, end_lineno=101, end_col_offset=39), simple=0, lineno=101, col_offset=8, end_lineno=101, end_col_offset=39), AnnAssign(target=Attribute(value=Name(id='self', ctx=Load(), lineno=102, col_offset=8, end_lineno=102, end_col_offset=12), attr='_gpu_disabled_reason', ctx=Store(), lineno=102, col_offset=8, end_lineno=102, end_col_offset=33), annotation=BinOp(left=Name(id='str', ctx=Load(), lineno=102, col_offset=35, end_lineno=102, end_col_offset=38), op=BitOr(), right=Constant(value=None, lineno=102, col_offset=41, end_lineno=102, end_col_offset=45), lineno=102, col_offset=35, end_lineno=102, end_col_offset=45), value=Constant(value=None, lineno=102, col_offset=48, end_lineno=102, end_col_offset=52), simple=0, lineno=102, col_offset=8, end_lineno=102, end_col_offset=52)], returns=Constant(value=None, lineno=88, col_offset=80, end_lineno=88, end_col_offset=84), lineno=88, col_offset=4, end_lineno=102, end_col_offset=52), FunctionDef(name='set_test_indexes', args=arguments(args=[arg(arg='self', lineno=104, col_offset=25, end_lineno=104, end_col_offset=29), arg(arg='primary', annotation=BinOp(left=Attribute(value=Name(id='faiss', ctx=Load(), lineno=104, col_offset=40, end_lineno=104, end_col_offset=45), attr='Index', ctx=Load(), lineno=104, col_offset=40, end_lineno=104, end_col_offset=51), op=BitOr(), right=Constant(value=None, lineno=104, col_offset=54, end_lineno=104, end_col_offset=58), lineno=104, col_offset=40, end_lineno=104, end_col_offset=58), lineno=104, col_offset=31, end_lineno=104, end_col_offset=58), arg(arg='secondary', annotation=BinOp(left=Attribute(value=Name(id='faiss', ctx=Load(), lineno=104, col_offset=71, end_lineno=104, end_col_offset=76), attr='Index', ctx=Load(), lineno=104, col_offset=71, end_lineno=104, end_col_offset=82), op=BitOr(), right=Constant(value=None, lineno=104, col_offset=85, end_lineno=104, end_col_offset=89), lineno=104, col_offset=71, end_lineno=104, end_col_offset=89), lineno=104, col_offset=60, end_lineno=104, end_col_offset=89)]), body=[Expr(value=Constant(value='Set CPU indexes for testing purposes.\n\n        This method allows tests to inject CPU indexes directly, bypassing\n        the normal loading mechanism. It is public for testing purposes only.\n\n        Parameters\n        ----------\n        primary : faiss.Index | None\n            Primary CPU index to set.\n        secondary : faiss.Index | None\n            Secondary CPU index to set.\n        ', lineno=105, col_offset=8, end_lineno=116, end_col_offset=11), lineno=105, col_offset=8, end_lineno=116, end_col_offset=11), Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=117, col_offset=8, end_lineno=117, end_col_offset=12), attr='_primary_cpu', ctx=Store(), lineno=117, col_offset=8, end_lineno=117, end_col_offset=25)], value=Name(id='primary', ctx=Load(), lineno=117, col_offset=28, end_lineno=117, end_col_offset=35), lineno=117, col_offset=8, end_lineno=117, end_col_offset=35), Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=118, col_offset=8, end_lineno=118, end_col_offset=12), attr='_secondary_cpu', ctx=Store(), lineno=118, col_offset=8, end_lineno=118, end_col_offset=27)], value=Name(id='secondary', ctx=Load(), lineno=118, col_offset=30, end_lineno=118, end_col_offset=39), lineno=118, col_offset=8, end_lineno=118, end_col_offset=39)], returns=Constant(value=None, lineno=104, col_offset=94, end_lineno=104, end_col_offset=98), lineno=104, col_offset=4, end_lineno=118, end_col_offset=39), FunctionDef(name='gpu_enabled', args=arguments(args=[arg(arg='self', lineno=121, col_offset=20, end_lineno=121, end_col_offset=24)]), body=[Expr(value=Constant(value='Return ``True`` when GPU acceleration is enabled.', lineno=122, col_offset=8, end_lineno=122, end_col_offset=63), lineno=122, col_offset=8, end_lineno=122, end_col_offset=63), Return(value=Attribute(value=Name(id='self', ctx=Load(), lineno=123, col_offset=15, end_lineno=123, end_col_offset=19), attr='_gpu_enabled', ctx=Load(), lineno=123, col_offset=15, end_lineno=123, end_col_offset=32), lineno=123, col_offset=8, end_lineno=123, end_col_offset=32)], decorator_list=[Name(id='property', ctx=Load(), lineno=120, col_offset=5, end_lineno=120, end_col_offset=13)], returns=Name(id='bool', ctx=Load(), lineno=121, col_offset=29, end_lineno=121, end_col_offset=33), lineno=121, col_offset=4, end_lineno=123, end_col_offset=32), FunctionDef(name='gpu_disabled_reason', args=arguments(args=[arg(arg='self', lineno=126, col_offset=28, end_lineno=126, end_col_offset=32)]), body=[Expr(value=Constant(value='Explain why GPU acceleration is disabled, if applicable.', lineno=127, col_offset=8, end_lineno=127, end_col_offset=70), lineno=127, col_offset=8, end_lineno=127, end_col_offset=70), Return(value=Attribute(value=Name(id='self', ctx=Load(), lineno=128, col_offset=15, end_lineno=128, end_col_offset=19), attr='_gpu_disabled_reason', ctx=Load(), lineno=128, col_offset=15, end_lineno=128, end_col_offset=40), lineno=128, col_offset=8, end_lineno=128, end_col_offset=40)], decorator_list=[Name(id='property', ctx=Load(), lineno=125, col_offset=5, end_lineno=125, end_col_offset=13)], returns=BinOp(left=Name(id='str', ctx=Load(), lineno=126, col_offset=37, end_lineno=126, end_col_offset=40), op=BitOr(), right=Constant(value=None, lineno=126, col_offset=43, end_lineno=126, end_col_offset=47), lineno=126, col_offset=37, end_lineno=126, end_col_offset=47), lineno=126, col_offset=4, end_lineno=128, end_col_offset=40), FunctionDef(name='primary_index', args=arguments(args=[arg(arg='self', lineno=131, col_offset=22, end_lineno=131, end_col_offset=26)]), body=[Expr(value=Constant(value='Return the loaded primary FAISS index, if available.', lineno=132, col_offset=8, end_lineno=132, end_col_offset=66), lineno=132, col_offset=8, end_lineno=132, end_col_offset=66), Return(value=Attribute(value=Name(id='self', ctx=Load(), lineno=133, col_offset=15, end_lineno=133, end_col_offset=19), attr='_primary_cpu', ctx=Load(), lineno=133, col_offset=15, end_lineno=133, end_col_offset=32), lineno=133, col_offset=8, end_lineno=133, end_col_offset=32)], decorator_list=[Name(id='property', ctx=Load(), lineno=130, col_offset=5, end_lineno=130, end_col_offset=13)], returns=BinOp(left=Attribute(value=Name(id='faiss', ctx=Load(), lineno=131, col_offset=31, end_lineno=131, end_col_offset=36), attr='Index', ctx=Load(), lineno=131, col_offset=31, end_lineno=131, end_col_offset=42), op=BitOr(), right=Constant(value=None, lineno=131, col_offset=45, end_lineno=131, end_col_offset=49), lineno=131, col_offset=31, end_lineno=131, end_col_offset=49), lineno=131, col_offset=4, end_lineno=133, end_col_offset=32), FunctionDef(name='secondary_index', args=arguments(args=[arg(arg='self', lineno=136, col_offset=24, end_lineno=136, end_col_offset=28)]), body=[Expr(value=Constant(value='Return the loaded secondary FAISS index, if available.', lineno=137, col_offset=8, end_lineno=137, end_col_offset=68), lineno=137, col_offset=8, end_lineno=137, end_col_offset=68), Return(value=Attribute(value=Name(id='self', ctx=Load(), lineno=138, col_offset=15, end_lineno=138, end_col_offset=19), attr='_secondary_cpu', ctx=Load(), lineno=138, col_offset=15, end_lineno=138, end_col_offset=34), lineno=138, col_offset=8, end_lineno=138, end_col_offset=34)], decorator_list=[Name(id='property', ctx=Load(), lineno=135, col_offset=5, end_lineno=135, end_col_offset=13)], returns=BinOp(left=Attribute(value=Name(id='faiss', ctx=Load(), lineno=136, col_offset=33, end_lineno=136, end_col_offset=38), attr='Index', ctx=Load(), lineno=136, col_offset=33, end_lineno=136, end_col_offset=44), op=BitOr(), right=Constant(value=None, lineno=136, col_offset=47, end_lineno=136, end_col_offset=51), lineno=136, col_offset=33, end_lineno=136, end_col_offset=51), lineno=136, col_offset=4, end_lineno=138, end_col_offset=34), FunctionDef(name='manifest', args=arguments(args=[arg(arg='self', lineno=141, col_offset=17, end_lineno=141, end_col_offset=21)]), body=[Expr(value=Constant(value='Return the cached index manifest metadata, if one was loaded.', lineno=142, col_offset=8, end_lineno=142, end_col_offset=75), lineno=142, col_offset=8, end_lineno=142, end_col_offset=75), Return(value=Attribute(value=Name(id='self', ctx=Load(), lineno=143, col_offset=15, end_lineno=143, end_col_offset=19), attr='_manifest', ctx=Load(), lineno=143, col_offset=15, end_lineno=143, end_col_offset=29), lineno=143, col_offset=8, end_lineno=143, end_col_offset=29)], decorator_list=[Name(id='property', ctx=Load(), lineno=140, col_offset=5, end_lineno=140, end_col_offset=13)], returns=BinOp(left=Name(id='IndexManifest', ctx=Load(), lineno=141, col_offset=26, end_lineno=141, end_col_offset=39), op=BitOr(), right=Constant(value=None, lineno=141, col_offset=42, end_lineno=141, end_col_offset=46), lineno=141, col_offset=26, end_lineno=141, end_col_offset=46), lineno=141, col_offset=4, end_lineno=143, end_col_offset=29), AsyncFunctionDef(name='ensure_ready', args=arguments(args=[arg(arg='self', lineno=145, col_offset=27, end_lineno=145, end_col_offset=31)]), body=[Expr(value=Constant(value='Load FAISS artifacts from disk and prepare GPU state.\n\n        Returns\n        -------\n        tuple[bool, str | None]\n            ``(ready, reason)`` where ``ready`` indicates whether CPU indexes are\n            available. ``reason`` carries a degradation message when GPU cloning\n            fails or prerequisites are missing.\n        ', lineno=146, col_offset=8, end_lineno=154, end_col_offset=11), lineno=146, col_offset=8, end_lineno=154, end_col_offset=11), Assign(targets=[Tuple(elts=[Name(id='faiss_module', ctx=Store(), lineno=155, col_offset=8, end_lineno=155, end_col_offset=20), Name(id='reason', ctx=Store(), lineno=155, col_offset=22, end_lineno=155, end_col_offset=28)], ctx=Store(), lineno=155, col_offset=8, end_lineno=155, end_col_offset=28)], value=Call(func=Attribute(value=Name(id='self', ctx=Load(), lineno=155, col_offset=31, end_lineno=155, end_col_offset=35), attr='_import_faiss', ctx=Load(), lineno=155, col_offset=31, end_lineno=155, end_col_offset=49), lineno=155, col_offset=31, end_lineno=155, end_col_offset=51), lineno=155, col_offset=8, end_lineno=155, end_col_offset=51), If(test=Compare(left=Name(id='faiss_module', ctx=Load(), lineno=156, col_offset=11, end_lineno=156, end_col_offset=23), ops=[Is()], comparators=[Constant(value=None, lineno=156, col_offset=27, end_lineno=156, end_col_offset=31)], lineno=156, col_offset=11, end_lineno=156, end_col_offset=31), body=[Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=157, col_offset=12, end_lineno=157, end_col_offset=16), attr='_primary_cpu', ctx=Store(), lineno=157, col_offset=12, end_lineno=157, end_col_offset=29)], value=Constant(value=None, lineno=157, col_offset=32, end_lineno=157, end_col_offset=36), lineno=157, col_offset=12, end_lineno=157, end_col_offset=36), Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=158, col_offset=12, end_lineno=158, end_col_offset=16), attr='_secondary_cpu', ctx=Store(), lineno=158, col_offset=12, end_lineno=158, end_col_offset=31)], value=Constant(value=None, lineno=158, col_offset=34, end_lineno=158, end_col_offset=38), lineno=158, col_offset=12, end_lineno=158, end_col_offset=38), Return(value=Tuple(elts=[Constant(value=False, lineno=159, col_offset=19, end_lineno=159, end_col_offset=24), Name(id='reason', ctx=Load(), lineno=159, col_offset=26, end_lineno=159, end_col_offset=32)], ctx=Load(), lineno=159, col_offset=19, end_lineno=159, end_col_offset=32), lineno=159, col_offset=12, end_lineno=159, end_col_offset=32)], lineno=156, col_offset=8, end_lineno=159, end_col_offset=32), Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=161, col_offset=8, end_lineno=161, end_col_offset=12), attr='_faiss_module', ctx=Store(), lineno=161, col_offset=8, end_lineno=161, end_col_offset=26)], value=Name(id='faiss_module', ctx=Load(), lineno=161, col_offset=29, end_lineno=161, end_col_offset=41), lineno=161, col_offset=8, end_lineno=161, end_col_offset=41), Assign(targets=[Tuple(elts=[Name(id='primary_cpu', ctx=Store(), lineno=163, col_offset=8, end_lineno=163, end_col_offset=19), Name(id='reason', ctx=Store(), lineno=163, col_offset=21, end_lineno=163, end_col_offset=27)], ctx=Store(), lineno=163, col_offset=8, end_lineno=163, end_col_offset=27)], value=Await(value=Call(func=Attribute(value=Name(id='self', ctx=Load(), lineno=163, col_offset=36, end_lineno=163, end_col_offset=40), attr='_load_primary_index', ctx=Load(), lineno=163, col_offset=36, end_lineno=163, end_col_offset=60), args=[Name(id='faiss_module', ctx=Load(), lineno=163, col_offset=61, end_lineno=163, end_col_offset=73)], lineno=163, col_offset=36, end_lineno=163, end_col_offset=74), lineno=163, col_offset=30, end_lineno=163, end_col_offset=74), lineno=163, col_offset=8, end_lineno=163, end_col_offset=74), If(test=Compare(left=Name(id='primary_cpu', ctx=Load(), lineno=164, col_offset=11, end_lineno=164, end_col_offset=22), ops=[Is()], comparators=[Constant(value=None, lineno=164, col_offset=26, end_lineno=164, end_col_offset=30)], lineno=164, col_offset=11, end_lineno=164, end_col_offset=30), body=[Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=165, col_offset=12, end_lineno=165, end_col_offset=16), attr='_primary_cpu', ctx=Store(), lineno=165, col_offset=12, end_lineno=165, end_col_offset=29)], value=Constant(value=None, lineno=165, col_offset=32, end_lineno=165, end_col_offset=36), lineno=165, col_offset=12, end_lineno=165, end_col_offset=36), Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=166, col_offset=12, end_lineno=166, end_col_offset=16), attr='_secondary_cpu', ctx=Store(), lineno=166, col_offset=12, end_lineno=166, end_col_offset=31)], value=Constant(value=None, lineno=166, col_offset=34, end_lineno=166, end_col_offset=38), lineno=166, col_offset=12, end_lineno=166, end_col_offset=38), Return(value=Tuple(elts=[Constant(value=False, lineno=167, col_offset=19, end_lineno=167, end_col_offset=24), Name(id='reason', ctx=Load(), lineno=167, col_offset=26, end_lineno=167, end_col_offset=32)], ctx=Load(), lineno=167, col_offset=19, end_lineno=167, end_col_offset=32), lineno=167, col_offset=12, end_lineno=167, end_col_offset=32)], lineno=164, col_offset=8, end_lineno=167, end_col_offset=32), Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=168, col_offset=8, end_lineno=168, end_col_offset=12), attr='_primary_cpu', ctx=Store(), lineno=168, col_offset=8, end_lineno=168, end_col_offset=25)], value=Name(id='primary_cpu', ctx=Load(), lineno=168, col_offset=28, end_lineno=168, end_col_offset=39), lineno=168, col_offset=8, end_lineno=168, end_col_offset=39), Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=170, col_offset=8, end_lineno=170, end_col_offset=12), attr='_secondary_cpu', ctx=Store(), lineno=170, col_offset=8, end_lineno=170, end_col_offset=27)], value=Await(value=Call(func=Attribute(value=Name(id='self', ctx=Load(), lineno=170, col_offset=36, end_lineno=170, end_col_offset=40), attr='_load_secondary_index', ctx=Load(), lineno=170, col_offset=36, end_lineno=170, end_col_offset=62), args=[Name(id='faiss_module', ctx=Load(), lineno=170, col_offset=63, end_lineno=170, end_col_offset=75)], lineno=170, col_offset=36, end_lineno=170, end_col_offset=76), lineno=170, col_offset=30, end_lineno=170, end_col_offset=76), lineno=170, col_offset=8, end_lineno=170, end_col_offset=76), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load(), lineno=171, col_offset=8, end_lineno=171, end_col_offset=12), attr='_load_manifest', ctx=Load(), lineno=171, col_offset=8, end_lineno=171, end_col_offset=27), lineno=171, col_offset=8, end_lineno=171, end_col_offset=29), lineno=171, col_offset=8, end_lineno=171, end_col_offset=29), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load(), lineno=172, col_offset=8, end_lineno=172, end_col_offset=12), attr='_reset_gpu_state', ctx=Load(), lineno=172, col_offset=8, end_lineno=172, end_col_offset=29), lineno=172, col_offset=8, end_lineno=172, end_col_offset=31), lineno=172, col_offset=8, end_lineno=172, end_col_offset=31), Expr(value=Await(value=Call(func=Attribute(value=Name(id='self', ctx=Load(), lineno=173, col_offset=14, end_lineno=173, end_col_offset=18), attr='try_gpu_clone', ctx=Load(), lineno=173, col_offset=14, end_lineno=173, end_col_offset=32), args=[Name(id='faiss_module', ctx=Load(), lineno=173, col_offset=33, end_lineno=173, end_col_offset=45)], lineno=173, col_offset=14, end_lineno=173, end_col_offset=46), lineno=173, col_offset=8, end_lineno=173, end_col_offset=46), lineno=173, col_offset=8, end_lineno=173, end_col_offset=46), Expr(value=Call(func=Attribute(value=Name(id='LOGGER', ctx=Load(), lineno=175, col_offset=8, end_lineno=175, end_col_offset=14), attr='info', ctx=Load(), lineno=175, col_offset=8, end_lineno=175, end_col_offset=19), args=[Constant(value='faiss_ready', lineno=176, col_offset=12, end_lineno=176, end_col_offset=25)], keywords=[keyword(arg='extra', value=Dict(keys=[Constant(value='primary_count', lineno=178, col_offset=16, end_lineno=178, end_col_offset=31), Constant(value='secondary_count', lineno=179, col_offset=16, end_lineno=179, end_col_offset=33), Constant(value='gpu_enabled', lineno=180, col_offset=16, end_lineno=180, end_col_offset=29), Constant(value='gpu_reason', lineno=181, col_offset=16, end_lineno=181, end_col_offset=28), Constant(value='index_dir', lineno=182, col_offset=16, end_lineno=182, end_col_offset=27)], values=[Call(func=Name(id='int', ctx=Load(), lineno=178, col_offset=33, end_lineno=178, end_col_offset=36), args=[Call(func=Name(id='getattr', ctx=Load(), lineno=178, col_offset=37, end_lineno=178, end_col_offset=44), args=[Attribute(value=Name(id='self', ctx=Load(), lineno=178, col_offset=45, end_lineno=178, end_col_offset=49), attr='_primary_cpu', ctx=Load(), lineno=178, col_offset=45, end_lineno=178, end_col_offset=62), Constant(value='ntotal', lineno=178, col_offset=64, end_lineno=178, end_col_offset=72), Constant(value=0, lineno=178, col_offset=74, end_lineno=178, end_col_offset=75)], lineno=178, col_offset=37, end_lineno=178, end_col_offset=76)], lineno=178, col_offset=33, end_lineno=178, end_col_offset=77), Call(func=Name(id='int', ctx=Load(), lineno=179, col_offset=35, end_lineno=179, end_col_offset=38), args=[Call(func=Name(id='getattr', ctx=Load(), lineno=179, col_offset=39, end_lineno=179, end_col_offset=46), args=[Attribute(value=Name(id='self', ctx=Load(), lineno=179, col_offset=47, end_lineno=179, end_col_offset=51), attr='_secondary_cpu', ctx=Load(), lineno=179, col_offset=47, end_lineno=179, end_col_offset=66), Constant(value='ntotal', lineno=179, col_offset=68, end_lineno=179, end_col_offset=76), Constant(value=0, lineno=179, col_offset=78, end_lineno=179, end_col_offset=79)], lineno=179, col_offset=39, end_lineno=179, end_col_offset=80)], lineno=179, col_offset=35, end_lineno=179, end_col_offset=81), Attribute(value=Name(id='self', ctx=Load(), lineno=180, col_offset=31, end_lineno=180, end_col_offset=35), attr='_gpu_enabled', ctx=Load(), lineno=180, col_offset=31, end_lineno=180, end_col_offset=48), Attribute(value=Name(id='self', ctx=Load(), lineno=181, col_offset=30, end_lineno=181, end_col_offset=34), attr='_gpu_disabled_reason', ctx=Load(), lineno=181, col_offset=30, end_lineno=181, end_col_offset=55), Call(func=Name(id='str', ctx=Load(), lineno=182, col_offset=29, end_lineno=182, end_col_offset=32), args=[Attribute(value=Name(id='self', ctx=Load(), lineno=182, col_offset=33, end_lineno=182, end_col_offset=37), attr='_index_dir', ctx=Load(), lineno=182, col_offset=33, end_lineno=182, end_col_offset=48)], lineno=182, col_offset=29, end_lineno=182, end_col_offset=49)], lineno=177, col_offset=18, end_lineno=183, end_col_offset=13), lineno=177, col_offset=12, end_lineno=183, end_col_offset=13)], lineno=175, col_offset=8, end_lineno=184, end_col_offset=9), lineno=175, col_offset=8, end_lineno=184, end_col_offset=9), Return(value=Tuple(elts=[Constant(value=True, lineno=186, col_offset=15, end_lineno=186, end_col_offset=19), Attribute(value=Name(id='self', ctx=Load(), lineno=186, col_offset=21, end_lineno=186, end_col_offset=25), attr='_gpu_disabled_reason', ctx=Load(), lineno=186, col_offset=21, end_lineno=186, end_col_offset=46)], ctx=Load(), lineno=186, col_offset=15, end_lineno=186, end_col_offset=46), lineno=186, col_offset=8, end_lineno=186, end_col_offset=46)], returns=Subscript(value=Name(id='tuple', ctx=Load(), lineno=145, col_offset=36, end_lineno=145, end_col_offset=41), slice=Tuple(elts=[Name(id='bool', ctx=Load(), lineno=145, col_offset=42, end_lineno=145, end_col_offset=46), BinOp(left=Name(id='str', ctx=Load(), lineno=145, col_offset=48, end_lineno=145, end_col_offset=51), op=BitOr(), right=Constant(value=None, lineno=145, col_offset=54, end_lineno=145, end_col_offset=58), lineno=145, col_offset=48, end_lineno=145, end_col_offset=58)], ctx=Load(), lineno=145, col_offset=42, end_lineno=145, end_col_offset=58), ctx=Load(), lineno=145, col_offset=36, end_lineno=145, end_col_offset=59), lineno=145, col_offset=4, end_lineno=186, end_col_offset=46), FunctionDef(name='search', args=arguments(args=[arg(arg='self', lineno=189, col_offset=8, end_lineno=189, end_col_offset=12), arg(arg='query_vec', annotation=Attribute(value=Name(id='np', ctx=Load(), lineno=190, col_offset=19, end_lineno=190, end_col_offset=21), attr='ndarray', ctx=Load(), lineno=190, col_offset=19, end_lineno=190, end_col_offset=29), lineno=190, col_offset=8, end_lineno=190, end_col_offset=29)], kwonlyargs=[arg(arg='k', annotation=Name(id='int', ctx=Load(), lineno=192, col_offset=11, end_lineno=192, end_col_offset=14), lineno=192, col_offset=8, end_lineno=192, end_col_offset=14), arg(arg='nprobe', annotation=BinOp(left=Name(id='int', ctx=Load(), lineno=193, col_offset=16, end_lineno=193, end_col_offset=19), op=BitOr(), right=Constant(value=None, lineno=193, col_offset=22, end_lineno=193, end_col_offset=26), lineno=193, col_offset=16, end_lineno=193, end_col_offset=26), lineno=193, col_offset=8, end_lineno=193, end_col_offset=26)], kw_defaults=[Constant(value=10, lineno=192, col_offset=17, end_lineno=192, end_col_offset=19), Constant(value=None, lineno=193, col_offset=29, end_lineno=193, end_col_offset=33)]), body=[Expr(value=Constant(value='Search primary and secondary indexes and merge results.\n\n        Parameters\n        ----------\n        query_vec : np.ndarray\n            Query vector with shape ``(vec_dim,)`` or ``(1, vec_dim)``.\n        k : int, optional\n            Number of results to return. Defaults to ``10``.\n        nprobe : int | None, optional\n            IVF probe count for the primary index. When ``None`` uses the\n            configured ``IndexConfig.faiss_nprobe`` value.\n\n        Returns\n        -------\n        list[tuple[int, float]]\n            Top-``k`` ``(chunk_id, score)`` pairs sorted by decreasing score.\n\n        Raises\n        ------\n        RuntimeError\n            If the primary index has not been loaded via :meth:`ensure_ready`.\n        ValueError\n            If the query contains multiple vectors. Batch search support will be\n            added in a future task.\n        ', lineno=195, col_offset=8, end_lineno=219, end_col_offset=11), lineno=195, col_offset=8, end_lineno=219, end_col_offset=11), If(test=Compare(left=Attribute(value=Name(id='self', ctx=Load(), lineno=220, col_offset=11, end_lineno=220, end_col_offset=15), attr='_primary_cpu', ctx=Load(), lineno=220, col_offset=11, end_lineno=220, end_col_offset=28), ops=[Is()], comparators=[Constant(value=None, lineno=220, col_offset=32, end_lineno=220, end_col_offset=36)], lineno=220, col_offset=11, end_lineno=220, end_col_offset=36), body=[Assign(targets=[Name(id='msg', ctx=Store(), lineno=221, col_offset=12, end_lineno=221, end_col_offset=15)], value=Constant(value='Primary index has not been loaded. Call ensure_ready() first.', lineno=221, col_offset=18, end_lineno=221, end_col_offset=81), lineno=221, col_offset=12, end_lineno=221, end_col_offset=81), Raise(exc=Call(func=Name(id='RuntimeError', ctx=Load(), lineno=222, col_offset=18, end_lineno=222, end_col_offset=30), args=[Name(id='msg', ctx=Load(), lineno=222, col_offset=31, end_lineno=222, end_col_offset=34)], lineno=222, col_offset=18, end_lineno=222, end_col_offset=35), lineno=222, col_offset=12, end_lineno=222, end_col_offset=35)], lineno=220, col_offset=8, end_lineno=222, end_col_offset=35), Assign(targets=[Name(id='primary_index', ctx=Store(), lineno=224, col_offset=8, end_lineno=224, end_col_offset=21)], value=Call(func=Attribute(value=Name(id='self', ctx=Load(), lineno=224, col_offset=24, end_lineno=224, end_col_offset=28), attr='_select_primary_index', ctx=Load(), lineno=224, col_offset=24, end_lineno=224, end_col_offset=50), lineno=224, col_offset=24, end_lineno=224, end_col_offset=52), lineno=224, col_offset=8, end_lineno=224, end_col_offset=52), Assign(targets=[Name(id='secondary_index', ctx=Store(), lineno=225, col_offset=8, end_lineno=225, end_col_offset=23)], value=Call(func=Attribute(value=Name(id='self', ctx=Load(), lineno=225, col_offset=26, end_lineno=225, end_col_offset=30), attr='_select_secondary_index', ctx=Load(), lineno=225, col_offset=26, end_lineno=225, end_col_offset=54), lineno=225, col_offset=26, end_lineno=225, end_col_offset=56), lineno=225, col_offset=8, end_lineno=225, end_col_offset=56), Assign(targets=[Name(id='nprobe_effective', ctx=Store(), lineno=226, col_offset=8, end_lineno=226, end_col_offset=24)], value=IfExp(test=Compare(left=Name(id='nprobe', ctx=Load(), lineno=226, col_offset=37, end_lineno=226, end_col_offset=43), ops=[IsNot()], comparators=[Constant(value=None, lineno=226, col_offset=51, end_lineno=226, end_col_offset=55)], lineno=226, col_offset=37, end_lineno=226, end_col_offset=55), body=Name(id='nprobe', ctx=Load(), lineno=226, col_offset=27, end_lineno=226, end_col_offset=33), orelse=Call(func=Name(id='int', ctx=Load(), lineno=226, col_offset=61, end_lineno=226, end_col_offset=64), args=[Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=226, col_offset=65, end_lineno=226, end_col_offset=69), attr='_settings', ctx=Load(), lineno=226, col_offset=65, end_lineno=226, end_col_offset=79), attr='faiss_nprobe', ctx=Load(), lineno=226, col_offset=65, end_lineno=226, end_col_offset=92)], lineno=226, col_offset=61, end_lineno=226, end_col_offset=93), lineno=226, col_offset=27, end_lineno=226, end_col_offset=93), lineno=226, col_offset=8, end_lineno=226, end_col_offset=93), Assign(targets=[Name(id='query', ctx=Store(), lineno=228, col_offset=8, end_lineno=228, end_col_offset=13)], value=Call(func=Attribute(value=Name(id='np', ctx=Load(), lineno=228, col_offset=16, end_lineno=228, end_col_offset=18), attr='asarray', ctx=Load(), lineno=228, col_offset=16, end_lineno=228, end_col_offset=26), args=[Name(id='query_vec', ctx=Load(), lineno=228, col_offset=27, end_lineno=228, end_col_offset=36)], keywords=[keyword(arg='dtype', value=Attribute(value=Name(id='np', ctx=Load(), lineno=228, col_offset=44, end_lineno=228, end_col_offset=46), attr='float32', ctx=Load(), lineno=228, col_offset=44, end_lineno=228, end_col_offset=54), lineno=228, col_offset=38, end_lineno=228, end_col_offset=54)], lineno=228, col_offset=16, end_lineno=228, end_col_offset=55), lineno=228, col_offset=8, end_lineno=228, end_col_offset=55), If(test=Compare(left=Attribute(value=Name(id='query', ctx=Load(), lineno=229, col_offset=11, end_lineno=229, end_col_offset=16), attr='ndim', ctx=Load(), lineno=229, col_offset=11, end_lineno=229, end_col_offset=21), ops=[Eq()], comparators=[Constant(value=1, lineno=229, col_offset=25, end_lineno=229, end_col_offset=26)], lineno=229, col_offset=11, end_lineno=229, end_col_offset=26), body=[Assign(targets=[Name(id='query', ctx=Store(), lineno=230, col_offset=12, end_lineno=230, end_col_offset=17)], value=Call(func=Attribute(value=Name(id='query', ctx=Load(), lineno=230, col_offset=20, end_lineno=230, end_col_offset=25), attr='reshape', ctx=Load(), lineno=230, col_offset=20, end_lineno=230, end_col_offset=33), args=[Constant(value=1, lineno=230, col_offset=34, end_lineno=230, end_col_offset=35), UnaryOp(op=USub(), operand=Constant(value=1, lineno=230, col_offset=38, end_lineno=230, end_col_offset=39), lineno=230, col_offset=37, end_lineno=230, end_col_offset=39)], lineno=230, col_offset=20, end_lineno=230, end_col_offset=40), lineno=230, col_offset=12, end_lineno=230, end_col_offset=40)], orelse=[If(test=Compare(left=Subscript(value=Attribute(value=Name(id='query', ctx=Load(), lineno=231, col_offset=13, end_lineno=231, end_col_offset=18), attr='shape', ctx=Load(), lineno=231, col_offset=13, end_lineno=231, end_col_offset=24), slice=Constant(value=0, lineno=231, col_offset=25, end_lineno=231, end_col_offset=26), ctx=Load(), lineno=231, col_offset=13, end_lineno=231, end_col_offset=27), ops=[NotEq()], comparators=[Constant(value=1, lineno=231, col_offset=31, end_lineno=231, end_col_offset=32)], lineno=231, col_offset=13, end_lineno=231, end_col_offset=32), body=[Assign(targets=[Name(id='msg', ctx=Store(), lineno=232, col_offset=12, end_lineno=232, end_col_offset=15)], value=Constant(value='Only single-query searches are supported', lineno=232, col_offset=18, end_lineno=232, end_col_offset=60), lineno=232, col_offset=12, end_lineno=232, end_col_offset=60), Raise(exc=Call(func=Name(id='ValueError', ctx=Load(), lineno=233, col_offset=18, end_lineno=233, end_col_offset=28), args=[Name(id='msg', ctx=Load(), lineno=233, col_offset=29, end_lineno=233, end_col_offset=32)], lineno=233, col_offset=18, end_lineno=233, end_col_offset=33), lineno=233, col_offset=12, end_lineno=233, end_col_offset=33)], lineno=231, col_offset=8, end_lineno=233, end_col_offset=33)], lineno=229, col_offset=8, end_lineno=233, end_col_offset=33), Assign(targets=[Name(id='faiss_module', ctx=Store(), lineno=235, col_offset=8, end_lineno=235, end_col_offset=20)], value=BoolOp(op=Or(), values=[Attribute(value=Name(id='self', ctx=Load(), lineno=235, col_offset=23, end_lineno=235, end_col_offset=27), attr='_faiss_module', ctx=Load(), lineno=235, col_offset=23, end_lineno=235, end_col_offset=41), Call(func=Attribute(value=Name(id='importlib', ctx=Load(), lineno=235, col_offset=45, end_lineno=235, end_col_offset=54), attr='import_module', ctx=Load(), lineno=235, col_offset=45, end_lineno=235, end_col_offset=68), args=[Constant(value='faiss', lineno=235, col_offset=69, end_lineno=235, end_col_offset=76)], lineno=235, col_offset=45, end_lineno=235, end_col_offset=77)], lineno=235, col_offset=23, end_lineno=235, end_col_offset=77), lineno=235, col_offset=8, end_lineno=235, end_col_offset=77), Assign(targets=[Name(id='query_norm', ctx=Store(), lineno=236, col_offset=8, end_lineno=236, end_col_offset=18)], value=Call(func=Attribute(value=Name(id='query', ctx=Load(), lineno=236, col_offset=21, end_lineno=236, end_col_offset=26), attr='copy', ctx=Load(), lineno=236, col_offset=21, end_lineno=236, end_col_offset=31), lineno=236, col_offset=21, end_lineno=236, end_col_offset=33), lineno=236, col_offset=8, end_lineno=236, end_col_offset=33), Expr(value=Call(func=Attribute(value=Name(id='faiss_module', ctx=Load(), lineno=237, col_offset=8, end_lineno=237, end_col_offset=20), attr='normalize_L2', ctx=Load(), lineno=237, col_offset=8, end_lineno=237, end_col_offset=33), args=[Name(id='query_norm', ctx=Load(), lineno=237, col_offset=34, end_lineno=237, end_col_offset=44)], lineno=237, col_offset=8, end_lineno=237, end_col_offset=45), lineno=237, col_offset=8, end_lineno=237, end_col_offset=45), Assign(targets=[Name(id='fetch', ctx=Store(), lineno=239, col_offset=8, end_lineno=239, end_col_offset=13)], value=Call(func=Name(id='max', ctx=Load(), lineno=239, col_offset=16, end_lineno=239, end_col_offset=19), args=[BinOp(left=Name(id='k', ctx=Load(), lineno=239, col_offset=20, end_lineno=239, end_col_offset=21), op=Mult(), right=Constant(value=2, lineno=239, col_offset=24, end_lineno=239, end_col_offset=25), lineno=239, col_offset=20, end_lineno=239, end_col_offset=25), Name(id='k', ctx=Load(), lineno=239, col_offset=27, end_lineno=239, end_col_offset=28)], lineno=239, col_offset=16, end_lineno=239, end_col_offset=29), lineno=239, col_offset=8, end_lineno=239, end_col_offset=29), If(test=Call(func=Name(id='hasattr', ctx=Load(), lineno=241, col_offset=11, end_lineno=241, end_col_offset=18), args=[Name(id='primary_index', ctx=Load(), lineno=241, col_offset=19, end_lineno=241, end_col_offset=32), Constant(value='nprobe', lineno=241, col_offset=34, end_lineno=241, end_col_offset=42)], lineno=241, col_offset=11, end_lineno=241, end_col_offset=43), body=[Assign(targets=[Attribute(value=Name(id='primary_index', ctx=Load(), lineno=242, col_offset=12, end_lineno=242, end_col_offset=25), attr='nprobe', ctx=Store(), lineno=242, col_offset=12, end_lineno=242, end_col_offset=32)], value=Name(id='nprobe_effective', ctx=Load(), lineno=242, col_offset=35, end_lineno=242, end_col_offset=51), lineno=242, col_offset=12, end_lineno=242, end_col_offset=51)], lineno=241, col_offset=8, end_lineno=242, end_col_offset=51), Assign(targets=[Tuple(elts=[Name(id='distances_p', ctx=Store(), lineno=243, col_offset=8, end_lineno=243, end_col_offset=19), Name(id='ids_p', ctx=Store(), lineno=243, col_offset=21, end_lineno=243, end_col_offset=26)], ctx=Store(), lineno=243, col_offset=8, end_lineno=243, end_col_offset=26)], value=Call(func=Attribute(value=Name(id='primary_index', ctx=Load(), lineno=243, col_offset=29, end_lineno=243, end_col_offset=42), attr='search', ctx=Load(), lineno=243, col_offset=29, end_lineno=243, end_col_offset=49), args=[Name(id='query_norm', ctx=Load(), lineno=243, col_offset=50, end_lineno=243, end_col_offset=60), Name(id='fetch', ctx=Load(), lineno=243, col_offset=62, end_lineno=243, end_col_offset=67)], lineno=243, col_offset=29, end_lineno=243, end_col_offset=68), lineno=243, col_offset=8, end_lineno=243, end_col_offset=68), If(test=BoolOp(op=And(), values=[Compare(left=Name(id='secondary_index', ctx=Load(), lineno=245, col_offset=11, end_lineno=245, end_col_offset=26), ops=[IsNot()], comparators=[Constant(value=None, lineno=245, col_offset=34, end_lineno=245, end_col_offset=38)], lineno=245, col_offset=11, end_lineno=245, end_col_offset=38), Compare(left=Call(func=Name(id='getattr', ctx=Load(), lineno=245, col_offset=43, end_lineno=245, end_col_offset=50), args=[Name(id='secondary_index', ctx=Load(), lineno=245, col_offset=51, end_lineno=245, end_col_offset=66), Constant(value='ntotal', lineno=245, col_offset=68, end_lineno=245, end_col_offset=76), Constant(value=0, lineno=245, col_offset=78, end_lineno=245, end_col_offset=79)], lineno=245, col_offset=43, end_lineno=245, end_col_offset=80), ops=[Gt()], comparators=[Constant(value=0, lineno=245, col_offset=83, end_lineno=245, end_col_offset=84)], lineno=245, col_offset=43, end_lineno=245, end_col_offset=84)], lineno=245, col_offset=11, end_lineno=245, end_col_offset=84), body=[Assign(targets=[Tuple(elts=[Name(id='distances_s', ctx=Store(), lineno=246, col_offset=12, end_lineno=246, end_col_offset=23), Name(id='ids_s', ctx=Store(), lineno=246, col_offset=25, end_lineno=246, end_col_offset=30)], ctx=Store(), lineno=246, col_offset=12, end_lineno=246, end_col_offset=30)], value=Call(func=Attribute(value=Name(id='secondary_index', ctx=Load(), lineno=246, col_offset=33, end_lineno=246, end_col_offset=48), attr='search', ctx=Load(), lineno=246, col_offset=33, end_lineno=246, end_col_offset=55), args=[Name(id='query_norm', ctx=Load(), lineno=246, col_offset=56, end_lineno=246, end_col_offset=66), Name(id='fetch', ctx=Load(), lineno=246, col_offset=68, end_lineno=246, end_col_offset=73)], lineno=246, col_offset=33, end_lineno=246, end_col_offset=74), lineno=246, col_offset=12, end_lineno=246, end_col_offset=74)], orelse=[Assign(targets=[Name(id='distances_s', ctx=Store(), lineno=248, col_offset=12, end_lineno=248, end_col_offset=23)], value=Call(func=Attribute(value=Name(id='np', ctx=Load(), lineno=248, col_offset=26, end_lineno=248, end_col_offset=28), attr='empty', ctx=Load(), lineno=248, col_offset=26, end_lineno=248, end_col_offset=34), args=[Tuple(elts=[Constant(value=1, lineno=248, col_offset=36, end_lineno=248, end_col_offset=37), Constant(value=0, lineno=248, col_offset=39, end_lineno=248, end_col_offset=40)], ctx=Load(), lineno=248, col_offset=35, end_lineno=248, end_col_offset=41)], keywords=[keyword(arg='dtype', value=Attribute(value=Name(id='np', ctx=Load(), lineno=248, col_offset=49, end_lineno=248, end_col_offset=51), attr='float32', ctx=Load(), lineno=248, col_offset=49, end_lineno=248, end_col_offset=59), lineno=248, col_offset=43, end_lineno=248, end_col_offset=59)], lineno=248, col_offset=26, end_lineno=248, end_col_offset=60), lineno=248, col_offset=12, end_lineno=248, end_col_offset=60), Assign(targets=[Name(id='ids_s', ctx=Store(), lineno=249, col_offset=12, end_lineno=249, end_col_offset=17)], value=Call(func=Attribute(value=Name(id='np', ctx=Load(), lineno=249, col_offset=20, end_lineno=249, end_col_offset=22), attr='empty', ctx=Load(), lineno=249, col_offset=20, end_lineno=249, end_col_offset=28), args=[Tuple(elts=[Constant(value=1, lineno=249, col_offset=30, end_lineno=249, end_col_offset=31), Constant(value=0, lineno=249, col_offset=33, end_lineno=249, end_col_offset=34)], ctx=Load(), lineno=249, col_offset=29, end_lineno=249, end_col_offset=35)], keywords=[keyword(arg='dtype', value=Attribute(value=Name(id='np', ctx=Load(), lineno=249, col_offset=43, end_lineno=249, end_col_offset=45), attr='int64', ctx=Load(), lineno=249, col_offset=43, end_lineno=249, end_col_offset=51), lineno=249, col_offset=37, end_lineno=249, end_col_offset=51)], lineno=249, col_offset=20, end_lineno=249, end_col_offset=52), lineno=249, col_offset=12, end_lineno=249, end_col_offset=52)], lineno=245, col_offset=8, end_lineno=249, end_col_offset=52), AnnAssign(target=Name(id='results', ctx=Store(), lineno=251, col_offset=8, end_lineno=251, end_col_offset=15), annotation=Subscript(value=Name(id='dict', ctx=Load(), lineno=251, col_offset=17, end_lineno=251, end_col_offset=21), slice=Tuple(elts=[Name(id='int', ctx=Load(), lineno=251, col_offset=22, end_lineno=251, end_col_offset=25), Name(id='float', ctx=Load(), lineno=251, col_offset=27, end_lineno=251, end_col_offset=32)], ctx=Load(), lineno=251, col_offset=22, end_lineno=251, end_col_offset=32), ctx=Load(), lineno=251, col_offset=17, end_lineno=251, end_col_offset=33), value=Dict(lineno=251, col_offset=36, end_lineno=251, end_col_offset=38), simple=1, lineno=251, col_offset=8, end_lineno=251, end_col_offset=38), For(target=Tuple(elts=[Name(id='idx', ctx=Store(), lineno=252, col_offset=12, end_lineno=252, end_col_offset=15), Name(id='score', ctx=Store(), lineno=252, col_offset=17, end_lineno=252, end_col_offset=22)], ctx=Store(), lineno=252, col_offset=12, end_lineno=252, end_col_offset=22), iter=Call(func=Name(id='zip', ctx=Load(), lineno=252, col_offset=26, end_lineno=252, end_col_offset=29), args=[Subscript(value=Name(id='ids_p', ctx=Load(), lineno=252, col_offset=30, end_lineno=252, end_col_offset=35), slice=Constant(value=0, lineno=252, col_offset=36, end_lineno=252, end_col_offset=37), ctx=Load(), lineno=252, col_offset=30, end_lineno=252, end_col_offset=38), Subscript(value=Name(id='distances_p', ctx=Load(), lineno=252, col_offset=40, end_lineno=252, end_col_offset=51), slice=Constant(value=0, lineno=252, col_offset=52, end_lineno=252, end_col_offset=53), ctx=Load(), lineno=252, col_offset=40, end_lineno=252, end_col_offset=54)], keywords=[keyword(arg='strict', value=Constant(value=True, lineno=252, col_offset=63, end_lineno=252, end_col_offset=67), lineno=252, col_offset=56, end_lineno=252, end_col_offset=67)], lineno=252, col_offset=26, end_lineno=252, end_col_offset=68), body=[If(test=Compare(left=Name(id='idx', ctx=Load(), lineno=253, col_offset=15, end_lineno=253, end_col_offset=18), ops=[Eq()], comparators=[UnaryOp(op=USub(), operand=Constant(value=1, lineno=253, col_offset=23, end_lineno=253, end_col_offset=24), lineno=253, col_offset=22, end_lineno=253, end_col_offset=24)], lineno=253, col_offset=15, end_lineno=253, end_col_offset=24), body=[Continue(lineno=254, col_offset=16, end_lineno=254, end_col_offset=24)], lineno=253, col_offset=12, end_lineno=254, end_col_offset=24), Assign(targets=[Subscript(value=Name(id='results', ctx=Load(), lineno=255, col_offset=12, end_lineno=255, end_col_offset=19), slice=Call(func=Name(id='int', ctx=Load(), lineno=255, col_offset=20, end_lineno=255, end_col_offset=23), args=[Name(id='idx', ctx=Load(), lineno=255, col_offset=24, end_lineno=255, end_col_offset=27)], lineno=255, col_offset=20, end_lineno=255, end_col_offset=28), ctx=Store(), lineno=255, col_offset=12, end_lineno=255, end_col_offset=29)], value=Call(func=Name(id='max', ctx=Load(), lineno=255, col_offset=32, end_lineno=255, end_col_offset=35), args=[Call(func=Attribute(value=Name(id='results', ctx=Load(), lineno=255, col_offset=36, end_lineno=255, end_col_offset=43), attr='get', ctx=Load(), lineno=255, col_offset=36, end_lineno=255, end_col_offset=47), args=[Call(func=Name(id='int', ctx=Load(), lineno=255, col_offset=48, end_lineno=255, end_col_offset=51), args=[Name(id='idx', ctx=Load(), lineno=255, col_offset=52, end_lineno=255, end_col_offset=55)], lineno=255, col_offset=48, end_lineno=255, end_col_offset=56), Call(func=Name(id='float', ctx=Load(), lineno=255, col_offset=58, end_lineno=255, end_col_offset=63), args=[Constant(value='-inf', lineno=255, col_offset=64, end_lineno=255, end_col_offset=70)], lineno=255, col_offset=58, end_lineno=255, end_col_offset=71)], lineno=255, col_offset=36, end_lineno=255, end_col_offset=72), Call(func=Name(id='float', ctx=Load(), lineno=255, col_offset=74, end_lineno=255, end_col_offset=79), args=[Name(id='score', ctx=Load(), lineno=255, col_offset=80, end_lineno=255, end_col_offset=85)], lineno=255, col_offset=74, end_lineno=255, end_col_offset=86)], lineno=255, col_offset=32, end_lineno=255, end_col_offset=87), lineno=255, col_offset=12, end_lineno=255, end_col_offset=87)], lineno=252, col_offset=8, end_lineno=255, end_col_offset=87), For(target=Tuple(elts=[Name(id='idx', ctx=Store(), lineno=257, col_offset=12, end_lineno=257, end_col_offset=15), Name(id='score', ctx=Store(), lineno=257, col_offset=17, end_lineno=257, end_col_offset=22)], ctx=Store(), lineno=257, col_offset=12, end_lineno=257, end_col_offset=22), iter=Call(func=Name(id='zip', ctx=Load(), lineno=257, col_offset=26, end_lineno=257, end_col_offset=29), args=[Subscript(value=Name(id='ids_s', ctx=Load(), lineno=257, col_offset=30, end_lineno=257, end_col_offset=35), slice=Constant(value=0, lineno=257, col_offset=36, end_lineno=257, end_col_offset=37), ctx=Load(), lineno=257, col_offset=30, end_lineno=257, end_col_offset=38), Subscript(value=Name(id='distances_s', ctx=Load(), lineno=257, col_offset=40, end_lineno=257, end_col_offset=51), slice=Constant(value=0, lineno=257, col_offset=52, end_lineno=257, end_col_offset=53), ctx=Load(), lineno=257, col_offset=40, end_lineno=257, end_col_offset=54)], keywords=[keyword(arg='strict', value=Constant(value=True, lineno=257, col_offset=63, end_lineno=257, end_col_offset=67), lineno=257, col_offset=56, end_lineno=257, end_col_offset=67)], lineno=257, col_offset=26, end_lineno=257, end_col_offset=68), body=[If(test=Compare(left=Name(id='idx', ctx=Load(), lineno=258, col_offset=15, end_lineno=258, end_col_offset=18), ops=[Eq()], comparators=[UnaryOp(op=USub(), operand=Constant(value=1, lineno=258, col_offset=23, end_lineno=258, end_col_offset=24), lineno=258, col_offset=22, end_lineno=258, end_col_offset=24)], lineno=258, col_offset=15, end_lineno=258, end_col_offset=24), body=[Continue(lineno=259, col_offset=16, end_lineno=259, end_col_offset=24)], lineno=258, col_offset=12, end_lineno=259, end_col_offset=24), Assign(targets=[Subscript(value=Name(id='results', ctx=Load(), lineno=260, col_offset=12, end_lineno=260, end_col_offset=19), slice=Call(func=Name(id='int', ctx=Load(), lineno=260, col_offset=20, end_lineno=260, end_col_offset=23), args=[Name(id='idx', ctx=Load(), lineno=260, col_offset=24, end_lineno=260, end_col_offset=27)], lineno=260, col_offset=20, end_lineno=260, end_col_offset=28), ctx=Store(), lineno=260, col_offset=12, end_lineno=260, end_col_offset=29)], value=Call(func=Name(id='max', ctx=Load(), lineno=260, col_offset=32, end_lineno=260, end_col_offset=35), args=[Call(func=Attribute(value=Name(id='results', ctx=Load(), lineno=260, col_offset=36, end_lineno=260, end_col_offset=43), attr='get', ctx=Load(), lineno=260, col_offset=36, end_lineno=260, end_col_offset=47), args=[Call(func=Name(id='int', ctx=Load(), lineno=260, col_offset=48, end_lineno=260, end_col_offset=51), args=[Name(id='idx', ctx=Load(), lineno=260, col_offset=52, end_lineno=260, end_col_offset=55)], lineno=260, col_offset=48, end_lineno=260, end_col_offset=56), Call(func=Name(id='float', ctx=Load(), lineno=260, col_offset=58, end_lineno=260, end_col_offset=63), args=[Constant(value='-inf', lineno=260, col_offset=64, end_lineno=260, end_col_offset=70)], lineno=260, col_offset=58, end_lineno=260, end_col_offset=71)], lineno=260, col_offset=36, end_lineno=260, end_col_offset=72), Call(func=Name(id='float', ctx=Load(), lineno=260, col_offset=74, end_lineno=260, end_col_offset=79), args=[Name(id='score', ctx=Load(), lineno=260, col_offset=80, end_lineno=260, end_col_offset=85)], lineno=260, col_offset=74, end_lineno=260, end_col_offset=86)], lineno=260, col_offset=32, end_lineno=260, end_col_offset=87), lineno=260, col_offset=12, end_lineno=260, end_col_offset=87)], lineno=257, col_offset=8, end_lineno=260, end_col_offset=87), Assign(targets=[Name(id='sorted_results', ctx=Store(), lineno=262, col_offset=8, end_lineno=262, end_col_offset=22)], value=Call(func=Name(id='sorted', ctx=Load(), lineno=262, col_offset=25, end_lineno=262, end_col_offset=31), args=[Call(func=Attribute(value=Name(id='results', ctx=Load(), lineno=262, col_offset=32, end_lineno=262, end_col_offset=39), attr='items', ctx=Load(), lineno=262, col_offset=32, end_lineno=262, end_col_offset=45), lineno=262, col_offset=32, end_lineno=262, end_col_offset=47)], keywords=[keyword(arg='key', value=Lambda(args=arguments(args=[arg(arg='item', lineno=262, col_offset=60, end_lineno=262, end_col_offset=64)]), body=Subscript(value=Name(id='item', ctx=Load(), lineno=262, col_offset=66, end_lineno=262, end_col_offset=70), slice=Constant(value=1, lineno=262, col_offset=71, end_lineno=262, end_col_offset=72), ctx=Load(), lineno=262, col_offset=66, end_lineno=262, end_col_offset=73), lineno=262, col_offset=53, end_lineno=262, end_col_offset=73), lineno=262, col_offset=49, end_lineno=262, end_col_offset=73), keyword(arg='reverse', value=Constant(value=True, lineno=262, col_offset=83, end_lineno=262, end_col_offset=87), lineno=262, col_offset=75, end_lineno=262, end_col_offset=87)], lineno=262, col_offset=25, end_lineno=262, end_col_offset=88), lineno=262, col_offset=8, end_lineno=262, end_col_offset=88), Return(value=Subscript(value=Name(id='sorted_results', ctx=Load(), lineno=263, col_offset=15, end_lineno=263, end_col_offset=29), slice=Slice(upper=Name(id='k', ctx=Load(), lineno=263, col_offset=31, end_lineno=263, end_col_offset=32), lineno=263, col_offset=30, end_lineno=263, end_col_offset=32), ctx=Load(), lineno=263, col_offset=15, end_lineno=263, end_col_offset=33), lineno=263, col_offset=8, end_lineno=263, end_col_offset=33)], returns=Subscript(value=Name(id='list', ctx=Load(), lineno=194, col_offset=9, end_lineno=194, end_col_offset=13), slice=Subscript(value=Name(id='tuple', ctx=Load(), lineno=194, col_offset=14, end_lineno=194, end_col_offset=19), slice=Tuple(elts=[Name(id='int', ctx=Load(), lineno=194, col_offset=20, end_lineno=194, end_col_offset=23), Name(id='float', ctx=Load(), lineno=194, col_offset=25, end_lineno=194, end_col_offset=30)], ctx=Load(), lineno=194, col_offset=20, end_lineno=194, end_col_offset=30), ctx=Load(), lineno=194, col_offset=14, end_lineno=194, end_col_offset=31), ctx=Load(), lineno=194, col_offset=9, end_lineno=194, end_col_offset=32), lineno=188, col_offset=4, end_lineno=263, end_col_offset=33), AsyncFunctionDef(name='add_incremental', args=arguments(args=[arg(arg='self', lineno=265, col_offset=30, end_lineno=265, end_col_offset=34), arg(arg='vectors', annotation=Attribute(value=Name(id='np', ctx=Load(), lineno=265, col_offset=45, end_lineno=265, end_col_offset=47), attr='ndarray', ctx=Load(), lineno=265, col_offset=45, end_lineno=265, end_col_offset=55), lineno=265, col_offset=36, end_lineno=265, end_col_offset=55), arg(arg='chunk_ids', annotation=Attribute(value=Name(id='np', ctx=Load(), lineno=265, col_offset=68, end_lineno=265, end_col_offset=70), attr='ndarray', ctx=Load(), lineno=265, col_offset=68, end_lineno=265, end_col_offset=78), lineno=265, col_offset=57, end_lineno=265, end_col_offset=78)]), body=[Expr(value=Constant(value='Append vectors to the secondary index and persist them to disk.\n\n        Parameters\n        ----------\n        vectors : np.ndarray\n            2-D array of shape ``(n, vec_dim)`` containing the vectors to add. The\n            vectors are L2-normalized before insertion.\n        chunk_ids : np.ndarray\n            1-D array of shape ``(n,)`` containing the chunk identifiers to bind to\n            the provided vectors. IDs are coerced to ``int64``.\n\n        Raises\n        ------\n        RuntimeError\n            If :meth:`ensure_ready` has not been called yet.\n        ValueError\n            If the vectors do not match the configured embedding dimension or if\n            the number of vectors differs from the number of chunk IDs.\n        ', lineno=266, col_offset=8, end_lineno=284, end_col_offset=11), lineno=266, col_offset=8, end_lineno=284, end_col_offset=11), If(test=BoolOp(op=Or(), values=[Compare(left=Attribute(value=Name(id='self', ctx=Load(), lineno=285, col_offset=11, end_lineno=285, end_col_offset=15), attr='_primary_cpu', ctx=Load(), lineno=285, col_offset=11, end_lineno=285, end_col_offset=28), ops=[Is()], comparators=[Constant(value=None, lineno=285, col_offset=32, end_lineno=285, end_col_offset=36)], lineno=285, col_offset=11, end_lineno=285, end_col_offset=36), Compare(left=Attribute(value=Name(id='self', ctx=Load(), lineno=285, col_offset=40, end_lineno=285, end_col_offset=44), attr='_secondary_cpu', ctx=Load(), lineno=285, col_offset=40, end_lineno=285, end_col_offset=59), ops=[Is()], comparators=[Constant(value=None, lineno=285, col_offset=63, end_lineno=285, end_col_offset=67)], lineno=285, col_offset=40, end_lineno=285, end_col_offset=67)], lineno=285, col_offset=11, end_lineno=285, end_col_offset=67), body=[Assign(targets=[Name(id='msg', ctx=Store(), lineno=286, col_offset=12, end_lineno=286, end_col_offset=15)], value=Constant(value='FAISS indexes not loaded. Call ensure_ready() before add_incremental().', lineno=286, col_offset=18, end_lineno=286, end_col_offset=91), lineno=286, col_offset=12, end_lineno=286, end_col_offset=91), Raise(exc=Call(func=Name(id='RuntimeError', ctx=Load(), lineno=287, col_offset=18, end_lineno=287, end_col_offset=30), args=[Name(id='msg', ctx=Load(), lineno=287, col_offset=31, end_lineno=287, end_col_offset=34)], lineno=287, col_offset=18, end_lineno=287, end_col_offset=35), lineno=287, col_offset=12, end_lineno=287, end_col_offset=35)], lineno=285, col_offset=8, end_lineno=287, end_col_offset=35), Assign(targets=[Name(id='expected_rank', ctx=Store(), lineno=289, col_offset=8, end_lineno=289, end_col_offset=21)], value=Constant(value=2, lineno=289, col_offset=24, end_lineno=289, end_col_offset=25), lineno=289, col_offset=8, end_lineno=289, end_col_offset=25), If(test=Compare(left=Attribute(value=Name(id='vectors', ctx=Load(), lineno=290, col_offset=11, end_lineno=290, end_col_offset=18), attr='ndim', ctx=Load(), lineno=290, col_offset=11, end_lineno=290, end_col_offset=23), ops=[NotEq()], comparators=[Name(id='expected_rank', ctx=Load(), lineno=290, col_offset=27, end_lineno=290, end_col_offset=40)], lineno=290, col_offset=11, end_lineno=290, end_col_offset=40), body=[Assign(targets=[Name(id='msg', ctx=Store(), lineno=291, col_offset=12, end_lineno=291, end_col_offset=15)], value=Constant(value='vectors must have shape (n, vec_dim)', lineno=291, col_offset=18, end_lineno=291, end_col_offset=56), lineno=291, col_offset=12, end_lineno=291, end_col_offset=56), Raise(exc=Call(func=Name(id='ValueError', ctx=Load(), lineno=292, col_offset=18, end_lineno=292, end_col_offset=28), args=[Name(id='msg', ctx=Load(), lineno=292, col_offset=29, end_lineno=292, end_col_offset=32)], lineno=292, col_offset=18, end_lineno=292, end_col_offset=33), lineno=292, col_offset=12, end_lineno=292, end_col_offset=33)], lineno=290, col_offset=8, end_lineno=292, end_col_offset=33), If(test=Compare(left=Subscript(value=Attribute(value=Name(id='vectors', ctx=Load(), lineno=293, col_offset=11, end_lineno=293, end_col_offset=18), attr='shape', ctx=Load(), lineno=293, col_offset=11, end_lineno=293, end_col_offset=24), slice=Constant(value=1, lineno=293, col_offset=25, end_lineno=293, end_col_offset=26), ctx=Load(), lineno=293, col_offset=11, end_lineno=293, end_col_offset=27), ops=[NotEq()], comparators=[Attribute(value=Name(id='self', ctx=Load(), lineno=293, col_offset=31, end_lineno=293, end_col_offset=35), attr='_vec_dim', ctx=Load(), lineno=293, col_offset=31, end_lineno=293, end_col_offset=44)], lineno=293, col_offset=11, end_lineno=293, end_col_offset=44), body=[Assign(targets=[Name(id='msg', ctx=Store(), lineno=294, col_offset=12, end_lineno=294, end_col_offset=15)], value=JoinedStr(values=[Constant(value='Vector dimension ', lineno=294, col_offset=20, end_lineno=294, end_col_offset=37), FormattedValue(value=Subscript(value=Attribute(value=Name(id='vectors', ctx=Load(), lineno=294, col_offset=38, end_lineno=294, end_col_offset=45), attr='shape', ctx=Load(), lineno=294, col_offset=38, end_lineno=294, end_col_offset=51), slice=Constant(value=1, lineno=294, col_offset=52, end_lineno=294, end_col_offset=53), ctx=Load(), lineno=294, col_offset=38, end_lineno=294, end_col_offset=54), conversion=-1, lineno=294, col_offset=37, end_lineno=294, end_col_offset=55), Constant(value=' does not match expected ', lineno=294, col_offset=55, end_lineno=294, end_col_offset=80), FormattedValue(value=Attribute(value=Name(id='self', ctx=Load(), lineno=294, col_offset=81, end_lineno=294, end_col_offset=85), attr='_vec_dim', ctx=Load(), lineno=294, col_offset=81, end_lineno=294, end_col_offset=94), conversion=-1, lineno=294, col_offset=80, end_lineno=294, end_col_offset=95)], lineno=294, col_offset=18, end_lineno=294, end_col_offset=96), lineno=294, col_offset=12, end_lineno=294, end_col_offset=96), Raise(exc=Call(func=Name(id='ValueError', ctx=Load(), lineno=295, col_offset=18, end_lineno=295, end_col_offset=28), args=[Name(id='msg', ctx=Load(), lineno=295, col_offset=29, end_lineno=295, end_col_offset=32)], lineno=295, col_offset=18, end_lineno=295, end_col_offset=33), lineno=295, col_offset=12, end_lineno=295, end_col_offset=33)], lineno=293, col_offset=8, end_lineno=295, end_col_offset=33), Assign(targets=[Name(id='ids', ctx=Store(), lineno=297, col_offset=8, end_lineno=297, end_col_offset=11)], value=Call(func=Attribute(value=Name(id='np', ctx=Load(), lineno=297, col_offset=14, end_lineno=297, end_col_offset=16), attr='asarray', ctx=Load(), lineno=297, col_offset=14, end_lineno=297, end_col_offset=24), args=[Name(id='chunk_ids', ctx=Load(), lineno=297, col_offset=25, end_lineno=297, end_col_offset=34)], keywords=[keyword(arg='dtype', value=Attribute(value=Name(id='np', ctx=Load(), lineno=297, col_offset=42, end_lineno=297, end_col_offset=44), attr='int64', ctx=Load(), lineno=297, col_offset=42, end_lineno=297, end_col_offset=50), lineno=297, col_offset=36, end_lineno=297, end_col_offset=50)], lineno=297, col_offset=14, end_lineno=297, end_col_offset=51), lineno=297, col_offset=8, end_lineno=297, end_col_offset=51), If(test=Compare(left=Attribute(value=Name(id='ids', ctx=Load(), lineno=298, col_offset=11, end_lineno=298, end_col_offset=14), attr='ndim', ctx=Load(), lineno=298, col_offset=11, end_lineno=298, end_col_offset=19), ops=[NotEq()], comparators=[Constant(value=1, lineno=298, col_offset=23, end_lineno=298, end_col_offset=24)], lineno=298, col_offset=11, end_lineno=298, end_col_offset=24), body=[Assign(targets=[Name(id='msg', ctx=Store(), lineno=299, col_offset=12, end_lineno=299, end_col_offset=15)], value=Constant(value='chunk_ids must be a 1-D array', lineno=299, col_offset=18, end_lineno=299, end_col_offset=49), lineno=299, col_offset=12, end_lineno=299, end_col_offset=49), Raise(exc=Call(func=Name(id='ValueError', ctx=Load(), lineno=300, col_offset=18, end_lineno=300, end_col_offset=28), args=[Name(id='msg', ctx=Load(), lineno=300, col_offset=29, end_lineno=300, end_col_offset=32)], lineno=300, col_offset=18, end_lineno=300, end_col_offset=33), lineno=300, col_offset=12, end_lineno=300, end_col_offset=33)], lineno=298, col_offset=8, end_lineno=300, end_col_offset=33), If(test=Compare(left=Subscript(value=Attribute(value=Name(id='vectors', ctx=Load(), lineno=301, col_offset=11, end_lineno=301, end_col_offset=18), attr='shape', ctx=Load(), lineno=301, col_offset=11, end_lineno=301, end_col_offset=24), slice=Constant(value=0, lineno=301, col_offset=25, end_lineno=301, end_col_offset=26), ctx=Load(), lineno=301, col_offset=11, end_lineno=301, end_col_offset=27), ops=[NotEq()], comparators=[Subscript(value=Attribute(value=Name(id='ids', ctx=Load(), lineno=301, col_offset=31, end_lineno=301, end_col_offset=34), attr='shape', ctx=Load(), lineno=301, col_offset=31, end_lineno=301, end_col_offset=40), slice=Constant(value=0, lineno=301, col_offset=41, end_lineno=301, end_col_offset=42), ctx=Load(), lineno=301, col_offset=31, end_lineno=301, end_col_offset=43)], lineno=301, col_offset=11, end_lineno=301, end_col_offset=43), body=[Assign(targets=[Name(id='msg', ctx=Store(), lineno=302, col_offset=12, end_lineno=302, end_col_offset=15)], value=Constant(value='vectors and chunk_ids must have the same length', lineno=302, col_offset=18, end_lineno=302, end_col_offset=67), lineno=302, col_offset=12, end_lineno=302, end_col_offset=67), Raise(exc=Call(func=Name(id='ValueError', ctx=Load(), lineno=303, col_offset=18, end_lineno=303, end_col_offset=28), args=[Name(id='msg', ctx=Load(), lineno=303, col_offset=29, end_lineno=303, end_col_offset=32)], lineno=303, col_offset=18, end_lineno=303, end_col_offset=33), lineno=303, col_offset=12, end_lineno=303, end_col_offset=33)], lineno=301, col_offset=8, end_lineno=303, end_col_offset=33), If(test=Compare(left=Subscript(value=Attribute(value=Name(id='vectors', ctx=Load(), lineno=304, col_offset=11, end_lineno=304, end_col_offset=18), attr='shape', ctx=Load(), lineno=304, col_offset=11, end_lineno=304, end_col_offset=24), slice=Constant(value=0, lineno=304, col_offset=25, end_lineno=304, end_col_offset=26), ctx=Load(), lineno=304, col_offset=11, end_lineno=304, end_col_offset=27), ops=[Eq()], comparators=[Constant(value=0, lineno=304, col_offset=31, end_lineno=304, end_col_offset=32)], lineno=304, col_offset=11, end_lineno=304, end_col_offset=32), body=[Return(lineno=305, col_offset=12, end_lineno=305, end_col_offset=18)], lineno=304, col_offset=8, end_lineno=305, end_col_offset=18), Assign(targets=[Name(id='faiss_module', ctx=Store(), lineno=307, col_offset=8, end_lineno=307, end_col_offset=20)], value=BoolOp(op=Or(), values=[Attribute(value=Name(id='self', ctx=Load(), lineno=307, col_offset=23, end_lineno=307, end_col_offset=27), attr='_faiss_module', ctx=Load(), lineno=307, col_offset=23, end_lineno=307, end_col_offset=41), Call(func=Attribute(value=Name(id='importlib', ctx=Load(), lineno=307, col_offset=45, end_lineno=307, end_col_offset=54), attr='import_module', ctx=Load(), lineno=307, col_offset=45, end_lineno=307, end_col_offset=68), args=[Constant(value='faiss', lineno=307, col_offset=69, end_lineno=307, end_col_offset=76)], lineno=307, col_offset=45, end_lineno=307, end_col_offset=77)], lineno=307, col_offset=23, end_lineno=307, end_col_offset=77), lineno=307, col_offset=8, end_lineno=307, end_col_offset=77), Assign(targets=[Name(id='vectors32', ctx=Store(), lineno=309, col_offset=8, end_lineno=309, end_col_offset=17)], value=Call(func=Attribute(value=Name(id='np', ctx=Load(), lineno=309, col_offset=20, end_lineno=309, end_col_offset=22), attr='ascontiguousarray', ctx=Load(), lineno=309, col_offset=20, end_lineno=309, end_col_offset=40), args=[Name(id='vectors', ctx=Load(), lineno=309, col_offset=41, end_lineno=309, end_col_offset=48)], keywords=[keyword(arg='dtype', value=Attribute(value=Name(id='np', ctx=Load(), lineno=309, col_offset=56, end_lineno=309, end_col_offset=58), attr='float32', ctx=Load(), lineno=309, col_offset=56, end_lineno=309, end_col_offset=66), lineno=309, col_offset=50, end_lineno=309, end_col_offset=66)], lineno=309, col_offset=20, end_lineno=309, end_col_offset=67), lineno=309, col_offset=8, end_lineno=309, end_col_offset=67), Expr(value=Call(func=Attribute(value=Name(id='faiss_module', ctx=Load(), lineno=310, col_offset=8, end_lineno=310, end_col_offset=20), attr='normalize_L2', ctx=Load(), lineno=310, col_offset=8, end_lineno=310, end_col_offset=33), args=[Name(id='vectors32', ctx=Load(), lineno=310, col_offset=34, end_lineno=310, end_col_offset=43)], lineno=310, col_offset=8, end_lineno=310, end_col_offset=44), lineno=310, col_offset=8, end_lineno=310, end_col_offset=44), Expr(value=Call(func=Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=311, col_offset=8, end_lineno=311, end_col_offset=12), attr='_secondary_cpu', ctx=Load(), lineno=311, col_offset=8, end_lineno=311, end_col_offset=27), attr='add_with_ids', ctx=Load(), lineno=311, col_offset=8, end_lineno=311, end_col_offset=40), args=[Name(id='vectors32', ctx=Load(), lineno=311, col_offset=41, end_lineno=311, end_col_offset=50), Name(id='ids', ctx=Load(), lineno=311, col_offset=52, end_lineno=311, end_col_offset=55)], lineno=311, col_offset=8, end_lineno=311, end_col_offset=56), lineno=311, col_offset=8, end_lineno=311, end_col_offset=56), Assign(targets=[Name(id='secondary_path', ctx=Store(), lineno=313, col_offset=8, end_lineno=313, end_col_offset=22)], value=BinOp(left=Attribute(value=Name(id='self', ctx=Load(), lineno=313, col_offset=25, end_lineno=313, end_col_offset=29), attr='_index_dir', ctx=Load(), lineno=313, col_offset=25, end_lineno=313, end_col_offset=40), op=Div(), right=Constant(value='secondary.faiss', lineno=313, col_offset=43, end_lineno=313, end_col_offset=60), lineno=313, col_offset=25, end_lineno=313, end_col_offset=60), lineno=313, col_offset=8, end_lineno=313, end_col_offset=60), Expr(value=Await(value=Call(func=Attribute(value=Name(id='asyncio', ctx=Load(), lineno=314, col_offset=14, end_lineno=314, end_col_offset=21), attr='to_thread', ctx=Load(), lineno=314, col_offset=14, end_lineno=314, end_col_offset=31), args=[Attribute(value=Name(id='faiss_module', ctx=Load(), lineno=314, col_offset=32, end_lineno=314, end_col_offset=44), attr='write_index', ctx=Load(), lineno=314, col_offset=32, end_lineno=314, end_col_offset=56), Attribute(value=Name(id='self', ctx=Load(), lineno=314, col_offset=58, end_lineno=314, end_col_offset=62), attr='_secondary_cpu', ctx=Load(), lineno=314, col_offset=58, end_lineno=314, end_col_offset=77), Call(func=Name(id='str', ctx=Load(), lineno=314, col_offset=79, end_lineno=314, end_col_offset=82), args=[Name(id='secondary_path', ctx=Load(), lineno=314, col_offset=83, end_lineno=314, end_col_offset=97)], lineno=314, col_offset=79, end_lineno=314, end_col_offset=98)], lineno=314, col_offset=14, end_lineno=314, end_col_offset=99), lineno=314, col_offset=8, end_lineno=314, end_col_offset=99), lineno=314, col_offset=8, end_lineno=314, end_col_offset=99), If(test=Attribute(value=Name(id='self', ctx=Load(), lineno=316, col_offset=11, end_lineno=316, end_col_offset=15), attr='_gpu_enabled', ctx=Load(), lineno=316, col_offset=11, end_lineno=316, end_col_offset=28), body=[If(test=Compare(left=Attribute(value=Name(id='self', ctx=Load(), lineno=317, col_offset=15, end_lineno=317, end_col_offset=19), attr='_gpu_resources', ctx=Load(), lineno=317, col_offset=15, end_lineno=317, end_col_offset=34), ops=[Is()], comparators=[Constant(value=None, lineno=317, col_offset=38, end_lineno=317, end_col_offset=42)], lineno=317, col_offset=15, end_lineno=317, end_col_offset=42), body=[Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=318, col_offset=16, end_lineno=318, end_col_offset=20), attr='_gpu_enabled', ctx=Store(), lineno=318, col_offset=16, end_lineno=318, end_col_offset=33)], value=Constant(value=False, lineno=318, col_offset=36, end_lineno=318, end_col_offset=41), lineno=318, col_offset=16, end_lineno=318, end_col_offset=41), Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=319, col_offset=16, end_lineno=319, end_col_offset=20), attr='_secondary_gpu', ctx=Store(), lineno=319, col_offset=16, end_lineno=319, end_col_offset=35)], value=Constant(value=None, lineno=319, col_offset=38, end_lineno=319, end_col_offset=42), lineno=319, col_offset=16, end_lineno=319, end_col_offset=42), Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=320, col_offset=16, end_lineno=320, end_col_offset=20), attr='_primary_gpu', ctx=Store(), lineno=320, col_offset=16, end_lineno=320, end_col_offset=33)], value=Constant(value=None, lineno=320, col_offset=36, end_lineno=320, end_col_offset=40), lineno=320, col_offset=16, end_lineno=320, end_col_offset=40), Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=321, col_offset=16, end_lineno=321, end_col_offset=20), attr='_gpu_disabled_reason', ctx=Store(), lineno=321, col_offset=16, end_lineno=321, end_col_offset=41)], value=Constant(value='GPU resources unavailable during incremental add', lineno=321, col_offset=44, end_lineno=321, end_col_offset=94), lineno=321, col_offset=16, end_lineno=321, end_col_offset=94), Expr(value=Call(func=Attribute(value=Name(id='LOGGER', ctx=Load(), lineno=322, col_offset=16, end_lineno=322, end_col_offset=22), attr='warning', ctx=Load(), lineno=322, col_offset=16, end_lineno=322, end_col_offset=30), args=[Constant(value='faiss_gpu_incremental_disabled', lineno=323, col_offset=20, end_lineno=323, end_col_offset=52)], keywords=[keyword(arg='extra', value=Dict(keys=[Constant(value='reason', lineno=324, col_offset=27, end_lineno=324, end_col_offset=35)], values=[Attribute(value=Name(id='self', ctx=Load(), lineno=324, col_offset=37, end_lineno=324, end_col_offset=41), attr='_gpu_disabled_reason', ctx=Load(), lineno=324, col_offset=37, end_lineno=324, end_col_offset=62)], lineno=324, col_offset=26, end_lineno=324, end_col_offset=63), lineno=324, col_offset=20, end_lineno=324, end_col_offset=63)], lineno=322, col_offset=16, end_lineno=325, end_col_offset=17), lineno=322, col_offset=16, end_lineno=325, end_col_offset=17)], orelse=[Try(body=[Assign(targets=[Name(id='cloner_options', ctx=Store(), lineno=328, col_offset=20, end_lineno=328, end_col_offset=34)], value=Call(func=Attribute(value=Name(id='self', ctx=Load(), lineno=328, col_offset=37, end_lineno=328, end_col_offset=41), attr='_build_gpu_cloner_options', ctx=Load(), lineno=328, col_offset=37, end_lineno=328, end_col_offset=67), args=[Name(id='faiss_module', ctx=Load(), lineno=328, col_offset=68, end_lineno=328, end_col_offset=80)], lineno=328, col_offset=37, end_lineno=328, end_col_offset=81), lineno=328, col_offset=20, end_lineno=328, end_col_offset=81), Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=329, col_offset=20, end_lineno=329, end_col_offset=24), attr='_secondary_gpu', ctx=Store(), lineno=329, col_offset=20, end_lineno=329, end_col_offset=39)], value=Call(func=Attribute(value=Name(id='self', ctx=Load(), lineno=329, col_offset=42, end_lineno=329, end_col_offset=46), attr='_clone_index_to_gpu', ctx=Load(), lineno=329, col_offset=42, end_lineno=329, end_col_offset=66), args=[Name(id='faiss_module', ctx=Load(), lineno=330, col_offset=24, end_lineno=330, end_col_offset=36), Attribute(value=Name(id='self', ctx=Load(), lineno=331, col_offset=24, end_lineno=331, end_col_offset=28), attr='_gpu_resources', ctx=Load(), lineno=331, col_offset=24, end_lineno=331, end_col_offset=43), Attribute(value=Name(id='self', ctx=Load(), lineno=332, col_offset=24, end_lineno=332, end_col_offset=28), attr='_secondary_cpu', ctx=Load(), lineno=332, col_offset=24, end_lineno=332, end_col_offset=43), Name(id='cloner_options', ctx=Load(), lineno=333, col_offset=24, end_lineno=333, end_col_offset=38)], lineno=329, col_offset=42, end_lineno=334, end_col_offset=21), lineno=329, col_offset=20, end_lineno=334, end_col_offset=21)], handlers=[ExceptHandler(type=Tuple(elts=[Name(id='AttributeError', ctx=Load(), lineno=335, col_offset=24, end_lineno=335, end_col_offset=38), Name(id='RuntimeError', ctx=Load(), lineno=335, col_offset=40, end_lineno=335, end_col_offset=52)], ctx=Load(), lineno=335, col_offset=23, end_lineno=335, end_col_offset=53), name='exc', body=[Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=336, col_offset=20, end_lineno=336, end_col_offset=24), attr='_secondary_gpu', ctx=Store(), lineno=336, col_offset=20, end_lineno=336, end_col_offset=39)], value=Constant(value=None, lineno=336, col_offset=42, end_lineno=336, end_col_offset=46), lineno=336, col_offset=20, end_lineno=336, end_col_offset=46), Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=337, col_offset=20, end_lineno=337, end_col_offset=24), attr='_primary_gpu', ctx=Store(), lineno=337, col_offset=20, end_lineno=337, end_col_offset=37)], value=Constant(value=None, lineno=337, col_offset=40, end_lineno=337, end_col_offset=44), lineno=337, col_offset=20, end_lineno=337, end_col_offset=44), Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=338, col_offset=20, end_lineno=338, end_col_offset=24), attr='_gpu_resources', ctx=Store(), lineno=338, col_offset=20, end_lineno=338, end_col_offset=39)], value=Constant(value=None, lineno=338, col_offset=42, end_lineno=338, end_col_offset=46), lineno=338, col_offset=20, end_lineno=338, end_col_offset=46), Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=339, col_offset=20, end_lineno=339, end_col_offset=24), attr='_gpu_enabled', ctx=Store(), lineno=339, col_offset=20, end_lineno=339, end_col_offset=37)], value=Constant(value=False, lineno=339, col_offset=40, end_lineno=339, end_col_offset=45), lineno=339, col_offset=20, end_lineno=339, end_col_offset=45), Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=340, col_offset=20, end_lineno=340, end_col_offset=24), attr='_gpu_disabled_reason', ctx=Store(), lineno=340, col_offset=20, end_lineno=340, end_col_offset=45)], value=JoinedStr(values=[Constant(value='Secondary GPU clone failed: ', lineno=340, col_offset=50, end_lineno=340, end_col_offset=78), FormattedValue(value=Name(id='exc', ctx=Load(), lineno=340, col_offset=79, end_lineno=340, end_col_offset=82), conversion=-1, lineno=340, col_offset=78, end_lineno=340, end_col_offset=83)], lineno=340, col_offset=48, end_lineno=340, end_col_offset=84), lineno=340, col_offset=20, end_lineno=340, end_col_offset=84), Expr(value=Call(func=Attribute(value=Name(id='LOGGER', ctx=Load(), lineno=341, col_offset=20, end_lineno=341, end_col_offset=26), attr='warning', ctx=Load(), lineno=341, col_offset=20, end_lineno=341, end_col_offset=34), args=[Constant(value='faiss_gpu_incremental_clone_failed', lineno=342, col_offset=24, end_lineno=342, end_col_offset=60)], keywords=[keyword(arg='extra', value=Dict(keys=[Constant(value='error', lineno=343, col_offset=31, end_lineno=343, end_col_offset=38)], values=[Call(func=Name(id='str', ctx=Load(), lineno=343, col_offset=40, end_lineno=343, end_col_offset=43), args=[Name(id='exc', ctx=Load(), lineno=343, col_offset=44, end_lineno=343, end_col_offset=47)], lineno=343, col_offset=40, end_lineno=343, end_col_offset=48)], lineno=343, col_offset=30, end_lineno=343, end_col_offset=49), lineno=343, col_offset=24, end_lineno=343, end_col_offset=49)], lineno=341, col_offset=20, end_lineno=344, end_col_offset=21), lineno=341, col_offset=20, end_lineno=344, end_col_offset=21)], lineno=335, col_offset=16, end_lineno=344, end_col_offset=21)], lineno=327, col_offset=16, end_lineno=344, end_col_offset=21)], lineno=317, col_offset=12, end_lineno=344, end_col_offset=21)], lineno=316, col_offset=8, end_lineno=344, end_col_offset=21), Assign(targets=[Name(id='secondary_total', ctx=Store(), lineno=346, col_offset=8, end_lineno=346, end_col_offset=23)], value=Call(func=Name(id='int', ctx=Load(), lineno=346, col_offset=26, end_lineno=346, end_col_offset=29), args=[Call(func=Name(id='getattr', ctx=Load(), lineno=346, col_offset=30, end_lineno=346, end_col_offset=37), args=[Attribute(value=Name(id='self', ctx=Load(), lineno=346, col_offset=38, end_lineno=346, end_col_offset=42), attr='_secondary_cpu', ctx=Load(), lineno=346, col_offset=38, end_lineno=346, end_col_offset=57), Constant(value='ntotal', lineno=346, col_offset=59, end_lineno=346, end_col_offset=67), Constant(value=0, lineno=346, col_offset=69, end_lineno=346, end_col_offset=70)], lineno=346, col_offset=30, end_lineno=346, end_col_offset=71)], lineno=346, col_offset=26, end_lineno=346, end_col_offset=72), lineno=346, col_offset=8, end_lineno=346, end_col_offset=72), Expr(value=Call(func=Attribute(value=Name(id='LOGGER', ctx=Load(), lineno=347, col_offset=8, end_lineno=347, end_col_offset=14), attr='info', ctx=Load(), lineno=347, col_offset=8, end_lineno=347, end_col_offset=19), args=[Constant(value='faiss_incremental_add', lineno=348, col_offset=12, end_lineno=348, end_col_offset=35)], keywords=[keyword(arg='extra', value=Dict(keys=[Constant(value='added', lineno=350, col_offset=16, end_lineno=350, end_col_offset=23), Constant(value='secondary_total', lineno=351, col_offset=16, end_lineno=351, end_col_offset=33), Constant(value='index_dir', lineno=352, col_offset=16, end_lineno=352, end_col_offset=27)], values=[Call(func=Name(id='int', ctx=Load(), lineno=350, col_offset=25, end_lineno=350, end_col_offset=28), args=[Attribute(value=Name(id='ids', ctx=Load(), lineno=350, col_offset=29, end_lineno=350, end_col_offset=32), attr='size', ctx=Load(), lineno=350, col_offset=29, end_lineno=350, end_col_offset=37)], lineno=350, col_offset=25, end_lineno=350, end_col_offset=38), Name(id='secondary_total', ctx=Load(), lineno=351, col_offset=35, end_lineno=351, end_col_offset=50), Call(func=Name(id='str', ctx=Load(), lineno=352, col_offset=29, end_lineno=352, end_col_offset=32), args=[Attribute(value=Name(id='self', ctx=Load(), lineno=352, col_offset=33, end_lineno=352, end_col_offset=37), attr='_index_dir', ctx=Load(), lineno=352, col_offset=33, end_lineno=352, end_col_offset=48)], lineno=352, col_offset=29, end_lineno=352, end_col_offset=49)], lineno=349, col_offset=18, end_lineno=353, end_col_offset=13), lineno=349, col_offset=12, end_lineno=353, end_col_offset=13)], lineno=347, col_offset=8, end_lineno=354, end_col_offset=9), lineno=347, col_offset=8, end_lineno=354, end_col_offset=9)], returns=Constant(value=None, lineno=265, col_offset=83, end_lineno=265, end_col_offset=87), lineno=265, col_offset=4, end_lineno=354, end_col_offset=9), FunctionDef(name='needs_compaction', args=arguments(args=[arg(arg='self', lineno=356, col_offset=25, end_lineno=356, end_col_offset=29)]), body=[Expr(value=Constant(value='Return ``True`` when the secondary index exceeds the compaction threshold.\n\n        Returns\n        -------\n        bool\n            ``True`` when ``secondary.ntotal / primary.ntotal`` is greater than the\n            configured compaction threshold; otherwise ``False``.\n        ', lineno=357, col_offset=8, end_lineno=364, end_col_offset=11), lineno=357, col_offset=8, end_lineno=364, end_col_offset=11), If(test=BoolOp(op=Or(), values=[Compare(left=Attribute(value=Name(id='self', ctx=Load(), lineno=365, col_offset=11, end_lineno=365, end_col_offset=15), attr='_primary_cpu', ctx=Load(), lineno=365, col_offset=11, end_lineno=365, end_col_offset=28), ops=[Is()], comparators=[Constant(value=None, lineno=365, col_offset=32, end_lineno=365, end_col_offset=36)], lineno=365, col_offset=11, end_lineno=365, end_col_offset=36), Compare(left=Attribute(value=Name(id='self', ctx=Load(), lineno=365, col_offset=40, end_lineno=365, end_col_offset=44), attr='_secondary_cpu', ctx=Load(), lineno=365, col_offset=40, end_lineno=365, end_col_offset=59), ops=[Is()], comparators=[Constant(value=None, lineno=365, col_offset=63, end_lineno=365, end_col_offset=67)], lineno=365, col_offset=40, end_lineno=365, end_col_offset=67)], lineno=365, col_offset=11, end_lineno=365, end_col_offset=67), body=[Return(value=Constant(value=False, lineno=366, col_offset=19, end_lineno=366, end_col_offset=24), lineno=366, col_offset=12, end_lineno=366, end_col_offset=24)], lineno=365, col_offset=8, end_lineno=366, end_col_offset=24), Assign(targets=[Name(id='primary_total', ctx=Store(), lineno=368, col_offset=8, end_lineno=368, end_col_offset=21)], value=Call(func=Name(id='int', ctx=Load(), lineno=368, col_offset=24, end_lineno=368, end_col_offset=27), args=[Call(func=Name(id='getattr', ctx=Load(), lineno=368, col_offset=28, end_lineno=368, end_col_offset=35), args=[Attribute(value=Name(id='self', ctx=Load(), lineno=368, col_offset=36, end_lineno=368, end_col_offset=40), attr='_primary_cpu', ctx=Load(), lineno=368, col_offset=36, end_lineno=368, end_col_offset=53), Constant(value='ntotal', lineno=368, col_offset=55, end_lineno=368, end_col_offset=63), Constant(value=0, lineno=368, col_offset=65, end_lineno=368, end_col_offset=66)], lineno=368, col_offset=28, end_lineno=368, end_col_offset=67)], lineno=368, col_offset=24, end_lineno=368, end_col_offset=68), lineno=368, col_offset=8, end_lineno=368, end_col_offset=68), Assign(targets=[Name(id='secondary_total', ctx=Store(), lineno=369, col_offset=8, end_lineno=369, end_col_offset=23)], value=Call(func=Name(id='int', ctx=Load(), lineno=369, col_offset=26, end_lineno=369, end_col_offset=29), args=[Call(func=Name(id='getattr', ctx=Load(), lineno=369, col_offset=30, end_lineno=369, end_col_offset=37), args=[Attribute(value=Name(id='self', ctx=Load(), lineno=369, col_offset=38, end_lineno=369, end_col_offset=42), attr='_secondary_cpu', ctx=Load(), lineno=369, col_offset=38, end_lineno=369, end_col_offset=57), Constant(value='ntotal', lineno=369, col_offset=59, end_lineno=369, end_col_offset=67), Constant(value=0, lineno=369, col_offset=69, end_lineno=369, end_col_offset=70)], lineno=369, col_offset=30, end_lineno=369, end_col_offset=71)], lineno=369, col_offset=26, end_lineno=369, end_col_offset=72), lineno=369, col_offset=8, end_lineno=369, end_col_offset=72), If(test=Compare(left=Name(id='secondary_total', ctx=Load(), lineno=370, col_offset=11, end_lineno=370, end_col_offset=26), ops=[Eq()], comparators=[Constant(value=0, lineno=370, col_offset=30, end_lineno=370, end_col_offset=31)], lineno=370, col_offset=11, end_lineno=370, end_col_offset=31), body=[Return(value=Constant(value=False, lineno=371, col_offset=19, end_lineno=371, end_col_offset=24), lineno=371, col_offset=12, end_lineno=371, end_col_offset=24)], lineno=370, col_offset=8, end_lineno=371, end_col_offset=24), Assign(targets=[Name(id='threshold', ctx=Store(), lineno=373, col_offset=8, end_lineno=373, end_col_offset=17)], value=Call(func=Name(id='float', ctx=Load(), lineno=373, col_offset=20, end_lineno=373, end_col_offset=25), args=[Call(func=Name(id='getattr', ctx=Load(), lineno=373, col_offset=26, end_lineno=373, end_col_offset=33), args=[Attribute(value=Name(id='self', ctx=Load(), lineno=373, col_offset=34, end_lineno=373, end_col_offset=38), attr='_settings', ctx=Load(), lineno=373, col_offset=34, end_lineno=373, end_col_offset=48), Constant(value='compaction_threshold', lineno=373, col_offset=50, end_lineno=373, end_col_offset=72), Constant(value=0.05, lineno=373, col_offset=74, end_lineno=373, end_col_offset=78)], lineno=373, col_offset=26, end_lineno=373, end_col_offset=79)], lineno=373, col_offset=20, end_lineno=373, end_col_offset=80), lineno=373, col_offset=8, end_lineno=373, end_col_offset=80), Assign(targets=[Name(id='denominator', ctx=Store(), lineno=374, col_offset=8, end_lineno=374, end_col_offset=19)], value=Call(func=Name(id='max', ctx=Load(), lineno=374, col_offset=22, end_lineno=374, end_col_offset=25), args=[Name(id='primary_total', ctx=Load(), lineno=374, col_offset=26, end_lineno=374, end_col_offset=39), Constant(value=1, lineno=374, col_offset=41, end_lineno=374, end_col_offset=42)], lineno=374, col_offset=22, end_lineno=374, end_col_offset=43), lineno=374, col_offset=8, end_lineno=374, end_col_offset=43), Assign(targets=[Name(id='ratio', ctx=Store(), lineno=375, col_offset=8, end_lineno=375, end_col_offset=13)], value=BinOp(left=Name(id='secondary_total', ctx=Load(), lineno=375, col_offset=16, end_lineno=375, end_col_offset=31), op=Div(), right=Name(id='denominator', ctx=Load(), lineno=375, col_offset=34, end_lineno=375, end_col_offset=45), lineno=375, col_offset=16, end_lineno=375, end_col_offset=45), lineno=375, col_offset=8, end_lineno=375, end_col_offset=45), Return(value=Compare(left=Name(id='ratio', ctx=Load(), lineno=376, col_offset=15, end_lineno=376, end_col_offset=20), ops=[Gt()], comparators=[Name(id='threshold', ctx=Load(), lineno=376, col_offset=23, end_lineno=376, end_col_offset=32)], lineno=376, col_offset=15, end_lineno=376, end_col_offset=32), lineno=376, col_offset=8, end_lineno=376, end_col_offset=32)], returns=Name(id='bool', ctx=Load(), lineno=356, col_offset=34, end_lineno=356, end_col_offset=38), lineno=356, col_offset=4, end_lineno=376, end_col_offset=32), FunctionDef(name='_reset_gpu_state', args=arguments(args=[arg(arg='self', lineno=378, col_offset=25, end_lineno=378, end_col_offset=29)]), body=[Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=379, col_offset=8, end_lineno=379, end_col_offset=12), attr='_primary_gpu', ctx=Store(), lineno=379, col_offset=8, end_lineno=379, end_col_offset=25)], value=Constant(value=None, lineno=379, col_offset=28, end_lineno=379, end_col_offset=32), lineno=379, col_offset=8, end_lineno=379, end_col_offset=32), Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=380, col_offset=8, end_lineno=380, end_col_offset=12), attr='_secondary_gpu', ctx=Store(), lineno=380, col_offset=8, end_lineno=380, end_col_offset=27)], value=Constant(value=None, lineno=380, col_offset=30, end_lineno=380, end_col_offset=34), lineno=380, col_offset=8, end_lineno=380, end_col_offset=34), Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=381, col_offset=8, end_lineno=381, end_col_offset=12), attr='_gpu_resources', ctx=Store(), lineno=381, col_offset=8, end_lineno=381, end_col_offset=27)], value=Constant(value=None, lineno=381, col_offset=30, end_lineno=381, end_col_offset=34), lineno=381, col_offset=8, end_lineno=381, end_col_offset=34), Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=382, col_offset=8, end_lineno=382, end_col_offset=12), attr='_gpu_enabled', ctx=Store(), lineno=382, col_offset=8, end_lineno=382, end_col_offset=25)], value=Constant(value=False, lineno=382, col_offset=28, end_lineno=382, end_col_offset=33), lineno=382, col_offset=8, end_lineno=382, end_col_offset=33), Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=383, col_offset=8, end_lineno=383, end_col_offset=12), attr='_gpu_disabled_reason', ctx=Store(), lineno=383, col_offset=8, end_lineno=383, end_col_offset=33)], value=Constant(value=None, lineno=383, col_offset=36, end_lineno=383, end_col_offset=40), lineno=383, col_offset=8, end_lineno=383, end_col_offset=40)], returns=Constant(value=None, lineno=378, col_offset=34, end_lineno=378, end_col_offset=38), lineno=378, col_offset=4, end_lineno=383, end_col_offset=40), FunctionDef(name='_import_faiss', args=arguments(args=[arg(arg='self', lineno=385, col_offset=22, end_lineno=385, end_col_offset=26)]), body=[Try(body=[Return(value=Tuple(elts=[Call(func=Attribute(value=Name(id='importlib', ctx=Load(), lineno=387, col_offset=19, end_lineno=387, end_col_offset=28), attr='import_module', ctx=Load(), lineno=387, col_offset=19, end_lineno=387, end_col_offset=42), args=[Constant(value='faiss', lineno=387, col_offset=43, end_lineno=387, end_col_offset=50)], lineno=387, col_offset=19, end_lineno=387, end_col_offset=51), Constant(value=None, lineno=387, col_offset=53, end_lineno=387, end_col_offset=57)], ctx=Load(), lineno=387, col_offset=19, end_lineno=387, end_col_offset=57), lineno=387, col_offset=12, end_lineno=387, end_col_offset=57)], handlers=[ExceptHandler(type=Name(id='ImportError', ctx=Load(), lineno=388, col_offset=15, end_lineno=388, end_col_offset=26), name='exc', body=[Assign(targets=[Name(id='reason', ctx=Store(), lineno=389, col_offset=12, end_lineno=389, end_col_offset=18)], value=Constant(value='FAISS library not installed', lineno=389, col_offset=21, end_lineno=389, end_col_offset=50), lineno=389, col_offset=12, end_lineno=389, end_col_offset=50), Expr(value=Call(func=Attribute(value=Name(id='LOGGER', ctx=Load(), lineno=390, col_offset=12, end_lineno=390, end_col_offset=18), attr='exception', ctx=Load(), lineno=390, col_offset=12, end_lineno=390, end_col_offset=28), args=[Constant(value='faiss_import_failed', lineno=391, col_offset=16, end_lineno=391, end_col_offset=37)], keywords=[keyword(arg='extra', value=Dict(keys=[Constant(value='error', lineno=392, col_offset=23, end_lineno=392, end_col_offset=30), Constant(value='index_dir', lineno=392, col_offset=42, end_lineno=392, end_col_offset=53)], values=[Call(func=Name(id='str', ctx=Load(), lineno=392, col_offset=32, end_lineno=392, end_col_offset=35), args=[Name(id='exc', ctx=Load(), lineno=392, col_offset=36, end_lineno=392, end_col_offset=39)], lineno=392, col_offset=32, end_lineno=392, end_col_offset=40), Call(func=Name(id='str', ctx=Load(), lineno=392, col_offset=55, end_lineno=392, end_col_offset=58), args=[Attribute(value=Name(id='self', ctx=Load(), lineno=392, col_offset=59, end_lineno=392, end_col_offset=63), attr='_index_dir', ctx=Load(), lineno=392, col_offset=59, end_lineno=392, end_col_offset=74)], lineno=392, col_offset=55, end_lineno=392, end_col_offset=75)], lineno=392, col_offset=22, end_lineno=392, end_col_offset=76), lineno=392, col_offset=16, end_lineno=392, end_col_offset=76)], lineno=390, col_offset=12, end_lineno=393, end_col_offset=13), lineno=390, col_offset=12, end_lineno=393, end_col_offset=13), Return(value=Tuple(elts=[Constant(value=None, lineno=394, col_offset=19, end_lineno=394, end_col_offset=23), Name(id='reason', ctx=Load(), lineno=394, col_offset=25, end_lineno=394, end_col_offset=31)], ctx=Load(), lineno=394, col_offset=19, end_lineno=394, end_col_offset=31), lineno=394, col_offset=12, end_lineno=394, end_col_offset=31)], lineno=388, col_offset=8, end_lineno=394, end_col_offset=31)], lineno=386, col_offset=8, end_lineno=394, end_col_offset=31)], returns=Subscript(value=Name(id='tuple', ctx=Load(), lineno=385, col_offset=31, end_lineno=385, end_col_offset=36), slice=Tuple(elts=[BinOp(left=Name(id='ModuleType', ctx=Load(), lineno=385, col_offset=37, end_lineno=385, end_col_offset=47), op=BitOr(), right=Constant(value=None, lineno=385, col_offset=50, end_lineno=385, end_col_offset=54), lineno=385, col_offset=37, end_lineno=385, end_col_offset=54), BinOp(left=Name(id='str', ctx=Load(), lineno=385, col_offset=56, end_lineno=385, end_col_offset=59), op=BitOr(), right=Constant(value=None, lineno=385, col_offset=62, end_lineno=385, end_col_offset=66), lineno=385, col_offset=56, end_lineno=385, end_col_offset=66)], ctx=Load(), lineno=385, col_offset=37, end_lineno=385, end_col_offset=66), ctx=Load(), lineno=385, col_offset=31, end_lineno=385, end_col_offset=67), lineno=385, col_offset=4, end_lineno=394, end_col_offset=31), AsyncFunctionDef(name='_load_primary_index', args=arguments(args=[arg(arg='self', lineno=397, col_offset=8, end_lineno=397, end_col_offset=12), arg(arg='faiss_module', annotation=Name(id='ModuleType', ctx=Load(), lineno=397, col_offset=28, end_lineno=397, end_col_offset=38), lineno=397, col_offset=14, end_lineno=397, end_col_offset=38)]), body=[Assign(targets=[Name(id='primary_path', ctx=Store(), lineno=399, col_offset=8, end_lineno=399, end_col_offset=20)], value=BinOp(left=Attribute(value=Name(id='self', ctx=Load(), lineno=399, col_offset=23, end_lineno=399, end_col_offset=27), attr='_index_dir', ctx=Load(), lineno=399, col_offset=23, end_lineno=399, end_col_offset=38), op=Div(), right=Constant(value='primary.faiss', lineno=399, col_offset=41, end_lineno=399, end_col_offset=56), lineno=399, col_offset=23, end_lineno=399, end_col_offset=56), lineno=399, col_offset=8, end_lineno=399, end_col_offset=56), If(test=UnaryOp(op=Not(), operand=Call(func=Attribute(value=Name(id='primary_path', ctx=Load(), lineno=400, col_offset=15, end_lineno=400, end_col_offset=27), attr='exists', ctx=Load(), lineno=400, col_offset=15, end_lineno=400, end_col_offset=34), lineno=400, col_offset=15, end_lineno=400, end_col_offset=36), lineno=400, col_offset=11, end_lineno=400, end_col_offset=36), body=[Assign(targets=[Name(id='reason', ctx=Store(), lineno=401, col_offset=12, end_lineno=401, end_col_offset=18)], value=Constant(value='Primary index not found', lineno=401, col_offset=21, end_lineno=401, end_col_offset=46), lineno=401, col_offset=12, end_lineno=401, end_col_offset=46), Expr(value=Call(func=Attribute(value=Name(id='LOGGER', ctx=Load(), lineno=402, col_offset=12, end_lineno=402, end_col_offset=18), attr='error', ctx=Load(), lineno=402, col_offset=12, end_lineno=402, end_col_offset=24), args=[Constant(value='faiss_primary_missing', lineno=403, col_offset=16, end_lineno=403, end_col_offset=39)], keywords=[keyword(arg='extra', value=Dict(keys=[Constant(value='path', lineno=404, col_offset=23, end_lineno=404, end_col_offset=29)], values=[Call(func=Name(id='str', ctx=Load(), lineno=404, col_offset=31, end_lineno=404, end_col_offset=34), args=[Name(id='primary_path', ctx=Load(), lineno=404, col_offset=35, end_lineno=404, end_col_offset=47)], lineno=404, col_offset=31, end_lineno=404, end_col_offset=48)], lineno=404, col_offset=22, end_lineno=404, end_col_offset=49), lineno=404, col_offset=16, end_lineno=404, end_col_offset=49)], lineno=402, col_offset=12, end_lineno=405, end_col_offset=13), lineno=402, col_offset=12, end_lineno=405, end_col_offset=13), Return(value=Tuple(elts=[Constant(value=None, lineno=406, col_offset=19, end_lineno=406, end_col_offset=23), Name(id='reason', ctx=Load(), lineno=406, col_offset=25, end_lineno=406, end_col_offset=31)], ctx=Load(), lineno=406, col_offset=19, end_lineno=406, end_col_offset=31), lineno=406, col_offset=12, end_lineno=406, end_col_offset=31)], lineno=400, col_offset=8, end_lineno=406, end_col_offset=31), Try(body=[Assign(targets=[Name(id='primary_cpu', ctx=Store(), lineno=409, col_offset=12, end_lineno=409, end_col_offset=23)], value=Await(value=Call(func=Attribute(value=Name(id='asyncio', ctx=Load(), lineno=409, col_offset=32, end_lineno=409, end_col_offset=39), attr='to_thread', ctx=Load(), lineno=409, col_offset=32, end_lineno=409, end_col_offset=49), args=[Attribute(value=Name(id='faiss_module', ctx=Load(), lineno=409, col_offset=50, end_lineno=409, end_col_offset=62), attr='read_index', ctx=Load(), lineno=409, col_offset=50, end_lineno=409, end_col_offset=73), Call(func=Name(id='str', ctx=Load(), lineno=409, col_offset=75, end_lineno=409, end_col_offset=78), args=[Name(id='primary_path', ctx=Load(), lineno=409, col_offset=79, end_lineno=409, end_col_offset=91)], lineno=409, col_offset=75, end_lineno=409, end_col_offset=92)], lineno=409, col_offset=32, end_lineno=409, end_col_offset=93), lineno=409, col_offset=26, end_lineno=409, end_col_offset=93), lineno=409, col_offset=12, end_lineno=409, end_col_offset=93)], handlers=[ExceptHandler(type=Name(id='RuntimeError', ctx=Load(), lineno=410, col_offset=15, end_lineno=410, end_col_offset=27), name='exc', body=[Assign(targets=[Name(id='reason', ctx=Store(), lineno=411, col_offset=12, end_lineno=411, end_col_offset=18)], value=JoinedStr(values=[Constant(value='Failed to load primary index: ', lineno=411, col_offset=23, end_lineno=411, end_col_offset=53), FormattedValue(value=Name(id='exc', ctx=Load(), lineno=411, col_offset=54, end_lineno=411, end_col_offset=57), conversion=-1, lineno=411, col_offset=53, end_lineno=411, end_col_offset=58)], lineno=411, col_offset=21, end_lineno=411, end_col_offset=59), lineno=411, col_offset=12, end_lineno=411, end_col_offset=59), Expr(value=Call(func=Attribute(value=Name(id='LOGGER', ctx=Load(), lineno=412, col_offset=12, end_lineno=412, end_col_offset=18), attr='exception', ctx=Load(), lineno=412, col_offset=12, end_lineno=412, end_col_offset=28), args=[Constant(value='faiss_primary_load_failed', lineno=413, col_offset=16, end_lineno=413, end_col_offset=43)], keywords=[keyword(arg='extra', value=Dict(keys=[Constant(value='path', lineno=414, col_offset=23, end_lineno=414, end_col_offset=29), Constant(value='error', lineno=414, col_offset=50, end_lineno=414, end_col_offset=57)], values=[Call(func=Name(id='str', ctx=Load(), lineno=414, col_offset=31, end_lineno=414, end_col_offset=34), args=[Name(id='primary_path', ctx=Load(), lineno=414, col_offset=35, end_lineno=414, end_col_offset=47)], lineno=414, col_offset=31, end_lineno=414, end_col_offset=48), Call(func=Name(id='str', ctx=Load(), lineno=414, col_offset=59, end_lineno=414, end_col_offset=62), args=[Name(id='exc', ctx=Load(), lineno=414, col_offset=63, end_lineno=414, end_col_offset=66)], lineno=414, col_offset=59, end_lineno=414, end_col_offset=67)], lineno=414, col_offset=22, end_lineno=414, end_col_offset=68), lineno=414, col_offset=16, end_lineno=414, end_col_offset=68)], lineno=412, col_offset=12, end_lineno=415, end_col_offset=13), lineno=412, col_offset=12, end_lineno=415, end_col_offset=13), Return(value=Tuple(elts=[Constant(value=None, lineno=416, col_offset=19, end_lineno=416, end_col_offset=23), Name(id='reason', ctx=Load(), lineno=416, col_offset=25, end_lineno=416, end_col_offset=31)], ctx=Load(), lineno=416, col_offset=19, end_lineno=416, end_col_offset=31), lineno=416, col_offset=12, end_lineno=416, end_col_offset=31)], lineno=410, col_offset=8, end_lineno=416, end_col_offset=31)], lineno=408, col_offset=8, end_lineno=416, end_col_offset=31), Assign(targets=[Name(id='primary_dim', ctx=Store(), lineno=418, col_offset=8, end_lineno=418, end_col_offset=19)], value=Call(func=Name(id='getattr', ctx=Load(), lineno=418, col_offset=22, end_lineno=418, end_col_offset=29), args=[Name(id='primary_cpu', ctx=Load(), lineno=418, col_offset=30, end_lineno=418, end_col_offset=41), Constant(value='d', lineno=418, col_offset=43, end_lineno=418, end_col_offset=46), Constant(value=None, lineno=418, col_offset=48, end_lineno=418, end_col_offset=52)], lineno=418, col_offset=22, end_lineno=418, end_col_offset=53), lineno=418, col_offset=8, end_lineno=418, end_col_offset=53), If(test=Compare(left=Name(id='primary_dim', ctx=Load(), lineno=419, col_offset=11, end_lineno=419, end_col_offset=22), ops=[NotEq()], comparators=[Attribute(value=Name(id='self', ctx=Load(), lineno=419, col_offset=26, end_lineno=419, end_col_offset=30), attr='_vec_dim', ctx=Load(), lineno=419, col_offset=26, end_lineno=419, end_col_offset=39)], lineno=419, col_offset=11, end_lineno=419, end_col_offset=39), body=[Assign(targets=[Name(id='reason', ctx=Store(), lineno=420, col_offset=12, end_lineno=420, end_col_offset=18)], value=JoinedStr(values=[Constant(value='Dimension mismatch: index=', lineno=420, col_offset=23, end_lineno=420, end_col_offset=49), FormattedValue(value=Name(id='primary_dim', ctx=Load(), lineno=420, col_offset=50, end_lineno=420, end_col_offset=61), conversion=-1, lineno=420, col_offset=49, end_lineno=420, end_col_offset=62), Constant(value=', expected=', lineno=420, col_offset=62, end_lineno=420, end_col_offset=73), FormattedValue(value=Attribute(value=Name(id='self', ctx=Load(), lineno=420, col_offset=74, end_lineno=420, end_col_offset=78), attr='_vec_dim', ctx=Load(), lineno=420, col_offset=74, end_lineno=420, end_col_offset=87), conversion=-1, lineno=420, col_offset=73, end_lineno=420, end_col_offset=88)], lineno=420, col_offset=21, end_lineno=420, end_col_offset=89), lineno=420, col_offset=12, end_lineno=420, end_col_offset=89), Expr(value=Call(func=Attribute(value=Name(id='LOGGER', ctx=Load(), lineno=421, col_offset=12, end_lineno=421, end_col_offset=18), attr='error', ctx=Load(), lineno=421, col_offset=12, end_lineno=421, end_col_offset=24), args=[Constant(value='faiss_dimension_mismatch', lineno=422, col_offset=16, end_lineno=422, end_col_offset=42)], keywords=[keyword(arg='extra', value=Dict(keys=[Constant(value='path', lineno=424, col_offset=20, end_lineno=424, end_col_offset=26), Constant(value='index_dim', lineno=425, col_offset=20, end_lineno=425, end_col_offset=31), Constant(value='expected_dim', lineno=426, col_offset=20, end_lineno=426, end_col_offset=34)], values=[Call(func=Name(id='str', ctx=Load(), lineno=424, col_offset=28, end_lineno=424, end_col_offset=31), args=[Name(id='primary_path', ctx=Load(), lineno=424, col_offset=32, end_lineno=424, end_col_offset=44)], lineno=424, col_offset=28, end_lineno=424, end_col_offset=45), Name(id='primary_dim', ctx=Load(), lineno=425, col_offset=33, end_lineno=425, end_col_offset=44), Attribute(value=Name(id='self', ctx=Load(), lineno=426, col_offset=36, end_lineno=426, end_col_offset=40), attr='_vec_dim', ctx=Load(), lineno=426, col_offset=36, end_lineno=426, end_col_offset=49)], lineno=423, col_offset=22, end_lineno=427, end_col_offset=17), lineno=423, col_offset=16, end_lineno=427, end_col_offset=17)], lineno=421, col_offset=12, end_lineno=428, end_col_offset=13), lineno=421, col_offset=12, end_lineno=428, end_col_offset=13), Return(value=Tuple(elts=[Constant(value=None, lineno=429, col_offset=19, end_lineno=429, end_col_offset=23), Name(id='reason', ctx=Load(), lineno=429, col_offset=25, end_lineno=429, end_col_offset=31)], ctx=Load(), lineno=429, col_offset=19, end_lineno=429, end_col_offset=31), lineno=429, col_offset=12, end_lineno=429, end_col_offset=31)], lineno=419, col_offset=8, end_lineno=429, end_col_offset=31), Return(value=Tuple(elts=[Name(id='primary_cpu', ctx=Load(), lineno=431, col_offset=15, end_lineno=431, end_col_offset=26), Constant(value=None, lineno=431, col_offset=28, end_lineno=431, end_col_offset=32)], ctx=Load(), lineno=431, col_offset=15, end_lineno=431, end_col_offset=32), lineno=431, col_offset=8, end_lineno=431, end_col_offset=32)], returns=Subscript(value=Name(id='tuple', ctx=Load(), lineno=398, col_offset=9, end_lineno=398, end_col_offset=14), slice=Tuple(elts=[BinOp(left=Attribute(value=Name(id='faiss', ctx=Load(), lineno=398, col_offset=15, end_lineno=398, end_col_offset=20), attr='Index', ctx=Load(), lineno=398, col_offset=15, end_lineno=398, end_col_offset=26), op=BitOr(), right=Constant(value=None, lineno=398, col_offset=29, end_lineno=398, end_col_offset=33), lineno=398, col_offset=15, end_lineno=398, end_col_offset=33), BinOp(left=Name(id='str', ctx=Load(), lineno=398, col_offset=35, end_lineno=398, end_col_offset=38), op=BitOr(), right=Constant(value=None, lineno=398, col_offset=41, end_lineno=398, end_col_offset=45), lineno=398, col_offset=35, end_lineno=398, end_col_offset=45)], ctx=Load(), lineno=398, col_offset=15, end_lineno=398, end_col_offset=45), ctx=Load(), lineno=398, col_offset=9, end_lineno=398, end_col_offset=46), lineno=396, col_offset=4, end_lineno=431, end_col_offset=32), AsyncFunctionDef(name='_load_secondary_index', args=arguments(args=[arg(arg='self', lineno=433, col_offset=36, end_lineno=433, end_col_offset=40), arg(arg='faiss_module', annotation=Name(id='ModuleType', ctx=Load(), lineno=433, col_offset=56, end_lineno=433, end_col_offset=66), lineno=433, col_offset=42, end_lineno=433, end_col_offset=66)]), body=[Assign(targets=[Name(id='secondary_path', ctx=Store(), lineno=434, col_offset=8, end_lineno=434, end_col_offset=22)], value=BinOp(left=Attribute(value=Name(id='self', ctx=Load(), lineno=434, col_offset=25, end_lineno=434, end_col_offset=29), attr='_index_dir', ctx=Load(), lineno=434, col_offset=25, end_lineno=434, end_col_offset=40), op=Div(), right=Constant(value='secondary.faiss', lineno=434, col_offset=43, end_lineno=434, end_col_offset=60), lineno=434, col_offset=25, end_lineno=434, end_col_offset=60), lineno=434, col_offset=8, end_lineno=434, end_col_offset=60), If(test=Call(func=Attribute(value=Name(id='secondary_path', ctx=Load(), lineno=435, col_offset=11, end_lineno=435, end_col_offset=25), attr='exists', ctx=Load(), lineno=435, col_offset=11, end_lineno=435, end_col_offset=32), lineno=435, col_offset=11, end_lineno=435, end_col_offset=34), body=[Try(body=[Return(value=Await(value=Call(func=Attribute(value=Name(id='asyncio', ctx=Load(), lineno=437, col_offset=29, end_lineno=437, end_col_offset=36), attr='to_thread', ctx=Load(), lineno=437, col_offset=29, end_lineno=437, end_col_offset=46), args=[Attribute(value=Name(id='faiss_module', ctx=Load(), lineno=437, col_offset=47, end_lineno=437, end_col_offset=59), attr='read_index', ctx=Load(), lineno=437, col_offset=47, end_lineno=437, end_col_offset=70), Call(func=Name(id='str', ctx=Load(), lineno=437, col_offset=72, end_lineno=437, end_col_offset=75), args=[Name(id='secondary_path', ctx=Load(), lineno=437, col_offset=76, end_lineno=437, end_col_offset=90)], lineno=437, col_offset=72, end_lineno=437, end_col_offset=91)], lineno=437, col_offset=29, end_lineno=437, end_col_offset=92), lineno=437, col_offset=23, end_lineno=437, end_col_offset=92), lineno=437, col_offset=16, end_lineno=437, end_col_offset=92)], handlers=[ExceptHandler(type=Name(id='RuntimeError', ctx=Load(), lineno=438, col_offset=19, end_lineno=438, end_col_offset=31), name='exc', body=[Expr(value=Call(func=Attribute(value=Name(id='LOGGER', ctx=Load(), lineno=439, col_offset=16, end_lineno=439, end_col_offset=22), attr='exception', ctx=Load(), lineno=439, col_offset=16, end_lineno=439, end_col_offset=32), args=[Constant(value='faiss_secondary_load_failed', lineno=440, col_offset=20, end_lineno=440, end_col_offset=49)], keywords=[keyword(arg='extra', value=Dict(keys=[Constant(value='path', lineno=441, col_offset=27, end_lineno=441, end_col_offset=33), Constant(value='error', lineno=441, col_offset=56, end_lineno=441, end_col_offset=63)], values=[Call(func=Name(id='str', ctx=Load(), lineno=441, col_offset=35, end_lineno=441, end_col_offset=38), args=[Name(id='secondary_path', ctx=Load(), lineno=441, col_offset=39, end_lineno=441, end_col_offset=53)], lineno=441, col_offset=35, end_lineno=441, end_col_offset=54), Call(func=Name(id='str', ctx=Load(), lineno=441, col_offset=65, end_lineno=441, end_col_offset=68), args=[Name(id='exc', ctx=Load(), lineno=441, col_offset=69, end_lineno=441, end_col_offset=72)], lineno=441, col_offset=65, end_lineno=441, end_col_offset=73)], lineno=441, col_offset=26, end_lineno=441, end_col_offset=74), lineno=441, col_offset=20, end_lineno=441, end_col_offset=74)], lineno=439, col_offset=16, end_lineno=442, end_col_offset=17), lineno=439, col_offset=16, end_lineno=442, end_col_offset=17)], lineno=438, col_offset=12, end_lineno=442, end_col_offset=17)], lineno=436, col_offset=12, end_lineno=442, end_col_offset=17)], lineno=435, col_offset=8, end_lineno=442, end_col_offset=17), Return(value=Call(func=Attribute(value=Name(id='faiss_module', ctx=Load(), lineno=444, col_offset=15, end_lineno=444, end_col_offset=27), attr='IndexFlatIP', ctx=Load(), lineno=444, col_offset=15, end_lineno=444, end_col_offset=39), args=[Attribute(value=Name(id='self', ctx=Load(), lineno=444, col_offset=40, end_lineno=444, end_col_offset=44), attr='_vec_dim', ctx=Load(), lineno=444, col_offset=40, end_lineno=444, end_col_offset=53)], lineno=444, col_offset=15, end_lineno=444, end_col_offset=54), lineno=444, col_offset=8, end_lineno=444, end_col_offset=54)], returns=Attribute(value=Name(id='faiss', ctx=Load(), lineno=433, col_offset=71, end_lineno=433, end_col_offset=76), attr='Index', ctx=Load(), lineno=433, col_offset=71, end_lineno=433, end_col_offset=82), lineno=433, col_offset=4, end_lineno=444, end_col_offset=54), FunctionDef(name='_load_manifest', args=arguments(args=[arg(arg='self', lineno=446, col_offset=23, end_lineno=446, end_col_offset=27)]), body=[Assign(targets=[Name(id='manifest_path', ctx=Store(), lineno=447, col_offset=8, end_lineno=447, end_col_offset=21)], value=BinOp(left=Attribute(value=Name(id='self', ctx=Load(), lineno=447, col_offset=24, end_lineno=447, end_col_offset=28), attr='_index_dir', ctx=Load(), lineno=447, col_offset=24, end_lineno=447, end_col_offset=39), op=Div(), right=Constant(value='primary.manifest.json', lineno=447, col_offset=42, end_lineno=447, end_col_offset=65), lineno=447, col_offset=24, end_lineno=447, end_col_offset=65), lineno=447, col_offset=8, end_lineno=447, end_col_offset=65), If(test=UnaryOp(op=Not(), operand=Call(func=Attribute(value=Name(id='manifest_path', ctx=Load(), lineno=448, col_offset=15, end_lineno=448, end_col_offset=28), attr='exists', ctx=Load(), lineno=448, col_offset=15, end_lineno=448, end_col_offset=35), lineno=448, col_offset=15, end_lineno=448, end_col_offset=37), lineno=448, col_offset=11, end_lineno=448, end_col_offset=37), body=[Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=449, col_offset=12, end_lineno=449, end_col_offset=16), attr='_manifest', ctx=Store(), lineno=449, col_offset=12, end_lineno=449, end_col_offset=26)], value=Constant(value=None, lineno=449, col_offset=29, end_lineno=449, end_col_offset=33), lineno=449, col_offset=12, end_lineno=449, end_col_offset=33), Return(lineno=450, col_offset=12, end_lineno=450, end_col_offset=18)], lineno=448, col_offset=8, end_lineno=450, end_col_offset=18), Try(body=[Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=453, col_offset=12, end_lineno=453, end_col_offset=16), attr='_manifest', ctx=Store(), lineno=453, col_offset=12, end_lineno=453, end_col_offset=26)], value=Call(func=Attribute(value=Name(id='IndexManifest', ctx=Load(), lineno=453, col_offset=29, end_lineno=453, end_col_offset=42), attr='from_file', ctx=Load(), lineno=453, col_offset=29, end_lineno=453, end_col_offset=52), args=[Name(id='manifest_path', ctx=Load(), lineno=453, col_offset=53, end_lineno=453, end_col_offset=66)], lineno=453, col_offset=29, end_lineno=453, end_col_offset=67), lineno=453, col_offset=12, end_lineno=453, end_col_offset=67)], handlers=[ExceptHandler(type=Tuple(elts=[Name(id='TypeError', ctx=Load(), lineno=454, col_offset=16, end_lineno=454, end_col_offset=25), Name(id='ValueError', ctx=Load(), lineno=454, col_offset=27, end_lineno=454, end_col_offset=37)], ctx=Load(), lineno=454, col_offset=15, end_lineno=454, end_col_offset=38), name='exc', body=[Expr(value=Call(func=Attribute(value=Name(id='LOGGER', ctx=Load(), lineno=455, col_offset=12, end_lineno=455, end_col_offset=18), attr='warning', ctx=Load(), lineno=455, col_offset=12, end_lineno=455, end_col_offset=26), args=[Constant(value='faiss_manifest_invalid', lineno=456, col_offset=16, end_lineno=456, end_col_offset=40)], keywords=[keyword(arg='extra', value=Dict(keys=[Constant(value='path', lineno=457, col_offset=23, end_lineno=457, end_col_offset=29), Constant(value='error', lineno=457, col_offset=51, end_lineno=457, end_col_offset=58)], values=[Call(func=Name(id='str', ctx=Load(), lineno=457, col_offset=31, end_lineno=457, end_col_offset=34), args=[Name(id='manifest_path', ctx=Load(), lineno=457, col_offset=35, end_lineno=457, end_col_offset=48)], lineno=457, col_offset=31, end_lineno=457, end_col_offset=49), Call(func=Name(id='str', ctx=Load(), lineno=457, col_offset=60, end_lineno=457, end_col_offset=63), args=[Name(id='exc', ctx=Load(), lineno=457, col_offset=64, end_lineno=457, end_col_offset=67)], lineno=457, col_offset=60, end_lineno=457, end_col_offset=68)], lineno=457, col_offset=22, end_lineno=457, end_col_offset=69), lineno=457, col_offset=16, end_lineno=457, end_col_offset=69)], lineno=455, col_offset=12, end_lineno=458, end_col_offset=13), lineno=455, col_offset=12, end_lineno=458, end_col_offset=13), Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=459, col_offset=12, end_lineno=459, end_col_offset=16), attr='_manifest', ctx=Store(), lineno=459, col_offset=12, end_lineno=459, end_col_offset=26)], value=Constant(value=None, lineno=459, col_offset=29, end_lineno=459, end_col_offset=33), lineno=459, col_offset=12, end_lineno=459, end_col_offset=33)], lineno=454, col_offset=8, end_lineno=459, end_col_offset=33)], lineno=452, col_offset=8, end_lineno=459, end_col_offset=33)], returns=Constant(value=None, lineno=446, col_offset=32, end_lineno=446, end_col_offset=36), lineno=446, col_offset=4, end_lineno=459, end_col_offset=33), AsyncFunctionDef(name='try_gpu_clone', args=arguments(args=[arg(arg='self', lineno=461, col_offset=28, end_lineno=461, end_col_offset=32), arg(arg='faiss_module', annotation=Name(id='ModuleType', ctx=Load(), lineno=461, col_offset=48, end_lineno=461, end_col_offset=58), lineno=461, col_offset=34, end_lineno=461, end_col_offset=58)]), body=[Expr(value=Constant(value='Attempt to clone CPU indexes to GPU for acceleration.\n\n        This method is public for testing purposes. It attempts to clone\n        both primary and secondary CPU indexes to GPU if CUDA is available.\n\n        Parameters\n        ----------\n        faiss_module : ModuleType\n            FAISS module instance to use for GPU operations.\n        ', lineno=462, col_offset=8, end_lineno=471, end_col_offset=11), lineno=462, col_offset=8, end_lineno=471, end_col_offset=11), If(test=BoolOp(op=Or(), values=[Compare(left=Attribute(value=Name(id='self', ctx=Load(), lineno=472, col_offset=11, end_lineno=472, end_col_offset=15), attr='_primary_cpu', ctx=Load(), lineno=472, col_offset=11, end_lineno=472, end_col_offset=28), ops=[Is()], comparators=[Constant(value=None, lineno=472, col_offset=32, end_lineno=472, end_col_offset=36)], lineno=472, col_offset=11, end_lineno=472, end_col_offset=36), Compare(left=Attribute(value=Name(id='self', ctx=Load(), lineno=472, col_offset=40, end_lineno=472, end_col_offset=44), attr='_secondary_cpu', ctx=Load(), lineno=472, col_offset=40, end_lineno=472, end_col_offset=59), ops=[Is()], comparators=[Constant(value=None, lineno=472, col_offset=63, end_lineno=472, end_col_offset=67)], lineno=472, col_offset=40, end_lineno=472, end_col_offset=67)], lineno=472, col_offset=11, end_lineno=472, end_col_offset=67), body=[Return(lineno=473, col_offset=12, end_lineno=473, end_col_offset=18)], lineno=472, col_offset=8, end_lineno=473, end_col_offset=18), Try(body=[Assign(targets=[Name(id='torch', ctx=Store(), lineno=476, col_offset=12, end_lineno=476, end_col_offset=17)], value=Call(func=Attribute(value=Name(id='importlib', ctx=Load(), lineno=476, col_offset=20, end_lineno=476, end_col_offset=29), attr='import_module', ctx=Load(), lineno=476, col_offset=20, end_lineno=476, end_col_offset=43), args=[Constant(value='torch', lineno=476, col_offset=44, end_lineno=476, end_col_offset=51)], lineno=476, col_offset=20, end_lineno=476, end_col_offset=52), lineno=476, col_offset=12, end_lineno=476, end_col_offset=52)], handlers=[ExceptHandler(type=Name(id='ImportError', ctx=Load(), lineno=477, col_offset=15, end_lineno=477, end_col_offset=26), body=[Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=478, col_offset=12, end_lineno=478, end_col_offset=16), attr='_gpu_disabled_reason', ctx=Store(), lineno=478, col_offset=12, end_lineno=478, end_col_offset=37)], value=Constant(value='PyTorch not installed', lineno=478, col_offset=40, end_lineno=478, end_col_offset=63), lineno=478, col_offset=12, end_lineno=478, end_col_offset=63), Return(lineno=479, col_offset=12, end_lineno=479, end_col_offset=18)], lineno=477, col_offset=8, end_lineno=479, end_col_offset=18)], lineno=475, col_offset=8, end_lineno=479, end_col_offset=18), Try(body=[If(test=UnaryOp(op=Not(), operand=Call(func=Attribute(value=Attribute(value=Name(id='torch', ctx=Load(), lineno=482, col_offset=19, end_lineno=482, end_col_offset=24), attr='cuda', ctx=Load(), lineno=482, col_offset=19, end_lineno=482, end_col_offset=29), attr='is_available', ctx=Load(), lineno=482, col_offset=19, end_lineno=482, end_col_offset=42), lineno=482, col_offset=19, end_lineno=482, end_col_offset=44), lineno=482, col_offset=15, end_lineno=482, end_col_offset=44), body=[Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=483, col_offset=16, end_lineno=483, end_col_offset=20), attr='_gpu_disabled_reason', ctx=Store(), lineno=483, col_offset=16, end_lineno=483, end_col_offset=41)], value=Constant(value='CUDA not available', lineno=483, col_offset=44, end_lineno=483, end_col_offset=64), lineno=483, col_offset=16, end_lineno=483, end_col_offset=64), Return(lineno=484, col_offset=16, end_lineno=484, end_col_offset=22)], lineno=482, col_offset=12, end_lineno=484, end_col_offset=22)], handlers=[ExceptHandler(type=Name(id='RuntimeError', ctx=Load(), lineno=485, col_offset=15, end_lineno=485, end_col_offset=27), name='exc', body=[Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=486, col_offset=12, end_lineno=486, end_col_offset=16), attr='_gpu_disabled_reason', ctx=Store(), lineno=486, col_offset=12, end_lineno=486, end_col_offset=37)], value=JoinedStr(values=[Constant(value='CUDA check failed: ', lineno=486, col_offset=42, end_lineno=486, end_col_offset=61), FormattedValue(value=Name(id='exc', ctx=Load(), lineno=486, col_offset=62, end_lineno=486, end_col_offset=65), conversion=-1, lineno=486, col_offset=61, end_lineno=486, end_col_offset=66)], lineno=486, col_offset=40, end_lineno=486, end_col_offset=67), lineno=486, col_offset=12, end_lineno=486, end_col_offset=67), Expr(value=Call(func=Attribute(value=Name(id='LOGGER', ctx=Load(), lineno=487, col_offset=12, end_lineno=487, end_col_offset=18), attr='exception', ctx=Load(), lineno=487, col_offset=12, end_lineno=487, end_col_offset=28), args=[Constant(value='faiss_cuda_check_failed', lineno=487, col_offset=29, end_lineno=487, end_col_offset=54)], keywords=[keyword(arg='extra', value=Dict(keys=[Constant(value='error', lineno=487, col_offset=63, end_lineno=487, end_col_offset=70)], values=[Call(func=Name(id='str', ctx=Load(), lineno=487, col_offset=72, end_lineno=487, end_col_offset=75), args=[Name(id='exc', ctx=Load(), lineno=487, col_offset=76, end_lineno=487, end_col_offset=79)], lineno=487, col_offset=72, end_lineno=487, end_col_offset=80)], lineno=487, col_offset=62, end_lineno=487, end_col_offset=81), lineno=487, col_offset=56, end_lineno=487, end_col_offset=81)], lineno=487, col_offset=12, end_lineno=487, end_col_offset=82), lineno=487, col_offset=12, end_lineno=487, end_col_offset=82), Return(lineno=488, col_offset=12, end_lineno=488, end_col_offset=18)], lineno=485, col_offset=8, end_lineno=488, end_col_offset=18)], lineno=481, col_offset=8, end_lineno=488, end_col_offset=18), Try(body=[Assign(targets=[Name(id='gpu_resources', ctx=Store(), lineno=491, col_offset=12, end_lineno=491, end_col_offset=25)], value=Call(func=Attribute(value=Name(id='faiss_module', ctx=Load(), lineno=491, col_offset=28, end_lineno=491, end_col_offset=40), attr='StandardGpuResources', ctx=Load(), lineno=491, col_offset=28, end_lineno=491, end_col_offset=61), lineno=491, col_offset=28, end_lineno=491, end_col_offset=63), lineno=491, col_offset=12, end_lineno=491, end_col_offset=63), Assign(targets=[Name(id='cloner_options', ctx=Store(), lineno=492, col_offset=12, end_lineno=492, end_col_offset=26)], value=Call(func=Attribute(value=Name(id='self', ctx=Load(), lineno=492, col_offset=29, end_lineno=492, end_col_offset=33), attr='_build_gpu_cloner_options', ctx=Load(), lineno=492, col_offset=29, end_lineno=492, end_col_offset=59), args=[Name(id='faiss_module', ctx=Load(), lineno=492, col_offset=60, end_lineno=492, end_col_offset=72)], lineno=492, col_offset=29, end_lineno=492, end_col_offset=73), lineno=492, col_offset=12, end_lineno=492, end_col_offset=73), Assign(targets=[Name(id='primary_gpu', ctx=Store(), lineno=494, col_offset=12, end_lineno=494, end_col_offset=23)], value=Call(func=Attribute(value=Name(id='self', ctx=Load(), lineno=494, col_offset=26, end_lineno=494, end_col_offset=30), attr='_clone_index_to_gpu', ctx=Load(), lineno=494, col_offset=26, end_lineno=494, end_col_offset=50), args=[Name(id='faiss_module', ctx=Load(), lineno=495, col_offset=16, end_lineno=495, end_col_offset=28), Name(id='gpu_resources', ctx=Load(), lineno=496, col_offset=16, end_lineno=496, end_col_offset=29), Attribute(value=Name(id='self', ctx=Load(), lineno=497, col_offset=16, end_lineno=497, end_col_offset=20), attr='_primary_cpu', ctx=Load(), lineno=497, col_offset=16, end_lineno=497, end_col_offset=33), Name(id='cloner_options', ctx=Load(), lineno=498, col_offset=16, end_lineno=498, end_col_offset=30)], lineno=494, col_offset=26, end_lineno=499, end_col_offset=13), lineno=494, col_offset=12, end_lineno=499, end_col_offset=13), Assign(targets=[Name(id='secondary_gpu', ctx=Store(), lineno=500, col_offset=12, end_lineno=500, end_col_offset=25)], value=Call(func=Attribute(value=Name(id='self', ctx=Load(), lineno=500, col_offset=28, end_lineno=500, end_col_offset=32), attr='_clone_index_to_gpu', ctx=Load(), lineno=500, col_offset=28, end_lineno=500, end_col_offset=52), args=[Name(id='faiss_module', ctx=Load(), lineno=501, col_offset=16, end_lineno=501, end_col_offset=28), Name(id='gpu_resources', ctx=Load(), lineno=502, col_offset=16, end_lineno=502, end_col_offset=29), Attribute(value=Name(id='self', ctx=Load(), lineno=503, col_offset=16, end_lineno=503, end_col_offset=20), attr='_secondary_cpu', ctx=Load(), lineno=503, col_offset=16, end_lineno=503, end_col_offset=35), Name(id='cloner_options', ctx=Load(), lineno=504, col_offset=16, end_lineno=504, end_col_offset=30)], lineno=500, col_offset=28, end_lineno=505, end_col_offset=13), lineno=500, col_offset=12, end_lineno=505, end_col_offset=13)], handlers=[ExceptHandler(type=Tuple(elts=[Name(id='AttributeError', ctx=Load(), lineno=506, col_offset=16, end_lineno=506, end_col_offset=30), Name(id='RuntimeError', ctx=Load(), lineno=506, col_offset=32, end_lineno=506, end_col_offset=44)], ctx=Load(), lineno=506, col_offset=15, end_lineno=506, end_col_offset=45), name='exc', body=[Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=507, col_offset=12, end_lineno=507, end_col_offset=16), attr='_gpu_disabled_reason', ctx=Store(), lineno=507, col_offset=12, end_lineno=507, end_col_offset=37)], value=JoinedStr(values=[Constant(value='GPU clone failed: ', lineno=507, col_offset=42, end_lineno=507, end_col_offset=60), FormattedValue(value=Name(id='exc', ctx=Load(), lineno=507, col_offset=61, end_lineno=507, end_col_offset=64), conversion=-1, lineno=507, col_offset=60, end_lineno=507, end_col_offset=65)], lineno=507, col_offset=40, end_lineno=507, end_col_offset=66), lineno=507, col_offset=12, end_lineno=507, end_col_offset=66), Expr(value=Call(func=Attribute(value=Name(id='LOGGER', ctx=Load(), lineno=508, col_offset=12, end_lineno=508, end_col_offset=18), attr='exception', ctx=Load(), lineno=508, col_offset=12, end_lineno=508, end_col_offset=28), args=[Constant(value='faiss_gpu_clone_failed', lineno=508, col_offset=29, end_lineno=508, end_col_offset=53)], keywords=[keyword(arg='extra', value=Dict(keys=[Constant(value='error', lineno=508, col_offset=62, end_lineno=508, end_col_offset=69)], values=[Call(func=Name(id='str', ctx=Load(), lineno=508, col_offset=71, end_lineno=508, end_col_offset=74), args=[Name(id='exc', ctx=Load(), lineno=508, col_offset=75, end_lineno=508, end_col_offset=78)], lineno=508, col_offset=71, end_lineno=508, end_col_offset=79)], lineno=508, col_offset=61, end_lineno=508, end_col_offset=80), lineno=508, col_offset=55, end_lineno=508, end_col_offset=80)], lineno=508, col_offset=12, end_lineno=508, end_col_offset=81), lineno=508, col_offset=12, end_lineno=508, end_col_offset=81), Return(lineno=509, col_offset=12, end_lineno=509, end_col_offset=18)], lineno=506, col_offset=8, end_lineno=509, end_col_offset=18)], lineno=490, col_offset=8, end_lineno=509, end_col_offset=18), Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=511, col_offset=8, end_lineno=511, end_col_offset=12), attr='_gpu_resources', ctx=Store(), lineno=511, col_offset=8, end_lineno=511, end_col_offset=27)], value=Name(id='gpu_resources', ctx=Load(), lineno=511, col_offset=30, end_lineno=511, end_col_offset=43), lineno=511, col_offset=8, end_lineno=511, end_col_offset=43), Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=512, col_offset=8, end_lineno=512, end_col_offset=12), attr='_primary_gpu', ctx=Store(), lineno=512, col_offset=8, end_lineno=512, end_col_offset=25)], value=Name(id='primary_gpu', ctx=Load(), lineno=512, col_offset=28, end_lineno=512, end_col_offset=39), lineno=512, col_offset=8, end_lineno=512, end_col_offset=39), Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=513, col_offset=8, end_lineno=513, end_col_offset=12), attr='_secondary_gpu', ctx=Store(), lineno=513, col_offset=8, end_lineno=513, end_col_offset=27)], value=Name(id='secondary_gpu', ctx=Load(), lineno=513, col_offset=30, end_lineno=513, end_col_offset=43), lineno=513, col_offset=8, end_lineno=513, end_col_offset=43), Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=514, col_offset=8, end_lineno=514, end_col_offset=12), attr='_gpu_enabled', ctx=Store(), lineno=514, col_offset=8, end_lineno=514, end_col_offset=25)], value=Constant(value=True, lineno=514, col_offset=28, end_lineno=514, end_col_offset=32), lineno=514, col_offset=8, end_lineno=514, end_col_offset=32), Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=515, col_offset=8, end_lineno=515, end_col_offset=12), attr='_gpu_disabled_reason', ctx=Store(), lineno=515, col_offset=8, end_lineno=515, end_col_offset=33)], value=Constant(value=None, lineno=515, col_offset=36, end_lineno=515, end_col_offset=40), lineno=515, col_offset=8, end_lineno=515, end_col_offset=40), Expr(value=Call(func=Attribute(value=Name(id='LOGGER', ctx=Load(), lineno=516, col_offset=8, end_lineno=516, end_col_offset=14), attr='info', ctx=Load(), lineno=516, col_offset=8, end_lineno=516, end_col_offset=19), args=[Constant(value='faiss_gpu_clone_success', lineno=517, col_offset=12, end_lineno=517, end_col_offset=37)], keywords=[keyword(arg='extra', value=Dict(keys=[Constant(value='use_cuvs', lineno=518, col_offset=19, end_lineno=518, end_col_offset=29)], values=[Call(func=Name(id='bool', ctx=Load(), lineno=518, col_offset=31, end_lineno=518, end_col_offset=35), args=[Call(func=Name(id='getattr', ctx=Load(), lineno=518, col_offset=36, end_lineno=518, end_col_offset=43), args=[Name(id='cloner_options', ctx=Load(), lineno=518, col_offset=44, end_lineno=518, end_col_offset=58), Constant(value='use_cuvs', lineno=518, col_offset=60, end_lineno=518, end_col_offset=70), Constant(value=False, lineno=518, col_offset=72, end_lineno=518, end_col_offset=77)], lineno=518, col_offset=36, end_lineno=518, end_col_offset=78)], lineno=518, col_offset=31, end_lineno=518, end_col_offset=79)], lineno=518, col_offset=18, end_lineno=518, end_col_offset=80), lineno=518, col_offset=12, end_lineno=518, end_col_offset=80)], lineno=516, col_offset=8, end_lineno=519, end_col_offset=9), lineno=516, col_offset=8, end_lineno=519, end_col_offset=9)], returns=Constant(value=None, lineno=461, col_offset=63, end_lineno=461, end_col_offset=67), lineno=461, col_offset=4, end_lineno=519, end_col_offset=9), FunctionDef(name='_build_gpu_cloner_options', args=arguments(args=[arg(arg='self', lineno=521, col_offset=34, end_lineno=521, end_col_offset=38), arg(arg='faiss_module', annotation=Name(id='ModuleType', ctx=Load(), lineno=521, col_offset=54, end_lineno=521, end_col_offset=64), lineno=521, col_offset=40, end_lineno=521, end_col_offset=64)]), body=[Assign(targets=[Name(id='cloner_options', ctx=Store(), lineno=522, col_offset=8, end_lineno=522, end_col_offset=22)], value=Call(func=Attribute(value=Name(id='faiss_module', ctx=Load(), lineno=522, col_offset=25, end_lineno=522, end_col_offset=37), attr='GpuClonerOptions', ctx=Load(), lineno=522, col_offset=25, end_lineno=522, end_col_offset=54), lineno=522, col_offset=25, end_lineno=522, end_col_offset=56), lineno=522, col_offset=8, end_lineno=522, end_col_offset=56), Assign(targets=[Name(id='requested', ctx=Store(), lineno=523, col_offset=8, end_lineno=523, end_col_offset=17)], value=Call(func=Name(id='bool', ctx=Load(), lineno=523, col_offset=20, end_lineno=523, end_col_offset=24), args=[Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=523, col_offset=25, end_lineno=523, end_col_offset=29), attr='_settings', ctx=Load(), lineno=523, col_offset=25, end_lineno=523, end_col_offset=39), attr='use_cuvs', ctx=Load(), lineno=523, col_offset=25, end_lineno=523, end_col_offset=48)], lineno=523, col_offset=20, end_lineno=523, end_col_offset=49), lineno=523, col_offset=8, end_lineno=523, end_col_offset=49), If(test=Call(func=Name(id='hasattr', ctx=Load(), lineno=524, col_offset=11, end_lineno=524, end_col_offset=18), args=[Name(id='cloner_options', ctx=Load(), lineno=524, col_offset=19, end_lineno=524, end_col_offset=33), Constant(value='use_cuvs', lineno=524, col_offset=35, end_lineno=524, end_col_offset=45)], lineno=524, col_offset=11, end_lineno=524, end_col_offset=46), body=[Try(body=[Assign(targets=[Attribute(value=Name(id='cloner_options', ctx=Load(), lineno=526, col_offset=16, end_lineno=526, end_col_offset=30), attr='use_cuvs', ctx=Store(), lineno=526, col_offset=16, end_lineno=526, end_col_offset=39)], value=Name(id='requested', ctx=Load(), lineno=526, col_offset=42, end_lineno=526, end_col_offset=51), lineno=526, col_offset=16, end_lineno=526, end_col_offset=51)], handlers=[ExceptHandler(type=Name(id='AttributeError', ctx=Load(), lineno=527, col_offset=19, end_lineno=527, end_col_offset=33), name='exc', body=[Expr(value=Call(func=Attribute(value=Name(id='LOGGER', ctx=Load(), lineno=528, col_offset=16, end_lineno=528, end_col_offset=22), attr='warning', ctx=Load(), lineno=528, col_offset=16, end_lineno=528, end_col_offset=30), args=[Constant(value='faiss_gpu_cuvs_unavailable', lineno=529, col_offset=20, end_lineno=529, end_col_offset=48)], keywords=[keyword(arg='extra', value=Dict(keys=[Constant(value='error', lineno=530, col_offset=27, end_lineno=530, end_col_offset=34)], values=[Call(func=Name(id='str', ctx=Load(), lineno=530, col_offset=36, end_lineno=530, end_col_offset=39), args=[Name(id='exc', ctx=Load(), lineno=530, col_offset=40, end_lineno=530, end_col_offset=43)], lineno=530, col_offset=36, end_lineno=530, end_col_offset=44)], lineno=530, col_offset=26, end_lineno=530, end_col_offset=45), lineno=530, col_offset=20, end_lineno=530, end_col_offset=45)], lineno=528, col_offset=16, end_lineno=531, end_col_offset=17), lineno=528, col_offset=16, end_lineno=531, end_col_offset=17), Assign(targets=[Attribute(value=Name(id='cloner_options', ctx=Load(), lineno=532, col_offset=16, end_lineno=532, end_col_offset=30), attr='use_cuvs', ctx=Store(), lineno=532, col_offset=16, end_lineno=532, end_col_offset=39)], value=Constant(value=False, lineno=532, col_offset=42, end_lineno=532, end_col_offset=47), lineno=532, col_offset=16, end_lineno=532, end_col_offset=47)], lineno=527, col_offset=12, end_lineno=532, end_col_offset=47)], lineno=525, col_offset=12, end_lineno=532, end_col_offset=47)], orelse=[If(test=Name(id='requested', ctx=Load(), lineno=533, col_offset=13, end_lineno=533, end_col_offset=22), body=[Expr(value=Call(func=Attribute(value=Name(id='LOGGER', ctx=Load(), lineno=534, col_offset=12, end_lineno=534, end_col_offset=18), attr='warning', ctx=Load(), lineno=534, col_offset=12, end_lineno=534, end_col_offset=26), args=[Constant(value='faiss_gpu_cuvs_unavailable', lineno=535, col_offset=16, end_lineno=535, end_col_offset=44)], keywords=[keyword(arg='extra', value=Dict(keys=[Constant(value='error', lineno=536, col_offset=23, end_lineno=536, end_col_offset=30)], values=[Constant(value='GpuClonerOptions.use_cuvs missing', lineno=536, col_offset=32, end_lineno=536, end_col_offset=67)], lineno=536, col_offset=22, end_lineno=536, end_col_offset=68), lineno=536, col_offset=16, end_lineno=536, end_col_offset=68)], lineno=534, col_offset=12, end_lineno=537, end_col_offset=13), lineno=534, col_offset=12, end_lineno=537, end_col_offset=13)], lineno=533, col_offset=8, end_lineno=537, end_col_offset=13)], lineno=524, col_offset=8, end_lineno=537, end_col_offset=13), Return(value=Name(id='cloner_options', ctx=Load(), lineno=538, col_offset=15, end_lineno=538, end_col_offset=29), lineno=538, col_offset=8, end_lineno=538, end_col_offset=29)], returns=Attribute(value=Name(id='faiss', ctx=Load(), lineno=521, col_offset=69, end_lineno=521, end_col_offset=74), attr='GpuClonerOptions', ctx=Load(), lineno=521, col_offset=69, end_lineno=521, end_col_offset=91), lineno=521, col_offset=4, end_lineno=538, end_col_offset=29), FunctionDef(name='_clone_index_to_gpu', args=arguments(args=[arg(arg='self', lineno=541, col_offset=8, end_lineno=541, end_col_offset=12), arg(arg='faiss_module', annotation=Name(id='ModuleType', ctx=Load(), lineno=542, col_offset=22, end_lineno=542, end_col_offset=32), lineno=542, col_offset=8, end_lineno=542, end_col_offset=32), arg(arg='gpu_resources', annotation=Attribute(value=Name(id='faiss', ctx=Load(), lineno=543, col_offset=23, end_lineno=543, end_col_offset=28), attr='StandardGpuResources', ctx=Load(), lineno=543, col_offset=23, end_lineno=543, end_col_offset=49), lineno=543, col_offset=8, end_lineno=543, end_col_offset=49), arg(arg='cpu_index', annotation=Attribute(value=Name(id='faiss', ctx=Load(), lineno=544, col_offset=19, end_lineno=544, end_col_offset=24), attr='Index', ctx=Load(), lineno=544, col_offset=19, end_lineno=544, end_col_offset=30), lineno=544, col_offset=8, end_lineno=544, end_col_offset=30), arg(arg='cloner_options', annotation=Attribute(value=Name(id='faiss', ctx=Load(), lineno=545, col_offset=24, end_lineno=545, end_col_offset=29), attr='GpuClonerOptions', ctx=Load(), lineno=545, col_offset=24, end_lineno=545, end_col_offset=46), lineno=545, col_offset=8, end_lineno=545, end_col_offset=46)]), body=[Try(body=[Return(value=Call(func=Attribute(value=Name(id='faiss_module', ctx=Load(), lineno=548, col_offset=19, end_lineno=548, end_col_offset=31), attr='index_cpu_to_gpu', ctx=Load(), lineno=548, col_offset=19, end_lineno=548, end_col_offset=48), args=[Name(id='gpu_resources', ctx=Load(), lineno=549, col_offset=16, end_lineno=549, end_col_offset=29), Constant(value=0, lineno=550, col_offset=16, end_lineno=550, end_col_offset=17), Name(id='cpu_index', ctx=Load(), lineno=551, col_offset=16, end_lineno=551, end_col_offset=25), Name(id='cloner_options', ctx=Load(), lineno=552, col_offset=16, end_lineno=552, end_col_offset=30)], lineno=548, col_offset=19, end_lineno=553, end_col_offset=13), lineno=548, col_offset=12, end_lineno=553, end_col_offset=13)], handlers=[ExceptHandler(type=Tuple(elts=[Name(id='AttributeError', ctx=Load(), lineno=554, col_offset=16, end_lineno=554, end_col_offset=30), Name(id='RuntimeError', ctx=Load(), lineno=554, col_offset=32, end_lineno=554, end_col_offset=44)], ctx=Load(), lineno=554, col_offset=15, end_lineno=554, end_col_offset=45), name='exc', body=[If(test=BoolOp(op=And(), values=[Call(func=Name(id='bool', ctx=Load(), lineno=555, col_offset=15, end_lineno=555, end_col_offset=19), args=[Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=555, col_offset=20, end_lineno=555, end_col_offset=24), attr='_settings', ctx=Load(), lineno=555, col_offset=20, end_lineno=555, end_col_offset=34), attr='use_cuvs', ctx=Load(), lineno=555, col_offset=20, end_lineno=555, end_col_offset=43)], lineno=555, col_offset=15, end_lineno=555, end_col_offset=44), Call(func=Name(id='hasattr', ctx=Load(), lineno=555, col_offset=49, end_lineno=555, end_col_offset=56), args=[Name(id='cloner_options', ctx=Load(), lineno=555, col_offset=57, end_lineno=555, end_col_offset=71), Constant(value='use_cuvs', lineno=555, col_offset=73, end_lineno=555, end_col_offset=83)], lineno=555, col_offset=49, end_lineno=555, end_col_offset=84)], lineno=555, col_offset=15, end_lineno=555, end_col_offset=84), body=[Try(body=[Assign(targets=[Attribute(value=Name(id='cloner_options', ctx=Load(), lineno=557, col_offset=20, end_lineno=557, end_col_offset=34), attr='use_cuvs', ctx=Store(), lineno=557, col_offset=20, end_lineno=557, end_col_offset=43)], value=Constant(value=False, lineno=557, col_offset=46, end_lineno=557, end_col_offset=51), lineno=557, col_offset=20, end_lineno=557, end_col_offset=51)], handlers=[ExceptHandler(type=Name(id='AttributeError', ctx=Load(), lineno=558, col_offset=23, end_lineno=558, end_col_offset=37), body=[Expr(value=Call(func=Attribute(value=Name(id='LOGGER', ctx=Load(), lineno=559, col_offset=20, end_lineno=559, end_col_offset=26), attr='warning', ctx=Load(), lineno=559, col_offset=20, end_lineno=559, end_col_offset=34), args=[Constant(value='faiss_gpu_clone_cuvs_reset_failed', lineno=560, col_offset=24, end_lineno=560, end_col_offset=59)], keywords=[keyword(arg='extra', value=Dict(keys=[Constant(value='error', lineno=561, col_offset=31, end_lineno=561, end_col_offset=38)], values=[Call(func=Name(id='str', ctx=Load(), lineno=561, col_offset=40, end_lineno=561, end_col_offset=43), args=[Name(id='exc', ctx=Load(), lineno=561, col_offset=44, end_lineno=561, end_col_offset=47)], lineno=561, col_offset=40, end_lineno=561, end_col_offset=48)], lineno=561, col_offset=30, end_lineno=561, end_col_offset=49), lineno=561, col_offset=24, end_lineno=561, end_col_offset=49)], lineno=559, col_offset=20, end_lineno=562, end_col_offset=21), lineno=559, col_offset=20, end_lineno=562, end_col_offset=21)], lineno=558, col_offset=16, end_lineno=562, end_col_offset=21)], orelse=[Expr(value=Call(func=Attribute(value=Name(id='LOGGER', ctx=Load(), lineno=564, col_offset=20, end_lineno=564, end_col_offset=26), attr='warning', ctx=Load(), lineno=564, col_offset=20, end_lineno=564, end_col_offset=34), args=[Constant(value='faiss_gpu_clone_cuvs_fallback', lineno=565, col_offset=24, end_lineno=565, end_col_offset=55)], keywords=[keyword(arg='extra', value=Dict(keys=[Constant(value='error', lineno=566, col_offset=31, end_lineno=566, end_col_offset=38)], values=[Call(func=Name(id='str', ctx=Load(), lineno=566, col_offset=40, end_lineno=566, end_col_offset=43), args=[Name(id='exc', ctx=Load(), lineno=566, col_offset=44, end_lineno=566, end_col_offset=47)], lineno=566, col_offset=40, end_lineno=566, end_col_offset=48)], lineno=566, col_offset=30, end_lineno=566, end_col_offset=49), lineno=566, col_offset=24, end_lineno=566, end_col_offset=49)], lineno=564, col_offset=20, end_lineno=567, end_col_offset=21), lineno=564, col_offset=20, end_lineno=567, end_col_offset=21), Return(value=Call(func=Attribute(value=Name(id='faiss_module', ctx=Load(), lineno=568, col_offset=27, end_lineno=568, end_col_offset=39), attr='index_cpu_to_gpu', ctx=Load(), lineno=568, col_offset=27, end_lineno=568, end_col_offset=56), args=[Name(id='gpu_resources', ctx=Load(), lineno=569, col_offset=24, end_lineno=569, end_col_offset=37), Constant(value=0, lineno=570, col_offset=24, end_lineno=570, end_col_offset=25), Name(id='cpu_index', ctx=Load(), lineno=571, col_offset=24, end_lineno=571, end_col_offset=33), Name(id='cloner_options', ctx=Load(), lineno=572, col_offset=24, end_lineno=572, end_col_offset=38)], lineno=568, col_offset=27, end_lineno=573, end_col_offset=21), lineno=568, col_offset=20, end_lineno=573, end_col_offset=21)], lineno=556, col_offset=16, end_lineno=573, end_col_offset=21)], lineno=555, col_offset=12, end_lineno=573, end_col_offset=21), Raise(lineno=574, col_offset=12, end_lineno=574, end_col_offset=17)], lineno=554, col_offset=8, end_lineno=574, end_col_offset=17)], lineno=547, col_offset=8, end_lineno=574, end_col_offset=17)], returns=Attribute(value=Name(id='faiss', ctx=Load(), lineno=546, col_offset=9, end_lineno=546, end_col_offset=14), attr='Index', ctx=Load(), lineno=546, col_offset=9, end_lineno=546, end_col_offset=20), lineno=540, col_offset=4, end_lineno=574, end_col_offset=17), FunctionDef(name='_select_primary_index', args=arguments(args=[arg(arg='self', lineno=576, col_offset=30, end_lineno=576, end_col_offset=34)]), body=[If(test=Compare(left=Attribute(value=Name(id='self', ctx=Load(), lineno=577, col_offset=11, end_lineno=577, end_col_offset=15), attr='_primary_cpu', ctx=Load(), lineno=577, col_offset=11, end_lineno=577, end_col_offset=28), ops=[Is()], comparators=[Constant(value=None, lineno=577, col_offset=32, end_lineno=577, end_col_offset=36)], lineno=577, col_offset=11, end_lineno=577, end_col_offset=36), body=[Assign(targets=[Name(id='msg', ctx=Store(), lineno=578, col_offset=12, end_lineno=578, end_col_offset=15)], value=Constant(value='Primary index not loaded', lineno=578, col_offset=18, end_lineno=578, end_col_offset=44), lineno=578, col_offset=12, end_lineno=578, end_col_offset=44), Raise(exc=Call(func=Name(id='RuntimeError', ctx=Load(), lineno=579, col_offset=18, end_lineno=579, end_col_offset=30), args=[Name(id='msg', ctx=Load(), lineno=579, col_offset=31, end_lineno=579, end_col_offset=34)], lineno=579, col_offset=18, end_lineno=579, end_col_offset=35), lineno=579, col_offset=12, end_lineno=579, end_col_offset=35)], lineno=577, col_offset=8, end_lineno=579, end_col_offset=35), If(test=BoolOp(op=And(), values=[Attribute(value=Name(id='self', ctx=Load(), lineno=580, col_offset=11, end_lineno=580, end_col_offset=15), attr='_gpu_enabled', ctx=Load(), lineno=580, col_offset=11, end_lineno=580, end_col_offset=28), Compare(left=Attribute(value=Name(id='self', ctx=Load(), lineno=580, col_offset=33, end_lineno=580, end_col_offset=37), attr='_primary_gpu', ctx=Load(), lineno=580, col_offset=33, end_lineno=580, end_col_offset=50), ops=[IsNot()], comparators=[Constant(value=None, lineno=580, col_offset=58, end_lineno=580, end_col_offset=62)], lineno=580, col_offset=33, end_lineno=580, end_col_offset=62)], lineno=580, col_offset=11, end_lineno=580, end_col_offset=62), body=[Return(value=Attribute(value=Name(id='self', ctx=Load(), lineno=581, col_offset=19, end_lineno=581, end_col_offset=23), attr='_primary_gpu', ctx=Load(), lineno=581, col_offset=19, end_lineno=581, end_col_offset=36), lineno=581, col_offset=12, end_lineno=581, end_col_offset=36)], lineno=580, col_offset=8, end_lineno=581, end_col_offset=36), Return(value=Attribute(value=Name(id='self', ctx=Load(), lineno=582, col_offset=15, end_lineno=582, end_col_offset=19), attr='_primary_cpu', ctx=Load(), lineno=582, col_offset=15, end_lineno=582, end_col_offset=32), lineno=582, col_offset=8, end_lineno=582, end_col_offset=32)], returns=Attribute(value=Name(id='faiss', ctx=Load(), lineno=576, col_offset=39, end_lineno=576, end_col_offset=44), attr='Index', ctx=Load(), lineno=576, col_offset=39, end_lineno=576, end_col_offset=50), lineno=576, col_offset=4, end_lineno=582, end_col_offset=32), FunctionDef(name='_select_secondary_index', args=arguments(args=[arg(arg='self', lineno=584, col_offset=32, end_lineno=584, end_col_offset=36)]), body=[If(test=Compare(left=Attribute(value=Name(id='self', ctx=Load(), lineno=585, col_offset=11, end_lineno=585, end_col_offset=15), attr='_secondary_cpu', ctx=Load(), lineno=585, col_offset=11, end_lineno=585, end_col_offset=30), ops=[Is()], comparators=[Constant(value=None, lineno=585, col_offset=34, end_lineno=585, end_col_offset=38)], lineno=585, col_offset=11, end_lineno=585, end_col_offset=38), body=[Return(value=Constant(value=None, lineno=586, col_offset=19, end_lineno=586, end_col_offset=23), lineno=586, col_offset=12, end_lineno=586, end_col_offset=23)], lineno=585, col_offset=8, end_lineno=586, end_col_offset=23), If(test=BoolOp(op=And(), values=[Attribute(value=Name(id='self', ctx=Load(), lineno=587, col_offset=11, end_lineno=587, end_col_offset=15), attr='_gpu_enabled', ctx=Load(), lineno=587, col_offset=11, end_lineno=587, end_col_offset=28), Compare(left=Attribute(value=Name(id='self', ctx=Load(), lineno=587, col_offset=33, end_lineno=587, end_col_offset=37), attr='_secondary_gpu', ctx=Load(), lineno=587, col_offset=33, end_lineno=587, end_col_offset=52), ops=[IsNot()], comparators=[Constant(value=None, lineno=587, col_offset=60, end_lineno=587, end_col_offset=64)], lineno=587, col_offset=33, end_lineno=587, end_col_offset=64)], lineno=587, col_offset=11, end_lineno=587, end_col_offset=64), body=[Return(value=Attribute(value=Name(id='self', ctx=Load(), lineno=588, col_offset=19, end_lineno=588, end_col_offset=23), attr='_secondary_gpu', ctx=Load(), lineno=588, col_offset=19, end_lineno=588, end_col_offset=38), lineno=588, col_offset=12, end_lineno=588, end_col_offset=38)], lineno=587, col_offset=8, end_lineno=588, end_col_offset=38), Return(value=Attribute(value=Name(id='self', ctx=Load(), lineno=589, col_offset=15, end_lineno=589, end_col_offset=19), attr='_secondary_cpu', ctx=Load(), lineno=589, col_offset=15, end_lineno=589, end_col_offset=34), lineno=589, col_offset=8, end_lineno=589, end_col_offset=34)], returns=BinOp(left=Attribute(value=Name(id='faiss', ctx=Load(), lineno=584, col_offset=41, end_lineno=584, end_col_offset=46), attr='Index', ctx=Load(), lineno=584, col_offset=41, end_lineno=584, end_col_offset=52), op=BitOr(), right=Constant(value=None, lineno=584, col_offset=55, end_lineno=584, end_col_offset=59), lineno=584, col_offset=41, end_lineno=584, end_col_offset=59), lineno=584, col_offset=4, end_lineno=589, end_col_offset=34)], lineno=85, col_offset=0, end_lineno=589, end_col_offset=34)])