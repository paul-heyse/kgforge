Module(body=[Expr(value=Constant(value='Parquet storage for chunks and vectors using Arrow.\n\nStores chunks and embeddings in columnar Parquet format with FixedSizeList\nfor efficient vector storage and querying via DuckDB.\n', lineno=1, col_offset=0, end_lineno=5, end_col_offset=3), lineno=1, col_offset=0, end_lineno=5, end_col_offset=3), ImportFrom(module='__future__', names=[alias(name='annotations', lineno=7, col_offset=23, end_lineno=7, end_col_offset=34)], level=0, lineno=7, col_offset=0, end_lineno=7, end_col_offset=34), ImportFrom(module='dataclasses', names=[alias(name='dataclass', lineno=9, col_offset=24, end_lineno=9, end_col_offset=33)], level=0, lineno=9, col_offset=0, end_lineno=9, end_col_offset=33), ImportFrom(module='pathlib', names=[alias(name='Path', lineno=10, col_offset=20, end_lineno=10, end_col_offset=24)], level=0, lineno=10, col_offset=0, end_lineno=10, end_col_offset=24), ImportFrom(module='typing', names=[alias(name='TYPE_CHECKING', lineno=11, col_offset=19, end_lineno=11, end_col_offset=32), alias(name='cast', lineno=11, col_offset=34, end_lineno=11, end_col_offset=38)], level=0, lineno=11, col_offset=0, end_lineno=11, end_col_offset=38), Import(names=[alias(name='numpy', asname='np', lineno=13, col_offset=7, end_lineno=13, end_col_offset=18)], lineno=13, col_offset=0, end_lineno=13, end_col_offset=18), Import(names=[alias(name='pyarrow', asname='pa', lineno=14, col_offset=7, end_lineno=14, end_col_offset=20)], lineno=14, col_offset=0, end_lineno=14, end_col_offset=20), Import(names=[alias(name='pyarrow.parquet', asname='pq', lineno=15, col_offset=7, end_lineno=15, end_col_offset=28)], lineno=15, col_offset=0, end_lineno=15, end_col_offset=28), If(test=Name(id='TYPE_CHECKING', ctx=Load(), lineno=17, col_offset=3, end_lineno=17, end_col_offset=16), body=[ImportFrom(module='collections.abc', names=[alias(name='Sequence', lineno=18, col_offset=32, end_lineno=18, end_col_offset=40)], level=0, lineno=18, col_offset=4, end_lineno=18, end_col_offset=40), ImportFrom(module='codeintel_rev.indexing.cast_chunker', names=[alias(name='Chunk', lineno=20, col_offset=52, end_lineno=20, end_col_offset=57)], level=0, lineno=20, col_offset=4, end_lineno=20, end_col_offset=57)], lineno=17, col_offset=0, end_lineno=20, end_col_offset=57), FunctionDef(name='get_chunks_schema', args=arguments(args=[arg(arg='vec_dim', annotation=Name(id='int', ctx=Load(), lineno=23, col_offset=31, end_lineno=23, end_col_offset=34), lineno=23, col_offset=22, end_lineno=23, end_col_offset=34)]), body=[Expr(value=Constant(value='Get Arrow schema for chunks table.\n\n    Parameters\n    ----------\n    vec_dim : int\n        Embedding dimension.\n\n    Returns\n    -------\n    pa.Schema\n        Arrow schema for chunks with embeddings.\n    ', lineno=24, col_offset=4, end_lineno=35, end_col_offset=7), lineno=24, col_offset=4, end_lineno=35, end_col_offset=7), Return(value=Call(func=Attribute(value=Name(id='pa', ctx=Load(), lineno=36, col_offset=11, end_lineno=36, end_col_offset=13), attr='schema', ctx=Load(), lineno=36, col_offset=11, end_lineno=36, end_col_offset=20), args=[List(elts=[Call(func=Attribute(value=Name(id='pa', ctx=Load(), lineno=38, col_offset=12, end_lineno=38, end_col_offset=14), attr='field', ctx=Load(), lineno=38, col_offset=12, end_lineno=38, end_col_offset=20), args=[Constant(value='id', lineno=38, col_offset=21, end_lineno=38, end_col_offset=25), Call(func=Attribute(value=Name(id='pa', ctx=Load(), lineno=38, col_offset=27, end_lineno=38, end_col_offset=29), attr='int64', ctx=Load(), lineno=38, col_offset=27, end_lineno=38, end_col_offset=35), lineno=38, col_offset=27, end_lineno=38, end_col_offset=37)], lineno=38, col_offset=12, end_lineno=38, end_col_offset=38), Call(func=Attribute(value=Name(id='pa', ctx=Load(), lineno=39, col_offset=12, end_lineno=39, end_col_offset=14), attr='field', ctx=Load(), lineno=39, col_offset=12, end_lineno=39, end_col_offset=20), args=[Constant(value='uri', lineno=39, col_offset=21, end_lineno=39, end_col_offset=26), Call(func=Attribute(value=Name(id='pa', ctx=Load(), lineno=39, col_offset=28, end_lineno=39, end_col_offset=30), attr='string', ctx=Load(), lineno=39, col_offset=28, end_lineno=39, end_col_offset=37), lineno=39, col_offset=28, end_lineno=39, end_col_offset=39)], lineno=39, col_offset=12, end_lineno=39, end_col_offset=40), Call(func=Attribute(value=Name(id='pa', ctx=Load(), lineno=40, col_offset=12, end_lineno=40, end_col_offset=14), attr='field', ctx=Load(), lineno=40, col_offset=12, end_lineno=40, end_col_offset=20), args=[Constant(value='start_line', lineno=40, col_offset=21, end_lineno=40, end_col_offset=33), Call(func=Attribute(value=Name(id='pa', ctx=Load(), lineno=40, col_offset=35, end_lineno=40, end_col_offset=37), attr='int32', ctx=Load(), lineno=40, col_offset=35, end_lineno=40, end_col_offset=43), lineno=40, col_offset=35, end_lineno=40, end_col_offset=45)], lineno=40, col_offset=12, end_lineno=40, end_col_offset=46), Call(func=Attribute(value=Name(id='pa', ctx=Load(), lineno=41, col_offset=12, end_lineno=41, end_col_offset=14), attr='field', ctx=Load(), lineno=41, col_offset=12, end_lineno=41, end_col_offset=20), args=[Constant(value='end_line', lineno=41, col_offset=21, end_lineno=41, end_col_offset=31), Call(func=Attribute(value=Name(id='pa', ctx=Load(), lineno=41, col_offset=33, end_lineno=41, end_col_offset=35), attr='int32', ctx=Load(), lineno=41, col_offset=33, end_lineno=41, end_col_offset=41), lineno=41, col_offset=33, end_lineno=41, end_col_offset=43)], lineno=41, col_offset=12, end_lineno=41, end_col_offset=44), Call(func=Attribute(value=Name(id='pa', ctx=Load(), lineno=42, col_offset=12, end_lineno=42, end_col_offset=14), attr='field', ctx=Load(), lineno=42, col_offset=12, end_lineno=42, end_col_offset=20), args=[Constant(value='start_byte', lineno=42, col_offset=21, end_lineno=42, end_col_offset=33), Call(func=Attribute(value=Name(id='pa', ctx=Load(), lineno=42, col_offset=35, end_lineno=42, end_col_offset=37), attr='int64', ctx=Load(), lineno=42, col_offset=35, end_lineno=42, end_col_offset=43), lineno=42, col_offset=35, end_lineno=42, end_col_offset=45)], lineno=42, col_offset=12, end_lineno=42, end_col_offset=46), Call(func=Attribute(value=Name(id='pa', ctx=Load(), lineno=43, col_offset=12, end_lineno=43, end_col_offset=14), attr='field', ctx=Load(), lineno=43, col_offset=12, end_lineno=43, end_col_offset=20), args=[Constant(value='end_byte', lineno=43, col_offset=21, end_lineno=43, end_col_offset=31), Call(func=Attribute(value=Name(id='pa', ctx=Load(), lineno=43, col_offset=33, end_lineno=43, end_col_offset=35), attr='int64', ctx=Load(), lineno=43, col_offset=33, end_lineno=43, end_col_offset=41), lineno=43, col_offset=33, end_lineno=43, end_col_offset=43)], lineno=43, col_offset=12, end_lineno=43, end_col_offset=44), Call(func=Attribute(value=Name(id='pa', ctx=Load(), lineno=44, col_offset=12, end_lineno=44, end_col_offset=14), attr='field', ctx=Load(), lineno=44, col_offset=12, end_lineno=44, end_col_offset=20), args=[Constant(value='preview', lineno=44, col_offset=21, end_lineno=44, end_col_offset=30), Call(func=Attribute(value=Name(id='pa', ctx=Load(), lineno=44, col_offset=32, end_lineno=44, end_col_offset=34), attr='string', ctx=Load(), lineno=44, col_offset=32, end_lineno=44, end_col_offset=41), lineno=44, col_offset=32, end_lineno=44, end_col_offset=43)], lineno=44, col_offset=12, end_lineno=44, end_col_offset=44), Call(func=Attribute(value=Name(id='pa', ctx=Load(), lineno=45, col_offset=12, end_lineno=45, end_col_offset=14), attr='field', ctx=Load(), lineno=45, col_offset=12, end_lineno=45, end_col_offset=20), args=[Constant(value='content', lineno=45, col_offset=21, end_lineno=45, end_col_offset=30), Call(func=Attribute(value=Name(id='pa', ctx=Load(), lineno=45, col_offset=32, end_lineno=45, end_col_offset=34), attr='string', ctx=Load(), lineno=45, col_offset=32, end_lineno=45, end_col_offset=41), lineno=45, col_offset=32, end_lineno=45, end_col_offset=43)], lineno=45, col_offset=12, end_lineno=45, end_col_offset=44), Call(func=Attribute(value=Name(id='pa', ctx=Load(), lineno=46, col_offset=12, end_lineno=46, end_col_offset=14), attr='field', ctx=Load(), lineno=46, col_offset=12, end_lineno=46, end_col_offset=20), args=[Constant(value='lang', lineno=46, col_offset=21, end_lineno=46, end_col_offset=27), Call(func=Attribute(value=Name(id='pa', ctx=Load(), lineno=46, col_offset=29, end_lineno=46, end_col_offset=31), attr='string', ctx=Load(), lineno=46, col_offset=29, end_lineno=46, end_col_offset=38), lineno=46, col_offset=29, end_lineno=46, end_col_offset=40)], lineno=46, col_offset=12, end_lineno=46, end_col_offset=41), Call(func=Attribute(value=Name(id='pa', ctx=Load(), lineno=47, col_offset=12, end_lineno=47, end_col_offset=14), attr='field', ctx=Load(), lineno=47, col_offset=12, end_lineno=47, end_col_offset=20), args=[Constant(value='embedding', lineno=47, col_offset=21, end_lineno=47, end_col_offset=32), Call(func=Attribute(value=Name(id='pa', ctx=Load(), lineno=47, col_offset=34, end_lineno=47, end_col_offset=36), attr='list_', ctx=Load(), lineno=47, col_offset=34, end_lineno=47, end_col_offset=42), args=[Call(func=Attribute(value=Name(id='pa', ctx=Load(), lineno=47, col_offset=43, end_lineno=47, end_col_offset=45), attr='float32', ctx=Load(), lineno=47, col_offset=43, end_lineno=47, end_col_offset=53), lineno=47, col_offset=43, end_lineno=47, end_col_offset=55), Name(id='vec_dim', ctx=Load(), lineno=47, col_offset=57, end_lineno=47, end_col_offset=64)], lineno=47, col_offset=34, end_lineno=47, end_col_offset=65)], lineno=47, col_offset=12, end_lineno=47, end_col_offset=66)], ctx=Load(), lineno=37, col_offset=8, end_lineno=48, end_col_offset=9)], lineno=36, col_offset=11, end_lineno=49, end_col_offset=5), lineno=36, col_offset=4, end_lineno=49, end_col_offset=5)], returns=Attribute(value=Name(id='pa', ctx=Load(), lineno=23, col_offset=39, end_lineno=23, end_col_offset=41), attr='Schema', ctx=Load(), lineno=23, col_offset=39, end_lineno=23, end_col_offset=48), lineno=23, col_offset=0, end_lineno=49, end_col_offset=5), ClassDef(name='ParquetWriteOptions', body=[Expr(value=Constant(value='Configuration for Parquet persistence.', lineno=54, col_offset=4, end_lineno=54, end_col_offset=48), lineno=54, col_offset=4, end_lineno=54, end_col_offset=48), AnnAssign(target=Name(id='start_id', ctx=Store(), lineno=56, col_offset=4, end_lineno=56, end_col_offset=12), annotation=Name(id='int', ctx=Load(), lineno=56, col_offset=14, end_lineno=56, end_col_offset=17), value=Constant(value=0, lineno=56, col_offset=20, end_lineno=56, end_col_offset=21), simple=1, lineno=56, col_offset=4, end_lineno=56, end_col_offset=21), AnnAssign(target=Name(id='vec_dim', ctx=Store(), lineno=57, col_offset=4, end_lineno=57, end_col_offset=11), annotation=Name(id='int', ctx=Load(), lineno=57, col_offset=13, end_lineno=57, end_col_offset=16), value=Constant(value=2560, lineno=57, col_offset=19, end_lineno=57, end_col_offset=23), simple=1, lineno=57, col_offset=4, end_lineno=57, end_col_offset=23), AnnAssign(target=Name(id='preview_max_chars', ctx=Store(), lineno=58, col_offset=4, end_lineno=58, end_col_offset=21), annotation=Name(id='int', ctx=Load(), lineno=58, col_offset=23, end_lineno=58, end_col_offset=26), value=Constant(value=240, lineno=58, col_offset=29, end_lineno=58, end_col_offset=32), simple=1, lineno=58, col_offset=4, end_lineno=58, end_col_offset=32)], decorator_list=[Call(func=Name(id='dataclass', ctx=Load(), lineno=52, col_offset=1, end_lineno=52, end_col_offset=10), keywords=[keyword(arg='slots', value=Constant(value=True, lineno=52, col_offset=17, end_lineno=52, end_col_offset=21), lineno=52, col_offset=11, end_lineno=52, end_col_offset=21), keyword(arg='frozen', value=Constant(value=True, lineno=52, col_offset=30, end_lineno=52, end_col_offset=34), lineno=52, col_offset=23, end_lineno=52, end_col_offset=34)], lineno=52, col_offset=1, end_lineno=52, end_col_offset=35)], lineno=53, col_offset=0, end_lineno=58, end_col_offset=32), FunctionDef(name='write_chunks_parquet', args=arguments(args=[arg(arg='output_path', annotation=Name(id='Path', ctx=Load(), lineno=62, col_offset=17, end_lineno=62, end_col_offset=21), lineno=62, col_offset=4, end_lineno=62, end_col_offset=21), arg(arg='chunks', annotation=Subscript(value=Name(id='Sequence', ctx=Load(), lineno=63, col_offset=12, end_lineno=63, end_col_offset=20), slice=Name(id='Chunk', ctx=Load(), lineno=63, col_offset=21, end_lineno=63, end_col_offset=26), ctx=Load(), lineno=63, col_offset=12, end_lineno=63, end_col_offset=27), lineno=63, col_offset=4, end_lineno=63, end_col_offset=27), arg(arg='embeddings', annotation=Attribute(value=Name(id='np', ctx=Load(), lineno=64, col_offset=16, end_lineno=64, end_col_offset=18), attr='ndarray', ctx=Load(), lineno=64, col_offset=16, end_lineno=64, end_col_offset=26), lineno=64, col_offset=4, end_lineno=64, end_col_offset=26)], kwonlyargs=[arg(arg='options', annotation=BinOp(left=Name(id='ParquetWriteOptions', ctx=Load(), lineno=66, col_offset=13, end_lineno=66, end_col_offset=32), op=BitOr(), right=Constant(value=None, lineno=66, col_offset=35, end_lineno=66, end_col_offset=39), lineno=66, col_offset=13, end_lineno=66, end_col_offset=39), lineno=66, col_offset=4, end_lineno=66, end_col_offset=39)], kw_defaults=[Constant(value=None, lineno=66, col_offset=42, end_lineno=66, end_col_offset=46)]), body=[Expr(value=Constant(value='Write chunks and embeddings to Parquet.\n\n    Parameters\n    ----------\n    output_path : Path\n        Output Parquet file path.\n    chunks : Sequence[Chunk]\n        Chunk metadata.\n    embeddings : np.ndarray\n        Embeddings array of shape (len(chunks), vec_dim).\n    options : ParquetWriteOptions | None, optional\n        Configuration for chunk identifiers, embedding dimension, and preview\n        truncation length. Defaults to :class:`ParquetWriteOptions`.\n\n    Raises\n    ------\n    ValueError\n        If chunks and embeddings length mismatch.\n    ', lineno=68, col_offset=4, end_lineno=86, end_col_offset=7), lineno=68, col_offset=4, end_lineno=86, end_col_offset=7), If(test=Compare(left=Name(id='options', ctx=Load(), lineno=87, col_offset=7, end_lineno=87, end_col_offset=14), ops=[Is()], comparators=[Constant(value=None, lineno=87, col_offset=18, end_lineno=87, end_col_offset=22)], lineno=87, col_offset=7, end_lineno=87, end_col_offset=22), body=[Assign(targets=[Name(id='options', ctx=Store(), lineno=88, col_offset=8, end_lineno=88, end_col_offset=15)], value=Call(func=Name(id='ParquetWriteOptions', ctx=Load(), lineno=88, col_offset=18, end_lineno=88, end_col_offset=37), lineno=88, col_offset=18, end_lineno=88, end_col_offset=39), lineno=88, col_offset=8, end_lineno=88, end_col_offset=39)], lineno=87, col_offset=4, end_lineno=88, end_col_offset=39), If(test=Compare(left=Call(func=Name(id='len', ctx=Load(), lineno=90, col_offset=7, end_lineno=90, end_col_offset=10), args=[Name(id='chunks', ctx=Load(), lineno=90, col_offset=11, end_lineno=90, end_col_offset=17)], lineno=90, col_offset=7, end_lineno=90, end_col_offset=18), ops=[NotEq()], comparators=[Call(func=Name(id='len', ctx=Load(), lineno=90, col_offset=22, end_lineno=90, end_col_offset=25), args=[Name(id='embeddings', ctx=Load(), lineno=90, col_offset=26, end_lineno=90, end_col_offset=36)], lineno=90, col_offset=22, end_lineno=90, end_col_offset=37)], lineno=90, col_offset=7, end_lineno=90, end_col_offset=37), body=[Assign(targets=[Name(id='msg', ctx=Store(), lineno=91, col_offset=8, end_lineno=91, end_col_offset=11)], value=JoinedStr(values=[Constant(value='Chunks (', lineno=91, col_offset=16, end_lineno=91, end_col_offset=24), FormattedValue(value=Call(func=Name(id='len', ctx=Load(), lineno=91, col_offset=25, end_lineno=91, end_col_offset=28), args=[Name(id='chunks', ctx=Load(), lineno=91, col_offset=29, end_lineno=91, end_col_offset=35)], lineno=91, col_offset=25, end_lineno=91, end_col_offset=36), conversion=-1, lineno=91, col_offset=24, end_lineno=91, end_col_offset=37), Constant(value=') and embeddings (', lineno=91, col_offset=37, end_lineno=91, end_col_offset=55), FormattedValue(value=Call(func=Name(id='len', ctx=Load(), lineno=91, col_offset=56, end_lineno=91, end_col_offset=59), args=[Name(id='embeddings', ctx=Load(), lineno=91, col_offset=60, end_lineno=91, end_col_offset=70)], lineno=91, col_offset=56, end_lineno=91, end_col_offset=71), conversion=-1, lineno=91, col_offset=55, end_lineno=91, end_col_offset=72), Constant(value=') length mismatch', lineno=91, col_offset=72, end_lineno=91, end_col_offset=89)], lineno=91, col_offset=14, end_lineno=91, end_col_offset=90), lineno=91, col_offset=8, end_lineno=91, end_col_offset=90), Raise(exc=Call(func=Name(id='ValueError', ctx=Load(), lineno=92, col_offset=14, end_lineno=92, end_col_offset=24), args=[Name(id='msg', ctx=Load(), lineno=92, col_offset=25, end_lineno=92, end_col_offset=28)], lineno=92, col_offset=14, end_lineno=92, end_col_offset=29), lineno=92, col_offset=8, end_lineno=92, end_col_offset=29)], lineno=90, col_offset=4, end_lineno=92, end_col_offset=29), Assign(targets=[Name(id='ids', ctx=Store(), lineno=95, col_offset=4, end_lineno=95, end_col_offset=7)], value=Call(func=Name(id='list', ctx=Load(), lineno=95, col_offset=10, end_lineno=95, end_col_offset=14), args=[Call(func=Name(id='range', ctx=Load(), lineno=95, col_offset=15, end_lineno=95, end_col_offset=20), args=[Attribute(value=Name(id='options', ctx=Load(), lineno=95, col_offset=21, end_lineno=95, end_col_offset=28), attr='start_id', ctx=Load(), lineno=95, col_offset=21, end_lineno=95, end_col_offset=37), BinOp(left=Attribute(value=Name(id='options', ctx=Load(), lineno=95, col_offset=39, end_lineno=95, end_col_offset=46), attr='start_id', ctx=Load(), lineno=95, col_offset=39, end_lineno=95, end_col_offset=55), op=Add(), right=Call(func=Name(id='len', ctx=Load(), lineno=95, col_offset=58, end_lineno=95, end_col_offset=61), args=[Name(id='chunks', ctx=Load(), lineno=95, col_offset=62, end_lineno=95, end_col_offset=68)], lineno=95, col_offset=58, end_lineno=95, end_col_offset=69), lineno=95, col_offset=39, end_lineno=95, end_col_offset=69)], lineno=95, col_offset=15, end_lineno=95, end_col_offset=70)], lineno=95, col_offset=10, end_lineno=95, end_col_offset=71), lineno=95, col_offset=4, end_lineno=95, end_col_offset=71), Assign(targets=[Name(id='uris', ctx=Store(), lineno=96, col_offset=4, end_lineno=96, end_col_offset=8)], value=ListComp(elt=Attribute(value=Name(id='c', ctx=Load(), lineno=96, col_offset=12, end_lineno=96, end_col_offset=13), attr='uri', ctx=Load(), lineno=96, col_offset=12, end_lineno=96, end_col_offset=17), generators=[comprehension(target=Name(id='c', ctx=Store(), lineno=96, col_offset=22, end_lineno=96, end_col_offset=23), iter=Name(id='chunks', ctx=Load(), lineno=96, col_offset=27, end_lineno=96, end_col_offset=33), is_async=0)], lineno=96, col_offset=11, end_lineno=96, end_col_offset=34), lineno=96, col_offset=4, end_lineno=96, end_col_offset=34), Assign(targets=[Name(id='start_lines', ctx=Store(), lineno=97, col_offset=4, end_lineno=97, end_col_offset=15)], value=ListComp(elt=Attribute(value=Name(id='c', ctx=Load(), lineno=97, col_offset=19, end_lineno=97, end_col_offset=20), attr='start_line', ctx=Load(), lineno=97, col_offset=19, end_lineno=97, end_col_offset=31), generators=[comprehension(target=Name(id='c', ctx=Store(), lineno=97, col_offset=36, end_lineno=97, end_col_offset=37), iter=Name(id='chunks', ctx=Load(), lineno=97, col_offset=41, end_lineno=97, end_col_offset=47), is_async=0)], lineno=97, col_offset=18, end_lineno=97, end_col_offset=48), lineno=97, col_offset=4, end_lineno=97, end_col_offset=48), Assign(targets=[Name(id='end_lines', ctx=Store(), lineno=98, col_offset=4, end_lineno=98, end_col_offset=13)], value=ListComp(elt=Attribute(value=Name(id='c', ctx=Load(), lineno=98, col_offset=17, end_lineno=98, end_col_offset=18), attr='end_line', ctx=Load(), lineno=98, col_offset=17, end_lineno=98, end_col_offset=27), generators=[comprehension(target=Name(id='c', ctx=Store(), lineno=98, col_offset=32, end_lineno=98, end_col_offset=33), iter=Name(id='chunks', ctx=Load(), lineno=98, col_offset=37, end_lineno=98, end_col_offset=43), is_async=0)], lineno=98, col_offset=16, end_lineno=98, end_col_offset=44), lineno=98, col_offset=4, end_lineno=98, end_col_offset=44), Assign(targets=[Name(id='start_bytes', ctx=Store(), lineno=99, col_offset=4, end_lineno=99, end_col_offset=15)], value=ListComp(elt=Attribute(value=Name(id='c', ctx=Load(), lineno=99, col_offset=19, end_lineno=99, end_col_offset=20), attr='start_byte', ctx=Load(), lineno=99, col_offset=19, end_lineno=99, end_col_offset=31), generators=[comprehension(target=Name(id='c', ctx=Store(), lineno=99, col_offset=36, end_lineno=99, end_col_offset=37), iter=Name(id='chunks', ctx=Load(), lineno=99, col_offset=41, end_lineno=99, end_col_offset=47), is_async=0)], lineno=99, col_offset=18, end_lineno=99, end_col_offset=48), lineno=99, col_offset=4, end_lineno=99, end_col_offset=48), Assign(targets=[Name(id='end_bytes', ctx=Store(), lineno=100, col_offset=4, end_lineno=100, end_col_offset=13)], value=ListComp(elt=Attribute(value=Name(id='c', ctx=Load(), lineno=100, col_offset=17, end_lineno=100, end_col_offset=18), attr='end_byte', ctx=Load(), lineno=100, col_offset=17, end_lineno=100, end_col_offset=27), generators=[comprehension(target=Name(id='c', ctx=Store(), lineno=100, col_offset=32, end_lineno=100, end_col_offset=33), iter=Name(id='chunks', ctx=Load(), lineno=100, col_offset=37, end_lineno=100, end_col_offset=43), is_async=0)], lineno=100, col_offset=16, end_lineno=100, end_col_offset=44), lineno=100, col_offset=4, end_lineno=100, end_col_offset=44), Assign(targets=[Name(id='previews', ctx=Store(), lineno=101, col_offset=4, end_lineno=101, end_col_offset=12)], value=ListComp(elt=Subscript(value=Attribute(value=Name(id='c', ctx=Load(), lineno=101, col_offset=16, end_lineno=101, end_col_offset=17), attr='text', ctx=Load(), lineno=101, col_offset=16, end_lineno=101, end_col_offset=22), slice=Slice(upper=Attribute(value=Name(id='options', ctx=Load(), lineno=101, col_offset=25, end_lineno=101, end_col_offset=32), attr='preview_max_chars', ctx=Load(), lineno=101, col_offset=25, end_lineno=101, end_col_offset=50), lineno=101, col_offset=23, end_lineno=101, end_col_offset=50), ctx=Load(), lineno=101, col_offset=16, end_lineno=101, end_col_offset=51), generators=[comprehension(target=Name(id='c', ctx=Store(), lineno=101, col_offset=56, end_lineno=101, end_col_offset=57), iter=Name(id='chunks', ctx=Load(), lineno=101, col_offset=61, end_lineno=101, end_col_offset=67), is_async=0)], lineno=101, col_offset=15, end_lineno=101, end_col_offset=68), lineno=101, col_offset=4, end_lineno=101, end_col_offset=68), Assign(targets=[Name(id='contents', ctx=Store(), lineno=102, col_offset=4, end_lineno=102, end_col_offset=12)], value=ListComp(elt=Attribute(value=Name(id='c', ctx=Load(), lineno=102, col_offset=16, end_lineno=102, end_col_offset=17), attr='text', ctx=Load(), lineno=102, col_offset=16, end_lineno=102, end_col_offset=22), generators=[comprehension(target=Name(id='c', ctx=Store(), lineno=102, col_offset=27, end_lineno=102, end_col_offset=28), iter=Name(id='chunks', ctx=Load(), lineno=102, col_offset=32, end_lineno=102, end_col_offset=38), is_async=0)], lineno=102, col_offset=15, end_lineno=102, end_col_offset=39), lineno=102, col_offset=4, end_lineno=102, end_col_offset=39), Assign(targets=[Name(id='languages', ctx=Store(), lineno=103, col_offset=4, end_lineno=103, end_col_offset=13)], value=ListComp(elt=Attribute(value=Name(id='c', ctx=Load(), lineno=103, col_offset=17, end_lineno=103, end_col_offset=18), attr='language', ctx=Load(), lineno=103, col_offset=17, end_lineno=103, end_col_offset=27), generators=[comprehension(target=Name(id='c', ctx=Store(), lineno=103, col_offset=32, end_lineno=103, end_col_offset=33), iter=Name(id='chunks', ctx=Load(), lineno=103, col_offset=37, end_lineno=103, end_col_offset=43), is_async=0)], lineno=103, col_offset=16, end_lineno=103, end_col_offset=44), lineno=103, col_offset=4, end_lineno=103, end_col_offset=44), Assign(targets=[Name(id='embeddings_flat', ctx=Store(), lineno=106, col_offset=4, end_lineno=106, end_col_offset=19)], value=Call(func=Attribute(value=Call(func=Attribute(value=Name(id='embeddings', ctx=Load(), lineno=106, col_offset=22, end_lineno=106, end_col_offset=32), attr='astype', ctx=Load(), lineno=106, col_offset=22, end_lineno=106, end_col_offset=39), args=[Attribute(value=Name(id='np', ctx=Load(), lineno=106, col_offset=40, end_lineno=106, end_col_offset=42), attr='float32', ctx=Load(), lineno=106, col_offset=40, end_lineno=106, end_col_offset=50)], lineno=106, col_offset=22, end_lineno=106, end_col_offset=51), attr='ravel', ctx=Load(), lineno=106, col_offset=22, end_lineno=106, end_col_offset=57), lineno=106, col_offset=22, end_lineno=106, end_col_offset=59), lineno=106, col_offset=4, end_lineno=106, end_col_offset=59), Assign(targets=[Name(id='embedding_array', ctx=Store(), lineno=107, col_offset=4, end_lineno=107, end_col_offset=19)], value=Call(func=Attribute(value=Attribute(value=Name(id='pa', ctx=Load(), lineno=107, col_offset=22, end_lineno=107, end_col_offset=24), attr='FixedSizeListArray', ctx=Load(), lineno=107, col_offset=22, end_lineno=107, end_col_offset=43), attr='from_arrays', ctx=Load(), lineno=107, col_offset=22, end_lineno=107, end_col_offset=55), args=[Call(func=Attribute(value=Name(id='pa', ctx=Load(), lineno=108, col_offset=8, end_lineno=108, end_col_offset=10), attr='array', ctx=Load(), lineno=108, col_offset=8, end_lineno=108, end_col_offset=16), args=[Name(id='embeddings_flat', ctx=Load(), lineno=108, col_offset=17, end_lineno=108, end_col_offset=32)], keywords=[keyword(arg='type', value=Call(func=Attribute(value=Name(id='pa', ctx=Load(), lineno=108, col_offset=39, end_lineno=108, end_col_offset=41), attr='float32', ctx=Load(), lineno=108, col_offset=39, end_lineno=108, end_col_offset=49), lineno=108, col_offset=39, end_lineno=108, end_col_offset=51), lineno=108, col_offset=34, end_lineno=108, end_col_offset=51)], lineno=108, col_offset=8, end_lineno=108, end_col_offset=52), Attribute(value=Name(id='options', ctx=Load(), lineno=109, col_offset=8, end_lineno=109, end_col_offset=15), attr='vec_dim', ctx=Load(), lineno=109, col_offset=8, end_lineno=109, end_col_offset=23)], lineno=107, col_offset=22, end_lineno=110, end_col_offset=5), lineno=107, col_offset=4, end_lineno=110, end_col_offset=5), Assign(targets=[Name(id='table', ctx=Store(), lineno=113, col_offset=4, end_lineno=113, end_col_offset=9)], value=Call(func=Attribute(value=Name(id='pa', ctx=Load(), lineno=113, col_offset=12, end_lineno=113, end_col_offset=14), attr='table', ctx=Load(), lineno=113, col_offset=12, end_lineno=113, end_col_offset=20), args=[Dict(keys=[Constant(value='id', lineno=115, col_offset=12, end_lineno=115, end_col_offset=16), Constant(value='uri', lineno=116, col_offset=12, end_lineno=116, end_col_offset=17), Constant(value='start_line', lineno=117, col_offset=12, end_lineno=117, end_col_offset=24), Constant(value='end_line', lineno=118, col_offset=12, end_lineno=118, end_col_offset=22), Constant(value='start_byte', lineno=119, col_offset=12, end_lineno=119, end_col_offset=24), Constant(value='end_byte', lineno=120, col_offset=12, end_lineno=120, end_col_offset=22), Constant(value='preview', lineno=121, col_offset=12, end_lineno=121, end_col_offset=21), Constant(value='content', lineno=122, col_offset=12, end_lineno=122, end_col_offset=21), Constant(value='lang', lineno=123, col_offset=12, end_lineno=123, end_col_offset=18), Constant(value='embedding', lineno=124, col_offset=12, end_lineno=124, end_col_offset=23)], values=[Name(id='ids', ctx=Load(), lineno=115, col_offset=18, end_lineno=115, end_col_offset=21), Name(id='uris', ctx=Load(), lineno=116, col_offset=19, end_lineno=116, end_col_offset=23), Name(id='start_lines', ctx=Load(), lineno=117, col_offset=26, end_lineno=117, end_col_offset=37), Name(id='end_lines', ctx=Load(), lineno=118, col_offset=24, end_lineno=118, end_col_offset=33), Name(id='start_bytes', ctx=Load(), lineno=119, col_offset=26, end_lineno=119, end_col_offset=37), Name(id='end_bytes', ctx=Load(), lineno=120, col_offset=24, end_lineno=120, end_col_offset=33), Name(id='previews', ctx=Load(), lineno=121, col_offset=23, end_lineno=121, end_col_offset=31), Name(id='contents', ctx=Load(), lineno=122, col_offset=23, end_lineno=122, end_col_offset=31), Name(id='languages', ctx=Load(), lineno=123, col_offset=20, end_lineno=123, end_col_offset=29), Name(id='embedding_array', ctx=Load(), lineno=124, col_offset=25, end_lineno=124, end_col_offset=40)], lineno=114, col_offset=8, end_lineno=125, end_col_offset=9)], keywords=[keyword(arg='schema', value=Call(func=Name(id='get_chunks_schema', ctx=Load(), lineno=126, col_offset=15, end_lineno=126, end_col_offset=32), args=[Attribute(value=Name(id='options', ctx=Load(), lineno=126, col_offset=33, end_lineno=126, end_col_offset=40), attr='vec_dim', ctx=Load(), lineno=126, col_offset=33, end_lineno=126, end_col_offset=48)], lineno=126, col_offset=15, end_lineno=126, end_col_offset=49), lineno=126, col_offset=8, end_lineno=126, end_col_offset=49)], lineno=113, col_offset=12, end_lineno=127, end_col_offset=5), lineno=113, col_offset=4, end_lineno=127, end_col_offset=5), Expr(value=Call(func=Attribute(value=Attribute(value=Name(id='output_path', ctx=Load(), lineno=130, col_offset=4, end_lineno=130, end_col_offset=15), attr='parent', ctx=Load(), lineno=130, col_offset=4, end_lineno=130, end_col_offset=22), attr='mkdir', ctx=Load(), lineno=130, col_offset=4, end_lineno=130, end_col_offset=28), keywords=[keyword(arg='parents', value=Constant(value=True, lineno=130, col_offset=37, end_lineno=130, end_col_offset=41), lineno=130, col_offset=29, end_lineno=130, end_col_offset=41), keyword(arg='exist_ok', value=Constant(value=True, lineno=130, col_offset=52, end_lineno=130, end_col_offset=56), lineno=130, col_offset=43, end_lineno=130, end_col_offset=56)], lineno=130, col_offset=4, end_lineno=130, end_col_offset=57), lineno=130, col_offset=4, end_lineno=130, end_col_offset=57), Expr(value=Call(func=Attribute(value=Name(id='pq', ctx=Load(), lineno=131, col_offset=4, end_lineno=131, end_col_offset=6), attr='write_table', ctx=Load(), lineno=131, col_offset=4, end_lineno=131, end_col_offset=18), args=[Name(id='table', ctx=Load(), lineno=132, col_offset=8, end_lineno=132, end_col_offset=13), Name(id='output_path', ctx=Load(), lineno=133, col_offset=8, end_lineno=133, end_col_offset=19)], keywords=[keyword(arg='compression', value=Constant(value='snappy', lineno=134, col_offset=20, end_lineno=134, end_col_offset=28), lineno=134, col_offset=8, end_lineno=134, end_col_offset=28), keyword(arg='use_dictionary', value=Constant(value=True, lineno=135, col_offset=23, end_lineno=135, end_col_offset=27), lineno=135, col_offset=8, end_lineno=135, end_col_offset=27)], lineno=131, col_offset=4, end_lineno=136, end_col_offset=5), lineno=131, col_offset=4, end_lineno=136, end_col_offset=5)], returns=Constant(value=None, lineno=67, col_offset=5, end_lineno=67, end_col_offset=9), lineno=61, col_offset=0, end_lineno=136, end_col_offset=5), FunctionDef(name='read_chunks_parquet', args=arguments(args=[arg(arg='parquet_path', annotation=Name(id='Path', ctx=Load(), lineno=139, col_offset=38, end_lineno=139, end_col_offset=42), lineno=139, col_offset=24, end_lineno=139, end_col_offset=42)]), body=[Expr(value=Constant(value='Read chunks from Parquet file.\n\n    Parameters\n    ----------\n    parquet_path : Path\n        Parquet file path.\n\n    Returns\n    -------\n    pa.Table\n        Chunks table.\n    ', lineno=140, col_offset=4, end_lineno=151, end_col_offset=7), lineno=140, col_offset=4, end_lineno=151, end_col_offset=7), Return(value=Call(func=Attribute(value=Name(id='pq', ctx=Load(), lineno=152, col_offset=11, end_lineno=152, end_col_offset=13), attr='read_table', ctx=Load(), lineno=152, col_offset=11, end_lineno=152, end_col_offset=24), args=[Name(id='parquet_path', ctx=Load(), lineno=152, col_offset=25, end_lineno=152, end_col_offset=37)], lineno=152, col_offset=11, end_lineno=152, end_col_offset=38), lineno=152, col_offset=4, end_lineno=152, end_col_offset=38)], returns=Attribute(value=Name(id='pa', ctx=Load(), lineno=139, col_offset=47, end_lineno=139, end_col_offset=49), attr='Table', ctx=Load(), lineno=139, col_offset=47, end_lineno=139, end_col_offset=55), lineno=139, col_offset=0, end_lineno=152, end_col_offset=38), FunctionDef(name='extract_embeddings', args=arguments(args=[arg(arg='table', annotation=Attribute(value=Name(id='pa', ctx=Load(), lineno=155, col_offset=30, end_lineno=155, end_col_offset=32), attr='Table', ctx=Load(), lineno=155, col_offset=30, end_lineno=155, end_col_offset=38), lineno=155, col_offset=23, end_lineno=155, end_col_offset=38)]), body=[Expr(value=Constant(value='Extract embeddings from chunks table.\n\n    Parameters\n    ----------\n    table : pa.Table\n        Chunks table with embedding column.\n\n    Returns\n    -------\n    np.ndarray\n        Embeddings array of shape (num_rows, vec_dim).\n\n    Raises\n    ------\n    TypeError\n        If the embedding column is not stored as a FixedSizeListArray.\n    ', lineno=156, col_offset=4, end_lineno=172, end_col_offset=7), lineno=156, col_offset=4, end_lineno=172, end_col_offset=7), Assign(targets=[Name(id='chunked', ctx=Store(), lineno=173, col_offset=4, end_lineno=173, end_col_offset=11)], value=Call(func=Attribute(value=Name(id='table', ctx=Load(), lineno=173, col_offset=14, end_lineno=173, end_col_offset=19), attr='column', ctx=Load(), lineno=173, col_offset=14, end_lineno=173, end_col_offset=26), args=[Constant(value='embedding', lineno=173, col_offset=27, end_lineno=173, end_col_offset=38)], lineno=173, col_offset=14, end_lineno=173, end_col_offset=39), lineno=173, col_offset=4, end_lineno=173, end_col_offset=39), Assign(targets=[Name(id='dense_array', ctx=Store(), lineno=174, col_offset=4, end_lineno=174, end_col_offset=15)], value=Call(func=Attribute(value=Name(id='chunked', ctx=Load(), lineno=174, col_offset=18, end_lineno=174, end_col_offset=25), attr='combine_chunks', ctx=Load(), lineno=174, col_offset=18, end_lineno=174, end_col_offset=40), lineno=174, col_offset=18, end_lineno=174, end_col_offset=42), lineno=174, col_offset=4, end_lineno=174, end_col_offset=42), If(test=UnaryOp(op=Not(), operand=Call(func=Name(id='isinstance', ctx=Load(), lineno=175, col_offset=11, end_lineno=175, end_col_offset=21), args=[Name(id='dense_array', ctx=Load(), lineno=175, col_offset=22, end_lineno=175, end_col_offset=33), Attribute(value=Name(id='pa', ctx=Load(), lineno=175, col_offset=35, end_lineno=175, end_col_offset=37), attr='FixedSizeListArray', ctx=Load(), lineno=175, col_offset=35, end_lineno=175, end_col_offset=56)], lineno=175, col_offset=11, end_lineno=175, end_col_offset=57), lineno=175, col_offset=7, end_lineno=175, end_col_offset=57), body=[Assign(targets=[Name(id='msg', ctx=Store(), lineno=176, col_offset=8, end_lineno=176, end_col_offset=11)], value=Constant(value='Embedding column is not a FixedSizeListArray', lineno=176, col_offset=14, end_lineno=176, end_col_offset=60), lineno=176, col_offset=8, end_lineno=176, end_col_offset=60), Raise(exc=Call(func=Name(id='TypeError', ctx=Load(), lineno=177, col_offset=14, end_lineno=177, end_col_offset=23), args=[Name(id='msg', ctx=Load(), lineno=177, col_offset=24, end_lineno=177, end_col_offset=27)], lineno=177, col_offset=14, end_lineno=177, end_col_offset=28), lineno=177, col_offset=8, end_lineno=177, end_col_offset=28)], lineno=175, col_offset=4, end_lineno=177, end_col_offset=28), Assign(targets=[Name(id='fixed_array', ctx=Store(), lineno=179, col_offset=4, end_lineno=179, end_col_offset=15)], value=Call(func=Name(id='cast', ctx=Load(), lineno=179, col_offset=18, end_lineno=179, end_col_offset=22), args=[Constant(value='pa.FixedSizeListArray', lineno=179, col_offset=23, end_lineno=179, end_col_offset=46), Name(id='dense_array', ctx=Load(), lineno=179, col_offset=48, end_lineno=179, end_col_offset=59)], lineno=179, col_offset=18, end_lineno=179, end_col_offset=60), lineno=179, col_offset=4, end_lineno=179, end_col_offset=60), AnnAssign(target=Name(id='vec_dim', ctx=Store(), lineno=181, col_offset=4, end_lineno=181, end_col_offset=11), annotation=Name(id='int', ctx=Load(), lineno=181, col_offset=13, end_lineno=181, end_col_offset=16), value=Attribute(value=Attribute(value=Name(id='fixed_array', ctx=Load(), lineno=181, col_offset=19, end_lineno=181, end_col_offset=30), attr='type', ctx=Load(), lineno=181, col_offset=19, end_lineno=181, end_col_offset=35), attr='list_size', ctx=Load(), lineno=181, col_offset=19, end_lineno=181, end_col_offset=45), simple=1, lineno=181, col_offset=4, end_lineno=181, end_col_offset=45), Assign(targets=[Name(id='flat_values', ctx=Store(), lineno=182, col_offset=4, end_lineno=182, end_col_offset=15)], value=Call(func=Attribute(value=Attribute(value=Name(id='fixed_array', ctx=Load(), lineno=182, col_offset=18, end_lineno=182, end_col_offset=29), attr='values', ctx=Load(), lineno=182, col_offset=18, end_lineno=182, end_col_offset=36), attr='to_numpy', ctx=Load(), lineno=182, col_offset=18, end_lineno=182, end_col_offset=45), keywords=[keyword(arg='zero_copy_only', value=Constant(value=False, lineno=182, col_offset=61, end_lineno=182, end_col_offset=66), lineno=182, col_offset=46, end_lineno=182, end_col_offset=66)], lineno=182, col_offset=18, end_lineno=182, end_col_offset=67), lineno=182, col_offset=4, end_lineno=182, end_col_offset=67), Return(value=Call(func=Attribute(value=Name(id='flat_values', ctx=Load(), lineno=183, col_offset=11, end_lineno=183, end_col_offset=22), attr='reshape', ctx=Load(), lineno=183, col_offset=11, end_lineno=183, end_col_offset=30), args=[UnaryOp(op=USub(), operand=Constant(value=1, lineno=183, col_offset=32, end_lineno=183, end_col_offset=33), lineno=183, col_offset=31, end_lineno=183, end_col_offset=33), Name(id='vec_dim', ctx=Load(), lineno=183, col_offset=35, end_lineno=183, end_col_offset=42)], lineno=183, col_offset=11, end_lineno=183, end_col_offset=43), lineno=183, col_offset=4, end_lineno=183, end_col_offset=43)], returns=Attribute(value=Name(id='np', ctx=Load(), lineno=155, col_offset=43, end_lineno=155, end_col_offset=45), attr='ndarray', ctx=Load(), lineno=155, col_offset=43, end_lineno=155, end_col_offset=53), lineno=155, col_offset=0, end_lineno=183, end_col_offset=43), Assign(targets=[Name(id='__all__', ctx=Store(), lineno=186, col_offset=0, end_lineno=186, end_col_offset=7)], value=List(elts=[Constant(value='ParquetWriteOptions', lineno=187, col_offset=4, end_lineno=187, end_col_offset=25), Constant(value='extract_embeddings', lineno=188, col_offset=4, end_lineno=188, end_col_offset=24), Constant(value='get_chunks_schema', lineno=189, col_offset=4, end_lineno=189, end_col_offset=23), Constant(value='read_chunks_parquet', lineno=190, col_offset=4, end_lineno=190, end_col_offset=25), Constant(value='write_chunks_parquet', lineno=191, col_offset=4, end_lineno=191, end_col_offset=26)], ctx=Load(), lineno=186, col_offset=10, end_lineno=192, end_col_offset=1), lineno=186, col_offset=0, end_lineno=192, end_col_offset=1)])