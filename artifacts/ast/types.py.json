Module(body=[Expr(value=Constant(value='Vector search protocols and typed result structures.\n\nThis module defines PEP 544 protocols for FAISS-compatible vector search\nand typed result structures using TypedDict/dataclass. All protocols and\ntypes are fully typed to enable Pyright and Pyrefly strict checking.\n\nExamples\n--------\n>>> from kgfoundry.search_api.types import VectorSearchResult, FaissIndexProtocol\n>>> from numpy.typing import NDArray\n>>> import numpy as np\n>>> # Protocol usage\n>>> class MyIndex:\n...     def add(self, vectors: NDArray[np.float32]) -> None: ...\n...     def search(\n...         self, vectors: NDArray[np.float32], k: int\n...     ) -> tuple[NDArray[np.float32], NDArray[np.int64]]: ...\n>>> # Verify protocol satisfaction\n>>> def use_index(idx: FaissIndexProtocol) -> None:\n...     vecs = np.array([[1.0, 2.0]], dtype=np.float32)\n...     idx.add(vecs)\n...     distances, indices = idx.search(vecs, k=5)\n', lineno=1, col_offset=0, end_lineno=23, end_col_offset=3), lineno=1, col_offset=0, end_lineno=23, end_col_offset=3), ImportFrom(module='__future__', names=[alias(name='annotations', lineno=27, col_offset=23, end_lineno=27, end_col_offset=34)], level=0, lineno=27, col_offset=0, end_lineno=27, end_col_offset=34), ImportFrom(module='collections.abc', names=[alias(name='Mapping', lineno=29, col_offset=28, end_lineno=29, end_col_offset=35)], level=0, lineno=29, col_offset=0, end_lineno=29, end_col_offset=35), ImportFrom(module='contextlib', names=[alias(name='suppress', lineno=30, col_offset=23, end_lineno=30, end_col_offset=31)], level=0, lineno=30, col_offset=0, end_lineno=30, end_col_offset=31), ImportFrom(module='dataclasses', names=[alias(name='dataclass', lineno=31, col_offset=24, end_lineno=31, end_col_offset=33)], level=0, lineno=31, col_offset=0, end_lineno=31, end_col_offset=33), ImportFrom(module='operator', names=[alias(name='attrgetter', lineno=32, col_offset=21, end_lineno=32, end_col_offset=31)], level=0, lineno=32, col_offset=0, end_lineno=32, end_col_offset=31), ImportFrom(module='typing', names=[alias(name='TYPE_CHECKING', lineno=33, col_offset=19, end_lineno=33, end_col_offset=32), alias(name='Protocol', lineno=33, col_offset=34, end_lineno=33, end_col_offset=42), alias(name='TypedDict', lineno=33, col_offset=44, end_lineno=33, end_col_offset=53), alias(name='cast', lineno=33, col_offset=55, end_lineno=33, end_col_offset=59)], level=0, lineno=33, col_offset=0, end_lineno=33, end_col_offset=59), Import(names=[alias(name='numpy', asname='np', lineno=35, col_offset=7, end_lineno=35, end_col_offset=18)], lineno=35, col_offset=0, end_lineno=35, end_col_offset=18), ImportFrom(module='kgfoundry_common.navmap_loader', names=[alias(name='load_nav_metadata', lineno=37, col_offset=43, end_lineno=37, end_col_offset=60)], level=0, lineno=37, col_offset=0, end_lineno=37, end_col_offset=60), ImportFrom(module='kgfoundry_common.problem_details', names=[alias(name='JsonValue', lineno=38, col_offset=45, end_lineno=38, end_col_offset=54)], level=0, lineno=38, col_offset=0, end_lineno=38, end_col_offset=54), If(test=Name(id='TYPE_CHECKING', ctx=Load(), lineno=40, col_offset=3, end_lineno=40, end_col_offset=16), body=[ImportFrom(module='numpy.typing', names=[alias(name='NDArray', lineno=41, col_offset=29, end_lineno=41, end_col_offset=36)], level=0, lineno=41, col_offset=4, end_lineno=41, end_col_offset=36)], lineno=40, col_offset=0, end_lineno=41, end_col_offset=36), Assign(targets=[Name(id='__all__', ctx=Store(), lineno=44, col_offset=0, end_lineno=44, end_col_offset=7)], value=List(elts=[Constant(value='AgentSearchQuery', lineno=45, col_offset=4, end_lineno=45, end_col_offset=22), Constant(value='AgentSearchResponse', lineno=46, col_offset=4, end_lineno=46, end_col_offset=25), Constant(value='BM25IndexProtocol', lineno=47, col_offset=4, end_lineno=47, end_col_offset=23), Constant(value='FaissIndexProtocol', lineno=48, col_offset=4, end_lineno=48, end_col_offset=24), Constant(value='FaissModuleProtocol', lineno=49, col_offset=4, end_lineno=49, end_col_offset=25), Constant(value='GpuClonerOptionsProtocol', lineno=50, col_offset=4, end_lineno=50, end_col_offset=30), Constant(value='GpuResourcesProtocol', lineno=51, col_offset=4, end_lineno=51, end_col_offset=26), Constant(value='IndexArray', lineno=52, col_offset=4, end_lineno=52, end_col_offset=16), Constant(value='SpladeEncoderProtocol', lineno=53, col_offset=4, end_lineno=53, end_col_offset=27), Constant(value='VectorArray', lineno=54, col_offset=4, end_lineno=54, end_col_offset=17), Constant(value='VectorSearchResult', lineno=55, col_offset=4, end_lineno=55, end_col_offset=24), Constant(value='VectorSearchResultTypedDict', lineno=56, col_offset=4, end_lineno=56, end_col_offset=33), Constant(value='wrap_faiss_module', lineno=57, col_offset=4, end_lineno=57, end_col_offset=23)], ctx=Load(), lineno=44, col_offset=10, end_lineno=58, end_col_offset=1), lineno=44, col_offset=0, end_lineno=58, end_col_offset=1), Assign(targets=[Name(id='__navmap__', ctx=Store(), lineno=59, col_offset=0, end_lineno=59, end_col_offset=10)], value=Call(func=Name(id='load_nav_metadata', ctx=Load(), lineno=59, col_offset=13, end_lineno=59, end_col_offset=30), args=[Name(id='__name__', ctx=Load(), lineno=59, col_offset=31, end_lineno=59, end_col_offset=39), Call(func=Name(id='tuple', ctx=Load(), lineno=59, col_offset=41, end_lineno=59, end_col_offset=46), args=[Name(id='__all__', ctx=Load(), lineno=59, col_offset=47, end_lineno=59, end_col_offset=54)], lineno=59, col_offset=41, end_lineno=59, end_col_offset=55)], lineno=59, col_offset=13, end_lineno=59, end_col_offset=56), lineno=59, col_offset=0, end_lineno=59, end_col_offset=56), If(test=Name(id='TYPE_CHECKING', ctx=Load(), lineno=63, col_offset=3, end_lineno=63, end_col_offset=16), body=[ImportFrom(module='collections.abc', names=[alias(name='Callable', lineno=64, col_offset=32, end_lineno=64, end_col_offset=40), alias(name='Sequence', lineno=64, col_offset=42, end_lineno=64, end_col_offset=50)], level=0, lineno=64, col_offset=4, end_lineno=64, end_col_offset=50), Import(names=[alias(name='numpy.typing', asname='npt', lineno=66, col_offset=11, end_lineno=66, end_col_offset=30)], lineno=66, col_offset=4, end_lineno=66, end_col_offset=30), TypeAlias(name=Name(id='VectorArray', ctx=Store(), lineno=68, col_offset=9, end_lineno=68, end_col_offset=20), value=Subscript(value=Attribute(value=Name(id='npt', ctx=Load(), lineno=68, col_offset=23, end_lineno=68, end_col_offset=26), attr='NDArray', ctx=Load(), lineno=68, col_offset=23, end_lineno=68, end_col_offset=34), slice=Attribute(value=Name(id='np', ctx=Load(), lineno=68, col_offset=35, end_lineno=68, end_col_offset=37), attr='float32', ctx=Load(), lineno=68, col_offset=35, end_lineno=68, end_col_offset=45), ctx=Load(), lineno=68, col_offset=23, end_lineno=68, end_col_offset=46), lineno=68, col_offset=4, end_lineno=68, end_col_offset=46), TypeAlias(name=Name(id='IndexArray', ctx=Store(), lineno=69, col_offset=9, end_lineno=69, end_col_offset=19), value=Subscript(value=Attribute(value=Name(id='npt', ctx=Load(), lineno=69, col_offset=22, end_lineno=69, end_col_offset=25), attr='NDArray', ctx=Load(), lineno=69, col_offset=22, end_lineno=69, end_col_offset=33), slice=Attribute(value=Name(id='np', ctx=Load(), lineno=69, col_offset=34, end_lineno=69, end_col_offset=36), attr='int64', ctx=Load(), lineno=69, col_offset=34, end_lineno=69, end_col_offset=42), ctx=Load(), lineno=69, col_offset=22, end_lineno=69, end_col_offset=43), lineno=69, col_offset=4, end_lineno=69, end_col_offset=43)], orelse=[Assign(targets=[Name(id='VectorArray', ctx=Store(), lineno=71, col_offset=4, end_lineno=71, end_col_offset=15)], value=Attribute(value=Name(id='np', ctx=Load(), lineno=71, col_offset=18, end_lineno=71, end_col_offset=20), attr='ndarray', ctx=Load(), lineno=71, col_offset=18, end_lineno=71, end_col_offset=28), lineno=71, col_offset=4, end_lineno=71, end_col_offset=28), Assign(targets=[Name(id='IndexArray', ctx=Store(), lineno=72, col_offset=4, end_lineno=72, end_col_offset=14)], value=Attribute(value=Name(id='np', ctx=Load(), lineno=72, col_offset=17, end_lineno=72, end_col_offset=19), attr='ndarray', ctx=Load(), lineno=72, col_offset=17, end_lineno=72, end_col_offset=27), lineno=72, col_offset=4, end_lineno=72, end_col_offset=27)], lineno=63, col_offset=0, end_lineno=72, end_col_offset=27), With(items=[withitem(context_expr=Call(func=Name(id='suppress', ctx=Load(), lineno=74, col_offset=5, end_lineno=74, end_col_offset=13), args=[Name(id='AttributeError', ctx=Load(), lineno=74, col_offset=14, end_lineno=74, end_col_offset=28), Name(id='TypeError', ctx=Load(), lineno=74, col_offset=30, end_lineno=74, end_col_offset=39)], lineno=74, col_offset=5, end_lineno=74, end_col_offset=40))], body=[Assign(targets=[Attribute(value=Name(id='VectorArray', ctx=Load(), lineno=75, col_offset=4, end_lineno=75, end_col_offset=15), attr='__doc__', ctx=Store(), lineno=75, col_offset=4, end_lineno=75, end_col_offset=23)], value=Constant(value='Type alias for float32 vector arrays used in FAISS operations.\n\nAll vectors must be normalized to unit length for inner-product search.\nDimensions are typically 2560 for dense embeddings or configurable for\nsparse representations.', lineno=76, col_offset=8, end_lineno=79, end_col_offset=33), lineno=75, col_offset=4, end_lineno=80, end_col_offset=5)], lineno=74, col_offset=0, end_lineno=80, end_col_offset=5), With(items=[withitem(context_expr=Call(func=Name(id='suppress', ctx=Load(), lineno=82, col_offset=5, end_lineno=82, end_col_offset=13), args=[Name(id='AttributeError', ctx=Load(), lineno=82, col_offset=14, end_lineno=82, end_col_offset=28), Name(id='TypeError', ctx=Load(), lineno=82, col_offset=30, end_lineno=82, end_col_offset=39)], lineno=82, col_offset=5, end_lineno=82, end_col_offset=40))], body=[Assign(targets=[Attribute(value=Name(id='IndexArray', ctx=Load(), lineno=83, col_offset=4, end_lineno=83, end_col_offset=14), attr='__doc__', ctx=Store(), lineno=83, col_offset=4, end_lineno=83, end_col_offset=22)], value=Constant(value='Type alias for int64 index arrays used in FAISS search results.\n\nIndex arrays contain row indices into the vector store, typically returned\nfrom search operations alongside distance/similarity scores.', lineno=84, col_offset=8, end_lineno=86, end_col_offset=70), lineno=83, col_offset=4, end_lineno=87, end_col_offset=5)], lineno=82, col_offset=0, end_lineno=87, end_col_offset=5), ClassDef(name='FaissIndexProtocol', bases=[Name(id='Protocol', ctx=Load(), lineno=91, col_offset=25, end_lineno=91, end_col_offset=33)], body=[Expr(value=Constant(value='Protocol for FAISS-compatible vector indexes.\n\n    This protocol defines the minimum interface required for vector search\n    operations. Implementations may support additional features (GPU acceleration,\n    quantization, etc.) but must satisfy these core methods.\n\n    Performance expectations:\n    - `add()`: O(n) where n is the number of vectors; may require training first\n    - `search()`: O(k * log(n)) for approximate indexes; O(n) for exact search\n    - Indexes are typically trained before adding vectors (not shown in protocol)\n\n    Concurrency notes:\n    - Index operations are not thread-safe; serialize access from multiple threads\n    - GPU indexes may block the calling thread during kernel execution\n    - For async code, run index operations in thread pools to avoid blocking\n\n    Examples\n    --------\n    >>> import numpy as np\n    >>> from kgfoundry.search_api.types import FaissIndexProtocol, VectorArray\n    >>> class SimpleIndex:\n    ...     def add(self, vectors: VectorArray) -> None:\n    ...         self._vectors = vectors\n    ...\n    ...     def search(\n    ...         self, vectors: VectorArray, k: int\n    ...     ) -> tuple[NDArray[np.float32], NDArray[np.int64]]:\n    ...         # Simple inner product search\n    ...         scores = vectors @ self._vectors.T\n    ...         indices = np.argsort(-scores, axis=1)[:, :k]\n    ...         distances = np.take_along_axis(scores, indices, axis=1)\n    ...         return distances.astype(np.float32), indices.astype(np.int64)\n    >>> idx: FaissIndexProtocol = SimpleIndex()\n    ', lineno=92, col_offset=4, end_lineno=125, end_col_offset=7), lineno=92, col_offset=4, end_lineno=125, end_col_offset=7), FunctionDef(name='add', args=arguments(args=[arg(arg='self', lineno=127, col_offset=12, end_lineno=127, end_col_offset=16), arg(arg='vectors', annotation=Name(id='VectorArray', ctx=Load(), lineno=127, col_offset=27, end_lineno=127, end_col_offset=38), lineno=127, col_offset=18, end_lineno=127, end_col_offset=38)]), body=[Expr(value=Constant(value='Add vectors to the index.\n\n        Adds vectors to the index for future search operations. Vectors must\n        match the index dimension and be normalized to unit length for\n        inner-product search.\n\n        Parameters\n        ----------\n        vectors : VectorArray\n            Array of shape (n_vectors, dimension) with float32 dtype.\n            Vectors should be normalized to unit length for inner-product search.\n        ', lineno=128, col_offset=8, end_lineno=139, end_col_offset=11), lineno=128, col_offset=8, end_lineno=139, end_col_offset=11), Expr(value=Constant(value=Ellipsis, lineno=140, col_offset=8, end_lineno=140, end_col_offset=11), lineno=140, col_offset=8, end_lineno=140, end_col_offset=11)], returns=Constant(value=None, lineno=127, col_offset=43, end_lineno=127, end_col_offset=47), lineno=127, col_offset=4, end_lineno=140, end_col_offset=11), FunctionDef(name='search', args=arguments(args=[arg(arg='self', lineno=142, col_offset=15, end_lineno=142, end_col_offset=19), arg(arg='vectors', annotation=Name(id='VectorArray', ctx=Load(), lineno=142, col_offset=30, end_lineno=142, end_col_offset=41), lineno=142, col_offset=21, end_lineno=142, end_col_offset=41), arg(arg='k', annotation=Name(id='int', ctx=Load(), lineno=142, col_offset=46, end_lineno=142, end_col_offset=49), lineno=142, col_offset=43, end_lineno=142, end_col_offset=49)]), body=[Expr(value=Constant(value='Search for nearest neighbors.\n\n        Searches the index for the k nearest neighbors of each query vector.\n        Returns similarity scores and indices for the top-k matches.\n\n        Parameters\n        ----------\n        vectors : VectorArray\n            Query vectors of shape (n_queries, dimension) with float32 dtype.\n            Must be normalized to unit length for inner-product search.\n        k : int\n            Number of nearest neighbors to return per query.\n\n        Returns\n        -------\n        tuple[NDArray[np.float32], NDArray[np.int64]]\n            Tuple of (distances, indices) where:\n            - distances: shape (n_queries, k) with similarity scores (higher is better for IP)\n            - indices: shape (n_queries, k) with vector indices in the index\n\n        Notes\n        -----\n        - For inner-product metrics, higher scores indicate better matches\n        - Invalid indices (no match) are typically represented as -1\n        - Search performance depends on index type (exact vs approximate)\n        ', lineno=143, col_offset=8, end_lineno=168, end_col_offset=11), lineno=143, col_offset=8, end_lineno=168, end_col_offset=11), Expr(value=Constant(value=Ellipsis, lineno=169, col_offset=8, end_lineno=169, end_col_offset=11), lineno=169, col_offset=8, end_lineno=169, end_col_offset=11)], returns=Subscript(value=Name(id='tuple', ctx=Load(), lineno=142, col_offset=54, end_lineno=142, end_col_offset=59), slice=Tuple(elts=[Subscript(value=Name(id='NDArray', ctx=Load(), lineno=142, col_offset=60, end_lineno=142, end_col_offset=67), slice=Attribute(value=Name(id='np', ctx=Load(), lineno=142, col_offset=68, end_lineno=142, end_col_offset=70), attr='float32', ctx=Load(), lineno=142, col_offset=68, end_lineno=142, end_col_offset=78), ctx=Load(), lineno=142, col_offset=60, end_lineno=142, end_col_offset=79), Subscript(value=Name(id='NDArray', ctx=Load(), lineno=142, col_offset=81, end_lineno=142, end_col_offset=88), slice=Attribute(value=Name(id='np', ctx=Load(), lineno=142, col_offset=89, end_lineno=142, end_col_offset=91), attr='int64', ctx=Load(), lineno=142, col_offset=89, end_lineno=142, end_col_offset=97), ctx=Load(), lineno=142, col_offset=81, end_lineno=142, end_col_offset=98)], ctx=Load(), lineno=142, col_offset=60, end_lineno=142, end_col_offset=98), ctx=Load(), lineno=142, col_offset=54, end_lineno=142, end_col_offset=99), lineno=142, col_offset=4, end_lineno=169, end_col_offset=11), FunctionDef(name='train', args=arguments(args=[arg(arg='self', lineno=171, col_offset=14, end_lineno=171, end_col_offset=18), arg(arg='vectors', annotation=Name(id='VectorArray', ctx=Load(), lineno=171, col_offset=29, end_lineno=171, end_col_offset=40), lineno=171, col_offset=20, end_lineno=171, end_col_offset=40)]), body=[Expr(value=Constant(value='Train the index with sample vectors (optional method).\n\n        Some FAISS indexes (e.g., quantized indexes) require training before\n        adding vectors. This method is optional - not all indexes support it.\n\n        Parameters\n        ----------\n        vectors : VectorArray\n            Training vectors of shape (n_train, dimension) with float32 dtype.\n\n        Notes\n        -----\n        - Flat indexes (exact search) do not require training\n        - Quantized indexes (IVF, PQ) require training before add()\n        - Calling train() on a non-trainable index is a no-op\n        ', lineno=172, col_offset=8, end_lineno=187, end_col_offset=11), lineno=172, col_offset=8, end_lineno=187, end_col_offset=11), Expr(value=Constant(value=Ellipsis, lineno=188, col_offset=8, end_lineno=188, end_col_offset=11), lineno=188, col_offset=8, end_lineno=188, end_col_offset=11)], returns=Constant(value=None, lineno=171, col_offset=45, end_lineno=171, end_col_offset=49), lineno=171, col_offset=4, end_lineno=188, end_col_offset=11), FunctionDef(name='add_with_ids', args=arguments(args=[arg(arg='self', lineno=190, col_offset=21, end_lineno=190, end_col_offset=25), arg(arg='vectors', annotation=Name(id='VectorArray', ctx=Load(), lineno=190, col_offset=36, end_lineno=190, end_col_offset=47), lineno=190, col_offset=27, end_lineno=190, end_col_offset=47), arg(arg='ids', annotation=Name(id='IndexArray', ctx=Load(), lineno=190, col_offset=54, end_lineno=190, end_col_offset=64), lineno=190, col_offset=49, end_lineno=190, end_col_offset=64)]), body=[Expr(value=Constant(value='Add vectors with explicit IDs (optional method).\n\n        Some FAISS indexes support adding vectors with explicit IDs rather than\n        sequential indices. This method is optional - not all indexes support it.\n\n        Parameters\n        ----------\n        vectors : VectorArray\n            Vectors to add, shape (n_vectors, dimension) with float32 dtype.\n        ids : IndexArray\n            Explicit IDs for each vector, shape (n_vectors,) with int64 dtype.\n\n        Notes\n        -----\n        - IndexIDMap2 wrapper enables add_with_ids for any base index\n        - If not supported, use add() which assigns sequential IDs\n        ', lineno=191, col_offset=8, end_lineno=207, end_col_offset=11), lineno=191, col_offset=8, end_lineno=207, end_col_offset=11), Expr(value=Constant(value=Ellipsis, lineno=208, col_offset=8, end_lineno=208, end_col_offset=11), lineno=208, col_offset=8, end_lineno=208, end_col_offset=11)], returns=Constant(value=None, lineno=190, col_offset=69, end_lineno=190, end_col_offset=73), lineno=190, col_offset=4, end_lineno=208, end_col_offset=11)], lineno=91, col_offset=0, end_lineno=208, end_col_offset=11), ClassDef(name='FaissModuleProtocol', bases=[Name(id='Protocol', ctx=Load(), lineno=212, col_offset=26, end_lineno=212, end_col_offset=34)], body=[Expr(value=Constant(value='Protocol for FAISS module surface used by adapters.\n\n    This protocol describes the subset of FAISS API used by kgfoundry\n    adapters. It enables type checking and allows fallback implementations\n    (e.g., `_SimpleFaissModule`) to satisfy the protocol.\n\n    Attributes\n    ----------\n    metric_inner_product : int\n        Constant for inner-product metric (used with index_factory).\n    metric_l2 : int\n        Constant for L2 distance metric (used with index_factory).\n    index_flat_ip : Callable[[int], FaissIndexProtocol]\n        Create a flat inner-product index.\n    index_id_map2 : Callable[[FaissIndexProtocol], FaissIndexProtocol]\n        Wrap an index with 64-bit ID mapping.\n    normalize_l2 : Callable[[VectorArray], None]\n        Normalize vectors to unit L2 norm in-place.\n\n    Examples\n    --------\n    >>> from kgfoundry.search_api.types import FaissModuleProtocol, FaissIndexProtocol\n    >>> class MockFaissModule:\n    ...     METRIC_INNER_PRODUCT = 1\n    ...\n    ...     def IndexFlatIP(self, dimension: int) -> FaissIndexProtocol: ...\n    ...     def write_index(self, index: FaissIndexProtocol, path: str) -> None: ...\n    ...     def read_index(self, path: str) -> FaissIndexProtocol: ...\n    ...     def normalize_L2(self, vectors: VectorArray) -> None: ...\n    >>> module: FaissModuleProtocol = MockFaissModule()\n    ', lineno=213, col_offset=4, end_lineno=243, end_col_offset=7), lineno=213, col_offset=4, end_lineno=243, end_col_offset=7), AnnAssign(target=Name(id='metric_inner_product', ctx=Store(), lineno=245, col_offset=4, end_lineno=245, end_col_offset=24), annotation=Name(id='int', ctx=Load(), lineno=245, col_offset=26, end_lineno=245, end_col_offset=29), simple=1, lineno=245, col_offset=4, end_lineno=245, end_col_offset=29), Expr(value=Constant(value='Constant for inner-product metric (used with index_factory).', lineno=246, col_offset=4, end_lineno=246, end_col_offset=70), lineno=246, col_offset=4, end_lineno=246, end_col_offset=70), AnnAssign(target=Name(id='metric_l2', ctx=Store(), lineno=248, col_offset=4, end_lineno=248, end_col_offset=13), annotation=Name(id='int', ctx=Load(), lineno=248, col_offset=15, end_lineno=248, end_col_offset=18), simple=1, lineno=248, col_offset=4, end_lineno=248, end_col_offset=18), Expr(value=Constant(value='Constant for L2 distance metric (used with index_factory).', lineno=249, col_offset=4, end_lineno=249, end_col_offset=68), lineno=249, col_offset=4, end_lineno=249, end_col_offset=68), AnnAssign(target=Name(id='index_flat_ip', ctx=Store(), lineno=251, col_offset=4, end_lineno=251, end_col_offset=17), annotation=Subscript(value=Name(id='Callable', ctx=Load(), lineno=251, col_offset=19, end_lineno=251, end_col_offset=27), slice=Tuple(elts=[List(elts=[Name(id='int', ctx=Load(), lineno=251, col_offset=29, end_lineno=251, end_col_offset=32)], ctx=Load(), lineno=251, col_offset=28, end_lineno=251, end_col_offset=33), Name(id='FaissIndexProtocol', ctx=Load(), lineno=251, col_offset=35, end_lineno=251, end_col_offset=53)], ctx=Load(), lineno=251, col_offset=28, end_lineno=251, end_col_offset=53), ctx=Load(), lineno=251, col_offset=19, end_lineno=251, end_col_offset=54), simple=1, lineno=251, col_offset=4, end_lineno=251, end_col_offset=54), Expr(value=Constant(value='Create a flat inner-product index.', lineno=252, col_offset=4, end_lineno=252, end_col_offset=44), lineno=252, col_offset=4, end_lineno=252, end_col_offset=44), FunctionDef(name='index_factory', args=arguments(args=[arg(arg='self', lineno=254, col_offset=22, end_lineno=254, end_col_offset=26), arg(arg='dimension', annotation=Name(id='int', ctx=Load(), lineno=254, col_offset=39, end_lineno=254, end_col_offset=42), lineno=254, col_offset=28, end_lineno=254, end_col_offset=42), arg(arg='factory_string', annotation=Name(id='str', ctx=Load(), lineno=254, col_offset=60, end_lineno=254, end_col_offset=63), lineno=254, col_offset=44, end_lineno=254, end_col_offset=63), arg(arg='metric', annotation=Name(id='int', ctx=Load(), lineno=254, col_offset=73, end_lineno=254, end_col_offset=76), lineno=254, col_offset=65, end_lineno=254, end_col_offset=76)]), body=[Expr(value=Constant(value='Create an index from a factory string.\n\n        Constructs a FAISS index using a factory string description. Factory\n        strings describe index configuration (e.g., "IVF8192,PQ64" for\n        quantized indexes).\n\n        Parameters\n        ----------\n        dimension : int\n            Vector dimension.\n        factory_string : str\n            Factory description (e.g., "IVF8192,PQ64" for quantized index).\n        metric : int\n            Metric type (METRIC_INNER_PRODUCT or METRIC_L2).\n\n        Returns\n        -------\n        FaissIndexProtocol\n            Configured index instance.\n\n        Examples\n        --------\n        >>> # Create quantized index for large-scale search\n        >>> index = faiss.index_factory(2560, "OPQ64,IVF8192,PQ64", faiss.METRIC_INNER_PRODUCT)\n        ', lineno=255, col_offset=8, end_lineno=279, end_col_offset=11), lineno=255, col_offset=8, end_lineno=279, end_col_offset=11), Expr(value=Constant(value=Ellipsis, lineno=280, col_offset=8, end_lineno=280, end_col_offset=11), lineno=280, col_offset=8, end_lineno=280, end_col_offset=11)], returns=Name(id='FaissIndexProtocol', ctx=Load(), lineno=254, col_offset=81, end_lineno=254, end_col_offset=99), lineno=254, col_offset=4, end_lineno=280, end_col_offset=11), AnnAssign(target=Name(id='index_id_map2', ctx=Store(), lineno=282, col_offset=4, end_lineno=282, end_col_offset=17), annotation=Subscript(value=Name(id='Callable', ctx=Load(), lineno=282, col_offset=19, end_lineno=282, end_col_offset=27), slice=Tuple(elts=[List(elts=[Name(id='FaissIndexProtocol', ctx=Load(), lineno=282, col_offset=29, end_lineno=282, end_col_offset=47)], ctx=Load(), lineno=282, col_offset=28, end_lineno=282, end_col_offset=48), Name(id='FaissIndexProtocol', ctx=Load(), lineno=282, col_offset=50, end_lineno=282, end_col_offset=68)], ctx=Load(), lineno=282, col_offset=28, end_lineno=282, end_col_offset=68), ctx=Load(), lineno=282, col_offset=19, end_lineno=282, end_col_offset=69), simple=1, lineno=282, col_offset=4, end_lineno=282, end_col_offset=69), Expr(value=Constant(value='Wrap an index with 64-bit ID mapping.', lineno=283, col_offset=4, end_lineno=283, end_col_offset=47), lineno=283, col_offset=4, end_lineno=283, end_col_offset=47), FunctionDef(name='write_index', args=arguments(args=[arg(arg='self', lineno=285, col_offset=20, end_lineno=285, end_col_offset=24), arg(arg='index', annotation=Name(id='FaissIndexProtocol', ctx=Load(), lineno=285, col_offset=33, end_lineno=285, end_col_offset=51), lineno=285, col_offset=26, end_lineno=285, end_col_offset=51), arg(arg='path', annotation=Name(id='str', ctx=Load(), lineno=285, col_offset=59, end_lineno=285, end_col_offset=62), lineno=285, col_offset=53, end_lineno=285, end_col_offset=62)]), body=[Expr(value=Constant(value='Persist an index to disk.\n\n        Serializes a FAISS index to disk for later loading. The index format\n        is FAISS-specific and not human-readable.\n\n        Parameters\n        ----------\n        index : FaissIndexProtocol\n            Index instance to save.\n        path : str\n            File path for the persisted index.\n        ', lineno=286, col_offset=8, end_lineno=297, end_col_offset=11), lineno=286, col_offset=8, end_lineno=297, end_col_offset=11), Expr(value=Constant(value=Ellipsis, lineno=298, col_offset=8, end_lineno=298, end_col_offset=11), lineno=298, col_offset=8, end_lineno=298, end_col_offset=11)], returns=Constant(value=None, lineno=285, col_offset=67, end_lineno=285, end_col_offset=71), lineno=285, col_offset=4, end_lineno=298, end_col_offset=11), FunctionDef(name='read_index', args=arguments(args=[arg(arg='self', lineno=300, col_offset=19, end_lineno=300, end_col_offset=23), arg(arg='path', annotation=Name(id='str', ctx=Load(), lineno=300, col_offset=31, end_lineno=300, end_col_offset=34), lineno=300, col_offset=25, end_lineno=300, end_col_offset=34)]), body=[Expr(value=Constant(value='Load an index from disk.\n\n        Deserializes a FAISS index from disk. The index must have been saved\n        using write_index() with a compatible FAISS version.\n\n        Parameters\n        ----------\n        path : str\n            File path to the persisted index.\n\n        Returns\n        -------\n        FaissIndexProtocol\n            Loaded index instance.\n        ', lineno=301, col_offset=8, end_lineno=315, end_col_offset=11), lineno=301, col_offset=8, end_lineno=315, end_col_offset=11), Expr(value=Constant(value=Ellipsis, lineno=316, col_offset=8, end_lineno=316, end_col_offset=11), lineno=316, col_offset=8, end_lineno=316, end_col_offset=11)], returns=Name(id='FaissIndexProtocol', ctx=Load(), lineno=300, col_offset=39, end_lineno=300, end_col_offset=57), lineno=300, col_offset=4, end_lineno=316, end_col_offset=11), AnnAssign(target=Name(id='normalize_l2', ctx=Store(), lineno=318, col_offset=4, end_lineno=318, end_col_offset=16), annotation=Subscript(value=Name(id='Callable', ctx=Load(), lineno=318, col_offset=18, end_lineno=318, end_col_offset=26), slice=Tuple(elts=[List(elts=[Name(id='VectorArray', ctx=Load(), lineno=318, col_offset=28, end_lineno=318, end_col_offset=39)], ctx=Load(), lineno=318, col_offset=27, end_lineno=318, end_col_offset=40), Constant(value=None, lineno=318, col_offset=42, end_lineno=318, end_col_offset=46)], ctx=Load(), lineno=318, col_offset=27, end_lineno=318, end_col_offset=46), ctx=Load(), lineno=318, col_offset=18, end_lineno=318, end_col_offset=47), simple=1, lineno=318, col_offset=4, end_lineno=318, end_col_offset=47), Expr(value=Constant(value='Normalize vectors to unit length in-place.', lineno=319, col_offset=4, end_lineno=319, end_col_offset=52), lineno=319, col_offset=4, end_lineno=319, end_col_offset=52)], lineno=212, col_offset=0, end_lineno=319, end_col_offset=52), ClassDef(name='GpuResourcesProtocol', bases=[Name(id='Protocol', ctx=Load(), lineno=323, col_offset=27, end_lineno=323, end_col_offset=35)], body=[Expr(value=Constant(value='Protocol for FAISS GPU resources.\n\n    This protocol describes the StandardGpuResources interface used for GPU\n    index operations. Implementations manage GPU memory and resources.\n\n    Examples\n    --------\n    >>> from kgfoundry.search_api.types import GpuResourcesProtocol\n    >>> class MockGpuResources:\n    ...     def __init__(self) -> None:\n    ...         pass\n    >>> resources: GpuResourcesProtocol = MockGpuResources()\n    ', lineno=324, col_offset=4, end_lineno=336, end_col_offset=7), lineno=324, col_offset=4, end_lineno=336, end_col_offset=7), FunctionDef(name='__init__', args=arguments(args=[arg(arg='self', lineno=338, col_offset=17, end_lineno=338, end_col_offset=21)]), body=[Expr(value=Constant(value=Ellipsis, lineno=338, col_offset=32, end_lineno=338, end_col_offset=35), lineno=338, col_offset=32, end_lineno=338, end_col_offset=35)], returns=Constant(value=None, lineno=338, col_offset=26, end_lineno=338, end_col_offset=30), lineno=338, col_offset=4, end_lineno=338, end_col_offset=35)], lineno=323, col_offset=0, end_lineno=338, end_col_offset=35), ClassDef(name='GpuClonerOptionsProtocol', bases=[Name(id='Protocol', ctx=Load(), lineno=342, col_offset=31, end_lineno=342, end_col_offset=39)], body=[Expr(value=Constant(value='Protocol for FAISS GPU cloner options.\n\n    This protocol describes the GpuClonerOptions interface used when cloning\n    CPU indexes to GPU. The `use_cuvs` attribute controls cuVS acceleration.\n\n    Attributes\n    ----------\n    use_cuvs : bool\n        Enable cuVS acceleration for GPU operations (default: False).\n\n    Examples\n    --------\n    >>> from kgfoundry.search_api.types import GpuClonerOptionsProtocol\n    >>> class MockGpuClonerOptions:\n    ...     use_cuvs: bool = False\n    >>> options: GpuClonerOptionsProtocol = MockGpuClonerOptions()\n    >>> options.use_cuvs = True\n    ', lineno=343, col_offset=4, end_lineno=360, end_col_offset=7), lineno=343, col_offset=4, end_lineno=360, end_col_offset=7), AnnAssign(target=Name(id='use_cuvs', ctx=Store(), lineno=362, col_offset=4, end_lineno=362, end_col_offset=12), annotation=Name(id='bool', ctx=Load(), lineno=362, col_offset=14, end_lineno=362, end_col_offset=18), simple=1, lineno=362, col_offset=4, end_lineno=362, end_col_offset=18), Expr(value=Constant(value='Enable cuVS acceleration for GPU operations (default: False).', lineno=363, col_offset=4, end_lineno=363, end_col_offset=71), lineno=363, col_offset=4, end_lineno=363, end_col_offset=71)], lineno=342, col_offset=0, end_lineno=363, end_col_offset=71), ClassDef(name='VectorSearchResult', body=[Expr(value=Constant(value='Typed result from vector search operations.\n\n    This dataclass represents a single search result with typed fields\n    and performance metadata. Results are immutable to prevent accidental\n    modification.\n\n    Attributes\n    ----------\n    doc_id : str\n        Document identifier (URN format).\n    chunk_id : str\n        Chunk identifier within the document.\n    score : float\n        Final relevance score (may combine multiple signals).\n    vector_score : float\n        Raw vector similarity score (inner product or L2 distance).\n\n    Examples\n    --------\n    >>> from kgfoundry.search_api.types import VectorSearchResult\n    >>> result = VectorSearchResult(\n    ...     doc_id="urn:doc:abc123",\n    ...     chunk_id="urn:chunk:abc123:0-500",\n    ...     score=0.95,\n    ...     vector_score=0.95,\n    ... )\n    >>> assert result.score == 0.95\n    ', lineno=369, col_offset=4, end_lineno=396, end_col_offset=7), lineno=369, col_offset=4, end_lineno=396, end_col_offset=7), AnnAssign(target=Name(id='doc_id', ctx=Store(), lineno=398, col_offset=4, end_lineno=398, end_col_offset=10), annotation=Name(id='str', ctx=Load(), lineno=398, col_offset=12, end_lineno=398, end_col_offset=15), simple=1, lineno=398, col_offset=4, end_lineno=398, end_col_offset=15), Expr(value=Constant(value='Document identifier (URN format).\n\n    Alias: none; name ``doc_id``.\n    ', lineno=399, col_offset=4, end_lineno=402, end_col_offset=7), lineno=399, col_offset=4, end_lineno=402, end_col_offset=7), AnnAssign(target=Name(id='chunk_id', ctx=Store(), lineno=404, col_offset=4, end_lineno=404, end_col_offset=12), annotation=Name(id='str', ctx=Load(), lineno=404, col_offset=14, end_lineno=404, end_col_offset=17), simple=1, lineno=404, col_offset=4, end_lineno=404, end_col_offset=17), Expr(value=Constant(value='Chunk identifier within the document.\n\n    Alias: none; name ``chunk_id``.\n    ', lineno=405, col_offset=4, end_lineno=408, end_col_offset=7), lineno=405, col_offset=4, end_lineno=408, end_col_offset=7), AnnAssign(target=Name(id='score', ctx=Store(), lineno=410, col_offset=4, end_lineno=410, end_col_offset=9), annotation=Name(id='float', ctx=Load(), lineno=410, col_offset=11, end_lineno=410, end_col_offset=16), simple=1, lineno=410, col_offset=4, end_lineno=410, end_col_offset=16), Expr(value=Constant(value='Final relevance score.\n\n    Alias: none; name ``score``.\n    ', lineno=411, col_offset=4, end_lineno=414, end_col_offset=7), lineno=411, col_offset=4, end_lineno=414, end_col_offset=7), AnnAssign(target=Name(id='vector_score', ctx=Store(), lineno=416, col_offset=4, end_lineno=416, end_col_offset=16), annotation=Name(id='float', ctx=Load(), lineno=416, col_offset=18, end_lineno=416, end_col_offset=23), simple=1, lineno=416, col_offset=4, end_lineno=416, end_col_offset=23), Expr(value=Constant(value='Vector similarity score.\n\n    Alias: none; name ``vector_score``.\n    ', lineno=417, col_offset=4, end_lineno=420, end_col_offset=7), lineno=417, col_offset=4, end_lineno=420, end_col_offset=7), FunctionDef(name='__post_init__', args=arguments(args=[arg(arg='self', lineno=422, col_offset=22, end_lineno=422, end_col_offset=26)]), body=[Expr(value=Constant(value='Validate result fields.\n\n        This method is called automatically by dataclass after initialization. For frozen\n        dataclasses, fields cannot be modified, so validation is limited to type checking (enforced\n        by the type checker).\n        ', lineno=423, col_offset=8, end_lineno=428, end_col_offset=11), lineno=423, col_offset=8, end_lineno=428, end_col_offset=11)], returns=Constant(value=None, lineno=422, col_offset=31, end_lineno=422, end_col_offset=35), lineno=422, col_offset=4, end_lineno=428, end_col_offset=11)], decorator_list=[Call(func=Name(id='dataclass', ctx=Load(), lineno=366, col_offset=1, end_lineno=366, end_col_offset=10), keywords=[keyword(arg='frozen', value=Constant(value=True, lineno=366, col_offset=18, end_lineno=366, end_col_offset=22), lineno=366, col_offset=11, end_lineno=366, end_col_offset=22), keyword(arg='slots', value=Constant(value=True, lineno=366, col_offset=30, end_lineno=366, end_col_offset=34), lineno=366, col_offset=24, end_lineno=366, end_col_offset=34)], lineno=366, col_offset=1, end_lineno=366, end_col_offset=35)], lineno=368, col_offset=0, end_lineno=428, end_col_offset=11), ClassDef(name='SpladeEncoderProtocol', bases=[Name(id='Protocol', ctx=Load(), lineno=434, col_offset=28, end_lineno=434, end_col_offset=36)], body=[Expr(value=Constant(value='Protocol for SPLADE encoder implementations.\n\n    SPLADE (Sparse Lexical and Expansion) encoders transform text into\n    sparse vector representations suitable for semantic search. This protocol\n    defines the interface required for SPLADE-based search operations.\n\n    Examples\n    --------\n    >>> from kgfoundry.search_api.types import SpladeEncoderProtocol, VectorArray\n    >>> import numpy as np\n    >>> class MySpladeEncoder:\n    ...     def encode(self, texts: Sequence[str]) -> VectorArray:\n    ...         # Return sparse vectors for input texts\n    ...         return np.array([[0.1, 0.0, 0.5]], dtype=np.float32)\n    >>> encoder: SpladeEncoderProtocol = MySpladeEncoder()\n    >>> vecs = encoder.encode(["query text"])\n    >>> assert vecs.shape[0] == 1\n    ', lineno=435, col_offset=4, end_lineno=452, end_col_offset=7), lineno=435, col_offset=4, end_lineno=452, end_col_offset=7), FunctionDef(name='encode', args=arguments(args=[arg(arg='self', lineno=454, col_offset=15, end_lineno=454, end_col_offset=19), arg(arg='texts', annotation=Subscript(value=Name(id='Sequence', ctx=Load(), lineno=454, col_offset=28, end_lineno=454, end_col_offset=36), slice=Name(id='str', ctx=Load(), lineno=454, col_offset=37, end_lineno=454, end_col_offset=40), ctx=Load(), lineno=454, col_offset=28, end_lineno=454, end_col_offset=41), lineno=454, col_offset=21, end_lineno=454, end_col_offset=41)]), body=[Expr(value=Constant(value='Encode text sequences into sparse vector representations.\n\n        Transforms input text sequences into sparse vectors suitable for\n        semantic search. Vectors are typically sparse (many zeros) and\n        represent term importance in the vocabulary.\n\n        Parameters\n        ----------\n        texts : Sequence[str]\n            Input text sequences to encode.\n\n        Returns\n        -------\n        VectorArray\n            Sparse vector array of shape (len(texts), vocab_size) with float32 dtype.\n            Vectors are typically sparse (many zeros) and represent term importance.\n        ', lineno=455, col_offset=8, end_lineno=471, end_col_offset=11), lineno=455, col_offset=8, end_lineno=471, end_col_offset=11), Expr(value=Constant(value=Ellipsis, lineno=472, col_offset=8, end_lineno=472, end_col_offset=11), lineno=472, col_offset=8, end_lineno=472, end_col_offset=11)], returns=Name(id='VectorArray', ctx=Load(), lineno=454, col_offset=46, end_lineno=454, end_col_offset=57), lineno=454, col_offset=4, end_lineno=472, end_col_offset=11)], lineno=434, col_offset=0, end_lineno=472, end_col_offset=11), ClassDef(name='BM25IndexProtocol', bases=[Name(id='Protocol', ctx=Load(), lineno=476, col_offset=24, end_lineno=476, end_col_offset=32)], body=[Expr(value=Constant(value='Protocol for BM25 lexical search index implementations.\n\n    BM25 indexes provide term-frequency based lexical search over document\n    collections. This protocol defines the interface required for BM25-based\n    search operations.\n\n    Examples\n    --------\n    >>> from kgfoundry.search_api.types import BM25IndexProtocol\n    >>> class MyBM25Index:\n    ...     def search(self, query: str, k: int = 10) -> list[tuple[str, float]]:\n    ...         # Return (doc_id, score) tuples\n    ...         return [("doc1", 0.95), ("doc2", 0.87)]\n    >>> index: BM25IndexProtocol = MyBM25Index()\n    >>> results = index.search("search query", k=5)\n    >>> assert len(results) <= 5\n    ', lineno=477, col_offset=4, end_lineno=493, end_col_offset=7), lineno=477, col_offset=4, end_lineno=493, end_col_offset=7), FunctionDef(name='search', args=arguments(args=[arg(arg='self', lineno=495, col_offset=15, end_lineno=495, end_col_offset=19), arg(arg='query', annotation=Name(id='str', ctx=Load(), lineno=495, col_offset=28, end_lineno=495, end_col_offset=31), lineno=495, col_offset=21, end_lineno=495, end_col_offset=31), arg(arg='k', annotation=Name(id='int', ctx=Load(), lineno=495, col_offset=36, end_lineno=495, end_col_offset=39), lineno=495, col_offset=33, end_lineno=495, end_col_offset=39)], defaults=[Constant(value=10, lineno=495, col_offset=42, end_lineno=495, end_col_offset=44)]), body=[Expr(value=Constant(value='Search the index for documents matching the query.\n\n        Searches the BM25 index for documents matching the query string.\n        Returns top-k results sorted by relevance score.\n\n        Parameters\n        ----------\n        query : str\n            Search query string (will be tokenized internally).\n        k : int, optional\n            Maximum number of results to return. Defaults to 10.\n\n        Returns\n        -------\n        list[tuple[str, float]]\n            List of (document_id, score) tuples, sorted by score descending.\n            Scores are BM25 relevance scores (higher is better).\n        ', lineno=496, col_offset=8, end_lineno=513, end_col_offset=11), lineno=496, col_offset=8, end_lineno=513, end_col_offset=11), Expr(value=Constant(value=Ellipsis, lineno=514, col_offset=8, end_lineno=514, end_col_offset=11), lineno=514, col_offset=8, end_lineno=514, end_col_offset=11)], returns=Subscript(value=Name(id='list', ctx=Load(), lineno=495, col_offset=49, end_lineno=495, end_col_offset=53), slice=Subscript(value=Name(id='tuple', ctx=Load(), lineno=495, col_offset=54, end_lineno=495, end_col_offset=59), slice=Tuple(elts=[Name(id='str', ctx=Load(), lineno=495, col_offset=60, end_lineno=495, end_col_offset=63), Name(id='float', ctx=Load(), lineno=495, col_offset=65, end_lineno=495, end_col_offset=70)], ctx=Load(), lineno=495, col_offset=60, end_lineno=495, end_col_offset=70), ctx=Load(), lineno=495, col_offset=54, end_lineno=495, end_col_offset=71), ctx=Load(), lineno=495, col_offset=49, end_lineno=495, end_col_offset=72), lineno=495, col_offset=4, end_lineno=514, end_col_offset=11)], lineno=476, col_offset=0, end_lineno=514, end_col_offset=11), ClassDef(name='AgentSearchQuery', body=[Expr(value=Constant(value='Query parameters for agent catalog search operations.\n\n    This dataclass represents a search query with typed fields for query text,\n    result count, filtering facets, and explanation flags. All fields are\n    validated at construction time.\n\n    Attributes\n    ----------\n    query : str\n        Search query text (tokenized and normalized internally). Cannot be empty.\n    k : int\n        Maximum number of results to return. Must be positive.\n    facets : Mapping[str, str] | None\n        Optional facet filters for narrowing search results. Common facets include:\n        package, module, kind, stability, deprecated. Values are matched exactly\n        (case-sensitive).\n    explain : bool\n        Whether to include explanation metadata in results. When True, results include\n        detailed scoring breakdowns and match highlights.\n\n    Examples\n    --------\n    >>> from kgfoundry.search_api.types import AgentSearchQuery\n    >>> query = AgentSearchQuery(\n    ...     query="vector store",\n    ...     k=10,\n    ...     facets={"package": "search_api"},\n    ...     explain=True,\n    ... )\n    >>> assert query.k == 10\n    >>> assert query.facets["package"] == "search_api"\n    ', lineno=520, col_offset=4, end_lineno=551, end_col_offset=7), lineno=520, col_offset=4, end_lineno=551, end_col_offset=7), AnnAssign(target=Name(id='query', ctx=Store(), lineno=553, col_offset=4, end_lineno=553, end_col_offset=9), annotation=Name(id='str', ctx=Load(), lineno=553, col_offset=11, end_lineno=553, end_col_offset=14), simple=1, lineno=553, col_offset=4, end_lineno=553, end_col_offset=14), Expr(value=Constant(value='Search query text.\n\n    Alias: none; name ``query``.\n    ', lineno=554, col_offset=4, end_lineno=557, end_col_offset=7), lineno=554, col_offset=4, end_lineno=557, end_col_offset=7), AnnAssign(target=Name(id='k', ctx=Store(), lineno=559, col_offset=4, end_lineno=559, end_col_offset=5), annotation=Name(id='int', ctx=Load(), lineno=559, col_offset=7, end_lineno=559, end_col_offset=10), value=Constant(value=10, lineno=559, col_offset=13, end_lineno=559, end_col_offset=15), simple=1, lineno=559, col_offset=4, end_lineno=559, end_col_offset=15), Expr(value=Constant(value='Maximum number of results to return.\n\n    Must be positive and typically bounded (for example, ``1 <= k <= 100``).\n\n    Alias: none; name ``k``.\n    ', lineno=560, col_offset=4, end_lineno=565, end_col_offset=7), lineno=560, col_offset=4, end_lineno=565, end_col_offset=7), AnnAssign(target=Name(id='facets', ctx=Store(), lineno=567, col_offset=4, end_lineno=567, end_col_offset=10), annotation=BinOp(left=Subscript(value=Name(id='Mapping', ctx=Load(), lineno=567, col_offset=12, end_lineno=567, end_col_offset=19), slice=Tuple(elts=[Name(id='str', ctx=Load(), lineno=567, col_offset=20, end_lineno=567, end_col_offset=23), Name(id='str', ctx=Load(), lineno=567, col_offset=25, end_lineno=567, end_col_offset=28)], ctx=Load(), lineno=567, col_offset=20, end_lineno=567, end_col_offset=28), ctx=Load(), lineno=567, col_offset=12, end_lineno=567, end_col_offset=29), op=BitOr(), right=Constant(value=None, lineno=567, col_offset=32, end_lineno=567, end_col_offset=36), lineno=567, col_offset=12, end_lineno=567, end_col_offset=36), value=Constant(value=None, lineno=567, col_offset=39, end_lineno=567, end_col_offset=43), simple=1, lineno=567, col_offset=4, end_lineno=567, end_col_offset=43), Expr(value=Constant(value='Optional facet filters for narrowing search results.\n\n    Common facets include ``package``, ``module``, ``kind``, ``stability``, and ``deprecated``.\n    Values are matched exactly (case-sensitive).\n\n    Alias: none; name ``facets``.\n    ', lineno=568, col_offset=4, end_lineno=574, end_col_offset=7), lineno=568, col_offset=4, end_lineno=574, end_col_offset=7), AnnAssign(target=Name(id='explain', ctx=Store(), lineno=576, col_offset=4, end_lineno=576, end_col_offset=11), annotation=Name(id='bool', ctx=Load(), lineno=576, col_offset=13, end_lineno=576, end_col_offset=17), value=Constant(value=False, lineno=576, col_offset=20, end_lineno=576, end_col_offset=25), simple=1, lineno=576, col_offset=4, end_lineno=576, end_col_offset=25), Expr(value=Constant(value='Whether to include explanation metadata in results.\n\n    When ``True``, results include detailed scoring breakdowns and match\n    highlights for debugging and transparency.\n\n    Alias: none; name ``explain``.\n    ', lineno=577, col_offset=4, end_lineno=583, end_col_offset=7), lineno=577, col_offset=4, end_lineno=583, end_col_offset=7), FunctionDef(name='__post_init__', args=arguments(args=[arg(arg='self', lineno=585, col_offset=22, end_lineno=585, end_col_offset=26)]), body=[Expr(value=Constant(value='Validate query parameters.\n\n        Ensures query text is non-empty and k is positive. Called automatically\n        by dataclass after initialization.\n\n        Raises\n        ------\n        ValueError\n            If query is empty or k is not positive.\n        ', lineno=586, col_offset=8, end_lineno=595, end_col_offset=11), lineno=586, col_offset=8, end_lineno=595, end_col_offset=11), If(test=UnaryOp(op=Not(), operand=Call(func=Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=596, col_offset=15, end_lineno=596, end_col_offset=19), attr='query', ctx=Load(), lineno=596, col_offset=15, end_lineno=596, end_col_offset=25), attr='strip', ctx=Load(), lineno=596, col_offset=15, end_lineno=596, end_col_offset=31), lineno=596, col_offset=15, end_lineno=596, end_col_offset=33), lineno=596, col_offset=11, end_lineno=596, end_col_offset=33), body=[Assign(targets=[Name(id='msg', ctx=Store(), lineno=597, col_offset=12, end_lineno=597, end_col_offset=15)], value=Constant(value='Query text cannot be empty', lineno=597, col_offset=18, end_lineno=597, end_col_offset=46), lineno=597, col_offset=12, end_lineno=597, end_col_offset=46), Raise(exc=Call(func=Name(id='ValueError', ctx=Load(), lineno=598, col_offset=18, end_lineno=598, end_col_offset=28), args=[Name(id='msg', ctx=Load(), lineno=598, col_offset=29, end_lineno=598, end_col_offset=32)], lineno=598, col_offset=18, end_lineno=598, end_col_offset=33), lineno=598, col_offset=12, end_lineno=598, end_col_offset=33)], lineno=596, col_offset=8, end_lineno=598, end_col_offset=33), If(test=Compare(left=Attribute(value=Name(id='self', ctx=Load(), lineno=599, col_offset=11, end_lineno=599, end_col_offset=15), attr='k', ctx=Load(), lineno=599, col_offset=11, end_lineno=599, end_col_offset=17), ops=[LtE()], comparators=[Constant(value=0, lineno=599, col_offset=21, end_lineno=599, end_col_offset=22)], lineno=599, col_offset=11, end_lineno=599, end_col_offset=22), body=[Assign(targets=[Name(id='msg', ctx=Store(), lineno=600, col_offset=12, end_lineno=600, end_col_offset=15)], value=JoinedStr(values=[Constant(value='k must be positive, got ', lineno=600, col_offset=20, end_lineno=600, end_col_offset=44), FormattedValue(value=Attribute(value=Name(id='self', ctx=Load(), lineno=600, col_offset=45, end_lineno=600, end_col_offset=49), attr='k', ctx=Load(), lineno=600, col_offset=45, end_lineno=600, end_col_offset=51), conversion=-1, lineno=600, col_offset=44, end_lineno=600, end_col_offset=52)], lineno=600, col_offset=18, end_lineno=600, end_col_offset=53), lineno=600, col_offset=12, end_lineno=600, end_col_offset=53), Raise(exc=Call(func=Name(id='ValueError', ctx=Load(), lineno=601, col_offset=18, end_lineno=601, end_col_offset=28), args=[Name(id='msg', ctx=Load(), lineno=601, col_offset=29, end_lineno=601, end_col_offset=32)], lineno=601, col_offset=18, end_lineno=601, end_col_offset=33), lineno=601, col_offset=12, end_lineno=601, end_col_offset=33)], lineno=599, col_offset=8, end_lineno=601, end_col_offset=33)], returns=Constant(value=None, lineno=585, col_offset=31, end_lineno=585, end_col_offset=35), lineno=585, col_offset=4, end_lineno=601, end_col_offset=33)], decorator_list=[Call(func=Name(id='dataclass', ctx=Load(), lineno=517, col_offset=1, end_lineno=517, end_col_offset=10), keywords=[keyword(arg='frozen', value=Constant(value=True, lineno=517, col_offset=18, end_lineno=517, end_col_offset=22), lineno=517, col_offset=11, end_lineno=517, end_col_offset=22), keyword(arg='slots', value=Constant(value=True, lineno=517, col_offset=30, end_lineno=517, end_col_offset=34), lineno=517, col_offset=24, end_lineno=517, end_col_offset=34)], lineno=517, col_offset=1, end_lineno=517, end_col_offset=35)], lineno=519, col_offset=0, end_lineno=601, end_col_offset=33), ClassDef(name='VectorSearchResultTypedDict', bases=[Name(id='TypedDict', ctx=Load(), lineno=605, col_offset=34, end_lineno=605, end_col_offset=43)], keywords=[keyword(arg='total', value=Constant(value=True, lineno=605, col_offset=51, end_lineno=605, end_col_offset=55), lineno=605, col_offset=45, end_lineno=605, end_col_offset=55)], body=[Expr(value=Constant(value="TypedDict representation of vector search results.\n\n    This TypedDict represents a search result from the agent catalog with\n    symbol metadata, relevance scores, and source anchors. Used for JSON\n    serialization and API responses.\n\n    Attributes\n    ----------\n    symbol_id : str\n        Fully qualified symbol identifier (e.g., 'py:module.Class.method').\n    score : float\n        Final relevance score combining lexical and vector signals.\n    lexical_score : float\n        BM25 lexical search score (0.0 to 1.0).\n    vector_score : float\n        Vector similarity score from dense/sparse search (0.0 to 1.0).\n    package : str\n        Package name containing the symbol.\n    module : str\n        Module name containing the symbol.\n    qname : str\n        Qualified name of the symbol within its module.\n    kind : str\n        Symbol kind (e.g., 'class', 'function', 'module').\n    anchor : Mapping[str, int | None]\n        Source anchor metadata (start_line, end_line, etc.).\n    metadata : Mapping[str, JsonValue]\n        Additional metadata (stability, deprecated, summary, etc.).\n    ", lineno=606, col_offset=4, end_lineno=634, end_col_offset=7), lineno=606, col_offset=4, end_lineno=634, end_col_offset=7), AnnAssign(target=Name(id='symbol_id', ctx=Store(), lineno=636, col_offset=4, end_lineno=636, end_col_offset=13), annotation=Name(id='str', ctx=Load(), lineno=636, col_offset=15, end_lineno=636, end_col_offset=18), simple=1, lineno=636, col_offset=4, end_lineno=636, end_col_offset=18), Expr(value=Constant(value="Fully qualified symbol identifier (e.g., 'py:module.Class.method').", lineno=637, col_offset=4, end_lineno=637, end_col_offset=77), lineno=637, col_offset=4, end_lineno=637, end_col_offset=77), AnnAssign(target=Name(id='score', ctx=Store(), lineno=639, col_offset=4, end_lineno=639, end_col_offset=9), annotation=Name(id='float', ctx=Load(), lineno=639, col_offset=11, end_lineno=639, end_col_offset=16), simple=1, lineno=639, col_offset=4, end_lineno=639, end_col_offset=16), Expr(value=Constant(value='Final relevance score combining lexical and vector signals.', lineno=640, col_offset=4, end_lineno=640, end_col_offset=69), lineno=640, col_offset=4, end_lineno=640, end_col_offset=69), AnnAssign(target=Name(id='lexical_score', ctx=Store(), lineno=642, col_offset=4, end_lineno=642, end_col_offset=17), annotation=Name(id='float', ctx=Load(), lineno=642, col_offset=19, end_lineno=642, end_col_offset=24), simple=1, lineno=642, col_offset=4, end_lineno=642, end_col_offset=24), Expr(value=Constant(value='BM25 lexical search score (0.0 to 1.0).', lineno=643, col_offset=4, end_lineno=643, end_col_offset=49), lineno=643, col_offset=4, end_lineno=643, end_col_offset=49), AnnAssign(target=Name(id='vector_score', ctx=Store(), lineno=645, col_offset=4, end_lineno=645, end_col_offset=16), annotation=Name(id='float', ctx=Load(), lineno=645, col_offset=18, end_lineno=645, end_col_offset=23), simple=1, lineno=645, col_offset=4, end_lineno=645, end_col_offset=23), Expr(value=Constant(value='Vector similarity score from dense/sparse search (0.0 to 1.0).', lineno=646, col_offset=4, end_lineno=646, end_col_offset=72), lineno=646, col_offset=4, end_lineno=646, end_col_offset=72), AnnAssign(target=Name(id='package', ctx=Store(), lineno=648, col_offset=4, end_lineno=648, end_col_offset=11), annotation=Name(id='str', ctx=Load(), lineno=648, col_offset=13, end_lineno=648, end_col_offset=16), simple=1, lineno=648, col_offset=4, end_lineno=648, end_col_offset=16), Expr(value=Constant(value='Package name containing the symbol.', lineno=649, col_offset=4, end_lineno=649, end_col_offset=45), lineno=649, col_offset=4, end_lineno=649, end_col_offset=45), AnnAssign(target=Name(id='module', ctx=Store(), lineno=651, col_offset=4, end_lineno=651, end_col_offset=10), annotation=Name(id='str', ctx=Load(), lineno=651, col_offset=12, end_lineno=651, end_col_offset=15), simple=1, lineno=651, col_offset=4, end_lineno=651, end_col_offset=15), Expr(value=Constant(value='Module name containing the symbol.', lineno=652, col_offset=4, end_lineno=652, end_col_offset=44), lineno=652, col_offset=4, end_lineno=652, end_col_offset=44), AnnAssign(target=Name(id='qname', ctx=Store(), lineno=654, col_offset=4, end_lineno=654, end_col_offset=9), annotation=Name(id='str', ctx=Load(), lineno=654, col_offset=11, end_lineno=654, end_col_offset=14), simple=1, lineno=654, col_offset=4, end_lineno=654, end_col_offset=14), Expr(value=Constant(value='Qualified name of the symbol within its module.', lineno=655, col_offset=4, end_lineno=655, end_col_offset=57), lineno=655, col_offset=4, end_lineno=655, end_col_offset=57), AnnAssign(target=Name(id='kind', ctx=Store(), lineno=657, col_offset=4, end_lineno=657, end_col_offset=8), annotation=Name(id='str', ctx=Load(), lineno=657, col_offset=10, end_lineno=657, end_col_offset=13), simple=1, lineno=657, col_offset=4, end_lineno=657, end_col_offset=13), Expr(value=Constant(value="Symbol kind (e.g., 'class', 'function', 'module').", lineno=658, col_offset=4, end_lineno=658, end_col_offset=60), lineno=658, col_offset=4, end_lineno=658, end_col_offset=60), AnnAssign(target=Name(id='anchor', ctx=Store(), lineno=660, col_offset=4, end_lineno=660, end_col_offset=10), annotation=Subscript(value=Name(id='Mapping', ctx=Load(), lineno=660, col_offset=12, end_lineno=660, end_col_offset=19), slice=Tuple(elts=[Name(id='str', ctx=Load(), lineno=660, col_offset=20, end_lineno=660, end_col_offset=23), BinOp(left=Name(id='int', ctx=Load(), lineno=660, col_offset=25, end_lineno=660, end_col_offset=28), op=BitOr(), right=Constant(value=None, lineno=660, col_offset=31, end_lineno=660, end_col_offset=35), lineno=660, col_offset=25, end_lineno=660, end_col_offset=35)], ctx=Load(), lineno=660, col_offset=20, end_lineno=660, end_col_offset=35), ctx=Load(), lineno=660, col_offset=12, end_lineno=660, end_col_offset=36), simple=1, lineno=660, col_offset=4, end_lineno=660, end_col_offset=36), Expr(value=Constant(value='Source anchor metadata (start_line, end_line, etc.).', lineno=661, col_offset=4, end_lineno=661, end_col_offset=62), lineno=661, col_offset=4, end_lineno=661, end_col_offset=62), AnnAssign(target=Name(id='metadata', ctx=Store(), lineno=663, col_offset=4, end_lineno=663, end_col_offset=12), annotation=Subscript(value=Name(id='Mapping', ctx=Load(), lineno=663, col_offset=14, end_lineno=663, end_col_offset=21), slice=Tuple(elts=[Name(id='str', ctx=Load(), lineno=663, col_offset=22, end_lineno=663, end_col_offset=25), Name(id='JsonValue', ctx=Load(), lineno=663, col_offset=27, end_lineno=663, end_col_offset=36)], ctx=Load(), lineno=663, col_offset=22, end_lineno=663, end_col_offset=36), ctx=Load(), lineno=663, col_offset=14, end_lineno=663, end_col_offset=37), simple=1, lineno=663, col_offset=4, end_lineno=663, end_col_offset=37), Expr(value=Constant(value='Additional metadata (stability, deprecated, summary, etc.).', lineno=664, col_offset=4, end_lineno=664, end_col_offset=69), lineno=664, col_offset=4, end_lineno=664, end_col_offset=69)], lineno=605, col_offset=0, end_lineno=664, end_col_offset=69), ClassDef(name='AgentSearchResponse', bases=[Name(id='TypedDict', ctx=Load(), lineno=668, col_offset=26, end_lineno=668, end_col_offset=35)], keywords=[keyword(arg='total', value=Constant(value=True, lineno=668, col_offset=43, end_lineno=668, end_col_offset=47), lineno=668, col_offset=37, end_lineno=668, end_col_offset=47)], body=[Expr(value=Constant(value='TypedDict representation of agent catalog search response.\n\n    This TypedDict represents a complete search response from the agent catalog\n    with results, metadata, and performance metrics. Used for JSON serialization\n    and API responses.\n\n    Attributes\n    ----------\n    results : list[VectorSearchResultTypedDict]\n        List of search results, sorted by score descending.\n    total : int\n        Total number of results (may exceed len(results) if truncated).\n    took_ms : int\n        Query execution time in milliseconds.\n    metadata : Mapping[str, JsonValue]\n        Response metadata (alpha, backend, query_info, etc.).\n    ', lineno=669, col_offset=4, end_lineno=685, end_col_offset=7), lineno=669, col_offset=4, end_lineno=685, end_col_offset=7), AnnAssign(target=Name(id='results', ctx=Store(), lineno=687, col_offset=4, end_lineno=687, end_col_offset=11), annotation=Subscript(value=Name(id='list', ctx=Load(), lineno=687, col_offset=13, end_lineno=687, end_col_offset=17), slice=Name(id='VectorSearchResultTypedDict', ctx=Load(), lineno=687, col_offset=18, end_lineno=687, end_col_offset=45), ctx=Load(), lineno=687, col_offset=13, end_lineno=687, end_col_offset=46), simple=1, lineno=687, col_offset=4, end_lineno=687, end_col_offset=46), Expr(value=Constant(value='List of search results, sorted by score descending.', lineno=688, col_offset=4, end_lineno=688, end_col_offset=61), lineno=688, col_offset=4, end_lineno=688, end_col_offset=61), AnnAssign(target=Name(id='total', ctx=Store(), lineno=690, col_offset=4, end_lineno=690, end_col_offset=9), annotation=Name(id='int', ctx=Load(), lineno=690, col_offset=11, end_lineno=690, end_col_offset=14), simple=1, lineno=690, col_offset=4, end_lineno=690, end_col_offset=14), Expr(value=Constant(value='Total number of results (may exceed len(results) if truncated).', lineno=691, col_offset=4, end_lineno=691, end_col_offset=73), lineno=691, col_offset=4, end_lineno=691, end_col_offset=73), AnnAssign(target=Name(id='took_ms', ctx=Store(), lineno=693, col_offset=4, end_lineno=693, end_col_offset=11), annotation=Name(id='int', ctx=Load(), lineno=693, col_offset=13, end_lineno=693, end_col_offset=16), simple=1, lineno=693, col_offset=4, end_lineno=693, end_col_offset=16), Expr(value=Constant(value='Query execution time in milliseconds.', lineno=694, col_offset=4, end_lineno=694, end_col_offset=47), lineno=694, col_offset=4, end_lineno=694, end_col_offset=47), AnnAssign(target=Name(id='metadata', ctx=Store(), lineno=696, col_offset=4, end_lineno=696, end_col_offset=12), annotation=Subscript(value=Name(id='Mapping', ctx=Load(), lineno=696, col_offset=14, end_lineno=696, end_col_offset=21), slice=Tuple(elts=[Name(id='str', ctx=Load(), lineno=696, col_offset=22, end_lineno=696, end_col_offset=25), Name(id='JsonValue', ctx=Load(), lineno=696, col_offset=27, end_lineno=696, end_col_offset=36)], ctx=Load(), lineno=696, col_offset=22, end_lineno=696, end_col_offset=36), ctx=Load(), lineno=696, col_offset=14, end_lineno=696, end_col_offset=37), simple=1, lineno=696, col_offset=4, end_lineno=696, end_col_offset=37), Expr(value=Constant(value='Response metadata (alpha, backend, query_info, etc.).', lineno=697, col_offset=4, end_lineno=697, end_col_offset=63), lineno=697, col_offset=4, end_lineno=697, end_col_offset=63)], lineno=668, col_offset=0, end_lineno=697, end_col_offset=63), ClassDef(name='_LegacyFaissModule', bases=[Name(id='Protocol', ctx=Load(), lineno=700, col_offset=25, end_lineno=700, end_col_offset=33)], body=[Expr(value=Constant(value='Subset of the legacy FAISS module surface used by the adapter.', lineno=701, col_offset=4, end_lineno=701, end_col_offset=72), lineno=701, col_offset=4, end_lineno=701, end_col_offset=72), AnnAssign(target=Name(id='METRIC_INNER_PRODUCT', ctx=Store(), lineno=703, col_offset=4, end_lineno=703, end_col_offset=24), annotation=Name(id='int', ctx=Load(), lineno=703, col_offset=26, end_lineno=703, end_col_offset=29), simple=1, lineno=703, col_offset=4, end_lineno=703, end_col_offset=29), AnnAssign(target=Name(id='METRIC_L2', ctx=Store(), lineno=704, col_offset=4, end_lineno=704, end_col_offset=13), annotation=Name(id='int', ctx=Load(), lineno=704, col_offset=15, end_lineno=704, end_col_offset=18), simple=1, lineno=704, col_offset=4, end_lineno=704, end_col_offset=18), AnnAssign(target=Name(id='index_factory', ctx=Store(), lineno=706, col_offset=4, end_lineno=706, end_col_offset=17), annotation=Subscript(value=Name(id='Callable', ctx=Load(), lineno=706, col_offset=19, end_lineno=706, end_col_offset=27), slice=Tuple(elts=[List(elts=[Name(id='int', ctx=Load(), lineno=706, col_offset=29, end_lineno=706, end_col_offset=32), Name(id='str', ctx=Load(), lineno=706, col_offset=34, end_lineno=706, end_col_offset=37), Name(id='int', ctx=Load(), lineno=706, col_offset=39, end_lineno=706, end_col_offset=42)], ctx=Load(), lineno=706, col_offset=28, end_lineno=706, end_col_offset=43), Name(id='FaissIndexProtocol', ctx=Load(), lineno=706, col_offset=45, end_lineno=706, end_col_offset=63)], ctx=Load(), lineno=706, col_offset=28, end_lineno=706, end_col_offset=63), ctx=Load(), lineno=706, col_offset=19, end_lineno=706, end_col_offset=64), simple=1, lineno=706, col_offset=4, end_lineno=706, end_col_offset=64), AnnAssign(target=Name(id='write_index', ctx=Store(), lineno=707, col_offset=4, end_lineno=707, end_col_offset=15), annotation=Subscript(value=Name(id='Callable', ctx=Load(), lineno=707, col_offset=17, end_lineno=707, end_col_offset=25), slice=Tuple(elts=[List(elts=[Name(id='FaissIndexProtocol', ctx=Load(), lineno=707, col_offset=27, end_lineno=707, end_col_offset=45), Name(id='str', ctx=Load(), lineno=707, col_offset=47, end_lineno=707, end_col_offset=50)], ctx=Load(), lineno=707, col_offset=26, end_lineno=707, end_col_offset=51), Constant(value=None, lineno=707, col_offset=53, end_lineno=707, end_col_offset=57)], ctx=Load(), lineno=707, col_offset=26, end_lineno=707, end_col_offset=57), ctx=Load(), lineno=707, col_offset=17, end_lineno=707, end_col_offset=58), simple=1, lineno=707, col_offset=4, end_lineno=707, end_col_offset=58), AnnAssign(target=Name(id='read_index', ctx=Store(), lineno=708, col_offset=4, end_lineno=708, end_col_offset=14), annotation=Subscript(value=Name(id='Callable', ctx=Load(), lineno=708, col_offset=16, end_lineno=708, end_col_offset=24), slice=Tuple(elts=[List(elts=[Name(id='str', ctx=Load(), lineno=708, col_offset=26, end_lineno=708, end_col_offset=29)], ctx=Load(), lineno=708, col_offset=25, end_lineno=708, end_col_offset=30), Name(id='FaissIndexProtocol', ctx=Load(), lineno=708, col_offset=32, end_lineno=708, end_col_offset=50)], ctx=Load(), lineno=708, col_offset=25, end_lineno=708, end_col_offset=50), ctx=Load(), lineno=708, col_offset=16, end_lineno=708, end_col_offset=51), simple=1, lineno=708, col_offset=4, end_lineno=708, end_col_offset=51)], lineno=700, col_offset=0, end_lineno=708, end_col_offset=51), FunctionDef(name='_labels_or_default', args=arguments(args=[arg(arg='labelnames', annotation=BinOp(left=Subscript(value=Name(id='Sequence', ctx=Load(), lineno=711, col_offset=35, end_lineno=711, end_col_offset=43), slice=Name(id='str', ctx=Load(), lineno=711, col_offset=44, end_lineno=711, end_col_offset=47), ctx=Load(), lineno=711, col_offset=35, end_lineno=711, end_col_offset=48), op=BitOr(), right=Constant(value=None, lineno=711, col_offset=51, end_lineno=711, end_col_offset=55), lineno=711, col_offset=35, end_lineno=711, end_col_offset=55), lineno=711, col_offset=23, end_lineno=711, end_col_offset=55)]), body=[Return(value=IfExp(test=Compare(left=Name(id='labelnames', ctx=Load(), lineno=712, col_offset=32, end_lineno=712, end_col_offset=42), ops=[IsNot()], comparators=[Constant(value=None, lineno=712, col_offset=50, end_lineno=712, end_col_offset=54)], lineno=712, col_offset=32, end_lineno=712, end_col_offset=54), body=Call(func=Name(id='tuple', ctx=Load(), lineno=712, col_offset=11, end_lineno=712, end_col_offset=16), args=[Name(id='labelnames', ctx=Load(), lineno=712, col_offset=17, end_lineno=712, end_col_offset=27)], lineno=712, col_offset=11, end_lineno=712, end_col_offset=28), orelse=Tuple(ctx=Load(), lineno=712, col_offset=60, end_lineno=712, end_col_offset=62), lineno=712, col_offset=11, end_lineno=712, end_col_offset=62), lineno=712, col_offset=4, end_lineno=712, end_col_offset=62)], returns=Subscript(value=Name(id='Sequence', ctx=Load(), lineno=711, col_offset=60, end_lineno=711, end_col_offset=68), slice=Name(id='str', ctx=Load(), lineno=711, col_offset=69, end_lineno=711, end_col_offset=72), ctx=Load(), lineno=711, col_offset=60, end_lineno=711, end_col_offset=73), lineno=711, col_offset=0, end_lineno=712, end_col_offset=62), FunctionDef(name='_legacy_index_flat_ip', args=arguments(args=[arg(arg='module', annotation=Name(id='_LegacyFaissModule', ctx=Load(), lineno=716, col_offset=12, end_lineno=716, end_col_offset=30), lineno=716, col_offset=4, end_lineno=716, end_col_offset=30)]), body=[AnnAssign(target=Name(id='attr_any', ctx=Store(), lineno=718, col_offset=4, end_lineno=718, end_col_offset=12), annotation=Name(id='object', ctx=Load(), lineno=718, col_offset=14, end_lineno=718, end_col_offset=20), value=Call(func=Call(func=Name(id='attrgetter', ctx=Load(), lineno=718, col_offset=23, end_lineno=718, end_col_offset=33), args=[Constant(value='IndexFlatIP', lineno=718, col_offset=34, end_lineno=718, end_col_offset=47)], lineno=718, col_offset=23, end_lineno=718, end_col_offset=48), args=[Name(id='module', ctx=Load(), lineno=718, col_offset=49, end_lineno=718, end_col_offset=55)], lineno=718, col_offset=23, end_lineno=718, end_col_offset=56), simple=1, lineno=718, col_offset=4, end_lineno=718, end_col_offset=56), If(test=UnaryOp(op=Not(), operand=Call(func=Name(id='callable', ctx=Load(), lineno=719, col_offset=11, end_lineno=719, end_col_offset=19), args=[Name(id='attr_any', ctx=Load(), lineno=719, col_offset=20, end_lineno=719, end_col_offset=28)], lineno=719, col_offset=11, end_lineno=719, end_col_offset=29), lineno=719, col_offset=7, end_lineno=719, end_col_offset=29), body=[Assign(targets=[Name(id='msg', ctx=Store(), lineno=720, col_offset=8, end_lineno=720, end_col_offset=11)], value=Constant(value="Legacy FAISS module attribute 'IndexFlatIP' must be callable", lineno=720, col_offset=14, end_lineno=720, end_col_offset=76), lineno=720, col_offset=8, end_lineno=720, end_col_offset=76), Raise(exc=Call(func=Name(id='TypeError', ctx=Load(), lineno=721, col_offset=14, end_lineno=721, end_col_offset=23), args=[Name(id='msg', ctx=Load(), lineno=721, col_offset=24, end_lineno=721, end_col_offset=27)], lineno=721, col_offset=14, end_lineno=721, end_col_offset=28), lineno=721, col_offset=8, end_lineno=721, end_col_offset=28)], lineno=719, col_offset=4, end_lineno=721, end_col_offset=28), Return(value=Call(func=Name(id='cast', ctx=Load(), lineno=722, col_offset=11, end_lineno=722, end_col_offset=15), args=[Constant(value='Callable[[int], FaissIndexProtocol]', lineno=722, col_offset=16, end_lineno=722, end_col_offset=53), Name(id='attr_any', ctx=Load(), lineno=722, col_offset=55, end_lineno=722, end_col_offset=63)], lineno=722, col_offset=11, end_lineno=722, end_col_offset=64), lineno=722, col_offset=4, end_lineno=722, end_col_offset=64)], returns=Subscript(value=Name(id='Callable', ctx=Load(), lineno=717, col_offset=5, end_lineno=717, end_col_offset=13), slice=Tuple(elts=[List(elts=[Name(id='int', ctx=Load(), lineno=717, col_offset=15, end_lineno=717, end_col_offset=18)], ctx=Load(), lineno=717, col_offset=14, end_lineno=717, end_col_offset=19), Name(id='FaissIndexProtocol', ctx=Load(), lineno=717, col_offset=21, end_lineno=717, end_col_offset=39)], ctx=Load(), lineno=717, col_offset=14, end_lineno=717, end_col_offset=39), ctx=Load(), lineno=717, col_offset=5, end_lineno=717, end_col_offset=40), lineno=715, col_offset=0, end_lineno=722, end_col_offset=64), FunctionDef(name='_legacy_index_id_map2', args=arguments(args=[arg(arg='module', annotation=Name(id='_LegacyFaissModule', ctx=Load(), lineno=726, col_offset=12, end_lineno=726, end_col_offset=30), lineno=726, col_offset=4, end_lineno=726, end_col_offset=30)]), body=[AnnAssign(target=Name(id='attr_any', ctx=Store(), lineno=728, col_offset=4, end_lineno=728, end_col_offset=12), annotation=Name(id='object', ctx=Load(), lineno=728, col_offset=14, end_lineno=728, end_col_offset=20), value=Call(func=Call(func=Name(id='attrgetter', ctx=Load(), lineno=728, col_offset=23, end_lineno=728, end_col_offset=33), args=[Constant(value='IndexIDMap2', lineno=728, col_offset=34, end_lineno=728, end_col_offset=47)], lineno=728, col_offset=23, end_lineno=728, end_col_offset=48), args=[Name(id='module', ctx=Load(), lineno=728, col_offset=49, end_lineno=728, end_col_offset=55)], lineno=728, col_offset=23, end_lineno=728, end_col_offset=56), simple=1, lineno=728, col_offset=4, end_lineno=728, end_col_offset=56), If(test=UnaryOp(op=Not(), operand=Call(func=Name(id='callable', ctx=Load(), lineno=729, col_offset=11, end_lineno=729, end_col_offset=19), args=[Name(id='attr_any', ctx=Load(), lineno=729, col_offset=20, end_lineno=729, end_col_offset=28)], lineno=729, col_offset=11, end_lineno=729, end_col_offset=29), lineno=729, col_offset=7, end_lineno=729, end_col_offset=29), body=[Assign(targets=[Name(id='msg', ctx=Store(), lineno=730, col_offset=8, end_lineno=730, end_col_offset=11)], value=Constant(value="Legacy FAISS module attribute 'IndexIDMap2' must be callable", lineno=730, col_offset=14, end_lineno=730, end_col_offset=76), lineno=730, col_offset=8, end_lineno=730, end_col_offset=76), Raise(exc=Call(func=Name(id='TypeError', ctx=Load(), lineno=731, col_offset=14, end_lineno=731, end_col_offset=23), args=[Name(id='msg', ctx=Load(), lineno=731, col_offset=24, end_lineno=731, end_col_offset=27)], lineno=731, col_offset=14, end_lineno=731, end_col_offset=28), lineno=731, col_offset=8, end_lineno=731, end_col_offset=28)], lineno=729, col_offset=4, end_lineno=731, end_col_offset=28), Return(value=Call(func=Name(id='cast', ctx=Load(), lineno=732, col_offset=11, end_lineno=732, end_col_offset=15), args=[Constant(value='Callable[[FaissIndexProtocol], FaissIndexProtocol]', lineno=732, col_offset=16, end_lineno=732, end_col_offset=68), Name(id='attr_any', ctx=Load(), lineno=732, col_offset=70, end_lineno=732, end_col_offset=78)], lineno=732, col_offset=11, end_lineno=732, end_col_offset=79), lineno=732, col_offset=4, end_lineno=732, end_col_offset=79)], returns=Subscript(value=Name(id='Callable', ctx=Load(), lineno=727, col_offset=5, end_lineno=727, end_col_offset=13), slice=Tuple(elts=[List(elts=[Name(id='FaissIndexProtocol', ctx=Load(), lineno=727, col_offset=15, end_lineno=727, end_col_offset=33)], ctx=Load(), lineno=727, col_offset=14, end_lineno=727, end_col_offset=34), Name(id='FaissIndexProtocol', ctx=Load(), lineno=727, col_offset=36, end_lineno=727, end_col_offset=54)], ctx=Load(), lineno=727, col_offset=14, end_lineno=727, end_col_offset=54), ctx=Load(), lineno=727, col_offset=5, end_lineno=727, end_col_offset=55), lineno=725, col_offset=0, end_lineno=732, end_col_offset=79), FunctionDef(name='_legacy_normalize_l2', args=arguments(args=[arg(arg='module', annotation=Name(id='_LegacyFaissModule', ctx=Load(), lineno=735, col_offset=33, end_lineno=735, end_col_offset=51), lineno=735, col_offset=25, end_lineno=735, end_col_offset=51)]), body=[AnnAssign(target=Name(id='attr_any', ctx=Store(), lineno=736, col_offset=4, end_lineno=736, end_col_offset=12), annotation=Name(id='object', ctx=Load(), lineno=736, col_offset=14, end_lineno=736, end_col_offset=20), value=Call(func=Call(func=Name(id='attrgetter', ctx=Load(), lineno=736, col_offset=23, end_lineno=736, end_col_offset=33), args=[Constant(value='normalize_L2', lineno=736, col_offset=34, end_lineno=736, end_col_offset=48)], lineno=736, col_offset=23, end_lineno=736, end_col_offset=49), args=[Name(id='module', ctx=Load(), lineno=736, col_offset=50, end_lineno=736, end_col_offset=56)], lineno=736, col_offset=23, end_lineno=736, end_col_offset=57), simple=1, lineno=736, col_offset=4, end_lineno=736, end_col_offset=57), If(test=UnaryOp(op=Not(), operand=Call(func=Name(id='callable', ctx=Load(), lineno=737, col_offset=11, end_lineno=737, end_col_offset=19), args=[Name(id='attr_any', ctx=Load(), lineno=737, col_offset=20, end_lineno=737, end_col_offset=28)], lineno=737, col_offset=11, end_lineno=737, end_col_offset=29), lineno=737, col_offset=7, end_lineno=737, end_col_offset=29), body=[Assign(targets=[Name(id='msg', ctx=Store(), lineno=738, col_offset=8, end_lineno=738, end_col_offset=11)], value=Constant(value="Legacy FAISS module attribute 'normalize_L2' must be callable", lineno=738, col_offset=14, end_lineno=738, end_col_offset=77), lineno=738, col_offset=8, end_lineno=738, end_col_offset=77), Raise(exc=Call(func=Name(id='TypeError', ctx=Load(), lineno=739, col_offset=14, end_lineno=739, end_col_offset=23), args=[Name(id='msg', ctx=Load(), lineno=739, col_offset=24, end_lineno=739, end_col_offset=27)], lineno=739, col_offset=14, end_lineno=739, end_col_offset=28), lineno=739, col_offset=8, end_lineno=739, end_col_offset=28)], lineno=737, col_offset=4, end_lineno=739, end_col_offset=28), Return(value=Call(func=Name(id='cast', ctx=Load(), lineno=740, col_offset=11, end_lineno=740, end_col_offset=15), args=[Constant(value='Callable[[VectorArray], None]', lineno=740, col_offset=16, end_lineno=740, end_col_offset=47), Name(id='attr_any', ctx=Load(), lineno=740, col_offset=49, end_lineno=740, end_col_offset=57)], lineno=740, col_offset=11, end_lineno=740, end_col_offset=58), lineno=740, col_offset=4, end_lineno=740, end_col_offset=58)], returns=Subscript(value=Name(id='Callable', ctx=Load(), lineno=735, col_offset=56, end_lineno=735, end_col_offset=64), slice=Tuple(elts=[List(elts=[Name(id='VectorArray', ctx=Load(), lineno=735, col_offset=66, end_lineno=735, end_col_offset=77)], ctx=Load(), lineno=735, col_offset=65, end_lineno=735, end_col_offset=78), Constant(value=None, lineno=735, col_offset=80, end_lineno=735, end_col_offset=84)], ctx=Load(), lineno=735, col_offset=65, end_lineno=735, end_col_offset=84), ctx=Load(), lineno=735, col_offset=56, end_lineno=735, end_col_offset=85), lineno=735, col_offset=0, end_lineno=740, end_col_offset=58), ClassDef(name='_FaissModuleAdapter', body=[Expr(value=Constant(value='Adapter that exposes PEP 8 method names for FAISS modules.\n\n    Initializes adapter with legacy FAISS module.\n\n    Parameters\n    ----------\n    module : _LegacyFaissModule\n        Legacy FAISS module with UPPER_CASE names.\n    ', lineno=744, col_offset=4, end_lineno=752, end_col_offset=7), lineno=744, col_offset=4, end_lineno=752, end_col_offset=7), FunctionDef(name='__init__', args=arguments(args=[arg(arg='self', lineno=754, col_offset=17, end_lineno=754, end_col_offset=21), arg(arg='module', annotation=Name(id='_LegacyFaissModule', ctx=Load(), lineno=754, col_offset=31, end_lineno=754, end_col_offset=49), lineno=754, col_offset=23, end_lineno=754, end_col_offset=49)]), body=[Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=755, col_offset=8, end_lineno=755, end_col_offset=12), attr='_module', ctx=Store(), lineno=755, col_offset=8, end_lineno=755, end_col_offset=20)], value=Name(id='module', ctx=Load(), lineno=755, col_offset=23, end_lineno=755, end_col_offset=29), lineno=755, col_offset=8, end_lineno=755, end_col_offset=29)], returns=Constant(value=None, lineno=754, col_offset=54, end_lineno=754, end_col_offset=58), lineno=754, col_offset=4, end_lineno=755, end_col_offset=29), FunctionDef(name='metric_inner_product', args=arguments(args=[arg(arg='self', lineno=758, col_offset=29, end_lineno=758, end_col_offset=33)]), body=[Expr(value=Constant(value='Return inner product metric constant.', lineno=759, col_offset=8, end_lineno=759, end_col_offset=51), lineno=759, col_offset=8, end_lineno=759, end_col_offset=51), Return(value=Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=760, col_offset=15, end_lineno=760, end_col_offset=19), attr='_module', ctx=Load(), lineno=760, col_offset=15, end_lineno=760, end_col_offset=27), attr='METRIC_INNER_PRODUCT', ctx=Load(), lineno=760, col_offset=15, end_lineno=760, end_col_offset=48), lineno=760, col_offset=8, end_lineno=760, end_col_offset=48)], decorator_list=[Name(id='property', ctx=Load(), lineno=757, col_offset=5, end_lineno=757, end_col_offset=13)], returns=Name(id='int', ctx=Load(), lineno=758, col_offset=38, end_lineno=758, end_col_offset=41), lineno=758, col_offset=4, end_lineno=760, end_col_offset=48), FunctionDef(name='metric_l2', args=arguments(args=[arg(arg='self', lineno=763, col_offset=18, end_lineno=763, end_col_offset=22)]), body=[Expr(value=Constant(value='Return L2 metric constant.', lineno=764, col_offset=8, end_lineno=764, end_col_offset=40), lineno=764, col_offset=8, end_lineno=764, end_col_offset=40), Return(value=Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=765, col_offset=15, end_lineno=765, end_col_offset=19), attr='_module', ctx=Load(), lineno=765, col_offset=15, end_lineno=765, end_col_offset=27), attr='METRIC_L2', ctx=Load(), lineno=765, col_offset=15, end_lineno=765, end_col_offset=37), lineno=765, col_offset=8, end_lineno=765, end_col_offset=37)], decorator_list=[Name(id='property', ctx=Load(), lineno=762, col_offset=5, end_lineno=762, end_col_offset=13)], returns=Name(id='int', ctx=Load(), lineno=763, col_offset=27, end_lineno=763, end_col_offset=30), lineno=763, col_offset=4, end_lineno=765, end_col_offset=37), FunctionDef(name='index_flat_ip', args=arguments(args=[arg(arg='self', lineno=767, col_offset=22, end_lineno=767, end_col_offset=26), arg(arg='dimension', annotation=Name(id='int', ctx=Load(), lineno=767, col_offset=39, end_lineno=767, end_col_offset=42), lineno=767, col_offset=28, end_lineno=767, end_col_offset=42)]), body=[Expr(value=Constant(value='Create flat inner product index.\n\n        Parameters\n        ----------\n        dimension : int\n            Vector dimension.\n\n        Returns\n        -------\n        FaissIndexProtocol\n            FAISS index instance.\n        ', lineno=768, col_offset=8, end_lineno=779, end_col_offset=11), lineno=768, col_offset=8, end_lineno=779, end_col_offset=11), Assign(targets=[Name(id='constructor', ctx=Store(), lineno=780, col_offset=8, end_lineno=780, end_col_offset=19)], value=Call(func=Name(id='_legacy_index_flat_ip', ctx=Load(), lineno=780, col_offset=22, end_lineno=780, end_col_offset=43), args=[Attribute(value=Name(id='self', ctx=Load(), lineno=780, col_offset=44, end_lineno=780, end_col_offset=48), attr='_module', ctx=Load(), lineno=780, col_offset=44, end_lineno=780, end_col_offset=56)], lineno=780, col_offset=22, end_lineno=780, end_col_offset=57), lineno=780, col_offset=8, end_lineno=780, end_col_offset=57), Return(value=Call(func=Name(id='constructor', ctx=Load(), lineno=781, col_offset=15, end_lineno=781, end_col_offset=26), args=[Name(id='dimension', ctx=Load(), lineno=781, col_offset=27, end_lineno=781, end_col_offset=36)], lineno=781, col_offset=15, end_lineno=781, end_col_offset=37), lineno=781, col_offset=8, end_lineno=781, end_col_offset=37)], returns=Name(id='FaissIndexProtocol', ctx=Load(), lineno=767, col_offset=47, end_lineno=767, end_col_offset=65), lineno=767, col_offset=4, end_lineno=781, end_col_offset=37), FunctionDef(name='index_factory', args=arguments(args=[arg(arg='self', lineno=783, col_offset=22, end_lineno=783, end_col_offset=26), arg(arg='dimension', annotation=Name(id='int', ctx=Load(), lineno=783, col_offset=39, end_lineno=783, end_col_offset=42), lineno=783, col_offset=28, end_lineno=783, end_col_offset=42), arg(arg='factory_string', annotation=Name(id='str', ctx=Load(), lineno=783, col_offset=60, end_lineno=783, end_col_offset=63), lineno=783, col_offset=44, end_lineno=783, end_col_offset=63), arg(arg='metric', annotation=Name(id='int', ctx=Load(), lineno=783, col_offset=73, end_lineno=783, end_col_offset=76), lineno=783, col_offset=65, end_lineno=783, end_col_offset=76)]), body=[Expr(value=Constant(value='Create index from factory string.\n\n        Parameters\n        ----------\n        dimension : int\n            Vector dimension.\n        factory_string : str\n            Factory description string.\n        metric : int\n            Distance metric constant.\n\n        Returns\n        -------\n        FaissIndexProtocol\n            FAISS index instance.\n        ', lineno=784, col_offset=8, end_lineno=799, end_col_offset=11), lineno=784, col_offset=8, end_lineno=799, end_col_offset=11), Return(value=Call(func=Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=800, col_offset=15, end_lineno=800, end_col_offset=19), attr='_module', ctx=Load(), lineno=800, col_offset=15, end_lineno=800, end_col_offset=27), attr='index_factory', ctx=Load(), lineno=800, col_offset=15, end_lineno=800, end_col_offset=41), args=[Name(id='dimension', ctx=Load(), lineno=800, col_offset=42, end_lineno=800, end_col_offset=51), Name(id='factory_string', ctx=Load(), lineno=800, col_offset=53, end_lineno=800, end_col_offset=67), Name(id='metric', ctx=Load(), lineno=800, col_offset=69, end_lineno=800, end_col_offset=75)], lineno=800, col_offset=15, end_lineno=800, end_col_offset=76), lineno=800, col_offset=8, end_lineno=800, end_col_offset=76)], returns=Name(id='FaissIndexProtocol', ctx=Load(), lineno=783, col_offset=81, end_lineno=783, end_col_offset=99), lineno=783, col_offset=4, end_lineno=800, end_col_offset=76), FunctionDef(name='index_id_map2', args=arguments(args=[arg(arg='self', lineno=802, col_offset=22, end_lineno=802, end_col_offset=26), arg(arg='index', annotation=Name(id='FaissIndexProtocol', ctx=Load(), lineno=802, col_offset=35, end_lineno=802, end_col_offset=53), lineno=802, col_offset=28, end_lineno=802, end_col_offset=53)]), body=[Expr(value=Constant(value='Wrap index with 64-bit ID mapping.\n\n        Parameters\n        ----------\n        index : FaissIndexProtocol\n            Base index to wrap.\n\n        Returns\n        -------\n        FaissIndexProtocol\n            Index with ID mapping.\n        ', lineno=803, col_offset=8, end_lineno=814, end_col_offset=11), lineno=803, col_offset=8, end_lineno=814, end_col_offset=11), Assign(targets=[Name(id='wrapper', ctx=Store(), lineno=815, col_offset=8, end_lineno=815, end_col_offset=15)], value=Call(func=Name(id='_legacy_index_id_map2', ctx=Load(), lineno=815, col_offset=18, end_lineno=815, end_col_offset=39), args=[Attribute(value=Name(id='self', ctx=Load(), lineno=815, col_offset=40, end_lineno=815, end_col_offset=44), attr='_module', ctx=Load(), lineno=815, col_offset=40, end_lineno=815, end_col_offset=52)], lineno=815, col_offset=18, end_lineno=815, end_col_offset=53), lineno=815, col_offset=8, end_lineno=815, end_col_offset=53), Return(value=Call(func=Name(id='wrapper', ctx=Load(), lineno=816, col_offset=15, end_lineno=816, end_col_offset=22), args=[Name(id='index', ctx=Load(), lineno=816, col_offset=23, end_lineno=816, end_col_offset=28)], lineno=816, col_offset=15, end_lineno=816, end_col_offset=29), lineno=816, col_offset=8, end_lineno=816, end_col_offset=29)], returns=Name(id='FaissIndexProtocol', ctx=Load(), lineno=802, col_offset=58, end_lineno=802, end_col_offset=76), lineno=802, col_offset=4, end_lineno=816, end_col_offset=29), FunctionDef(name='write_index', args=arguments(args=[arg(arg='self', lineno=818, col_offset=20, end_lineno=818, end_col_offset=24), arg(arg='index', annotation=Name(id='FaissIndexProtocol', ctx=Load(), lineno=818, col_offset=33, end_lineno=818, end_col_offset=51), lineno=818, col_offset=26, end_lineno=818, end_col_offset=51), arg(arg='path', annotation=Name(id='str', ctx=Load(), lineno=818, col_offset=59, end_lineno=818, end_col_offset=62), lineno=818, col_offset=53, end_lineno=818, end_col_offset=62)]), body=[Expr(value=Constant(value='Write index to disk.\n\n        Parameters\n        ----------\n        index : FaissIndexProtocol\n            Index to serialize.\n        path : str\n            Output file path.\n        ', lineno=819, col_offset=8, end_lineno=827, end_col_offset=11), lineno=819, col_offset=8, end_lineno=827, end_col_offset=11), Expr(value=Call(func=Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=828, col_offset=8, end_lineno=828, end_col_offset=12), attr='_module', ctx=Load(), lineno=828, col_offset=8, end_lineno=828, end_col_offset=20), attr='write_index', ctx=Load(), lineno=828, col_offset=8, end_lineno=828, end_col_offset=32), args=[Name(id='index', ctx=Load(), lineno=828, col_offset=33, end_lineno=828, end_col_offset=38), Name(id='path', ctx=Load(), lineno=828, col_offset=40, end_lineno=828, end_col_offset=44)], lineno=828, col_offset=8, end_lineno=828, end_col_offset=45), lineno=828, col_offset=8, end_lineno=828, end_col_offset=45)], returns=Constant(value=None, lineno=818, col_offset=67, end_lineno=818, end_col_offset=71), lineno=818, col_offset=4, end_lineno=828, end_col_offset=45), FunctionDef(name='read_index', args=arguments(args=[arg(arg='self', lineno=830, col_offset=19, end_lineno=830, end_col_offset=23), arg(arg='path', annotation=Name(id='str', ctx=Load(), lineno=830, col_offset=31, end_lineno=830, end_col_offset=34), lineno=830, col_offset=25, end_lineno=830, end_col_offset=34)]), body=[Expr(value=Constant(value='Read index from disk.\n\n        Parameters\n        ----------\n        path : str\n            Input file path.\n\n        Returns\n        -------\n        FaissIndexProtocol\n            Loaded index instance.\n        ', lineno=831, col_offset=8, end_lineno=842, end_col_offset=11), lineno=831, col_offset=8, end_lineno=842, end_col_offset=11), Return(value=Call(func=Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=843, col_offset=15, end_lineno=843, end_col_offset=19), attr='_module', ctx=Load(), lineno=843, col_offset=15, end_lineno=843, end_col_offset=27), attr='read_index', ctx=Load(), lineno=843, col_offset=15, end_lineno=843, end_col_offset=38), args=[Name(id='path', ctx=Load(), lineno=843, col_offset=39, end_lineno=843, end_col_offset=43)], lineno=843, col_offset=15, end_lineno=843, end_col_offset=44), lineno=843, col_offset=8, end_lineno=843, end_col_offset=44)], returns=Name(id='FaissIndexProtocol', ctx=Load(), lineno=830, col_offset=39, end_lineno=830, end_col_offset=57), lineno=830, col_offset=4, end_lineno=843, end_col_offset=44), FunctionDef(name='normalize_l2', args=arguments(args=[arg(arg='self', lineno=845, col_offset=21, end_lineno=845, end_col_offset=25), arg(arg='vectors', annotation=Name(id='VectorArray', ctx=Load(), lineno=845, col_offset=36, end_lineno=845, end_col_offset=47), lineno=845, col_offset=27, end_lineno=845, end_col_offset=47)]), body=[Expr(value=Constant(value='Normalize vectors to unit length in-place.\n\n        Parameters\n        ----------\n        vectors : VectorArray\n            Vector array to normalize (modified in-place).\n        ', lineno=846, col_offset=8, end_lineno=852, end_col_offset=11), lineno=846, col_offset=8, end_lineno=852, end_col_offset=11), Assign(targets=[Name(id='normalizer', ctx=Store(), lineno=853, col_offset=8, end_lineno=853, end_col_offset=18)], value=Call(func=Name(id='_legacy_normalize_l2', ctx=Load(), lineno=853, col_offset=21, end_lineno=853, end_col_offset=41), args=[Attribute(value=Name(id='self', ctx=Load(), lineno=853, col_offset=42, end_lineno=853, end_col_offset=46), attr='_module', ctx=Load(), lineno=853, col_offset=42, end_lineno=853, end_col_offset=54)], lineno=853, col_offset=21, end_lineno=853, end_col_offset=55), lineno=853, col_offset=8, end_lineno=853, end_col_offset=55), Expr(value=Call(func=Name(id='normalizer', ctx=Load(), lineno=854, col_offset=8, end_lineno=854, end_col_offset=18), args=[Name(id='vectors', ctx=Load(), lineno=854, col_offset=19, end_lineno=854, end_col_offset=26)], lineno=854, col_offset=8, end_lineno=854, end_col_offset=27), lineno=854, col_offset=8, end_lineno=854, end_col_offset=27)], returns=Constant(value=None, lineno=845, col_offset=52, end_lineno=845, end_col_offset=56), lineno=845, col_offset=4, end_lineno=854, end_col_offset=27), FunctionDef(name='__getattr__', args=arguments(args=[arg(arg='self', lineno=856, col_offset=20, end_lineno=856, end_col_offset=24), arg(arg='name', annotation=Name(id='str', ctx=Load(), lineno=856, col_offset=32, end_lineno=856, end_col_offset=35), lineno=856, col_offset=26, end_lineno=856, end_col_offset=35)]), body=[Expr(value=Constant(value='Get attribute with legacy name fallback.\n\n        Parameters\n        ----------\n        name : str\n            Attribute name.\n\n        Returns\n        -------\n        object\n            Attribute value from module.\n        ', lineno=857, col_offset=8, end_lineno=868, end_col_offset=11), lineno=857, col_offset=8, end_lineno=868, end_col_offset=11), If(test=Compare(left=Name(id='name', ctx=Load(), lineno=869, col_offset=11, end_lineno=869, end_col_offset=15), ops=[Eq()], comparators=[Constant(value='METRIC_INNER_PRODUCT', lineno=869, col_offset=19, end_lineno=869, end_col_offset=41)], lineno=869, col_offset=11, end_lineno=869, end_col_offset=41), body=[Return(value=Attribute(value=Name(id='self', ctx=Load(), lineno=870, col_offset=19, end_lineno=870, end_col_offset=23), attr='metric_inner_product', ctx=Load(), lineno=870, col_offset=19, end_lineno=870, end_col_offset=44), lineno=870, col_offset=12, end_lineno=870, end_col_offset=44)], lineno=869, col_offset=8, end_lineno=870, end_col_offset=44), If(test=Compare(left=Name(id='name', ctx=Load(), lineno=871, col_offset=11, end_lineno=871, end_col_offset=15), ops=[Eq()], comparators=[Constant(value='METRIC_L2', lineno=871, col_offset=19, end_lineno=871, end_col_offset=30)], lineno=871, col_offset=11, end_lineno=871, end_col_offset=30), body=[Return(value=Attribute(value=Name(id='self', ctx=Load(), lineno=872, col_offset=19, end_lineno=872, end_col_offset=23), attr='metric_l2', ctx=Load(), lineno=872, col_offset=19, end_lineno=872, end_col_offset=33), lineno=872, col_offset=12, end_lineno=872, end_col_offset=33)], lineno=871, col_offset=8, end_lineno=872, end_col_offset=33), If(test=Compare(left=Name(id='name', ctx=Load(), lineno=873, col_offset=11, end_lineno=873, end_col_offset=15), ops=[Eq()], comparators=[Constant(value='IndexFlatIP', lineno=873, col_offset=19, end_lineno=873, end_col_offset=32)], lineno=873, col_offset=11, end_lineno=873, end_col_offset=32), body=[Return(value=Attribute(value=Name(id='self', ctx=Load(), lineno=874, col_offset=19, end_lineno=874, end_col_offset=23), attr='index_flat_ip', ctx=Load(), lineno=874, col_offset=19, end_lineno=874, end_col_offset=37), lineno=874, col_offset=12, end_lineno=874, end_col_offset=37)], lineno=873, col_offset=8, end_lineno=874, end_col_offset=37), If(test=Compare(left=Name(id='name', ctx=Load(), lineno=875, col_offset=11, end_lineno=875, end_col_offset=15), ops=[Eq()], comparators=[Constant(value='IndexIDMap2', lineno=875, col_offset=19, end_lineno=875, end_col_offset=32)], lineno=875, col_offset=11, end_lineno=875, end_col_offset=32), body=[Return(value=Attribute(value=Name(id='self', ctx=Load(), lineno=876, col_offset=19, end_lineno=876, end_col_offset=23), attr='index_id_map2', ctx=Load(), lineno=876, col_offset=19, end_lineno=876, end_col_offset=37), lineno=876, col_offset=12, end_lineno=876, end_col_offset=37)], lineno=875, col_offset=8, end_lineno=876, end_col_offset=37), If(test=Compare(left=Name(id='name', ctx=Load(), lineno=877, col_offset=11, end_lineno=877, end_col_offset=15), ops=[Eq()], comparators=[Constant(value='normalize_L2', lineno=877, col_offset=19, end_lineno=877, end_col_offset=33)], lineno=877, col_offset=11, end_lineno=877, end_col_offset=33), body=[Return(value=Attribute(value=Name(id='self', ctx=Load(), lineno=878, col_offset=19, end_lineno=878, end_col_offset=23), attr='normalize_l2', ctx=Load(), lineno=878, col_offset=19, end_lineno=878, end_col_offset=36), lineno=878, col_offset=12, end_lineno=878, end_col_offset=36)], lineno=877, col_offset=8, end_lineno=878, end_col_offset=36), Return(value=Call(func=Name(id='cast', ctx=Load(), lineno=879, col_offset=15, end_lineno=879, end_col_offset=19), args=[Constant(value='object', lineno=879, col_offset=20, end_lineno=879, end_col_offset=28), Call(func=Name(id='getattr', ctx=Load(), lineno=879, col_offset=30, end_lineno=879, end_col_offset=37), args=[Attribute(value=Name(id='self', ctx=Load(), lineno=879, col_offset=38, end_lineno=879, end_col_offset=42), attr='_module', ctx=Load(), lineno=879, col_offset=38, end_lineno=879, end_col_offset=50), Name(id='name', ctx=Load(), lineno=879, col_offset=52, end_lineno=879, end_col_offset=56)], lineno=879, col_offset=30, end_lineno=879, end_col_offset=57)], lineno=879, col_offset=15, end_lineno=879, end_col_offset=58), lineno=879, col_offset=8, end_lineno=879, end_col_offset=58)], returns=Name(id='object', ctx=Load(), lineno=856, col_offset=40, end_lineno=856, end_col_offset=46), lineno=856, col_offset=4, end_lineno=879, end_col_offset=58)], lineno=743, col_offset=0, end_lineno=879, end_col_offset=58), FunctionDef(name='wrap_faiss_module', args=arguments(args=[arg(arg='module', annotation=Name(id='object', ctx=Load(), lineno=883, col_offset=30, end_lineno=883, end_col_offset=36), lineno=883, col_offset=22, end_lineno=883, end_col_offset=36)]), body=[Expr(value=Constant(value='Return a :class:`FaissModuleProtocol` with PEP 8 method names.\n\n    Parameters\n    ----------\n    module : object\n        FAISS module to wrap.\n\n    Returns\n    -------\n    FaissModuleProtocol\n        Wrapped module conforming to protocol.\n    ', lineno=884, col_offset=4, end_lineno=895, end_col_offset=7), lineno=884, col_offset=4, end_lineno=895, end_col_offset=7), Assign(targets=[Name(id='required_attributes', ctx=Store(), lineno=896, col_offset=4, end_lineno=896, end_col_offset=23)], value=Tuple(elts=[Constant(value='index_flat_ip', lineno=897, col_offset=8, end_lineno=897, end_col_offset=23), Constant(value='index_factory', lineno=898, col_offset=8, end_lineno=898, end_col_offset=23), Constant(value='index_id_map2', lineno=899, col_offset=8, end_lineno=899, end_col_offset=23), Constant(value='write_index', lineno=900, col_offset=8, end_lineno=900, end_col_offset=21), Constant(value='read_index', lineno=901, col_offset=8, end_lineno=901, end_col_offset=20), Constant(value='normalize_l2', lineno=902, col_offset=8, end_lineno=902, end_col_offset=22)], ctx=Load(), lineno=896, col_offset=26, end_lineno=903, end_col_offset=5), lineno=896, col_offset=4, end_lineno=903, end_col_offset=5), If(test=Call(func=Name(id='all', ctx=Load(), lineno=904, col_offset=7, end_lineno=904, end_col_offset=10), args=[GeneratorExp(elt=Call(func=Name(id='hasattr', ctx=Load(), lineno=904, col_offset=11, end_lineno=904, end_col_offset=18), args=[Name(id='module', ctx=Load(), lineno=904, col_offset=19, end_lineno=904, end_col_offset=25), Name(id='attribute', ctx=Load(), lineno=904, col_offset=27, end_lineno=904, end_col_offset=36)], lineno=904, col_offset=11, end_lineno=904, end_col_offset=37), generators=[comprehension(target=Name(id='attribute', ctx=Store(), lineno=904, col_offset=42, end_lineno=904, end_col_offset=51), iter=Name(id='required_attributes', ctx=Load(), lineno=904, col_offset=55, end_lineno=904, end_col_offset=74), is_async=0)], lineno=904, col_offset=10, end_lineno=904, end_col_offset=75)], lineno=904, col_offset=7, end_lineno=904, end_col_offset=75), body=[Return(value=Call(func=Name(id='cast', ctx=Load(), lineno=905, col_offset=15, end_lineno=905, end_col_offset=19), args=[Constant(value='FaissModuleProtocol', lineno=905, col_offset=20, end_lineno=905, end_col_offset=41), Name(id='module', ctx=Load(), lineno=905, col_offset=43, end_lineno=905, end_col_offset=49)], lineno=905, col_offset=15, end_lineno=905, end_col_offset=50), lineno=905, col_offset=8, end_lineno=905, end_col_offset=50)], lineno=904, col_offset=4, end_lineno=905, end_col_offset=50), Assign(targets=[Name(id='legacy_module', ctx=Store(), lineno=906, col_offset=4, end_lineno=906, end_col_offset=17)], value=Call(func=Name(id='cast', ctx=Load(), lineno=906, col_offset=20, end_lineno=906, end_col_offset=24), args=[Constant(value='_LegacyFaissModule', lineno=906, col_offset=25, end_lineno=906, end_col_offset=45), Name(id='module', ctx=Load(), lineno=906, col_offset=47, end_lineno=906, end_col_offset=53)], lineno=906, col_offset=20, end_lineno=906, end_col_offset=54), lineno=906, col_offset=4, end_lineno=906, end_col_offset=54), Return(value=Call(func=Name(id='cast', ctx=Load(), lineno=907, col_offset=11, end_lineno=907, end_col_offset=15), args=[Constant(value='FaissModuleProtocol', lineno=907, col_offset=16, end_lineno=907, end_col_offset=37), Call(func=Name(id='_FaissModuleAdapter', ctx=Load(), lineno=907, col_offset=39, end_lineno=907, end_col_offset=58), args=[Name(id='legacy_module', ctx=Load(), lineno=907, col_offset=59, end_lineno=907, end_col_offset=72)], lineno=907, col_offset=39, end_lineno=907, end_col_offset=73)], lineno=907, col_offset=11, end_lineno=907, end_col_offset=74), lineno=907, col_offset=4, end_lineno=907, end_col_offset=74)], returns=Name(id='FaissModuleProtocol', ctx=Load(), lineno=883, col_offset=41, end_lineno=883, end_col_offset=60), lineno=883, col_offset=0, end_lineno=907, end_col_offset=74)])