Module(body=[Expr(value=Constant(value='Cached application context for MCP tool adapters.\n\nThis module exposes a small facade that lazily creates and caches the\n:class:`~codeintel_rev.app.config_context.ApplicationContext` used by the MCP\nserver tool adapters. The cached context reuses the same configuration and\npath-resolution logic as the FastAPI app and readiness probes because it\nultimately delegates creation to :meth:`ApplicationContext.create`, which reads\nenvironment overrides and resolves paths via\n:func:`~codeintel_rev.app.config_context.resolve_application_paths`.\n\nThe cache ensures heavy resources such as the FAISS index manager and DuckDB\ncatalog are only initialized once per process. Tests and administrative scripts\ncan call :func:`reset_service_context` to clear the cache when environment\nvariables change or when they need fresh dependencies.\n', lineno=1, col_offset=0, end_lineno=15, end_col_offset=3), lineno=1, col_offset=0, end_lineno=15, end_col_offset=3), ImportFrom(module='__future__', names=[alias(name='annotations', lineno=17, col_offset=23, end_lineno=17, end_col_offset=34)], level=0, lineno=17, col_offset=0, end_lineno=17, end_col_offset=34), ImportFrom(module='threading', names=[alias(name='Lock', lineno=19, col_offset=22, end_lineno=19, end_col_offset=26)], level=0, lineno=19, col_offset=0, end_lineno=19, end_col_offset=26), ImportFrom(module='codeintel_rev.app.config_context', names=[alias(name='ApplicationContext', lineno=21, col_offset=45, end_lineno=21, end_col_offset=63)], level=0, lineno=21, col_offset=0, end_lineno=21, end_col_offset=63), Assign(targets=[Name(id='__all__', ctx=Store(), lineno=23, col_offset=0, end_lineno=23, end_col_offset=7)], value=List(elts=[Constant(value='get_service_context', lineno=23, col_offset=11, end_lineno=23, end_col_offset=32), Constant(value='reset_service_context', lineno=23, col_offset=34, end_lineno=23, end_col_offset=57)], ctx=Load(), lineno=23, col_offset=10, end_lineno=23, end_col_offset=58), lineno=23, col_offset=0, end_lineno=23, end_col_offset=58), Assign(targets=[Name(id='_CONTEXT_LOCK', ctx=Store(), lineno=27, col_offset=0, end_lineno=27, end_col_offset=13)], value=Call(func=Name(id='Lock', ctx=Load(), lineno=27, col_offset=16, end_lineno=27, end_col_offset=20), lineno=27, col_offset=16, end_lineno=27, end_col_offset=22), lineno=27, col_offset=0, end_lineno=27, end_col_offset=22), FunctionDef(name='_get_cached_context', args=arguments(), body=[Expr(value=Constant(value='Get cached context using function attribute pattern.\n\n    Returns\n    -------\n    ApplicationContext | None\n        Cached context instance or None if not yet initialized.\n    ', lineno=31, col_offset=4, end_lineno=37, end_col_offset=7), lineno=31, col_offset=4, end_lineno=37, end_col_offset=7), Return(value=Call(func=Name(id='getattr', ctx=Load(), lineno=38, col_offset=11, end_lineno=38, end_col_offset=18), args=[Name(id='_get_cached_context', ctx=Load(), lineno=38, col_offset=19, end_lineno=38, end_col_offset=38), Constant(value='_cached', lineno=38, col_offset=40, end_lineno=38, end_col_offset=49), Constant(value=None, lineno=38, col_offset=51, end_lineno=38, end_col_offset=55)], lineno=38, col_offset=11, end_lineno=38, end_col_offset=56), lineno=38, col_offset=4, end_lineno=38, end_col_offset=56)], returns=BinOp(left=Name(id='ApplicationContext', ctx=Load(), lineno=30, col_offset=29, end_lineno=30, end_col_offset=47), op=BitOr(), right=Constant(value=None, lineno=30, col_offset=50, end_lineno=30, end_col_offset=54), lineno=30, col_offset=29, end_lineno=30, end_col_offset=54), lineno=30, col_offset=0, end_lineno=38, end_col_offset=56), FunctionDef(name='_set_cached_context', args=arguments(args=[arg(arg='context', annotation=BinOp(left=Name(id='ApplicationContext', ctx=Load(), lineno=41, col_offset=33, end_lineno=41, end_col_offset=51), op=BitOr(), right=Constant(value=None, lineno=41, col_offset=54, end_lineno=41, end_col_offset=58), lineno=41, col_offset=33, end_lineno=41, end_col_offset=58), lineno=41, col_offset=24, end_lineno=41, end_col_offset=58)]), body=[Expr(value=Constant(value='Set cached context using function attribute pattern.\n\n    Parameters\n    ----------\n    context : ApplicationContext | None\n        Context instance to cache, or None to clear cache.\n    ', lineno=42, col_offset=4, end_lineno=48, end_col_offset=7), lineno=42, col_offset=4, end_lineno=48, end_col_offset=7), Assign(targets=[Attribute(value=Name(id='_get_cached_context', ctx=Load(), lineno=50, col_offset=4, end_lineno=50, end_col_offset=23), attr='_cached', ctx=Store(), lineno=50, col_offset=4, end_lineno=50, end_col_offset=31)], value=Name(id='context', ctx=Load(), lineno=50, col_offset=34, end_lineno=50, end_col_offset=41), lineno=50, col_offset=4, end_lineno=50, end_col_offset=41)], returns=Constant(value=None, lineno=41, col_offset=63, end_lineno=41, end_col_offset=67), lineno=41, col_offset=0, end_lineno=50, end_col_offset=41), FunctionDef(name='get_service_context', args=arguments(), body=[Expr(value=Constant(value='Return the cached :class:`ApplicationContext` instance.\n\n    The first invocation creates the context via\n    :meth:`ApplicationContext.create`. Subsequent calls return the cached\n    instance so that adapters share the same settings, resolved paths, and\n    long-lived clients.\n\n    Returns\n    -------\n    ApplicationContext\n        Cached application context instance with settings, resolved paths,\n        and long-lived clients (FAISS manager, vLLM client, DuckDB catalog).\n    ', lineno=54, col_offset=4, end_lineno=66, end_col_offset=7), lineno=54, col_offset=4, end_lineno=66, end_col_offset=7), Assign(targets=[Name(id='cached', ctx=Store(), lineno=67, col_offset=4, end_lineno=67, end_col_offset=10)], value=Call(func=Name(id='_get_cached_context', ctx=Load(), lineno=67, col_offset=13, end_lineno=67, end_col_offset=32), lineno=67, col_offset=13, end_lineno=67, end_col_offset=34), lineno=67, col_offset=4, end_lineno=67, end_col_offset=34), If(test=Compare(left=Name(id='cached', ctx=Load(), lineno=68, col_offset=7, end_lineno=68, end_col_offset=13), ops=[Is()], comparators=[Constant(value=None, lineno=68, col_offset=17, end_lineno=68, end_col_offset=21)], lineno=68, col_offset=7, end_lineno=68, end_col_offset=21), body=[With(items=[withitem(context_expr=Name(id='_CONTEXT_LOCK', ctx=Load(), lineno=69, col_offset=13, end_lineno=69, end_col_offset=26))], body=[Assign(targets=[Name(id='cached', ctx=Store(), lineno=70, col_offset=12, end_lineno=70, end_col_offset=18)], value=Call(func=Name(id='_get_cached_context', ctx=Load(), lineno=70, col_offset=21, end_lineno=70, end_col_offset=40), lineno=70, col_offset=21, end_lineno=70, end_col_offset=42), lineno=70, col_offset=12, end_lineno=70, end_col_offset=42), If(test=Compare(left=Name(id='cached', ctx=Load(), lineno=71, col_offset=15, end_lineno=71, end_col_offset=21), ops=[Is()], comparators=[Constant(value=None, lineno=71, col_offset=25, end_lineno=71, end_col_offset=29)], lineno=71, col_offset=15, end_lineno=71, end_col_offset=29), body=[Assign(targets=[Name(id='cached', ctx=Store(), lineno=72, col_offset=16, end_lineno=72, end_col_offset=22)], value=Call(func=Attribute(value=Name(id='ApplicationContext', ctx=Load(), lineno=72, col_offset=25, end_lineno=72, end_col_offset=43), attr='create', ctx=Load(), lineno=72, col_offset=25, end_lineno=72, end_col_offset=50), lineno=72, col_offset=25, end_lineno=72, end_col_offset=52), lineno=72, col_offset=16, end_lineno=72, end_col_offset=52), Expr(value=Call(func=Name(id='_set_cached_context', ctx=Load(), lineno=73, col_offset=16, end_lineno=73, end_col_offset=35), args=[Name(id='cached', ctx=Load(), lineno=73, col_offset=36, end_lineno=73, end_col_offset=42)], lineno=73, col_offset=16, end_lineno=73, end_col_offset=43), lineno=73, col_offset=16, end_lineno=73, end_col_offset=43)], lineno=71, col_offset=12, end_lineno=73, end_col_offset=43)], lineno=69, col_offset=8, end_lineno=73, end_col_offset=43)], lineno=68, col_offset=4, end_lineno=73, end_col_offset=43), Return(value=Name(id='cached', ctx=Load(), lineno=74, col_offset=11, end_lineno=74, end_col_offset=17), lineno=74, col_offset=4, end_lineno=74, end_col_offset=17)], returns=Name(id='ApplicationContext', ctx=Load(), lineno=53, col_offset=29, end_lineno=53, end_col_offset=47), lineno=53, col_offset=0, end_lineno=74, end_col_offset=17), FunctionDef(name='reset_service_context', args=arguments(), body=[Expr(value=Constant(value='Clear the cached :class:`ApplicationContext`.\n\n    Primarily intended for tests or scripts that mutate environment variables\n    between runs. The next call to :func:`get_service_context` will recreate the\n    context from the latest configuration.\n    ', lineno=78, col_offset=4, end_lineno=83, end_col_offset=7), lineno=78, col_offset=4, end_lineno=83, end_col_offset=7), With(items=[withitem(context_expr=Name(id='_CONTEXT_LOCK', ctx=Load(), lineno=84, col_offset=9, end_lineno=84, end_col_offset=22))], body=[Expr(value=Call(func=Name(id='_set_cached_context', ctx=Load(), lineno=85, col_offset=8, end_lineno=85, end_col_offset=27), args=[Constant(value=None, lineno=85, col_offset=28, end_lineno=85, end_col_offset=32)], lineno=85, col_offset=8, end_lineno=85, end_col_offset=33), lineno=85, col_offset=8, end_lineno=85, end_col_offset=33)], lineno=84, col_offset=4, end_lineno=85, end_col_offset=33)], returns=Constant(value=None, lineno=77, col_offset=31, end_lineno=77, end_col_offset=35), lineno=77, col_offset=0, end_lineno=85, end_col_offset=33)])