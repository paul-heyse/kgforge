Module(body=[Expr(value=Constant(value='Runtime primitives backing the shared CLI façade.', lineno=1, col_offset=0, end_lineno=1, end_col_offset=56), lineno=1, col_offset=0, end_lineno=1, end_col_offset=56), ImportFrom(module='__future__', names=[alias(name='annotations', lineno=3, col_offset=23, end_lineno=3, end_col_offset=34)], level=0, lineno=3, col_offset=0, end_lineno=3, end_col_offset=34), Import(names=[alias(name='hashlib', lineno=5, col_offset=7, end_lineno=5, end_col_offset=14)], lineno=5, col_offset=0, end_lineno=5, end_col_offset=14), Import(names=[alias(name='json', lineno=6, col_offset=7, end_lineno=6, end_col_offset=11)], lineno=6, col_offset=0, end_lineno=6, end_col_offset=11), Import(names=[alias(name='logging', lineno=7, col_offset=7, end_lineno=7, end_col_offset=14)], lineno=7, col_offset=0, end_lineno=7, end_col_offset=14), Import(names=[alias(name='re', lineno=8, col_offset=7, end_lineno=8, end_col_offset=9)], lineno=8, col_offset=0, end_lineno=8, end_col_offset=9), Import(names=[alias(name='time', lineno=9, col_offset=7, end_lineno=9, end_col_offset=11)], lineno=9, col_offset=0, end_lineno=9, end_col_offset=11), Import(names=[alias(name='uuid', lineno=10, col_offset=7, end_lineno=10, end_col_offset=11)], lineno=10, col_offset=0, end_lineno=10, end_col_offset=11), ImportFrom(module='collections.abc', names=[alias(name='Iterator', lineno=11, col_offset=28, end_lineno=11, end_col_offset=36), alias(name='Mapping', lineno=11, col_offset=38, end_lineno=11, end_col_offset=45), alias(name='Sequence', lineno=11, col_offset=47, end_lineno=11, end_col_offset=55)], level=0, lineno=11, col_offset=0, end_lineno=11, end_col_offset=55), ImportFrom(module='contextlib', names=[alias(name='contextmanager', lineno=12, col_offset=23, end_lineno=12, end_col_offset=37), alias(name='suppress', lineno=12, col_offset=39, end_lineno=12, end_col_offset=47)], level=0, lineno=12, col_offset=0, end_lineno=12, end_col_offset=47), ImportFrom(module='dataclasses', names=[alias(name='asdict', lineno=13, col_offset=24, end_lineno=13, end_col_offset=30), alias(name='dataclass', lineno=13, col_offset=32, end_lineno=13, end_col_offset=41)], level=0, lineno=13, col_offset=0, end_lineno=13, end_col_offset=41), ImportFrom(module='datetime', names=[alias(name='UTC', lineno=14, col_offset=21, end_lineno=14, end_col_offset=24), alias(name='datetime', lineno=14, col_offset=26, end_lineno=14, end_col_offset=34)], level=0, lineno=14, col_offset=0, end_lineno=14, end_col_offset=34), ImportFrom(module='enum', names=[alias(name='StrEnum', lineno=15, col_offset=17, end_lineno=15, end_col_offset=24)], level=0, lineno=15, col_offset=0, end_lineno=15, end_col_offset=24), ImportFrom(module='pathlib', names=[alias(name='Path', lineno=16, col_offset=20, end_lineno=16, end_col_offset=24)], level=0, lineno=16, col_offset=0, end_lineno=16, end_col_offset=24), ImportFrom(module='typing', names=[alias(name='Final', lineno=17, col_offset=19, end_lineno=17, end_col_offset=24), alias(name='Literal', lineno=17, col_offset=26, end_lineno=17, end_col_offset=33), alias(name='TypedDict', lineno=17, col_offset=35, end_lineno=17, end_col_offset=44), alias(name='Unpack', lineno=17, col_offset=46, end_lineno=17, end_col_offset=52)], level=0, lineno=17, col_offset=0, end_lineno=17, end_col_offset=52), ImportFrom(module='tools._shared.observability', names=[alias(name='MetricEmitterError', lineno=19, col_offset=40, end_lineno=19, end_col_offset=58), alias(name='emitter', lineno=19, col_offset=60, end_lineno=19, end_col_offset=67)], level=0, lineno=19, col_offset=0, end_lineno=19, end_col_offset=67), ImportFrom(module='tools._shared.paths', names=[alias(name='Paths', lineno=20, col_offset=32, end_lineno=20, end_col_offset=37)], level=0, lineno=20, col_offset=0, end_lineno=20, end_col_offset=37), ImportFrom(module='tools._shared.problems', names=[alias(name='ProblemDetails', lineno=21, col_offset=35, end_lineno=21, end_col_offset=49), alias(name='problem_from_exc', lineno=21, col_offset=51, end_lineno=21, end_col_offset=67)], level=0, lineno=21, col_offset=0, end_lineno=21, end_col_offset=67), Try(body=[ImportFrom(module='kgfoundry_common.errors', names=[alias(name='KgFoundryError', lineno=24, col_offset=40, end_lineno=24, end_col_offset=54)], level=0, lineno=24, col_offset=4, end_lineno=24, end_col_offset=54)], handlers=[ExceptHandler(type=Name(id='ImportError', ctx=Load(), lineno=25, col_offset=7, end_lineno=25, end_col_offset=18), body=[Assign(targets=[Name(id='KgFoundryError', ctx=Store(), lineno=27, col_offset=4, end_lineno=27, end_col_offset=18)], value=Name(id='Exception', ctx=Load(), lineno=27, col_offset=21, end_lineno=27, end_col_offset=30), lineno=27, col_offset=4, end_lineno=27, end_col_offset=30)], lineno=25, col_offset=0, end_lineno=27, end_col_offset=30)], lineno=23, col_offset=0, end_lineno=27, end_col_offset=30), Try(body=[Import(names=[alias(name='jsonschema', lineno=30, col_offset=11, end_lineno=30, end_col_offset=21)], lineno=30, col_offset=4, end_lineno=30, end_col_offset=21)], handlers=[ExceptHandler(type=Name(id='ImportError', ctx=Load(), lineno=31, col_offset=7, end_lineno=31, end_col_offset=18), body=[Assign(targets=[Name(id='jsonschema', ctx=Store(), lineno=32, col_offset=4, end_lineno=32, end_col_offset=14)], value=Constant(value=None, lineno=32, col_offset=17, end_lineno=32, end_col_offset=21), lineno=32, col_offset=4, end_lineno=32, end_col_offset=21)], lineno=31, col_offset=0, end_lineno=32, end_col_offset=21)], lineno=29, col_offset=0, end_lineno=32, end_col_offset=21), AnnAssign(target=Name(id='MAX_ROUTE_DEPTH', ctx=Store(), lineno=34, col_offset=0, end_lineno=34, end_col_offset=15), annotation=Subscript(value=Name(id='Final', ctx=Load(), lineno=34, col_offset=17, end_lineno=34, end_col_offset=22), slice=Name(id='int', ctx=Load(), lineno=34, col_offset=23, end_lineno=34, end_col_offset=26), ctx=Load(), lineno=34, col_offset=17, end_lineno=34, end_col_offset=27), value=Constant(value=6, lineno=34, col_offset=30, end_lineno=34, end_col_offset=31), simple=1, lineno=34, col_offset=0, end_lineno=34, end_col_offset=31), AnnAssign(target=Name(id='MAX_TOKEN_LENGTH', ctx=Store(), lineno=35, col_offset=0, end_lineno=35, end_col_offset=16), annotation=Subscript(value=Name(id='Final', ctx=Load(), lineno=35, col_offset=18, end_lineno=35, end_col_offset=23), slice=Name(id='int', ctx=Load(), lineno=35, col_offset=24, end_lineno=35, end_col_offset=27), ctx=Load(), lineno=35, col_offset=18, end_lineno=35, end_col_offset=28), value=Constant(value=48, lineno=35, col_offset=31, end_lineno=35, end_col_offset=33), simple=1, lineno=35, col_offset=0, end_lineno=35, end_col_offset=33), AnnAssign(target=Name(id='CHUNK_SIZE', ctx=Store(), lineno=36, col_offset=0, end_lineno=36, end_col_offset=10), annotation=Subscript(value=Name(id='Final', ctx=Load(), lineno=36, col_offset=12, end_lineno=36, end_col_offset=17), slice=Name(id='int', ctx=Load(), lineno=36, col_offset=18, end_lineno=36, end_col_offset=21), ctx=Load(), lineno=36, col_offset=12, end_lineno=36, end_col_offset=22), value=BinOp(left=Constant(value=256, lineno=36, col_offset=25, end_lineno=36, end_col_offset=28), op=Mult(), right=Constant(value=1024, lineno=36, col_offset=31, end_lineno=36, end_col_offset=35), lineno=36, col_offset=25, end_lineno=36, end_col_offset=35), simple=1, lineno=36, col_offset=0, end_lineno=36, end_col_offset=35), AnnAssign(target=Name(id='CLI_ENVELOPE_VERSION', ctx=Store(), lineno=37, col_offset=0, end_lineno=37, end_col_offset=20), annotation=Subscript(value=Name(id='Final', ctx=Load(), lineno=37, col_offset=22, end_lineno=37, end_col_offset=27), slice=Name(id='str', ctx=Load(), lineno=37, col_offset=28, end_lineno=37, end_col_offset=31), ctx=Load(), lineno=37, col_offset=22, end_lineno=37, end_col_offset=32), value=Constant(value='1.1.0', lineno=37, col_offset=35, end_lineno=37, end_col_offset=42), simple=1, lineno=37, col_offset=0, end_lineno=37, end_col_offset=42), Assign(targets=[Name(id='_TOKEN_RE', ctx=Store(), lineno=39, col_offset=0, end_lineno=39, end_col_offset=9)], value=Call(func=Attribute(value=Name(id='re', ctx=Load(), lineno=39, col_offset=12, end_lineno=39, end_col_offset=14), attr='compile', ctx=Load(), lineno=39, col_offset=12, end_lineno=39, end_col_offset=22), args=[Constant(value='[^a-z0-9_-]+', lineno=39, col_offset=23, end_lineno=39, end_col_offset=38)], lineno=39, col_offset=12, end_lineno=39, end_col_offset=39), lineno=39, col_offset=0, end_lineno=39, end_col_offset=39), ClassDef(name='CliRunStatus', bases=[Name(id='StrEnum', ctx=Load(), lineno=42, col_offset=19, end_lineno=42, end_col_offset=26)], body=[Expr(value=Constant(value='Enumerated status values for CLI envelopes and logs.', lineno=43, col_offset=4, end_lineno=43, end_col_offset=62), lineno=43, col_offset=4, end_lineno=43, end_col_offset=62), Assign(targets=[Name(id='SUCCESS', ctx=Store(), lineno=45, col_offset=4, end_lineno=45, end_col_offset=11)], value=Constant(value='success', lineno=45, col_offset=14, end_lineno=45, end_col_offset=23), lineno=45, col_offset=4, end_lineno=45, end_col_offset=23), Assign(targets=[Name(id='ERROR', ctx=Store(), lineno=46, col_offset=4, end_lineno=46, end_col_offset=9)], value=Constant(value='error', lineno=46, col_offset=12, end_lineno=46, end_col_offset=19), lineno=46, col_offset=4, end_lineno=46, end_col_offset=19)], lineno=42, col_offset=0, end_lineno=46, end_col_offset=19), FunctionDef(name='normalize_token', args=arguments(args=[arg(arg='value', annotation=Name(id='str', ctx=Load(), lineno=49, col_offset=27, end_lineno=49, end_col_offset=30), lineno=49, col_offset=20, end_lineno=49, end_col_offset=30)]), body=[Expr(value=Constant(value='Return a normalised command token suitable for envelope metadata.\n\n    Parameters\n    ----------\n    value : str\n        Raw command segment obtained from Click/Typer.\n\n    Returns\n    -------\n    str\n        Sanitised token safe for use in filesystem paths and envelope metadata.\n\n    Raises\n    ------\n    ValueError\n        Raised when ``value`` is empty or resolves to a traversal segment.\n    ', lineno=50, col_offset=4, end_lineno=66, end_col_offset=7), lineno=50, col_offset=4, end_lineno=66, end_col_offset=7), Assign(targets=[Name(id='token', ctx=Store(), lineno=67, col_offset=4, end_lineno=67, end_col_offset=9)], value=Call(func=Attribute(value=Name(id='_TOKEN_RE', ctx=Load(), lineno=67, col_offset=12, end_lineno=67, end_col_offset=21), attr='sub', ctx=Load(), lineno=67, col_offset=12, end_lineno=67, end_col_offset=25), args=[Constant(value='', lineno=67, col_offset=26, end_lineno=67, end_col_offset=28), Call(func=Attribute(value=Call(func=Attribute(value=Call(func=Attribute(value=Call(func=Attribute(value=Name(id='value', ctx=Load(), lineno=67, col_offset=30, end_lineno=67, end_col_offset=35), attr='strip', ctx=Load(), lineno=67, col_offset=30, end_lineno=67, end_col_offset=41), lineno=67, col_offset=30, end_lineno=67, end_col_offset=43), attr='lower', ctx=Load(), lineno=67, col_offset=30, end_lineno=67, end_col_offset=49), lineno=67, col_offset=30, end_lineno=67, end_col_offset=51), attr='replace', ctx=Load(), lineno=67, col_offset=30, end_lineno=67, end_col_offset=59), args=[Constant(value=' ', lineno=67, col_offset=60, end_lineno=67, end_col_offset=63), Constant(value='-', lineno=67, col_offset=65, end_lineno=67, end_col_offset=68)], lineno=67, col_offset=30, end_lineno=67, end_col_offset=69), attr='replace', ctx=Load(), lineno=67, col_offset=30, end_lineno=67, end_col_offset=77), args=[Constant(value='.', lineno=67, col_offset=78, end_lineno=67, end_col_offset=81), Constant(value='-', lineno=67, col_offset=83, end_lineno=67, end_col_offset=86)], lineno=67, col_offset=30, end_lineno=67, end_col_offset=87)], lineno=67, col_offset=12, end_lineno=67, end_col_offset=88), lineno=67, col_offset=4, end_lineno=67, end_col_offset=88), If(test=BoolOp(op=Or(), values=[UnaryOp(op=Not(), operand=Name(id='token', ctx=Load(), lineno=68, col_offset=11, end_lineno=68, end_col_offset=16), lineno=68, col_offset=7, end_lineno=68, end_col_offset=16), Compare(left=Name(id='token', ctx=Load(), lineno=68, col_offset=20, end_lineno=68, end_col_offset=25), ops=[In()], comparators=[Set(elts=[Constant(value='.', lineno=68, col_offset=30, end_lineno=68, end_col_offset=33), Constant(value='..', lineno=68, col_offset=35, end_lineno=68, end_col_offset=39)], lineno=68, col_offset=29, end_lineno=68, end_col_offset=40)], lineno=68, col_offset=20, end_lineno=68, end_col_offset=40)], lineno=68, col_offset=7, end_lineno=68, end_col_offset=40), body=[Assign(targets=[Name(id='msg', ctx=Store(), lineno=69, col_offset=8, end_lineno=69, end_col_offset=11)], value=Constant(value='Command tokens must not be empty or represent traversal.', lineno=69, col_offset=14, end_lineno=69, end_col_offset=72), lineno=69, col_offset=8, end_lineno=69, end_col_offset=72), Raise(exc=Call(func=Name(id='ValueError', ctx=Load(), lineno=70, col_offset=14, end_lineno=70, end_col_offset=24), args=[Name(id='msg', ctx=Load(), lineno=70, col_offset=25, end_lineno=70, end_col_offset=28)], lineno=70, col_offset=14, end_lineno=70, end_col_offset=29), lineno=70, col_offset=8, end_lineno=70, end_col_offset=29)], lineno=68, col_offset=4, end_lineno=70, end_col_offset=29), Return(value=Subscript(value=Name(id='token', ctx=Load(), lineno=71, col_offset=11, end_lineno=71, end_col_offset=16), slice=Slice(upper=Name(id='MAX_TOKEN_LENGTH', ctx=Load(), lineno=71, col_offset=18, end_lineno=71, end_col_offset=34), lineno=71, col_offset=17, end_lineno=71, end_col_offset=34), ctx=Load(), lineno=71, col_offset=11, end_lineno=71, end_col_offset=35), lineno=71, col_offset=4, end_lineno=71, end_col_offset=35)], returns=Name(id='str', ctx=Load(), lineno=49, col_offset=35, end_lineno=49, end_col_offset=38), lineno=49, col_offset=0, end_lineno=71, end_col_offset=35), FunctionDef(name='normalize_route', args=arguments(args=[arg(arg='segments', annotation=Subscript(value=Name(id='Sequence', ctx=Load(), lineno=74, col_offset=30, end_lineno=74, end_col_offset=38), slice=Name(id='str', ctx=Load(), lineno=74, col_offset=39, end_lineno=74, end_col_offset=42), ctx=Load(), lineno=74, col_offset=30, end_lineno=74, end_col_offset=43), lineno=74, col_offset=20, end_lineno=74, end_col_offset=43)]), body=[Expr(value=Constant(value='Return the normalised command route derived from ``segments``.\n\n    Parameters\n    ----------\n    segments : Sequence[str]\n        Raw command segments provided by the CLI framework.\n\n    Returns\n    -------\n    list[str]\n        Normalised command route with validated depth and token constraints.\n\n    Raises\n    ------\n    ValueError\n        Raised when the route is empty or exceeds :data:`MAX_ROUTE_DEPTH`.\n    ', lineno=75, col_offset=4, end_lineno=91, end_col_offset=7), lineno=75, col_offset=4, end_lineno=91, end_col_offset=7), Assign(targets=[Name(id='route', ctx=Store(), lineno=92, col_offset=4, end_lineno=92, end_col_offset=9)], value=ListComp(elt=Call(func=Name(id='normalize_token', ctx=Load(), lineno=92, col_offset=13, end_lineno=92, end_col_offset=28), args=[Name(id='segment', ctx=Load(), lineno=92, col_offset=29, end_lineno=92, end_col_offset=36)], lineno=92, col_offset=13, end_lineno=92, end_col_offset=37), generators=[comprehension(target=Name(id='segment', ctx=Store(), lineno=92, col_offset=42, end_lineno=92, end_col_offset=49), iter=Name(id='segments', ctx=Load(), lineno=92, col_offset=53, end_lineno=92, end_col_offset=61), is_async=0)], lineno=92, col_offset=12, end_lineno=92, end_col_offset=62), lineno=92, col_offset=4, end_lineno=92, end_col_offset=62), If(test=UnaryOp(op=Not(), operand=Name(id='route', ctx=Load(), lineno=93, col_offset=11, end_lineno=93, end_col_offset=16), lineno=93, col_offset=7, end_lineno=93, end_col_offset=16), body=[Assign(targets=[Name(id='msg', ctx=Store(), lineno=94, col_offset=8, end_lineno=94, end_col_offset=11)], value=Constant(value='command_path must contain at least one segment.', lineno=94, col_offset=14, end_lineno=94, end_col_offset=63), lineno=94, col_offset=8, end_lineno=94, end_col_offset=63), Raise(exc=Call(func=Name(id='ValueError', ctx=Load(), lineno=95, col_offset=14, end_lineno=95, end_col_offset=24), args=[Name(id='msg', ctx=Load(), lineno=95, col_offset=25, end_lineno=95, end_col_offset=28)], lineno=95, col_offset=14, end_lineno=95, end_col_offset=29), lineno=95, col_offset=8, end_lineno=95, end_col_offset=29)], lineno=93, col_offset=4, end_lineno=95, end_col_offset=29), If(test=Compare(left=Call(func=Name(id='len', ctx=Load(), lineno=96, col_offset=7, end_lineno=96, end_col_offset=10), args=[Name(id='route', ctx=Load(), lineno=96, col_offset=11, end_lineno=96, end_col_offset=16)], lineno=96, col_offset=7, end_lineno=96, end_col_offset=17), ops=[Gt()], comparators=[Name(id='MAX_ROUTE_DEPTH', ctx=Load(), lineno=96, col_offset=20, end_lineno=96, end_col_offset=35)], lineno=96, col_offset=7, end_lineno=96, end_col_offset=35), body=[Assign(targets=[Name(id='msg', ctx=Store(), lineno=97, col_offset=8, end_lineno=97, end_col_offset=11)], value=JoinedStr(values=[Constant(value='command_path too deep (max ', lineno=97, col_offset=16, end_lineno=97, end_col_offset=43), FormattedValue(value=Name(id='MAX_ROUTE_DEPTH', ctx=Load(), lineno=97, col_offset=44, end_lineno=97, end_col_offset=59), conversion=-1, lineno=97, col_offset=43, end_lineno=97, end_col_offset=60), Constant(value=' segments).', lineno=97, col_offset=60, end_lineno=97, end_col_offset=71)], lineno=97, col_offset=14, end_lineno=97, end_col_offset=72), lineno=97, col_offset=8, end_lineno=97, end_col_offset=72), Raise(exc=Call(func=Name(id='ValueError', ctx=Load(), lineno=98, col_offset=14, end_lineno=98, end_col_offset=24), args=[Name(id='msg', ctx=Load(), lineno=98, col_offset=25, end_lineno=98, end_col_offset=28)], lineno=98, col_offset=14, end_lineno=98, end_col_offset=29), lineno=98, col_offset=8, end_lineno=98, end_col_offset=29)], lineno=96, col_offset=4, end_lineno=98, end_col_offset=29), Return(value=Name(id='route', ctx=Load(), lineno=99, col_offset=11, end_lineno=99, end_col_offset=16), lineno=99, col_offset=4, end_lineno=99, end_col_offset=16)], returns=Subscript(value=Name(id='list', ctx=Load(), lineno=74, col_offset=48, end_lineno=74, end_col_offset=52), slice=Name(id='str', ctx=Load(), lineno=74, col_offset=53, end_lineno=74, end_col_offset=56), ctx=Load(), lineno=74, col_offset=48, end_lineno=74, end_col_offset=57), lineno=74, col_offset=0, end_lineno=99, end_col_offset=16), FunctionDef(name='sha256_file', args=arguments(args=[arg(arg='path', annotation=Name(id='Path', ctx=Load(), lineno=102, col_offset=22, end_lineno=102, end_col_offset=26), lineno=102, col_offset=16, end_lineno=102, end_col_offset=26)]), body=[Expr(value=Constant(value='Return the SHA256 digest for ``path``.\n\n    Parameters\n    ----------\n    path : Path\n        Filesystem path to the target artifact.\n\n    Returns\n    -------\n    str\n        Hexadecimal SHA256 digest of the file contents.\n    ', lineno=103, col_offset=4, end_lineno=114, end_col_offset=7), lineno=103, col_offset=4, end_lineno=114, end_col_offset=7), Assign(targets=[Name(id='digest', ctx=Store(), lineno=115, col_offset=4, end_lineno=115, end_col_offset=10)], value=Call(func=Attribute(value=Name(id='hashlib', ctx=Load(), lineno=115, col_offset=13, end_lineno=115, end_col_offset=20), attr='sha256', ctx=Load(), lineno=115, col_offset=13, end_lineno=115, end_col_offset=27), lineno=115, col_offset=13, end_lineno=115, end_col_offset=29), lineno=115, col_offset=4, end_lineno=115, end_col_offset=29), With(items=[withitem(context_expr=Call(func=Attribute(value=Name(id='path', ctx=Load(), lineno=116, col_offset=9, end_lineno=116, end_col_offset=13), attr='open', ctx=Load(), lineno=116, col_offset=9, end_lineno=116, end_col_offset=18), args=[Constant(value='rb', lineno=116, col_offset=19, end_lineno=116, end_col_offset=23)], lineno=116, col_offset=9, end_lineno=116, end_col_offset=24), optional_vars=Name(id='handle', ctx=Store(), lineno=116, col_offset=28, end_lineno=116, end_col_offset=34))], body=[For(target=Name(id='chunk', ctx=Store(), lineno=117, col_offset=12, end_lineno=117, end_col_offset=17), iter=Call(func=Name(id='iter', ctx=Load(), lineno=117, col_offset=21, end_lineno=117, end_col_offset=25), args=[Lambda(args=arguments(), body=Call(func=Attribute(value=Name(id='handle', ctx=Load(), lineno=117, col_offset=34, end_lineno=117, end_col_offset=40), attr='read', ctx=Load(), lineno=117, col_offset=34, end_lineno=117, end_col_offset=45), args=[Name(id='CHUNK_SIZE', ctx=Load(), lineno=117, col_offset=46, end_lineno=117, end_col_offset=56)], lineno=117, col_offset=34, end_lineno=117, end_col_offset=57), lineno=117, col_offset=26, end_lineno=117, end_col_offset=57), Constant(value=b'', lineno=117, col_offset=59, end_lineno=117, end_col_offset=62)], lineno=117, col_offset=21, end_lineno=117, end_col_offset=63), body=[Expr(value=Call(func=Attribute(value=Name(id='digest', ctx=Load(), lineno=118, col_offset=12, end_lineno=118, end_col_offset=18), attr='update', ctx=Load(), lineno=118, col_offset=12, end_lineno=118, end_col_offset=25), args=[Name(id='chunk', ctx=Load(), lineno=118, col_offset=26, end_lineno=118, end_col_offset=31)], lineno=118, col_offset=12, end_lineno=118, end_col_offset=32), lineno=118, col_offset=12, end_lineno=118, end_col_offset=32)], lineno=117, col_offset=8, end_lineno=118, end_col_offset=32)], lineno=116, col_offset=4, end_lineno=118, end_col_offset=32), Return(value=Call(func=Attribute(value=Name(id='digest', ctx=Load(), lineno=119, col_offset=11, end_lineno=119, end_col_offset=17), attr='hexdigest', ctx=Load(), lineno=119, col_offset=11, end_lineno=119, end_col_offset=27), lineno=119, col_offset=11, end_lineno=119, end_col_offset=29), lineno=119, col_offset=4, end_lineno=119, end_col_offset=29)], returns=Name(id='str', ctx=Load(), lineno=102, col_offset=31, end_lineno=102, end_col_offset=34), lineno=102, col_offset=0, end_lineno=119, end_col_offset=29), ClassDef(name='_CliRunConfigParams', bases=[Name(id='TypedDict', ctx=Load(), lineno=122, col_offset=26, end_lineno=122, end_col_offset=35)], keywords=[keyword(arg='total', value=Constant(value=False, lineno=122, col_offset=43, end_lineno=122, end_col_offset=48), lineno=122, col_offset=37, end_lineno=122, end_col_offset=48)], body=[AnnAssign(target=Name(id='envelope_dir', ctx=Store(), lineno=123, col_offset=4, end_lineno=123, end_col_offset=16), annotation=BinOp(left=Name(id='Path', ctx=Load(), lineno=123, col_offset=18, end_lineno=123, end_col_offset=22), op=BitOr(), right=Constant(value=None, lineno=123, col_offset=25, end_lineno=123, end_col_offset=29), lineno=123, col_offset=18, end_lineno=123, end_col_offset=29), simple=1, lineno=123, col_offset=4, end_lineno=123, end_col_offset=29), AnnAssign(target=Name(id='correlation_id', ctx=Store(), lineno=124, col_offset=4, end_lineno=124, end_col_offset=18), annotation=BinOp(left=Name(id='str', ctx=Load(), lineno=124, col_offset=20, end_lineno=124, end_col_offset=23), op=BitOr(), right=Constant(value=None, lineno=124, col_offset=26, end_lineno=124, end_col_offset=30), lineno=124, col_offset=20, end_lineno=124, end_col_offset=30), simple=1, lineno=124, col_offset=4, end_lineno=124, end_col_offset=30), AnnAssign(target=Name(id='write_envelope_on', ctx=Store(), lineno=125, col_offset=4, end_lineno=125, end_col_offset=21), annotation=Subscript(value=Name(id='Literal', ctx=Load(), lineno=125, col_offset=23, end_lineno=125, end_col_offset=30), slice=Tuple(elts=[Constant(value='always', lineno=125, col_offset=31, end_lineno=125, end_col_offset=39), Constant(value='error', lineno=125, col_offset=41, end_lineno=125, end_col_offset=48), Constant(value='success', lineno=125, col_offset=50, end_lineno=125, end_col_offset=59)], ctx=Load(), lineno=125, col_offset=31, end_lineno=125, end_col_offset=59), ctx=Load(), lineno=125, col_offset=23, end_lineno=125, end_col_offset=60), simple=1, lineno=125, col_offset=4, end_lineno=125, end_col_offset=60), AnnAssign(target=Name(id='stdout_format', ctx=Store(), lineno=126, col_offset=4, end_lineno=126, end_col_offset=17), annotation=Subscript(value=Name(id='Literal', ctx=Load(), lineno=126, col_offset=19, end_lineno=126, end_col_offset=26), slice=Tuple(elts=[Constant(value='none', lineno=126, col_offset=27, end_lineno=126, end_col_offset=33), Constant(value='minimal', lineno=126, col_offset=35, end_lineno=126, end_col_offset=44), Constant(value='full', lineno=126, col_offset=46, end_lineno=126, end_col_offset=52)], ctx=Load(), lineno=126, col_offset=27, end_lineno=126, end_col_offset=52), ctx=Load(), lineno=126, col_offset=19, end_lineno=126, end_col_offset=53), simple=1, lineno=126, col_offset=4, end_lineno=126, end_col_offset=53), AnnAssign(target=Name(id='exit_on_error', ctx=Store(), lineno=127, col_offset=4, end_lineno=127, end_col_offset=17), annotation=Name(id='bool', ctx=Load(), lineno=127, col_offset=19, end_lineno=127, end_col_offset=23), simple=1, lineno=127, col_offset=4, end_lineno=127, end_col_offset=23), AnnAssign(target=Name(id='error_code_map', ctx=Store(), lineno=128, col_offset=4, end_lineno=128, end_col_offset=18), annotation=BinOp(left=Subscript(value=Name(id='Mapping', ctx=Load(), lineno=128, col_offset=20, end_lineno=128, end_col_offset=27), slice=Tuple(elts=[Subscript(value=Name(id='type', ctx=Load(), lineno=128, col_offset=28, end_lineno=128, end_col_offset=32), slice=Name(id='BaseException', ctx=Load(), lineno=128, col_offset=33, end_lineno=128, end_col_offset=46), ctx=Load(), lineno=128, col_offset=28, end_lineno=128, end_col_offset=47), Name(id='str', ctx=Load(), lineno=128, col_offset=49, end_lineno=128, end_col_offset=52)], ctx=Load(), lineno=128, col_offset=28, end_lineno=128, end_col_offset=52), ctx=Load(), lineno=128, col_offset=20, end_lineno=128, end_col_offset=53), op=BitOr(), right=Constant(value=None, lineno=128, col_offset=56, end_lineno=128, end_col_offset=60), lineno=128, col_offset=20, end_lineno=128, end_col_offset=60), simple=1, lineno=128, col_offset=4, end_lineno=128, end_col_offset=60), AnnAssign(target=Name(id='extra_context', ctx=Store(), lineno=129, col_offset=4, end_lineno=129, end_col_offset=17), annotation=BinOp(left=Subscript(value=Name(id='Mapping', ctx=Load(), lineno=129, col_offset=19, end_lineno=129, end_col_offset=26), slice=Tuple(elts=[Name(id='str', ctx=Load(), lineno=129, col_offset=27, end_lineno=129, end_col_offset=30), Name(id='object', ctx=Load(), lineno=129, col_offset=32, end_lineno=129, end_col_offset=38)], ctx=Load(), lineno=129, col_offset=27, end_lineno=129, end_col_offset=38), ctx=Load(), lineno=129, col_offset=19, end_lineno=129, end_col_offset=39), op=BitOr(), right=Constant(value=None, lineno=129, col_offset=42, end_lineno=129, end_col_offset=46), lineno=129, col_offset=19, end_lineno=129, end_col_offset=46), simple=1, lineno=129, col_offset=4, end_lineno=129, end_col_offset=46), AnnAssign(target=Name(id='args_summary', ctx=Store(), lineno=130, col_offset=4, end_lineno=130, end_col_offset=16), annotation=BinOp(left=Subscript(value=Name(id='Sequence', ctx=Load(), lineno=130, col_offset=18, end_lineno=130, end_col_offset=26), slice=Name(id='str', ctx=Load(), lineno=130, col_offset=27, end_lineno=130, end_col_offset=30), ctx=Load(), lineno=130, col_offset=18, end_lineno=130, end_col_offset=31), op=BitOr(), right=Constant(value=None, lineno=130, col_offset=34, end_lineno=130, end_col_offset=38), lineno=130, col_offset=18, end_lineno=130, end_col_offset=38), simple=1, lineno=130, col_offset=4, end_lineno=130, end_col_offset=38), AnnAssign(target=Name(id='env_summary', ctx=Store(), lineno=131, col_offset=4, end_lineno=131, end_col_offset=15), annotation=BinOp(left=Subscript(value=Name(id='Mapping', ctx=Load(), lineno=131, col_offset=17, end_lineno=131, end_col_offset=24), slice=Tuple(elts=[Name(id='str', ctx=Load(), lineno=131, col_offset=25, end_lineno=131, end_col_offset=28), Name(id='str', ctx=Load(), lineno=131, col_offset=30, end_lineno=131, end_col_offset=33)], ctx=Load(), lineno=131, col_offset=25, end_lineno=131, end_col_offset=33), ctx=Load(), lineno=131, col_offset=17, end_lineno=131, end_col_offset=34), op=BitOr(), right=Constant(value=None, lineno=131, col_offset=37, end_lineno=131, end_col_offset=41), lineno=131, col_offset=17, end_lineno=131, end_col_offset=41), simple=1, lineno=131, col_offset=4, end_lineno=131, end_col_offset=41)], lineno=122, col_offset=0, end_lineno=131, end_col_offset=41), ClassDef(name='CliRunConfig', body=[Expr(value=Constant(value='Immutable configuration describing a CLI façade invocation.', lineno=136, col_offset=4, end_lineno=136, end_col_offset=70), lineno=136, col_offset=4, end_lineno=136, end_col_offset=70), AnnAssign(target=Name(id='command_path', ctx=Store(), lineno=138, col_offset=4, end_lineno=138, end_col_offset=16), annotation=Subscript(value=Name(id='Sequence', ctx=Load(), lineno=138, col_offset=18, end_lineno=138, end_col_offset=26), slice=Name(id='str', ctx=Load(), lineno=138, col_offset=27, end_lineno=138, end_col_offset=30), ctx=Load(), lineno=138, col_offset=18, end_lineno=138, end_col_offset=31), simple=1, lineno=138, col_offset=4, end_lineno=138, end_col_offset=31), AnnAssign(target=Name(id='envelope_dir', ctx=Store(), lineno=139, col_offset=4, end_lineno=139, end_col_offset=16), annotation=BinOp(left=Name(id='Path', ctx=Load(), lineno=139, col_offset=18, end_lineno=139, end_col_offset=22), op=BitOr(), right=Constant(value=None, lineno=139, col_offset=25, end_lineno=139, end_col_offset=29), lineno=139, col_offset=18, end_lineno=139, end_col_offset=29), value=Constant(value=None, lineno=139, col_offset=32, end_lineno=139, end_col_offset=36), simple=1, lineno=139, col_offset=4, end_lineno=139, end_col_offset=36), AnnAssign(target=Name(id='correlation_id', ctx=Store(), lineno=140, col_offset=4, end_lineno=140, end_col_offset=18), annotation=BinOp(left=Name(id='str', ctx=Load(), lineno=140, col_offset=20, end_lineno=140, end_col_offset=23), op=BitOr(), right=Constant(value=None, lineno=140, col_offset=26, end_lineno=140, end_col_offset=30), lineno=140, col_offset=20, end_lineno=140, end_col_offset=30), value=Constant(value=None, lineno=140, col_offset=33, end_lineno=140, end_col_offset=37), simple=1, lineno=140, col_offset=4, end_lineno=140, end_col_offset=37), AnnAssign(target=Name(id='write_envelope_on', ctx=Store(), lineno=141, col_offset=4, end_lineno=141, end_col_offset=21), annotation=Subscript(value=Name(id='Literal', ctx=Load(), lineno=141, col_offset=23, end_lineno=141, end_col_offset=30), slice=Tuple(elts=[Constant(value='always', lineno=141, col_offset=31, end_lineno=141, end_col_offset=39), Constant(value='error', lineno=141, col_offset=41, end_lineno=141, end_col_offset=48), Constant(value='success', lineno=141, col_offset=50, end_lineno=141, end_col_offset=59)], ctx=Load(), lineno=141, col_offset=31, end_lineno=141, end_col_offset=59), ctx=Load(), lineno=141, col_offset=23, end_lineno=141, end_col_offset=60), value=Constant(value='always', lineno=141, col_offset=63, end_lineno=141, end_col_offset=71), simple=1, lineno=141, col_offset=4, end_lineno=141, end_col_offset=71), AnnAssign(target=Name(id='stdout_format', ctx=Store(), lineno=142, col_offset=4, end_lineno=142, end_col_offset=17), annotation=Subscript(value=Name(id='Literal', ctx=Load(), lineno=142, col_offset=19, end_lineno=142, end_col_offset=26), slice=Tuple(elts=[Constant(value='none', lineno=142, col_offset=27, end_lineno=142, end_col_offset=33), Constant(value='minimal', lineno=142, col_offset=35, end_lineno=142, end_col_offset=44), Constant(value='full', lineno=142, col_offset=46, end_lineno=142, end_col_offset=52)], ctx=Load(), lineno=142, col_offset=27, end_lineno=142, end_col_offset=52), ctx=Load(), lineno=142, col_offset=19, end_lineno=142, end_col_offset=53), value=Constant(value='minimal', lineno=142, col_offset=56, end_lineno=142, end_col_offset=65), simple=1, lineno=142, col_offset=4, end_lineno=142, end_col_offset=65), AnnAssign(target=Name(id='exit_on_error', ctx=Store(), lineno=143, col_offset=4, end_lineno=143, end_col_offset=17), annotation=Name(id='bool', ctx=Load(), lineno=143, col_offset=19, end_lineno=143, end_col_offset=23), value=Constant(value=True, lineno=143, col_offset=26, end_lineno=143, end_col_offset=30), simple=1, lineno=143, col_offset=4, end_lineno=143, end_col_offset=30), AnnAssign(target=Name(id='error_code_map', ctx=Store(), lineno=144, col_offset=4, end_lineno=144, end_col_offset=18), annotation=BinOp(left=Subscript(value=Name(id='Mapping', ctx=Load(), lineno=144, col_offset=20, end_lineno=144, end_col_offset=27), slice=Tuple(elts=[Subscript(value=Name(id='type', ctx=Load(), lineno=144, col_offset=28, end_lineno=144, end_col_offset=32), slice=Name(id='BaseException', ctx=Load(), lineno=144, col_offset=33, end_lineno=144, end_col_offset=46), ctx=Load(), lineno=144, col_offset=28, end_lineno=144, end_col_offset=47), Name(id='str', ctx=Load(), lineno=144, col_offset=49, end_lineno=144, end_col_offset=52)], ctx=Load(), lineno=144, col_offset=28, end_lineno=144, end_col_offset=52), ctx=Load(), lineno=144, col_offset=20, end_lineno=144, end_col_offset=53), op=BitOr(), right=Constant(value=None, lineno=144, col_offset=56, end_lineno=144, end_col_offset=60), lineno=144, col_offset=20, end_lineno=144, end_col_offset=60), value=Constant(value=None, lineno=144, col_offset=63, end_lineno=144, end_col_offset=67), simple=1, lineno=144, col_offset=4, end_lineno=144, end_col_offset=67), AnnAssign(target=Name(id='extra_context', ctx=Store(), lineno=145, col_offset=4, end_lineno=145, end_col_offset=17), annotation=BinOp(left=Subscript(value=Name(id='Mapping', ctx=Load(), lineno=145, col_offset=19, end_lineno=145, end_col_offset=26), slice=Tuple(elts=[Name(id='str', ctx=Load(), lineno=145, col_offset=27, end_lineno=145, end_col_offset=30), Name(id='object', ctx=Load(), lineno=145, col_offset=32, end_lineno=145, end_col_offset=38)], ctx=Load(), lineno=145, col_offset=27, end_lineno=145, end_col_offset=38), ctx=Load(), lineno=145, col_offset=19, end_lineno=145, end_col_offset=39), op=BitOr(), right=Constant(value=None, lineno=145, col_offset=42, end_lineno=145, end_col_offset=46), lineno=145, col_offset=19, end_lineno=145, end_col_offset=46), value=Constant(value=None, lineno=145, col_offset=49, end_lineno=145, end_col_offset=53), simple=1, lineno=145, col_offset=4, end_lineno=145, end_col_offset=53), AnnAssign(target=Name(id='args_summary', ctx=Store(), lineno=146, col_offset=4, end_lineno=146, end_col_offset=16), annotation=BinOp(left=Subscript(value=Name(id='Sequence', ctx=Load(), lineno=146, col_offset=18, end_lineno=146, end_col_offset=26), slice=Name(id='str', ctx=Load(), lineno=146, col_offset=27, end_lineno=146, end_col_offset=30), ctx=Load(), lineno=146, col_offset=18, end_lineno=146, end_col_offset=31), op=BitOr(), right=Constant(value=None, lineno=146, col_offset=34, end_lineno=146, end_col_offset=38), lineno=146, col_offset=18, end_lineno=146, end_col_offset=38), value=Constant(value=None, lineno=146, col_offset=41, end_lineno=146, end_col_offset=45), simple=1, lineno=146, col_offset=4, end_lineno=146, end_col_offset=45), AnnAssign(target=Name(id='env_summary', ctx=Store(), lineno=147, col_offset=4, end_lineno=147, end_col_offset=15), annotation=BinOp(left=Subscript(value=Name(id='Mapping', ctx=Load(), lineno=147, col_offset=17, end_lineno=147, end_col_offset=24), slice=Tuple(elts=[Name(id='str', ctx=Load(), lineno=147, col_offset=25, end_lineno=147, end_col_offset=28), Name(id='str', ctx=Load(), lineno=147, col_offset=30, end_lineno=147, end_col_offset=33)], ctx=Load(), lineno=147, col_offset=25, end_lineno=147, end_col_offset=33), ctx=Load(), lineno=147, col_offset=17, end_lineno=147, end_col_offset=34), op=BitOr(), right=Constant(value=None, lineno=147, col_offset=37, end_lineno=147, end_col_offset=41), lineno=147, col_offset=17, end_lineno=147, end_col_offset=41), value=Constant(value=None, lineno=147, col_offset=44, end_lineno=147, end_col_offset=48), simple=1, lineno=147, col_offset=4, end_lineno=147, end_col_offset=48), FunctionDef(name='from_route', args=arguments(args=[arg(arg='cls', lineno=150, col_offset=19, end_lineno=150, end_col_offset=22)], vararg=arg(arg='segments', annotation=Name(id='str', ctx=Load(), lineno=150, col_offset=35, end_lineno=150, end_col_offset=38), lineno=150, col_offset=25, end_lineno=150, end_col_offset=38), kwarg=arg(arg='kwargs', annotation=Subscript(value=Name(id='Unpack', ctx=Load(), lineno=150, col_offset=50, end_lineno=150, end_col_offset=56), slice=Name(id='_CliRunConfigParams', ctx=Load(), lineno=150, col_offset=57, end_lineno=150, end_col_offset=76), ctx=Load(), lineno=150, col_offset=50, end_lineno=150, end_col_offset=77), lineno=150, col_offset=42, end_lineno=150, end_col_offset=77)), body=[Expr(value=Constant(value='Return a configuration with ``command_path`` normalised from ``segments``.\n\n        Parameters\n        ----------\n        *segments : str\n            Command segments defining the CLI route.\n        **kwargs : Unpack[_CliRunConfigParams]\n            Additional keyword arguments forwarded to :class:`CliRunConfig`.\n\n        Returns\n        -------\n        CliRunConfig\n            Configuration instance with the normalised command path.\n        ', lineno=151, col_offset=8, end_lineno=164, end_col_offset=11), lineno=151, col_offset=8, end_lineno=164, end_col_offset=11), Return(value=Call(func=Name(id='cls', ctx=Load(), lineno=165, col_offset=15, end_lineno=165, end_col_offset=18), keywords=[keyword(arg='command_path', value=Call(func=Name(id='normalize_route', ctx=Load(), lineno=165, col_offset=32, end_lineno=165, end_col_offset=47), args=[Name(id='segments', ctx=Load(), lineno=165, col_offset=48, end_lineno=165, end_col_offset=56)], lineno=165, col_offset=32, end_lineno=165, end_col_offset=57), lineno=165, col_offset=19, end_lineno=165, end_col_offset=57), keyword(value=Name(id='kwargs', ctx=Load(), lineno=165, col_offset=61, end_lineno=165, end_col_offset=67), lineno=165, col_offset=59, end_lineno=165, end_col_offset=67)], lineno=165, col_offset=15, end_lineno=165, end_col_offset=68), lineno=165, col_offset=8, end_lineno=165, end_col_offset=68)], decorator_list=[Name(id='classmethod', ctx=Load(), lineno=149, col_offset=5, end_lineno=149, end_col_offset=16)], returns=Name(id='CliRunConfig', ctx=Load(), lineno=150, col_offset=82, end_lineno=150, end_col_offset=94), lineno=150, col_offset=4, end_lineno=165, end_col_offset=68)], decorator_list=[Call(func=Name(id='dataclass', ctx=Load(), lineno=134, col_offset=1, end_lineno=134, end_col_offset=10), keywords=[keyword(arg='frozen', value=Constant(value=True, lineno=134, col_offset=18, end_lineno=134, end_col_offset=22), lineno=134, col_offset=11, end_lineno=134, end_col_offset=22), keyword(arg='slots', value=Constant(value=True, lineno=134, col_offset=30, end_lineno=134, end_col_offset=34), lineno=134, col_offset=24, end_lineno=134, end_col_offset=34)], lineno=134, col_offset=1, end_lineno=134, end_col_offset=35)], lineno=135, col_offset=0, end_lineno=165, end_col_offset=68), ClassDef(name='CliContext', body=[Expr(value=Constant(value='Runtime metadata supplied to Typer commands executed via :func:`cli_run`.', lineno=170, col_offset=4, end_lineno=170, end_col_offset=83), lineno=170, col_offset=4, end_lineno=170, end_col_offset=83), AnnAssign(target=Name(id='command_path', ctx=Store(), lineno=172, col_offset=4, end_lineno=172, end_col_offset=16), annotation=Subscript(value=Name(id='list', ctx=Load(), lineno=172, col_offset=18, end_lineno=172, end_col_offset=22), slice=Name(id='str', ctx=Load(), lineno=172, col_offset=23, end_lineno=172, end_col_offset=26), ctx=Load(), lineno=172, col_offset=18, end_lineno=172, end_col_offset=27), simple=1, lineno=172, col_offset=4, end_lineno=172, end_col_offset=27), AnnAssign(target=Name(id='operation', ctx=Store(), lineno=173, col_offset=4, end_lineno=173, end_col_offset=13), annotation=Name(id='str', ctx=Load(), lineno=173, col_offset=15, end_lineno=173, end_col_offset=18), simple=1, lineno=173, col_offset=4, end_lineno=173, end_col_offset=18), AnnAssign(target=Name(id='run_id', ctx=Store(), lineno=174, col_offset=4, end_lineno=174, end_col_offset=10), annotation=Name(id='str', ctx=Load(), lineno=174, col_offset=12, end_lineno=174, end_col_offset=15), simple=1, lineno=174, col_offset=4, end_lineno=174, end_col_offset=15), AnnAssign(target=Name(id='correlation_id', ctx=Store(), lineno=175, col_offset=4, end_lineno=175, end_col_offset=18), annotation=Name(id='str', ctx=Load(), lineno=175, col_offset=20, end_lineno=175, end_col_offset=23), simple=1, lineno=175, col_offset=4, end_lineno=175, end_col_offset=23), AnnAssign(target=Name(id='started_monotonic', ctx=Store(), lineno=176, col_offset=4, end_lineno=176, end_col_offset=21), annotation=Name(id='float', ctx=Load(), lineno=176, col_offset=23, end_lineno=176, end_col_offset=28), simple=1, lineno=176, col_offset=4, end_lineno=176, end_col_offset=28), AnnAssign(target=Name(id='logger', ctx=Store(), lineno=177, col_offset=4, end_lineno=177, end_col_offset=10), annotation=Attribute(value=Name(id='logging', ctx=Load(), lineno=177, col_offset=12, end_lineno=177, end_col_offset=19), attr='LoggerAdapter', ctx=Load(), lineno=177, col_offset=12, end_lineno=177, end_col_offset=33), simple=1, lineno=177, col_offset=4, end_lineno=177, end_col_offset=33), AnnAssign(target=Name(id='paths', ctx=Store(), lineno=178, col_offset=4, end_lineno=178, end_col_offset=9), annotation=Name(id='Paths', ctx=Load(), lineno=178, col_offset=11, end_lineno=178, end_col_offset=16), simple=1, lineno=178, col_offset=4, end_lineno=178, end_col_offset=16)], decorator_list=[Call(func=Name(id='dataclass', ctx=Load(), lineno=168, col_offset=1, end_lineno=168, end_col_offset=10), keywords=[keyword(arg='slots', value=Constant(value=True, lineno=168, col_offset=17, end_lineno=168, end_col_offset=21), lineno=168, col_offset=11, end_lineno=168, end_col_offset=21), keyword(arg='frozen', value=Constant(value=True, lineno=168, col_offset=30, end_lineno=168, end_col_offset=34), lineno=168, col_offset=23, end_lineno=168, end_col_offset=34)], lineno=168, col_offset=1, end_lineno=168, end_col_offset=35)], lineno=169, col_offset=0, end_lineno=178, end_col_offset=16), ClassDef(name='_RunSummary', body=[Expr(value=Constant(value='Compact representation of a CLI execution outcome.', lineno=183, col_offset=4, end_lineno=183, end_col_offset=60), lineno=183, col_offset=4, end_lineno=183, end_col_offset=60), AnnAssign(target=Name(id='operation', ctx=Store(), lineno=185, col_offset=4, end_lineno=185, end_col_offset=13), annotation=Name(id='str', ctx=Load(), lineno=185, col_offset=15, end_lineno=185, end_col_offset=18), simple=1, lineno=185, col_offset=4, end_lineno=185, end_col_offset=18), AnnAssign(target=Name(id='run_id', ctx=Store(), lineno=186, col_offset=4, end_lineno=186, end_col_offset=10), annotation=Name(id='str', ctx=Load(), lineno=186, col_offset=12, end_lineno=186, end_col_offset=15), simple=1, lineno=186, col_offset=4, end_lineno=186, end_col_offset=15), AnnAssign(target=Name(id='correlation_id', ctx=Store(), lineno=187, col_offset=4, end_lineno=187, end_col_offset=18), annotation=Name(id='str', ctx=Load(), lineno=187, col_offset=20, end_lineno=187, end_col_offset=23), simple=1, lineno=187, col_offset=4, end_lineno=187, end_col_offset=23), AnnAssign(target=Name(id='duration_s', ctx=Store(), lineno=188, col_offset=4, end_lineno=188, end_col_offset=14), annotation=BinOp(left=Name(id='float', ctx=Load(), lineno=188, col_offset=16, end_lineno=188, end_col_offset=21), op=BitOr(), right=Constant(value=None, lineno=188, col_offset=24, end_lineno=188, end_col_offset=28), lineno=188, col_offset=16, end_lineno=188, end_col_offset=28), simple=1, lineno=188, col_offset=4, end_lineno=188, end_col_offset=28), AnnAssign(target=Name(id='problem', ctx=Store(), lineno=189, col_offset=4, end_lineno=189, end_col_offset=11), annotation=BinOp(left=Name(id='ProblemDetails', ctx=Load(), lineno=189, col_offset=13, end_lineno=189, end_col_offset=27), op=BitOr(), right=Constant(value=None, lineno=189, col_offset=30, end_lineno=189, end_col_offset=34), lineno=189, col_offset=13, end_lineno=189, end_col_offset=34), simple=1, lineno=189, col_offset=4, end_lineno=189, end_col_offset=34)], decorator_list=[Call(func=Name(id='dataclass', ctx=Load(), lineno=181, col_offset=1, end_lineno=181, end_col_offset=10), keywords=[keyword(arg='frozen', value=Constant(value=True, lineno=181, col_offset=18, end_lineno=181, end_col_offset=22), lineno=181, col_offset=11, end_lineno=181, end_col_offset=22), keyword(arg='slots', value=Constant(value=True, lineno=181, col_offset=30, end_lineno=181, end_col_offset=34), lineno=181, col_offset=24, end_lineno=181, end_col_offset=34)], lineno=181, col_offset=1, end_lineno=181, end_col_offset=35)], lineno=182, col_offset=0, end_lineno=189, end_col_offset=34), ClassDef(name='_ExecutionMetadata', body=[Expr(value=Constant(value='Collected metadata derived from the CLI run configuration.', lineno=194, col_offset=4, end_lineno=194, end_col_offset=68), lineno=194, col_offset=4, end_lineno=194, end_col_offset=68), AnnAssign(target=Name(id='route', ctx=Store(), lineno=196, col_offset=4, end_lineno=196, end_col_offset=9), annotation=Subscript(value=Name(id='list', ctx=Load(), lineno=196, col_offset=11, end_lineno=196, end_col_offset=15), slice=Name(id='str', ctx=Load(), lineno=196, col_offset=16, end_lineno=196, end_col_offset=19), ctx=Load(), lineno=196, col_offset=11, end_lineno=196, end_col_offset=20), simple=1, lineno=196, col_offset=4, end_lineno=196, end_col_offset=20), AnnAssign(target=Name(id='operation', ctx=Store(), lineno=197, col_offset=4, end_lineno=197, end_col_offset=13), annotation=Name(id='str', ctx=Load(), lineno=197, col_offset=15, end_lineno=197, end_col_offset=18), simple=1, lineno=197, col_offset=4, end_lineno=197, end_col_offset=18), AnnAssign(target=Name(id='correlation_id', ctx=Store(), lineno=198, col_offset=4, end_lineno=198, end_col_offset=18), annotation=Name(id='str', ctx=Load(), lineno=198, col_offset=20, end_lineno=198, end_col_offset=23), simple=1, lineno=198, col_offset=4, end_lineno=198, end_col_offset=23), AnnAssign(target=Name(id='run_id', ctx=Store(), lineno=199, col_offset=4, end_lineno=199, end_col_offset=10), annotation=Name(id='str', ctx=Load(), lineno=199, col_offset=12, end_lineno=199, end_col_offset=15), simple=1, lineno=199, col_offset=4, end_lineno=199, end_col_offset=15), AnnAssign(target=Name(id='paths', ctx=Store(), lineno=200, col_offset=4, end_lineno=200, end_col_offset=9), annotation=Name(id='Paths', ctx=Load(), lineno=200, col_offset=11, end_lineno=200, end_col_offset=16), simple=1, lineno=200, col_offset=4, end_lineno=200, end_col_offset=16), AnnAssign(target=Name(id='logger', ctx=Store(), lineno=201, col_offset=4, end_lineno=201, end_col_offset=10), annotation=Attribute(value=Name(id='logging', ctx=Load(), lineno=201, col_offset=12, end_lineno=201, end_col_offset=19), attr='LoggerAdapter', ctx=Load(), lineno=201, col_offset=12, end_lineno=201, end_col_offset=33), simple=1, lineno=201, col_offset=4, end_lineno=201, end_col_offset=33)], decorator_list=[Call(func=Name(id='dataclass', ctx=Load(), lineno=192, col_offset=1, end_lineno=192, end_col_offset=10), keywords=[keyword(arg='slots', value=Constant(value=True, lineno=192, col_offset=17, end_lineno=192, end_col_offset=21), lineno=192, col_offset=11, end_lineno=192, end_col_offset=21), keyword(arg='frozen', value=Constant(value=True, lineno=192, col_offset=30, end_lineno=192, end_col_offset=34), lineno=192, col_offset=23, end_lineno=192, end_col_offset=34)], lineno=192, col_offset=1, end_lineno=192, end_col_offset=35)], lineno=193, col_offset=0, end_lineno=201, end_col_offset=33), ClassDef(name='EnvelopeBuilder', body=[Expr(value=Constant(value='Utility for constructing CLI envelope payloads.', lineno=205, col_offset=4, end_lineno=205, end_col_offset=57), lineno=205, col_offset=4, end_lineno=205, end_col_offset=57), FunctionDef(name='__init__', args=arguments(args=[arg(arg='self', lineno=208, col_offset=8, end_lineno=208, end_col_offset=12)], kwonlyargs=[arg(arg='command_path', annotation=Subscript(value=Name(id='list', ctx=Load(), lineno=210, col_offset=22, end_lineno=210, end_col_offset=26), slice=Name(id='str', ctx=Load(), lineno=210, col_offset=27, end_lineno=210, end_col_offset=30), ctx=Load(), lineno=210, col_offset=22, end_lineno=210, end_col_offset=31), lineno=210, col_offset=8, end_lineno=210, end_col_offset=31), arg(arg='operation', annotation=Name(id='str', ctx=Load(), lineno=211, col_offset=19, end_lineno=211, end_col_offset=22), lineno=211, col_offset=8, end_lineno=211, end_col_offset=22), arg(arg='run_id', annotation=Name(id='str', ctx=Load(), lineno=212, col_offset=16, end_lineno=212, end_col_offset=19), lineno=212, col_offset=8, end_lineno=212, end_col_offset=19), arg(arg='correlation_id', annotation=Name(id='str', ctx=Load(), lineno=213, col_offset=24, end_lineno=213, end_col_offset=27), lineno=213, col_offset=8, end_lineno=213, end_col_offset=27)], kw_defaults=[None, None, None, None]), body=[Assign(targets=[Name(id='started_at', ctx=Store(), lineno=215, col_offset=8, end_lineno=215, end_col_offset=18)], value=Call(func=Attribute(value=Call(func=Attribute(value=Call(func=Attribute(value=Name(id='datetime', ctx=Load(), lineno=215, col_offset=21, end_lineno=215, end_col_offset=29), attr='now', ctx=Load(), lineno=215, col_offset=21, end_lineno=215, end_col_offset=33), args=[Name(id='UTC', ctx=Load(), lineno=215, col_offset=34, end_lineno=215, end_col_offset=37)], lineno=215, col_offset=21, end_lineno=215, end_col_offset=38), attr='isoformat', ctx=Load(), lineno=215, col_offset=21, end_lineno=215, end_col_offset=48), keywords=[keyword(arg='timespec', value=Constant(value='seconds', lineno=215, col_offset=58, end_lineno=215, end_col_offset=67), lineno=215, col_offset=49, end_lineno=215, end_col_offset=67)], lineno=215, col_offset=21, end_lineno=215, end_col_offset=68), attr='replace', ctx=Load(), lineno=215, col_offset=21, end_lineno=215, end_col_offset=76), args=[Constant(value='+00:00', lineno=215, col_offset=77, end_lineno=215, end_col_offset=85), Constant(value='Z', lineno=215, col_offset=87, end_lineno=215, end_col_offset=90)], lineno=215, col_offset=21, end_lineno=215, end_col_offset=91), lineno=215, col_offset=8, end_lineno=215, end_col_offset=91), Assign(targets=[Name(id='command', ctx=Store(), lineno=216, col_offset=8, end_lineno=216, end_col_offset=15)], value=IfExp(test=Name(id='command_path', ctx=Load(), lineno=216, col_offset=37, end_lineno=216, end_col_offset=49), body=Subscript(value=Name(id='command_path', ctx=Load(), lineno=216, col_offset=18, end_lineno=216, end_col_offset=30), slice=Constant(value=0, lineno=216, col_offset=31, end_lineno=216, end_col_offset=32), ctx=Load(), lineno=216, col_offset=18, end_lineno=216, end_col_offset=33), orelse=Constant(value=None, lineno=216, col_offset=55, end_lineno=216, end_col_offset=59), lineno=216, col_offset=18, end_lineno=216, end_col_offset=59), lineno=216, col_offset=8, end_lineno=216, end_col_offset=59), Assign(targets=[Name(id='subcommand', ctx=Store(), lineno=217, col_offset=8, end_lineno=217, end_col_offset=18)], value=IfExp(test=Compare(left=Call(func=Name(id='len', ctx=Load(), lineno=217, col_offset=40, end_lineno=217, end_col_offset=43), args=[Name(id='command_path', ctx=Load(), lineno=217, col_offset=44, end_lineno=217, end_col_offset=56)], lineno=217, col_offset=40, end_lineno=217, end_col_offset=57), ops=[Gt()], comparators=[Constant(value=1, lineno=217, col_offset=60, end_lineno=217, end_col_offset=61)], lineno=217, col_offset=40, end_lineno=217, end_col_offset=61), body=Subscript(value=Name(id='command_path', ctx=Load(), lineno=217, col_offset=21, end_lineno=217, end_col_offset=33), slice=Constant(value=1, lineno=217, col_offset=34, end_lineno=217, end_col_offset=35), ctx=Load(), lineno=217, col_offset=21, end_lineno=217, end_col_offset=36), orelse=Constant(value=None, lineno=217, col_offset=67, end_lineno=217, end_col_offset=71), lineno=217, col_offset=21, end_lineno=217, end_col_offset=71), lineno=217, col_offset=8, end_lineno=217, end_col_offset=71), AnnAssign(target=Attribute(value=Name(id='self', ctx=Load(), lineno=218, col_offset=8, end_lineno=218, end_col_offset=12), attr='_envelope', ctx=Store(), lineno=218, col_offset=8, end_lineno=218, end_col_offset=22), annotation=Subscript(value=Name(id='dict', ctx=Load(), lineno=218, col_offset=24, end_lineno=218, end_col_offset=28), slice=Tuple(elts=[Name(id='str', ctx=Load(), lineno=218, col_offset=29, end_lineno=218, end_col_offset=32), Name(id='object', ctx=Load(), lineno=218, col_offset=34, end_lineno=218, end_col_offset=40)], ctx=Load(), lineno=218, col_offset=29, end_lineno=218, end_col_offset=40), ctx=Load(), lineno=218, col_offset=24, end_lineno=218, end_col_offset=41), value=Dict(keys=[Constant(value='version', lineno=219, col_offset=12, end_lineno=219, end_col_offset=21), Constant(value='command_path', lineno=220, col_offset=12, end_lineno=220, end_col_offset=26), Constant(value='operation', lineno=221, col_offset=12, end_lineno=221, end_col_offset=23), Constant(value='command', lineno=222, col_offset=12, end_lineno=222, end_col_offset=21), Constant(value='subcommand', lineno=223, col_offset=12, end_lineno=223, end_col_offset=24), Constant(value='run_id', lineno=224, col_offset=12, end_lineno=224, end_col_offset=20), Constant(value='correlation_id', lineno=225, col_offset=12, end_lineno=225, end_col_offset=28), Constant(value='started_at', lineno=226, col_offset=12, end_lineno=226, end_col_offset=24), Constant(value='status', lineno=227, col_offset=12, end_lineno=227, end_col_offset=20), Constant(value='args', lineno=228, col_offset=12, end_lineno=228, end_col_offset=18), Constant(value='env', lineno=229, col_offset=12, end_lineno=229, end_col_offset=17), Constant(value='artifacts', lineno=230, col_offset=12, end_lineno=230, end_col_offset=23)], values=[Name(id='CLI_ENVELOPE_VERSION', ctx=Load(), lineno=219, col_offset=23, end_lineno=219, end_col_offset=43), Name(id='command_path', ctx=Load(), lineno=220, col_offset=28, end_lineno=220, end_col_offset=40), Name(id='operation', ctx=Load(), lineno=221, col_offset=25, end_lineno=221, end_col_offset=34), Name(id='command', ctx=Load(), lineno=222, col_offset=23, end_lineno=222, end_col_offset=30), Name(id='subcommand', ctx=Load(), lineno=223, col_offset=26, end_lineno=223, end_col_offset=36), Name(id='run_id', ctx=Load(), lineno=224, col_offset=22, end_lineno=224, end_col_offset=28), Name(id='correlation_id', ctx=Load(), lineno=225, col_offset=30, end_lineno=225, end_col_offset=44), Name(id='started_at', ctx=Load(), lineno=226, col_offset=26, end_lineno=226, end_col_offset=36), Attribute(value=Attribute(value=Name(id='CliRunStatus', ctx=Load(), lineno=227, col_offset=22, end_lineno=227, end_col_offset=34), attr='SUCCESS', ctx=Load(), lineno=227, col_offset=22, end_lineno=227, end_col_offset=42), attr='value', ctx=Load(), lineno=227, col_offset=22, end_lineno=227, end_col_offset=48), List(ctx=Load(), lineno=228, col_offset=20, end_lineno=228, end_col_offset=22), Dict(lineno=229, col_offset=19, end_lineno=229, end_col_offset=21), List(ctx=Load(), lineno=230, col_offset=25, end_lineno=230, end_col_offset=27)], lineno=218, col_offset=44, end_lineno=231, end_col_offset=9), simple=0, lineno=218, col_offset=8, end_lineno=231, end_col_offset=9)], returns=Constant(value=None, lineno=214, col_offset=9, end_lineno=214, end_col_offset=13), lineno=207, col_offset=4, end_lineno=231, end_col_offset=9), FunctionDef(name='set_args', args=arguments(args=[arg(arg='self', lineno=233, col_offset=17, end_lineno=233, end_col_offset=21), arg(arg='argv', annotation=Subscript(value=Name(id='Sequence', ctx=Load(), lineno=233, col_offset=29, end_lineno=233, end_col_offset=37), slice=Name(id='str', ctx=Load(), lineno=233, col_offset=38, end_lineno=233, end_col_offset=41), ctx=Load(), lineno=233, col_offset=29, end_lineno=233, end_col_offset=42), lineno=233, col_offset=23, end_lineno=233, end_col_offset=42)]), body=[Expr(value=Constant(value='Record the CLI arguments associated with the run.\n\n        Parameters\n        ----------\n        argv : Sequence[str]\n            Iterable of CLI arguments passed to the command.\n\n        ', lineno=234, col_offset=8, end_lineno=241, end_col_offset=11), lineno=234, col_offset=8, end_lineno=241, end_col_offset=11), Assign(targets=[Subscript(value=Attribute(value=Name(id='self', ctx=Load(), lineno=242, col_offset=8, end_lineno=242, end_col_offset=12), attr='_envelope', ctx=Load(), lineno=242, col_offset=8, end_lineno=242, end_col_offset=22), slice=Constant(value='args', lineno=242, col_offset=23, end_lineno=242, end_col_offset=29), ctx=Store(), lineno=242, col_offset=8, end_lineno=242, end_col_offset=30)], value=ListComp(elt=Call(func=Name(id='str', ctx=Load(), lineno=242, col_offset=34, end_lineno=242, end_col_offset=37), args=[Name(id='value', ctx=Load(), lineno=242, col_offset=38, end_lineno=242, end_col_offset=43)], lineno=242, col_offset=34, end_lineno=242, end_col_offset=44), generators=[comprehension(target=Name(id='value', ctx=Store(), lineno=242, col_offset=49, end_lineno=242, end_col_offset=54), iter=Name(id='argv', ctx=Load(), lineno=242, col_offset=58, end_lineno=242, end_col_offset=62), is_async=0)], lineno=242, col_offset=33, end_lineno=242, end_col_offset=63), lineno=242, col_offset=8, end_lineno=242, end_col_offset=63)], returns=Constant(value=None, lineno=233, col_offset=47, end_lineno=233, end_col_offset=51), lineno=233, col_offset=4, end_lineno=242, end_col_offset=63), FunctionDef(name='set_env', args=arguments(args=[arg(arg='self', lineno=244, col_offset=16, end_lineno=244, end_col_offset=20), arg(arg='env', annotation=Subscript(value=Name(id='Mapping', ctx=Load(), lineno=244, col_offset=27, end_lineno=244, end_col_offset=34), slice=Tuple(elts=[Name(id='str', ctx=Load(), lineno=244, col_offset=35, end_lineno=244, end_col_offset=38), Name(id='str', ctx=Load(), lineno=244, col_offset=40, end_lineno=244, end_col_offset=43)], ctx=Load(), lineno=244, col_offset=35, end_lineno=244, end_col_offset=43), ctx=Load(), lineno=244, col_offset=27, end_lineno=244, end_col_offset=44), lineno=244, col_offset=22, end_lineno=244, end_col_offset=44)]), body=[Expr(value=Constant(value='Record redacted environment variables for diagnostics.\n\n        Parameters\n        ----------\n        env : Mapping[str, str]\n            Mapping of environment variables selected for inclusion.\n\n        ', lineno=245, col_offset=8, end_lineno=252, end_col_offset=11), lineno=245, col_offset=8, end_lineno=252, end_col_offset=11), Assign(targets=[Subscript(value=Attribute(value=Name(id='self', ctx=Load(), lineno=253, col_offset=8, end_lineno=253, end_col_offset=12), attr='_envelope', ctx=Load(), lineno=253, col_offset=8, end_lineno=253, end_col_offset=22), slice=Constant(value='env', lineno=253, col_offset=23, end_lineno=253, end_col_offset=28), ctx=Store(), lineno=253, col_offset=8, end_lineno=253, end_col_offset=29)], value=Call(func=Name(id='dict', ctx=Load(), lineno=253, col_offset=32, end_lineno=253, end_col_offset=36), args=[Name(id='env', ctx=Load(), lineno=253, col_offset=37, end_lineno=253, end_col_offset=40)], lineno=253, col_offset=32, end_lineno=253, end_col_offset=41), lineno=253, col_offset=8, end_lineno=253, end_col_offset=41)], returns=Constant(value=None, lineno=244, col_offset=49, end_lineno=244, end_col_offset=53), lineno=244, col_offset=4, end_lineno=253, end_col_offset=41), FunctionDef(name='add_artifact', args=arguments(args=[arg(arg='self', lineno=255, col_offset=21, end_lineno=255, end_col_offset=25)], kwonlyargs=[arg(arg='kind', annotation=Name(id='str', ctx=Load(), lineno=255, col_offset=36, end_lineno=255, end_col_offset=39), lineno=255, col_offset=30, end_lineno=255, end_col_offset=39), arg(arg='path', annotation=Name(id='Path', ctx=Load(), lineno=255, col_offset=47, end_lineno=255, end_col_offset=51), lineno=255, col_offset=41, end_lineno=255, end_col_offset=51), arg(arg='digest', annotation=BinOp(left=Name(id='str', ctx=Load(), lineno=255, col_offset=61, end_lineno=255, end_col_offset=64), op=BitOr(), right=Constant(value=None, lineno=255, col_offset=67, end_lineno=255, end_col_offset=71), lineno=255, col_offset=61, end_lineno=255, end_col_offset=71), lineno=255, col_offset=53, end_lineno=255, end_col_offset=71)], kw_defaults=[None, None, Constant(value=None, lineno=255, col_offset=74, end_lineno=255, end_col_offset=78)]), body=[Expr(value=Constant(value='Append an artifact entry to the envelope.\n\n        Parameters\n        ----------\n        kind : str\n            Logical artifact type (for example ``"file"`` or ``"log"``).\n        path : Path\n            Filesystem path to the artifact.\n        digest : str | None, optional\n            Optional SHA256 digest associated with ``path``.\n\n        Raises\n        ------\n        TypeError\n            Raised when the underlying envelope stores artifacts in an\n            unexpected structure.\n        ', lineno=256, col_offset=8, end_lineno=272, end_col_offset=11), lineno=256, col_offset=8, end_lineno=272, end_col_offset=11), AnnAssign(target=Name(id='artifact', ctx=Store(), lineno=273, col_offset=8, end_lineno=273, end_col_offset=16), annotation=Subscript(value=Name(id='dict', ctx=Load(), lineno=273, col_offset=18, end_lineno=273, end_col_offset=22), slice=Tuple(elts=[Name(id='str', ctx=Load(), lineno=273, col_offset=23, end_lineno=273, end_col_offset=26), Name(id='object', ctx=Load(), lineno=273, col_offset=28, end_lineno=273, end_col_offset=34)], ctx=Load(), lineno=273, col_offset=23, end_lineno=273, end_col_offset=34), ctx=Load(), lineno=273, col_offset=18, end_lineno=273, end_col_offset=35), value=Dict(keys=[Constant(value='kind', lineno=273, col_offset=39, end_lineno=273, end_col_offset=45), Constant(value='path', lineno=273, col_offset=53, end_lineno=273, end_col_offset=59)], values=[Name(id='kind', ctx=Load(), lineno=273, col_offset=47, end_lineno=273, end_col_offset=51), Call(func=Name(id='str', ctx=Load(), lineno=273, col_offset=61, end_lineno=273, end_col_offset=64), args=[Name(id='path', ctx=Load(), lineno=273, col_offset=65, end_lineno=273, end_col_offset=69)], lineno=273, col_offset=61, end_lineno=273, end_col_offset=70)], lineno=273, col_offset=38, end_lineno=273, end_col_offset=71), simple=1, lineno=273, col_offset=8, end_lineno=273, end_col_offset=71), If(test=Compare(left=Name(id='digest', ctx=Load(), lineno=274, col_offset=11, end_lineno=274, end_col_offset=17), ops=[IsNot()], comparators=[Constant(value=None, lineno=274, col_offset=25, end_lineno=274, end_col_offset=29)], lineno=274, col_offset=11, end_lineno=274, end_col_offset=29), body=[Assign(targets=[Subscript(value=Name(id='artifact', ctx=Load(), lineno=275, col_offset=12, end_lineno=275, end_col_offset=20), slice=Constant(value='sha256', lineno=275, col_offset=21, end_lineno=275, end_col_offset=29), ctx=Store(), lineno=275, col_offset=12, end_lineno=275, end_col_offset=30)], value=Name(id='digest', ctx=Load(), lineno=275, col_offset=33, end_lineno=275, end_col_offset=39), lineno=275, col_offset=12, end_lineno=275, end_col_offset=39)], lineno=274, col_offset=8, end_lineno=275, end_col_offset=39), Assign(targets=[Name(id='artifacts', ctx=Store(), lineno=276, col_offset=8, end_lineno=276, end_col_offset=17)], value=Call(func=Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=276, col_offset=20, end_lineno=276, end_col_offset=24), attr='_envelope', ctx=Load(), lineno=276, col_offset=20, end_lineno=276, end_col_offset=34), attr='get', ctx=Load(), lineno=276, col_offset=20, end_lineno=276, end_col_offset=38), args=[Constant(value='artifacts', lineno=276, col_offset=39, end_lineno=276, end_col_offset=50)], lineno=276, col_offset=20, end_lineno=276, end_col_offset=51), lineno=276, col_offset=8, end_lineno=276, end_col_offset=51), If(test=UnaryOp(op=Not(), operand=Call(func=Name(id='isinstance', ctx=Load(), lineno=277, col_offset=15, end_lineno=277, end_col_offset=25), args=[Name(id='artifacts', ctx=Load(), lineno=277, col_offset=26, end_lineno=277, end_col_offset=35), Name(id='list', ctx=Load(), lineno=277, col_offset=37, end_lineno=277, end_col_offset=41)], lineno=277, col_offset=15, end_lineno=277, end_col_offset=42), lineno=277, col_offset=11, end_lineno=277, end_col_offset=42), body=[Assign(targets=[Name(id='msg', ctx=Store(), lineno=278, col_offset=12, end_lineno=278, end_col_offset=15)], value=Constant(value='Envelope artifacts collection must be a list.', lineno=278, col_offset=18, end_lineno=278, end_col_offset=65), lineno=278, col_offset=12, end_lineno=278, end_col_offset=65), Raise(exc=Call(func=Name(id='TypeError', ctx=Load(), lineno=279, col_offset=18, end_lineno=279, end_col_offset=27), args=[Name(id='msg', ctx=Load(), lineno=279, col_offset=28, end_lineno=279, end_col_offset=31)], lineno=279, col_offset=18, end_lineno=279, end_col_offset=32), lineno=279, col_offset=12, end_lineno=279, end_col_offset=32)], lineno=277, col_offset=8, end_lineno=279, end_col_offset=32), Expr(value=Call(func=Attribute(value=Name(id='artifacts', ctx=Load(), lineno=280, col_offset=8, end_lineno=280, end_col_offset=17), attr='append', ctx=Load(), lineno=280, col_offset=8, end_lineno=280, end_col_offset=24), args=[Name(id='artifact', ctx=Load(), lineno=280, col_offset=25, end_lineno=280, end_col_offset=33)], lineno=280, col_offset=8, end_lineno=280, end_col_offset=34), lineno=280, col_offset=8, end_lineno=280, end_col_offset=34)], returns=Constant(value=None, lineno=255, col_offset=83, end_lineno=255, end_col_offset=87), lineno=255, col_offset=4, end_lineno=280, end_col_offset=34), FunctionDef(name='set_result', args=arguments(args=[arg(arg='self', lineno=282, col_offset=19, end_lineno=282, end_col_offset=23)], kwonlyargs=[arg(arg='summary', annotation=Name(id='str', ctx=Load(), lineno=282, col_offset=37, end_lineno=282, end_col_offset=40), lineno=282, col_offset=28, end_lineno=282, end_col_offset=40), arg(arg='payload', annotation=BinOp(left=Name(id='object', ctx=Load(), lineno=282, col_offset=51, end_lineno=282, end_col_offset=57), op=BitOr(), right=Constant(value=None, lineno=282, col_offset=60, end_lineno=282, end_col_offset=64), lineno=282, col_offset=51, end_lineno=282, end_col_offset=64), lineno=282, col_offset=42, end_lineno=282, end_col_offset=64)], kw_defaults=[None, Constant(value=None, lineno=282, col_offset=67, end_lineno=282, end_col_offset=71)]), body=[Expr(value=Constant(value='Record the CLI result summary and optional payload.\n\n        Parameters\n        ----------\n        summary : str\n            Human-readable summary describing the CLI result.\n        payload : object | None, optional\n            Optional structured payload providing additional metadata.\n\n        ', lineno=283, col_offset=8, end_lineno=292, end_col_offset=11), lineno=283, col_offset=8, end_lineno=292, end_col_offset=11), AnnAssign(target=Name(id='result', ctx=Store(), lineno=293, col_offset=8, end_lineno=293, end_col_offset=14), annotation=Subscript(value=Name(id='dict', ctx=Load(), lineno=293, col_offset=16, end_lineno=293, end_col_offset=20), slice=Tuple(elts=[Name(id='str', ctx=Load(), lineno=293, col_offset=21, end_lineno=293, end_col_offset=24), Name(id='object', ctx=Load(), lineno=293, col_offset=26, end_lineno=293, end_col_offset=32)], ctx=Load(), lineno=293, col_offset=21, end_lineno=293, end_col_offset=32), ctx=Load(), lineno=293, col_offset=16, end_lineno=293, end_col_offset=33), value=Dict(keys=[Constant(value='summary', lineno=293, col_offset=37, end_lineno=293, end_col_offset=46)], values=[Name(id='summary', ctx=Load(), lineno=293, col_offset=48, end_lineno=293, end_col_offset=55)], lineno=293, col_offset=36, end_lineno=293, end_col_offset=56), simple=1, lineno=293, col_offset=8, end_lineno=293, end_col_offset=56), If(test=Compare(left=Name(id='payload', ctx=Load(), lineno=294, col_offset=11, end_lineno=294, end_col_offset=18), ops=[IsNot()], comparators=[Constant(value=None, lineno=294, col_offset=26, end_lineno=294, end_col_offset=30)], lineno=294, col_offset=11, end_lineno=294, end_col_offset=30), body=[Assign(targets=[Subscript(value=Name(id='result', ctx=Load(), lineno=295, col_offset=12, end_lineno=295, end_col_offset=18), slice=Constant(value='payload', lineno=295, col_offset=19, end_lineno=295, end_col_offset=28), ctx=Store(), lineno=295, col_offset=12, end_lineno=295, end_col_offset=29)], value=Name(id='payload', ctx=Load(), lineno=295, col_offset=32, end_lineno=295, end_col_offset=39), lineno=295, col_offset=12, end_lineno=295, end_col_offset=39)], lineno=294, col_offset=8, end_lineno=295, end_col_offset=39), Assign(targets=[Subscript(value=Attribute(value=Name(id='self', ctx=Load(), lineno=296, col_offset=8, end_lineno=296, end_col_offset=12), attr='_envelope', ctx=Load(), lineno=296, col_offset=8, end_lineno=296, end_col_offset=22), slice=Constant(value='result', lineno=296, col_offset=23, end_lineno=296, end_col_offset=31), ctx=Store(), lineno=296, col_offset=8, end_lineno=296, end_col_offset=32)], value=Name(id='result', ctx=Load(), lineno=296, col_offset=35, end_lineno=296, end_col_offset=41), lineno=296, col_offset=8, end_lineno=296, end_col_offset=41)], returns=Constant(value=None, lineno=282, col_offset=76, end_lineno=282, end_col_offset=80), lineno=282, col_offset=4, end_lineno=296, end_col_offset=41), FunctionDef(name='set_problem', args=arguments(args=[arg(arg='self', lineno=298, col_offset=20, end_lineno=298, end_col_offset=24), arg(arg='problem', annotation=Name(id='ProblemDetails', ctx=Load(), lineno=298, col_offset=35, end_lineno=298, end_col_offset=49), lineno=298, col_offset=26, end_lineno=298, end_col_offset=49)]), body=[Expr(value=Constant(value='Record a Problem Details payload describing the failure.\n\n        Parameters\n        ----------\n        problem : ProblemDetails\n            Problem description generated from the captured exception.\n\n        ', lineno=299, col_offset=8, end_lineno=306, end_col_offset=11), lineno=299, col_offset=8, end_lineno=306, end_col_offset=11), Assign(targets=[Subscript(value=Attribute(value=Name(id='self', ctx=Load(), lineno=307, col_offset=8, end_lineno=307, end_col_offset=12), attr='_envelope', ctx=Load(), lineno=307, col_offset=8, end_lineno=307, end_col_offset=22), slice=Constant(value='status', lineno=307, col_offset=23, end_lineno=307, end_col_offset=31), ctx=Store(), lineno=307, col_offset=8, end_lineno=307, end_col_offset=32)], value=Attribute(value=Attribute(value=Name(id='CliRunStatus', ctx=Load(), lineno=307, col_offset=35, end_lineno=307, end_col_offset=47), attr='ERROR', ctx=Load(), lineno=307, col_offset=35, end_lineno=307, end_col_offset=53), attr='value', ctx=Load(), lineno=307, col_offset=35, end_lineno=307, end_col_offset=59), lineno=307, col_offset=8, end_lineno=307, end_col_offset=59), Assign(targets=[Name(id='problem_dict', ctx=Store(), lineno=308, col_offset=8, end_lineno=308, end_col_offset=20)], value=DictComp(key=Name(id='key', ctx=Load(), lineno=308, col_offset=24, end_lineno=308, end_col_offset=27), value=Name(id='value', ctx=Load(), lineno=308, col_offset=29, end_lineno=308, end_col_offset=34), generators=[comprehension(target=Tuple(elts=[Name(id='key', ctx=Store(), lineno=308, col_offset=39, end_lineno=308, end_col_offset=42), Name(id='value', ctx=Store(), lineno=308, col_offset=44, end_lineno=308, end_col_offset=49)], ctx=Store(), lineno=308, col_offset=39, end_lineno=308, end_col_offset=49), iter=Call(func=Attribute(value=Call(func=Name(id='asdict', ctx=Load(), lineno=308, col_offset=53, end_lineno=308, end_col_offset=59), args=[Name(id='problem', ctx=Load(), lineno=308, col_offset=60, end_lineno=308, end_col_offset=67)], lineno=308, col_offset=53, end_lineno=308, end_col_offset=68), attr='items', ctx=Load(), lineno=308, col_offset=53, end_lineno=308, end_col_offset=74), lineno=308, col_offset=53, end_lineno=308, end_col_offset=76), ifs=[Compare(left=Name(id='value', ctx=Load(), lineno=308, col_offset=80, end_lineno=308, end_col_offset=85), ops=[IsNot()], comparators=[Constant(value=None, lineno=308, col_offset=93, end_lineno=308, end_col_offset=97)], lineno=308, col_offset=80, end_lineno=308, end_col_offset=97)], is_async=0)], lineno=308, col_offset=23, end_lineno=308, end_col_offset=98), lineno=308, col_offset=8, end_lineno=308, end_col_offset=98), Assign(targets=[Subscript(value=Attribute(value=Name(id='self', ctx=Load(), lineno=309, col_offset=8, end_lineno=309, end_col_offset=12), attr='_envelope', ctx=Load(), lineno=309, col_offset=8, end_lineno=309, end_col_offset=22), slice=Constant(value='problem', lineno=309, col_offset=23, end_lineno=309, end_col_offset=32), ctx=Store(), lineno=309, col_offset=8, end_lineno=309, end_col_offset=33)], value=Name(id='problem_dict', ctx=Load(), lineno=309, col_offset=36, end_lineno=309, end_col_offset=48), lineno=309, col_offset=8, end_lineno=309, end_col_offset=48)], returns=Constant(value=None, lineno=298, col_offset=54, end_lineno=298, end_col_offset=58), lineno=298, col_offset=4, end_lineno=309, end_col_offset=48), FunctionDef(name='finalize', args=arguments(args=[arg(arg='self', lineno=311, col_offset=17, end_lineno=311, end_col_offset=21)], kwonlyargs=[arg(arg='finished_at', annotation=BinOp(left=Name(id='datetime', ctx=Load(), lineno=311, col_offset=39, end_lineno=311, end_col_offset=47), op=BitOr(), right=Constant(value=None, lineno=311, col_offset=50, end_lineno=311, end_col_offset=54), lineno=311, col_offset=39, end_lineno=311, end_col_offset=54), lineno=311, col_offset=26, end_lineno=311, end_col_offset=54)], kw_defaults=[Constant(value=None, lineno=311, col_offset=57, end_lineno=311, end_col_offset=61)]), body=[Expr(value=Constant(value='Return the fully constructed envelope.\n\n        Parameters\n        ----------\n        finished_at : datetime | None, optional\n            Explicit completion timestamp. Defaults to ``datetime.now(UTC)``.\n\n        Returns\n        -------\n        dict[str, object]\n            Fully populated envelope dictionary ready for persistence.\n        ', lineno=312, col_offset=8, end_lineno=323, end_col_offset=11), lineno=312, col_offset=8, end_lineno=323, end_col_offset=11), Assign(targets=[Name(id='completed_at', ctx=Store(), lineno=324, col_offset=8, end_lineno=324, end_col_offset=20)], value=BoolOp(op=Or(), values=[Name(id='finished_at', ctx=Load(), lineno=324, col_offset=23, end_lineno=324, end_col_offset=34), Call(func=Attribute(value=Name(id='datetime', ctx=Load(), lineno=324, col_offset=38, end_lineno=324, end_col_offset=46), attr='now', ctx=Load(), lineno=324, col_offset=38, end_lineno=324, end_col_offset=50), args=[Name(id='UTC', ctx=Load(), lineno=324, col_offset=51, end_lineno=324, end_col_offset=54)], lineno=324, col_offset=38, end_lineno=324, end_col_offset=55)], lineno=324, col_offset=23, end_lineno=324, end_col_offset=55), lineno=324, col_offset=8, end_lineno=324, end_col_offset=55), Assign(targets=[Subscript(value=Attribute(value=Name(id='self', ctx=Load(), lineno=325, col_offset=8, end_lineno=325, end_col_offset=12), attr='_envelope', ctx=Load(), lineno=325, col_offset=8, end_lineno=325, end_col_offset=22), slice=Constant(value='finished_at', lineno=325, col_offset=23, end_lineno=325, end_col_offset=36), ctx=Store(), lineno=325, col_offset=8, end_lineno=325, end_col_offset=37)], value=Call(func=Attribute(value=Call(func=Attribute(value=Name(id='completed_at', ctx=Load(), lineno=325, col_offset=40, end_lineno=325, end_col_offset=52), attr='isoformat', ctx=Load(), lineno=325, col_offset=40, end_lineno=325, end_col_offset=62), keywords=[keyword(arg='timespec', value=Constant(value='seconds', lineno=325, col_offset=72, end_lineno=325, end_col_offset=81), lineno=325, col_offset=63, end_lineno=325, end_col_offset=81)], lineno=325, col_offset=40, end_lineno=325, end_col_offset=82), attr='replace', ctx=Load(), lineno=325, col_offset=40, end_lineno=325, end_col_offset=90), args=[Constant(value='+00:00', lineno=326, col_offset=12, end_lineno=326, end_col_offset=20), Constant(value='Z', lineno=326, col_offset=22, end_lineno=326, end_col_offset=25)], lineno=325, col_offset=40, end_lineno=327, end_col_offset=9), lineno=325, col_offset=8, end_lineno=327, end_col_offset=9), Return(value=Attribute(value=Name(id='self', ctx=Load(), lineno=328, col_offset=15, end_lineno=328, end_col_offset=19), attr='_envelope', ctx=Load(), lineno=328, col_offset=15, end_lineno=328, end_col_offset=29), lineno=328, col_offset=8, end_lineno=328, end_col_offset=29)], returns=Subscript(value=Name(id='dict', ctx=Load(), lineno=311, col_offset=66, end_lineno=311, end_col_offset=70), slice=Tuple(elts=[Name(id='str', ctx=Load(), lineno=311, col_offset=71, end_lineno=311, end_col_offset=74), Name(id='object', ctx=Load(), lineno=311, col_offset=76, end_lineno=311, end_col_offset=82)], ctx=Load(), lineno=311, col_offset=71, end_lineno=311, end_col_offset=82), ctx=Load(), lineno=311, col_offset=66, end_lineno=311, end_col_offset=83), lineno=311, col_offset=4, end_lineno=328, end_col_offset=29)], lineno=204, col_offset=0, end_lineno=328, end_col_offset=29), FunctionDef(name='_now_id', args=arguments(), body=[Return(value=Subscript(value=Attribute(value=Call(func=Attribute(value=Name(id='uuid', ctx=Load(), lineno=332, col_offset=11, end_lineno=332, end_col_offset=15), attr='uuid4', ctx=Load(), lineno=332, col_offset=11, end_lineno=332, end_col_offset=21), lineno=332, col_offset=11, end_lineno=332, end_col_offset=23), attr='hex', ctx=Load(), lineno=332, col_offset=11, end_lineno=332, end_col_offset=27), slice=Slice(upper=Constant(value=6, lineno=332, col_offset=29, end_lineno=332, end_col_offset=30), lineno=332, col_offset=28, end_lineno=332, end_col_offset=30), ctx=Load(), lineno=332, col_offset=11, end_lineno=332, end_col_offset=31), lineno=332, col_offset=4, end_lineno=332, end_col_offset=31)], returns=Name(id='str', ctx=Load(), lineno=331, col_offset=17, end_lineno=331, end_col_offset=20), lineno=331, col_offset=0, end_lineno=332, end_col_offset=31), FunctionDef(name='_prepare_logger', args=arguments(kwonlyargs=[arg(arg='operation', annotation=Name(id='str', ctx=Load(), lineno=337, col_offset=15, end_lineno=337, end_col_offset=18), lineno=337, col_offset=4, end_lineno=337, end_col_offset=18), arg(arg='route', annotation=Subscript(value=Name(id='list', ctx=Load(), lineno=338, col_offset=11, end_lineno=338, end_col_offset=15), slice=Name(id='str', ctx=Load(), lineno=338, col_offset=16, end_lineno=338, end_col_offset=19), ctx=Load(), lineno=338, col_offset=11, end_lineno=338, end_col_offset=20), lineno=338, col_offset=4, end_lineno=338, end_col_offset=20), arg(arg='run_id', annotation=Name(id='str', ctx=Load(), lineno=339, col_offset=12, end_lineno=339, end_col_offset=15), lineno=339, col_offset=4, end_lineno=339, end_col_offset=15), arg(arg='correlation_id', annotation=Name(id='str', ctx=Load(), lineno=340, col_offset=20, end_lineno=340, end_col_offset=23), lineno=340, col_offset=4, end_lineno=340, end_col_offset=23), arg(arg='extra_context', annotation=BinOp(left=Subscript(value=Name(id='Mapping', ctx=Load(), lineno=341, col_offset=19, end_lineno=341, end_col_offset=26), slice=Tuple(elts=[Name(id='str', ctx=Load(), lineno=341, col_offset=27, end_lineno=341, end_col_offset=30), Name(id='object', ctx=Load(), lineno=341, col_offset=32, end_lineno=341, end_col_offset=38)], ctx=Load(), lineno=341, col_offset=27, end_lineno=341, end_col_offset=38), ctx=Load(), lineno=341, col_offset=19, end_lineno=341, end_col_offset=39), op=BitOr(), right=Constant(value=None, lineno=341, col_offset=42, end_lineno=341, end_col_offset=46), lineno=341, col_offset=19, end_lineno=341, end_col_offset=46), lineno=341, col_offset=4, end_lineno=341, end_col_offset=46)], kw_defaults=[None, None, None, None, None]), body=[Expr(value=Constant(value='Return a logger adapter enriched with CLI metadata.\n\n    Parameters\n    ----------\n    operation : str\n        Operation name for logging context.\n    route : list[str]\n        Command route segments for logging context.\n    run_id : str\n        Unique run identifier for logging context.\n    correlation_id : str\n        Correlation identifier for distributed tracing.\n    extra_context : Mapping[str, object] | None\n        Optional additional context fields to include in log records.\n\n    Returns\n    -------\n    logging.LoggerAdapter\n        Logger adapter providing structured CLI context fields.\n    ', lineno=343, col_offset=4, end_lineno=362, end_col_offset=7), lineno=343, col_offset=4, end_lineno=362, end_col_offset=7), Assign(targets=[Name(id='logger', ctx=Store(), lineno=363, col_offset=4, end_lineno=363, end_col_offset=10)], value=Call(func=Attribute(value=Name(id='logging', ctx=Load(), lineno=363, col_offset=13, end_lineno=363, end_col_offset=20), attr='getLogger', ctx=Load(), lineno=363, col_offset=13, end_lineno=363, end_col_offset=30), args=[Constant(value='kgf.cli', lineno=363, col_offset=31, end_lineno=363, end_col_offset=40)], lineno=363, col_offset=13, end_lineno=363, end_col_offset=41), lineno=363, col_offset=4, end_lineno=363, end_col_offset=41), If(test=UnaryOp(op=Not(), operand=Attribute(value=Name(id='logger', ctx=Load(), lineno=364, col_offset=11, end_lineno=364, end_col_offset=17), attr='handlers', ctx=Load(), lineno=364, col_offset=11, end_lineno=364, end_col_offset=26), lineno=364, col_offset=7, end_lineno=364, end_col_offset=26), body=[Expr(value=Call(func=Attribute(value=Name(id='logging', ctx=Load(), lineno=365, col_offset=8, end_lineno=365, end_col_offset=15), attr='basicConfig', ctx=Load(), lineno=365, col_offset=8, end_lineno=365, end_col_offset=27), keywords=[keyword(arg='level', value=Attribute(value=Name(id='logging', ctx=Load(), lineno=365, col_offset=34, end_lineno=365, end_col_offset=41), attr='INFO', ctx=Load(), lineno=365, col_offset=34, end_lineno=365, end_col_offset=46), lineno=365, col_offset=28, end_lineno=365, end_col_offset=46), keyword(arg='format', value=Constant(value='%(message)s', lineno=365, col_offset=55, end_lineno=365, end_col_offset=68), lineno=365, col_offset=48, end_lineno=365, end_col_offset=68)], lineno=365, col_offset=8, end_lineno=365, end_col_offset=69), lineno=365, col_offset=8, end_lineno=365, end_col_offset=69)], lineno=364, col_offset=4, end_lineno=365, end_col_offset=69), AnnAssign(target=Name(id='fields', ctx=Store(), lineno=366, col_offset=4, end_lineno=366, end_col_offset=10), annotation=Subscript(value=Name(id='dict', ctx=Load(), lineno=366, col_offset=12, end_lineno=366, end_col_offset=16), slice=Tuple(elts=[Name(id='str', ctx=Load(), lineno=366, col_offset=17, end_lineno=366, end_col_offset=20), Name(id='object', ctx=Load(), lineno=366, col_offset=22, end_lineno=366, end_col_offset=28)], ctx=Load(), lineno=366, col_offset=17, end_lineno=366, end_col_offset=28), ctx=Load(), lineno=366, col_offset=12, end_lineno=366, end_col_offset=29), value=Dict(keys=[Constant(value='operation', lineno=367, col_offset=8, end_lineno=367, end_col_offset=19), Constant(value='route', lineno=368, col_offset=8, end_lineno=368, end_col_offset=15), Constant(value='run_id', lineno=369, col_offset=8, end_lineno=369, end_col_offset=16), Constant(value='correlation_id', lineno=370, col_offset=8, end_lineno=370, end_col_offset=24)], values=[Name(id='operation', ctx=Load(), lineno=367, col_offset=21, end_lineno=367, end_col_offset=30), Name(id='route', ctx=Load(), lineno=368, col_offset=17, end_lineno=368, end_col_offset=22), Name(id='run_id', ctx=Load(), lineno=369, col_offset=18, end_lineno=369, end_col_offset=24), Name(id='correlation_id', ctx=Load(), lineno=370, col_offset=26, end_lineno=370, end_col_offset=40)], lineno=366, col_offset=32, end_lineno=371, end_col_offset=5), simple=1, lineno=366, col_offset=4, end_lineno=371, end_col_offset=5), If(test=Name(id='extra_context', ctx=Load(), lineno=372, col_offset=7, end_lineno=372, end_col_offset=20), body=[Expr(value=Call(func=Attribute(value=Name(id='fields', ctx=Load(), lineno=373, col_offset=8, end_lineno=373, end_col_offset=14), attr='update', ctx=Load(), lineno=373, col_offset=8, end_lineno=373, end_col_offset=21), args=[Name(id='extra_context', ctx=Load(), lineno=373, col_offset=22, end_lineno=373, end_col_offset=35)], lineno=373, col_offset=8, end_lineno=373, end_col_offset=36), lineno=373, col_offset=8, end_lineno=373, end_col_offset=36)], lineno=372, col_offset=4, end_lineno=373, end_col_offset=36), Return(value=Call(func=Attribute(value=Name(id='logging', ctx=Load(), lineno=374, col_offset=11, end_lineno=374, end_col_offset=18), attr='LoggerAdapter', ctx=Load(), lineno=374, col_offset=11, end_lineno=374, end_col_offset=32), args=[Name(id='logger', ctx=Load(), lineno=374, col_offset=33, end_lineno=374, end_col_offset=39)], keywords=[keyword(arg='extra', value=Name(id='fields', ctx=Load(), lineno=374, col_offset=47, end_lineno=374, end_col_offset=53), lineno=374, col_offset=41, end_lineno=374, end_col_offset=53)], lineno=374, col_offset=11, end_lineno=374, end_col_offset=54), lineno=374, col_offset=4, end_lineno=374, end_col_offset=54)], returns=Attribute(value=Name(id='logging', ctx=Load(), lineno=342, col_offset=5, end_lineno=342, end_col_offset=12), attr='LoggerAdapter', ctx=Load(), lineno=342, col_offset=5, end_lineno=342, end_col_offset=26), lineno=335, col_offset=0, end_lineno=374, end_col_offset=54), FunctionDef(name='_prepare_execution_metadata', args=arguments(args=[arg(arg='cfg', annotation=Name(id='CliRunConfig', ctx=Load(), lineno=377, col_offset=37, end_lineno=377, end_col_offset=49), lineno=377, col_offset=32, end_lineno=377, end_col_offset=49)]), body=[Expr(value=Constant(value='Return the execution metadata derived from ``cfg``.\n\n    Parameters\n    ----------\n    cfg : CliRunConfig\n        CLI configuration describing the requested run.\n\n    Returns\n    -------\n    _ExecutionMetadata\n        Immutable metadata bundle used throughout the execution.\n    ', lineno=378, col_offset=4, end_lineno=389, end_col_offset=7), lineno=378, col_offset=4, end_lineno=389, end_col_offset=7), Assign(targets=[Name(id='route', ctx=Store(), lineno=390, col_offset=4, end_lineno=390, end_col_offset=9)], value=Call(func=Name(id='normalize_route', ctx=Load(), lineno=390, col_offset=12, end_lineno=390, end_col_offset=27), args=[Attribute(value=Name(id='cfg', ctx=Load(), lineno=390, col_offset=28, end_lineno=390, end_col_offset=31), attr='command_path', ctx=Load(), lineno=390, col_offset=28, end_lineno=390, end_col_offset=44)], lineno=390, col_offset=12, end_lineno=390, end_col_offset=45), lineno=390, col_offset=4, end_lineno=390, end_col_offset=45), Assign(targets=[Name(id='correlation_id', ctx=Store(), lineno=391, col_offset=4, end_lineno=391, end_col_offset=18)], value=BoolOp(op=Or(), values=[Attribute(value=Name(id='cfg', ctx=Load(), lineno=391, col_offset=21, end_lineno=391, end_col_offset=24), attr='correlation_id', ctx=Load(), lineno=391, col_offset=21, end_lineno=391, end_col_offset=39), Call(func=Name(id='_now_id', ctx=Load(), lineno=391, col_offset=43, end_lineno=391, end_col_offset=50), lineno=391, col_offset=43, end_lineno=391, end_col_offset=52)], lineno=391, col_offset=21, end_lineno=391, end_col_offset=52), lineno=391, col_offset=4, end_lineno=391, end_col_offset=52), Assign(targets=[Name(id='run_id', ctx=Store(), lineno=392, col_offset=4, end_lineno=392, end_col_offset=10)], value=Call(func=Name(id='_now_id', ctx=Load(), lineno=392, col_offset=13, end_lineno=392, end_col_offset=20), lineno=392, col_offset=13, end_lineno=392, end_col_offset=22), lineno=392, col_offset=4, end_lineno=392, end_col_offset=22), Assign(targets=[Name(id='operation', ctx=Store(), lineno=393, col_offset=4, end_lineno=393, end_col_offset=13)], value=Call(func=Attribute(value=Constant(value='.', lineno=393, col_offset=16, end_lineno=393, end_col_offset=19), attr='join', ctx=Load(), lineno=393, col_offset=16, end_lineno=393, end_col_offset=24), args=[Name(id='route', ctx=Load(), lineno=393, col_offset=25, end_lineno=393, end_col_offset=30)], lineno=393, col_offset=16, end_lineno=393, end_col_offset=31), lineno=393, col_offset=4, end_lineno=393, end_col_offset=31), Assign(targets=[Name(id='paths', ctx=Store(), lineno=394, col_offset=4, end_lineno=394, end_col_offset=9)], value=Call(func=Attribute(value=Name(id='Paths', ctx=Load(), lineno=394, col_offset=12, end_lineno=394, end_col_offset=17), attr='discover', ctx=Load(), lineno=394, col_offset=12, end_lineno=394, end_col_offset=26), lineno=394, col_offset=12, end_lineno=394, end_col_offset=28), lineno=394, col_offset=4, end_lineno=394, end_col_offset=28), Assign(targets=[Name(id='logger', ctx=Store(), lineno=395, col_offset=4, end_lineno=395, end_col_offset=10)], value=Call(func=Name(id='_prepare_logger', ctx=Load(), lineno=395, col_offset=13, end_lineno=395, end_col_offset=28), keywords=[keyword(arg='operation', value=Name(id='operation', ctx=Load(), lineno=396, col_offset=18, end_lineno=396, end_col_offset=27), lineno=396, col_offset=8, end_lineno=396, end_col_offset=27), keyword(arg='route', value=Name(id='route', ctx=Load(), lineno=397, col_offset=14, end_lineno=397, end_col_offset=19), lineno=397, col_offset=8, end_lineno=397, end_col_offset=19), keyword(arg='run_id', value=Name(id='run_id', ctx=Load(), lineno=398, col_offset=15, end_lineno=398, end_col_offset=21), lineno=398, col_offset=8, end_lineno=398, end_col_offset=21), keyword(arg='correlation_id', value=Name(id='correlation_id', ctx=Load(), lineno=399, col_offset=23, end_lineno=399, end_col_offset=37), lineno=399, col_offset=8, end_lineno=399, end_col_offset=37), keyword(arg='extra_context', value=Attribute(value=Name(id='cfg', ctx=Load(), lineno=400, col_offset=22, end_lineno=400, end_col_offset=25), attr='extra_context', ctx=Load(), lineno=400, col_offset=22, end_lineno=400, end_col_offset=39), lineno=400, col_offset=8, end_lineno=400, end_col_offset=39)], lineno=395, col_offset=13, end_lineno=401, end_col_offset=5), lineno=395, col_offset=4, end_lineno=401, end_col_offset=5), Return(value=Call(func=Name(id='_ExecutionMetadata', ctx=Load(), lineno=402, col_offset=11, end_lineno=402, end_col_offset=29), keywords=[keyword(arg='route', value=Name(id='route', ctx=Load(), lineno=403, col_offset=14, end_lineno=403, end_col_offset=19), lineno=403, col_offset=8, end_lineno=403, end_col_offset=19), keyword(arg='operation', value=Name(id='operation', ctx=Load(), lineno=404, col_offset=18, end_lineno=404, end_col_offset=27), lineno=404, col_offset=8, end_lineno=404, end_col_offset=27), keyword(arg='correlation_id', value=Name(id='correlation_id', ctx=Load(), lineno=405, col_offset=23, end_lineno=405, end_col_offset=37), lineno=405, col_offset=8, end_lineno=405, end_col_offset=37), keyword(arg='run_id', value=Name(id='run_id', ctx=Load(), lineno=406, col_offset=15, end_lineno=406, end_col_offset=21), lineno=406, col_offset=8, end_lineno=406, end_col_offset=21), keyword(arg='paths', value=Name(id='paths', ctx=Load(), lineno=407, col_offset=14, end_lineno=407, end_col_offset=19), lineno=407, col_offset=8, end_lineno=407, end_col_offset=19), keyword(arg='logger', value=Name(id='logger', ctx=Load(), lineno=408, col_offset=15, end_lineno=408, end_col_offset=21), lineno=408, col_offset=8, end_lineno=408, end_col_offset=21)], lineno=402, col_offset=11, end_lineno=409, end_col_offset=5), lineno=402, col_offset=4, end_lineno=409, end_col_offset=5)], returns=Name(id='_ExecutionMetadata', ctx=Load(), lineno=377, col_offset=54, end_lineno=377, end_col_offset=72), lineno=377, col_offset=0, end_lineno=409, end_col_offset=5), FunctionDef(name='_build_envelope', args=arguments(args=[arg(arg='cfg', annotation=Name(id='CliRunConfig', ctx=Load(), lineno=413, col_offset=9, end_lineno=413, end_col_offset=21), lineno=413, col_offset=4, end_lineno=413, end_col_offset=21)], kwonlyargs=[arg(arg='route', annotation=Subscript(value=Name(id='list', ctx=Load(), lineno=415, col_offset=11, end_lineno=415, end_col_offset=15), slice=Name(id='str', ctx=Load(), lineno=415, col_offset=16, end_lineno=415, end_col_offset=19), ctx=Load(), lineno=415, col_offset=11, end_lineno=415, end_col_offset=20), lineno=415, col_offset=4, end_lineno=415, end_col_offset=20), arg(arg='operation', annotation=Name(id='str', ctx=Load(), lineno=416, col_offset=15, end_lineno=416, end_col_offset=18), lineno=416, col_offset=4, end_lineno=416, end_col_offset=18), arg(arg='run_id', annotation=Name(id='str', ctx=Load(), lineno=417, col_offset=12, end_lineno=417, end_col_offset=15), lineno=417, col_offset=4, end_lineno=417, end_col_offset=15), arg(arg='correlation_id', annotation=Name(id='str', ctx=Load(), lineno=418, col_offset=20, end_lineno=418, end_col_offset=23), lineno=418, col_offset=4, end_lineno=418, end_col_offset=23)], kw_defaults=[None, None, None, None]), body=[Expr(value=Constant(value='Return an envelope builder pre-populated with baseline metadata.\n\n    Parameters\n    ----------\n    cfg : CliRunConfig\n        Configuration containing envelope metadata preferences.\n    route : list[str]\n        Command route segments for envelope metadata.\n    operation : str\n        Operation name for envelope metadata.\n    run_id : str\n        Unique run identifier for envelope metadata.\n    correlation_id : str\n        Correlation identifier for distributed tracing.\n\n    Returns\n    -------\n    EnvelopeBuilder\n        Envelope builder initialised with route and identity metadata.\n    ', lineno=420, col_offset=4, end_lineno=439, end_col_offset=7), lineno=420, col_offset=4, end_lineno=439, end_col_offset=7), Assign(targets=[Name(id='envelope', ctx=Store(), lineno=440, col_offset=4, end_lineno=440, end_col_offset=12)], value=Call(func=Name(id='EnvelopeBuilder', ctx=Load(), lineno=440, col_offset=15, end_lineno=440, end_col_offset=30), keywords=[keyword(arg='command_path', value=Name(id='route', ctx=Load(), lineno=441, col_offset=21, end_lineno=441, end_col_offset=26), lineno=441, col_offset=8, end_lineno=441, end_col_offset=26), keyword(arg='operation', value=Name(id='operation', ctx=Load(), lineno=442, col_offset=18, end_lineno=442, end_col_offset=27), lineno=442, col_offset=8, end_lineno=442, end_col_offset=27), keyword(arg='run_id', value=Name(id='run_id', ctx=Load(), lineno=443, col_offset=15, end_lineno=443, end_col_offset=21), lineno=443, col_offset=8, end_lineno=443, end_col_offset=21), keyword(arg='correlation_id', value=Name(id='correlation_id', ctx=Load(), lineno=444, col_offset=23, end_lineno=444, end_col_offset=37), lineno=444, col_offset=8, end_lineno=444, end_col_offset=37)], lineno=440, col_offset=15, end_lineno=445, end_col_offset=5), lineno=440, col_offset=4, end_lineno=445, end_col_offset=5), If(test=Attribute(value=Name(id='cfg', ctx=Load(), lineno=446, col_offset=7, end_lineno=446, end_col_offset=10), attr='args_summary', ctx=Load(), lineno=446, col_offset=7, end_lineno=446, end_col_offset=23), body=[Expr(value=Call(func=Attribute(value=Name(id='envelope', ctx=Load(), lineno=447, col_offset=8, end_lineno=447, end_col_offset=16), attr='set_args', ctx=Load(), lineno=447, col_offset=8, end_lineno=447, end_col_offset=25), args=[Attribute(value=Name(id='cfg', ctx=Load(), lineno=447, col_offset=26, end_lineno=447, end_col_offset=29), attr='args_summary', ctx=Load(), lineno=447, col_offset=26, end_lineno=447, end_col_offset=42)], lineno=447, col_offset=8, end_lineno=447, end_col_offset=43), lineno=447, col_offset=8, end_lineno=447, end_col_offset=43)], lineno=446, col_offset=4, end_lineno=447, end_col_offset=43), If(test=Attribute(value=Name(id='cfg', ctx=Load(), lineno=448, col_offset=7, end_lineno=448, end_col_offset=10), attr='env_summary', ctx=Load(), lineno=448, col_offset=7, end_lineno=448, end_col_offset=22), body=[Expr(value=Call(func=Attribute(value=Name(id='envelope', ctx=Load(), lineno=449, col_offset=8, end_lineno=449, end_col_offset=16), attr='set_env', ctx=Load(), lineno=449, col_offset=8, end_lineno=449, end_col_offset=24), args=[Attribute(value=Name(id='cfg', ctx=Load(), lineno=449, col_offset=25, end_lineno=449, end_col_offset=28), attr='env_summary', ctx=Load(), lineno=449, col_offset=25, end_lineno=449, end_col_offset=40)], lineno=449, col_offset=8, end_lineno=449, end_col_offset=41), lineno=449, col_offset=8, end_lineno=449, end_col_offset=41)], lineno=448, col_offset=4, end_lineno=449, end_col_offset=41), Return(value=Name(id='envelope', ctx=Load(), lineno=450, col_offset=11, end_lineno=450, end_col_offset=19), lineno=450, col_offset=4, end_lineno=450, end_col_offset=19)], returns=Name(id='EnvelopeBuilder', ctx=Load(), lineno=419, col_offset=5, end_lineno=419, end_col_offset=20), lineno=412, col_offset=0, end_lineno=450, end_col_offset=19), FunctionDef(name='_envelope_path', args=arguments(args=[arg(arg='base_dir', annotation=Name(id='Path', ctx=Load(), lineno=453, col_offset=29, end_lineno=453, end_col_offset=33), lineno=453, col_offset=19, end_lineno=453, end_col_offset=33)], kwonlyargs=[arg(arg='started_at', annotation=Name(id='str', ctx=Load(), lineno=453, col_offset=50, end_lineno=453, end_col_offset=53), lineno=453, col_offset=38, end_lineno=453, end_col_offset=53), arg(arg='run_id', annotation=Name(id='str', ctx=Load(), lineno=453, col_offset=63, end_lineno=453, end_col_offset=66), lineno=453, col_offset=55, end_lineno=453, end_col_offset=66)], kw_defaults=[None, None]), body=[Expr(value=Constant(value='Return the filesystem path for the envelope produced by the CLI run.\n\n    Parameters\n    ----------\n    base_dir : Path\n        Base directory for envelope storage.\n    started_at : str\n        ISO 8601 timestamp string when the CLI run started.\n    run_id : str\n        Unique run identifier used in the filename.\n\n    Returns\n    -------\n    Path\n        Target path for the JSON envelope file.\n    ', lineno=454, col_offset=4, end_lineno=469, end_col_offset=7), lineno=454, col_offset=4, end_lineno=469, end_col_offset=7), Assign(targets=[Name(id='date_component', ctx=Store(), lineno=470, col_offset=4, end_lineno=470, end_col_offset=18)], value=Call(func=Attribute(value=Subscript(value=Name(id='started_at', ctx=Load(), lineno=470, col_offset=21, end_lineno=470, end_col_offset=31), slice=Slice(upper=Constant(value=10, lineno=470, col_offset=33, end_lineno=470, end_col_offset=35), lineno=470, col_offset=32, end_lineno=470, end_col_offset=35), ctx=Load(), lineno=470, col_offset=21, end_lineno=470, end_col_offset=36), attr='replace', ctx=Load(), lineno=470, col_offset=21, end_lineno=470, end_col_offset=44), args=[Constant(value='-', lineno=470, col_offset=45, end_lineno=470, end_col_offset=48), Constant(value='', lineno=470, col_offset=50, end_lineno=470, end_col_offset=52)], lineno=470, col_offset=21, end_lineno=470, end_col_offset=53), lineno=470, col_offset=4, end_lineno=470, end_col_offset=53), Assign(targets=[Name(id='time_component', ctx=Store(), lineno=471, col_offset=4, end_lineno=471, end_col_offset=18)], value=Call(func=Attribute(value=Subscript(value=Name(id='started_at', ctx=Load(), lineno=471, col_offset=21, end_lineno=471, end_col_offset=31), slice=Slice(lower=Constant(value=11, lineno=471, col_offset=32, end_lineno=471, end_col_offset=34), upper=Constant(value=19, lineno=471, col_offset=35, end_lineno=471, end_col_offset=37), lineno=471, col_offset=32, end_lineno=471, end_col_offset=37), ctx=Load(), lineno=471, col_offset=21, end_lineno=471, end_col_offset=38), attr='replace', ctx=Load(), lineno=471, col_offset=21, end_lineno=471, end_col_offset=46), args=[Constant(value=':', lineno=471, col_offset=47, end_lineno=471, end_col_offset=50), Constant(value='', lineno=471, col_offset=52, end_lineno=471, end_col_offset=54)], lineno=471, col_offset=21, end_lineno=471, end_col_offset=55), lineno=471, col_offset=4, end_lineno=471, end_col_offset=55), Assign(targets=[Name(id='filename', ctx=Store(), lineno=472, col_offset=4, end_lineno=472, end_col_offset=12)], value=JoinedStr(values=[FormattedValue(value=Name(id='date_component', ctx=Load(), lineno=472, col_offset=18, end_lineno=472, end_col_offset=32), conversion=-1, lineno=472, col_offset=17, end_lineno=472, end_col_offset=33), Constant(value='-', lineno=472, col_offset=33, end_lineno=472, end_col_offset=34), FormattedValue(value=Name(id='time_component', ctx=Load(), lineno=472, col_offset=35, end_lineno=472, end_col_offset=49), conversion=-1, lineno=472, col_offset=34, end_lineno=472, end_col_offset=50), Constant(value='-', lineno=472, col_offset=50, end_lineno=472, end_col_offset=51), FormattedValue(value=Name(id='run_id', ctx=Load(), lineno=472, col_offset=52, end_lineno=472, end_col_offset=58), conversion=-1, lineno=472, col_offset=51, end_lineno=472, end_col_offset=59), Constant(value='.json', lineno=472, col_offset=59, end_lineno=472, end_col_offset=64)], lineno=472, col_offset=15, end_lineno=472, end_col_offset=65), lineno=472, col_offset=4, end_lineno=472, end_col_offset=65), Return(value=BinOp(left=Name(id='base_dir', ctx=Load(), lineno=473, col_offset=11, end_lineno=473, end_col_offset=19), op=Div(), right=Name(id='filename', ctx=Load(), lineno=473, col_offset=22, end_lineno=473, end_col_offset=30), lineno=473, col_offset=11, end_lineno=473, end_col_offset=30), lineno=473, col_offset=4, end_lineno=473, end_col_offset=30)], returns=Name(id='Path', ctx=Load(), lineno=453, col_offset=71, end_lineno=453, end_col_offset=75), lineno=453, col_offset=0, end_lineno=473, end_col_offset=30), FunctionDef(name='_should_write_envelope', args=arguments(args=[arg(arg='cfg', annotation=Name(id='CliRunConfig', ctx=Load(), lineno=476, col_offset=32, end_lineno=476, end_col_offset=44), lineno=476, col_offset=27, end_lineno=476, end_col_offset=44), arg(arg='status', annotation=Name(id='CliRunStatus', ctx=Load(), lineno=476, col_offset=54, end_lineno=476, end_col_offset=66), lineno=476, col_offset=46, end_lineno=476, end_col_offset=66)]), body=[Expr(value=Constant(value='Return ``True`` when the envelope should be persisted for ``status``.\n\n    Parameters\n    ----------\n    cfg : CliRunConfig\n        Configuration containing envelope persistence preferences.\n    status : CliRunStatus\n        Current CLI run status (SUCCESS or ERROR).\n\n    Returns\n    -------\n    bool\n        ``True`` when the envelope should be written to disk.\n    ', lineno=477, col_offset=4, end_lineno=490, end_col_offset=7), lineno=477, col_offset=4, end_lineno=490, end_col_offset=7), Return(value=BoolOp(op=Or(), values=[Compare(left=Attribute(value=Name(id='cfg', ctx=Load(), lineno=492, col_offset=8, end_lineno=492, end_col_offset=11), attr='write_envelope_on', ctx=Load(), lineno=492, col_offset=8, end_lineno=492, end_col_offset=29), ops=[Eq()], comparators=[Constant(value='always', lineno=492, col_offset=33, end_lineno=492, end_col_offset=41)], lineno=492, col_offset=8, end_lineno=492, end_col_offset=41), BoolOp(op=And(), values=[Compare(left=Attribute(value=Name(id='cfg', ctx=Load(), lineno=493, col_offset=12, end_lineno=493, end_col_offset=15), attr='write_envelope_on', ctx=Load(), lineno=493, col_offset=12, end_lineno=493, end_col_offset=33), ops=[Eq()], comparators=[Constant(value='error', lineno=493, col_offset=37, end_lineno=493, end_col_offset=44)], lineno=493, col_offset=12, end_lineno=493, end_col_offset=44), Compare(left=Name(id='status', ctx=Load(), lineno=493, col_offset=49, end_lineno=493, end_col_offset=55), ops=[Is()], comparators=[Attribute(value=Name(id='CliRunStatus', ctx=Load(), lineno=493, col_offset=59, end_lineno=493, end_col_offset=71), attr='ERROR', ctx=Load(), lineno=493, col_offset=59, end_lineno=493, end_col_offset=77)], lineno=493, col_offset=49, end_lineno=493, end_col_offset=77)], lineno=493, col_offset=12, end_lineno=493, end_col_offset=77), BoolOp(op=And(), values=[Compare(left=Attribute(value=Name(id='cfg', ctx=Load(), lineno=494, col_offset=12, end_lineno=494, end_col_offset=15), attr='write_envelope_on', ctx=Load(), lineno=494, col_offset=12, end_lineno=494, end_col_offset=33), ops=[Eq()], comparators=[Constant(value='success', lineno=494, col_offset=37, end_lineno=494, end_col_offset=46)], lineno=494, col_offset=12, end_lineno=494, end_col_offset=46), Compare(left=Name(id='status', ctx=Load(), lineno=494, col_offset=51, end_lineno=494, end_col_offset=57), ops=[Is()], comparators=[Attribute(value=Name(id='CliRunStatus', ctx=Load(), lineno=494, col_offset=61, end_lineno=494, end_col_offset=73), attr='SUCCESS', ctx=Load(), lineno=494, col_offset=61, end_lineno=494, end_col_offset=81)], lineno=494, col_offset=51, end_lineno=494, end_col_offset=81)], lineno=494, col_offset=12, end_lineno=494, end_col_offset=81)], lineno=492, col_offset=8, end_lineno=494, end_col_offset=82), lineno=491, col_offset=4, end_lineno=495, end_col_offset=5)], returns=Name(id='bool', ctx=Load(), lineno=476, col_offset=71, end_lineno=476, end_col_offset=75), lineno=476, col_offset=0, end_lineno=495, end_col_offset=5), FunctionDef(name='_validate_envelope', args=arguments(args=[arg(arg='paths', annotation=Name(id='Paths', ctx=Load(), lineno=499, col_offset=11, end_lineno=499, end_col_offset=16), lineno=499, col_offset=4, end_lineno=499, end_col_offset=16), arg(arg='payload', annotation=Subscript(value=Name(id='dict', ctx=Load(), lineno=499, col_offset=27, end_lineno=499, end_col_offset=31), slice=Tuple(elts=[Name(id='str', ctx=Load(), lineno=499, col_offset=32, end_lineno=499, end_col_offset=35), Name(id='object', ctx=Load(), lineno=499, col_offset=37, end_lineno=499, end_col_offset=43)], ctx=Load(), lineno=499, col_offset=32, end_lineno=499, end_col_offset=43), ctx=Load(), lineno=499, col_offset=27, end_lineno=499, end_col_offset=44), lineno=499, col_offset=18, end_lineno=499, end_col_offset=44), arg(arg='logger', annotation=Attribute(value=Name(id='logging', ctx=Load(), lineno=499, col_offset=54, end_lineno=499, end_col_offset=61), attr='LoggerAdapter', ctx=Load(), lineno=499, col_offset=54, end_lineno=499, end_col_offset=75), lineno=499, col_offset=46, end_lineno=499, end_col_offset=75)]), body=[Expr(value=Constant(value='Validate the envelope payload against the optional JSON Schema.', lineno=501, col_offset=4, end_lineno=501, end_col_offset=73), lineno=501, col_offset=4, end_lineno=501, end_col_offset=73), If(test=Compare(left=Name(id='jsonschema', ctx=Load(), lineno=502, col_offset=7, end_lineno=502, end_col_offset=17), ops=[Is()], comparators=[Constant(value=None, lineno=502, col_offset=21, end_lineno=502, end_col_offset=25)], lineno=502, col_offset=7, end_lineno=502, end_col_offset=25), body=[Return(lineno=503, col_offset=8, end_lineno=503, end_col_offset=14)], lineno=502, col_offset=4, end_lineno=503, end_col_offset=14), Assign(targets=[Name(id='schema_path', ctx=Store(), lineno=504, col_offset=4, end_lineno=504, end_col_offset=15)], value=BinOp(left=BinOp(left=BinOp(left=Attribute(value=Name(id='paths', ctx=Load(), lineno=504, col_offset=18, end_lineno=504, end_col_offset=23), attr='repo_root', ctx=Load(), lineno=504, col_offset=18, end_lineno=504, end_col_offset=33), op=Div(), right=Constant(value='schema', lineno=504, col_offset=36, end_lineno=504, end_col_offset=44), lineno=504, col_offset=18, end_lineno=504, end_col_offset=44), op=Div(), right=Constant(value='tools', lineno=504, col_offset=47, end_lineno=504, end_col_offset=54), lineno=504, col_offset=18, end_lineno=504, end_col_offset=54), op=Div(), right=Constant(value='cli_envelope.json', lineno=504, col_offset=57, end_lineno=504, end_col_offset=76), lineno=504, col_offset=18, end_lineno=504, end_col_offset=76), lineno=504, col_offset=4, end_lineno=504, end_col_offset=76), If(test=UnaryOp(op=Not(), operand=Call(func=Attribute(value=Name(id='schema_path', ctx=Load(), lineno=505, col_offset=11, end_lineno=505, end_col_offset=22), attr='exists', ctx=Load(), lineno=505, col_offset=11, end_lineno=505, end_col_offset=29), lineno=505, col_offset=11, end_lineno=505, end_col_offset=31), lineno=505, col_offset=7, end_lineno=505, end_col_offset=31), body=[Return(lineno=506, col_offset=8, end_lineno=506, end_col_offset=14)], lineno=505, col_offset=4, end_lineno=506, end_col_offset=14), Try(body=[Assign(targets=[Name(id='schema', ctx=Store(), lineno=508, col_offset=8, end_lineno=508, end_col_offset=14)], value=Call(func=Attribute(value=Name(id='json', ctx=Load(), lineno=508, col_offset=17, end_lineno=508, end_col_offset=21), attr='loads', ctx=Load(), lineno=508, col_offset=17, end_lineno=508, end_col_offset=27), args=[Call(func=Attribute(value=Name(id='schema_path', ctx=Load(), lineno=508, col_offset=28, end_lineno=508, end_col_offset=39), attr='read_text', ctx=Load(), lineno=508, col_offset=28, end_lineno=508, end_col_offset=49), lineno=508, col_offset=28, end_lineno=508, end_col_offset=51)], lineno=508, col_offset=17, end_lineno=508, end_col_offset=52), lineno=508, col_offset=8, end_lineno=508, end_col_offset=52), Expr(value=Call(func=Attribute(value=Name(id='jsonschema', ctx=Load(), lineno=509, col_offset=8, end_lineno=509, end_col_offset=18), attr='validate', ctx=Load(), lineno=509, col_offset=8, end_lineno=509, end_col_offset=27), args=[Name(id='payload', ctx=Load(), lineno=509, col_offset=28, end_lineno=509, end_col_offset=35), Name(id='schema', ctx=Load(), lineno=509, col_offset=37, end_lineno=509, end_col_offset=43)], lineno=509, col_offset=8, end_lineno=509, end_col_offset=44), lineno=509, col_offset=8, end_lineno=509, end_col_offset=44)], handlers=[ExceptHandler(type=Tuple(elts=[Attribute(value=Name(id='json', ctx=Load(), lineno=510, col_offset=12, end_lineno=510, end_col_offset=16), attr='JSONDecodeError', ctx=Load(), lineno=510, col_offset=12, end_lineno=510, end_col_offset=32), Attribute(value=Name(id='jsonschema', ctx=Load(), lineno=510, col_offset=34, end_lineno=510, end_col_offset=44), attr='ValidationError', ctx=Load(), lineno=510, col_offset=34, end_lineno=510, end_col_offset=60), Name(id='OSError', ctx=Load(), lineno=510, col_offset=62, end_lineno=510, end_col_offset=69)], ctx=Load(), lineno=510, col_offset=11, end_lineno=510, end_col_offset=70), name='exc', body=[Expr(value=Call(func=Attribute(value=Name(id='logger', ctx=Load(), lineno=511, col_offset=8, end_lineno=511, end_col_offset=14), attr='warning', ctx=Load(), lineno=511, col_offset=8, end_lineno=511, end_col_offset=22), args=[Constant(value='cli_envelope_validation_failed', lineno=511, col_offset=23, end_lineno=511, end_col_offset=55)], keywords=[keyword(arg='extra', value=Dict(keys=[Constant(value='error', lineno=511, col_offset=64, end_lineno=511, end_col_offset=71)], values=[Call(func=Name(id='str', ctx=Load(), lineno=511, col_offset=73, end_lineno=511, end_col_offset=76), args=[Name(id='exc', ctx=Load(), lineno=511, col_offset=77, end_lineno=511, end_col_offset=80)], lineno=511, col_offset=73, end_lineno=511, end_col_offset=81)], lineno=511, col_offset=63, end_lineno=511, end_col_offset=82), lineno=511, col_offset=57, end_lineno=511, end_col_offset=82)], lineno=511, col_offset=8, end_lineno=511, end_col_offset=83), lineno=511, col_offset=8, end_lineno=511, end_col_offset=83)], lineno=510, col_offset=4, end_lineno=511, end_col_offset=83)], lineno=507, col_offset=4, end_lineno=511, end_col_offset=83)], returns=Constant(value=None, lineno=500, col_offset=5, end_lineno=500, end_col_offset=9), lineno=498, col_offset=0, end_lineno=511, end_col_offset=83), FunctionDef(name='_emit_stdout_message', args=arguments(args=[arg(arg='logger', annotation=Attribute(value=Name(id='logging', ctx=Load(), lineno=515, col_offset=12, end_lineno=515, end_col_offset=19), attr='LoggerAdapter', ctx=Load(), lineno=515, col_offset=12, end_lineno=515, end_col_offset=33), lineno=515, col_offset=4, end_lineno=515, end_col_offset=33)], kwonlyargs=[arg(arg='status', annotation=Name(id='CliRunStatus', ctx=Load(), lineno=517, col_offset=12, end_lineno=517, end_col_offset=24), lineno=517, col_offset=4, end_lineno=517, end_col_offset=24), arg(arg='fmt', annotation=Subscript(value=Name(id='Literal', ctx=Load(), lineno=518, col_offset=9, end_lineno=518, end_col_offset=16), slice=Tuple(elts=[Constant(value='none', lineno=518, col_offset=17, end_lineno=518, end_col_offset=23), Constant(value='minimal', lineno=518, col_offset=25, end_lineno=518, end_col_offset=34), Constant(value='full', lineno=518, col_offset=36, end_lineno=518, end_col_offset=42)], ctx=Load(), lineno=518, col_offset=17, end_lineno=518, end_col_offset=42), ctx=Load(), lineno=518, col_offset=9, end_lineno=518, end_col_offset=43), lineno=518, col_offset=4, end_lineno=518, end_col_offset=43), arg(arg='summary', annotation=Name(id='_RunSummary', ctx=Load(), lineno=519, col_offset=13, end_lineno=519, end_col_offset=24), lineno=519, col_offset=4, end_lineno=519, end_col_offset=24)], kw_defaults=[None, None, None]), body=[Expr(value=Constant(value='Emit a human-friendly summary of the CLI run to the structured logger.', lineno=521, col_offset=4, end_lineno=521, end_col_offset=80), lineno=521, col_offset=4, end_lineno=521, end_col_offset=80), If(test=Compare(left=Name(id='fmt', ctx=Load(), lineno=522, col_offset=7, end_lineno=522, end_col_offset=10), ops=[Eq()], comparators=[Constant(value='none', lineno=522, col_offset=14, end_lineno=522, end_col_offset=20)], lineno=522, col_offset=7, end_lineno=522, end_col_offset=20), body=[Return(lineno=523, col_offset=8, end_lineno=523, end_col_offset=14)], lineno=522, col_offset=4, end_lineno=523, end_col_offset=14), If(test=Compare(left=Name(id='status', ctx=Load(), lineno=524, col_offset=7, end_lineno=524, end_col_offset=13), ops=[Is()], comparators=[Attribute(value=Name(id='CliRunStatus', ctx=Load(), lineno=524, col_offset=17, end_lineno=524, end_col_offset=29), attr='SUCCESS', ctx=Load(), lineno=524, col_offset=17, end_lineno=524, end_col_offset=37)], lineno=524, col_offset=7, end_lineno=524, end_col_offset=37), body=[Assign(targets=[Name(id='duration_label', ctx=Store(), lineno=525, col_offset=8, end_lineno=525, end_col_offset=22)], value=IfExp(test=Compare(left=Attribute(value=Name(id='summary', ctx=Load(), lineno=525, col_offset=57, end_lineno=525, end_col_offset=64), attr='duration_s', ctx=Load(), lineno=525, col_offset=57, end_lineno=525, end_col_offset=75), ops=[IsNot()], comparators=[Constant(value=None, lineno=525, col_offset=83, end_lineno=525, end_col_offset=87)], lineno=525, col_offset=57, end_lineno=525, end_col_offset=87), body=JoinedStr(values=[FormattedValue(value=Attribute(value=Name(id='summary', ctx=Load(), lineno=525, col_offset=28, end_lineno=525, end_col_offset=35), attr='duration_s', ctx=Load(), lineno=525, col_offset=28, end_lineno=525, end_col_offset=46), conversion=-1, format_spec=JoinedStr(values=[Constant(value='.2f', lineno=525, col_offset=47, end_lineno=525, end_col_offset=50)], lineno=525, col_offset=46, end_lineno=525, end_col_offset=50), lineno=525, col_offset=27, end_lineno=525, end_col_offset=51), Constant(value='s', lineno=525, col_offset=51, end_lineno=525, end_col_offset=52)], lineno=525, col_offset=25, end_lineno=525, end_col_offset=53), orelse=Constant(value='n/a', lineno=525, col_offset=93, end_lineno=525, end_col_offset=98), lineno=525, col_offset=25, end_lineno=525, end_col_offset=98), lineno=525, col_offset=8, end_lineno=525, end_col_offset=98), Expr(value=Call(func=Attribute(value=Name(id='logger', ctx=Load(), lineno=526, col_offset=8, end_lineno=526, end_col_offset=14), attr='info', ctx=Load(), lineno=526, col_offset=8, end_lineno=526, end_col_offset=19), args=[Constant(value='cli_run_success', lineno=527, col_offset=12, end_lineno=527, end_col_offset=29)], keywords=[keyword(arg='extra', value=Dict(keys=[Constant(value='stdout_message', lineno=529, col_offset=16, end_lineno=529, end_col_offset=32)], values=[JoinedStr(values=[FormattedValue(value=Attribute(value=Name(id='summary', ctx=Load(), lineno=530, col_offset=23, end_lineno=530, end_col_offset=30), attr='operation', ctx=Load(), lineno=530, col_offset=23, end_lineno=530, end_col_offset=40), conversion=-1, lineno=530, col_offset=22, end_lineno=530, end_col_offset=41), Constant(value=' [run=', lineno=530, col_offset=41, end_lineno=530, end_col_offset=47), FormattedValue(value=Attribute(value=Name(id='summary', ctx=Load(), lineno=530, col_offset=48, end_lineno=530, end_col_offset=55), attr='run_id', ctx=Load(), lineno=530, col_offset=48, end_lineno=530, end_col_offset=62), conversion=-1, lineno=530, col_offset=47, end_lineno=530, end_col_offset=63), Constant(value='] ✅ in ', lineno=530, col_offset=63, end_lineno=531, end_col_offset=25), FormattedValue(value=Name(id='duration_label', ctx=Load(), lineno=531, col_offset=26, end_lineno=531, end_col_offset=40), conversion=-1, lineno=531, col_offset=25, end_lineno=531, end_col_offset=41), Constant(value=' (corr=', lineno=531, col_offset=41, end_lineno=531, end_col_offset=48), FormattedValue(value=Attribute(value=Name(id='summary', ctx=Load(), lineno=531, col_offset=49, end_lineno=531, end_col_offset=56), attr='correlation_id', ctx=Load(), lineno=531, col_offset=49, end_lineno=531, end_col_offset=71), conversion=-1, lineno=531, col_offset=48, end_lineno=531, end_col_offset=72), Constant(value=')', lineno=531, col_offset=72, end_lineno=531, end_col_offset=73)], lineno=530, col_offset=20, end_lineno=531, end_col_offset=74)], lineno=528, col_offset=18, end_lineno=533, end_col_offset=13), lineno=528, col_offset=12, end_lineno=533, end_col_offset=13)], lineno=526, col_offset=8, end_lineno=534, end_col_offset=9), lineno=526, col_offset=8, end_lineno=534, end_col_offset=9), Return(lineno=535, col_offset=8, end_lineno=535, end_col_offset=14)], lineno=524, col_offset=4, end_lineno=535, end_col_offset=14), Assign(targets=[Name(id='problem', ctx=Store(), lineno=536, col_offset=4, end_lineno=536, end_col_offset=11)], value=Attribute(value=Name(id='summary', ctx=Load(), lineno=536, col_offset=14, end_lineno=536, end_col_offset=21), attr='problem', ctx=Load(), lineno=536, col_offset=14, end_lineno=536, end_col_offset=29), lineno=536, col_offset=4, end_lineno=536, end_col_offset=29), If(test=Compare(left=Name(id='problem', ctx=Load(), lineno=537, col_offset=7, end_lineno=537, end_col_offset=14), ops=[Is()], comparators=[Constant(value=None, lineno=537, col_offset=18, end_lineno=537, end_col_offset=22)], lineno=537, col_offset=7, end_lineno=537, end_col_offset=22), body=[Return(lineno=538, col_offset=8, end_lineno=538, end_col_offset=14)], lineno=537, col_offset=4, end_lineno=538, end_col_offset=14), Assign(targets=[Name(id='code', ctx=Store(), lineno=539, col_offset=4, end_lineno=539, end_col_offset=8)], value=IfExp(test=Attribute(value=Name(id='problem', ctx=Load(), lineno=539, col_offset=34, end_lineno=539, end_col_offset=41), attr='code', ctx=Load(), lineno=539, col_offset=34, end_lineno=539, end_col_offset=46), body=JoinedStr(values=[FormattedValue(value=Attribute(value=Name(id='problem', ctx=Load(), lineno=539, col_offset=14, end_lineno=539, end_col_offset=21), attr='code', ctx=Load(), lineno=539, col_offset=14, end_lineno=539, end_col_offset=26), conversion=-1, lineno=539, col_offset=13, end_lineno=539, end_col_offset=27), Constant(value=': ', lineno=539, col_offset=27, end_lineno=539, end_col_offset=29)], lineno=539, col_offset=11, end_lineno=539, end_col_offset=30), orelse=Constant(value='', lineno=539, col_offset=52, end_lineno=539, end_col_offset=54), lineno=539, col_offset=11, end_lineno=539, end_col_offset=54), lineno=539, col_offset=4, end_lineno=539, end_col_offset=54), Expr(value=Call(func=Attribute(value=Name(id='logger', ctx=Load(), lineno=540, col_offset=4, end_lineno=540, end_col_offset=10), attr='error', ctx=Load(), lineno=540, col_offset=4, end_lineno=540, end_col_offset=16), args=[Constant(value='cli_run_error', lineno=541, col_offset=8, end_lineno=541, end_col_offset=23)], keywords=[keyword(arg='extra', value=Dict(keys=[Constant(value='stdout_message', lineno=543, col_offset=12, end_lineno=543, end_col_offset=28), Constant(value='problem_title', lineno=546, col_offset=12, end_lineno=546, end_col_offset=27)], values=[JoinedStr(values=[FormattedValue(value=Attribute(value=Name(id='summary', ctx=Load(), lineno=544, col_offset=19, end_lineno=544, end_col_offset=26), attr='operation', ctx=Load(), lineno=544, col_offset=19, end_lineno=544, end_col_offset=36), conversion=-1, lineno=544, col_offset=18, end_lineno=544, end_col_offset=37), Constant(value=' [run=', lineno=544, col_offset=37, end_lineno=544, end_col_offset=43), FormattedValue(value=Attribute(value=Name(id='summary', ctx=Load(), lineno=544, col_offset=44, end_lineno=544, end_col_offset=51), attr='run_id', ctx=Load(), lineno=544, col_offset=44, end_lineno=544, end_col_offset=58), conversion=-1, lineno=544, col_offset=43, end_lineno=544, end_col_offset=59), Constant(value='] ❌ ', lineno=544, col_offset=59, end_lineno=544, end_col_offset=65), FormattedValue(value=Name(id='code', ctx=Load(), lineno=544, col_offset=66, end_lineno=544, end_col_offset=70), conversion=-1, lineno=544, col_offset=65, end_lineno=544, end_col_offset=71), FormattedValue(value=Attribute(value=Name(id='problem', ctx=Load(), lineno=544, col_offset=72, end_lineno=544, end_col_offset=79), attr='title', ctx=Load(), lineno=544, col_offset=72, end_lineno=544, end_col_offset=85), conversion=-1, lineno=544, col_offset=71, end_lineno=544, end_col_offset=86)], lineno=544, col_offset=16, end_lineno=544, end_col_offset=87), Attribute(value=Name(id='problem', ctx=Load(), lineno=546, col_offset=29, end_lineno=546, end_col_offset=36), attr='title', ctx=Load(), lineno=546, col_offset=29, end_lineno=546, end_col_offset=42)], lineno=542, col_offset=14, end_lineno=547, end_col_offset=9), lineno=542, col_offset=8, end_lineno=547, end_col_offset=9)], lineno=540, col_offset=4, end_lineno=548, end_col_offset=5), lineno=540, col_offset=4, end_lineno=548, end_col_offset=5)], returns=Constant(value=None, lineno=520, col_offset=5, end_lineno=520, end_col_offset=9), lineno=514, col_offset=0, end_lineno=548, end_col_offset=5), FunctionDef(name='_emit_metrics', args=arguments(args=[arg(arg='operation', annotation=Name(id='str', ctx=Load(), lineno=551, col_offset=29, end_lineno=551, end_col_offset=32), lineno=551, col_offset=18, end_lineno=551, end_col_offset=32), arg(arg='status', annotation=Name(id='CliRunStatus', ctx=Load(), lineno=551, col_offset=42, end_lineno=551, end_col_offset=54), lineno=551, col_offset=34, end_lineno=551, end_col_offset=54), arg(arg='duration_s', annotation=Name(id='float', ctx=Load(), lineno=551, col_offset=68, end_lineno=551, end_col_offset=73), lineno=551, col_offset=56, end_lineno=551, end_col_offset=73)]), body=[Expr(value=Constant(value='Emit an observation describing the CLI execution.', lineno=552, col_offset=4, end_lineno=552, end_col_offset=59), lineno=552, col_offset=4, end_lineno=552, end_col_offset=59), With(items=[withitem(context_expr=Call(func=Name(id='suppress', ctx=Load(), lineno=553, col_offset=9, end_lineno=553, end_col_offset=17), args=[Name(id='MetricEmitterError', ctx=Load(), lineno=553, col_offset=18, end_lineno=553, end_col_offset=36)], lineno=553, col_offset=9, end_lineno=553, end_col_offset=37))], body=[Expr(value=Call(func=Attribute(value=Name(id='emitter', ctx=Load(), lineno=554, col_offset=8, end_lineno=554, end_col_offset=15), attr='emit_cli_run', ctx=Load(), lineno=554, col_offset=8, end_lineno=554, end_col_offset=28), keywords=[keyword(arg='operation', value=Name(id='operation', ctx=Load(), lineno=554, col_offset=39, end_lineno=554, end_col_offset=48), lineno=554, col_offset=29, end_lineno=554, end_col_offset=48), keyword(arg='status', value=Attribute(value=Name(id='status', ctx=Load(), lineno=554, col_offset=57, end_lineno=554, end_col_offset=63), attr='value', ctx=Load(), lineno=554, col_offset=57, end_lineno=554, end_col_offset=69), lineno=554, col_offset=50, end_lineno=554, end_col_offset=69), keyword(arg='duration_s', value=Name(id='duration_s', ctx=Load(), lineno=554, col_offset=82, end_lineno=554, end_col_offset=92), lineno=554, col_offset=71, end_lineno=554, end_col_offset=92)], lineno=554, col_offset=8, end_lineno=554, end_col_offset=93), lineno=554, col_offset=8, end_lineno=554, end_col_offset=93)], lineno=553, col_offset=4, end_lineno=554, end_col_offset=93)], returns=Constant(value=None, lineno=551, col_offset=78, end_lineno=551, end_col_offset=82), lineno=551, col_offset=0, end_lineno=554, end_col_offset=93), FunctionDef(name='_handle_user_code_exception', args=arguments(args=[arg(arg='exc', annotation=Name(id='Exception', ctx=Load(), lineno=558, col_offset=9, end_lineno=558, end_col_offset=18), lineno=558, col_offset=4, end_lineno=558, end_col_offset=18)], kwonlyargs=[arg(arg='code_map', annotation=BinOp(left=Subscript(value=Name(id='Mapping', ctx=Load(), lineno=560, col_offset=14, end_lineno=560, end_col_offset=21), slice=Tuple(elts=[Subscript(value=Name(id='type', ctx=Load(), lineno=560, col_offset=22, end_lineno=560, end_col_offset=26), slice=Name(id='BaseException', ctx=Load(), lineno=560, col_offset=27, end_lineno=560, end_col_offset=40), ctx=Load(), lineno=560, col_offset=22, end_lineno=560, end_col_offset=41), Name(id='str', ctx=Load(), lineno=560, col_offset=43, end_lineno=560, end_col_offset=46)], ctx=Load(), lineno=560, col_offset=22, end_lineno=560, end_col_offset=46), ctx=Load(), lineno=560, col_offset=14, end_lineno=560, end_col_offset=47), op=BitOr(), right=Constant(value=None, lineno=560, col_offset=50, end_lineno=560, end_col_offset=54), lineno=560, col_offset=14, end_lineno=560, end_col_offset=54), lineno=560, col_offset=4, end_lineno=560, end_col_offset=54), arg(arg='operation', annotation=Name(id='str', ctx=Load(), lineno=561, col_offset=15, end_lineno=561, end_col_offset=18), lineno=561, col_offset=4, end_lineno=561, end_col_offset=18), arg(arg='run_id', annotation=Name(id='str', ctx=Load(), lineno=562, col_offset=12, end_lineno=562, end_col_offset=15), lineno=562, col_offset=4, end_lineno=562, end_col_offset=15), arg(arg='envelope', annotation=Name(id='EnvelopeBuilder', ctx=Load(), lineno=563, col_offset=14, end_lineno=563, end_col_offset=29), lineno=563, col_offset=4, end_lineno=563, end_col_offset=29)], kw_defaults=[None, None, None, None]), body=[Expr(value=Constant(value='Handle exception raised by user code.\n\n    Converts exception to Problem Details and updates envelope.\n    This helper function isolates exception handling logic to satisfy\n    BLE001 by making exception handling explicit and structured.\n\n    Parameters\n    ----------\n    exc : Exception\n        Exception raised by user code (must be one of the explicitly\n        caught exception types in cli_run).\n    code_map : Mapping[type[BaseException], str] | None\n        Optional mapping from exception types to error codes.\n    operation : str\n        Operation name for problem details.\n    run_id : str\n        Run identifier for problem details.\n    envelope : EnvelopeBuilder\n        Envelope builder to update with problem details.\n\n    Returns\n    -------\n    tuple[ProblemDetails, CliRunStatus]\n        Tuple of (problem_details, error_status).\n    ', lineno=565, col_offset=4, end_lineno=589, end_col_offset=7), lineno=565, col_offset=4, end_lineno=589, end_col_offset=7), Assign(targets=[Name(id='problem', ctx=Store(), lineno=590, col_offset=4, end_lineno=590, end_col_offset=11)], value=Call(func=Name(id='problem_from_exc', ctx=Load(), lineno=590, col_offset=14, end_lineno=590, end_col_offset=30), args=[Name(id='exc', ctx=Load(), lineno=591, col_offset=8, end_lineno=591, end_col_offset=11)], keywords=[keyword(arg='code_map', value=Name(id='code_map', ctx=Load(), lineno=592, col_offset=17, end_lineno=592, end_col_offset=25), lineno=592, col_offset=8, end_lineno=592, end_col_offset=25), keyword(arg='operation', value=Name(id='operation', ctx=Load(), lineno=593, col_offset=18, end_lineno=593, end_col_offset=27), lineno=593, col_offset=8, end_lineno=593, end_col_offset=27), keyword(arg='run_id', value=Name(id='run_id', ctx=Load(), lineno=594, col_offset=15, end_lineno=594, end_col_offset=21), lineno=594, col_offset=8, end_lineno=594, end_col_offset=21)], lineno=590, col_offset=14, end_lineno=595, end_col_offset=5), lineno=590, col_offset=4, end_lineno=595, end_col_offset=5), Expr(value=Call(func=Attribute(value=Name(id='envelope', ctx=Load(), lineno=596, col_offset=4, end_lineno=596, end_col_offset=12), attr='set_problem', ctx=Load(), lineno=596, col_offset=4, end_lineno=596, end_col_offset=24), args=[Name(id='problem', ctx=Load(), lineno=596, col_offset=25, end_lineno=596, end_col_offset=32)], lineno=596, col_offset=4, end_lineno=596, end_col_offset=33), lineno=596, col_offset=4, end_lineno=596, end_col_offset=33), Return(value=Tuple(elts=[Name(id='problem', ctx=Load(), lineno=597, col_offset=11, end_lineno=597, end_col_offset=18), Attribute(value=Name(id='CliRunStatus', ctx=Load(), lineno=597, col_offset=20, end_lineno=597, end_col_offset=32), attr='ERROR', ctx=Load(), lineno=597, col_offset=20, end_lineno=597, end_col_offset=38)], ctx=Load(), lineno=597, col_offset=11, end_lineno=597, end_col_offset=38), lineno=597, col_offset=4, end_lineno=597, end_col_offset=38)], returns=Subscript(value=Name(id='tuple', ctx=Load(), lineno=564, col_offset=5, end_lineno=564, end_col_offset=10), slice=Tuple(elts=[Name(id='ProblemDetails', ctx=Load(), lineno=564, col_offset=11, end_lineno=564, end_col_offset=25), Name(id='CliRunStatus', ctx=Load(), lineno=564, col_offset=27, end_lineno=564, end_col_offset=39)], ctx=Load(), lineno=564, col_offset=11, end_lineno=564, end_col_offset=39), ctx=Load(), lineno=564, col_offset=5, end_lineno=564, end_col_offset=40), lineno=557, col_offset=0, end_lineno=597, end_col_offset=38), FunctionDef(name='_finalize_envelope', args=arguments(args=[arg(arg='envelope', annotation=Name(id='EnvelopeBuilder', ctx=Load(), lineno=601, col_offset=14, end_lineno=601, end_col_offset=29), lineno=601, col_offset=4, end_lineno=601, end_col_offset=29)], kwonlyargs=[arg(arg='status', annotation=Name(id='CliRunStatus', ctx=Load(), lineno=603, col_offset=12, end_lineno=603, end_col_offset=24), lineno=603, col_offset=4, end_lineno=603, end_col_offset=24), arg(arg='started', annotation=Name(id='float', ctx=Load(), lineno=604, col_offset=13, end_lineno=604, end_col_offset=18), lineno=604, col_offset=4, end_lineno=604, end_col_offset=18)], kw_defaults=[None, None]), body=[Expr(value=Constant(value='Return the finalised envelope payload with duration metadata.\n\n    Parameters\n    ----------\n    envelope : EnvelopeBuilder\n        Envelope builder to finalize.\n    status : CliRunStatus\n        Final CLI run status (SUCCESS or ERROR).\n    started : float\n        Monotonic timestamp when the CLI run started.\n\n    Returns\n    -------\n    dict[str, object]\n        Envelope payload ready for persistence.\n    ', lineno=606, col_offset=4, end_lineno=621, end_col_offset=7), lineno=606, col_offset=4, end_lineno=621, end_col_offset=7), Assign(targets=[Name(id='finished_at', ctx=Store(), lineno=622, col_offset=4, end_lineno=622, end_col_offset=15)], value=Call(func=Attribute(value=Name(id='datetime', ctx=Load(), lineno=622, col_offset=18, end_lineno=622, end_col_offset=26), attr='now', ctx=Load(), lineno=622, col_offset=18, end_lineno=622, end_col_offset=30), args=[Name(id='UTC', ctx=Load(), lineno=622, col_offset=31, end_lineno=622, end_col_offset=34)], lineno=622, col_offset=18, end_lineno=622, end_col_offset=35), lineno=622, col_offset=4, end_lineno=622, end_col_offset=35), Assign(targets=[Name(id='payload', ctx=Store(), lineno=623, col_offset=4, end_lineno=623, end_col_offset=11)], value=Call(func=Attribute(value=Name(id='envelope', ctx=Load(), lineno=623, col_offset=14, end_lineno=623, end_col_offset=22), attr='finalize', ctx=Load(), lineno=623, col_offset=14, end_lineno=623, end_col_offset=31), keywords=[keyword(arg='finished_at', value=Name(id='finished_at', ctx=Load(), lineno=623, col_offset=44, end_lineno=623, end_col_offset=55), lineno=623, col_offset=32, end_lineno=623, end_col_offset=55)], lineno=623, col_offset=14, end_lineno=623, end_col_offset=56), lineno=623, col_offset=4, end_lineno=623, end_col_offset=56), Assign(targets=[Subscript(value=Name(id='payload', ctx=Load(), lineno=624, col_offset=4, end_lineno=624, end_col_offset=11), slice=Constant(value='duration_ms', lineno=624, col_offset=12, end_lineno=624, end_col_offset=25), ctx=Store(), lineno=624, col_offset=4, end_lineno=624, end_col_offset=26)], value=Call(func=Name(id='int', ctx=Load(), lineno=624, col_offset=29, end_lineno=624, end_col_offset=32), args=[BinOp(left=BinOp(left=Call(func=Attribute(value=Name(id='time', ctx=Load(), lineno=624, col_offset=34, end_lineno=624, end_col_offset=38), attr='monotonic', ctx=Load(), lineno=624, col_offset=34, end_lineno=624, end_col_offset=48), lineno=624, col_offset=34, end_lineno=624, end_col_offset=50), op=Sub(), right=Name(id='started', ctx=Load(), lineno=624, col_offset=53, end_lineno=624, end_col_offset=60), lineno=624, col_offset=34, end_lineno=624, end_col_offset=60), op=Mult(), right=Constant(value=1000, lineno=624, col_offset=64, end_lineno=624, end_col_offset=68), lineno=624, col_offset=33, end_lineno=624, end_col_offset=68)], lineno=624, col_offset=29, end_lineno=624, end_col_offset=69), lineno=624, col_offset=4, end_lineno=624, end_col_offset=69), Assign(targets=[Subscript(value=Name(id='payload', ctx=Load(), lineno=625, col_offset=4, end_lineno=625, end_col_offset=11), slice=Constant(value='status', lineno=625, col_offset=12, end_lineno=625, end_col_offset=20), ctx=Store(), lineno=625, col_offset=4, end_lineno=625, end_col_offset=21)], value=Attribute(value=Name(id='status', ctx=Load(), lineno=625, col_offset=24, end_lineno=625, end_col_offset=30), attr='value', ctx=Load(), lineno=625, col_offset=24, end_lineno=625, end_col_offset=36), lineno=625, col_offset=4, end_lineno=625, end_col_offset=36), Return(value=Name(id='payload', ctx=Load(), lineno=626, col_offset=11, end_lineno=626, end_col_offset=18), lineno=626, col_offset=4, end_lineno=626, end_col_offset=18)], returns=Subscript(value=Name(id='dict', ctx=Load(), lineno=605, col_offset=5, end_lineno=605, end_col_offset=9), slice=Tuple(elts=[Name(id='str', ctx=Load(), lineno=605, col_offset=10, end_lineno=605, end_col_offset=13), Name(id='object', ctx=Load(), lineno=605, col_offset=15, end_lineno=605, end_col_offset=21)], ctx=Load(), lineno=605, col_offset=10, end_lineno=605, end_col_offset=21), ctx=Load(), lineno=605, col_offset=5, end_lineno=605, end_col_offset=22), lineno=600, col_offset=0, end_lineno=626, end_col_offset=18), FunctionDef(name='cli_run', args=arguments(args=[arg(arg='cfg', annotation=Name(id='CliRunConfig', ctx=Load(), lineno=630, col_offset=17, end_lineno=630, end_col_offset=29), lineno=630, col_offset=12, end_lineno=630, end_col_offset=29)]), body=[Expr(value=Constant(value='Execute a CLI command inside the standardised façade.\n\n    This context manager provides a standardized execution environment for CLI\n    commands, handling logging, metrics, envelope generation, and error handling.\n    It yields a context object and envelope builder, then finalizes execution\n    metadata and optionally writes an envelope file.\n\n    Parameters\n    ----------\n    cfg : CliRunConfig\n        Immutable configuration describing the intended CLI execution, including\n        route, operation name, error handling behavior, and output formatting.\n\n    Yields\n    ------\n    (CliContext, EnvelopeBuilder)\n        Tuple containing the live :class:`CliContext` (providing runtime information\n        and logger) and the mutable :class:`EnvelopeBuilder` (for accumulating\n        execution results and metadata).\n\n    Raises\n    ------\n    SystemExit\n        Raised with exit code ``1`` when an exception occurs inside the context\n        and ``cfg.exit_on_error`` evaluates to ``True``. The original exception\n        is chained via ``raise SystemExit(1) from error`` where ``error`` is the\n        caught exception.\n    GeneratorExit\n        Re-raised immediately if raised by user code (system-level exception).\n    KeyboardInterrupt\n        Re-raised immediately if raised by user code (system-level exception).\n\n    Notes\n    -----\n    Exception Handling:\n        This context manager catches specific built-in exception types and\n        KgFoundryError explicitly to satisfy BLE001 (no blind exception catching).\n        The caught exceptions include all common Python built-in exceptions\n        (ValueError, TypeError, OSError, RuntimeError, etc.) and KgFoundryError\n        from the kgfoundry_common package.\n\n        System-level exceptions (SystemExit, KeyboardInterrupt, GeneratorExit)\n        are re-raised immediately without cleanup to allow proper system shutdown.\n\n        Custom exceptions not in the explicit list will propagate naturally.\n        The finally block ensures cleanup always executes, but error tracking\n        (problem details, status) will not occur for unlisted custom exceptions.\n\n        When ``cfg.exit_on_error`` is ``False``, caught exceptions are re-raised\n        after cleanup to preserve their original type and traceback.\n    ', lineno=631, col_offset=4, end_lineno=681, end_col_offset=7), lineno=631, col_offset=4, end_lineno=681, end_col_offset=7), Assign(targets=[Name(id='metadata', ctx=Store(), lineno=682, col_offset=4, end_lineno=682, end_col_offset=12)], value=Call(func=Name(id='_prepare_execution_metadata', ctx=Load(), lineno=682, col_offset=15, end_lineno=682, end_col_offset=42), args=[Name(id='cfg', ctx=Load(), lineno=682, col_offset=43, end_lineno=682, end_col_offset=46)], lineno=682, col_offset=15, end_lineno=682, end_col_offset=47), lineno=682, col_offset=4, end_lineno=682, end_col_offset=47), Assign(targets=[Name(id='envelope', ctx=Store(), lineno=683, col_offset=4, end_lineno=683, end_col_offset=12)], value=Call(func=Name(id='_build_envelope', ctx=Load(), lineno=683, col_offset=15, end_lineno=683, end_col_offset=30), args=[Name(id='cfg', ctx=Load(), lineno=684, col_offset=8, end_lineno=684, end_col_offset=11)], keywords=[keyword(arg='route', value=Attribute(value=Name(id='metadata', ctx=Load(), lineno=685, col_offset=14, end_lineno=685, end_col_offset=22), attr='route', ctx=Load(), lineno=685, col_offset=14, end_lineno=685, end_col_offset=28), lineno=685, col_offset=8, end_lineno=685, end_col_offset=28), keyword(arg='operation', value=Attribute(value=Name(id='metadata', ctx=Load(), lineno=686, col_offset=18, end_lineno=686, end_col_offset=26), attr='operation', ctx=Load(), lineno=686, col_offset=18, end_lineno=686, end_col_offset=36), lineno=686, col_offset=8, end_lineno=686, end_col_offset=36), keyword(arg='run_id', value=Attribute(value=Name(id='metadata', ctx=Load(), lineno=687, col_offset=15, end_lineno=687, end_col_offset=23), attr='run_id', ctx=Load(), lineno=687, col_offset=15, end_lineno=687, end_col_offset=30), lineno=687, col_offset=8, end_lineno=687, end_col_offset=30), keyword(arg='correlation_id', value=Attribute(value=Name(id='metadata', ctx=Load(), lineno=688, col_offset=23, end_lineno=688, end_col_offset=31), attr='correlation_id', ctx=Load(), lineno=688, col_offset=23, end_lineno=688, end_col_offset=46), lineno=688, col_offset=8, end_lineno=688, end_col_offset=46)], lineno=683, col_offset=15, end_lineno=689, end_col_offset=5), lineno=683, col_offset=4, end_lineno=689, end_col_offset=5), Assign(targets=[Name(id='started', ctx=Store(), lineno=690, col_offset=4, end_lineno=690, end_col_offset=11)], value=Call(func=Attribute(value=Name(id='time', ctx=Load(), lineno=690, col_offset=14, end_lineno=690, end_col_offset=18), attr='monotonic', ctx=Load(), lineno=690, col_offset=14, end_lineno=690, end_col_offset=28), lineno=690, col_offset=14, end_lineno=690, end_col_offset=30), lineno=690, col_offset=4, end_lineno=690, end_col_offset=30), Expr(value=Call(func=Attribute(value=Attribute(value=Name(id='metadata', ctx=Load(), lineno=691, col_offset=4, end_lineno=691, end_col_offset=12), attr='logger', ctx=Load(), lineno=691, col_offset=4, end_lineno=691, end_col_offset=19), attr='info', ctx=Load(), lineno=691, col_offset=4, end_lineno=691, end_col_offset=24), args=[Constant(value='cli_run_start', lineno=691, col_offset=25, end_lineno=691, end_col_offset=40)], lineno=691, col_offset=4, end_lineno=691, end_col_offset=41), lineno=691, col_offset=4, end_lineno=691, end_col_offset=41), Assign(targets=[Name(id='status', ctx=Store(), lineno=693, col_offset=4, end_lineno=693, end_col_offset=10)], value=Attribute(value=Name(id='CliRunStatus', ctx=Load(), lineno=693, col_offset=13, end_lineno=693, end_col_offset=25), attr='SUCCESS', ctx=Load(), lineno=693, col_offset=13, end_lineno=693, end_col_offset=33), lineno=693, col_offset=4, end_lineno=693, end_col_offset=33), AnnAssign(target=Name(id='problem', ctx=Store(), lineno=694, col_offset=4, end_lineno=694, end_col_offset=11), annotation=BinOp(left=Name(id='ProblemDetails', ctx=Load(), lineno=694, col_offset=13, end_lineno=694, end_col_offset=27), op=BitOr(), right=Constant(value=None, lineno=694, col_offset=30, end_lineno=694, end_col_offset=34), lineno=694, col_offset=13, end_lineno=694, end_col_offset=34), value=Constant(value=None, lineno=694, col_offset=37, end_lineno=694, end_col_offset=41), simple=1, lineno=694, col_offset=4, end_lineno=694, end_col_offset=41), AnnAssign(target=Name(id='error', ctx=Store(), lineno=695, col_offset=4, end_lineno=695, end_col_offset=9), annotation=BinOp(left=Name(id='Exception', ctx=Load(), lineno=695, col_offset=11, end_lineno=695, end_col_offset=20), op=BitOr(), right=Constant(value=None, lineno=695, col_offset=23, end_lineno=695, end_col_offset=27), lineno=695, col_offset=11, end_lineno=695, end_col_offset=27), value=Constant(value=None, lineno=695, col_offset=30, end_lineno=695, end_col_offset=34), simple=1, lineno=695, col_offset=4, end_lineno=695, end_col_offset=34), Try(body=[Assign(targets=[Name(id='context', ctx=Store(), lineno=697, col_offset=8, end_lineno=697, end_col_offset=15)], value=Call(func=Name(id='CliContext', ctx=Load(), lineno=697, col_offset=18, end_lineno=697, end_col_offset=28), keywords=[keyword(arg='command_path', value=Attribute(value=Name(id='metadata', ctx=Load(), lineno=698, col_offset=25, end_lineno=698, end_col_offset=33), attr='route', ctx=Load(), lineno=698, col_offset=25, end_lineno=698, end_col_offset=39), lineno=698, col_offset=12, end_lineno=698, end_col_offset=39), keyword(arg='operation', value=Attribute(value=Name(id='metadata', ctx=Load(), lineno=699, col_offset=22, end_lineno=699, end_col_offset=30), attr='operation', ctx=Load(), lineno=699, col_offset=22, end_lineno=699, end_col_offset=40), lineno=699, col_offset=12, end_lineno=699, end_col_offset=40), keyword(arg='run_id', value=Attribute(value=Name(id='metadata', ctx=Load(), lineno=700, col_offset=19, end_lineno=700, end_col_offset=27), attr='run_id', ctx=Load(), lineno=700, col_offset=19, end_lineno=700, end_col_offset=34), lineno=700, col_offset=12, end_lineno=700, end_col_offset=34), keyword(arg='correlation_id', value=Attribute(value=Name(id='metadata', ctx=Load(), lineno=701, col_offset=27, end_lineno=701, end_col_offset=35), attr='correlation_id', ctx=Load(), lineno=701, col_offset=27, end_lineno=701, end_col_offset=50), lineno=701, col_offset=12, end_lineno=701, end_col_offset=50), keyword(arg='started_monotonic', value=Name(id='started', ctx=Load(), lineno=702, col_offset=30, end_lineno=702, end_col_offset=37), lineno=702, col_offset=12, end_lineno=702, end_col_offset=37), keyword(arg='logger', value=Attribute(value=Name(id='metadata', ctx=Load(), lineno=703, col_offset=19, end_lineno=703, end_col_offset=27), attr='logger', ctx=Load(), lineno=703, col_offset=19, end_lineno=703, end_col_offset=34), lineno=703, col_offset=12, end_lineno=703, end_col_offset=34), keyword(arg='paths', value=Attribute(value=Name(id='metadata', ctx=Load(), lineno=704, col_offset=18, end_lineno=704, end_col_offset=26), attr='paths', ctx=Load(), lineno=704, col_offset=18, end_lineno=704, end_col_offset=32), lineno=704, col_offset=12, end_lineno=704, end_col_offset=32)], lineno=697, col_offset=18, end_lineno=705, end_col_offset=9), lineno=697, col_offset=8, end_lineno=705, end_col_offset=9), Expr(value=Yield(value=Tuple(elts=[Name(id='context', ctx=Load(), lineno=706, col_offset=14, end_lineno=706, end_col_offset=21), Name(id='envelope', ctx=Load(), lineno=706, col_offset=23, end_lineno=706, end_col_offset=31)], ctx=Load(), lineno=706, col_offset=14, end_lineno=706, end_col_offset=31), lineno=706, col_offset=8, end_lineno=706, end_col_offset=31), lineno=706, col_offset=8, end_lineno=706, end_col_offset=31)], handlers=[ExceptHandler(type=Tuple(elts=[Name(id='SystemExit', ctx=Load(), lineno=707, col_offset=12, end_lineno=707, end_col_offset=22), Name(id='KeyboardInterrupt', ctx=Load(), lineno=707, col_offset=24, end_lineno=707, end_col_offset=41), Name(id='GeneratorExit', ctx=Load(), lineno=707, col_offset=43, end_lineno=707, end_col_offset=56)], ctx=Load(), lineno=707, col_offset=11, end_lineno=707, end_col_offset=57), body=[Raise(lineno=709, col_offset=8, end_lineno=709, end_col_offset=13)], lineno=707, col_offset=4, end_lineno=709, end_col_offset=13), ExceptHandler(type=Tuple(elts=[Name(id='ValueError', ctx=Load(), lineno=711, col_offset=8, end_lineno=711, end_col_offset=18), Name(id='TypeError', ctx=Load(), lineno=712, col_offset=8, end_lineno=712, end_col_offset=17), Name(id='AttributeError', ctx=Load(), lineno=713, col_offset=8, end_lineno=713, end_col_offset=22), Name(id='KeyError', ctx=Load(), lineno=714, col_offset=8, end_lineno=714, end_col_offset=16), Name(id='IndexError', ctx=Load(), lineno=715, col_offset=8, end_lineno=715, end_col_offset=18), Name(id='FileNotFoundError', ctx=Load(), lineno=716, col_offset=8, end_lineno=716, end_col_offset=25), Name(id='PermissionError', ctx=Load(), lineno=717, col_offset=8, end_lineno=717, end_col_offset=23), Name(id='OSError', ctx=Load(), lineno=718, col_offset=8, end_lineno=718, end_col_offset=15), Name(id='RuntimeError', ctx=Load(), lineno=719, col_offset=8, end_lineno=719, end_col_offset=20), Name(id='NotImplementedError', ctx=Load(), lineno=720, col_offset=8, end_lineno=720, end_col_offset=27), Name(id='AssertionError', ctx=Load(), lineno=721, col_offset=8, end_lineno=721, end_col_offset=22), Name(id='LookupError', ctx=Load(), lineno=722, col_offset=8, end_lineno=722, end_col_offset=19), Name(id='ArithmeticError', ctx=Load(), lineno=723, col_offset=8, end_lineno=723, end_col_offset=23), Name(id='ReferenceError', ctx=Load(), lineno=724, col_offset=8, end_lineno=724, end_col_offset=22), Name(id='StopIteration', ctx=Load(), lineno=725, col_offset=8, end_lineno=725, end_col_offset=21), Name(id='StopAsyncIteration', ctx=Load(), lineno=726, col_offset=8, end_lineno=726, end_col_offset=26), Name(id='SyntaxError', ctx=Load(), lineno=727, col_offset=8, end_lineno=727, end_col_offset=19), Name(id='IndentationError', ctx=Load(), lineno=728, col_offset=8, end_lineno=728, end_col_offset=24), Name(id='TabError', ctx=Load(), lineno=729, col_offset=8, end_lineno=729, end_col_offset=16), Name(id='UnicodeError', ctx=Load(), lineno=730, col_offset=8, end_lineno=730, end_col_offset=20), Name(id='UnicodeDecodeError', ctx=Load(), lineno=731, col_offset=8, end_lineno=731, end_col_offset=26), Name(id='UnicodeEncodeError', ctx=Load(), lineno=732, col_offset=8, end_lineno=732, end_col_offset=26), Name(id='UnicodeTranslateError', ctx=Load(), lineno=733, col_offset=8, end_lineno=733, end_col_offset=29), Name(id='Warning', ctx=Load(), lineno=734, col_offset=8, end_lineno=734, end_col_offset=15), Name(id='UserWarning', ctx=Load(), lineno=735, col_offset=8, end_lineno=735, end_col_offset=19), Name(id='DeprecationWarning', ctx=Load(), lineno=736, col_offset=8, end_lineno=736, end_col_offset=26), Name(id='PendingDeprecationWarning', ctx=Load(), lineno=737, col_offset=8, end_lineno=737, end_col_offset=33), Name(id='SyntaxWarning', ctx=Load(), lineno=738, col_offset=8, end_lineno=738, end_col_offset=21), Name(id='RuntimeWarning', ctx=Load(), lineno=739, col_offset=8, end_lineno=739, end_col_offset=22), Name(id='FutureWarning', ctx=Load(), lineno=740, col_offset=8, end_lineno=740, end_col_offset=21), Name(id='ImportWarning', ctx=Load(), lineno=741, col_offset=8, end_lineno=741, end_col_offset=21), Name(id='UnicodeWarning', ctx=Load(), lineno=742, col_offset=8, end_lineno=742, end_col_offset=22), Name(id='BytesWarning', ctx=Load(), lineno=743, col_offset=8, end_lineno=743, end_col_offset=20), Name(id='ResourceWarning', ctx=Load(), lineno=744, col_offset=8, end_lineno=744, end_col_offset=23), Name(id='KgFoundryError', ctx=Load(), lineno=745, col_offset=8, end_lineno=745, end_col_offset=22)], ctx=Load(), lineno=710, col_offset=11, end_lineno=746, end_col_offset=5), name='exc', body=[Assign(targets=[Name(id='error', ctx=Store(), lineno=751, col_offset=8, end_lineno=751, end_col_offset=13)], value=Name(id='exc', ctx=Load(), lineno=751, col_offset=16, end_lineno=751, end_col_offset=19), lineno=751, col_offset=8, end_lineno=751, end_col_offset=19), Assign(targets=[Tuple(elts=[Name(id='problem', ctx=Store(), lineno=752, col_offset=8, end_lineno=752, end_col_offset=15), Name(id='status', ctx=Store(), lineno=752, col_offset=17, end_lineno=752, end_col_offset=23)], ctx=Store(), lineno=752, col_offset=8, end_lineno=752, end_col_offset=23)], value=Call(func=Name(id='_handle_user_code_exception', ctx=Load(), lineno=752, col_offset=26, end_lineno=752, end_col_offset=53), args=[Name(id='exc', ctx=Load(), lineno=753, col_offset=12, end_lineno=753, end_col_offset=15)], keywords=[keyword(arg='code_map', value=Attribute(value=Name(id='cfg', ctx=Load(), lineno=754, col_offset=21, end_lineno=754, end_col_offset=24), attr='error_code_map', ctx=Load(), lineno=754, col_offset=21, end_lineno=754, end_col_offset=39), lineno=754, col_offset=12, end_lineno=754, end_col_offset=39), keyword(arg='operation', value=Attribute(value=Name(id='metadata', ctx=Load(), lineno=755, col_offset=22, end_lineno=755, end_col_offset=30), attr='operation', ctx=Load(), lineno=755, col_offset=22, end_lineno=755, end_col_offset=40), lineno=755, col_offset=12, end_lineno=755, end_col_offset=40), keyword(arg='run_id', value=Attribute(value=Name(id='metadata', ctx=Load(), lineno=756, col_offset=19, end_lineno=756, end_col_offset=27), attr='run_id', ctx=Load(), lineno=756, col_offset=19, end_lineno=756, end_col_offset=34), lineno=756, col_offset=12, end_lineno=756, end_col_offset=34), keyword(arg='envelope', value=Name(id='envelope', ctx=Load(), lineno=757, col_offset=21, end_lineno=757, end_col_offset=29), lineno=757, col_offset=12, end_lineno=757, end_col_offset=29)], lineno=752, col_offset=26, end_lineno=758, end_col_offset=9), lineno=752, col_offset=8, end_lineno=758, end_col_offset=9)], lineno=710, col_offset=4, end_lineno=758, end_col_offset=9)], orelse=[Assign(targets=[Name(id='status', ctx=Store(), lineno=760, col_offset=8, end_lineno=760, end_col_offset=14)], value=Attribute(value=Name(id='CliRunStatus', ctx=Load(), lineno=760, col_offset=17, end_lineno=760, end_col_offset=29), attr='SUCCESS', ctx=Load(), lineno=760, col_offset=17, end_lineno=760, end_col_offset=37), lineno=760, col_offset=8, end_lineno=760, end_col_offset=37)], finalbody=[Assign(targets=[Name(id='finished', ctx=Store(), lineno=762, col_offset=8, end_lineno=762, end_col_offset=16)], value=Call(func=Attribute(value=Name(id='time', ctx=Load(), lineno=762, col_offset=19, end_lineno=762, end_col_offset=23), attr='monotonic', ctx=Load(), lineno=762, col_offset=19, end_lineno=762, end_col_offset=33), lineno=762, col_offset=19, end_lineno=762, end_col_offset=35), lineno=762, col_offset=8, end_lineno=762, end_col_offset=35), Assign(targets=[Name(id='payload', ctx=Store(), lineno=763, col_offset=8, end_lineno=763, end_col_offset=15)], value=Call(func=Name(id='_finalize_envelope', ctx=Load(), lineno=763, col_offset=18, end_lineno=763, end_col_offset=36), args=[Name(id='envelope', ctx=Load(), lineno=763, col_offset=37, end_lineno=763, end_col_offset=45)], keywords=[keyword(arg='status', value=Name(id='status', ctx=Load(), lineno=763, col_offset=54, end_lineno=763, end_col_offset=60), lineno=763, col_offset=47, end_lineno=763, end_col_offset=60), keyword(arg='started', value=Name(id='started', ctx=Load(), lineno=763, col_offset=70, end_lineno=763, end_col_offset=77), lineno=763, col_offset=62, end_lineno=763, end_col_offset=77)], lineno=763, col_offset=18, end_lineno=763, end_col_offset=78), lineno=763, col_offset=8, end_lineno=763, end_col_offset=78), Expr(value=Call(func=Name(id='_validate_envelope', ctx=Load(), lineno=764, col_offset=8, end_lineno=764, end_col_offset=26), args=[Attribute(value=Name(id='metadata', ctx=Load(), lineno=764, col_offset=27, end_lineno=764, end_col_offset=35), attr='paths', ctx=Load(), lineno=764, col_offset=27, end_lineno=764, end_col_offset=41), Name(id='payload', ctx=Load(), lineno=764, col_offset=43, end_lineno=764, end_col_offset=50), Attribute(value=Name(id='metadata', ctx=Load(), lineno=764, col_offset=52, end_lineno=764, end_col_offset=60), attr='logger', ctx=Load(), lineno=764, col_offset=52, end_lineno=764, end_col_offset=67)], lineno=764, col_offset=8, end_lineno=764, end_col_offset=68), lineno=764, col_offset=8, end_lineno=764, end_col_offset=68), Assign(targets=[Name(id='destination_dir', ctx=Store(), lineno=766, col_offset=8, end_lineno=766, end_col_offset=23)], value=BoolOp(op=Or(), values=[Attribute(value=Name(id='cfg', ctx=Load(), lineno=766, col_offset=26, end_lineno=766, end_col_offset=29), attr='envelope_dir', ctx=Load(), lineno=766, col_offset=26, end_lineno=766, end_col_offset=42), Call(func=Attribute(value=Attribute(value=Name(id='metadata', ctx=Load(), lineno=766, col_offset=46, end_lineno=766, end_col_offset=54), attr='paths', ctx=Load(), lineno=766, col_offset=46, end_lineno=766, end_col_offset=60), attr='cli_envelope_dir', ctx=Load(), lineno=766, col_offset=46, end_lineno=766, end_col_offset=77), args=[Attribute(value=Name(id='metadata', ctx=Load(), lineno=766, col_offset=78, end_lineno=766, end_col_offset=86), attr='route', ctx=Load(), lineno=766, col_offset=78, end_lineno=766, end_col_offset=92)], lineno=766, col_offset=46, end_lineno=766, end_col_offset=93)], lineno=766, col_offset=26, end_lineno=766, end_col_offset=93), lineno=766, col_offset=8, end_lineno=766, end_col_offset=93), Assign(targets=[Name(id='destination_path', ctx=Store(), lineno=767, col_offset=8, end_lineno=767, end_col_offset=24)], value=Call(func=Name(id='_envelope_path', ctx=Load(), lineno=767, col_offset=27, end_lineno=767, end_col_offset=41), args=[Name(id='destination_dir', ctx=Load(), lineno=768, col_offset=12, end_lineno=768, end_col_offset=27)], keywords=[keyword(arg='started_at', value=Call(func=Name(id='str', ctx=Load(), lineno=769, col_offset=23, end_lineno=769, end_col_offset=26), args=[Subscript(value=Name(id='payload', ctx=Load(), lineno=769, col_offset=27, end_lineno=769, end_col_offset=34), slice=Constant(value='started_at', lineno=769, col_offset=35, end_lineno=769, end_col_offset=47), ctx=Load(), lineno=769, col_offset=27, end_lineno=769, end_col_offset=48)], lineno=769, col_offset=23, end_lineno=769, end_col_offset=49), lineno=769, col_offset=12, end_lineno=769, end_col_offset=49), keyword(arg='run_id', value=Attribute(value=Name(id='metadata', ctx=Load(), lineno=770, col_offset=19, end_lineno=770, end_col_offset=27), attr='run_id', ctx=Load(), lineno=770, col_offset=19, end_lineno=770, end_col_offset=34), lineno=770, col_offset=12, end_lineno=770, end_col_offset=34)], lineno=767, col_offset=27, end_lineno=771, end_col_offset=9), lineno=767, col_offset=8, end_lineno=771, end_col_offset=9), If(test=Call(func=Name(id='_should_write_envelope', ctx=Load(), lineno=772, col_offset=11, end_lineno=772, end_col_offset=33), args=[Name(id='cfg', ctx=Load(), lineno=772, col_offset=34, end_lineno=772, end_col_offset=37), Name(id='status', ctx=Load(), lineno=772, col_offset=39, end_lineno=772, end_col_offset=45)], lineno=772, col_offset=11, end_lineno=772, end_col_offset=46), body=[Expr(value=Call(func=Attribute(value=Name(id='destination_dir', ctx=Load(), lineno=773, col_offset=12, end_lineno=773, end_col_offset=27), attr='mkdir', ctx=Load(), lineno=773, col_offset=12, end_lineno=773, end_col_offset=33), keywords=[keyword(arg='parents', value=Constant(value=True, lineno=773, col_offset=42, end_lineno=773, end_col_offset=46), lineno=773, col_offset=34, end_lineno=773, end_col_offset=46), keyword(arg='exist_ok', value=Constant(value=True, lineno=773, col_offset=57, end_lineno=773, end_col_offset=61), lineno=773, col_offset=48, end_lineno=773, end_col_offset=61)], lineno=773, col_offset=12, end_lineno=773, end_col_offset=62), lineno=773, col_offset=12, end_lineno=773, end_col_offset=62), Assign(targets=[Name(id='tmp_path', ctx=Store(), lineno=774, col_offset=12, end_lineno=774, end_col_offset=20)], value=Call(func=Attribute(value=Name(id='destination_path', ctx=Load(), lineno=774, col_offset=23, end_lineno=774, end_col_offset=39), attr='with_suffix', ctx=Load(), lineno=774, col_offset=23, end_lineno=774, end_col_offset=51), args=[Constant(value='.tmp', lineno=774, col_offset=52, end_lineno=774, end_col_offset=58)], lineno=774, col_offset=23, end_lineno=774, end_col_offset=59), lineno=774, col_offset=12, end_lineno=774, end_col_offset=59), Expr(value=Call(func=Attribute(value=Name(id='tmp_path', ctx=Load(), lineno=775, col_offset=12, end_lineno=775, end_col_offset=20), attr='write_text', ctx=Load(), lineno=775, col_offset=12, end_lineno=775, end_col_offset=31), args=[Call(func=Attribute(value=Name(id='json', ctx=Load(), lineno=775, col_offset=32, end_lineno=775, end_col_offset=36), attr='dumps', ctx=Load(), lineno=775, col_offset=32, end_lineno=775, end_col_offset=42), args=[Name(id='payload', ctx=Load(), lineno=775, col_offset=43, end_lineno=775, end_col_offset=50)], keywords=[keyword(arg='ensure_ascii', value=Constant(value=False, lineno=775, col_offset=65, end_lineno=775, end_col_offset=70), lineno=775, col_offset=52, end_lineno=775, end_col_offset=70), keyword(arg='indent', value=Constant(value=2, lineno=775, col_offset=79, end_lineno=775, end_col_offset=80), lineno=775, col_offset=72, end_lineno=775, end_col_offset=80)], lineno=775, col_offset=32, end_lineno=775, end_col_offset=81)], lineno=775, col_offset=12, end_lineno=775, end_col_offset=82), lineno=775, col_offset=12, end_lineno=775, end_col_offset=82), Expr(value=Call(func=Attribute(value=Name(id='tmp_path', ctx=Load(), lineno=776, col_offset=12, end_lineno=776, end_col_offset=20), attr='replace', ctx=Load(), lineno=776, col_offset=12, end_lineno=776, end_col_offset=28), args=[Name(id='destination_path', ctx=Load(), lineno=776, col_offset=29, end_lineno=776, end_col_offset=45)], lineno=776, col_offset=12, end_lineno=776, end_col_offset=46), lineno=776, col_offset=12, end_lineno=776, end_col_offset=46)], lineno=772, col_offset=8, end_lineno=776, end_col_offset=46), Assign(targets=[Name(id='duration_s', ctx=Store(), lineno=778, col_offset=8, end_lineno=778, end_col_offset=18)], value=BinOp(left=Name(id='finished', ctx=Load(), lineno=778, col_offset=21, end_lineno=778, end_col_offset=29), op=Sub(), right=Name(id='started', ctx=Load(), lineno=778, col_offset=32, end_lineno=778, end_col_offset=39), lineno=778, col_offset=21, end_lineno=778, end_col_offset=39), lineno=778, col_offset=8, end_lineno=778, end_col_offset=39), Expr(value=Call(func=Name(id='_emit_metrics', ctx=Load(), lineno=779, col_offset=8, end_lineno=779, end_col_offset=21), args=[Attribute(value=Name(id='metadata', ctx=Load(), lineno=779, col_offset=22, end_lineno=779, end_col_offset=30), attr='operation', ctx=Load(), lineno=779, col_offset=22, end_lineno=779, end_col_offset=40), Name(id='status', ctx=Load(), lineno=779, col_offset=42, end_lineno=779, end_col_offset=48), Name(id='duration_s', ctx=Load(), lineno=779, col_offset=50, end_lineno=779, end_col_offset=60)], lineno=779, col_offset=8, end_lineno=779, end_col_offset=61), lineno=779, col_offset=8, end_lineno=779, end_col_offset=61), Assign(targets=[Name(id='summary', ctx=Store(), lineno=780, col_offset=8, end_lineno=780, end_col_offset=15)], value=Call(func=Name(id='_RunSummary', ctx=Load(), lineno=780, col_offset=18, end_lineno=780, end_col_offset=29), keywords=[keyword(arg='operation', value=Attribute(value=Name(id='metadata', ctx=Load(), lineno=781, col_offset=22, end_lineno=781, end_col_offset=30), attr='operation', ctx=Load(), lineno=781, col_offset=22, end_lineno=781, end_col_offset=40), lineno=781, col_offset=12, end_lineno=781, end_col_offset=40), keyword(arg='run_id', value=Attribute(value=Name(id='metadata', ctx=Load(), lineno=782, col_offset=19, end_lineno=782, end_col_offset=27), attr='run_id', ctx=Load(), lineno=782, col_offset=19, end_lineno=782, end_col_offset=34), lineno=782, col_offset=12, end_lineno=782, end_col_offset=34), keyword(arg='correlation_id', value=Attribute(value=Name(id='metadata', ctx=Load(), lineno=783, col_offset=27, end_lineno=783, end_col_offset=35), attr='correlation_id', ctx=Load(), lineno=783, col_offset=27, end_lineno=783, end_col_offset=50), lineno=783, col_offset=12, end_lineno=783, end_col_offset=50), keyword(arg='duration_s', value=Name(id='duration_s', ctx=Load(), lineno=784, col_offset=23, end_lineno=784, end_col_offset=33), lineno=784, col_offset=12, end_lineno=784, end_col_offset=33), keyword(arg='problem', value=Name(id='problem', ctx=Load(), lineno=785, col_offset=20, end_lineno=785, end_col_offset=27), lineno=785, col_offset=12, end_lineno=785, end_col_offset=27)], lineno=780, col_offset=18, end_lineno=786, end_col_offset=9), lineno=780, col_offset=8, end_lineno=786, end_col_offset=9), Expr(value=Call(func=Name(id='_emit_stdout_message', ctx=Load(), lineno=787, col_offset=8, end_lineno=787, end_col_offset=28), args=[Attribute(value=Name(id='metadata', ctx=Load(), lineno=788, col_offset=12, end_lineno=788, end_col_offset=20), attr='logger', ctx=Load(), lineno=788, col_offset=12, end_lineno=788, end_col_offset=27)], keywords=[keyword(arg='status', value=Name(id='status', ctx=Load(), lineno=789, col_offset=19, end_lineno=789, end_col_offset=25), lineno=789, col_offset=12, end_lineno=789, end_col_offset=25), keyword(arg='fmt', value=Attribute(value=Name(id='cfg', ctx=Load(), lineno=790, col_offset=16, end_lineno=790, end_col_offset=19), attr='stdout_format', ctx=Load(), lineno=790, col_offset=16, end_lineno=790, end_col_offset=33), lineno=790, col_offset=12, end_lineno=790, end_col_offset=33), keyword(arg='summary', value=Name(id='summary', ctx=Load(), lineno=791, col_offset=20, end_lineno=791, end_col_offset=27), lineno=791, col_offset=12, end_lineno=791, end_col_offset=27)], lineno=787, col_offset=8, end_lineno=792, end_col_offset=9), lineno=787, col_offset=8, end_lineno=792, end_col_offset=9), Expr(value=Call(func=Attribute(value=Attribute(value=Name(id='metadata', ctx=Load(), lineno=793, col_offset=8, end_lineno=793, end_col_offset=16), attr='logger', ctx=Load(), lineno=793, col_offset=8, end_lineno=793, end_col_offset=23), attr='info', ctx=Load(), lineno=793, col_offset=8, end_lineno=793, end_col_offset=28), args=[Constant(value='cli_run_done', lineno=794, col_offset=12, end_lineno=794, end_col_offset=26)], keywords=[keyword(arg='extra', value=Dict(keys=[Constant(value='status', lineno=795, col_offset=19, end_lineno=795, end_col_offset=27), Constant(value='duration_ms', lineno=795, col_offset=43, end_lineno=795, end_col_offset=56)], values=[Attribute(value=Name(id='status', ctx=Load(), lineno=795, col_offset=29, end_lineno=795, end_col_offset=35), attr='value', ctx=Load(), lineno=795, col_offset=29, end_lineno=795, end_col_offset=41), Subscript(value=Name(id='payload', ctx=Load(), lineno=795, col_offset=58, end_lineno=795, end_col_offset=65), slice=Constant(value='duration_ms', lineno=795, col_offset=66, end_lineno=795, end_col_offset=79), ctx=Load(), lineno=795, col_offset=58, end_lineno=795, end_col_offset=80)], lineno=795, col_offset=18, end_lineno=795, end_col_offset=81), lineno=795, col_offset=12, end_lineno=795, end_col_offset=81)], lineno=793, col_offset=8, end_lineno=796, end_col_offset=9), lineno=793, col_offset=8, end_lineno=796, end_col_offset=9)], lineno=696, col_offset=4, end_lineno=796, end_col_offset=9), If(test=Compare(left=Name(id='error', ctx=Load(), lineno=798, col_offset=7, end_lineno=798, end_col_offset=12), ops=[Is()], comparators=[Constant(value=None, lineno=798, col_offset=16, end_lineno=798, end_col_offset=20)], lineno=798, col_offset=7, end_lineno=798, end_col_offset=20), body=[Return(lineno=799, col_offset=8, end_lineno=799, end_col_offset=14)], lineno=798, col_offset=4, end_lineno=799, end_col_offset=14), If(test=Attribute(value=Name(id='cfg', ctx=Load(), lineno=800, col_offset=7, end_lineno=800, end_col_offset=10), attr='exit_on_error', ctx=Load(), lineno=800, col_offset=7, end_lineno=800, end_col_offset=24), body=[Raise(exc=Call(func=Name(id='SystemExit', ctx=Load(), lineno=801, col_offset=14, end_lineno=801, end_col_offset=24), args=[Constant(value=1, lineno=801, col_offset=25, end_lineno=801, end_col_offset=26)], lineno=801, col_offset=14, end_lineno=801, end_col_offset=27), cause=Name(id='error', ctx=Load(), lineno=801, col_offset=33, end_lineno=801, end_col_offset=38), lineno=801, col_offset=8, end_lineno=801, end_col_offset=38)], lineno=800, col_offset=4, end_lineno=801, end_col_offset=38), Raise(exc=Name(id='error', ctx=Load(), lineno=805, col_offset=10, end_lineno=805, end_col_offset=15), lineno=805, col_offset=4, end_lineno=805, end_col_offset=15)], decorator_list=[Name(id='contextmanager', ctx=Load(), lineno=629, col_offset=1, end_lineno=629, end_col_offset=15)], returns=Subscript(value=Name(id='Iterator', ctx=Load(), lineno=630, col_offset=34, end_lineno=630, end_col_offset=42), slice=Subscript(value=Name(id='tuple', ctx=Load(), lineno=630, col_offset=43, end_lineno=630, end_col_offset=48), slice=Tuple(elts=[Name(id='CliContext', ctx=Load(), lineno=630, col_offset=49, end_lineno=630, end_col_offset=59), Name(id='EnvelopeBuilder', ctx=Load(), lineno=630, col_offset=61, end_lineno=630, end_col_offset=76)], ctx=Load(), lineno=630, col_offset=49, end_lineno=630, end_col_offset=76), ctx=Load(), lineno=630, col_offset=43, end_lineno=630, end_col_offset=77), ctx=Load(), lineno=630, col_offset=34, end_lineno=630, end_col_offset=78), lineno=630, col_offset=0, end_lineno=805, end_col_offset=15), Assign(targets=[Name(id='__all__', ctx=Store(), lineno=808, col_offset=0, end_lineno=808, end_col_offset=7)], value=List(elts=[Constant(value='CliContext', lineno=809, col_offset=4, end_lineno=809, end_col_offset=16), Constant(value='CliRunConfig', lineno=810, col_offset=4, end_lineno=810, end_col_offset=18), Constant(value='CliRunStatus', lineno=811, col_offset=4, end_lineno=811, end_col_offset=18), Constant(value='EnvelopeBuilder', lineno=812, col_offset=4, end_lineno=812, end_col_offset=21), Constant(value='cli_run', lineno=813, col_offset=4, end_lineno=813, end_col_offset=13), Constant(value='normalize_route', lineno=814, col_offset=4, end_lineno=814, end_col_offset=21), Constant(value='normalize_token', lineno=815, col_offset=4, end_lineno=815, end_col_offset=21), Constant(value='sha256_file', lineno=816, col_offset=4, end_lineno=816, end_col_offset=17)], ctx=Load(), lineno=808, col_offset=10, end_lineno=817, end_col_offset=1), lineno=808, col_offset=0, end_lineno=817, end_col_offset=1)])