Module(body=[Expr(value=Constant(value='Semantic search adapter using FAISS GPU and DuckDB.\n\nImplements semantic code search by embedding queries and searching\nthe FAISS index, then hydrating results from DuckDB.\n', lineno=1, col_offset=0, end_lineno=5, end_col_offset=3), lineno=1, col_offset=0, end_lineno=5, end_col_offset=3), ImportFrom(module='__future__', names=[alias(name='annotations', lineno=7, col_offset=23, end_lineno=7, end_col_offset=34)], level=0, lineno=7, col_offset=0, end_lineno=7, end_col_offset=34), Import(names=[alias(name='asyncio', lineno=9, col_offset=7, end_lineno=9, end_col_offset=14)], lineno=9, col_offset=0, end_lineno=9, end_col_offset=14), ImportFrom(module='collections.abc', names=[alias(name='Sequence', lineno=10, col_offset=28, end_lineno=10, end_col_offset=36)], level=0, lineno=10, col_offset=0, end_lineno=10, end_col_offset=36), ImportFrom(module='dataclasses', names=[alias(name='dataclass', lineno=11, col_offset=24, end_lineno=11, end_col_offset=33)], level=0, lineno=11, col_offset=0, end_lineno=11, end_col_offset=33), ImportFrom(module='pathlib', names=[alias(name='Path', lineno=12, col_offset=20, end_lineno=12, end_col_offset=24)], level=0, lineno=12, col_offset=0, end_lineno=12, end_col_offset=24), ImportFrom(module='time', names=[alias(name='perf_counter', lineno=13, col_offset=17, end_lineno=13, end_col_offset=29)], level=0, lineno=13, col_offset=0, end_lineno=13, end_col_offset=29), ImportFrom(module='typing', names=[alias(name='TYPE_CHECKING', lineno=14, col_offset=19, end_lineno=14, end_col_offset=32), alias(name='cast', lineno=14, col_offset=34, end_lineno=14, end_col_offset=38)], level=0, lineno=14, col_offset=0, end_lineno=14, end_col_offset=38), Import(names=[alias(name='httpx', lineno=16, col_offset=7, end_lineno=16, end_col_offset=12)], lineno=16, col_offset=0, end_lineno=16, end_col_offset=12), Import(names=[alias(name='numpy', asname='np', lineno=17, col_offset=7, end_lineno=17, end_col_offset=18)], lineno=17, col_offset=0, end_lineno=17, end_col_offset=18), ImportFrom(module='codeintel_rev.app.middleware', names=[alias(name='get_session_id', lineno=19, col_offset=41, end_lineno=19, end_col_offset=55)], level=0, lineno=19, col_offset=0, end_lineno=19, end_col_offset=55), ImportFrom(module='codeintel_rev.io.faiss_manager', names=[alias(name='FAISSManager', lineno=20, col_offset=43, end_lineno=20, end_col_offset=55)], level=0, lineno=20, col_offset=0, end_lineno=20, end_col_offset=55), ImportFrom(module='codeintel_rev.io.vllm_client', names=[alias(name='VLLMClient', lineno=21, col_offset=41, end_lineno=21, end_col_offset=51)], level=0, lineno=21, col_offset=0, end_lineno=21, end_col_offset=51), ImportFrom(module='codeintel_rev.mcp_server.common.observability', names=[alias(name='Observation', lineno=22, col_offset=58, end_lineno=22, end_col_offset=69), alias(name='observe_duration', lineno=22, col_offset=71, end_lineno=22, end_col_offset=87)], level=0, lineno=22, col_offset=0, end_lineno=22, end_col_offset=87), ImportFrom(module='codeintel_rev.mcp_server.schemas', names=[alias(name='AnswerEnvelope', lineno=24, col_offset=4, end_lineno=24, end_col_offset=18), alias(name='Finding', lineno=25, col_offset=4, end_lineno=25, end_col_offset=11), alias(name='MethodInfo', lineno=26, col_offset=4, end_lineno=26, end_col_offset=14), alias(name='ScopeIn', lineno=27, col_offset=4, end_lineno=27, end_col_offset=11)], level=0, lineno=23, col_offset=0, end_lineno=28, end_col_offset=1), ImportFrom(module='codeintel_rev.mcp_server.scope_utils', names=[alias(name='get_effective_scope', lineno=29, col_offset=49, end_lineno=29, end_col_offset=68)], level=0, lineno=29, col_offset=0, end_lineno=29, end_col_offset=68), ImportFrom(module='kgfoundry_common.errors', names=[alias(name='EmbeddingError', lineno=30, col_offset=36, end_lineno=30, end_col_offset=50), alias(name='VectorSearchError', lineno=30, col_offset=52, end_lineno=30, end_col_offset=69)], level=0, lineno=30, col_offset=0, end_lineno=30, end_col_offset=69), ImportFrom(module='kgfoundry_common.logging', names=[alias(name='get_logger', lineno=31, col_offset=37, end_lineno=31, end_col_offset=47)], level=0, lineno=31, col_offset=0, end_lineno=31, end_col_offset=47), If(test=Name(id='TYPE_CHECKING', ctx=Load(), lineno=33, col_offset=3, end_lineno=33, end_col_offset=16), body=[ImportFrom(module='codeintel_rev.app.config_context', names=[alias(name='ApplicationContext', lineno=34, col_offset=49, end_lineno=34, end_col_offset=67)], level=0, lineno=34, col_offset=4, end_lineno=34, end_col_offset=67)], lineno=33, col_offset=0, end_lineno=34, end_col_offset=67), Assign(targets=[Name(id='SNIPPET_PREVIEW_CHARS', ctx=Store(), lineno=36, col_offset=0, end_lineno=36, end_col_offset=21)], value=Constant(value=500, lineno=36, col_offset=24, end_lineno=36, end_col_offset=27), lineno=36, col_offset=0, end_lineno=36, end_col_offset=27), Assign(targets=[Name(id='COMPONENT_NAME', ctx=Store(), lineno=37, col_offset=0, end_lineno=37, end_col_offset=14)], value=Constant(value='codeintel_mcp', lineno=37, col_offset=17, end_lineno=37, end_col_offset=32), lineno=37, col_offset=0, end_lineno=37, end_col_offset=32), Assign(targets=[Name(id='LOGGER', ctx=Store(), lineno=38, col_offset=0, end_lineno=38, end_col_offset=6)], value=Call(func=Name(id='get_logger', ctx=Load(), lineno=38, col_offset=9, end_lineno=38, end_col_offset=19), args=[Name(id='__name__', ctx=Load(), lineno=38, col_offset=20, end_lineno=38, end_col_offset=28)], lineno=38, col_offset=9, end_lineno=38, end_col_offset=29), lineno=38, col_offset=0, end_lineno=38, end_col_offset=29), ClassDef(name='_ScopeFilterFlags', body=[Expr(value=Constant(value='Aggregated boolean flags describing the active scope filters.', lineno=43, col_offset=4, end_lineno=43, end_col_offset=71), lineno=43, col_offset=4, end_lineno=43, end_col_offset=71), AnnAssign(target=Name(id='has_include_globs', ctx=Store(), lineno=45, col_offset=4, end_lineno=45, end_col_offset=21), annotation=Name(id='bool', ctx=Load(), lineno=45, col_offset=23, end_lineno=45, end_col_offset=27), simple=1, lineno=45, col_offset=4, end_lineno=45, end_col_offset=27), AnnAssign(target=Name(id='has_exclude_globs', ctx=Store(), lineno=46, col_offset=4, end_lineno=46, end_col_offset=21), annotation=Name(id='bool', ctx=Load(), lineno=46, col_offset=23, end_lineno=46, end_col_offset=27), simple=1, lineno=46, col_offset=4, end_lineno=46, end_col_offset=27), AnnAssign(target=Name(id='has_languages', ctx=Store(), lineno=47, col_offset=4, end_lineno=47, end_col_offset=17), annotation=Name(id='bool', ctx=Load(), lineno=47, col_offset=19, end_lineno=47, end_col_offset=23), simple=1, lineno=47, col_offset=4, end_lineno=47, end_col_offset=23), FunctionDef(name='from_scope', args=arguments(args=[arg(arg='cls', lineno=50, col_offset=19, end_lineno=50, end_col_offset=22), arg(arg='scope', annotation=BinOp(left=Name(id='ScopeIn', ctx=Load(), lineno=50, col_offset=31, end_lineno=50, end_col_offset=38), op=BitOr(), right=Constant(value=None, lineno=50, col_offset=41, end_lineno=50, end_col_offset=45), lineno=50, col_offset=31, end_lineno=50, end_col_offset=45), lineno=50, col_offset=24, end_lineno=50, end_col_offset=45)]), body=[Expr(value=Constant(value='Create flags from an optional ``ScopeIn`` dictionary.\n\n        Parameters\n        ----------\n        scope : ScopeIn | None\n            Optional scope dictionary containing include_globs, exclude_globs,\n            or languages keys.\n\n        Returns\n        -------\n        _ScopeFilterFlags\n            Flags instance indicating which scope filters are present.\n        ', lineno=51, col_offset=8, end_lineno=63, end_col_offset=11), lineno=51, col_offset=8, end_lineno=63, end_col_offset=11), Return(value=Call(func=Name(id='cls', ctx=Load(), lineno=64, col_offset=15, end_lineno=64, end_col_offset=18), keywords=[keyword(arg='has_include_globs', value=Call(func=Name(id='bool', ctx=Load(), lineno=65, col_offset=30, end_lineno=65, end_col_offset=34), args=[BoolOp(op=And(), values=[Name(id='scope', ctx=Load(), lineno=65, col_offset=35, end_lineno=65, end_col_offset=40), Call(func=Attribute(value=Name(id='scope', ctx=Load(), lineno=65, col_offset=45, end_lineno=65, end_col_offset=50), attr='get', ctx=Load(), lineno=65, col_offset=45, end_lineno=65, end_col_offset=54), args=[Constant(value='include_globs', lineno=65, col_offset=55, end_lineno=65, end_col_offset=70)], lineno=65, col_offset=45, end_lineno=65, end_col_offset=71)], lineno=65, col_offset=35, end_lineno=65, end_col_offset=71)], lineno=65, col_offset=30, end_lineno=65, end_col_offset=72), lineno=65, col_offset=12, end_lineno=65, end_col_offset=72), keyword(arg='has_exclude_globs', value=Call(func=Name(id='bool', ctx=Load(), lineno=66, col_offset=30, end_lineno=66, end_col_offset=34), args=[BoolOp(op=And(), values=[Name(id='scope', ctx=Load(), lineno=66, col_offset=35, end_lineno=66, end_col_offset=40), Call(func=Attribute(value=Name(id='scope', ctx=Load(), lineno=66, col_offset=45, end_lineno=66, end_col_offset=50), attr='get', ctx=Load(), lineno=66, col_offset=45, end_lineno=66, end_col_offset=54), args=[Constant(value='exclude_globs', lineno=66, col_offset=55, end_lineno=66, end_col_offset=70)], lineno=66, col_offset=45, end_lineno=66, end_col_offset=71)], lineno=66, col_offset=35, end_lineno=66, end_col_offset=71)], lineno=66, col_offset=30, end_lineno=66, end_col_offset=72), lineno=66, col_offset=12, end_lineno=66, end_col_offset=72), keyword(arg='has_languages', value=Call(func=Name(id='bool', ctx=Load(), lineno=67, col_offset=26, end_lineno=67, end_col_offset=30), args=[BoolOp(op=And(), values=[Name(id='scope', ctx=Load(), lineno=67, col_offset=31, end_lineno=67, end_col_offset=36), Call(func=Attribute(value=Name(id='scope', ctx=Load(), lineno=67, col_offset=41, end_lineno=67, end_col_offset=46), attr='get', ctx=Load(), lineno=67, col_offset=41, end_lineno=67, end_col_offset=50), args=[Constant(value='languages', lineno=67, col_offset=51, end_lineno=67, end_col_offset=62)], lineno=67, col_offset=41, end_lineno=67, end_col_offset=63)], lineno=67, col_offset=31, end_lineno=67, end_col_offset=63)], lineno=67, col_offset=26, end_lineno=67, end_col_offset=64), lineno=67, col_offset=12, end_lineno=67, end_col_offset=64)], lineno=64, col_offset=15, end_lineno=68, end_col_offset=9), lineno=64, col_offset=8, end_lineno=68, end_col_offset=9)], decorator_list=[Name(id='classmethod', ctx=Load(), lineno=49, col_offset=5, end_lineno=49, end_col_offset=16)], returns=Name(id='_ScopeFilterFlags', ctx=Load(), lineno=50, col_offset=50, end_lineno=50, end_col_offset=67), lineno=50, col_offset=4, end_lineno=68, end_col_offset=9), FunctionDef(name='has_filters', args=arguments(args=[arg(arg='self', lineno=71, col_offset=20, end_lineno=71, end_col_offset=24)]), body=[Expr(value=Constant(value='Return ``True`` when any of the scope filters are active.', lineno=72, col_offset=8, end_lineno=72, end_col_offset=71), lineno=72, col_offset=8, end_lineno=72, end_col_offset=71), Return(value=BoolOp(op=Or(), values=[Attribute(value=Name(id='self', ctx=Load(), lineno=73, col_offset=15, end_lineno=73, end_col_offset=19), attr='has_include_globs', ctx=Load(), lineno=73, col_offset=15, end_lineno=73, end_col_offset=37), Attribute(value=Name(id='self', ctx=Load(), lineno=73, col_offset=41, end_lineno=73, end_col_offset=45), attr='has_exclude_globs', ctx=Load(), lineno=73, col_offset=41, end_lineno=73, end_col_offset=63), Attribute(value=Name(id='self', ctx=Load(), lineno=73, col_offset=67, end_lineno=73, end_col_offset=71), attr='has_languages', ctx=Load(), lineno=73, col_offset=67, end_lineno=73, end_col_offset=85)], lineno=73, col_offset=15, end_lineno=73, end_col_offset=85), lineno=73, col_offset=8, end_lineno=73, end_col_offset=85)], decorator_list=[Name(id='property', ctx=Load(), lineno=70, col_offset=5, end_lineno=70, end_col_offset=13)], returns=Name(id='bool', ctx=Load(), lineno=71, col_offset=29, end_lineno=71, end_col_offset=33), lineno=71, col_offset=4, end_lineno=73, end_col_offset=85)], decorator_list=[Call(func=Name(id='dataclass', ctx=Load(), lineno=41, col_offset=1, end_lineno=41, end_col_offset=10), keywords=[keyword(arg='frozen', value=Constant(value=True, lineno=41, col_offset=18, end_lineno=41, end_col_offset=22), lineno=41, col_offset=11, end_lineno=41, end_col_offset=22)], lineno=41, col_offset=1, end_lineno=41, end_col_offset=23)], lineno=42, col_offset=0, end_lineno=73, end_col_offset=85), ClassDef(name='_FaissFanout', body=[Expr(value=Constant(value='FAISS fan-out plan produced for a semantic search request.', lineno=78, col_offset=4, end_lineno=78, end_col_offset=68), lineno=78, col_offset=4, end_lineno=78, end_col_offset=68), AnnAssign(target=Name(id='faiss_k', ctx=Store(), lineno=80, col_offset=4, end_lineno=80, end_col_offset=11), annotation=Name(id='int', ctx=Load(), lineno=80, col_offset=13, end_lineno=80, end_col_offset=16), simple=1, lineno=80, col_offset=4, end_lineno=80, end_col_offset=16), AnnAssign(target=Name(id='faiss_k_target', ctx=Store(), lineno=81, col_offset=4, end_lineno=81, end_col_offset=18), annotation=Name(id='int', ctx=Load(), lineno=81, col_offset=20, end_lineno=81, end_col_offset=23), simple=1, lineno=81, col_offset=4, end_lineno=81, end_col_offset=23)], decorator_list=[Call(func=Name(id='dataclass', ctx=Load(), lineno=76, col_offset=1, end_lineno=76, end_col_offset=10), keywords=[keyword(arg='frozen', value=Constant(value=True, lineno=76, col_offset=18, end_lineno=76, end_col_offset=22), lineno=76, col_offset=11, end_lineno=76, end_col_offset=22)], lineno=76, col_offset=1, end_lineno=76, end_col_offset=23)], lineno=77, col_offset=0, end_lineno=81, end_col_offset=23), ClassDef(name='_HybridSearchState', body=[Expr(value=Constant(value='Encapsulate the outputs of FAISS prior to hybrid re-ranking.', lineno=86, col_offset=4, end_lineno=86, end_col_offset=70), lineno=86, col_offset=4, end_lineno=86, end_col_offset=70), AnnAssign(target=Name(id='query', ctx=Store(), lineno=88, col_offset=4, end_lineno=88, end_col_offset=9), annotation=Name(id='str', ctx=Load(), lineno=88, col_offset=11, end_lineno=88, end_col_offset=14), simple=1, lineno=88, col_offset=4, end_lineno=88, end_col_offset=14), AnnAssign(target=Name(id='result_ids', ctx=Store(), lineno=89, col_offset=4, end_lineno=89, end_col_offset=14), annotation=Subscript(value=Name(id='Sequence', ctx=Load(), lineno=89, col_offset=16, end_lineno=89, end_col_offset=24), slice=Name(id='int', ctx=Load(), lineno=89, col_offset=25, end_lineno=89, end_col_offset=28), ctx=Load(), lineno=89, col_offset=16, end_lineno=89, end_col_offset=29), simple=1, lineno=89, col_offset=4, end_lineno=89, end_col_offset=29), AnnAssign(target=Name(id='result_scores', ctx=Store(), lineno=90, col_offset=4, end_lineno=90, end_col_offset=17), annotation=Subscript(value=Name(id='Sequence', ctx=Load(), lineno=90, col_offset=19, end_lineno=90, end_col_offset=27), slice=Name(id='float', ctx=Load(), lineno=90, col_offset=28, end_lineno=90, end_col_offset=33), ctx=Load(), lineno=90, col_offset=19, end_lineno=90, end_col_offset=34), simple=1, lineno=90, col_offset=4, end_lineno=90, end_col_offset=34), AnnAssign(target=Name(id='effective_limit', ctx=Store(), lineno=91, col_offset=4, end_lineno=91, end_col_offset=19), annotation=Name(id='int', ctx=Load(), lineno=91, col_offset=21, end_lineno=91, end_col_offset=24), simple=1, lineno=91, col_offset=4, end_lineno=91, end_col_offset=24)], decorator_list=[Call(func=Name(id='dataclass', ctx=Load(), lineno=84, col_offset=1, end_lineno=84, end_col_offset=10), keywords=[keyword(arg='frozen', value=Constant(value=True, lineno=84, col_offset=18, end_lineno=84, end_col_offset=22), lineno=84, col_offset=11, end_lineno=84, end_col_offset=22)], lineno=84, col_offset=1, end_lineno=84, end_col_offset=23)], lineno=85, col_offset=0, end_lineno=91, end_col_offset=24), ClassDef(name='_HybridResult', body=[Expr(value=Constant(value='Hydration payload returned after hybrid re-ranking.', lineno=96, col_offset=4, end_lineno=96, end_col_offset=61), lineno=96, col_offset=4, end_lineno=96, end_col_offset=61), AnnAssign(target=Name(id='hydration_ids', ctx=Store(), lineno=98, col_offset=4, end_lineno=98, end_col_offset=17), annotation=Subscript(value=Name(id='list', ctx=Load(), lineno=98, col_offset=19, end_lineno=98, end_col_offset=23), slice=Name(id='int', ctx=Load(), lineno=98, col_offset=24, end_lineno=98, end_col_offset=27), ctx=Load(), lineno=98, col_offset=19, end_lineno=98, end_col_offset=28), simple=1, lineno=98, col_offset=4, end_lineno=98, end_col_offset=28), AnnAssign(target=Name(id='hydration_scores', ctx=Store(), lineno=99, col_offset=4, end_lineno=99, end_col_offset=20), annotation=Subscript(value=Name(id='list', ctx=Load(), lineno=99, col_offset=22, end_lineno=99, end_col_offset=26), slice=Name(id='float', ctx=Load(), lineno=99, col_offset=27, end_lineno=99, end_col_offset=32), ctx=Load(), lineno=99, col_offset=22, end_lineno=99, end_col_offset=33), simple=1, lineno=99, col_offset=4, end_lineno=99, end_col_offset=33), AnnAssign(target=Name(id='contribution_map', ctx=Store(), lineno=100, col_offset=4, end_lineno=100, end_col_offset=20), annotation=BinOp(left=Subscript(value=Name(id='dict', ctx=Load(), lineno=100, col_offset=22, end_lineno=100, end_col_offset=26), slice=Tuple(elts=[Name(id='int', ctx=Load(), lineno=100, col_offset=27, end_lineno=100, end_col_offset=30), Subscript(value=Name(id='list', ctx=Load(), lineno=100, col_offset=32, end_lineno=100, end_col_offset=36), slice=Subscript(value=Name(id='tuple', ctx=Load(), lineno=100, col_offset=37, end_lineno=100, end_col_offset=42), slice=Tuple(elts=[Name(id='str', ctx=Load(), lineno=100, col_offset=43, end_lineno=100, end_col_offset=46), Name(id='int', ctx=Load(), lineno=100, col_offset=48, end_lineno=100, end_col_offset=51), Name(id='float', ctx=Load(), lineno=100, col_offset=53, end_lineno=100, end_col_offset=58)], ctx=Load(), lineno=100, col_offset=43, end_lineno=100, end_col_offset=58), ctx=Load(), lineno=100, col_offset=37, end_lineno=100, end_col_offset=59), ctx=Load(), lineno=100, col_offset=32, end_lineno=100, end_col_offset=60)], ctx=Load(), lineno=100, col_offset=27, end_lineno=100, end_col_offset=60), ctx=Load(), lineno=100, col_offset=22, end_lineno=100, end_col_offset=61), op=BitOr(), right=Constant(value=None, lineno=100, col_offset=64, end_lineno=100, end_col_offset=68), lineno=100, col_offset=22, end_lineno=100, end_col_offset=68), simple=1, lineno=100, col_offset=4, end_lineno=100, end_col_offset=68), AnnAssign(target=Name(id='retrieval_channels', ctx=Store(), lineno=101, col_offset=4, end_lineno=101, end_col_offset=22), annotation=Subscript(value=Name(id='list', ctx=Load(), lineno=101, col_offset=24, end_lineno=101, end_col_offset=28), slice=Name(id='str', ctx=Load(), lineno=101, col_offset=29, end_lineno=101, end_col_offset=32), ctx=Load(), lineno=101, col_offset=24, end_lineno=101, end_col_offset=33), simple=1, lineno=101, col_offset=4, end_lineno=101, end_col_offset=33)], decorator_list=[Call(func=Name(id='dataclass', ctx=Load(), lineno=94, col_offset=1, end_lineno=94, end_col_offset=10), keywords=[keyword(arg='frozen', value=Constant(value=True, lineno=94, col_offset=18, end_lineno=94, end_col_offset=22), lineno=94, col_offset=11, end_lineno=94, end_col_offset=22)], lineno=94, col_offset=1, end_lineno=94, end_col_offset=23)], lineno=95, col_offset=0, end_lineno=101, end_col_offset=33), ClassDef(name='_SearchBudget', body=[Expr(value=Constant(value='Typed representation of the effective limit and metadata.', lineno=106, col_offset=4, end_lineno=106, end_col_offset=67), lineno=106, col_offset=4, end_lineno=106, end_col_offset=67), AnnAssign(target=Name(id='effective_limit', ctx=Store(), lineno=108, col_offset=4, end_lineno=108, end_col_offset=19), annotation=Name(id='int', ctx=Load(), lineno=108, col_offset=21, end_lineno=108, end_col_offset=24), simple=1, lineno=108, col_offset=4, end_lineno=108, end_col_offset=24), AnnAssign(target=Name(id='max_results', ctx=Store(), lineno=109, col_offset=4, end_lineno=109, end_col_offset=15), annotation=Name(id='int', ctx=Load(), lineno=109, col_offset=17, end_lineno=109, end_col_offset=20), simple=1, lineno=109, col_offset=4, end_lineno=109, end_col_offset=20), AnnAssign(target=Name(id='limits_metadata', ctx=Store(), lineno=110, col_offset=4, end_lineno=110, end_col_offset=19), annotation=Subscript(value=Name(id='tuple', ctx=Load(), lineno=110, col_offset=21, end_lineno=110, end_col_offset=26), slice=Tuple(elts=[Name(id='str', ctx=Load(), lineno=110, col_offset=27, end_lineno=110, end_col_offset=30), Constant(value=Ellipsis, lineno=110, col_offset=32, end_lineno=110, end_col_offset=35)], ctx=Load(), lineno=110, col_offset=27, end_lineno=110, end_col_offset=35), ctx=Load(), lineno=110, col_offset=21, end_lineno=110, end_col_offset=36), simple=1, lineno=110, col_offset=4, end_lineno=110, end_col_offset=36)], decorator_list=[Call(func=Name(id='dataclass', ctx=Load(), lineno=104, col_offset=1, end_lineno=104, end_col_offset=10), keywords=[keyword(arg='frozen', value=Constant(value=True, lineno=104, col_offset=18, end_lineno=104, end_col_offset=22), lineno=104, col_offset=11, end_lineno=104, end_col_offset=22)], lineno=104, col_offset=1, end_lineno=104, end_col_offset=23)], lineno=105, col_offset=0, end_lineno=110, end_col_offset=36), ClassDef(name='_MethodContext', body=[Expr(value=Constant(value='Inputs required to build method metadata.', lineno=115, col_offset=4, end_lineno=115, end_col_offset=51), lineno=115, col_offset=4, end_lineno=115, end_col_offset=51), AnnAssign(target=Name(id='findings_count', ctx=Store(), lineno=117, col_offset=4, end_lineno=117, end_col_offset=18), annotation=Name(id='int', ctx=Load(), lineno=117, col_offset=20, end_lineno=117, end_col_offset=23), simple=1, lineno=117, col_offset=4, end_lineno=117, end_col_offset=23), AnnAssign(target=Name(id='requested_limit', ctx=Store(), lineno=118, col_offset=4, end_lineno=118, end_col_offset=19), annotation=Name(id='int', ctx=Load(), lineno=118, col_offset=21, end_lineno=118, end_col_offset=24), simple=1, lineno=118, col_offset=4, end_lineno=118, end_col_offset=24), AnnAssign(target=Name(id='effective_limit', ctx=Store(), lineno=119, col_offset=4, end_lineno=119, end_col_offset=19), annotation=Name(id='int', ctx=Load(), lineno=119, col_offset=21, end_lineno=119, end_col_offset=24), simple=1, lineno=119, col_offset=4, end_lineno=119, end_col_offset=24), AnnAssign(target=Name(id='start_time', ctx=Store(), lineno=120, col_offset=4, end_lineno=120, end_col_offset=14), annotation=Name(id='float', ctx=Load(), lineno=120, col_offset=16, end_lineno=120, end_col_offset=21), simple=1, lineno=120, col_offset=4, end_lineno=120, end_col_offset=21), AnnAssign(target=Name(id='retrieval_channels', ctx=Store(), lineno=121, col_offset=4, end_lineno=121, end_col_offset=22), annotation=Subscript(value=Name(id='Sequence', ctx=Load(), lineno=121, col_offset=24, end_lineno=121, end_col_offset=32), slice=Name(id='str', ctx=Load(), lineno=121, col_offset=33, end_lineno=121, end_col_offset=36), ctx=Load(), lineno=121, col_offset=24, end_lineno=121, end_col_offset=37), simple=1, lineno=121, col_offset=4, end_lineno=121, end_col_offset=37)], decorator_list=[Call(func=Name(id='dataclass', ctx=Load(), lineno=113, col_offset=1, end_lineno=113, end_col_offset=10), keywords=[keyword(arg='frozen', value=Constant(value=True, lineno=113, col_offset=18, end_lineno=113, end_col_offset=22), lineno=113, col_offset=11, end_lineno=113, end_col_offset=22)], lineno=113, col_offset=1, end_lineno=113, end_col_offset=23)], lineno=114, col_offset=0, end_lineno=121, end_col_offset=37), AsyncFunctionDef(name='semantic_search', args=arguments(args=[arg(arg='context', annotation=Name(id='ApplicationContext', ctx=Load(), lineno=125, col_offset=13, end_lineno=125, end_col_offset=31), lineno=125, col_offset=4, end_lineno=125, end_col_offset=31), arg(arg='query', annotation=Name(id='str', ctx=Load(), lineno=125, col_offset=40, end_lineno=125, end_col_offset=43), lineno=125, col_offset=33, end_lineno=125, end_col_offset=43), arg(arg='limit', annotation=Name(id='int', ctx=Load(), lineno=125, col_offset=52, end_lineno=125, end_col_offset=55), lineno=125, col_offset=45, end_lineno=125, end_col_offset=55)], defaults=[Constant(value=20, lineno=125, col_offset=58, end_lineno=125, end_col_offset=60)]), body=[Expr(value=Constant(value='Perform semantic search using embeddings.\n\n    Applies session scope filters during DuckDB hydration (if scope has path/language\n    constraints). FAISS search is performed without scope constraints (FAISS has no\n    built-in filtering), then results are filtered via DuckDB catalog queries.\n\n    Parameters\n    ----------\n    context : ApplicationContext\n        Application context containing FAISS manager, vLLM client, and settings.\n    query : str\n        Search query text.\n    limit : int, optional\n        Maximum number of results to return. Defaults to 20.\n\n    Returns\n    -------\n    AnswerEnvelope\n        Semantic search response payload with findings and applied scope.\n\n    Notes\n    -----\n    This function delegates to ``_semantic_search_sync`` which may raise\n    ``VectorSearchError`` or ``EmbeddingError``. Those exceptions are not\n    explicitly caught or re-raised by this async wrapper function.\n\n    Examples\n    --------\n    Basic usage:\n\n    >>> result = await semantic_search(context, "data processing")\n    >>> isinstance(result["findings"], list)\n    True\n\n    With session scope:\n\n    >>> set_scope(context, {"languages": ["python"], "include_globs": ["src/**"]})\n    >>> result = await semantic_search(context, "data processing")\n    >>> # Returns only Python chunks from src/ directory\n    >>> result["scope"]["languages"]\n    [\'python\']\n\n    Notes\n    -----\n    Scope Integration:\n    - Session scope is retrieved from registry using session ID (set by middleware).\n    - FAISS search is performed without scope constraints (FAISS has no built-in filtering).\n    - Chunk IDs from FAISS are filtered via DuckDB catalog using scope\'s `include_globs`,\n      `exclude_globs`, and `languages` (see `query_by_filters` method).\n    - Applied scope is included in response envelope (`scope` field) for transparency.\n    - If no scope is set, searches all indexed chunks without filtering.\n    ', lineno=127, col_offset=4, end_lineno=178, end_col_offset=7), lineno=127, col_offset=4, end_lineno=178, end_col_offset=7), Assign(targets=[Name(id='session_id', ctx=Store(), lineno=179, col_offset=4, end_lineno=179, end_col_offset=14)], value=Call(func=Name(id='get_session_id', ctx=Load(), lineno=179, col_offset=17, end_lineno=179, end_col_offset=31), lineno=179, col_offset=17, end_lineno=179, end_col_offset=33), lineno=179, col_offset=4, end_lineno=179, end_col_offset=33), Assign(targets=[Name(id='scope', ctx=Store(), lineno=180, col_offset=4, end_lineno=180, end_col_offset=9)], value=Await(value=Call(func=Name(id='get_effective_scope', ctx=Load(), lineno=180, col_offset=18, end_lineno=180, end_col_offset=37), args=[Name(id='context', ctx=Load(), lineno=180, col_offset=38, end_lineno=180, end_col_offset=45), Name(id='session_id', ctx=Load(), lineno=180, col_offset=47, end_lineno=180, end_col_offset=57)], lineno=180, col_offset=18, end_lineno=180, end_col_offset=58), lineno=180, col_offset=12, end_lineno=180, end_col_offset=58), lineno=180, col_offset=4, end_lineno=180, end_col_offset=58), Return(value=Await(value=Call(func=Attribute(value=Name(id='asyncio', ctx=Load(), lineno=181, col_offset=17, end_lineno=181, end_col_offset=24), attr='to_thread', ctx=Load(), lineno=181, col_offset=17, end_lineno=181, end_col_offset=34), args=[Name(id='_semantic_search_sync', ctx=Load(), lineno=182, col_offset=8, end_lineno=182, end_col_offset=29), Name(id='context', ctx=Load(), lineno=183, col_offset=8, end_lineno=183, end_col_offset=15), Name(id='query', ctx=Load(), lineno=184, col_offset=8, end_lineno=184, end_col_offset=13), Name(id='limit', ctx=Load(), lineno=185, col_offset=8, end_lineno=185, end_col_offset=13), Name(id='session_id', ctx=Load(), lineno=186, col_offset=8, end_lineno=186, end_col_offset=18), Name(id='scope', ctx=Load(), lineno=187, col_offset=8, end_lineno=187, end_col_offset=13)], lineno=181, col_offset=17, end_lineno=188, end_col_offset=5), lineno=181, col_offset=11, end_lineno=188, end_col_offset=5), lineno=181, col_offset=4, end_lineno=188, end_col_offset=5)], returns=Name(id='AnswerEnvelope', ctx=Load(), lineno=126, col_offset=5, end_lineno=126, end_col_offset=19), lineno=124, col_offset=0, end_lineno=188, end_col_offset=5), FunctionDef(name='_semantic_search_sync', args=arguments(args=[arg(arg='context', annotation=Name(id='ApplicationContext', ctx=Load(), lineno=192, col_offset=13, end_lineno=192, end_col_offset=31), lineno=192, col_offset=4, end_lineno=192, end_col_offset=31), arg(arg='query', annotation=Name(id='str', ctx=Load(), lineno=193, col_offset=11, end_lineno=193, end_col_offset=14), lineno=193, col_offset=4, end_lineno=193, end_col_offset=14), arg(arg='limit', annotation=Name(id='int', ctx=Load(), lineno=194, col_offset=11, end_lineno=194, end_col_offset=14), lineno=194, col_offset=4, end_lineno=194, end_col_offset=14), arg(arg='session_id', annotation=Name(id='str', ctx=Load(), lineno=195, col_offset=16, end_lineno=195, end_col_offset=19), lineno=195, col_offset=4, end_lineno=195, end_col_offset=19), arg(arg='scope', annotation=BinOp(left=Name(id='ScopeIn', ctx=Load(), lineno=196, col_offset=11, end_lineno=196, end_col_offset=18), op=BitOr(), right=Constant(value=None, lineno=196, col_offset=21, end_lineno=196, end_col_offset=25), lineno=196, col_offset=11, end_lineno=196, end_col_offset=25), lineno=196, col_offset=4, end_lineno=196, end_col_offset=25)]), body=[Assign(targets=[Name(id='start_time', ctx=Store(), lineno=198, col_offset=4, end_lineno=198, end_col_offset=14)], value=Call(func=Name(id='perf_counter', ctx=Load(), lineno=198, col_offset=17, end_lineno=198, end_col_offset=29), lineno=198, col_offset=17, end_lineno=198, end_col_offset=31), lineno=198, col_offset=4, end_lineno=198, end_col_offset=31), With(items=[withitem(context_expr=Call(func=Name(id='observe_duration', ctx=Load(), lineno=199, col_offset=9, end_lineno=199, end_col_offset=25), args=[Constant(value='semantic_search', lineno=199, col_offset=26, end_lineno=199, end_col_offset=43), Name(id='COMPONENT_NAME', ctx=Load(), lineno=199, col_offset=45, end_lineno=199, end_col_offset=59)], lineno=199, col_offset=9, end_lineno=199, end_col_offset=60), optional_vars=Name(id='observation', ctx=Store(), lineno=199, col_offset=64, end_lineno=199, end_col_offset=75))], body=[Assign(targets=[Name(id='scope_flags', ctx=Store(), lineno=200, col_offset=8, end_lineno=200, end_col_offset=19)], value=Call(func=Attribute(value=Name(id='_ScopeFilterFlags', ctx=Load(), lineno=200, col_offset=22, end_lineno=200, end_col_offset=39), attr='from_scope', ctx=Load(), lineno=200, col_offset=22, end_lineno=200, end_col_offset=50), args=[Name(id='scope', ctx=Load(), lineno=200, col_offset=51, end_lineno=200, end_col_offset=56)], lineno=200, col_offset=22, end_lineno=200, end_col_offset=57), lineno=200, col_offset=8, end_lineno=200, end_col_offset=57), Expr(value=Call(func=Attribute(value=Name(id='LOGGER', ctx=Load(), lineno=202, col_offset=8, end_lineno=202, end_col_offset=14), attr='debug', ctx=Load(), lineno=202, col_offset=8, end_lineno=202, end_col_offset=20), args=[Constant(value='Semantic search with scope', lineno=203, col_offset=12, end_lineno=203, end_col_offset=40)], keywords=[keyword(arg='extra', value=Dict(keys=[Constant(value='session_id', lineno=205, col_offset=16, end_lineno=205, end_col_offset=28), Constant(value='query', lineno=206, col_offset=16, end_lineno=206, end_col_offset=23), Constant(value='has_scope', lineno=207, col_offset=16, end_lineno=207, end_col_offset=27), Constant(value='scope_languages', lineno=208, col_offset=16, end_lineno=208, end_col_offset=33), Constant(value='scope_include_globs', lineno=211, col_offset=16, end_lineno=211, end_col_offset=37)], values=[Name(id='session_id', ctx=Load(), lineno=205, col_offset=30, end_lineno=205, end_col_offset=40), Name(id='query', ctx=Load(), lineno=206, col_offset=25, end_lineno=206, end_col_offset=30), Compare(left=Name(id='scope', ctx=Load(), lineno=207, col_offset=29, end_lineno=207, end_col_offset=34), ops=[IsNot()], comparators=[Constant(value=None, lineno=207, col_offset=42, end_lineno=207, end_col_offset=46)], lineno=207, col_offset=29, end_lineno=207, end_col_offset=46), IfExp(test=Name(id='scope', ctx=Load(), lineno=209, col_offset=76, end_lineno=209, end_col_offset=81), body=Call(func=Name(id='cast', ctx=Load(), lineno=209, col_offset=20, end_lineno=209, end_col_offset=24), args=[Constant(value='Sequence[str] | None', lineno=209, col_offset=25, end_lineno=209, end_col_offset=47), Call(func=Attribute(value=Name(id='scope', ctx=Load(), lineno=209, col_offset=49, end_lineno=209, end_col_offset=54), attr='get', ctx=Load(), lineno=209, col_offset=49, end_lineno=209, end_col_offset=58), args=[Constant(value='languages', lineno=209, col_offset=59, end_lineno=209, end_col_offset=70)], lineno=209, col_offset=49, end_lineno=209, end_col_offset=71)], lineno=209, col_offset=20, end_lineno=209, end_col_offset=72), orelse=Constant(value=None, lineno=209, col_offset=87, end_lineno=209, end_col_offset=91), lineno=209, col_offset=20, end_lineno=209, end_col_offset=91), IfExp(test=Name(id='scope', ctx=Load(), lineno=211, col_offset=69, end_lineno=211, end_col_offset=74), body=Call(func=Attribute(value=Name(id='scope', ctx=Load(), lineno=211, col_offset=39, end_lineno=211, end_col_offset=44), attr='get', ctx=Load(), lineno=211, col_offset=39, end_lineno=211, end_col_offset=48), args=[Constant(value='include_globs', lineno=211, col_offset=49, end_lineno=211, end_col_offset=64)], lineno=211, col_offset=39, end_lineno=211, end_col_offset=65), orelse=Constant(value=None, lineno=211, col_offset=80, end_lineno=211, end_col_offset=84), lineno=211, col_offset=39, end_lineno=211, end_col_offset=84)], lineno=204, col_offset=18, end_lineno=212, end_col_offset=13), lineno=204, col_offset=12, end_lineno=212, end_col_offset=13)], lineno=202, col_offset=8, end_lineno=213, end_col_offset=9), lineno=202, col_offset=8, end_lineno=213, end_col_offset=9), Assign(targets=[Name(id='budget', ctx=Store(), lineno=215, col_offset=8, end_lineno=215, end_col_offset=14)], value=Call(func=Name(id='_build_search_budget', ctx=Load(), lineno=215, col_offset=17, end_lineno=215, end_col_offset=37), args=[Name(id='context', ctx=Load(), lineno=215, col_offset=38, end_lineno=215, end_col_offset=45), Name(id='limit', ctx=Load(), lineno=215, col_offset=47, end_lineno=215, end_col_offset=52), Name(id='observation', ctx=Load(), lineno=215, col_offset=54, end_lineno=215, end_col_offset=65)], lineno=215, col_offset=17, end_lineno=215, end_col_offset=66), lineno=215, col_offset=8, end_lineno=215, end_col_offset=66), Assign(targets=[Name(id='limits_metadata', ctx=Store(), lineno=216, col_offset=8, end_lineno=216, end_col_offset=23)], value=List(elts=[Starred(value=Attribute(value=Name(id='budget', ctx=Load(), lineno=216, col_offset=28, end_lineno=216, end_col_offset=34), attr='limits_metadata', ctx=Load(), lineno=216, col_offset=28, end_lineno=216, end_col_offset=50), ctx=Load(), lineno=216, col_offset=27, end_lineno=216, end_col_offset=50)], ctx=Load(), lineno=216, col_offset=26, end_lineno=216, end_col_offset=51), lineno=216, col_offset=8, end_lineno=216, end_col_offset=51), Assign(targets=[Name(id='multiplier', ctx=Store(), lineno=218, col_offset=8, end_lineno=218, end_col_offset=18)], value=Call(func=Name(id='max', ctx=Load(), lineno=218, col_offset=21, end_lineno=218, end_col_offset=24), args=[Constant(value=1, lineno=218, col_offset=25, end_lineno=218, end_col_offset=26), Attribute(value=Attribute(value=Attribute(value=Name(id='context', ctx=Load(), lineno=218, col_offset=28, end_lineno=218, end_col_offset=35), attr='settings', ctx=Load(), lineno=218, col_offset=28, end_lineno=218, end_col_offset=44), attr='limits', ctx=Load(), lineno=218, col_offset=28, end_lineno=218, end_col_offset=51), attr='semantic_overfetch_multiplier', ctx=Load(), lineno=218, col_offset=28, end_lineno=218, end_col_offset=81)], lineno=218, col_offset=21, end_lineno=218, end_col_offset=82), lineno=218, col_offset=8, end_lineno=218, end_col_offset=82), Assign(targets=[Name(id='fanout', ctx=Store(), lineno=219, col_offset=8, end_lineno=219, end_col_offset=14)], value=Call(func=Name(id='_calculate_faiss_fanout', ctx=Load(), lineno=219, col_offset=17, end_lineno=219, end_col_offset=40), args=[Attribute(value=Name(id='budget', ctx=Load(), lineno=220, col_offset=12, end_lineno=220, end_col_offset=18), attr='effective_limit', ctx=Load(), lineno=220, col_offset=12, end_lineno=220, end_col_offset=34), Attribute(value=Name(id='budget', ctx=Load(), lineno=221, col_offset=12, end_lineno=221, end_col_offset=18), attr='max_results', ctx=Load(), lineno=221, col_offset=12, end_lineno=221, end_col_offset=30), Name(id='multiplier', ctx=Load(), lineno=222, col_offset=12, end_lineno=222, end_col_offset=22), Name(id='scope_flags', ctx=Load(), lineno=223, col_offset=12, end_lineno=223, end_col_offset=23)], lineno=219, col_offset=17, end_lineno=224, end_col_offset=9), lineno=219, col_offset=8, end_lineno=224, end_col_offset=9), If(test=Compare(left=Attribute(value=Name(id='fanout', ctx=Load(), lineno=225, col_offset=11, end_lineno=225, end_col_offset=17), attr='faiss_k', ctx=Load(), lineno=225, col_offset=11, end_lineno=225, end_col_offset=25), ops=[Lt()], comparators=[Attribute(value=Name(id='fanout', ctx=Load(), lineno=225, col_offset=28, end_lineno=225, end_col_offset=34), attr='faiss_k_target', ctx=Load(), lineno=225, col_offset=28, end_lineno=225, end_col_offset=49)], lineno=225, col_offset=11, end_lineno=225, end_col_offset=49), body=[Expr(value=Call(func=Attribute(value=Name(id='limits_metadata', ctx=Load(), lineno=226, col_offset=12, end_lineno=226, end_col_offset=27), attr='append', ctx=Load(), lineno=226, col_offset=12, end_lineno=226, end_col_offset=34), args=[JoinedStr(values=[Constant(value='FAISS fan-out clamped to ', lineno=227, col_offset=18, end_lineno=227, end_col_offset=43), FormattedValue(value=Attribute(value=Name(id='fanout', ctx=Load(), lineno=227, col_offset=44, end_lineno=227, end_col_offset=50), attr='faiss_k', ctx=Load(), lineno=227, col_offset=44, end_lineno=227, end_col_offset=58), conversion=-1, lineno=227, col_offset=43, end_lineno=227, end_col_offset=59), Constant(value=' (max_results=', lineno=227, col_offset=59, end_lineno=227, end_col_offset=73), FormattedValue(value=Attribute(value=Name(id='budget', ctx=Load(), lineno=227, col_offset=74, end_lineno=227, end_col_offset=80), attr='max_results', ctx=Load(), lineno=227, col_offset=74, end_lineno=227, end_col_offset=92), conversion=-1, lineno=227, col_offset=73, end_lineno=227, end_col_offset=93), Constant(value=').', lineno=227, col_offset=93, end_lineno=227, end_col_offset=95)], lineno=227, col_offset=16, end_lineno=227, end_col_offset=96)], lineno=226, col_offset=12, end_lineno=228, end_col_offset=13), lineno=226, col_offset=12, end_lineno=228, end_col_offset=13)], lineno=225, col_offset=8, end_lineno=228, end_col_offset=13), Expr(value=Call(func=Attribute(value=Name(id='LOGGER', ctx=Load(), lineno=230, col_offset=8, end_lineno=230, end_col_offset=14), attr='debug', ctx=Load(), lineno=230, col_offset=8, end_lineno=230, end_col_offset=20), args=[Constant(value='Computed FAISS fan-out', lineno=231, col_offset=12, end_lineno=231, end_col_offset=36)], keywords=[keyword(arg='extra', value=Dict(keys=[Constant(value='requested_limit', lineno=233, col_offset=16, end_lineno=233, end_col_offset=33), Constant(value='effective_limit', lineno=234, col_offset=16, end_lineno=234, end_col_offset=33), Constant(value='faiss_k', lineno=235, col_offset=16, end_lineno=235, end_col_offset=25), Constant(value='faiss_k_target', lineno=236, col_offset=16, end_lineno=236, end_col_offset=32), Constant(value='multiplier', lineno=237, col_offset=16, end_lineno=237, end_col_offset=28), Constant(value='has_scope_filters', lineno=238, col_offset=16, end_lineno=238, end_col_offset=35), Constant(value='has_include_globs', lineno=239, col_offset=16, end_lineno=239, end_col_offset=35), Constant(value='has_exclude_globs', lineno=240, col_offset=16, end_lineno=240, end_col_offset=35), Constant(value='has_languages', lineno=241, col_offset=16, end_lineno=241, end_col_offset=31)], values=[Name(id='limit', ctx=Load(), lineno=233, col_offset=35, end_lineno=233, end_col_offset=40), Attribute(value=Name(id='budget', ctx=Load(), lineno=234, col_offset=35, end_lineno=234, end_col_offset=41), attr='effective_limit', ctx=Load(), lineno=234, col_offset=35, end_lineno=234, end_col_offset=57), Attribute(value=Name(id='fanout', ctx=Load(), lineno=235, col_offset=27, end_lineno=235, end_col_offset=33), attr='faiss_k', ctx=Load(), lineno=235, col_offset=27, end_lineno=235, end_col_offset=41), Attribute(value=Name(id='fanout', ctx=Load(), lineno=236, col_offset=34, end_lineno=236, end_col_offset=40), attr='faiss_k_target', ctx=Load(), lineno=236, col_offset=34, end_lineno=236, end_col_offset=55), Name(id='multiplier', ctx=Load(), lineno=237, col_offset=30, end_lineno=237, end_col_offset=40), Attribute(value=Name(id='scope_flags', ctx=Load(), lineno=238, col_offset=37, end_lineno=238, end_col_offset=48), attr='has_filters', ctx=Load(), lineno=238, col_offset=37, end_lineno=238, end_col_offset=60), Attribute(value=Name(id='scope_flags', ctx=Load(), lineno=239, col_offset=37, end_lineno=239, end_col_offset=48), attr='has_include_globs', ctx=Load(), lineno=239, col_offset=37, end_lineno=239, end_col_offset=66), Attribute(value=Name(id='scope_flags', ctx=Load(), lineno=240, col_offset=37, end_lineno=240, end_col_offset=48), attr='has_exclude_globs', ctx=Load(), lineno=240, col_offset=37, end_lineno=240, end_col_offset=66), Attribute(value=Name(id='scope_flags', ctx=Load(), lineno=241, col_offset=33, end_lineno=241, end_col_offset=44), attr='has_languages', ctx=Load(), lineno=241, col_offset=33, end_lineno=241, end_col_offset=58)], lineno=232, col_offset=18, end_lineno=242, end_col_offset=13), lineno=232, col_offset=12, end_lineno=242, end_col_offset=13)], lineno=230, col_offset=8, end_lineno=243, end_col_offset=9), lineno=230, col_offset=8, end_lineno=243, end_col_offset=9), Assign(targets=[Tuple(elts=[Name(id='result_ids', ctx=Store(), lineno=245, col_offset=8, end_lineno=245, end_col_offset=18), Name(id='result_scores', ctx=Store(), lineno=245, col_offset=20, end_lineno=245, end_col_offset=33)], ctx=Store(), lineno=245, col_offset=8, end_lineno=245, end_col_offset=33)], value=Call(func=Name(id='_run_faiss_search_or_raise', ctx=Load(), lineno=245, col_offset=36, end_lineno=245, end_col_offset=62), args=[Name(id='context', ctx=Load(), lineno=246, col_offset=12, end_lineno=246, end_col_offset=19), Call(func=Name(id='_embed_query_or_raise', ctx=Load(), lineno=247, col_offset=12, end_lineno=247, end_col_offset=33), args=[Attribute(value=Name(id='context', ctx=Load(), lineno=248, col_offset=16, end_lineno=248, end_col_offset=23), attr='vllm_client', ctx=Load(), lineno=248, col_offset=16, end_lineno=248, end_col_offset=35), Name(id='query', ctx=Load(), lineno=249, col_offset=16, end_lineno=249, end_col_offset=21), Name(id='observation', ctx=Load(), lineno=250, col_offset=16, end_lineno=250, end_col_offset=27), Attribute(value=Attribute(value=Attribute(value=Name(id='context', ctx=Load(), lineno=251, col_offset=16, end_lineno=251, end_col_offset=23), attr='settings', ctx=Load(), lineno=251, col_offset=16, end_lineno=251, end_col_offset=32), attr='vllm', ctx=Load(), lineno=251, col_offset=16, end_lineno=251, end_col_offset=37), attr='base_url', ctx=Load(), lineno=251, col_offset=16, end_lineno=251, end_col_offset=46)], lineno=247, col_offset=12, end_lineno=252, end_col_offset=13), Attribute(value=Name(id='fanout', ctx=Load(), lineno=253, col_offset=12, end_lineno=253, end_col_offset=18), attr='faiss_k', ctx=Load(), lineno=253, col_offset=12, end_lineno=253, end_col_offset=26), Attribute(value=Attribute(value=Attribute(value=Name(id='context', ctx=Load(), lineno=254, col_offset=12, end_lineno=254, end_col_offset=19), attr='settings', ctx=Load(), lineno=254, col_offset=12, end_lineno=254, end_col_offset=28), attr='index', ctx=Load(), lineno=254, col_offset=12, end_lineno=254, end_col_offset=34), attr='faiss_nprobe', ctx=Load(), lineno=254, col_offset=12, end_lineno=254, end_col_offset=47), Name(id='observation', ctx=Load(), lineno=255, col_offset=12, end_lineno=255, end_col_offset=23)], lineno=245, col_offset=36, end_lineno=256, end_col_offset=9), lineno=245, col_offset=8, end_lineno=256, end_col_offset=9), Assign(targets=[Name(id='hybrid_result', ctx=Store(), lineno=258, col_offset=8, end_lineno=258, end_col_offset=21)], value=Call(func=Name(id='_resolve_hybrid_results', ctx=Load(), lineno=258, col_offset=24, end_lineno=258, end_col_offset=47), args=[Name(id='context', ctx=Load(), lineno=259, col_offset=12, end_lineno=259, end_col_offset=19), Call(func=Name(id='_HybridSearchState', ctx=Load(), lineno=260, col_offset=12, end_lineno=260, end_col_offset=30), args=[Name(id='query', ctx=Load(), lineno=260, col_offset=31, end_lineno=260, end_col_offset=36), Name(id='result_ids', ctx=Load(), lineno=260, col_offset=38, end_lineno=260, end_col_offset=48), Name(id='result_scores', ctx=Load(), lineno=260, col_offset=50, end_lineno=260, end_col_offset=63), Attribute(value=Name(id='budget', ctx=Load(), lineno=260, col_offset=65, end_lineno=260, end_col_offset=71), attr='effective_limit', ctx=Load(), lineno=260, col_offset=65, end_lineno=260, end_col_offset=87)], lineno=260, col_offset=12, end_lineno=260, end_col_offset=88), Name(id='limits_metadata', ctx=Load(), lineno=261, col_offset=12, end_lineno=261, end_col_offset=27), Tuple(elts=[Constant(value='semantic', lineno=262, col_offset=13, end_lineno=262, end_col_offset=23), Constant(value='faiss', lineno=262, col_offset=25, end_lineno=262, end_col_offset=32)], ctx=Load(), lineno=262, col_offset=12, end_lineno=262, end_col_offset=33)], lineno=258, col_offset=24, end_lineno=263, end_col_offset=9), lineno=258, col_offset=8, end_lineno=263, end_col_offset=9), Assign(targets=[Tuple(elts=[Name(id='findings', ctx=Store(), lineno=265, col_offset=8, end_lineno=265, end_col_offset=16), Name(id='hydrate_exc', ctx=Store(), lineno=265, col_offset=18, end_lineno=265, end_col_offset=29)], ctx=Store(), lineno=265, col_offset=8, end_lineno=265, end_col_offset=29)], value=Call(func=Name(id='_hydrate_findings', ctx=Load(), lineno=265, col_offset=32, end_lineno=265, end_col_offset=49), args=[Name(id='context', ctx=Load(), lineno=266, col_offset=12, end_lineno=266, end_col_offset=19), Attribute(value=Name(id='hybrid_result', ctx=Load(), lineno=267, col_offset=12, end_lineno=267, end_col_offset=25), attr='hydration_ids', ctx=Load(), lineno=267, col_offset=12, end_lineno=267, end_col_offset=39), Attribute(value=Name(id='hybrid_result', ctx=Load(), lineno=268, col_offset=12, end_lineno=268, end_col_offset=25), attr='hydration_scores', ctx=Load(), lineno=268, col_offset=12, end_lineno=268, end_col_offset=42)], keywords=[keyword(arg='scope', value=Name(id='scope', ctx=Load(), lineno=269, col_offset=18, end_lineno=269, end_col_offset=23), lineno=269, col_offset=12, end_lineno=269, end_col_offset=23)], lineno=265, col_offset=32, end_lineno=270, end_col_offset=9), lineno=265, col_offset=8, end_lineno=270, end_col_offset=9), Expr(value=Call(func=Name(id='_ensure_hydration_success', ctx=Load(), lineno=271, col_offset=8, end_lineno=271, end_col_offset=33), args=[Name(id='hydrate_exc', ctx=Load(), lineno=271, col_offset=34, end_lineno=271, end_col_offset=45), Name(id='observation', ctx=Load(), lineno=271, col_offset=47, end_lineno=271, end_col_offset=58), Name(id='context', ctx=Load(), lineno=271, col_offset=60, end_lineno=271, end_col_offset=67)], lineno=271, col_offset=8, end_lineno=271, end_col_offset=68), lineno=271, col_offset=8, end_lineno=271, end_col_offset=68), Expr(value=Call(func=Attribute(value=Name(id='observation', ctx=Load(), lineno=273, col_offset=8, end_lineno=273, end_col_offset=19), attr='mark_success', ctx=Load(), lineno=273, col_offset=8, end_lineno=273, end_col_offset=32), lineno=273, col_offset=8, end_lineno=273, end_col_offset=34), lineno=273, col_offset=8, end_lineno=273, end_col_offset=34), Expr(value=Call(func=Name(id='_warn_scope_filter_reduction', ctx=Load(), lineno=275, col_offset=8, end_lineno=275, end_col_offset=36), args=[Name(id='scope', ctx=Load(), lineno=276, col_offset=12, end_lineno=276, end_col_offset=17), Name(id='scope_flags', ctx=Load(), lineno=277, col_offset=12, end_lineno=277, end_col_offset=23), Call(func=Name(id='len', ctx=Load(), lineno=278, col_offset=12, end_lineno=278, end_col_offset=15), args=[Name(id='findings', ctx=Load(), lineno=278, col_offset=16, end_lineno=278, end_col_offset=24)], lineno=278, col_offset=12, end_lineno=278, end_col_offset=25), Attribute(value=Name(id='budget', ctx=Load(), lineno=279, col_offset=12, end_lineno=279, end_col_offset=18), attr='effective_limit', ctx=Load(), lineno=279, col_offset=12, end_lineno=279, end_col_offset=34), Call(func=Name(id='len', ctx=Load(), lineno=280, col_offset=12, end_lineno=280, end_col_offset=15), args=[Name(id='result_ids', ctx=Load(), lineno=280, col_offset=16, end_lineno=280, end_col_offset=26)], lineno=280, col_offset=12, end_lineno=280, end_col_offset=27)], lineno=275, col_offset=8, end_lineno=281, end_col_offset=9), lineno=275, col_offset=8, end_lineno=281, end_col_offset=9), Expr(value=Call(func=Name(id='_annotate_hybrid_contributions', ctx=Load(), lineno=282, col_offset=8, end_lineno=282, end_col_offset=38), args=[Name(id='findings', ctx=Load(), lineno=283, col_offset=12, end_lineno=283, end_col_offset=20), Attribute(value=Name(id='hybrid_result', ctx=Load(), lineno=284, col_offset=12, end_lineno=284, end_col_offset=25), attr='contribution_map', ctx=Load(), lineno=284, col_offset=12, end_lineno=284, end_col_offset=42), Attribute(value=Attribute(value=Attribute(value=Name(id='context', ctx=Load(), lineno=285, col_offset=12, end_lineno=285, end_col_offset=19), attr='settings', ctx=Load(), lineno=285, col_offset=12, end_lineno=285, end_col_offset=28), attr='index', ctx=Load(), lineno=285, col_offset=12, end_lineno=285, end_col_offset=34), attr='rrf_k', ctx=Load(), lineno=285, col_offset=12, end_lineno=285, end_col_offset=40)], lineno=282, col_offset=8, end_lineno=286, end_col_offset=9), lineno=282, col_offset=8, end_lineno=286, end_col_offset=9), Assign(targets=[Name(id='extras', ctx=Store(), lineno=288, col_offset=8, end_lineno=288, end_col_offset=14)], value=Call(func=Name(id='_build_response_extras', ctx=Load(), lineno=288, col_offset=17, end_lineno=288, end_col_offset=39), args=[Call(func=Name(id='_MethodContext', ctx=Load(), lineno=289, col_offset=12, end_lineno=289, end_col_offset=26), args=[Call(func=Name(id='len', ctx=Load(), lineno=290, col_offset=16, end_lineno=290, end_col_offset=19), args=[Name(id='findings', ctx=Load(), lineno=290, col_offset=20, end_lineno=290, end_col_offset=28)], lineno=290, col_offset=16, end_lineno=290, end_col_offset=29), Name(id='limit', ctx=Load(), lineno=291, col_offset=16, end_lineno=291, end_col_offset=21), Attribute(value=Name(id='budget', ctx=Load(), lineno=292, col_offset=16, end_lineno=292, end_col_offset=22), attr='effective_limit', ctx=Load(), lineno=292, col_offset=16, end_lineno=292, end_col_offset=38), Name(id='start_time', ctx=Load(), lineno=293, col_offset=16, end_lineno=293, end_col_offset=26), Attribute(value=Name(id='hybrid_result', ctx=Load(), lineno=294, col_offset=16, end_lineno=294, end_col_offset=29), attr='retrieval_channels', ctx=Load(), lineno=294, col_offset=16, end_lineno=294, end_col_offset=48)], lineno=289, col_offset=12, end_lineno=295, end_col_offset=13), Name(id='limits_metadata', ctx=Load(), lineno=296, col_offset=12, end_lineno=296, end_col_offset=27), Name(id='scope', ctx=Load(), lineno=297, col_offset=12, end_lineno=297, end_col_offset=17)], lineno=288, col_offset=17, end_lineno=298, end_col_offset=9), lineno=288, col_offset=8, end_lineno=298, end_col_offset=9), Assign(targets=[Name(id='answer_message', ctx=Store(), lineno=300, col_offset=8, end_lineno=300, end_col_offset=22)], value=IfExp(test=Call(func=Name(id='any', ctx=Load(), lineno=302, col_offset=15, end_lineno=302, end_col_offset=18), args=[GeneratorExp(elt=Compare(left=Name(id='channel', ctx=Load(), lineno=302, col_offset=19, end_lineno=302, end_col_offset=26), ops=[In()], comparators=[Set(elts=[Constant(value='bm25', lineno=302, col_offset=31, end_lineno=302, end_col_offset=37), Constant(value='splade', lineno=302, col_offset=39, end_lineno=302, end_col_offset=47)], lineno=302, col_offset=30, end_lineno=302, end_col_offset=48)], lineno=302, col_offset=19, end_lineno=302, end_col_offset=48), generators=[comprehension(target=Name(id='channel', ctx=Store(), lineno=302, col_offset=53, end_lineno=302, end_col_offset=60), iter=Attribute(value=Name(id='hybrid_result', ctx=Load(), lineno=302, col_offset=64, end_lineno=302, end_col_offset=77), attr='retrieval_channels', ctx=Load(), lineno=302, col_offset=64, end_lineno=302, end_col_offset=96), is_async=0)], lineno=302, col_offset=18, end_lineno=302, end_col_offset=97)], lineno=302, col_offset=15, end_lineno=302, end_col_offset=97), body=JoinedStr(values=[Constant(value='Found ', lineno=301, col_offset=14, end_lineno=301, end_col_offset=20), FormattedValue(value=Call(func=Name(id='len', ctx=Load(), lineno=301, col_offset=21, end_lineno=301, end_col_offset=24), args=[Name(id='findings', ctx=Load(), lineno=301, col_offset=25, end_lineno=301, end_col_offset=33)], lineno=301, col_offset=21, end_lineno=301, end_col_offset=34), conversion=-1, lineno=301, col_offset=20, end_lineno=301, end_col_offset=35), Constant(value=' hybrid results for: ', lineno=301, col_offset=35, end_lineno=301, end_col_offset=56), FormattedValue(value=Name(id='query', ctx=Load(), lineno=301, col_offset=57, end_lineno=301, end_col_offset=62), conversion=-1, lineno=301, col_offset=56, end_lineno=301, end_col_offset=63)], lineno=301, col_offset=12, end_lineno=301, end_col_offset=64), orelse=JoinedStr(values=[Constant(value='Found ', lineno=303, col_offset=19, end_lineno=303, end_col_offset=25), FormattedValue(value=Call(func=Name(id='len', ctx=Load(), lineno=303, col_offset=26, end_lineno=303, end_col_offset=29), args=[Name(id='findings', ctx=Load(), lineno=303, col_offset=30, end_lineno=303, end_col_offset=38)], lineno=303, col_offset=26, end_lineno=303, end_col_offset=39), conversion=-1, lineno=303, col_offset=25, end_lineno=303, end_col_offset=40), Constant(value=' semantically similar code chunks for: ', lineno=303, col_offset=40, end_lineno=303, end_col_offset=79), FormattedValue(value=Name(id='query', ctx=Load(), lineno=303, col_offset=80, end_lineno=303, end_col_offset=85), conversion=-1, lineno=303, col_offset=79, end_lineno=303, end_col_offset=86)], lineno=303, col_offset=17, end_lineno=303, end_col_offset=87), lineno=301, col_offset=12, end_lineno=303, end_col_offset=87), lineno=300, col_offset=8, end_lineno=304, end_col_offset=9), Return(value=Call(func=Name(id='_make_envelope', ctx=Load(), lineno=306, col_offset=15, end_lineno=306, end_col_offset=29), keywords=[keyword(arg='findings', value=Name(id='findings', ctx=Load(), lineno=307, col_offset=21, end_lineno=307, end_col_offset=29), lineno=307, col_offset=12, end_lineno=307, end_col_offset=29), keyword(arg='answer', value=Name(id='answer_message', ctx=Load(), lineno=308, col_offset=19, end_lineno=308, end_col_offset=33), lineno=308, col_offset=12, end_lineno=308, end_col_offset=33), keyword(arg='confidence', value=IfExp(test=Name(id='findings', ctx=Load(), lineno=309, col_offset=31, end_lineno=309, end_col_offset=39), body=Constant(value=0.85, lineno=309, col_offset=23, end_lineno=309, end_col_offset=27), orelse=Constant(value=0.0, lineno=309, col_offset=45, end_lineno=309, end_col_offset=48), lineno=309, col_offset=23, end_lineno=309, end_col_offset=48), lineno=309, col_offset=12, end_lineno=309, end_col_offset=48), keyword(arg='extras', value=Name(id='extras', ctx=Load(), lineno=310, col_offset=19, end_lineno=310, end_col_offset=25), lineno=310, col_offset=12, end_lineno=310, end_col_offset=25)], lineno=306, col_offset=15, end_lineno=311, end_col_offset=9), lineno=306, col_offset=8, end_lineno=311, end_col_offset=9)], lineno=199, col_offset=4, end_lineno=311, end_col_offset=9)], returns=Name(id='AnswerEnvelope', ctx=Load(), lineno=197, col_offset=5, end_lineno=197, end_col_offset=19), lineno=191, col_offset=0, end_lineno=311, end_col_offset=9), FunctionDef(name='_clamp_result_limit', args=arguments(args=[arg(arg='requested_limit', annotation=Name(id='int', ctx=Load(), lineno=314, col_offset=41, end_lineno=314, end_col_offset=44), lineno=314, col_offset=24, end_lineno=314, end_col_offset=44), arg(arg='max_results', annotation=Name(id='int', ctx=Load(), lineno=314, col_offset=59, end_lineno=314, end_col_offset=62), lineno=314, col_offset=46, end_lineno=314, end_col_offset=62)]), body=[Expr(value=Constant(value='Enforce bounds on requested limit with explanatory metadata.\n\n    Parameters\n    ----------\n    requested_limit : int\n        Client supplied limit from the API call.\n    max_results : int\n        Globally configured maximum number of results.\n\n    Returns\n    -------\n    tuple[int, list[str]]\n        Adjusted limit and zero or more informational messages describing why\n        truncation occurred.\n    ', lineno=315, col_offset=4, end_lineno=329, end_col_offset=7), lineno=315, col_offset=4, end_lineno=329, end_col_offset=7), AnnAssign(target=Name(id='messages', ctx=Store(), lineno=330, col_offset=4, end_lineno=330, end_col_offset=12), annotation=Subscript(value=Name(id='list', ctx=Load(), lineno=330, col_offset=14, end_lineno=330, end_col_offset=18), slice=Name(id='str', ctx=Load(), lineno=330, col_offset=19, end_lineno=330, end_col_offset=22), ctx=Load(), lineno=330, col_offset=14, end_lineno=330, end_col_offset=23), value=List(ctx=Load(), lineno=330, col_offset=26, end_lineno=330, end_col_offset=28), simple=1, lineno=330, col_offset=4, end_lineno=330, end_col_offset=28), If(test=Compare(left=Name(id='requested_limit', ctx=Load(), lineno=331, col_offset=7, end_lineno=331, end_col_offset=22), ops=[LtE()], comparators=[Constant(value=0, lineno=331, col_offset=26, end_lineno=331, end_col_offset=27)], lineno=331, col_offset=7, end_lineno=331, end_col_offset=27), body=[Expr(value=Call(func=Attribute(value=Name(id='messages', ctx=Load(), lineno=332, col_offset=8, end_lineno=332, end_col_offset=16), attr='append', ctx=Load(), lineno=332, col_offset=8, end_lineno=332, end_col_offset=23), args=[JoinedStr(values=[Constant(value='Requested limit ', lineno=332, col_offset=26, end_lineno=332, end_col_offset=42), FormattedValue(value=Name(id='requested_limit', ctx=Load(), lineno=332, col_offset=43, end_lineno=332, end_col_offset=58), conversion=-1, lineno=332, col_offset=42, end_lineno=332, end_col_offset=59), Constant(value=' is not positive; using minimum of 1.', lineno=332, col_offset=59, end_lineno=332, end_col_offset=96)], lineno=332, col_offset=24, end_lineno=332, end_col_offset=97)], lineno=332, col_offset=8, end_lineno=332, end_col_offset=98), lineno=332, col_offset=8, end_lineno=332, end_col_offset=98)], lineno=331, col_offset=4, end_lineno=332, end_col_offset=98), If(test=Compare(left=Name(id='requested_limit', ctx=Load(), lineno=333, col_offset=7, end_lineno=333, end_col_offset=22), ops=[Gt()], comparators=[Name(id='max_results', ctx=Load(), lineno=333, col_offset=25, end_lineno=333, end_col_offset=36)], lineno=333, col_offset=7, end_lineno=333, end_col_offset=36), body=[Expr(value=Call(func=Attribute(value=Name(id='messages', ctx=Load(), lineno=334, col_offset=8, end_lineno=334, end_col_offset=16), attr='append', ctx=Load(), lineno=334, col_offset=8, end_lineno=334, end_col_offset=23), args=[JoinedStr(values=[Constant(value='Requested limit ', lineno=335, col_offset=14, end_lineno=335, end_col_offset=30), FormattedValue(value=Name(id='requested_limit', ctx=Load(), lineno=335, col_offset=31, end_lineno=335, end_col_offset=46), conversion=-1, lineno=335, col_offset=30, end_lineno=335, end_col_offset=47), Constant(value=' exceeds max_results ', lineno=335, col_offset=47, end_lineno=335, end_col_offset=68), FormattedValue(value=Name(id='max_results', ctx=Load(), lineno=335, col_offset=69, end_lineno=335, end_col_offset=80), conversion=-1, lineno=335, col_offset=68, end_lineno=335, end_col_offset=81), Constant(value='; truncating to ', lineno=335, col_offset=81, end_lineno=336, end_col_offset=28), FormattedValue(value=Name(id='max_results', ctx=Load(), lineno=336, col_offset=29, end_lineno=336, end_col_offset=40), conversion=-1, lineno=336, col_offset=28, end_lineno=336, end_col_offset=41), Constant(value='.', lineno=336, col_offset=41, end_lineno=336, end_col_offset=42)], lineno=335, col_offset=12, end_lineno=336, end_col_offset=43)], lineno=334, col_offset=8, end_lineno=337, end_col_offset=9), lineno=334, col_offset=8, end_lineno=337, end_col_offset=9)], lineno=333, col_offset=4, end_lineno=337, end_col_offset=9), Assign(targets=[Name(id='effective_limit', ctx=Store(), lineno=339, col_offset=4, end_lineno=339, end_col_offset=19)], value=Call(func=Name(id='max', ctx=Load(), lineno=339, col_offset=22, end_lineno=339, end_col_offset=25), args=[Constant(value=1, lineno=339, col_offset=26, end_lineno=339, end_col_offset=27), Call(func=Name(id='min', ctx=Load(), lineno=339, col_offset=29, end_lineno=339, end_col_offset=32), args=[Name(id='requested_limit', ctx=Load(), lineno=339, col_offset=33, end_lineno=339, end_col_offset=48), Name(id='max_results', ctx=Load(), lineno=339, col_offset=50, end_lineno=339, end_col_offset=61)], lineno=339, col_offset=29, end_lineno=339, end_col_offset=62)], lineno=339, col_offset=22, end_lineno=339, end_col_offset=63), lineno=339, col_offset=4, end_lineno=339, end_col_offset=63), Return(value=Tuple(elts=[Name(id='effective_limit', ctx=Load(), lineno=340, col_offset=11, end_lineno=340, end_col_offset=26), Name(id='messages', ctx=Load(), lineno=340, col_offset=28, end_lineno=340, end_col_offset=36)], ctx=Load(), lineno=340, col_offset=11, end_lineno=340, end_col_offset=36), lineno=340, col_offset=4, end_lineno=340, end_col_offset=36)], returns=Subscript(value=Name(id='tuple', ctx=Load(), lineno=314, col_offset=67, end_lineno=314, end_col_offset=72), slice=Tuple(elts=[Name(id='int', ctx=Load(), lineno=314, col_offset=73, end_lineno=314, end_col_offset=76), Subscript(value=Name(id='list', ctx=Load(), lineno=314, col_offset=78, end_lineno=314, end_col_offset=82), slice=Name(id='str', ctx=Load(), lineno=314, col_offset=83, end_lineno=314, end_col_offset=86), ctx=Load(), lineno=314, col_offset=78, end_lineno=314, end_col_offset=87)], ctx=Load(), lineno=314, col_offset=73, end_lineno=314, end_col_offset=87), ctx=Load(), lineno=314, col_offset=67, end_lineno=314, end_col_offset=88), lineno=314, col_offset=0, end_lineno=340, end_col_offset=36), FunctionDef(name='_build_search_budget', args=arguments(args=[arg(arg='context', annotation=Name(id='ApplicationContext', ctx=Load(), lineno=344, col_offset=13, end_lineno=344, end_col_offset=31), lineno=344, col_offset=4, end_lineno=344, end_col_offset=31), arg(arg='requested_limit', annotation=Name(id='int', ctx=Load(), lineno=345, col_offset=21, end_lineno=345, end_col_offset=24), lineno=345, col_offset=4, end_lineno=345, end_col_offset=24), arg(arg='observation', annotation=Name(id='Observation', ctx=Load(), lineno=346, col_offset=17, end_lineno=346, end_col_offset=28), lineno=346, col_offset=4, end_lineno=346, end_col_offset=28)]), body=[Expr(value=Constant(value='Combine limit clamping and FAISS readiness metadata for a search.\n\n    Parameters\n    ----------\n    context : ApplicationContext\n        Application context providing settings and FAISS manager.\n    requested_limit : int\n        Requested result limit from client.\n    observation : Observation\n        Observation block used to mark errors.\n\n    Returns\n    -------\n    _SearchBudget\n        Search budget containing effective limit, max results, and limits metadata.\n\n    Raises\n    ------\n    VectorSearchError\n        If FAISS index is not ready or unavailable.\n    ', lineno=348, col_offset=4, end_lineno=368, end_col_offset=7), lineno=348, col_offset=4, end_lineno=368, end_col_offset=7), Assign(targets=[Name(id='max_results', ctx=Store(), lineno=369, col_offset=4, end_lineno=369, end_col_offset=15)], value=Call(func=Name(id='max', ctx=Load(), lineno=369, col_offset=18, end_lineno=369, end_col_offset=21), args=[Constant(value=1, lineno=369, col_offset=22, end_lineno=369, end_col_offset=23), Attribute(value=Attribute(value=Attribute(value=Name(id='context', ctx=Load(), lineno=369, col_offset=25, end_lineno=369, end_col_offset=32), attr='settings', ctx=Load(), lineno=369, col_offset=25, end_lineno=369, end_col_offset=41), attr='limits', ctx=Load(), lineno=369, col_offset=25, end_lineno=369, end_col_offset=48), attr='max_results', ctx=Load(), lineno=369, col_offset=25, end_lineno=369, end_col_offset=60)], lineno=369, col_offset=18, end_lineno=369, end_col_offset=61), lineno=369, col_offset=4, end_lineno=369, end_col_offset=61), Assign(targets=[Tuple(elts=[Name(id='effective_limit', ctx=Store(), lineno=370, col_offset=4, end_lineno=370, end_col_offset=19), Name(id='clamp_messages', ctx=Store(), lineno=370, col_offset=21, end_lineno=370, end_col_offset=35)], ctx=Store(), lineno=370, col_offset=4, end_lineno=370, end_col_offset=35)], value=Call(func=Name(id='_clamp_result_limit', ctx=Load(), lineno=370, col_offset=38, end_lineno=370, end_col_offset=57), args=[Name(id='requested_limit', ctx=Load(), lineno=370, col_offset=58, end_lineno=370, end_col_offset=73), Name(id='max_results', ctx=Load(), lineno=370, col_offset=75, end_lineno=370, end_col_offset=86)], lineno=370, col_offset=38, end_lineno=370, end_col_offset=87), lineno=370, col_offset=4, end_lineno=370, end_col_offset=87), Assign(targets=[Tuple(elts=[Name(id='ready', ctx=Store(), lineno=372, col_offset=4, end_lineno=372, end_col_offset=9), Name(id='faiss_limits', ctx=Store(), lineno=372, col_offset=11, end_lineno=372, end_col_offset=23), Name(id='faiss_error', ctx=Store(), lineno=372, col_offset=25, end_lineno=372, end_col_offset=36)], ctx=Store(), lineno=372, col_offset=4, end_lineno=372, end_col_offset=36)], value=Call(func=Attribute(value=Name(id='context', ctx=Load(), lineno=372, col_offset=39, end_lineno=372, end_col_offset=46), attr='ensure_faiss_ready', ctx=Load(), lineno=372, col_offset=39, end_lineno=372, end_col_offset=65), lineno=372, col_offset=39, end_lineno=372, end_col_offset=67), lineno=372, col_offset=4, end_lineno=372, end_col_offset=67), If(test=UnaryOp(op=Not(), operand=Name(id='ready', ctx=Load(), lineno=373, col_offset=11, end_lineno=373, end_col_offset=16), lineno=373, col_offset=7, end_lineno=373, end_col_offset=16), body=[Expr(value=Call(func=Attribute(value=Name(id='observation', ctx=Load(), lineno=374, col_offset=8, end_lineno=374, end_col_offset=19), attr='mark_error', ctx=Load(), lineno=374, col_offset=8, end_lineno=374, end_col_offset=30), lineno=374, col_offset=8, end_lineno=374, end_col_offset=32), lineno=374, col_offset=8, end_lineno=374, end_col_offset=32), Raise(exc=Call(func=Name(id='VectorSearchError', ctx=Load(), lineno=375, col_offset=14, end_lineno=375, end_col_offset=31), args=[BoolOp(op=Or(), values=[Name(id='faiss_error', ctx=Load(), lineno=376, col_offset=12, end_lineno=376, end_col_offset=23), Constant(value='Semantic search not available - index not built', lineno=376, col_offset=27, end_lineno=376, end_col_offset=76)], lineno=376, col_offset=12, end_lineno=376, end_col_offset=76)], keywords=[keyword(arg='context', value=Dict(keys=[Constant(value='faiss_index', lineno=377, col_offset=21, end_lineno=377, end_col_offset=34)], values=[Call(func=Name(id='str', ctx=Load(), lineno=377, col_offset=36, end_lineno=377, end_col_offset=39), args=[Attribute(value=Attribute(value=Name(id='context', ctx=Load(), lineno=377, col_offset=40, end_lineno=377, end_col_offset=47), attr='paths', ctx=Load(), lineno=377, col_offset=40, end_lineno=377, end_col_offset=53), attr='faiss_index', ctx=Load(), lineno=377, col_offset=40, end_lineno=377, end_col_offset=65)], lineno=377, col_offset=36, end_lineno=377, end_col_offset=66)], lineno=377, col_offset=20, end_lineno=377, end_col_offset=67), lineno=377, col_offset=12, end_lineno=377, end_col_offset=67)], lineno=375, col_offset=14, end_lineno=378, end_col_offset=9), lineno=375, col_offset=8, end_lineno=378, end_col_offset=9)], lineno=373, col_offset=4, end_lineno=378, end_col_offset=9), Assign(targets=[Name(id='limits_metadata', ctx=Store(), lineno=380, col_offset=4, end_lineno=380, end_col_offset=19)], value=Tuple(elts=[Starred(value=Name(id='faiss_limits', ctx=Load(), lineno=380, col_offset=24, end_lineno=380, end_col_offset=36), ctx=Load(), lineno=380, col_offset=23, end_lineno=380, end_col_offset=36), Starred(value=Name(id='clamp_messages', ctx=Load(), lineno=380, col_offset=39, end_lineno=380, end_col_offset=53), ctx=Load(), lineno=380, col_offset=38, end_lineno=380, end_col_offset=53)], ctx=Load(), lineno=380, col_offset=22, end_lineno=380, end_col_offset=54), lineno=380, col_offset=4, end_lineno=380, end_col_offset=54), Return(value=Call(func=Name(id='_SearchBudget', ctx=Load(), lineno=381, col_offset=11, end_lineno=381, end_col_offset=24), args=[Name(id='effective_limit', ctx=Load(), lineno=381, col_offset=25, end_lineno=381, end_col_offset=40), Name(id='max_results', ctx=Load(), lineno=381, col_offset=42, end_lineno=381, end_col_offset=53), Name(id='limits_metadata', ctx=Load(), lineno=381, col_offset=55, end_lineno=381, end_col_offset=70)], lineno=381, col_offset=11, end_lineno=381, end_col_offset=71), lineno=381, col_offset=4, end_lineno=381, end_col_offset=71)], returns=Name(id='_SearchBudget', ctx=Load(), lineno=347, col_offset=5, end_lineno=347, end_col_offset=18), lineno=343, col_offset=0, end_lineno=381, end_col_offset=71), FunctionDef(name='_calculate_faiss_fanout', args=arguments(args=[arg(arg='effective_limit', annotation=Name(id='int', ctx=Load(), lineno=385, col_offset=21, end_lineno=385, end_col_offset=24), lineno=385, col_offset=4, end_lineno=385, end_col_offset=24), arg(arg='max_results', annotation=Name(id='int', ctx=Load(), lineno=386, col_offset=17, end_lineno=386, end_col_offset=20), lineno=386, col_offset=4, end_lineno=386, end_col_offset=20), arg(arg='multiplier', annotation=Name(id='int', ctx=Load(), lineno=387, col_offset=16, end_lineno=387, end_col_offset=19), lineno=387, col_offset=4, end_lineno=387, end_col_offset=19), arg(arg='scope_flags', annotation=Name(id='_ScopeFilterFlags', ctx=Load(), lineno=388, col_offset=17, end_lineno=388, end_col_offset=34), lineno=388, col_offset=4, end_lineno=388, end_col_offset=34)]), body=[Expr(value=Constant(value='Compute FAISS fan-out (k) and the target expansion for filtering.\n\n    Parameters\n    ----------\n    effective_limit : int\n        Limit after applying clamping rules.\n    max_results : int\n        System-wide cap on FAISS results.\n    multiplier : int\n        Semantic over-fetch multiplier configured in settings.\n    scope_flags : _ScopeFilterFlags\n        Flags describing whether scope filters are active.\n\n    Returns\n    -------\n    _FaissFanout\n        Fan-out plan containing both the actual FAISS ``k`` and the unclamped\n        ``k`` target prior to ``max_results`` enforcement.\n    ', lineno=390, col_offset=4, end_lineno=408, end_col_offset=7), lineno=390, col_offset=4, end_lineno=408, end_col_offset=7), Assign(targets=[Name(id='faiss_k_target', ctx=Store(), lineno=409, col_offset=4, end_lineno=409, end_col_offset=18)], value=Name(id='effective_limit', ctx=Load(), lineno=409, col_offset=21, end_lineno=409, end_col_offset=36), lineno=409, col_offset=4, end_lineno=409, end_col_offset=36), If(test=Attribute(value=Name(id='scope_flags', ctx=Load(), lineno=410, col_offset=7, end_lineno=410, end_col_offset=18), attr='has_filters', ctx=Load(), lineno=410, col_offset=7, end_lineno=410, end_col_offset=30), body=[Assign(targets=[Name(id='faiss_k_target', ctx=Store(), lineno=411, col_offset=8, end_lineno=411, end_col_offset=22)], value=BinOp(left=Name(id='effective_limit', ctx=Load(), lineno=411, col_offset=25, end_lineno=411, end_col_offset=40), op=Mult(), right=Name(id='multiplier', ctx=Load(), lineno=411, col_offset=43, end_lineno=411, end_col_offset=53), lineno=411, col_offset=25, end_lineno=411, end_col_offset=53), lineno=411, col_offset=8, end_lineno=411, end_col_offset=53), AugAssign(target=Name(id='faiss_k_target', ctx=Store(), lineno=412, col_offset=8, end_lineno=412, end_col_offset=22), op=Add(), value=Call(func=Name(id='_overfetch_bonus', ctx=Load(), lineno=412, col_offset=26, end_lineno=412, end_col_offset=42), args=[Name(id='effective_limit', ctx=Load(), lineno=412, col_offset=43, end_lineno=412, end_col_offset=58), Name(id='scope_flags', ctx=Load(), lineno=412, col_offset=60, end_lineno=412, end_col_offset=71)], lineno=412, col_offset=26, end_lineno=412, end_col_offset=72), lineno=412, col_offset=8, end_lineno=412, end_col_offset=72)], lineno=410, col_offset=4, end_lineno=412, end_col_offset=72), Assign(targets=[Name(id='faiss_k', ctx=Store(), lineno=414, col_offset=4, end_lineno=414, end_col_offset=11)], value=Call(func=Name(id='max', ctx=Load(), lineno=414, col_offset=14, end_lineno=414, end_col_offset=17), args=[Name(id='effective_limit', ctx=Load(), lineno=415, col_offset=8, end_lineno=415, end_col_offset=23), Call(func=Name(id='min', ctx=Load(), lineno=416, col_offset=8, end_lineno=416, end_col_offset=11), args=[Name(id='max_results', ctx=Load(), lineno=416, col_offset=12, end_lineno=416, end_col_offset=23), Name(id='faiss_k_target', ctx=Load(), lineno=416, col_offset=25, end_lineno=416, end_col_offset=39)], lineno=416, col_offset=8, end_lineno=416, end_col_offset=40)], lineno=414, col_offset=14, end_lineno=417, end_col_offset=5), lineno=414, col_offset=4, end_lineno=417, end_col_offset=5), Return(value=Call(func=Name(id='_FaissFanout', ctx=Load(), lineno=418, col_offset=11, end_lineno=418, end_col_offset=23), args=[Name(id='faiss_k', ctx=Load(), lineno=418, col_offset=24, end_lineno=418, end_col_offset=31), Name(id='faiss_k_target', ctx=Load(), lineno=418, col_offset=33, end_lineno=418, end_col_offset=47)], lineno=418, col_offset=11, end_lineno=418, end_col_offset=48), lineno=418, col_offset=4, end_lineno=418, end_col_offset=48)], returns=Name(id='_FaissFanout', ctx=Load(), lineno=389, col_offset=5, end_lineno=389, end_col_offset=17), lineno=384, col_offset=0, end_lineno=418, end_col_offset=48), FunctionDef(name='_overfetch_bonus', args=arguments(args=[arg(arg='effective_limit', annotation=Name(id='int', ctx=Load(), lineno=421, col_offset=38, end_lineno=421, end_col_offset=41), lineno=421, col_offset=21, end_lineno=421, end_col_offset=41), arg(arg='scope_flags', annotation=Name(id='_ScopeFilterFlags', ctx=Load(), lineno=421, col_offset=56, end_lineno=421, end_col_offset=73), lineno=421, col_offset=43, end_lineno=421, end_col_offset=73)]), body=[Expr(value=Constant(value='Determine additional fan-out when scope filters may drop results.\n\n    Calculates an over-fetch bonus to compensate for results that may be filtered\n    out by scope filters (include/exclude globs, language filters). The bonus\n    is higher when multiple filter types are active, as more results are likely\n    to be filtered out.\n\n    Parameters\n    ----------\n    effective_limit : int\n        Base number of results requested by the user.\n    scope_flags : _ScopeFilterFlags\n        Flags indicating which types of scope filters are active (include globs,\n        exclude globs, language filters).\n\n    Returns\n    -------\n    int\n        Additional results to fetch beyond effective_limit to account for filtering.\n        Returns effective_limit when both glob and language filters are active,\n        effective_limit // 2 when only one type is active, or 0 when no filters\n        are active.\n    ', lineno=422, col_offset=4, end_lineno=444, end_col_offset=7), lineno=422, col_offset=4, end_lineno=444, end_col_offset=7), If(test=BoolOp(op=And(), values=[Attribute(value=Name(id='scope_flags', ctx=Load(), lineno=445, col_offset=7, end_lineno=445, end_col_offset=18), attr='has_include_globs', ctx=Load(), lineno=445, col_offset=7, end_lineno=445, end_col_offset=36), Attribute(value=Name(id='scope_flags', ctx=Load(), lineno=445, col_offset=41, end_lineno=445, end_col_offset=52), attr='has_languages', ctx=Load(), lineno=445, col_offset=41, end_lineno=445, end_col_offset=66)], lineno=445, col_offset=7, end_lineno=445, end_col_offset=66), body=[Return(value=Name(id='effective_limit', ctx=Load(), lineno=446, col_offset=15, end_lineno=446, end_col_offset=30), lineno=446, col_offset=8, end_lineno=446, end_col_offset=30)], lineno=445, col_offset=4, end_lineno=446, end_col_offset=30), If(test=BoolOp(op=Or(), values=[Attribute(value=Name(id='scope_flags', ctx=Load(), lineno=447, col_offset=7, end_lineno=447, end_col_offset=18), attr='has_include_globs', ctx=Load(), lineno=447, col_offset=7, end_lineno=447, end_col_offset=36), Attribute(value=Name(id='scope_flags', ctx=Load(), lineno=447, col_offset=40, end_lineno=447, end_col_offset=51), attr='has_languages', ctx=Load(), lineno=447, col_offset=40, end_lineno=447, end_col_offset=65)], lineno=447, col_offset=7, end_lineno=447, end_col_offset=65), body=[Return(value=Call(func=Name(id='max', ctx=Load(), lineno=448, col_offset=15, end_lineno=448, end_col_offset=18), args=[Constant(value=1, lineno=448, col_offset=19, end_lineno=448, end_col_offset=20), BinOp(left=Name(id='effective_limit', ctx=Load(), lineno=448, col_offset=22, end_lineno=448, end_col_offset=37), op=FloorDiv(), right=Constant(value=2, lineno=448, col_offset=41, end_lineno=448, end_col_offset=42), lineno=448, col_offset=22, end_lineno=448, end_col_offset=42)], lineno=448, col_offset=15, end_lineno=448, end_col_offset=43), lineno=448, col_offset=8, end_lineno=448, end_col_offset=43)], lineno=447, col_offset=4, end_lineno=448, end_col_offset=43), Return(value=Constant(value=0, lineno=449, col_offset=11, end_lineno=449, end_col_offset=12), lineno=449, col_offset=4, end_lineno=449, end_col_offset=12)], returns=Name(id='int', ctx=Load(), lineno=421, col_offset=78, end_lineno=421, end_col_offset=81), lineno=421, col_offset=0, end_lineno=449, end_col_offset=12), FunctionDef(name='_resolve_hybrid_results', args=arguments(args=[arg(arg='context', annotation=Name(id='ApplicationContext', ctx=Load(), lineno=453, col_offset=13, end_lineno=453, end_col_offset=31), lineno=453, col_offset=4, end_lineno=453, end_col_offset=31), arg(arg='state', annotation=Name(id='_HybridSearchState', ctx=Load(), lineno=454, col_offset=11, end_lineno=454, end_col_offset=29), lineno=454, col_offset=4, end_lineno=454, end_col_offset=29), arg(arg='limits_metadata', annotation=Subscript(value=Name(id='list', ctx=Load(), lineno=455, col_offset=21, end_lineno=455, end_col_offset=25), slice=Name(id='str', ctx=Load(), lineno=455, col_offset=26, end_lineno=455, end_col_offset=29), ctx=Load(), lineno=455, col_offset=21, end_lineno=455, end_col_offset=30), lineno=455, col_offset=4, end_lineno=455, end_col_offset=30), arg(arg='retrieval_channels', annotation=Subscript(value=Name(id='Sequence', ctx=Load(), lineno=456, col_offset=24, end_lineno=456, end_col_offset=32), slice=Name(id='str', ctx=Load(), lineno=456, col_offset=33, end_lineno=456, end_col_offset=36), ctx=Load(), lineno=456, col_offset=24, end_lineno=456, end_col_offset=37), lineno=456, col_offset=4, end_lineno=456, end_col_offset=37)]), body=[Expr(value=Constant(value='Join hybrid retrieval results with the FAISS output when available.\n\n    Parameters\n    ----------\n    context : ApplicationContext\n        Application context that can provide the hybrid search engine.\n    state : _HybridSearchState\n        FAISS search state carrying IDs, scores, query text, and applied limit.\n    limits_metadata : list[str]\n        Mutable metadata bucket for reporting search limitations.\n    retrieval_channels : Sequence[str]\n        Base retrieval channels (semantic + FAISS).\n\n    Returns\n    -------\n    _HybridResult\n        Hydration IDs, scores, optional hybrid contributions, and the final list of\n        retrieval channels that contributed to the answer.\n    ', lineno=458, col_offset=4, end_lineno=476, end_col_offset=7), lineno=458, col_offset=4, end_lineno=476, end_col_offset=7), Assign(targets=[Name(id='hydration_ids', ctx=Store(), lineno=477, col_offset=4, end_lineno=477, end_col_offset=17)], value=Call(func=Name(id='list', ctx=Load(), lineno=477, col_offset=20, end_lineno=477, end_col_offset=24), args=[Attribute(value=Name(id='state', ctx=Load(), lineno=477, col_offset=25, end_lineno=477, end_col_offset=30), attr='result_ids', ctx=Load(), lineno=477, col_offset=25, end_lineno=477, end_col_offset=41)], lineno=477, col_offset=20, end_lineno=477, end_col_offset=42), lineno=477, col_offset=4, end_lineno=477, end_col_offset=42), Assign(targets=[Name(id='hydration_scores', ctx=Store(), lineno=478, col_offset=4, end_lineno=478, end_col_offset=20)], value=Call(func=Name(id='list', ctx=Load(), lineno=478, col_offset=23, end_lineno=478, end_col_offset=27), args=[Attribute(value=Name(id='state', ctx=Load(), lineno=478, col_offset=28, end_lineno=478, end_col_offset=33), attr='result_scores', ctx=Load(), lineno=478, col_offset=28, end_lineno=478, end_col_offset=47)], lineno=478, col_offset=23, end_lineno=478, end_col_offset=48), lineno=478, col_offset=4, end_lineno=478, end_col_offset=48), AnnAssign(target=Name(id='contribution_map', ctx=Store(), lineno=479, col_offset=4, end_lineno=479, end_col_offset=20), annotation=BinOp(left=Subscript(value=Name(id='dict', ctx=Load(), lineno=479, col_offset=22, end_lineno=479, end_col_offset=26), slice=Tuple(elts=[Name(id='int', ctx=Load(), lineno=479, col_offset=27, end_lineno=479, end_col_offset=30), Subscript(value=Name(id='list', ctx=Load(), lineno=479, col_offset=32, end_lineno=479, end_col_offset=36), slice=Subscript(value=Name(id='tuple', ctx=Load(), lineno=479, col_offset=37, end_lineno=479, end_col_offset=42), slice=Tuple(elts=[Name(id='str', ctx=Load(), lineno=479, col_offset=43, end_lineno=479, end_col_offset=46), Name(id='int', ctx=Load(), lineno=479, col_offset=48, end_lineno=479, end_col_offset=51), Name(id='float', ctx=Load(), lineno=479, col_offset=53, end_lineno=479, end_col_offset=58)], ctx=Load(), lineno=479, col_offset=43, end_lineno=479, end_col_offset=58), ctx=Load(), lineno=479, col_offset=37, end_lineno=479, end_col_offset=59), ctx=Load(), lineno=479, col_offset=32, end_lineno=479, end_col_offset=60)], ctx=Load(), lineno=479, col_offset=27, end_lineno=479, end_col_offset=60), ctx=Load(), lineno=479, col_offset=22, end_lineno=479, end_col_offset=61), op=BitOr(), right=Constant(value=None, lineno=479, col_offset=64, end_lineno=479, end_col_offset=68), lineno=479, col_offset=22, end_lineno=479, end_col_offset=68), value=Constant(value=None, lineno=479, col_offset=71, end_lineno=479, end_col_offset=75), simple=1, lineno=479, col_offset=4, end_lineno=479, end_col_offset=75), Assign(targets=[Name(id='channels_out', ctx=Store(), lineno=480, col_offset=4, end_lineno=480, end_col_offset=16)], value=Call(func=Name(id='list', ctx=Load(), lineno=480, col_offset=19, end_lineno=480, end_col_offset=23), args=[Name(id='retrieval_channels', ctx=Load(), lineno=480, col_offset=24, end_lineno=480, end_col_offset=42)], lineno=480, col_offset=19, end_lineno=480, end_col_offset=43), lineno=480, col_offset=4, end_lineno=480, end_col_offset=43), Try(body=[Assign(targets=[Name(id='hybrid_engine', ctx=Store(), lineno=483, col_offset=8, end_lineno=483, end_col_offset=21)], value=Call(func=Attribute(value=Name(id='context', ctx=Load(), lineno=483, col_offset=24, end_lineno=483, end_col_offset=31), attr='get_hybrid_engine', ctx=Load(), lineno=483, col_offset=24, end_lineno=483, end_col_offset=49), lineno=483, col_offset=24, end_lineno=483, end_col_offset=51), lineno=483, col_offset=8, end_lineno=483, end_col_offset=51)], handlers=[ExceptHandler(type=Name(id='RuntimeError', ctx=Load(), lineno=484, col_offset=11, end_lineno=484, end_col_offset=23), name='exc', body=[Expr(value=Call(func=Attribute(value=Name(id='limits_metadata', ctx=Load(), lineno=485, col_offset=8, end_lineno=485, end_col_offset=23), attr='append', ctx=Load(), lineno=485, col_offset=8, end_lineno=485, end_col_offset=30), args=[JoinedStr(values=[Constant(value='Hybrid search unavailable: ', lineno=485, col_offset=33, end_lineno=485, end_col_offset=60), FormattedValue(value=Name(id='exc', ctx=Load(), lineno=485, col_offset=61, end_lineno=485, end_col_offset=64), conversion=-1, lineno=485, col_offset=60, end_lineno=485, end_col_offset=65)], lineno=485, col_offset=31, end_lineno=485, end_col_offset=66)], lineno=485, col_offset=8, end_lineno=485, end_col_offset=67), lineno=485, col_offset=8, end_lineno=485, end_col_offset=67), Expr(value=Call(func=Attribute(value=Name(id='LOGGER', ctx=Load(), lineno=486, col_offset=8, end_lineno=486, end_col_offset=14), attr='warning', ctx=Load(), lineno=486, col_offset=8, end_lineno=486, end_col_offset=22), args=[Constant(value='Hybrid engine unavailable', lineno=486, col_offset=23, end_lineno=486, end_col_offset=50)], keywords=[keyword(arg='exc_info', value=Name(id='exc', ctx=Load(), lineno=486, col_offset=61, end_lineno=486, end_col_offset=64), lineno=486, col_offset=52, end_lineno=486, end_col_offset=64)], lineno=486, col_offset=8, end_lineno=486, end_col_offset=65), lineno=486, col_offset=8, end_lineno=486, end_col_offset=65), Return(value=Call(func=Name(id='_build_hybrid_result', ctx=Load(), lineno=487, col_offset=15, end_lineno=487, end_col_offset=35), args=[Name(id='hydration_ids', ctx=Load(), lineno=488, col_offset=12, end_lineno=488, end_col_offset=25), Name(id='hydration_scores', ctx=Load(), lineno=489, col_offset=12, end_lineno=489, end_col_offset=28), Attribute(value=Name(id='state', ctx=Load(), lineno=490, col_offset=12, end_lineno=490, end_col_offset=17), attr='effective_limit', ctx=Load(), lineno=490, col_offset=12, end_lineno=490, end_col_offset=33), Name(id='contribution_map', ctx=Load(), lineno=491, col_offset=12, end_lineno=491, end_col_offset=28), Name(id='channels_out', ctx=Load(), lineno=492, col_offset=12, end_lineno=492, end_col_offset=24)], lineno=487, col_offset=15, end_lineno=493, end_col_offset=9), lineno=487, col_offset=8, end_lineno=493, end_col_offset=9)], lineno=484, col_offset=4, end_lineno=493, end_col_offset=9)], lineno=482, col_offset=4, end_lineno=493, end_col_offset=9), If(test=Compare(left=Name(id='hybrid_engine', ctx=Load(), lineno=495, col_offset=7, end_lineno=495, end_col_offset=20), ops=[Is()], comparators=[Constant(value=None, lineno=495, col_offset=24, end_lineno=495, end_col_offset=28)], lineno=495, col_offset=7, end_lineno=495, end_col_offset=28), body=[Return(value=Call(func=Name(id='_build_hybrid_result', ctx=Load(), lineno=496, col_offset=15, end_lineno=496, end_col_offset=35), args=[Name(id='hydration_ids', ctx=Load(), lineno=497, col_offset=12, end_lineno=497, end_col_offset=25), Name(id='hydration_scores', ctx=Load(), lineno=498, col_offset=12, end_lineno=498, end_col_offset=28), Attribute(value=Name(id='state', ctx=Load(), lineno=499, col_offset=12, end_lineno=499, end_col_offset=17), attr='effective_limit', ctx=Load(), lineno=499, col_offset=12, end_lineno=499, end_col_offset=33), Name(id='contribution_map', ctx=Load(), lineno=500, col_offset=12, end_lineno=500, end_col_offset=28), Name(id='channels_out', ctx=Load(), lineno=501, col_offset=12, end_lineno=501, end_col_offset=24)], lineno=496, col_offset=15, end_lineno=502, end_col_offset=9), lineno=496, col_offset=8, end_lineno=502, end_col_offset=9)], lineno=495, col_offset=4, end_lineno=502, end_col_offset=9), Assign(targets=[Name(id='semantic_hits', ctx=Store(), lineno=504, col_offset=4, end_lineno=504, end_col_offset=17)], value=Call(func=Name(id='list', ctx=Load(), lineno=504, col_offset=20, end_lineno=504, end_col_offset=24), args=[Call(func=Name(id='zip', ctx=Load(), lineno=505, col_offset=8, end_lineno=505, end_col_offset=11), args=[Attribute(value=Name(id='state', ctx=Load(), lineno=505, col_offset=12, end_lineno=505, end_col_offset=17), attr='result_ids', ctx=Load(), lineno=505, col_offset=12, end_lineno=505, end_col_offset=28), Attribute(value=Name(id='state', ctx=Load(), lineno=505, col_offset=30, end_lineno=505, end_col_offset=35), attr='result_scores', ctx=Load(), lineno=505, col_offset=30, end_lineno=505, end_col_offset=49)], keywords=[keyword(arg='strict', value=Constant(value=False, lineno=505, col_offset=58, end_lineno=505, end_col_offset=63), lineno=505, col_offset=51, end_lineno=505, end_col_offset=63)], lineno=505, col_offset=8, end_lineno=505, end_col_offset=64)], lineno=504, col_offset=20, end_lineno=506, end_col_offset=5), lineno=504, col_offset=4, end_lineno=506, end_col_offset=5), Assign(targets=[Name(id='hybrid_result', ctx=Store(), lineno=507, col_offset=4, end_lineno=507, end_col_offset=17)], value=Call(func=Attribute(value=Name(id='hybrid_engine', ctx=Load(), lineno=507, col_offset=20, end_lineno=507, end_col_offset=33), attr='search', ctx=Load(), lineno=507, col_offset=20, end_lineno=507, end_col_offset=40), keywords=[keyword(arg='query', value=Attribute(value=Name(id='state', ctx=Load(), lineno=508, col_offset=14, end_lineno=508, end_col_offset=19), attr='query', ctx=Load(), lineno=508, col_offset=14, end_lineno=508, end_col_offset=25), lineno=508, col_offset=8, end_lineno=508, end_col_offset=25), keyword(arg='semantic_hits', value=Name(id='semantic_hits', ctx=Load(), lineno=509, col_offset=22, end_lineno=509, end_col_offset=35), lineno=509, col_offset=8, end_lineno=509, end_col_offset=35), keyword(arg='limit', value=Attribute(value=Name(id='state', ctx=Load(), lineno=510, col_offset=14, end_lineno=510, end_col_offset=19), attr='effective_limit', ctx=Load(), lineno=510, col_offset=14, end_lineno=510, end_col_offset=35), lineno=510, col_offset=8, end_lineno=510, end_col_offset=35)], lineno=507, col_offset=20, end_lineno=511, end_col_offset=5), lineno=507, col_offset=4, end_lineno=511, end_col_offset=5), If(test=Attribute(value=Name(id='hybrid_result', ctx=Load(), lineno=512, col_offset=7, end_lineno=512, end_col_offset=20), attr='warnings', ctx=Load(), lineno=512, col_offset=7, end_lineno=512, end_col_offset=29), body=[Expr(value=Call(func=Attribute(value=Name(id='limits_metadata', ctx=Load(), lineno=513, col_offset=8, end_lineno=513, end_col_offset=23), attr='extend', ctx=Load(), lineno=513, col_offset=8, end_lineno=513, end_col_offset=30), args=[Attribute(value=Name(id='hybrid_result', ctx=Load(), lineno=513, col_offset=31, end_lineno=513, end_col_offset=44), attr='warnings', ctx=Load(), lineno=513, col_offset=31, end_lineno=513, end_col_offset=53)], lineno=513, col_offset=8, end_lineno=513, end_col_offset=54), lineno=513, col_offset=8, end_lineno=513, end_col_offset=54)], lineno=512, col_offset=4, end_lineno=513, end_col_offset=54), AnnAssign(target=Name(id='fused_ids', ctx=Store(), lineno=515, col_offset=4, end_lineno=515, end_col_offset=13), annotation=Subscript(value=Name(id='list', ctx=Load(), lineno=515, col_offset=15, end_lineno=515, end_col_offset=19), slice=Name(id='int', ctx=Load(), lineno=515, col_offset=20, end_lineno=515, end_col_offset=23), ctx=Load(), lineno=515, col_offset=15, end_lineno=515, end_col_offset=24), value=List(ctx=Load(), lineno=515, col_offset=27, end_lineno=515, end_col_offset=29), simple=1, lineno=515, col_offset=4, end_lineno=515, end_col_offset=29), AnnAssign(target=Name(id='fused_scores', ctx=Store(), lineno=516, col_offset=4, end_lineno=516, end_col_offset=16), annotation=Subscript(value=Name(id='list', ctx=Load(), lineno=516, col_offset=18, end_lineno=516, end_col_offset=22), slice=Name(id='float', ctx=Load(), lineno=516, col_offset=23, end_lineno=516, end_col_offset=28), ctx=Load(), lineno=516, col_offset=18, end_lineno=516, end_col_offset=29), value=List(ctx=Load(), lineno=516, col_offset=32, end_lineno=516, end_col_offset=34), simple=1, lineno=516, col_offset=4, end_lineno=516, end_col_offset=34), AnnAssign(target=Name(id='fused_contributions', ctx=Store(), lineno=517, col_offset=4, end_lineno=517, end_col_offset=23), annotation=Subscript(value=Name(id='dict', ctx=Load(), lineno=517, col_offset=25, end_lineno=517, end_col_offset=29), slice=Tuple(elts=[Name(id='int', ctx=Load(), lineno=517, col_offset=30, end_lineno=517, end_col_offset=33), Subscript(value=Name(id='list', ctx=Load(), lineno=517, col_offset=35, end_lineno=517, end_col_offset=39), slice=Subscript(value=Name(id='tuple', ctx=Load(), lineno=517, col_offset=40, end_lineno=517, end_col_offset=45), slice=Tuple(elts=[Name(id='str', ctx=Load(), lineno=517, col_offset=46, end_lineno=517, end_col_offset=49), Name(id='int', ctx=Load(), lineno=517, col_offset=51, end_lineno=517, end_col_offset=54), Name(id='float', ctx=Load(), lineno=517, col_offset=56, end_lineno=517, end_col_offset=61)], ctx=Load(), lineno=517, col_offset=46, end_lineno=517, end_col_offset=61), ctx=Load(), lineno=517, col_offset=40, end_lineno=517, end_col_offset=62), ctx=Load(), lineno=517, col_offset=35, end_lineno=517, end_col_offset=63)], ctx=Load(), lineno=517, col_offset=30, end_lineno=517, end_col_offset=63), ctx=Load(), lineno=517, col_offset=25, end_lineno=517, end_col_offset=64), value=Dict(lineno=517, col_offset=67, end_lineno=517, end_col_offset=69), simple=1, lineno=517, col_offset=4, end_lineno=517, end_col_offset=69), For(target=Name(id='doc', ctx=Store(), lineno=518, col_offset=8, end_lineno=518, end_col_offset=11), iter=Attribute(value=Name(id='hybrid_result', ctx=Load(), lineno=518, col_offset=15, end_lineno=518, end_col_offset=28), attr='docs', ctx=Load(), lineno=518, col_offset=15, end_lineno=518, end_col_offset=33), body=[Try(body=[Assign(targets=[Name(id='chunk_id_int', ctx=Store(), lineno=520, col_offset=12, end_lineno=520, end_col_offset=24)], value=Call(func=Name(id='int', ctx=Load(), lineno=520, col_offset=27, end_lineno=520, end_col_offset=30), args=[Attribute(value=Name(id='doc', ctx=Load(), lineno=520, col_offset=31, end_lineno=520, end_col_offset=34), attr='doc_id', ctx=Load(), lineno=520, col_offset=31, end_lineno=520, end_col_offset=41)], lineno=520, col_offset=27, end_lineno=520, end_col_offset=42), lineno=520, col_offset=12, end_lineno=520, end_col_offset=42)], handlers=[ExceptHandler(type=Name(id='ValueError', ctx=Load(), lineno=521, col_offset=15, end_lineno=521, end_col_offset=25), body=[Expr(value=Call(func=Attribute(value=Name(id='limits_metadata', ctx=Load(), lineno=522, col_offset=12, end_lineno=522, end_col_offset=27), attr='append', ctx=Load(), lineno=522, col_offset=12, end_lineno=522, end_col_offset=34), args=[JoinedStr(values=[Constant(value='Hybrid result skipped (non-numeric chunk id): ', lineno=522, col_offset=37, end_lineno=522, end_col_offset=83), FormattedValue(value=Attribute(value=Name(id='doc', ctx=Load(), lineno=522, col_offset=84, end_lineno=522, end_col_offset=87), attr='doc_id', ctx=Load(), lineno=522, col_offset=84, end_lineno=522, end_col_offset=94), conversion=-1, lineno=522, col_offset=83, end_lineno=522, end_col_offset=95)], lineno=522, col_offset=35, end_lineno=522, end_col_offset=96)], lineno=522, col_offset=12, end_lineno=522, end_col_offset=97), lineno=522, col_offset=12, end_lineno=522, end_col_offset=97), Continue(lineno=523, col_offset=12, end_lineno=523, end_col_offset=20)], lineno=521, col_offset=8, end_lineno=523, end_col_offset=20)], lineno=519, col_offset=8, end_lineno=523, end_col_offset=20), Expr(value=Call(func=Attribute(value=Name(id='fused_ids', ctx=Load(), lineno=525, col_offset=8, end_lineno=525, end_col_offset=17), attr='append', ctx=Load(), lineno=525, col_offset=8, end_lineno=525, end_col_offset=24), args=[Name(id='chunk_id_int', ctx=Load(), lineno=525, col_offset=25, end_lineno=525, end_col_offset=37)], lineno=525, col_offset=8, end_lineno=525, end_col_offset=38), lineno=525, col_offset=8, end_lineno=525, end_col_offset=38), Expr(value=Call(func=Attribute(value=Name(id='fused_scores', ctx=Load(), lineno=526, col_offset=8, end_lineno=526, end_col_offset=20), attr='append', ctx=Load(), lineno=526, col_offset=8, end_lineno=526, end_col_offset=27), args=[Call(func=Name(id='float', ctx=Load(), lineno=526, col_offset=28, end_lineno=526, end_col_offset=33), args=[Attribute(value=Name(id='doc', ctx=Load(), lineno=526, col_offset=34, end_lineno=526, end_col_offset=37), attr='score', ctx=Load(), lineno=526, col_offset=34, end_lineno=526, end_col_offset=43)], lineno=526, col_offset=28, end_lineno=526, end_col_offset=44)], lineno=526, col_offset=8, end_lineno=526, end_col_offset=45), lineno=526, col_offset=8, end_lineno=526, end_col_offset=45), Assign(targets=[Subscript(value=Name(id='fused_contributions', ctx=Load(), lineno=527, col_offset=8, end_lineno=527, end_col_offset=27), slice=Name(id='chunk_id_int', ctx=Load(), lineno=527, col_offset=28, end_lineno=527, end_col_offset=40), ctx=Store(), lineno=527, col_offset=8, end_lineno=527, end_col_offset=41)], value=Call(func=Attribute(value=Attribute(value=Name(id='hybrid_result', ctx=Load(), lineno=527, col_offset=44, end_lineno=527, end_col_offset=57), attr='contributions', ctx=Load(), lineno=527, col_offset=44, end_lineno=527, end_col_offset=71), attr='get', ctx=Load(), lineno=527, col_offset=44, end_lineno=527, end_col_offset=75), args=[Attribute(value=Name(id='doc', ctx=Load(), lineno=527, col_offset=76, end_lineno=527, end_col_offset=79), attr='doc_id', ctx=Load(), lineno=527, col_offset=76, end_lineno=527, end_col_offset=86), List(ctx=Load(), lineno=527, col_offset=88, end_lineno=527, end_col_offset=90)], lineno=527, col_offset=44, end_lineno=527, end_col_offset=91), lineno=527, col_offset=8, end_lineno=527, end_col_offset=91)], lineno=518, col_offset=4, end_lineno=527, end_col_offset=91), If(test=Name(id='fused_ids', ctx=Load(), lineno=529, col_offset=7, end_lineno=529, end_col_offset=16), body=[Assign(targets=[Name(id='channels_out', ctx=Store(), lineno=530, col_offset=8, end_lineno=530, end_col_offset=20)], value=Call(func=Name(id='list', ctx=Load(), lineno=530, col_offset=23, end_lineno=530, end_col_offset=27), args=[Call(func=Attribute(value=Name(id='dict', ctx=Load(), lineno=530, col_offset=28, end_lineno=530, end_col_offset=32), attr='fromkeys', ctx=Load(), lineno=530, col_offset=28, end_lineno=530, end_col_offset=41), args=[List(elts=[Constant(value='semantic', lineno=530, col_offset=43, end_lineno=530, end_col_offset=53), Constant(value='faiss', lineno=530, col_offset=55, end_lineno=530, end_col_offset=62), Starred(value=Attribute(value=Name(id='hybrid_result', ctx=Load(), lineno=530, col_offset=65, end_lineno=530, end_col_offset=78), attr='channels', ctx=Load(), lineno=530, col_offset=65, end_lineno=530, end_col_offset=87), ctx=Load(), lineno=530, col_offset=64, end_lineno=530, end_col_offset=87)], ctx=Load(), lineno=530, col_offset=42, end_lineno=530, end_col_offset=88)], lineno=530, col_offset=28, end_lineno=530, end_col_offset=89)], lineno=530, col_offset=23, end_lineno=530, end_col_offset=90), lineno=530, col_offset=8, end_lineno=530, end_col_offset=90), Return(value=Call(func=Name(id='_build_hybrid_result', ctx=Load(), lineno=531, col_offset=15, end_lineno=531, end_col_offset=35), args=[Name(id='fused_ids', ctx=Load(), lineno=532, col_offset=12, end_lineno=532, end_col_offset=21), Name(id='fused_scores', ctx=Load(), lineno=533, col_offset=12, end_lineno=533, end_col_offset=24), Attribute(value=Name(id='state', ctx=Load(), lineno=534, col_offset=12, end_lineno=534, end_col_offset=17), attr='effective_limit', ctx=Load(), lineno=534, col_offset=12, end_lineno=534, end_col_offset=33), Name(id='fused_contributions', ctx=Load(), lineno=535, col_offset=12, end_lineno=535, end_col_offset=31), Name(id='channels_out', ctx=Load(), lineno=536, col_offset=12, end_lineno=536, end_col_offset=24)], lineno=531, col_offset=15, end_lineno=537, end_col_offset=9), lineno=531, col_offset=8, end_lineno=537, end_col_offset=9)], lineno=529, col_offset=4, end_lineno=537, end_col_offset=9), Return(value=Call(func=Name(id='_build_hybrid_result', ctx=Load(), lineno=538, col_offset=11, end_lineno=538, end_col_offset=31), args=[Name(id='hydration_ids', ctx=Load(), lineno=539, col_offset=8, end_lineno=539, end_col_offset=21), Name(id='hydration_scores', ctx=Load(), lineno=540, col_offset=8, end_lineno=540, end_col_offset=24), Attribute(value=Name(id='state', ctx=Load(), lineno=541, col_offset=8, end_lineno=541, end_col_offset=13), attr='effective_limit', ctx=Load(), lineno=541, col_offset=8, end_lineno=541, end_col_offset=29), Name(id='contribution_map', ctx=Load(), lineno=542, col_offset=8, end_lineno=542, end_col_offset=24), Name(id='channels_out', ctx=Load(), lineno=543, col_offset=8, end_lineno=543, end_col_offset=20)], lineno=538, col_offset=11, end_lineno=544, end_col_offset=5), lineno=538, col_offset=4, end_lineno=544, end_col_offset=5)], returns=Name(id='_HybridResult', ctx=Load(), lineno=457, col_offset=5, end_lineno=457, end_col_offset=18), lineno=452, col_offset=0, end_lineno=544, end_col_offset=5), FunctionDef(name='_build_hybrid_result', args=arguments(args=[arg(arg='hydration_ids', annotation=Subscript(value=Name(id='list', ctx=Load(), lineno=548, col_offset=19, end_lineno=548, end_col_offset=23), slice=Name(id='int', ctx=Load(), lineno=548, col_offset=24, end_lineno=548, end_col_offset=27), ctx=Load(), lineno=548, col_offset=19, end_lineno=548, end_col_offset=28), lineno=548, col_offset=4, end_lineno=548, end_col_offset=28), arg(arg='hydration_scores', annotation=Subscript(value=Name(id='list', ctx=Load(), lineno=549, col_offset=22, end_lineno=549, end_col_offset=26), slice=Name(id='float', ctx=Load(), lineno=549, col_offset=27, end_lineno=549, end_col_offset=32), ctx=Load(), lineno=549, col_offset=22, end_lineno=549, end_col_offset=33), lineno=549, col_offset=4, end_lineno=549, end_col_offset=33), arg(arg='limit', annotation=Name(id='int', ctx=Load(), lineno=550, col_offset=11, end_lineno=550, end_col_offset=14), lineno=550, col_offset=4, end_lineno=550, end_col_offset=14), arg(arg='contribution_map', annotation=BinOp(left=Subscript(value=Name(id='dict', ctx=Load(), lineno=551, col_offset=22, end_lineno=551, end_col_offset=26), slice=Tuple(elts=[Name(id='int', ctx=Load(), lineno=551, col_offset=27, end_lineno=551, end_col_offset=30), Subscript(value=Name(id='list', ctx=Load(), lineno=551, col_offset=32, end_lineno=551, end_col_offset=36), slice=Subscript(value=Name(id='tuple', ctx=Load(), lineno=551, col_offset=37, end_lineno=551, end_col_offset=42), slice=Tuple(elts=[Name(id='str', ctx=Load(), lineno=551, col_offset=43, end_lineno=551, end_col_offset=46), Name(id='int', ctx=Load(), lineno=551, col_offset=48, end_lineno=551, end_col_offset=51), Name(id='float', ctx=Load(), lineno=551, col_offset=53, end_lineno=551, end_col_offset=58)], ctx=Load(), lineno=551, col_offset=43, end_lineno=551, end_col_offset=58), ctx=Load(), lineno=551, col_offset=37, end_lineno=551, end_col_offset=59), ctx=Load(), lineno=551, col_offset=32, end_lineno=551, end_col_offset=60)], ctx=Load(), lineno=551, col_offset=27, end_lineno=551, end_col_offset=60), ctx=Load(), lineno=551, col_offset=22, end_lineno=551, end_col_offset=61), op=BitOr(), right=Constant(value=None, lineno=551, col_offset=64, end_lineno=551, end_col_offset=68), lineno=551, col_offset=22, end_lineno=551, end_col_offset=68), lineno=551, col_offset=4, end_lineno=551, end_col_offset=68), arg(arg='retrieval_channels', annotation=Subscript(value=Name(id='Sequence', ctx=Load(), lineno=552, col_offset=24, end_lineno=552, end_col_offset=32), slice=Name(id='str', ctx=Load(), lineno=552, col_offset=33, end_lineno=552, end_col_offset=36), ctx=Load(), lineno=552, col_offset=24, end_lineno=552, end_col_offset=37), lineno=552, col_offset=4, end_lineno=552, end_col_offset=37)]), body=[Expr(value=Constant(value='Trim FAISS/hybrid candidates to the effective limit.\n\n    Parameters\n    ----------\n    hydration_ids : list[int]\n        Candidate IDs to trim.\n    hydration_scores : list[float]\n        Candidate scores corresponding to IDs.\n    limit : int\n        Maximum number of results to return.\n    contribution_map : dict[int, list[tuple[str, int, float]]] | None\n        Optional contribution map for hybrid results.\n    retrieval_channels : Sequence[str]\n        List of retrieval channels used.\n\n    Returns\n    -------\n    _HybridResult\n        Trimmed result with IDs, scores, contribution map, and channels.\n    ', lineno=554, col_offset=4, end_lineno=573, end_col_offset=7), lineno=554, col_offset=4, end_lineno=573, end_col_offset=7), Assign(targets=[Name(id='trimmed_ids', ctx=Store(), lineno=574, col_offset=4, end_lineno=574, end_col_offset=15)], value=Subscript(value=Name(id='hydration_ids', ctx=Load(), lineno=574, col_offset=18, end_lineno=574, end_col_offset=31), slice=Slice(upper=Name(id='limit', ctx=Load(), lineno=574, col_offset=33, end_lineno=574, end_col_offset=38), lineno=574, col_offset=32, end_lineno=574, end_col_offset=38), ctx=Load(), lineno=574, col_offset=18, end_lineno=574, end_col_offset=39), lineno=574, col_offset=4, end_lineno=574, end_col_offset=39), Assign(targets=[Name(id='trimmed_scores', ctx=Store(), lineno=575, col_offset=4, end_lineno=575, end_col_offset=18)], value=Subscript(value=Name(id='hydration_scores', ctx=Load(), lineno=575, col_offset=21, end_lineno=575, end_col_offset=37), slice=Slice(upper=Call(func=Name(id='len', ctx=Load(), lineno=575, col_offset=40, end_lineno=575, end_col_offset=43), args=[Name(id='trimmed_ids', ctx=Load(), lineno=575, col_offset=44, end_lineno=575, end_col_offset=55)], lineno=575, col_offset=40, end_lineno=575, end_col_offset=56), lineno=575, col_offset=38, end_lineno=575, end_col_offset=56), ctx=Load(), lineno=575, col_offset=21, end_lineno=575, end_col_offset=57), lineno=575, col_offset=4, end_lineno=575, end_col_offset=57), Return(value=Call(func=Name(id='_HybridResult', ctx=Load(), lineno=576, col_offset=11, end_lineno=576, end_col_offset=24), args=[Name(id='trimmed_ids', ctx=Load(), lineno=577, col_offset=8, end_lineno=577, end_col_offset=19), Name(id='trimmed_scores', ctx=Load(), lineno=578, col_offset=8, end_lineno=578, end_col_offset=22), Name(id='contribution_map', ctx=Load(), lineno=579, col_offset=8, end_lineno=579, end_col_offset=24), Call(func=Name(id='list', ctx=Load(), lineno=580, col_offset=8, end_lineno=580, end_col_offset=12), args=[Name(id='retrieval_channels', ctx=Load(), lineno=580, col_offset=13, end_lineno=580, end_col_offset=31)], lineno=580, col_offset=8, end_lineno=580, end_col_offset=32)], lineno=576, col_offset=11, end_lineno=581, end_col_offset=5), lineno=576, col_offset=4, end_lineno=581, end_col_offset=5)], returns=Name(id='_HybridResult', ctx=Load(), lineno=553, col_offset=5, end_lineno=553, end_col_offset=18), lineno=547, col_offset=0, end_lineno=581, end_col_offset=5), FunctionDef(name='_embed_query_or_raise', args=arguments(args=[arg(arg='client', annotation=Name(id='VLLMClient', ctx=Load(), lineno=585, col_offset=12, end_lineno=585, end_col_offset=22), lineno=585, col_offset=4, end_lineno=585, end_col_offset=22), arg(arg='query', annotation=Name(id='str', ctx=Load(), lineno=586, col_offset=11, end_lineno=586, end_col_offset=14), lineno=586, col_offset=4, end_lineno=586, end_col_offset=14), arg(arg='observation', annotation=Name(id='Observation', ctx=Load(), lineno=587, col_offset=17, end_lineno=587, end_col_offset=28), lineno=587, col_offset=4, end_lineno=587, end_col_offset=28), arg(arg='vllm_url', annotation=Name(id='str', ctx=Load(), lineno=588, col_offset=14, end_lineno=588, end_col_offset=17), lineno=588, col_offset=4, end_lineno=588, end_col_offset=17)]), body=[Expr(value=Constant(value='Embed text or raise with a structured embedding error.\n\n    Parameters\n    ----------\n    client : VLLMClient\n        vLLM client used to emit the embedding.\n    query : str\n        Query text to embed.\n    observation : Observation\n        Duration observation used for marking failure.\n    vllm_url : str\n        URL used for diagnostics in error contexts.\n\n    Returns\n    -------\n    np.ndarray\n        Normalized query vector with shape (1, dim).\n\n    Raises\n    ------\n    EmbeddingError\n        If embedding fails or service is unavailable.\n    ', lineno=590, col_offset=4, end_lineno=612, end_col_offset=7), lineno=590, col_offset=4, end_lineno=612, end_col_offset=7), Assign(targets=[Tuple(elts=[Name(id='embedding', ctx=Store(), lineno=613, col_offset=4, end_lineno=613, end_col_offset=13), Name(id='embed_error', ctx=Store(), lineno=613, col_offset=15, end_lineno=613, end_col_offset=26)], ctx=Store(), lineno=613, col_offset=4, end_lineno=613, end_col_offset=26)], value=Call(func=Name(id='_embed_query', ctx=Load(), lineno=613, col_offset=29, end_lineno=613, end_col_offset=41), args=[Name(id='client', ctx=Load(), lineno=613, col_offset=42, end_lineno=613, end_col_offset=48), Name(id='query', ctx=Load(), lineno=613, col_offset=50, end_lineno=613, end_col_offset=55)], lineno=613, col_offset=29, end_lineno=613, end_col_offset=56), lineno=613, col_offset=4, end_lineno=613, end_col_offset=56), If(test=BoolOp(op=Or(), values=[Compare(left=Name(id='embedding', ctx=Load(), lineno=614, col_offset=7, end_lineno=614, end_col_offset=16), ops=[Is()], comparators=[Constant(value=None, lineno=614, col_offset=20, end_lineno=614, end_col_offset=24)], lineno=614, col_offset=7, end_lineno=614, end_col_offset=24), Compare(left=Name(id='embed_error', ctx=Load(), lineno=614, col_offset=28, end_lineno=614, end_col_offset=39), ops=[IsNot()], comparators=[Constant(value=None, lineno=614, col_offset=47, end_lineno=614, end_col_offset=51)], lineno=614, col_offset=28, end_lineno=614, end_col_offset=51)], lineno=614, col_offset=7, end_lineno=614, end_col_offset=51), body=[Expr(value=Call(func=Attribute(value=Name(id='observation', ctx=Load(), lineno=615, col_offset=8, end_lineno=615, end_col_offset=19), attr='mark_error', ctx=Load(), lineno=615, col_offset=8, end_lineno=615, end_col_offset=30), lineno=615, col_offset=8, end_lineno=615, end_col_offset=32), lineno=615, col_offset=8, end_lineno=615, end_col_offset=32), Raise(exc=Call(func=Name(id='EmbeddingError', ctx=Load(), lineno=616, col_offset=14, end_lineno=616, end_col_offset=28), args=[BoolOp(op=Or(), values=[Name(id='embed_error', ctx=Load(), lineno=617, col_offset=12, end_lineno=617, end_col_offset=23), Constant(value='Embedding service unavailable', lineno=617, col_offset=27, end_lineno=617, end_col_offset=58)], lineno=617, col_offset=12, end_lineno=617, end_col_offset=58)], keywords=[keyword(arg='context', value=Dict(keys=[Constant(value='vllm_url', lineno=618, col_offset=21, end_lineno=618, end_col_offset=31)], values=[Name(id='vllm_url', ctx=Load(), lineno=618, col_offset=33, end_lineno=618, end_col_offset=41)], lineno=618, col_offset=20, end_lineno=618, end_col_offset=42), lineno=618, col_offset=12, end_lineno=618, end_col_offset=42)], lineno=616, col_offset=14, end_lineno=619, end_col_offset=9), lineno=616, col_offset=8, end_lineno=619, end_col_offset=9)], lineno=614, col_offset=4, end_lineno=619, end_col_offset=9), Return(value=Name(id='embedding', ctx=Load(), lineno=621, col_offset=11, end_lineno=621, end_col_offset=20), lineno=621, col_offset=4, end_lineno=621, end_col_offset=20)], returns=Attribute(value=Name(id='np', ctx=Load(), lineno=589, col_offset=5, end_lineno=589, end_col_offset=7), attr='ndarray', ctx=Load(), lineno=589, col_offset=5, end_lineno=589, end_col_offset=15), lineno=584, col_offset=0, end_lineno=621, end_col_offset=20), FunctionDef(name='_run_faiss_search_or_raise', args=arguments(args=[arg(arg='context', annotation=Name(id='ApplicationContext', ctx=Load(), lineno=625, col_offset=13, end_lineno=625, end_col_offset=31), lineno=625, col_offset=4, end_lineno=625, end_col_offset=31), arg(arg='query_vector', annotation=Attribute(value=Name(id='np', ctx=Load(), lineno=626, col_offset=18, end_lineno=626, end_col_offset=20), attr='ndarray', ctx=Load(), lineno=626, col_offset=18, end_lineno=626, end_col_offset=28), lineno=626, col_offset=4, end_lineno=626, end_col_offset=28), arg(arg='limit', annotation=Name(id='int', ctx=Load(), lineno=627, col_offset=11, end_lineno=627, end_col_offset=14), lineno=627, col_offset=4, end_lineno=627, end_col_offset=14), arg(arg='nprobe', annotation=Name(id='int', ctx=Load(), lineno=628, col_offset=12, end_lineno=628, end_col_offset=15), lineno=628, col_offset=4, end_lineno=628, end_col_offset=15), arg(arg='observation', annotation=Name(id='Observation', ctx=Load(), lineno=629, col_offset=17, end_lineno=629, end_col_offset=28), lineno=629, col_offset=4, end_lineno=629, end_col_offset=28)]), body=[Expr(value=Constant(value='Perform FAISS search and raise when the index search fails.\n\n    Parameters\n    ----------\n    context : ApplicationContext\n        Application context providing the FAISS manager and metadata.\n    query_vector : np.ndarray\n        Query vector produced by the embedding service.\n    limit : int\n        Requested fan-out.\n    nprobe : int\n        Number of IVF cells to probe.\n    observation : Observation\n        Observation block used to mark errors.\n\n    Returns\n    -------\n    tuple[list[int], list[float]]\n        Chunk identifiers and their similarity scores.\n\n    Raises\n    ------\n    VectorSearchError\n        If FAISS search fails.\n    ', lineno=631, col_offset=4, end_lineno=655, end_col_offset=7), lineno=631, col_offset=4, end_lineno=655, end_col_offset=7), Assign(targets=[Tuple(elts=[Name(id='result_ids', ctx=Store(), lineno=656, col_offset=4, end_lineno=656, end_col_offset=14), Name(id='result_scores', ctx=Store(), lineno=656, col_offset=16, end_lineno=656, end_col_offset=29), Name(id='search_exc', ctx=Store(), lineno=656, col_offset=31, end_lineno=656, end_col_offset=41)], ctx=Store(), lineno=656, col_offset=4, end_lineno=656, end_col_offset=41)], value=Call(func=Name(id='_run_faiss_search', ctx=Load(), lineno=656, col_offset=44, end_lineno=656, end_col_offset=61), args=[Attribute(value=Name(id='context', ctx=Load(), lineno=657, col_offset=8, end_lineno=657, end_col_offset=15), attr='faiss_manager', ctx=Load(), lineno=657, col_offset=8, end_lineno=657, end_col_offset=29), Name(id='query_vector', ctx=Load(), lineno=658, col_offset=8, end_lineno=658, end_col_offset=20), Name(id='limit', ctx=Load(), lineno=659, col_offset=8, end_lineno=659, end_col_offset=13)], keywords=[keyword(arg='nprobe', value=Name(id='nprobe', ctx=Load(), lineno=660, col_offset=15, end_lineno=660, end_col_offset=21), lineno=660, col_offset=8, end_lineno=660, end_col_offset=21)], lineno=656, col_offset=44, end_lineno=661, end_col_offset=5), lineno=656, col_offset=4, end_lineno=661, end_col_offset=5), If(test=Compare(left=Name(id='search_exc', ctx=Load(), lineno=662, col_offset=7, end_lineno=662, end_col_offset=17), ops=[IsNot()], comparators=[Constant(value=None, lineno=662, col_offset=25, end_lineno=662, end_col_offset=29)], lineno=662, col_offset=7, end_lineno=662, end_col_offset=29), body=[Expr(value=Call(func=Attribute(value=Name(id='observation', ctx=Load(), lineno=663, col_offset=8, end_lineno=663, end_col_offset=19), attr='mark_error', ctx=Load(), lineno=663, col_offset=8, end_lineno=663, end_col_offset=30), lineno=663, col_offset=8, end_lineno=663, end_col_offset=32), lineno=663, col_offset=8, end_lineno=663, end_col_offset=32), Raise(exc=Call(func=Name(id='VectorSearchError', ctx=Load(), lineno=664, col_offset=14, end_lineno=664, end_col_offset=31), args=[Call(func=Name(id='str', ctx=Load(), lineno=665, col_offset=12, end_lineno=665, end_col_offset=15), args=[Name(id='search_exc', ctx=Load(), lineno=665, col_offset=16, end_lineno=665, end_col_offset=26)], lineno=665, col_offset=12, end_lineno=665, end_col_offset=27)], keywords=[keyword(arg='cause', value=Name(id='search_exc', ctx=Load(), lineno=666, col_offset=18, end_lineno=666, end_col_offset=28), lineno=666, col_offset=12, end_lineno=666, end_col_offset=28), keyword(arg='context', value=Dict(keys=[Constant(value='faiss_index', lineno=667, col_offset=21, end_lineno=667, end_col_offset=34)], values=[Call(func=Name(id='str', ctx=Load(), lineno=667, col_offset=36, end_lineno=667, end_col_offset=39), args=[Attribute(value=Attribute(value=Name(id='context', ctx=Load(), lineno=667, col_offset=40, end_lineno=667, end_col_offset=47), attr='paths', ctx=Load(), lineno=667, col_offset=40, end_lineno=667, end_col_offset=53), attr='faiss_index', ctx=Load(), lineno=667, col_offset=40, end_lineno=667, end_col_offset=65)], lineno=667, col_offset=36, end_lineno=667, end_col_offset=66)], lineno=667, col_offset=20, end_lineno=667, end_col_offset=67), lineno=667, col_offset=12, end_lineno=667, end_col_offset=67)], lineno=664, col_offset=14, end_lineno=668, end_col_offset=9), lineno=664, col_offset=8, end_lineno=668, end_col_offset=9)], lineno=662, col_offset=4, end_lineno=668, end_col_offset=9), Return(value=Tuple(elts=[Name(id='result_ids', ctx=Load(), lineno=670, col_offset=11, end_lineno=670, end_col_offset=21), Name(id='result_scores', ctx=Load(), lineno=670, col_offset=23, end_lineno=670, end_col_offset=36)], ctx=Load(), lineno=670, col_offset=11, end_lineno=670, end_col_offset=36), lineno=670, col_offset=4, end_lineno=670, end_col_offset=36)], returns=Subscript(value=Name(id='tuple', ctx=Load(), lineno=630, col_offset=5, end_lineno=630, end_col_offset=10), slice=Tuple(elts=[Subscript(value=Name(id='list', ctx=Load(), lineno=630, col_offset=11, end_lineno=630, end_col_offset=15), slice=Name(id='int', ctx=Load(), lineno=630, col_offset=16, end_lineno=630, end_col_offset=19), ctx=Load(), lineno=630, col_offset=11, end_lineno=630, end_col_offset=20), Subscript(value=Name(id='list', ctx=Load(), lineno=630, col_offset=22, end_lineno=630, end_col_offset=26), slice=Name(id='float', ctx=Load(), lineno=630, col_offset=27, end_lineno=630, end_col_offset=32), ctx=Load(), lineno=630, col_offset=22, end_lineno=630, end_col_offset=33)], ctx=Load(), lineno=630, col_offset=11, end_lineno=630, end_col_offset=33), ctx=Load(), lineno=630, col_offset=5, end_lineno=630, end_col_offset=34), lineno=624, col_offset=0, end_lineno=670, end_col_offset=36), FunctionDef(name='_ensure_hydration_success', args=arguments(args=[arg(arg='hydrate_exc', annotation=BinOp(left=Name(id='Exception', ctx=Load(), lineno=674, col_offset=17, end_lineno=674, end_col_offset=26), op=BitOr(), right=Constant(value=None, lineno=674, col_offset=29, end_lineno=674, end_col_offset=33), lineno=674, col_offset=17, end_lineno=674, end_col_offset=33), lineno=674, col_offset=4, end_lineno=674, end_col_offset=33), arg(arg='observation', annotation=Name(id='Observation', ctx=Load(), lineno=675, col_offset=17, end_lineno=675, end_col_offset=28), lineno=675, col_offset=4, end_lineno=675, end_col_offset=28), arg(arg='context', annotation=Name(id='ApplicationContext', ctx=Load(), lineno=676, col_offset=13, end_lineno=676, end_col_offset=31), lineno=676, col_offset=4, end_lineno=676, end_col_offset=31)]), body=[Expr(value=Constant(value='Stop execution when DuckDB hydration fails.\n\n    Parameters\n    ----------\n    hydrate_exc : Exception | None\n        Exception returned from ``_hydrate_findings``.\n    observation : Observation\n        Observation used to mark the duration as failed.\n    context : ApplicationContext\n        Context for building error metadata.\n\n    Raises\n    ------\n    VectorSearchError\n        If hydration fails.\n    ', lineno=678, col_offset=4, end_lineno=693, end_col_offset=7), lineno=678, col_offset=4, end_lineno=693, end_col_offset=7), If(test=Compare(left=Name(id='hydrate_exc', ctx=Load(), lineno=694, col_offset=7, end_lineno=694, end_col_offset=18), ops=[Is()], comparators=[Constant(value=None, lineno=694, col_offset=22, end_lineno=694, end_col_offset=26)], lineno=694, col_offset=7, end_lineno=694, end_col_offset=26), body=[Return(lineno=695, col_offset=8, end_lineno=695, end_col_offset=14)], lineno=694, col_offset=4, end_lineno=695, end_col_offset=14), Expr(value=Call(func=Attribute(value=Name(id='observation', ctx=Load(), lineno=697, col_offset=4, end_lineno=697, end_col_offset=15), attr='mark_error', ctx=Load(), lineno=697, col_offset=4, end_lineno=697, end_col_offset=26), lineno=697, col_offset=4, end_lineno=697, end_col_offset=28), lineno=697, col_offset=4, end_lineno=697, end_col_offset=28), Raise(exc=Call(func=Name(id='VectorSearchError', ctx=Load(), lineno=698, col_offset=10, end_lineno=698, end_col_offset=27), args=[Call(func=Name(id='str', ctx=Load(), lineno=699, col_offset=8, end_lineno=699, end_col_offset=11), args=[Name(id='hydrate_exc', ctx=Load(), lineno=699, col_offset=12, end_lineno=699, end_col_offset=23)], lineno=699, col_offset=8, end_lineno=699, end_col_offset=24)], keywords=[keyword(arg='cause', value=Name(id='hydrate_exc', ctx=Load(), lineno=700, col_offset=14, end_lineno=700, end_col_offset=25), lineno=700, col_offset=8, end_lineno=700, end_col_offset=25), keyword(arg='context', value=Dict(keys=[Constant(value='duckdb_path', lineno=702, col_offset=12, end_lineno=702, end_col_offset=25), Constant(value='vectors_dir', lineno=703, col_offset=12, end_lineno=703, end_col_offset=25)], values=[Call(func=Name(id='str', ctx=Load(), lineno=702, col_offset=27, end_lineno=702, end_col_offset=30), args=[Attribute(value=Attribute(value=Name(id='context', ctx=Load(), lineno=702, col_offset=31, end_lineno=702, end_col_offset=38), attr='paths', ctx=Load(), lineno=702, col_offset=31, end_lineno=702, end_col_offset=44), attr='duckdb_path', ctx=Load(), lineno=702, col_offset=31, end_lineno=702, end_col_offset=56)], lineno=702, col_offset=27, end_lineno=702, end_col_offset=57), Call(func=Name(id='str', ctx=Load(), lineno=703, col_offset=27, end_lineno=703, end_col_offset=30), args=[Attribute(value=Attribute(value=Name(id='context', ctx=Load(), lineno=703, col_offset=31, end_lineno=703, end_col_offset=38), attr='paths', ctx=Load(), lineno=703, col_offset=31, end_lineno=703, end_col_offset=44), attr='vectors_dir', ctx=Load(), lineno=703, col_offset=31, end_lineno=703, end_col_offset=56)], lineno=703, col_offset=27, end_lineno=703, end_col_offset=57)], lineno=701, col_offset=16, end_lineno=704, end_col_offset=9), lineno=701, col_offset=8, end_lineno=704, end_col_offset=9)], lineno=698, col_offset=10, end_lineno=705, end_col_offset=5), lineno=698, col_offset=4, end_lineno=705, end_col_offset=5)], returns=Constant(value=None, lineno=677, col_offset=5, end_lineno=677, end_col_offset=9), lineno=673, col_offset=0, end_lineno=705, end_col_offset=5), FunctionDef(name='_warn_scope_filter_reduction', args=arguments(args=[arg(arg='scope', annotation=BinOp(left=Name(id='ScopeIn', ctx=Load(), lineno=709, col_offset=11, end_lineno=709, end_col_offset=18), op=BitOr(), right=Constant(value=None, lineno=709, col_offset=21, end_lineno=709, end_col_offset=25), lineno=709, col_offset=11, end_lineno=709, end_col_offset=25), lineno=709, col_offset=4, end_lineno=709, end_col_offset=25), arg(arg='scope_flags', annotation=Name(id='_ScopeFilterFlags', ctx=Load(), lineno=710, col_offset=17, end_lineno=710, end_col_offset=34), lineno=710, col_offset=4, end_lineno=710, end_col_offset=34), arg(arg='findings_count', annotation=Name(id='int', ctx=Load(), lineno=711, col_offset=20, end_lineno=711, end_col_offset=23), lineno=711, col_offset=4, end_lineno=711, end_col_offset=23), arg(arg='effective_limit', annotation=Name(id='int', ctx=Load(), lineno=712, col_offset=21, end_lineno=712, end_col_offset=24), lineno=712, col_offset=4, end_lineno=712, end_col_offset=24), arg(arg='faiss_result_count', annotation=Name(id='int', ctx=Load(), lineno=713, col_offset=24, end_lineno=713, end_col_offset=27), lineno=713, col_offset=4, end_lineno=713, end_col_offset=27)]), body=[Expr(value=Constant(value='Log when scope filtering reduces the result set below the requested limit.\n\n    Parameters\n    ----------\n    scope : ScopeIn | None\n        Applied scope configuration.\n    scope_flags : _ScopeFilterFlags\n        Flags describing the active scope filters.\n    findings_count : int\n        Number of findings returned to the client.\n    effective_limit : int\n        Limit applied after clamping.\n    faiss_result_count : int\n        Number of results returned from FAISS prior to filtering.\n    ', lineno=715, col_offset=4, end_lineno=729, end_col_offset=7), lineno=715, col_offset=4, end_lineno=729, end_col_offset=7), If(test=UnaryOp(op=Not(), operand=BoolOp(op=And(), values=[Name(id='scope', ctx=Load(), lineno=730, col_offset=12, end_lineno=730, end_col_offset=17), Attribute(value=Name(id='scope_flags', ctx=Load(), lineno=730, col_offset=22, end_lineno=730, end_col_offset=33), attr='has_filters', ctx=Load(), lineno=730, col_offset=22, end_lineno=730, end_col_offset=45), Compare(left=Name(id='findings_count', ctx=Load(), lineno=730, col_offset=50, end_lineno=730, end_col_offset=64), ops=[Lt()], comparators=[Name(id='effective_limit', ctx=Load(), lineno=730, col_offset=67, end_lineno=730, end_col_offset=82)], lineno=730, col_offset=50, end_lineno=730, end_col_offset=82)], lineno=730, col_offset=12, end_lineno=730, end_col_offset=82), lineno=730, col_offset=7, end_lineno=730, end_col_offset=83), body=[Return(lineno=731, col_offset=8, end_lineno=731, end_col_offset=14)], lineno=730, col_offset=4, end_lineno=731, end_col_offset=14), Expr(value=Call(func=Attribute(value=Name(id='LOGGER', ctx=Load(), lineno=733, col_offset=4, end_lineno=733, end_col_offset=10), attr='warning', ctx=Load(), lineno=733, col_offset=4, end_lineno=733, end_col_offset=18), args=[Constant(value='Scope filtering reduced results below requested limit', lineno=734, col_offset=8, end_lineno=734, end_col_offset=63)], keywords=[keyword(arg='extra', value=Dict(keys=[Constant(value='requested_limit', lineno=736, col_offset=12, end_lineno=736, end_col_offset=29), Constant(value='actual_count', lineno=737, col_offset=12, end_lineno=737, end_col_offset=26), Constant(value='faiss_results', lineno=738, col_offset=12, end_lineno=738, end_col_offset=27), Constant(value='has_include_globs', lineno=739, col_offset=12, end_lineno=739, end_col_offset=31), Constant(value='has_exclude_globs', lineno=740, col_offset=12, end_lineno=740, end_col_offset=31), Constant(value='has_languages', lineno=741, col_offset=12, end_lineno=741, end_col_offset=27)], values=[Name(id='effective_limit', ctx=Load(), lineno=736, col_offset=31, end_lineno=736, end_col_offset=46), Name(id='findings_count', ctx=Load(), lineno=737, col_offset=28, end_lineno=737, end_col_offset=42), Name(id='faiss_result_count', ctx=Load(), lineno=738, col_offset=29, end_lineno=738, end_col_offset=47), Attribute(value=Name(id='scope_flags', ctx=Load(), lineno=739, col_offset=33, end_lineno=739, end_col_offset=44), attr='has_include_globs', ctx=Load(), lineno=739, col_offset=33, end_lineno=739, end_col_offset=62), Attribute(value=Name(id='scope_flags', ctx=Load(), lineno=740, col_offset=33, end_lineno=740, end_col_offset=44), attr='has_exclude_globs', ctx=Load(), lineno=740, col_offset=33, end_lineno=740, end_col_offset=62), Attribute(value=Name(id='scope_flags', ctx=Load(), lineno=741, col_offset=29, end_lineno=741, end_col_offset=40), attr='has_languages', ctx=Load(), lineno=741, col_offset=29, end_lineno=741, end_col_offset=54)], lineno=735, col_offset=14, end_lineno=742, end_col_offset=9), lineno=735, col_offset=8, end_lineno=742, end_col_offset=9)], lineno=733, col_offset=4, end_lineno=743, end_col_offset=5), lineno=733, col_offset=4, end_lineno=743, end_col_offset=5)], returns=Constant(value=None, lineno=714, col_offset=5, end_lineno=714, end_col_offset=9), lineno=708, col_offset=0, end_lineno=743, end_col_offset=5), FunctionDef(name='_annotate_hybrid_contributions', args=arguments(args=[arg(arg='findings', annotation=Subscript(value=Name(id='list', ctx=Load(), lineno=747, col_offset=14, end_lineno=747, end_col_offset=18), slice=Name(id='Finding', ctx=Load(), lineno=747, col_offset=19, end_lineno=747, end_col_offset=26), ctx=Load(), lineno=747, col_offset=14, end_lineno=747, end_col_offset=27), lineno=747, col_offset=4, end_lineno=747, end_col_offset=27), arg(arg='contribution_map', annotation=BinOp(left=Subscript(value=Name(id='dict', ctx=Load(), lineno=748, col_offset=22, end_lineno=748, end_col_offset=26), slice=Tuple(elts=[Name(id='int', ctx=Load(), lineno=748, col_offset=27, end_lineno=748, end_col_offset=30), Subscript(value=Name(id='list', ctx=Load(), lineno=748, col_offset=32, end_lineno=748, end_col_offset=36), slice=Subscript(value=Name(id='tuple', ctx=Load(), lineno=748, col_offset=37, end_lineno=748, end_col_offset=42), slice=Tuple(elts=[Name(id='str', ctx=Load(), lineno=748, col_offset=43, end_lineno=748, end_col_offset=46), Name(id='int', ctx=Load(), lineno=748, col_offset=48, end_lineno=748, end_col_offset=51), Name(id='float', ctx=Load(), lineno=748, col_offset=53, end_lineno=748, end_col_offset=58)], ctx=Load(), lineno=748, col_offset=43, end_lineno=748, end_col_offset=58), ctx=Load(), lineno=748, col_offset=37, end_lineno=748, end_col_offset=59), ctx=Load(), lineno=748, col_offset=32, end_lineno=748, end_col_offset=60)], ctx=Load(), lineno=748, col_offset=27, end_lineno=748, end_col_offset=60), ctx=Load(), lineno=748, col_offset=22, end_lineno=748, end_col_offset=61), op=BitOr(), right=Constant(value=None, lineno=748, col_offset=64, end_lineno=748, end_col_offset=68), lineno=748, col_offset=22, end_lineno=748, end_col_offset=68), lineno=748, col_offset=4, end_lineno=748, end_col_offset=68), arg(arg='rrf_k', annotation=Name(id='int', ctx=Load(), lineno=749, col_offset=11, end_lineno=749, end_col_offset=14), lineno=749, col_offset=4, end_lineno=749, end_col_offset=14)]), body=[Expr(value=Constant(value='Attach hybrid contribution narratives to findings when available.\n\n    Parameters\n    ----------\n    findings : list[Finding]\n        Findings returned to the client.\n    contribution_map : dict[int, list[tuple[str, int, float]]] | None\n        Contribution information keyed by chunk id.\n    rrf_k : int\n        Reciprocal rank fusion parameter used for the narrative.\n    ', lineno=751, col_offset=4, end_lineno=761, end_col_offset=7), lineno=751, col_offset=4, end_lineno=761, end_col_offset=7), If(test=UnaryOp(op=Not(), operand=Name(id='contribution_map', ctx=Load(), lineno=762, col_offset=11, end_lineno=762, end_col_offset=27), lineno=762, col_offset=7, end_lineno=762, end_col_offset=27), body=[Return(lineno=763, col_offset=8, end_lineno=763, end_col_offset=14)], lineno=762, col_offset=4, end_lineno=763, end_col_offset=14), For(target=Name(id='finding', ctx=Store(), lineno=765, col_offset=8, end_lineno=765, end_col_offset=15), iter=Name(id='findings', ctx=Load(), lineno=765, col_offset=19, end_lineno=765, end_col_offset=27), body=[Assign(targets=[Name(id='chunk_id_value', ctx=Store(), lineno=766, col_offset=8, end_lineno=766, end_col_offset=22)], value=Call(func=Attribute(value=Name(id='finding', ctx=Load(), lineno=766, col_offset=25, end_lineno=766, end_col_offset=32), attr='get', ctx=Load(), lineno=766, col_offset=25, end_lineno=766, end_col_offset=36), args=[Constant(value='chunk_id', lineno=766, col_offset=37, end_lineno=766, end_col_offset=47)], lineno=766, col_offset=25, end_lineno=766, end_col_offset=48), lineno=766, col_offset=8, end_lineno=766, end_col_offset=48), If(test=Compare(left=Name(id='chunk_id_value', ctx=Load(), lineno=767, col_offset=11, end_lineno=767, end_col_offset=25), ops=[Is()], comparators=[Constant(value=None, lineno=767, col_offset=29, end_lineno=767, end_col_offset=33)], lineno=767, col_offset=11, end_lineno=767, end_col_offset=33), body=[Continue(lineno=768, col_offset=12, end_lineno=768, end_col_offset=20)], lineno=767, col_offset=8, end_lineno=768, end_col_offset=20), Assign(targets=[Name(id='contributions', ctx=Store(), lineno=769, col_offset=8, end_lineno=769, end_col_offset=21)], value=Call(func=Attribute(value=Name(id='contribution_map', ctx=Load(), lineno=769, col_offset=24, end_lineno=769, end_col_offset=40), attr='get', ctx=Load(), lineno=769, col_offset=24, end_lineno=769, end_col_offset=44), args=[Call(func=Name(id='int', ctx=Load(), lineno=769, col_offset=45, end_lineno=769, end_col_offset=48), args=[Name(id='chunk_id_value', ctx=Load(), lineno=769, col_offset=49, end_lineno=769, end_col_offset=63)], lineno=769, col_offset=45, end_lineno=769, end_col_offset=64)], lineno=769, col_offset=24, end_lineno=769, end_col_offset=65), lineno=769, col_offset=8, end_lineno=769, end_col_offset=65), If(test=UnaryOp(op=Not(), operand=Name(id='contributions', ctx=Load(), lineno=770, col_offset=15, end_lineno=770, end_col_offset=28), lineno=770, col_offset=11, end_lineno=770, end_col_offset=28), body=[Continue(lineno=771, col_offset=12, end_lineno=771, end_col_offset=20)], lineno=770, col_offset=8, end_lineno=771, end_col_offset=20), Assign(targets=[Name(id='parts', ctx=Store(), lineno=773, col_offset=8, end_lineno=773, end_col_offset=13)], value=ListComp(elt=JoinedStr(values=[FormattedValue(value=Name(id='channel', ctx=Load(), lineno=773, col_offset=20, end_lineno=773, end_col_offset=27), conversion=-1, lineno=773, col_offset=19, end_lineno=773, end_col_offset=28), Constant(value=' rank=', lineno=773, col_offset=28, end_lineno=773, end_col_offset=34), FormattedValue(value=Name(id='rank', ctx=Load(), lineno=773, col_offset=35, end_lineno=773, end_col_offset=39), conversion=-1, lineno=773, col_offset=34, end_lineno=773, end_col_offset=40)], lineno=773, col_offset=17, end_lineno=773, end_col_offset=41), generators=[comprehension(target=Tuple(elts=[Name(id='channel', ctx=Store(), lineno=773, col_offset=46, end_lineno=773, end_col_offset=53), Name(id='rank', ctx=Store(), lineno=773, col_offset=55, end_lineno=773, end_col_offset=59), Name(id='_', ctx=Store(), lineno=773, col_offset=61, end_lineno=773, end_col_offset=62)], ctx=Store(), lineno=773, col_offset=46, end_lineno=773, end_col_offset=62), iter=Name(id='contributions', ctx=Load(), lineno=773, col_offset=66, end_lineno=773, end_col_offset=79), is_async=0)], lineno=773, col_offset=16, end_lineno=773, end_col_offset=80), lineno=773, col_offset=8, end_lineno=773, end_col_offset=80), Assign(targets=[Subscript(value=Name(id='finding', ctx=Load(), lineno=774, col_offset=8, end_lineno=774, end_col_offset=15), slice=Constant(value='why', lineno=774, col_offset=16, end_lineno=774, end_col_offset=21), ctx=Store(), lineno=774, col_offset=8, end_lineno=774, end_col_offset=22)], value=BinOp(left=JoinedStr(values=[Constant(value='Hybrid RRF (k=', lineno=774, col_offset=27, end_lineno=774, end_col_offset=41), FormattedValue(value=Name(id='rrf_k', ctx=Load(), lineno=774, col_offset=42, end_lineno=774, end_col_offset=47), conversion=-1, lineno=774, col_offset=41, end_lineno=774, end_col_offset=48), Constant(value='): ', lineno=774, col_offset=48, end_lineno=774, end_col_offset=51)], lineno=774, col_offset=25, end_lineno=774, end_col_offset=52), op=Add(), right=Call(func=Attribute(value=Constant(value=', ', lineno=774, col_offset=55, end_lineno=774, end_col_offset=59), attr='join', ctx=Load(), lineno=774, col_offset=55, end_lineno=774, end_col_offset=64), args=[Name(id='parts', ctx=Load(), lineno=774, col_offset=65, end_lineno=774, end_col_offset=70)], lineno=774, col_offset=55, end_lineno=774, end_col_offset=71), lineno=774, col_offset=25, end_lineno=774, end_col_offset=71), lineno=774, col_offset=8, end_lineno=774, end_col_offset=71)], lineno=765, col_offset=4, end_lineno=774, end_col_offset=71)], returns=Constant(value=None, lineno=750, col_offset=5, end_lineno=750, end_col_offset=9), lineno=746, col_offset=0, end_lineno=774, end_col_offset=71), FunctionDef(name='_embed_query', args=arguments(args=[arg(arg='client', annotation=Name(id='VLLMClient', ctx=Load(), lineno=777, col_offset=25, end_lineno=777, end_col_offset=35), lineno=777, col_offset=17, end_lineno=777, end_col_offset=35), arg(arg='query', annotation=Name(id='str', ctx=Load(), lineno=777, col_offset=44, end_lineno=777, end_col_offset=47), lineno=777, col_offset=37, end_lineno=777, end_col_offset=47)]), body=[Expr(value=Constant(value='Embed query text and return a normalized vector and error message.\n\n    Parameters\n    ----------\n    client : VLLMClient\n        vLLM client for generating embeddings.\n    query : str\n        Query text to embed.\n\n    Returns\n    -------\n    tuple[np.ndarray | None, str | None]\n        Pair of (query_vector, error_message). Exactly one element will be ``None``.\n    ', lineno=778, col_offset=4, end_lineno=791, end_col_offset=7), lineno=778, col_offset=4, end_lineno=791, end_col_offset=7), Try(body=[Assign(targets=[Name(id='vector', ctx=Store(), lineno=793, col_offset=8, end_lineno=793, end_col_offset=14)], value=Call(func=Attribute(value=Name(id='client', ctx=Load(), lineno=793, col_offset=17, end_lineno=793, end_col_offset=23), attr='embed_single', ctx=Load(), lineno=793, col_offset=17, end_lineno=793, end_col_offset=36), args=[Name(id='query', ctx=Load(), lineno=793, col_offset=37, end_lineno=793, end_col_offset=42)], lineno=793, col_offset=17, end_lineno=793, end_col_offset=43), lineno=793, col_offset=8, end_lineno=793, end_col_offset=43)], handlers=[ExceptHandler(type=Tuple(elts=[Name(id='RuntimeError', ctx=Load(), lineno=794, col_offset=12, end_lineno=794, end_col_offset=24), Name(id='ValueError', ctx=Load(), lineno=794, col_offset=26, end_lineno=794, end_col_offset=36), Attribute(value=Name(id='httpx', ctx=Load(), lineno=794, col_offset=38, end_lineno=794, end_col_offset=43), attr='HTTPError', ctx=Load(), lineno=794, col_offset=38, end_lineno=794, end_col_offset=53)], ctx=Load(), lineno=794, col_offset=11, end_lineno=794, end_col_offset=54), name='exc', body=[Return(value=Tuple(elts=[Constant(value=None, lineno=795, col_offset=15, end_lineno=795, end_col_offset=19), JoinedStr(values=[Constant(value='Embedding service unavailable: ', lineno=795, col_offset=23, end_lineno=795, end_col_offset=54), FormattedValue(value=Name(id='exc', ctx=Load(), lineno=795, col_offset=55, end_lineno=795, end_col_offset=58), conversion=-1, lineno=795, col_offset=54, end_lineno=795, end_col_offset=59)], lineno=795, col_offset=21, end_lineno=795, end_col_offset=60)], ctx=Load(), lineno=795, col_offset=15, end_lineno=795, end_col_offset=60), lineno=795, col_offset=8, end_lineno=795, end_col_offset=60)], lineno=794, col_offset=4, end_lineno=795, end_col_offset=60)], lineno=792, col_offset=4, end_lineno=795, end_col_offset=60), Assign(targets=[Name(id='array', ctx=Store(), lineno=797, col_offset=4, end_lineno=797, end_col_offset=9)], value=Call(func=Attribute(value=Call(func=Attribute(value=Name(id='np', ctx=Load(), lineno=797, col_offset=12, end_lineno=797, end_col_offset=14), attr='array', ctx=Load(), lineno=797, col_offset=12, end_lineno=797, end_col_offset=20), args=[Name(id='vector', ctx=Load(), lineno=797, col_offset=21, end_lineno=797, end_col_offset=27)], keywords=[keyword(arg='dtype', value=Attribute(value=Name(id='np', ctx=Load(), lineno=797, col_offset=35, end_lineno=797, end_col_offset=37), attr='float32', ctx=Load(), lineno=797, col_offset=35, end_lineno=797, end_col_offset=45), lineno=797, col_offset=29, end_lineno=797, end_col_offset=45)], lineno=797, col_offset=12, end_lineno=797, end_col_offset=46), attr='reshape', ctx=Load(), lineno=797, col_offset=12, end_lineno=797, end_col_offset=54), args=[Constant(value=1, lineno=797, col_offset=55, end_lineno=797, end_col_offset=56), UnaryOp(op=USub(), operand=Constant(value=1, lineno=797, col_offset=59, end_lineno=797, end_col_offset=60), lineno=797, col_offset=58, end_lineno=797, end_col_offset=60)], lineno=797, col_offset=12, end_lineno=797, end_col_offset=61), lineno=797, col_offset=4, end_lineno=797, end_col_offset=61), Return(value=Tuple(elts=[Name(id='array', ctx=Load(), lineno=798, col_offset=11, end_lineno=798, end_col_offset=16), Constant(value=None, lineno=798, col_offset=18, end_lineno=798, end_col_offset=22)], ctx=Load(), lineno=798, col_offset=11, end_lineno=798, end_col_offset=22), lineno=798, col_offset=4, end_lineno=798, end_col_offset=22)], returns=Subscript(value=Name(id='tuple', ctx=Load(), lineno=777, col_offset=52, end_lineno=777, end_col_offset=57), slice=Tuple(elts=[BinOp(left=Attribute(value=Name(id='np', ctx=Load(), lineno=777, col_offset=58, end_lineno=777, end_col_offset=60), attr='ndarray', ctx=Load(), lineno=777, col_offset=58, end_lineno=777, end_col_offset=68), op=BitOr(), right=Constant(value=None, lineno=777, col_offset=71, end_lineno=777, end_col_offset=75), lineno=777, col_offset=58, end_lineno=777, end_col_offset=75), BinOp(left=Name(id='str', ctx=Load(), lineno=777, col_offset=77, end_lineno=777, end_col_offset=80), op=BitOr(), right=Constant(value=None, lineno=777, col_offset=83, end_lineno=777, end_col_offset=87), lineno=777, col_offset=77, end_lineno=777, end_col_offset=87)], ctx=Load(), lineno=777, col_offset=58, end_lineno=777, end_col_offset=87), ctx=Load(), lineno=777, col_offset=52, end_lineno=777, end_col_offset=88), lineno=777, col_offset=0, end_lineno=798, end_col_offset=22), FunctionDef(name='_run_faiss_search', args=arguments(args=[arg(arg='faiss_mgr', annotation=Name(id='FAISSManager', ctx=Load(), lineno=802, col_offset=15, end_lineno=802, end_col_offset=27), lineno=802, col_offset=4, end_lineno=802, end_col_offset=27), arg(arg='query_vector', annotation=Attribute(value=Name(id='np', ctx=Load(), lineno=803, col_offset=18, end_lineno=803, end_col_offset=20), attr='ndarray', ctx=Load(), lineno=803, col_offset=18, end_lineno=803, end_col_offset=28), lineno=803, col_offset=4, end_lineno=803, end_col_offset=28), arg(arg='limit', annotation=Name(id='int', ctx=Load(), lineno=804, col_offset=11, end_lineno=804, end_col_offset=14), lineno=804, col_offset=4, end_lineno=804, end_col_offset=14)], kwonlyargs=[arg(arg='nprobe', annotation=Name(id='int', ctx=Load(), lineno=806, col_offset=12, end_lineno=806, end_col_offset=15), lineno=806, col_offset=4, end_lineno=806, end_col_offset=15)], kw_defaults=[None]), body=[Expr(value=Constant(value='Execute FAISS search and return result identifiers and scores.\n\n    Parameters\n    ----------\n    faiss_mgr : FAISSManager\n        FAISS index manager instance.\n    query_vector : np.ndarray\n        Query vector of shape (1, vec_dim).\n    limit : int\n        Maximum number of results to return.\n    nprobe : int\n        Number of IVF cells to probe during the search. Higher values improve\n        recall at the cost of latency. Passed directly to\n        :meth:`FAISSManager.search`.\n\n    Returns\n    -------\n    tuple[list[int], list[float], Exception | None]\n        Tuple of (chunk_ids, distances, error). ``error`` is ``None`` when the\n        search succeeds; otherwise it contains the triggering exception.\n    ', lineno=808, col_offset=4, end_lineno=828, end_col_offset=7), lineno=808, col_offset=4, end_lineno=828, end_col_offset=7), Try(body=[Assign(targets=[Tuple(elts=[Name(id='distances', ctx=Store(), lineno=830, col_offset=8, end_lineno=830, end_col_offset=17), Name(id='ids', ctx=Store(), lineno=830, col_offset=19, end_lineno=830, end_col_offset=22)], ctx=Store(), lineno=830, col_offset=8, end_lineno=830, end_col_offset=22)], value=Call(func=Attribute(value=Name(id='faiss_mgr', ctx=Load(), lineno=830, col_offset=25, end_lineno=830, end_col_offset=34), attr='search', ctx=Load(), lineno=830, col_offset=25, end_lineno=830, end_col_offset=41), args=[Name(id='query_vector', ctx=Load(), lineno=830, col_offset=42, end_lineno=830, end_col_offset=54)], keywords=[keyword(arg='k', value=Name(id='limit', ctx=Load(), lineno=830, col_offset=58, end_lineno=830, end_col_offset=63), lineno=830, col_offset=56, end_lineno=830, end_col_offset=63), keyword(arg='nprobe', value=Name(id='nprobe', ctx=Load(), lineno=830, col_offset=72, end_lineno=830, end_col_offset=78), lineno=830, col_offset=65, end_lineno=830, end_col_offset=78)], lineno=830, col_offset=25, end_lineno=830, end_col_offset=79), lineno=830, col_offset=8, end_lineno=830, end_col_offset=79)], handlers=[ExceptHandler(type=Name(id='RuntimeError', ctx=Load(), lineno=831, col_offset=11, end_lineno=831, end_col_offset=23), name='exc', body=[Return(value=Tuple(elts=[List(ctx=Load(), lineno=832, col_offset=15, end_lineno=832, end_col_offset=17), List(ctx=Load(), lineno=832, col_offset=19, end_lineno=832, end_col_offset=21), Name(id='exc', ctx=Load(), lineno=832, col_offset=23, end_lineno=832, end_col_offset=26)], ctx=Load(), lineno=832, col_offset=15, end_lineno=832, end_col_offset=26), lineno=832, col_offset=8, end_lineno=832, end_col_offset=26)], lineno=831, col_offset=4, end_lineno=832, end_col_offset=26)], lineno=829, col_offset=4, end_lineno=832, end_col_offset=26), Return(value=Tuple(elts=[Call(func=Attribute(value=Subscript(value=Name(id='ids', ctx=Load(), lineno=834, col_offset=11, end_lineno=834, end_col_offset=14), slice=Constant(value=0, lineno=834, col_offset=15, end_lineno=834, end_col_offset=16), ctx=Load(), lineno=834, col_offset=11, end_lineno=834, end_col_offset=17), attr='tolist', ctx=Load(), lineno=834, col_offset=11, end_lineno=834, end_col_offset=24), lineno=834, col_offset=11, end_lineno=834, end_col_offset=26), Call(func=Attribute(value=Subscript(value=Name(id='distances', ctx=Load(), lineno=834, col_offset=28, end_lineno=834, end_col_offset=37), slice=Constant(value=0, lineno=834, col_offset=38, end_lineno=834, end_col_offset=39), ctx=Load(), lineno=834, col_offset=28, end_lineno=834, end_col_offset=40), attr='tolist', ctx=Load(), lineno=834, col_offset=28, end_lineno=834, end_col_offset=47), lineno=834, col_offset=28, end_lineno=834, end_col_offset=49), Constant(value=None, lineno=834, col_offset=51, end_lineno=834, end_col_offset=55)], ctx=Load(), lineno=834, col_offset=11, end_lineno=834, end_col_offset=55), lineno=834, col_offset=4, end_lineno=834, end_col_offset=55)], returns=Subscript(value=Name(id='tuple', ctx=Load(), lineno=807, col_offset=5, end_lineno=807, end_col_offset=10), slice=Tuple(elts=[Subscript(value=Name(id='list', ctx=Load(), lineno=807, col_offset=11, end_lineno=807, end_col_offset=15), slice=Name(id='int', ctx=Load(), lineno=807, col_offset=16, end_lineno=807, end_col_offset=19), ctx=Load(), lineno=807, col_offset=11, end_lineno=807, end_col_offset=20), Subscript(value=Name(id='list', ctx=Load(), lineno=807, col_offset=22, end_lineno=807, end_col_offset=26), slice=Name(id='float', ctx=Load(), lineno=807, col_offset=27, end_lineno=807, end_col_offset=32), ctx=Load(), lineno=807, col_offset=22, end_lineno=807, end_col_offset=33), BinOp(left=Name(id='Exception', ctx=Load(), lineno=807, col_offset=35, end_lineno=807, end_col_offset=44), op=BitOr(), right=Constant(value=None, lineno=807, col_offset=47, end_lineno=807, end_col_offset=51), lineno=807, col_offset=35, end_lineno=807, end_col_offset=51)], ctx=Load(), lineno=807, col_offset=11, end_lineno=807, end_col_offset=51), ctx=Load(), lineno=807, col_offset=5, end_lineno=807, end_col_offset=52), lineno=801, col_offset=0, end_lineno=834, end_col_offset=55), FunctionDef(name='_hydrate_findings', args=arguments(args=[arg(arg='context', annotation=Name(id='ApplicationContext', ctx=Load(), lineno=838, col_offset=13, end_lineno=838, end_col_offset=31), lineno=838, col_offset=4, end_lineno=838, end_col_offset=31), arg(arg='chunk_ids', annotation=Subscript(value=Name(id='Sequence', ctx=Load(), lineno=839, col_offset=15, end_lineno=839, end_col_offset=23), slice=Name(id='int', ctx=Load(), lineno=839, col_offset=24, end_lineno=839, end_col_offset=27), ctx=Load(), lineno=839, col_offset=15, end_lineno=839, end_col_offset=28), lineno=839, col_offset=4, end_lineno=839, end_col_offset=28), arg(arg='scores', annotation=Subscript(value=Name(id='Sequence', ctx=Load(), lineno=840, col_offset=12, end_lineno=840, end_col_offset=20), slice=Name(id='float', ctx=Load(), lineno=840, col_offset=21, end_lineno=840, end_col_offset=26), ctx=Load(), lineno=840, col_offset=12, end_lineno=840, end_col_offset=27), lineno=840, col_offset=4, end_lineno=840, end_col_offset=27)], kwonlyargs=[arg(arg='scope', annotation=BinOp(left=Name(id='ScopeIn', ctx=Load(), lineno=842, col_offset=11, end_lineno=842, end_col_offset=18), op=BitOr(), right=Constant(value=None, lineno=842, col_offset=21, end_lineno=842, end_col_offset=25), lineno=842, col_offset=11, end_lineno=842, end_col_offset=25), lineno=842, col_offset=4, end_lineno=842, end_col_offset=25)], kw_defaults=[Constant(value=None, lineno=842, col_offset=28, end_lineno=842, end_col_offset=32)]), body=[Expr(value=Constant(value='Hydrate FAISS search results from DuckDB.\n\n    Applies scope filters (path globs, languages) during chunk hydration if scope\n    is provided. FAISS search is performed without scope constraints, then results\n    are filtered via DuckDB catalog queries.\n\n    Parameters\n    ----------\n    context : ApplicationContext\n        Application context for accessing DuckDB catalog.\n    chunk_ids : Sequence[int]\n        Chunk identifiers from FAISS search.\n    scores : Sequence[float]\n        Similarity scores aligned with chunk_ids.\n    scope : ScopeIn | None, optional\n        Session scope with optional `include_globs`, `exclude_globs`, and `languages`\n        fields. If provided and contains filters, uses `query_by_filters` instead of\n        `query_by_ids`. Defaults to None.\n\n    Returns\n    -------\n    tuple[list[Finding], Exception | None]\n        Findings constructed from the catalog and optional hydration exception.\n\n    Notes\n    -----\n    Scope Filtering:\n    - If scope has `include_globs`, `exclude_globs`, or `languages`, uses\n      `catalog.query_by_filters()` to filter chunks by path patterns and file\n      extensions.\n    - If scope is None or has no filters, uses `catalog.query_by_ids()` for\n      unfiltered retrieval (backward compatible).\n    - Filtering happens during DuckDB hydration (post-FAISS), so FAISS search\n      may return more IDs than needed to compensate for filtering.\n    ', lineno=844, col_offset=4, end_lineno=878, end_col_offset=7), lineno=844, col_offset=4, end_lineno=878, end_col_offset=7), AnnAssign(target=Name(id='findings', ctx=Store(), lineno=879, col_offset=4, end_lineno=879, end_col_offset=12), annotation=Subscript(value=Name(id='list', ctx=Load(), lineno=879, col_offset=14, end_lineno=879, end_col_offset=18), slice=Name(id='Finding', ctx=Load(), lineno=879, col_offset=19, end_lineno=879, end_col_offset=26), ctx=Load(), lineno=879, col_offset=14, end_lineno=879, end_col_offset=27), value=List(ctx=Load(), lineno=879, col_offset=30, end_lineno=879, end_col_offset=32), simple=1, lineno=879, col_offset=4, end_lineno=879, end_col_offset=32), Try(body=[With(items=[withitem(context_expr=Call(func=Attribute(value=Name(id='context', ctx=Load(), lineno=881, col_offset=13, end_lineno=881, end_col_offset=20), attr='open_catalog', ctx=Load(), lineno=881, col_offset=13, end_lineno=881, end_col_offset=33), lineno=881, col_offset=13, end_lineno=881, end_col_offset=35), optional_vars=Name(id='catalog', ctx=Store(), lineno=881, col_offset=39, end_lineno=881, end_col_offset=46))], body=[Assign(targets=[Name(id='valid_ids', ctx=Store(), lineno=882, col_offset=12, end_lineno=882, end_col_offset=21)], value=ListComp(elt=Call(func=Name(id='int', ctx=Load(), lineno=882, col_offset=25, end_lineno=882, end_col_offset=28), args=[Name(id='chunk_id', ctx=Load(), lineno=882, col_offset=29, end_lineno=882, end_col_offset=37)], lineno=882, col_offset=25, end_lineno=882, end_col_offset=38), generators=[comprehension(target=Name(id='chunk_id', ctx=Store(), lineno=882, col_offset=43, end_lineno=882, end_col_offset=51), iter=Name(id='chunk_ids', ctx=Load(), lineno=882, col_offset=55, end_lineno=882, end_col_offset=64), ifs=[Compare(left=Name(id='chunk_id', ctx=Load(), lineno=882, col_offset=68, end_lineno=882, end_col_offset=76), ops=[GtE()], comparators=[Constant(value=0, lineno=882, col_offset=80, end_lineno=882, end_col_offset=81)], lineno=882, col_offset=68, end_lineno=882, end_col_offset=81)], is_async=0)], lineno=882, col_offset=24, end_lineno=882, end_col_offset=82), lineno=882, col_offset=12, end_lineno=882, end_col_offset=82), If(test=UnaryOp(op=Not(), operand=Name(id='valid_ids', ctx=Load(), lineno=883, col_offset=19, end_lineno=883, end_col_offset=28), lineno=883, col_offset=15, end_lineno=883, end_col_offset=28), body=[Return(value=Tuple(elts=[List(ctx=Load(), lineno=884, col_offset=23, end_lineno=884, end_col_offset=25), Constant(value=None, lineno=884, col_offset=27, end_lineno=884, end_col_offset=31)], ctx=Load(), lineno=884, col_offset=23, end_lineno=884, end_col_offset=31), lineno=884, col_offset=16, end_lineno=884, end_col_offset=31)], lineno=883, col_offset=12, end_lineno=884, end_col_offset=31), AnnAssign(target=Name(id='include_globs', ctx=Store(), lineno=886, col_offset=12, end_lineno=886, end_col_offset=25), annotation=BinOp(left=Subscript(value=Name(id='list', ctx=Load(), lineno=886, col_offset=27, end_lineno=886, end_col_offset=31), slice=Name(id='str', ctx=Load(), lineno=886, col_offset=32, end_lineno=886, end_col_offset=35), ctx=Load(), lineno=886, col_offset=27, end_lineno=886, end_col_offset=36), op=BitOr(), right=Constant(value=None, lineno=886, col_offset=39, end_lineno=886, end_col_offset=43), lineno=886, col_offset=27, end_lineno=886, end_col_offset=43), simple=1, lineno=886, col_offset=12, end_lineno=886, end_col_offset=43), AnnAssign(target=Name(id='exclude_globs', ctx=Store(), lineno=887, col_offset=12, end_lineno=887, end_col_offset=25), annotation=BinOp(left=Subscript(value=Name(id='list', ctx=Load(), lineno=887, col_offset=27, end_lineno=887, end_col_offset=31), slice=Name(id='str', ctx=Load(), lineno=887, col_offset=32, end_lineno=887, end_col_offset=35), ctx=Load(), lineno=887, col_offset=27, end_lineno=887, end_col_offset=36), op=BitOr(), right=Constant(value=None, lineno=887, col_offset=39, end_lineno=887, end_col_offset=43), lineno=887, col_offset=27, end_lineno=887, end_col_offset=43), simple=1, lineno=887, col_offset=12, end_lineno=887, end_col_offset=43), AnnAssign(target=Name(id='languages', ctx=Store(), lineno=888, col_offset=12, end_lineno=888, end_col_offset=21), annotation=BinOp(left=Subscript(value=Name(id='list', ctx=Load(), lineno=888, col_offset=23, end_lineno=888, end_col_offset=27), slice=Name(id='str', ctx=Load(), lineno=888, col_offset=28, end_lineno=888, end_col_offset=31), ctx=Load(), lineno=888, col_offset=23, end_lineno=888, end_col_offset=32), op=BitOr(), right=Constant(value=None, lineno=888, col_offset=35, end_lineno=888, end_col_offset=39), lineno=888, col_offset=23, end_lineno=888, end_col_offset=39), simple=1, lineno=888, col_offset=12, end_lineno=888, end_col_offset=39), If(test=Name(id='scope', ctx=Load(), lineno=889, col_offset=15, end_lineno=889, end_col_offset=20), body=[Assign(targets=[Name(id='include_globs', ctx=Store(), lineno=890, col_offset=16, end_lineno=890, end_col_offset=29)], value=Call(func=Attribute(value=Name(id='scope', ctx=Load(), lineno=890, col_offset=32, end_lineno=890, end_col_offset=37), attr='get', ctx=Load(), lineno=890, col_offset=32, end_lineno=890, end_col_offset=41), args=[Constant(value='include_globs', lineno=890, col_offset=42, end_lineno=890, end_col_offset=57)], lineno=890, col_offset=32, end_lineno=890, end_col_offset=58), lineno=890, col_offset=16, end_lineno=890, end_col_offset=58), Assign(targets=[Name(id='exclude_globs', ctx=Store(), lineno=891, col_offset=16, end_lineno=891, end_col_offset=29)], value=Call(func=Attribute(value=Name(id='scope', ctx=Load(), lineno=891, col_offset=32, end_lineno=891, end_col_offset=37), attr='get', ctx=Load(), lineno=891, col_offset=32, end_lineno=891, end_col_offset=41), args=[Constant(value='exclude_globs', lineno=891, col_offset=42, end_lineno=891, end_col_offset=57)], lineno=891, col_offset=32, end_lineno=891, end_col_offset=58), lineno=891, col_offset=16, end_lineno=891, end_col_offset=58), Assign(targets=[Name(id='languages', ctx=Store(), lineno=892, col_offset=16, end_lineno=892, end_col_offset=25)], value=Call(func=Attribute(value=Name(id='scope', ctx=Load(), lineno=892, col_offset=28, end_lineno=892, end_col_offset=33), attr='get', ctx=Load(), lineno=892, col_offset=28, end_lineno=892, end_col_offset=37), args=[Constant(value='languages', lineno=892, col_offset=38, end_lineno=892, end_col_offset=49)], lineno=892, col_offset=28, end_lineno=892, end_col_offset=50), lineno=892, col_offset=16, end_lineno=892, end_col_offset=50)], orelse=[Assign(targets=[Name(id='include_globs', ctx=Store(), lineno=894, col_offset=16, end_lineno=894, end_col_offset=29)], value=Constant(value=None, lineno=894, col_offset=32, end_lineno=894, end_col_offset=36), lineno=894, col_offset=16, end_lineno=894, end_col_offset=36), Assign(targets=[Name(id='exclude_globs', ctx=Store(), lineno=895, col_offset=16, end_lineno=895, end_col_offset=29)], value=Constant(value=None, lineno=895, col_offset=32, end_lineno=895, end_col_offset=36), lineno=895, col_offset=16, end_lineno=895, end_col_offset=36), Assign(targets=[Name(id='languages', ctx=Store(), lineno=896, col_offset=16, end_lineno=896, end_col_offset=25)], value=Constant(value=None, lineno=896, col_offset=28, end_lineno=896, end_col_offset=32), lineno=896, col_offset=16, end_lineno=896, end_col_offset=32)], lineno=889, col_offset=12, end_lineno=896, end_col_offset=32), Assign(targets=[Name(id='has_filters', ctx=Store(), lineno=898, col_offset=12, end_lineno=898, end_col_offset=23)], value=Call(func=Name(id='bool', ctx=Load(), lineno=898, col_offset=26, end_lineno=898, end_col_offset=30), args=[BoolOp(op=Or(), values=[Name(id='include_globs', ctx=Load(), lineno=898, col_offset=31, end_lineno=898, end_col_offset=44), Name(id='exclude_globs', ctx=Load(), lineno=898, col_offset=48, end_lineno=898, end_col_offset=61), Name(id='languages', ctx=Load(), lineno=898, col_offset=65, end_lineno=898, end_col_offset=74)], lineno=898, col_offset=31, end_lineno=898, end_col_offset=74)], lineno=898, col_offset=26, end_lineno=898, end_col_offset=75), lineno=898, col_offset=12, end_lineno=898, end_col_offset=75), If(test=Name(id='has_filters', ctx=Load(), lineno=901, col_offset=15, end_lineno=901, end_col_offset=26), body=[Assign(targets=[Name(id='records', ctx=Store(), lineno=902, col_offset=16, end_lineno=902, end_col_offset=23)], value=Call(func=Attribute(value=Name(id='catalog', ctx=Load(), lineno=902, col_offset=26, end_lineno=902, end_col_offset=33), attr='query_by_filters', ctx=Load(), lineno=902, col_offset=26, end_lineno=902, end_col_offset=50), args=[Name(id='valid_ids', ctx=Load(), lineno=903, col_offset=20, end_lineno=903, end_col_offset=29)], keywords=[keyword(arg='include_globs', value=Name(id='include_globs', ctx=Load(), lineno=904, col_offset=34, end_lineno=904, end_col_offset=47), lineno=904, col_offset=20, end_lineno=904, end_col_offset=47), keyword(arg='exclude_globs', value=Name(id='exclude_globs', ctx=Load(), lineno=905, col_offset=34, end_lineno=905, end_col_offset=47), lineno=905, col_offset=20, end_lineno=905, end_col_offset=47), keyword(arg='languages', value=Name(id='languages', ctx=Load(), lineno=906, col_offset=30, end_lineno=906, end_col_offset=39), lineno=906, col_offset=20, end_lineno=906, end_col_offset=39)], lineno=902, col_offset=26, end_lineno=907, end_col_offset=17), lineno=902, col_offset=16, end_lineno=907, end_col_offset=17), Expr(value=Call(func=Attribute(value=Name(id='LOGGER', ctx=Load(), lineno=908, col_offset=16, end_lineno=908, end_col_offset=22), attr='debug', ctx=Load(), lineno=908, col_offset=16, end_lineno=908, end_col_offset=28), args=[Constant(value='Applied scope filters during DuckDB hydration', lineno=909, col_offset=20, end_lineno=909, end_col_offset=67)], keywords=[keyword(arg='extra', value=Dict(keys=[Constant(value='chunk_ids_count', lineno=911, col_offset=24, end_lineno=911, end_col_offset=41), Constant(value='filtered_count', lineno=912, col_offset=24, end_lineno=912, end_col_offset=40), Constant(value='has_include_globs', lineno=913, col_offset=24, end_lineno=913, end_col_offset=43), Constant(value='has_exclude_globs', lineno=914, col_offset=24, end_lineno=914, end_col_offset=43), Constant(value='has_languages', lineno=915, col_offset=24, end_lineno=915, end_col_offset=39)], values=[Call(func=Name(id='len', ctx=Load(), lineno=911, col_offset=43, end_lineno=911, end_col_offset=46), args=[Name(id='valid_ids', ctx=Load(), lineno=911, col_offset=47, end_lineno=911, end_col_offset=56)], lineno=911, col_offset=43, end_lineno=911, end_col_offset=57), Call(func=Name(id='len', ctx=Load(), lineno=912, col_offset=42, end_lineno=912, end_col_offset=45), args=[Name(id='records', ctx=Load(), lineno=912, col_offset=46, end_lineno=912, end_col_offset=53)], lineno=912, col_offset=42, end_lineno=912, end_col_offset=54), Call(func=Name(id='bool', ctx=Load(), lineno=913, col_offset=45, end_lineno=913, end_col_offset=49), args=[Name(id='include_globs', ctx=Load(), lineno=913, col_offset=50, end_lineno=913, end_col_offset=63)], lineno=913, col_offset=45, end_lineno=913, end_col_offset=64), Call(func=Name(id='bool', ctx=Load(), lineno=914, col_offset=45, end_lineno=914, end_col_offset=49), args=[Name(id='exclude_globs', ctx=Load(), lineno=914, col_offset=50, end_lineno=914, end_col_offset=63)], lineno=914, col_offset=45, end_lineno=914, end_col_offset=64), Call(func=Name(id='bool', ctx=Load(), lineno=915, col_offset=41, end_lineno=915, end_col_offset=45), args=[Name(id='languages', ctx=Load(), lineno=915, col_offset=46, end_lineno=915, end_col_offset=55)], lineno=915, col_offset=41, end_lineno=915, end_col_offset=56)], lineno=910, col_offset=26, end_lineno=916, end_col_offset=21), lineno=910, col_offset=20, end_lineno=916, end_col_offset=21)], lineno=908, col_offset=16, end_lineno=917, end_col_offset=17), lineno=908, col_offset=16, end_lineno=917, end_col_offset=17)], orelse=[Assign(targets=[Name(id='records', ctx=Store(), lineno=919, col_offset=16, end_lineno=919, end_col_offset=23)], value=Call(func=Attribute(value=Name(id='catalog', ctx=Load(), lineno=919, col_offset=26, end_lineno=919, end_col_offset=33), attr='query_by_ids', ctx=Load(), lineno=919, col_offset=26, end_lineno=919, end_col_offset=46), args=[Name(id='valid_ids', ctx=Load(), lineno=919, col_offset=47, end_lineno=919, end_col_offset=56)], lineno=919, col_offset=26, end_lineno=919, end_col_offset=57), lineno=919, col_offset=16, end_lineno=919, end_col_offset=57)], lineno=901, col_offset=12, end_lineno=919, end_col_offset=57), Assign(targets=[Name(id='chunk_by_id', ctx=Store(), lineno=920, col_offset=12, end_lineno=920, end_col_offset=23)], value=DictComp(key=Call(func=Name(id='int', ctx=Load(), lineno=920, col_offset=27, end_lineno=920, end_col_offset=30), args=[Subscript(value=Name(id='record', ctx=Load(), lineno=920, col_offset=31, end_lineno=920, end_col_offset=37), slice=Constant(value='id', lineno=920, col_offset=38, end_lineno=920, end_col_offset=42), ctx=Load(), lineno=920, col_offset=31, end_lineno=920, end_col_offset=43)], lineno=920, col_offset=27, end_lineno=920, end_col_offset=44), value=Name(id='record', ctx=Load(), lineno=920, col_offset=46, end_lineno=920, end_col_offset=52), generators=[comprehension(target=Name(id='record', ctx=Store(), lineno=920, col_offset=57, end_lineno=920, end_col_offset=63), iter=Name(id='records', ctx=Load(), lineno=920, col_offset=67, end_lineno=920, end_col_offset=74), ifs=[Compare(left=Constant(value='id', lineno=920, col_offset=78, end_lineno=920, end_col_offset=82), ops=[In()], comparators=[Name(id='record', ctx=Load(), lineno=920, col_offset=86, end_lineno=920, end_col_offset=92)], lineno=920, col_offset=78, end_lineno=920, end_col_offset=92)], is_async=0)], lineno=920, col_offset=26, end_lineno=920, end_col_offset=93), lineno=920, col_offset=12, end_lineno=920, end_col_offset=93), For(target=Tuple(elts=[Name(id='chunk_id', ctx=Store(), lineno=922, col_offset=16, end_lineno=922, end_col_offset=24), Name(id='score', ctx=Store(), lineno=922, col_offset=26, end_lineno=922, end_col_offset=31)], ctx=Store(), lineno=922, col_offset=16, end_lineno=922, end_col_offset=31), iter=Call(func=Name(id='zip', ctx=Load(), lineno=922, col_offset=35, end_lineno=922, end_col_offset=38), args=[Name(id='chunk_ids', ctx=Load(), lineno=922, col_offset=39, end_lineno=922, end_col_offset=48), Name(id='scores', ctx=Load(), lineno=922, col_offset=50, end_lineno=922, end_col_offset=56)], keywords=[keyword(arg='strict', value=Constant(value=True, lineno=922, col_offset=65, end_lineno=922, end_col_offset=69), lineno=922, col_offset=58, end_lineno=922, end_col_offset=69)], lineno=922, col_offset=35, end_lineno=922, end_col_offset=70), body=[If(test=Compare(left=Name(id='chunk_id', ctx=Load(), lineno=923, col_offset=19, end_lineno=923, end_col_offset=27), ops=[Lt()], comparators=[Constant(value=0, lineno=923, col_offset=30, end_lineno=923, end_col_offset=31)], lineno=923, col_offset=19, end_lineno=923, end_col_offset=31), body=[Continue(lineno=924, col_offset=20, end_lineno=924, end_col_offset=28)], lineno=923, col_offset=16, end_lineno=924, end_col_offset=28), Assign(targets=[Name(id='chunk', ctx=Store(), lineno=925, col_offset=16, end_lineno=925, end_col_offset=21)], value=Call(func=Attribute(value=Name(id='chunk_by_id', ctx=Load(), lineno=925, col_offset=24, end_lineno=925, end_col_offset=35), attr='get', ctx=Load(), lineno=925, col_offset=24, end_lineno=925, end_col_offset=39), args=[Call(func=Name(id='int', ctx=Load(), lineno=925, col_offset=40, end_lineno=925, end_col_offset=43), args=[Name(id='chunk_id', ctx=Load(), lineno=925, col_offset=44, end_lineno=925, end_col_offset=52)], lineno=925, col_offset=40, end_lineno=925, end_col_offset=53)], lineno=925, col_offset=24, end_lineno=925, end_col_offset=54), lineno=925, col_offset=16, end_lineno=925, end_col_offset=54), If(test=UnaryOp(op=Not(), operand=Name(id='chunk', ctx=Load(), lineno=926, col_offset=23, end_lineno=926, end_col_offset=28), lineno=926, col_offset=19, end_lineno=926, end_col_offset=28), body=[Continue(lineno=927, col_offset=20, end_lineno=927, end_col_offset=28)], lineno=926, col_offset=16, end_lineno=927, end_col_offset=28), AnnAssign(target=Name(id='finding', ctx=Store(), lineno=929, col_offset=16, end_lineno=929, end_col_offset=23), annotation=Name(id='Finding', ctx=Load(), lineno=929, col_offset=25, end_lineno=929, end_col_offset=32), value=Dict(keys=[Constant(value='type', lineno=930, col_offset=20, end_lineno=930, end_col_offset=26), Constant(value='title', lineno=931, col_offset=20, end_lineno=931, end_col_offset=27), Constant(value='location', lineno=932, col_offset=20, end_lineno=932, end_col_offset=30), Constant(value='snippet', lineno=939, col_offset=20, end_lineno=939, end_col_offset=29), Constant(value='score', lineno=940, col_offset=20, end_lineno=940, end_col_offset=27), Constant(value='why', lineno=941, col_offset=20, end_lineno=941, end_col_offset=25), Constant(value='chunk_id', lineno=942, col_offset=20, end_lineno=942, end_col_offset=30)], values=[Constant(value='usage', lineno=930, col_offset=28, end_lineno=930, end_col_offset=35), JoinedStr(values=[FormattedValue(value=Attribute(value=Call(func=Name(id='Path', ctx=Load(), lineno=931, col_offset=32, end_lineno=931, end_col_offset=36), args=[Subscript(value=Name(id='chunk', ctx=Load(), lineno=931, col_offset=37, end_lineno=931, end_col_offset=42), slice=Constant(value='uri', lineno=931, col_offset=43, end_lineno=931, end_col_offset=48), ctx=Load(), lineno=931, col_offset=37, end_lineno=931, end_col_offset=49)], lineno=931, col_offset=32, end_lineno=931, end_col_offset=50), attr='name', ctx=Load(), lineno=931, col_offset=32, end_lineno=931, end_col_offset=55), conversion=-1, lineno=931, col_offset=31, end_lineno=931, end_col_offset=56), Constant(value=' (score: ', lineno=931, col_offset=56, end_lineno=931, end_col_offset=65), FormattedValue(value=Name(id='score', ctx=Load(), lineno=931, col_offset=66, end_lineno=931, end_col_offset=71), conversion=-1, format_spec=JoinedStr(values=[Constant(value='.3f', lineno=931, col_offset=72, end_lineno=931, end_col_offset=75)], lineno=931, col_offset=71, end_lineno=931, end_col_offset=75), lineno=931, col_offset=65, end_lineno=931, end_col_offset=76), Constant(value=')', lineno=931, col_offset=76, end_lineno=931, end_col_offset=77)], lineno=931, col_offset=29, end_lineno=931, end_col_offset=78), Dict(keys=[Constant(value='uri', lineno=933, col_offset=24, end_lineno=933, end_col_offset=29), Constant(value='start_line', lineno=934, col_offset=24, end_lineno=934, end_col_offset=36), Constant(value='start_column', lineno=935, col_offset=24, end_lineno=935, end_col_offset=38), Constant(value='end_line', lineno=936, col_offset=24, end_lineno=936, end_col_offset=34), Constant(value='end_column', lineno=937, col_offset=24, end_lineno=937, end_col_offset=36)], values=[Subscript(value=Name(id='chunk', ctx=Load(), lineno=933, col_offset=31, end_lineno=933, end_col_offset=36), slice=Constant(value='uri', lineno=933, col_offset=37, end_lineno=933, end_col_offset=42), ctx=Load(), lineno=933, col_offset=31, end_lineno=933, end_col_offset=43), Subscript(value=Name(id='chunk', ctx=Load(), lineno=934, col_offset=38, end_lineno=934, end_col_offset=43), slice=Constant(value='start_line', lineno=934, col_offset=44, end_lineno=934, end_col_offset=56), ctx=Load(), lineno=934, col_offset=38, end_lineno=934, end_col_offset=57), Constant(value=0, lineno=935, col_offset=40, end_lineno=935, end_col_offset=41), Subscript(value=Name(id='chunk', ctx=Load(), lineno=936, col_offset=36, end_lineno=936, end_col_offset=41), slice=Constant(value='end_line', lineno=936, col_offset=42, end_lineno=936, end_col_offset=52), ctx=Load(), lineno=936, col_offset=36, end_lineno=936, end_col_offset=53), Constant(value=0, lineno=937, col_offset=38, end_lineno=937, end_col_offset=39)], lineno=932, col_offset=32, end_lineno=938, end_col_offset=21), Subscript(value=Subscript(value=Name(id='chunk', ctx=Load(), lineno=939, col_offset=31, end_lineno=939, end_col_offset=36), slice=Constant(value='preview', lineno=939, col_offset=37, end_lineno=939, end_col_offset=46), ctx=Load(), lineno=939, col_offset=31, end_lineno=939, end_col_offset=47), slice=Slice(upper=Name(id='SNIPPET_PREVIEW_CHARS', ctx=Load(), lineno=939, col_offset=49, end_lineno=939, end_col_offset=70), lineno=939, col_offset=48, end_lineno=939, end_col_offset=70), ctx=Load(), lineno=939, col_offset=31, end_lineno=939, end_col_offset=71), Call(func=Name(id='float', ctx=Load(), lineno=940, col_offset=29, end_lineno=940, end_col_offset=34), args=[Name(id='score', ctx=Load(), lineno=940, col_offset=35, end_lineno=940, end_col_offset=40)], lineno=940, col_offset=29, end_lineno=940, end_col_offset=41), JoinedStr(values=[Constant(value='Semantic similarity: ', lineno=941, col_offset=29, end_lineno=941, end_col_offset=50), FormattedValue(value=Name(id='score', ctx=Load(), lineno=941, col_offset=51, end_lineno=941, end_col_offset=56), conversion=-1, format_spec=JoinedStr(values=[Constant(value='.3f', lineno=941, col_offset=57, end_lineno=941, end_col_offset=60)], lineno=941, col_offset=56, end_lineno=941, end_col_offset=60), lineno=941, col_offset=50, end_lineno=941, end_col_offset=61)], lineno=941, col_offset=27, end_lineno=941, end_col_offset=62), Call(func=Name(id='int', ctx=Load(), lineno=942, col_offset=32, end_lineno=942, end_col_offset=35), args=[Name(id='chunk_id', ctx=Load(), lineno=942, col_offset=36, end_lineno=942, end_col_offset=44)], lineno=942, col_offset=32, end_lineno=942, end_col_offset=45)], lineno=929, col_offset=35, end_lineno=943, end_col_offset=17), simple=1, lineno=929, col_offset=16, end_lineno=943, end_col_offset=17), Expr(value=Call(func=Attribute(value=Name(id='findings', ctx=Load(), lineno=944, col_offset=16, end_lineno=944, end_col_offset=24), attr='append', ctx=Load(), lineno=944, col_offset=16, end_lineno=944, end_col_offset=31), args=[Name(id='finding', ctx=Load(), lineno=944, col_offset=32, end_lineno=944, end_col_offset=39)], lineno=944, col_offset=16, end_lineno=944, end_col_offset=40), lineno=944, col_offset=16, end_lineno=944, end_col_offset=40)], lineno=922, col_offset=12, end_lineno=944, end_col_offset=40)], lineno=881, col_offset=8, end_lineno=944, end_col_offset=40)], handlers=[ExceptHandler(type=Tuple(elts=[Name(id='RuntimeError', ctx=Load(), lineno=945, col_offset=12, end_lineno=945, end_col_offset=24), Name(id='OSError', ctx=Load(), lineno=945, col_offset=26, end_lineno=945, end_col_offset=33)], ctx=Load(), lineno=945, col_offset=11, end_lineno=945, end_col_offset=34), name='exc', body=[Return(value=Tuple(elts=[Name(id='findings', ctx=Load(), lineno=946, col_offset=15, end_lineno=946, end_col_offset=23), Name(id='exc', ctx=Load(), lineno=946, col_offset=25, end_lineno=946, end_col_offset=28)], ctx=Load(), lineno=946, col_offset=15, end_lineno=946, end_col_offset=28), lineno=946, col_offset=8, end_lineno=946, end_col_offset=28)], lineno=945, col_offset=4, end_lineno=946, end_col_offset=28)], lineno=880, col_offset=4, end_lineno=946, end_col_offset=28), Return(value=Tuple(elts=[Name(id='findings', ctx=Load(), lineno=948, col_offset=11, end_lineno=948, end_col_offset=19), Constant(value=None, lineno=948, col_offset=21, end_lineno=948, end_col_offset=25)], ctx=Load(), lineno=948, col_offset=11, end_lineno=948, end_col_offset=25), lineno=948, col_offset=4, end_lineno=948, end_col_offset=25)], returns=Subscript(value=Name(id='tuple', ctx=Load(), lineno=843, col_offset=5, end_lineno=843, end_col_offset=10), slice=Tuple(elts=[Subscript(value=Name(id='list', ctx=Load(), lineno=843, col_offset=11, end_lineno=843, end_col_offset=15), slice=Name(id='Finding', ctx=Load(), lineno=843, col_offset=16, end_lineno=843, end_col_offset=23), ctx=Load(), lineno=843, col_offset=11, end_lineno=843, end_col_offset=24), BinOp(left=Name(id='Exception', ctx=Load(), lineno=843, col_offset=26, end_lineno=843, end_col_offset=35), op=BitOr(), right=Constant(value=None, lineno=843, col_offset=38, end_lineno=843, end_col_offset=42), lineno=843, col_offset=26, end_lineno=843, end_col_offset=42)], ctx=Load(), lineno=843, col_offset=11, end_lineno=843, end_col_offset=42), ctx=Load(), lineno=843, col_offset=5, end_lineno=843, end_col_offset=43), lineno=837, col_offset=0, end_lineno=948, end_col_offset=25), FunctionDef(name='_build_method', args=arguments(args=[arg(arg='findings_count', annotation=Name(id='int', ctx=Load(), lineno=952, col_offset=20, end_lineno=952, end_col_offset=23), lineno=952, col_offset=4, end_lineno=952, end_col_offset=23), arg(arg='requested_limit', annotation=Name(id='int', ctx=Load(), lineno=953, col_offset=21, end_lineno=953, end_col_offset=24), lineno=953, col_offset=4, end_lineno=953, end_col_offset=24), arg(arg='effective_limit', annotation=Name(id='int', ctx=Load(), lineno=954, col_offset=21, end_lineno=954, end_col_offset=24), lineno=954, col_offset=4, end_lineno=954, end_col_offset=24), arg(arg='start_time', annotation=Name(id='float', ctx=Load(), lineno=955, col_offset=16, end_lineno=955, end_col_offset=21), lineno=955, col_offset=4, end_lineno=955, end_col_offset=21), arg(arg='retrieval_channels', annotation=Subscript(value=Name(id='Sequence', ctx=Load(), lineno=956, col_offset=24, end_lineno=956, end_col_offset=32), slice=Name(id='str', ctx=Load(), lineno=956, col_offset=33, end_lineno=956, end_col_offset=36), ctx=Load(), lineno=956, col_offset=24, end_lineno=956, end_col_offset=37), lineno=956, col_offset=4, end_lineno=956, end_col_offset=37)]), body=[Expr(value=Constant(value='Build method metadata for the response.\n\n    Parameters\n    ----------\n    findings_count : int\n        Number of findings returned.\n    requested_limit : int\n        Requested result limit.\n    effective_limit : int\n        Effective limit applied after clamping.\n    start_time : float\n        Search start time (monotonic clock).\n    retrieval_channels : Sequence[str]\n        Retrieval systems that contributed to the final result set.\n\n    Returns\n    -------\n    MethodInfo\n        Retrieval metadata describing semantic search coverage.\n    ', lineno=958, col_offset=4, end_lineno=977, end_col_offset=7), lineno=958, col_offset=4, end_lineno=977, end_col_offset=7), Assign(targets=[Name(id='elapsed_ms', ctx=Store(), lineno=978, col_offset=4, end_lineno=978, end_col_offset=14)], value=Call(func=Name(id='int', ctx=Load(), lineno=978, col_offset=17, end_lineno=978, end_col_offset=20), args=[BinOp(left=BinOp(left=Call(func=Name(id='perf_counter', ctx=Load(), lineno=978, col_offset=22, end_lineno=978, end_col_offset=34), lineno=978, col_offset=22, end_lineno=978, end_col_offset=36), op=Sub(), right=Name(id='start_time', ctx=Load(), lineno=978, col_offset=39, end_lineno=978, end_col_offset=49), lineno=978, col_offset=22, end_lineno=978, end_col_offset=49), op=Mult(), right=Constant(value=1000, lineno=978, col_offset=53, end_lineno=978, end_col_offset=57), lineno=978, col_offset=21, end_lineno=978, end_col_offset=57)], lineno=978, col_offset=17, end_lineno=978, end_col_offset=58), lineno=978, col_offset=4, end_lineno=978, end_col_offset=58), Assign(targets=[Name(id='coverage', ctx=Store(), lineno=979, col_offset=4, end_lineno=979, end_col_offset=12)], value=JoinedStr(values=[FormattedValue(value=Name(id='findings_count', ctx=Load(), lineno=979, col_offset=18, end_lineno=979, end_col_offset=32), conversion=-1, lineno=979, col_offset=17, end_lineno=979, end_col_offset=33), Constant(value='/', lineno=979, col_offset=33, end_lineno=979, end_col_offset=34), FormattedValue(value=Name(id='effective_limit', ctx=Load(), lineno=979, col_offset=35, end_lineno=979, end_col_offset=50), conversion=-1, lineno=979, col_offset=34, end_lineno=979, end_col_offset=51), Constant(value=' results in ', lineno=979, col_offset=51, end_lineno=979, end_col_offset=63), FormattedValue(value=Name(id='elapsed_ms', ctx=Load(), lineno=979, col_offset=64, end_lineno=979, end_col_offset=74), conversion=-1, lineno=979, col_offset=63, end_lineno=979, end_col_offset=75), Constant(value='ms', lineno=979, col_offset=75, end_lineno=979, end_col_offset=77)], lineno=979, col_offset=15, end_lineno=979, end_col_offset=78), lineno=979, col_offset=4, end_lineno=979, end_col_offset=78), If(test=Compare(left=Name(id='requested_limit', ctx=Load(), lineno=980, col_offset=7, end_lineno=980, end_col_offset=22), ops=[NotEq()], comparators=[Name(id='effective_limit', ctx=Load(), lineno=980, col_offset=26, end_lineno=980, end_col_offset=41)], lineno=980, col_offset=7, end_lineno=980, end_col_offset=41), body=[Assign(targets=[Name(id='coverage', ctx=Store(), lineno=981, col_offset=8, end_lineno=981, end_col_offset=16)], value=JoinedStr(values=[FormattedValue(value=Name(id='coverage', ctx=Load(), lineno=981, col_offset=22, end_lineno=981, end_col_offset=30), conversion=-1, lineno=981, col_offset=21, end_lineno=981, end_col_offset=31), Constant(value=' (requested ', lineno=981, col_offset=31, end_lineno=981, end_col_offset=43), FormattedValue(value=Name(id='requested_limit', ctx=Load(), lineno=981, col_offset=44, end_lineno=981, end_col_offset=59), conversion=-1, lineno=981, col_offset=43, end_lineno=981, end_col_offset=60), Constant(value=')', lineno=981, col_offset=60, end_lineno=981, end_col_offset=61)], lineno=981, col_offset=19, end_lineno=981, end_col_offset=62), lineno=981, col_offset=8, end_lineno=981, end_col_offset=62)], lineno=980, col_offset=4, end_lineno=981, end_col_offset=62), Return(value=Dict(keys=[Constant(value='retrieval', lineno=983, col_offset=8, end_lineno=983, end_col_offset=19), Constant(value='coverage', lineno=984, col_offset=8, end_lineno=984, end_col_offset=18)], values=[Call(func=Name(id='list', ctx=Load(), lineno=983, col_offset=21, end_lineno=983, end_col_offset=25), args=[Call(func=Attribute(value=Name(id='dict', ctx=Load(), lineno=983, col_offset=26, end_lineno=983, end_col_offset=30), attr='fromkeys', ctx=Load(), lineno=983, col_offset=26, end_lineno=983, end_col_offset=39), args=[Name(id='retrieval_channels', ctx=Load(), lineno=983, col_offset=40, end_lineno=983, end_col_offset=58)], lineno=983, col_offset=26, end_lineno=983, end_col_offset=59)], lineno=983, col_offset=21, end_lineno=983, end_col_offset=60), Name(id='coverage', ctx=Load(), lineno=984, col_offset=20, end_lineno=984, end_col_offset=28)], lineno=982, col_offset=11, end_lineno=985, end_col_offset=5), lineno=982, col_offset=4, end_lineno=985, end_col_offset=5)], returns=Name(id='MethodInfo', ctx=Load(), lineno=957, col_offset=5, end_lineno=957, end_col_offset=15), lineno=951, col_offset=0, end_lineno=985, end_col_offset=5), FunctionDef(name='_make_envelope', args=arguments(kwonlyargs=[arg(arg='findings', annotation=Subscript(value=Name(id='Sequence', ctx=Load(), lineno=990, col_offset=14, end_lineno=990, end_col_offset=22), slice=Name(id='Finding', ctx=Load(), lineno=990, col_offset=23, end_lineno=990, end_col_offset=30), ctx=Load(), lineno=990, col_offset=14, end_lineno=990, end_col_offset=31), lineno=990, col_offset=4, end_lineno=990, end_col_offset=31), arg(arg='answer', annotation=Name(id='str', ctx=Load(), lineno=991, col_offset=12, end_lineno=991, end_col_offset=15), lineno=991, col_offset=4, end_lineno=991, end_col_offset=15), arg(arg='confidence', annotation=Name(id='float', ctx=Load(), lineno=992, col_offset=16, end_lineno=992, end_col_offset=21), lineno=992, col_offset=4, end_lineno=992, end_col_offset=21), arg(arg='extras', annotation=BinOp(left=Subscript(value=Name(id='dict', ctx=Load(), lineno=993, col_offset=12, end_lineno=993, end_col_offset=16), slice=Tuple(elts=[Name(id='str', ctx=Load(), lineno=993, col_offset=17, end_lineno=993, end_col_offset=20), Name(id='object', ctx=Load(), lineno=993, col_offset=22, end_lineno=993, end_col_offset=28)], ctx=Load(), lineno=993, col_offset=17, end_lineno=993, end_col_offset=28), ctx=Load(), lineno=993, col_offset=12, end_lineno=993, end_col_offset=29), op=BitOr(), right=Constant(value=None, lineno=993, col_offset=32, end_lineno=993, end_col_offset=36), lineno=993, col_offset=12, end_lineno=993, end_col_offset=36), lineno=993, col_offset=4, end_lineno=993, end_col_offset=36)], kw_defaults=[None, None, None, Constant(value=None, lineno=993, col_offset=39, end_lineno=993, end_col_offset=43)]), body=[Expr(value=Constant(value='Construct an AnswerEnvelope with optional metadata.\n\n    Parameters\n    ----------\n    findings : Sequence[Finding]\n        Search findings.\n    answer : str\n        Answer text.\n    confidence : float\n        Confidence score (0.0 to 1.0).\n    extras : dict[str, object] | None, optional\n        Additional envelope fields (for example ``limits``, ``method``, or\n        ``problem`` metadata). Defaults to None.\n\n    Returns\n    -------\n    AnswerEnvelope\n        Response payload ready for MCP clients.\n    ', lineno=995, col_offset=4, end_lineno=1013, end_col_offset=7), lineno=995, col_offset=4, end_lineno=1013, end_col_offset=7), Assign(targets=[Name(id='base_envelope', ctx=Store(), lineno=1017, col_offset=4, end_lineno=1017, end_col_offset=17)], value=Dict(keys=[Constant(value='answer', lineno=1018, col_offset=8, end_lineno=1018, end_col_offset=16), Constant(value='query_kind', lineno=1019, col_offset=8, end_lineno=1019, end_col_offset=20), Constant(value='findings', lineno=1020, col_offset=8, end_lineno=1020, end_col_offset=18), Constant(value='confidence', lineno=1021, col_offset=8, end_lineno=1021, end_col_offset=20)], values=[Name(id='answer', ctx=Load(), lineno=1018, col_offset=18, end_lineno=1018, end_col_offset=24), Constant(value='semantic', lineno=1019, col_offset=22, end_lineno=1019, end_col_offset=32), Call(func=Name(id='list', ctx=Load(), lineno=1020, col_offset=20, end_lineno=1020, end_col_offset=24), args=[Name(id='findings', ctx=Load(), lineno=1020, col_offset=25, end_lineno=1020, end_col_offset=33)], lineno=1020, col_offset=20, end_lineno=1020, end_col_offset=34), Name(id='confidence', ctx=Load(), lineno=1021, col_offset=22, end_lineno=1021, end_col_offset=32)], lineno=1017, col_offset=20, end_lineno=1022, end_col_offset=5), lineno=1017, col_offset=4, end_lineno=1022, end_col_offset=5), If(test=Name(id='extras', ctx=Load(), lineno=1024, col_offset=7, end_lineno=1024, end_col_offset=13), body=[AnnAssign(target=Name(id='envelope', ctx=Store(), lineno=1028, col_offset=8, end_lineno=1028, end_col_offset=16), annotation=Name(id='AnswerEnvelope', ctx=Load(), lineno=1028, col_offset=18, end_lineno=1028, end_col_offset=32), value=Call(func=Name(id='cast', ctx=Load(), lineno=1028, col_offset=35, end_lineno=1028, end_col_offset=39), args=[Constant(value='AnswerEnvelope', lineno=1029, col_offset=12, end_lineno=1029, end_col_offset=28), Dict(keys=[None, None], values=[Name(id='base_envelope', ctx=Load(), lineno=1030, col_offset=15, end_lineno=1030, end_col_offset=28), Name(id='extras', ctx=Load(), lineno=1030, col_offset=32, end_lineno=1030, end_col_offset=38)], lineno=1030, col_offset=12, end_lineno=1030, end_col_offset=39)], lineno=1028, col_offset=35, end_lineno=1031, end_col_offset=9), simple=1, lineno=1028, col_offset=8, end_lineno=1031, end_col_offset=9)], orelse=[Assign(targets=[Name(id='envelope', ctx=Store(), lineno=1033, col_offset=8, end_lineno=1033, end_col_offset=16)], value=Call(func=Name(id='cast', ctx=Load(), lineno=1033, col_offset=19, end_lineno=1033, end_col_offset=23), args=[Constant(value='AnswerEnvelope', lineno=1033, col_offset=24, end_lineno=1033, end_col_offset=40), Name(id='base_envelope', ctx=Load(), lineno=1033, col_offset=42, end_lineno=1033, end_col_offset=55)], lineno=1033, col_offset=19, end_lineno=1033, end_col_offset=56), lineno=1033, col_offset=8, end_lineno=1033, end_col_offset=56)], lineno=1024, col_offset=4, end_lineno=1033, end_col_offset=56), Return(value=Name(id='envelope', ctx=Load(), lineno=1035, col_offset=11, end_lineno=1035, end_col_offset=19), lineno=1035, col_offset=4, end_lineno=1035, end_col_offset=19)], returns=Name(id='AnswerEnvelope', ctx=Load(), lineno=994, col_offset=5, end_lineno=994, end_col_offset=19), lineno=988, col_offset=0, end_lineno=1035, end_col_offset=19), FunctionDef(name='_success_extras', args=arguments(args=[arg(arg='limits', annotation=Subscript(value=Name(id='Sequence', ctx=Load(), lineno=1039, col_offset=12, end_lineno=1039, end_col_offset=20), slice=Name(id='str', ctx=Load(), lineno=1039, col_offset=21, end_lineno=1039, end_col_offset=24), ctx=Load(), lineno=1039, col_offset=12, end_lineno=1039, end_col_offset=25), lineno=1039, col_offset=4, end_lineno=1039, end_col_offset=25), arg(arg='method', annotation=Name(id='MethodInfo', ctx=Load(), lineno=1040, col_offset=12, end_lineno=1040, end_col_offset=22), lineno=1040, col_offset=4, end_lineno=1040, end_col_offset=22)]), body=[Expr(value=Constant(value='Build a success extras payload with optional limits metadata.\n\n    Parameters\n    ----------\n    limits : Sequence[str]\n        Search limitations or warnings.\n    method : MethodInfo\n        Retrieval metadata to include in the response.\n\n    Returns\n    -------\n    dict[str, object]\n        Extras payload including method metadata and optional limits.\n    ', lineno=1042, col_offset=4, end_lineno=1055, end_col_offset=7), lineno=1042, col_offset=4, end_lineno=1055, end_col_offset=7), AnnAssign(target=Name(id='extras', ctx=Store(), lineno=1056, col_offset=4, end_lineno=1056, end_col_offset=10), annotation=Subscript(value=Name(id='dict', ctx=Load(), lineno=1056, col_offset=12, end_lineno=1056, end_col_offset=16), slice=Tuple(elts=[Name(id='str', ctx=Load(), lineno=1056, col_offset=17, end_lineno=1056, end_col_offset=20), Name(id='object', ctx=Load(), lineno=1056, col_offset=22, end_lineno=1056, end_col_offset=28)], ctx=Load(), lineno=1056, col_offset=17, end_lineno=1056, end_col_offset=28), ctx=Load(), lineno=1056, col_offset=12, end_lineno=1056, end_col_offset=29), value=Dict(keys=[Constant(value='method', lineno=1056, col_offset=33, end_lineno=1056, end_col_offset=41)], values=[Name(id='method', ctx=Load(), lineno=1056, col_offset=43, end_lineno=1056, end_col_offset=49)], lineno=1056, col_offset=32, end_lineno=1056, end_col_offset=50), simple=1, lineno=1056, col_offset=4, end_lineno=1056, end_col_offset=50), If(test=Name(id='limits', ctx=Load(), lineno=1057, col_offset=7, end_lineno=1057, end_col_offset=13), body=[Assign(targets=[Subscript(value=Name(id='extras', ctx=Load(), lineno=1058, col_offset=8, end_lineno=1058, end_col_offset=14), slice=Constant(value='limits', lineno=1058, col_offset=15, end_lineno=1058, end_col_offset=23), ctx=Store(), lineno=1058, col_offset=8, end_lineno=1058, end_col_offset=24)], value=Call(func=Name(id='list', ctx=Load(), lineno=1058, col_offset=27, end_lineno=1058, end_col_offset=31), args=[Name(id='limits', ctx=Load(), lineno=1058, col_offset=32, end_lineno=1058, end_col_offset=38)], lineno=1058, col_offset=27, end_lineno=1058, end_col_offset=39), lineno=1058, col_offset=8, end_lineno=1058, end_col_offset=39)], lineno=1057, col_offset=4, end_lineno=1058, end_col_offset=39), Return(value=Name(id='extras', ctx=Load(), lineno=1059, col_offset=11, end_lineno=1059, end_col_offset=17), lineno=1059, col_offset=4, end_lineno=1059, end_col_offset=17)], returns=Subscript(value=Name(id='dict', ctx=Load(), lineno=1041, col_offset=5, end_lineno=1041, end_col_offset=9), slice=Tuple(elts=[Name(id='str', ctx=Load(), lineno=1041, col_offset=10, end_lineno=1041, end_col_offset=13), Name(id='object', ctx=Load(), lineno=1041, col_offset=15, end_lineno=1041, end_col_offset=21)], ctx=Load(), lineno=1041, col_offset=10, end_lineno=1041, end_col_offset=21), ctx=Load(), lineno=1041, col_offset=5, end_lineno=1041, end_col_offset=22), lineno=1038, col_offset=0, end_lineno=1059, end_col_offset=17), FunctionDef(name='_build_response_extras', args=arguments(args=[arg(arg='context', annotation=Name(id='_MethodContext', ctx=Load(), lineno=1063, col_offset=13, end_lineno=1063, end_col_offset=27), lineno=1063, col_offset=4, end_lineno=1063, end_col_offset=27), arg(arg='limits', annotation=Subscript(value=Name(id='Sequence', ctx=Load(), lineno=1064, col_offset=12, end_lineno=1064, end_col_offset=20), slice=Name(id='str', ctx=Load(), lineno=1064, col_offset=21, end_lineno=1064, end_col_offset=24), ctx=Load(), lineno=1064, col_offset=12, end_lineno=1064, end_col_offset=25), lineno=1064, col_offset=4, end_lineno=1064, end_col_offset=25), arg(arg='scope', annotation=BinOp(left=Name(id='ScopeIn', ctx=Load(), lineno=1065, col_offset=11, end_lineno=1065, end_col_offset=18), op=BitOr(), right=Constant(value=None, lineno=1065, col_offset=21, end_lineno=1065, end_col_offset=25), lineno=1065, col_offset=11, end_lineno=1065, end_col_offset=25), lineno=1065, col_offset=4, end_lineno=1065, end_col_offset=25)]), body=[Expr(value=Constant(value='Build extras payload including method metadata and optional scope.\n\n    Parameters\n    ----------\n    context : _MethodContext\n        Context values required to build method metadata.\n    limits : Sequence[str]\n        Search limitations or warnings.\n    scope : ScopeIn | None\n        Optional scope configuration to include in extras.\n\n    Returns\n    -------\n    dict[str, object]\n        Extras payload dictionary containing method metadata and optional scope.\n    ', lineno=1067, col_offset=4, end_lineno=1082, end_col_offset=7), lineno=1067, col_offset=4, end_lineno=1082, end_col_offset=7), Assign(targets=[Name(id='method_metadata', ctx=Store(), lineno=1083, col_offset=4, end_lineno=1083, end_col_offset=19)], value=Call(func=Name(id='_build_method', ctx=Load(), lineno=1083, col_offset=22, end_lineno=1083, end_col_offset=35), args=[Attribute(value=Name(id='context', ctx=Load(), lineno=1084, col_offset=8, end_lineno=1084, end_col_offset=15), attr='findings_count', ctx=Load(), lineno=1084, col_offset=8, end_lineno=1084, end_col_offset=30), Attribute(value=Name(id='context', ctx=Load(), lineno=1085, col_offset=8, end_lineno=1085, end_col_offset=15), attr='requested_limit', ctx=Load(), lineno=1085, col_offset=8, end_lineno=1085, end_col_offset=31), Attribute(value=Name(id='context', ctx=Load(), lineno=1086, col_offset=8, end_lineno=1086, end_col_offset=15), attr='effective_limit', ctx=Load(), lineno=1086, col_offset=8, end_lineno=1086, end_col_offset=31), Attribute(value=Name(id='context', ctx=Load(), lineno=1087, col_offset=8, end_lineno=1087, end_col_offset=15), attr='start_time', ctx=Load(), lineno=1087, col_offset=8, end_lineno=1087, end_col_offset=26), Attribute(value=Name(id='context', ctx=Load(), lineno=1088, col_offset=8, end_lineno=1088, end_col_offset=15), attr='retrieval_channels', ctx=Load(), lineno=1088, col_offset=8, end_lineno=1088, end_col_offset=34)], lineno=1083, col_offset=22, end_lineno=1089, end_col_offset=5), lineno=1083, col_offset=4, end_lineno=1089, end_col_offset=5), Assign(targets=[Name(id='extras', ctx=Store(), lineno=1090, col_offset=4, end_lineno=1090, end_col_offset=10)], value=Call(func=Name(id='_success_extras', ctx=Load(), lineno=1090, col_offset=13, end_lineno=1090, end_col_offset=28), args=[Name(id='limits', ctx=Load(), lineno=1090, col_offset=29, end_lineno=1090, end_col_offset=35), Name(id='method_metadata', ctx=Load(), lineno=1090, col_offset=37, end_lineno=1090, end_col_offset=52)], lineno=1090, col_offset=13, end_lineno=1090, end_col_offset=53), lineno=1090, col_offset=4, end_lineno=1090, end_col_offset=53), If(test=Name(id='scope', ctx=Load(), lineno=1091, col_offset=7, end_lineno=1091, end_col_offset=12), body=[Assign(targets=[Subscript(value=Name(id='extras', ctx=Load(), lineno=1092, col_offset=8, end_lineno=1092, end_col_offset=14), slice=Constant(value='scope', lineno=1092, col_offset=15, end_lineno=1092, end_col_offset=22), ctx=Store(), lineno=1092, col_offset=8, end_lineno=1092, end_col_offset=23)], value=Name(id='scope', ctx=Load(), lineno=1092, col_offset=26, end_lineno=1092, end_col_offset=31), lineno=1092, col_offset=8, end_lineno=1092, end_col_offset=31)], lineno=1091, col_offset=4, end_lineno=1092, end_col_offset=31), Return(value=Name(id='extras', ctx=Load(), lineno=1093, col_offset=11, end_lineno=1093, end_col_offset=17), lineno=1093, col_offset=4, end_lineno=1093, end_col_offset=17)], returns=Subscript(value=Name(id='dict', ctx=Load(), lineno=1066, col_offset=5, end_lineno=1066, end_col_offset=9), slice=Tuple(elts=[Name(id='str', ctx=Load(), lineno=1066, col_offset=10, end_lineno=1066, end_col_offset=13), Name(id='object', ctx=Load(), lineno=1066, col_offset=15, end_lineno=1066, end_col_offset=21)], ctx=Load(), lineno=1066, col_offset=10, end_lineno=1066, end_col_offset=21), ctx=Load(), lineno=1066, col_offset=5, end_lineno=1066, end_col_offset=22), lineno=1062, col_offset=0, end_lineno=1093, end_col_offset=17), Assign(targets=[Name(id='__all__', ctx=Store(), lineno=1096, col_offset=0, end_lineno=1096, end_col_offset=7)], value=List(elts=[Constant(value='semantic_search', lineno=1096, col_offset=11, end_lineno=1096, end_col_offset=28)], ctx=Load(), lineno=1096, col_offset=10, end_lineno=1096, end_col_offset=29), lineno=1096, col_offset=0, end_lineno=1096, end_col_offset=29)])