Module(body=[Expr(value=Constant(value='Schema round-trip tests for vector ingestion payloads.', lineno=1, col_offset=0, end_lineno=1, end_col_offset=60), lineno=1, col_offset=0, end_lineno=1, end_col_offset=60), ImportFrom(module='__future__', names=[alias(name='annotations', lineno=3, col_offset=23, end_lineno=3, end_col_offset=34)], level=0, lineno=3, col_offset=0, end_lineno=3, end_col_offset=34), ImportFrom(module='typing', names=[alias(name='TYPE_CHECKING', lineno=5, col_offset=19, end_lineno=5, end_col_offset=32)], level=0, lineno=5, col_offset=0, end_lineno=5, end_col_offset=32), Import(names=[alias(name='pytest', lineno=7, col_offset=7, end_lineno=7, end_col_offset=13)], lineno=7, col_offset=0, end_lineno=7, end_col_offset=13), ImportFrom(module='kgfoundry_common.jsonschema_utils', names=[alias(name='ValidationError', lineno=10, col_offset=4, end_lineno=10, end_col_offset=19)], level=0, lineno=9, col_offset=0, end_lineno=11, end_col_offset=1), If(test=Name(id='TYPE_CHECKING', ctx=Load(), lineno=13, col_offset=3, end_lineno=13, end_col_offset=16), body=[ImportFrom(module='kgfoundry_common.jsonschema_utils', names=[alias(name='Draft202012ValidatorProtocol', lineno=15, col_offset=8, end_lineno=15, end_col_offset=36)], level=0, lineno=14, col_offset=4, end_lineno=16, end_col_offset=5)], lineno=13, col_offset=0, end_lineno=16, end_col_offset=5), FunctionDef(name='test_vector_schema_accepts_canonical_payload', args=arguments(args=[arg(arg='vector_validator', annotation=Name(id='Draft202012ValidatorProtocol', ctx=Load(), lineno=20, col_offset=22, end_lineno=20, end_col_offset=50), lineno=20, col_offset=4, end_lineno=20, end_col_offset=50), arg(arg='canonical_vector_payload', annotation=Subscript(value=Name(id='list', ctx=Load(), lineno=21, col_offset=30, end_lineno=21, end_col_offset=34), slice=Subscript(value=Name(id='dict', ctx=Load(), lineno=21, col_offset=35, end_lineno=21, end_col_offset=39), slice=Tuple(elts=[Name(id='str', ctx=Load(), lineno=21, col_offset=40, end_lineno=21, end_col_offset=43), Name(id='object', ctx=Load(), lineno=21, col_offset=45, end_lineno=21, end_col_offset=51)], ctx=Load(), lineno=21, col_offset=40, end_lineno=21, end_col_offset=51), ctx=Load(), lineno=21, col_offset=35, end_lineno=21, end_col_offset=52), ctx=Load(), lineno=21, col_offset=30, end_lineno=21, end_col_offset=53), lineno=21, col_offset=4, end_lineno=21, end_col_offset=53)]), body=[Expr(value=Constant(value='Canonical payloads should pass JSON Schema validation.', lineno=23, col_offset=4, end_lineno=23, end_col_offset=64), lineno=23, col_offset=4, end_lineno=23, end_col_offset=64), Expr(value=Call(func=Attribute(value=Name(id='vector_validator', ctx=Load(), lineno=24, col_offset=4, end_lineno=24, end_col_offset=20), attr='validate', ctx=Load(), lineno=24, col_offset=4, end_lineno=24, end_col_offset=29), args=[Name(id='canonical_vector_payload', ctx=Load(), lineno=24, col_offset=30, end_lineno=24, end_col_offset=54)], lineno=24, col_offset=4, end_lineno=24, end_col_offset=55), lineno=24, col_offset=4, end_lineno=24, end_col_offset=55)], returns=Constant(value=None, lineno=22, col_offset=5, end_lineno=22, end_col_offset=9), lineno=19, col_offset=0, end_lineno=24, end_col_offset=55), FunctionDef(name='test_vector_schema_rejects_missing_key', args=arguments(args=[arg(arg='vector_validator', annotation=Name(id='Draft202012ValidatorProtocol', ctx=Load(), lineno=28, col_offset=22, end_lineno=28, end_col_offset=50), lineno=28, col_offset=4, end_lineno=28, end_col_offset=50)]), body=[Expr(value=Constant(value='Missing `key` entries must produce a validation error.', lineno=30, col_offset=4, end_lineno=30, end_col_offset=64), lineno=30, col_offset=4, end_lineno=30, end_col_offset=64), Assign(targets=[Name(id='payload', ctx=Store(), lineno=31, col_offset=4, end_lineno=31, end_col_offset=11)], value=List(elts=[Dict(keys=[Constant(value='vector', lineno=31, col_offset=16, end_lineno=31, end_col_offset=24)], values=[List(elts=[Constant(value=0.1, lineno=31, col_offset=27, end_lineno=31, end_col_offset=30), Constant(value=0.2, lineno=31, col_offset=32, end_lineno=31, end_col_offset=35)], ctx=Load(), lineno=31, col_offset=26, end_lineno=31, end_col_offset=36)], lineno=31, col_offset=15, end_lineno=31, end_col_offset=37)], ctx=Load(), lineno=31, col_offset=14, end_lineno=31, end_col_offset=38), lineno=31, col_offset=4, end_lineno=31, end_col_offset=38), With(items=[withitem(context_expr=Call(func=Attribute(value=Name(id='pytest', ctx=Load(), lineno=33, col_offset=9, end_lineno=33, end_col_offset=15), attr='raises', ctx=Load(), lineno=33, col_offset=9, end_lineno=33, end_col_offset=22), args=[Name(id='ValidationError', ctx=Load(), lineno=33, col_offset=23, end_lineno=33, end_col_offset=38)], keywords=[keyword(arg='match', value=Constant(value="'key' is a required property", lineno=33, col_offset=46, end_lineno=33, end_col_offset=76), lineno=33, col_offset=40, end_lineno=33, end_col_offset=76)], lineno=33, col_offset=9, end_lineno=33, end_col_offset=77))], body=[Expr(value=Call(func=Attribute(value=Name(id='vector_validator', ctx=Load(), lineno=34, col_offset=8, end_lineno=34, end_col_offset=24), attr='validate', ctx=Load(), lineno=34, col_offset=8, end_lineno=34, end_col_offset=33), args=[Name(id='payload', ctx=Load(), lineno=34, col_offset=34, end_lineno=34, end_col_offset=41)], lineno=34, col_offset=8, end_lineno=34, end_col_offset=42), lineno=34, col_offset=8, end_lineno=34, end_col_offset=42)], lineno=33, col_offset=4, end_lineno=34, end_col_offset=42)], returns=Constant(value=None, lineno=29, col_offset=5, end_lineno=29, end_col_offset=9), lineno=27, col_offset=0, end_lineno=34, end_col_offset=42), FunctionDef(name='test_vector_schema_rejects_empty_vector', args=arguments(args=[arg(arg='vector_validator', annotation=Name(id='Draft202012ValidatorProtocol', ctx=Load(), lineno=38, col_offset=22, end_lineno=38, end_col_offset=50), lineno=38, col_offset=4, end_lineno=38, end_col_offset=50)]), body=[Expr(value=Constant(value='Vectors must contain at least one element.', lineno=40, col_offset=4, end_lineno=40, end_col_offset=52), lineno=40, col_offset=4, end_lineno=40, end_col_offset=52), Assign(targets=[Name(id='payload', ctx=Store(), lineno=41, col_offset=4, end_lineno=41, end_col_offset=11)], value=List(elts=[Dict(keys=[Constant(value='key', lineno=41, col_offset=16, end_lineno=41, end_col_offset=21), Constant(value='vector', lineno=41, col_offset=32, end_lineno=41, end_col_offset=40)], values=[Constant(value='vec-1', lineno=41, col_offset=23, end_lineno=41, end_col_offset=30), List(ctx=Load(), lineno=41, col_offset=42, end_lineno=41, end_col_offset=44)], lineno=41, col_offset=15, end_lineno=41, end_col_offset=45)], ctx=Load(), lineno=41, col_offset=14, end_lineno=41, end_col_offset=46), lineno=41, col_offset=4, end_lineno=41, end_col_offset=46), With(items=[withitem(context_expr=Call(func=Attribute(value=Name(id='pytest', ctx=Load(), lineno=43, col_offset=9, end_lineno=43, end_col_offset=15), attr='raises', ctx=Load(), lineno=43, col_offset=9, end_lineno=43, end_col_offset=22), args=[Name(id='ValidationError', ctx=Load(), lineno=43, col_offset=23, end_lineno=43, end_col_offset=38)], keywords=[keyword(arg='match', value=Constant(value='should be non-empty', lineno=43, col_offset=46, end_lineno=43, end_col_offset=67), lineno=43, col_offset=40, end_lineno=43, end_col_offset=67)], lineno=43, col_offset=9, end_lineno=43, end_col_offset=68))], body=[Expr(value=Call(func=Attribute(value=Name(id='vector_validator', ctx=Load(), lineno=44, col_offset=8, end_lineno=44, end_col_offset=24), attr='validate', ctx=Load(), lineno=44, col_offset=8, end_lineno=44, end_col_offset=33), args=[Name(id='payload', ctx=Load(), lineno=44, col_offset=34, end_lineno=44, end_col_offset=41)], lineno=44, col_offset=8, end_lineno=44, end_col_offset=42), lineno=44, col_offset=8, end_lineno=44, end_col_offset=42)], lineno=43, col_offset=4, end_lineno=44, end_col_offset=42)], returns=Constant(value=None, lineno=39, col_offset=5, end_lineno=39, end_col_offset=9), lineno=37, col_offset=0, end_lineno=44, end_col_offset=42), FunctionDef(name='test_vector_schema_rejects_non_numeric_entries', args=arguments(args=[arg(arg='vector_validator', annotation=Name(id='Draft202012ValidatorProtocol', ctx=Load(), lineno=48, col_offset=22, end_lineno=48, end_col_offset=50), lineno=48, col_offset=4, end_lineno=48, end_col_offset=50)]), body=[Expr(value=Constant(value='Vector elements must be numeric values.', lineno=50, col_offset=4, end_lineno=50, end_col_offset=49), lineno=50, col_offset=4, end_lineno=50, end_col_offset=49), Assign(targets=[Name(id='payload', ctx=Store(), lineno=51, col_offset=4, end_lineno=51, end_col_offset=11)], value=List(elts=[Dict(keys=[Constant(value='key', lineno=51, col_offset=16, end_lineno=51, end_col_offset=21), Constant(value='vector', lineno=51, col_offset=32, end_lineno=51, end_col_offset=40)], values=[Constant(value='vec-1', lineno=51, col_offset=23, end_lineno=51, end_col_offset=30), List(elts=[Constant(value='oops', lineno=51, col_offset=43, end_lineno=51, end_col_offset=49), Constant(value=0.2, lineno=51, col_offset=51, end_lineno=51, end_col_offset=54)], ctx=Load(), lineno=51, col_offset=42, end_lineno=51, end_col_offset=55)], lineno=51, col_offset=15, end_lineno=51, end_col_offset=56)], ctx=Load(), lineno=51, col_offset=14, end_lineno=51, end_col_offset=57), lineno=51, col_offset=4, end_lineno=51, end_col_offset=57), With(items=[withitem(context_expr=Call(func=Attribute(value=Name(id='pytest', ctx=Load(), lineno=53, col_offset=9, end_lineno=53, end_col_offset=15), attr='raises', ctx=Load(), lineno=53, col_offset=9, end_lineno=53, end_col_offset=22), args=[Name(id='ValidationError', ctx=Load(), lineno=53, col_offset=23, end_lineno=53, end_col_offset=38)], keywords=[keyword(arg='match', value=Constant(value="is not of type 'number'", lineno=53, col_offset=46, end_lineno=53, end_col_offset=71), lineno=53, col_offset=40, end_lineno=53, end_col_offset=71)], lineno=53, col_offset=9, end_lineno=53, end_col_offset=72))], body=[Expr(value=Call(func=Attribute(value=Name(id='vector_validator', ctx=Load(), lineno=54, col_offset=8, end_lineno=54, end_col_offset=24), attr='validate', ctx=Load(), lineno=54, col_offset=8, end_lineno=54, end_col_offset=33), args=[Name(id='payload', ctx=Load(), lineno=54, col_offset=34, end_lineno=54, end_col_offset=41)], lineno=54, col_offset=8, end_lineno=54, end_col_offset=42), lineno=54, col_offset=8, end_lineno=54, end_col_offset=42)], lineno=53, col_offset=4, end_lineno=54, end_col_offset=42)], returns=Constant(value=None, lineno=49, col_offset=5, end_lineno=49, end_col_offset=9), lineno=47, col_offset=0, end_lineno=54, end_col_offset=42), FunctionDef(name='test_vector_schema_rejects_additional_properties', args=arguments(args=[arg(arg='vector_validator', annotation=Name(id='Draft202012ValidatorProtocol', ctx=Load(), lineno=58, col_offset=22, end_lineno=58, end_col_offset=50), lineno=58, col_offset=4, end_lineno=58, end_col_offset=50)]), body=[Expr(value=Constant(value='Additional properties should be disallowed to keep payloads strict.', lineno=60, col_offset=4, end_lineno=60, end_col_offset=77), lineno=60, col_offset=4, end_lineno=60, end_col_offset=77), Assign(targets=[Name(id='payload', ctx=Store(), lineno=61, col_offset=4, end_lineno=61, end_col_offset=11)], value=List(elts=[Dict(keys=[Constant(value='key', lineno=61, col_offset=16, end_lineno=61, end_col_offset=21), Constant(value='vector', lineno=61, col_offset=32, end_lineno=61, end_col_offset=40), Constant(value='metadata', lineno=61, col_offset=54, end_lineno=61, end_col_offset=64)], values=[Constant(value='vec-1', lineno=61, col_offset=23, end_lineno=61, end_col_offset=30), List(elts=[Constant(value=0.1, lineno=61, col_offset=43, end_lineno=61, end_col_offset=46), Constant(value=0.2, lineno=61, col_offset=48, end_lineno=61, end_col_offset=51)], ctx=Load(), lineno=61, col_offset=42, end_lineno=61, end_col_offset=52), Dict(keys=[Constant(value='foo', lineno=61, col_offset=67, end_lineno=61, end_col_offset=72)], values=[Constant(value='bar', lineno=61, col_offset=74, end_lineno=61, end_col_offset=79)], lineno=61, col_offset=66, end_lineno=61, end_col_offset=80)], lineno=61, col_offset=15, end_lineno=61, end_col_offset=81)], ctx=Load(), lineno=61, col_offset=14, end_lineno=61, end_col_offset=82), lineno=61, col_offset=4, end_lineno=61, end_col_offset=82), With(items=[withitem(context_expr=Call(func=Attribute(value=Name(id='pytest', ctx=Load(), lineno=63, col_offset=9, end_lineno=63, end_col_offset=15), attr='raises', ctx=Load(), lineno=63, col_offset=9, end_lineno=63, end_col_offset=22), args=[Name(id='ValidationError', ctx=Load(), lineno=63, col_offset=23, end_lineno=63, end_col_offset=38)], keywords=[keyword(arg='match', value=Constant(value='Additional properties are not allowed', lineno=63, col_offset=46, end_lineno=63, end_col_offset=85), lineno=63, col_offset=40, end_lineno=63, end_col_offset=85)], lineno=63, col_offset=9, end_lineno=63, end_col_offset=86))], body=[Expr(value=Call(func=Attribute(value=Name(id='vector_validator', ctx=Load(), lineno=64, col_offset=8, end_lineno=64, end_col_offset=24), attr='validate', ctx=Load(), lineno=64, col_offset=8, end_lineno=64, end_col_offset=33), args=[Name(id='payload', ctx=Load(), lineno=64, col_offset=34, end_lineno=64, end_col_offset=41)], lineno=64, col_offset=8, end_lineno=64, end_col_offset=42), lineno=64, col_offset=8, end_lineno=64, end_col_offset=42)], lineno=63, col_offset=4, end_lineno=64, end_col_offset=42)], returns=Constant(value=None, lineno=59, col_offset=5, end_lineno=59, end_col_offset=9), lineno=57, col_offset=0, end_lineno=64, end_col_offset=42)])