Module(body=[Expr(value=Constant(value='Integration tests for MCP server tool wrappers.', lineno=1, col_offset=0, end_lineno=1, end_col_offset=53), lineno=1, col_offset=0, end_lineno=1, end_col_offset=53), ImportFrom(module='__future__', names=[alias(name='annotations', lineno=3, col_offset=23, end_lineno=3, end_col_offset=34)], level=0, lineno=3, col_offset=0, end_lineno=3, end_col_offset=34), ImportFrom(module='pathlib', names=[alias(name='Path', lineno=5, col_offset=20, end_lineno=5, end_col_offset=24)], level=0, lineno=5, col_offset=0, end_lineno=5, end_col_offset=24), Import(names=[alias(name='duckdb', lineno=7, col_offset=7, end_lineno=7, end_col_offset=13)], lineno=7, col_offset=0, end_lineno=7, end_col_offset=13), Import(names=[alias(name='pytest', lineno=8, col_offset=7, end_lineno=8, end_col_offset=13)], lineno=8, col_offset=0, end_lineno=8, end_col_offset=13), ImportFrom(module='codeintel_rev.app.config_context', names=[alias(name='ApplicationContext', lineno=9, col_offset=45, end_lineno=9, end_col_offset=63)], level=0, lineno=9, col_offset=0, end_lineno=9, end_col_offset=63), ImportFrom(module='codeintel_rev.app.main', names=[alias(name='app', lineno=10, col_offset=35, end_lineno=10, end_col_offset=38)], level=0, lineno=10, col_offset=0, end_lineno=10, end_col_offset=38), ImportFrom(module='fastapi.testclient', names=[alias(name='TestClient', lineno=11, col_offset=31, end_lineno=11, end_col_offset=41)], level=0, lineno=11, col_offset=0, end_lineno=11, end_col_offset=41), FunctionDef(name='test_repo', args=arguments(args=[arg(arg='tmp_path', annotation=Name(id='Path', ctx=Load(), lineno=15, col_offset=24, end_lineno=15, end_col_offset=28), lineno=15, col_offset=14, end_lineno=15, end_col_offset=28), arg(arg='monkeypatch', annotation=Attribute(value=Name(id='pytest', ctx=Load(), lineno=15, col_offset=43, end_lineno=15, end_col_offset=49), attr='MonkeyPatch', ctx=Load(), lineno=15, col_offset=43, end_lineno=15, end_col_offset=61), lineno=15, col_offset=30, end_lineno=15, end_col_offset=61)]), body=[Expr(value=Constant(value='Set up a minimal test repository environment.\n\n    Parameters\n    ----------\n    tmp_path : Path\n        Temporary directory path provided by pytest fixture.\n    monkeypatch : pytest.MonkeyPatch\n        Pytest monkeypatch fixture for modifying environment variables.\n\n    Returns\n    -------\n    Path\n        Path to the test repository root directory.\n    ', lineno=16, col_offset=4, end_lineno=29, end_col_offset=7), lineno=16, col_offset=4, end_lineno=29, end_col_offset=7), Assign(targets=[Name(id='repo_root', ctx=Store(), lineno=30, col_offset=4, end_lineno=30, end_col_offset=13)], value=BinOp(left=Name(id='tmp_path', ctx=Load(), lineno=30, col_offset=16, end_lineno=30, end_col_offset=24), op=Div(), right=Constant(value='repo', lineno=30, col_offset=27, end_lineno=30, end_col_offset=33), lineno=30, col_offset=16, end_lineno=30, end_col_offset=33), lineno=30, col_offset=4, end_lineno=30, end_col_offset=33), Expr(value=Call(func=Attribute(value=Name(id='repo_root', ctx=Load(), lineno=31, col_offset=4, end_lineno=31, end_col_offset=13), attr='mkdir', ctx=Load(), lineno=31, col_offset=4, end_lineno=31, end_col_offset=19), lineno=31, col_offset=4, end_lineno=31, end_col_offset=21), lineno=31, col_offset=4, end_lineno=31, end_col_offset=21), Assign(targets=[Name(id='data_dir', ctx=Store(), lineno=34, col_offset=4, end_lineno=34, end_col_offset=12)], value=BinOp(left=Name(id='repo_root', ctx=Load(), lineno=34, col_offset=15, end_lineno=34, end_col_offset=24), op=Div(), right=Constant(value='data', lineno=34, col_offset=27, end_lineno=34, end_col_offset=33), lineno=34, col_offset=15, end_lineno=34, end_col_offset=33), lineno=34, col_offset=4, end_lineno=34, end_col_offset=33), Expr(value=Call(func=Attribute(value=Name(id='data_dir', ctx=Load(), lineno=35, col_offset=4, end_lineno=35, end_col_offset=12), attr='mkdir', ctx=Load(), lineno=35, col_offset=4, end_lineno=35, end_col_offset=18), lineno=35, col_offset=4, end_lineno=35, end_col_offset=20), lineno=35, col_offset=4, end_lineno=35, end_col_offset=20), Expr(value=Call(func=Attribute(value=BinOp(left=Name(id='data_dir', ctx=Load(), lineno=36, col_offset=5, end_lineno=36, end_col_offset=13), op=Div(), right=Constant(value='vectors', lineno=36, col_offset=16, end_lineno=36, end_col_offset=25), lineno=36, col_offset=5, end_lineno=36, end_col_offset=25), attr='mkdir', ctx=Load(), lineno=36, col_offset=4, end_lineno=36, end_col_offset=32), lineno=36, col_offset=4, end_lineno=36, end_col_offset=34), lineno=36, col_offset=4, end_lineno=36, end_col_offset=34), Expr(value=Call(func=Attribute(value=BinOp(left=Name(id='data_dir', ctx=Load(), lineno=37, col_offset=5, end_lineno=37, end_col_offset=13), op=Div(), right=Constant(value='faiss', lineno=37, col_offset=16, end_lineno=37, end_col_offset=23), lineno=37, col_offset=5, end_lineno=37, end_col_offset=23), attr='mkdir', ctx=Load(), lineno=37, col_offset=4, end_lineno=37, end_col_offset=30), lineno=37, col_offset=4, end_lineno=37, end_col_offset=32), lineno=37, col_offset=4, end_lineno=37, end_col_offset=32), Expr(value=Call(func=Attribute(value=BinOp(left=Name(id='repo_root', ctx=Load(), lineno=40, col_offset=5, end_lineno=40, end_col_offset=14), op=Div(), right=Constant(value='test.py', lineno=40, col_offset=17, end_lineno=40, end_col_offset=26), lineno=40, col_offset=5, end_lineno=40, end_col_offset=26), attr='write_text', ctx=Load(), lineno=40, col_offset=4, end_lineno=40, end_col_offset=38), args=[Constant(value="print('hello')", lineno=40, col_offset=39, end_lineno=40, end_col_offset=55)], lineno=40, col_offset=4, end_lineno=40, end_col_offset=56), lineno=40, col_offset=4, end_lineno=40, end_col_offset=56), Expr(value=Call(func=Attribute(value=BinOp(left=BinOp(left=Name(id='data_dir', ctx=Load(), lineno=43, col_offset=5, end_lineno=43, end_col_offset=13), op=Div(), right=Constant(value='faiss', lineno=43, col_offset=16, end_lineno=43, end_col_offset=23), lineno=43, col_offset=5, end_lineno=43, end_col_offset=23), op=Div(), right=Constant(value='code.ivfpq.faiss', lineno=43, col_offset=26, end_lineno=43, end_col_offset=44), lineno=43, col_offset=5, end_lineno=43, end_col_offset=44), attr='touch', ctx=Load(), lineno=43, col_offset=4, end_lineno=43, end_col_offset=51), lineno=43, col_offset=4, end_lineno=43, end_col_offset=53), lineno=43, col_offset=4, end_lineno=43, end_col_offset=53), Assign(targets=[Name(id='duckdb_path', ctx=Store(), lineno=44, col_offset=4, end_lineno=44, end_col_offset=15)], value=BinOp(left=Name(id='data_dir', ctx=Load(), lineno=44, col_offset=18, end_lineno=44, end_col_offset=26), op=Div(), right=Constant(value='catalog.duckdb', lineno=44, col_offset=29, end_lineno=44, end_col_offset=45), lineno=44, col_offset=18, end_lineno=44, end_col_offset=45), lineno=44, col_offset=4, end_lineno=44, end_col_offset=45), Assign(targets=[Name(id='conn', ctx=Store(), lineno=46, col_offset=4, end_lineno=46, end_col_offset=8)], value=Call(func=Attribute(value=Name(id='duckdb', ctx=Load(), lineno=46, col_offset=11, end_lineno=46, end_col_offset=17), attr='connect', ctx=Load(), lineno=46, col_offset=11, end_lineno=46, end_col_offset=25), args=[Call(func=Name(id='str', ctx=Load(), lineno=46, col_offset=26, end_lineno=46, end_col_offset=29), args=[Name(id='duckdb_path', ctx=Load(), lineno=46, col_offset=30, end_lineno=46, end_col_offset=41)], lineno=46, col_offset=26, end_lineno=46, end_col_offset=42)], lineno=46, col_offset=11, end_lineno=46, end_col_offset=43), lineno=46, col_offset=4, end_lineno=46, end_col_offset=43), Expr(value=Call(func=Attribute(value=Name(id='conn', ctx=Load(), lineno=47, col_offset=4, end_lineno=47, end_col_offset=8), attr='close', ctx=Load(), lineno=47, col_offset=4, end_lineno=47, end_col_offset=14), lineno=47, col_offset=4, end_lineno=47, end_col_offset=16), lineno=47, col_offset=4, end_lineno=47, end_col_offset=16), Expr(value=Call(func=Attribute(value=Name(id='monkeypatch', ctx=Load(), lineno=49, col_offset=4, end_lineno=49, end_col_offset=15), attr='setenv', ctx=Load(), lineno=49, col_offset=4, end_lineno=49, end_col_offset=22), args=[Constant(value='REPO_ROOT', lineno=49, col_offset=23, end_lineno=49, end_col_offset=34), Call(func=Name(id='str', ctx=Load(), lineno=49, col_offset=36, end_lineno=49, end_col_offset=39), args=[Name(id='repo_root', ctx=Load(), lineno=49, col_offset=40, end_lineno=49, end_col_offset=49)], lineno=49, col_offset=36, end_lineno=49, end_col_offset=50)], lineno=49, col_offset=4, end_lineno=49, end_col_offset=51), lineno=49, col_offset=4, end_lineno=49, end_col_offset=51), Expr(value=Call(func=Attribute(value=Name(id='monkeypatch', ctx=Load(), lineno=50, col_offset=4, end_lineno=50, end_col_offset=15), attr='setenv', ctx=Load(), lineno=50, col_offset=4, end_lineno=50, end_col_offset=22), args=[Constant(value='VLLM_URL', lineno=50, col_offset=23, end_lineno=50, end_col_offset=33), Constant(value='http://localhost:8001/v1', lineno=50, col_offset=35, end_lineno=50, end_col_offset=61)], lineno=50, col_offset=4, end_lineno=50, end_col_offset=62), lineno=50, col_offset=4, end_lineno=50, end_col_offset=62), Return(value=Name(id='repo_root', ctx=Load(), lineno=52, col_offset=11, end_lineno=52, end_col_offset=20), lineno=52, col_offset=4, end_lineno=52, end_col_offset=20)], decorator_list=[Attribute(value=Name(id='pytest', ctx=Load(), lineno=14, col_offset=1, end_lineno=14, end_col_offset=7), attr='fixture', ctx=Load(), lineno=14, col_offset=1, end_lineno=14, end_col_offset=15)], returns=Name(id='Path', ctx=Load(), lineno=15, col_offset=66, end_lineno=15, end_col_offset=70), lineno=15, col_offset=0, end_lineno=52, end_col_offset=20), FunctionDef(name='test_set_scope_endpoint', args=arguments(), body=[Expr(value=Constant(value='Test that set_scope endpoint calls adapter with context.', lineno=57, col_offset=4, end_lineno=57, end_col_offset=66), lineno=57, col_offset=4, end_lineno=57, end_col_offset=66), With(items=[withitem(context_expr=Call(func=Name(id='TestClient', ctx=Load(), lineno=58, col_offset=9, end_lineno=58, end_col_offset=19), args=[Name(id='app', ctx=Load(), lineno=58, col_offset=20, end_lineno=58, end_col_offset=23)], lineno=58, col_offset=9, end_lineno=58, end_col_offset=24), optional_vars=Name(id='client', ctx=Store(), lineno=58, col_offset=28, end_lineno=58, end_col_offset=34))], body=[Assign(targets=[Name(id='response', ctx=Store(), lineno=62, col_offset=8, end_lineno=62, end_col_offset=16)], value=Call(func=Attribute(value=Name(id='client', ctx=Load(), lineno=62, col_offset=19, end_lineno=62, end_col_offset=25), attr='get', ctx=Load(), lineno=62, col_offset=19, end_lineno=62, end_col_offset=29), args=[Constant(value='/healthz', lineno=62, col_offset=30, end_lineno=62, end_col_offset=40)], lineno=62, col_offset=19, end_lineno=62, end_col_offset=41), lineno=62, col_offset=8, end_lineno=62, end_col_offset=41), Assert(test=Compare(left=Attribute(value=Name(id='response', ctx=Load(), lineno=63, col_offset=15, end_lineno=63, end_col_offset=23), attr='status_code', ctx=Load(), lineno=63, col_offset=15, end_lineno=63, end_col_offset=35), ops=[Eq()], comparators=[Constant(value=200, lineno=63, col_offset=39, end_lineno=63, end_col_offset=42)], lineno=63, col_offset=15, end_lineno=63, end_col_offset=42), lineno=63, col_offset=8, end_lineno=63, end_col_offset=42)], lineno=58, col_offset=4, end_lineno=63, end_col_offset=42)], decorator_list=[Call(func=Attribute(value=Attribute(value=Name(id='pytest', ctx=Load(), lineno=55, col_offset=1, end_lineno=55, end_col_offset=7), attr='mark', ctx=Load(), lineno=55, col_offset=1, end_lineno=55, end_col_offset=12), attr='usefixtures', ctx=Load(), lineno=55, col_offset=1, end_lineno=55, end_col_offset=24), args=[Constant(value='test_repo', lineno=55, col_offset=25, end_lineno=55, end_col_offset=36)], lineno=55, col_offset=1, end_lineno=55, end_col_offset=37)], returns=Constant(value=None, lineno=56, col_offset=33, end_lineno=56, end_col_offset=37), lineno=56, col_offset=0, end_lineno=63, end_col_offset=42), FunctionDef(name='test_list_paths_endpoint', args=arguments(), body=[Expr(value=Constant(value='Test that list_paths endpoint calls adapter with context.', lineno=68, col_offset=4, end_lineno=68, end_col_offset=67), lineno=68, col_offset=4, end_lineno=68, end_col_offset=67), With(items=[withitem(context_expr=Call(func=Name(id='TestClient', ctx=Load(), lineno=69, col_offset=9, end_lineno=69, end_col_offset=19), args=[Name(id='app', ctx=Load(), lineno=69, col_offset=20, end_lineno=69, end_col_offset=23)], lineno=69, col_offset=9, end_lineno=69, end_col_offset=24), optional_vars=Name(id='client', ctx=Store(), lineno=69, col_offset=28, end_lineno=69, end_col_offset=34))], body=[Assign(targets=[Name(id='response', ctx=Store(), lineno=71, col_offset=8, end_lineno=71, end_col_offset=16)], value=Call(func=Attribute(value=Name(id='client', ctx=Load(), lineno=71, col_offset=19, end_lineno=71, end_col_offset=25), attr='get', ctx=Load(), lineno=71, col_offset=19, end_lineno=71, end_col_offset=29), args=[Constant(value='/healthz', lineno=71, col_offset=30, end_lineno=71, end_col_offset=40)], lineno=71, col_offset=19, end_lineno=71, end_col_offset=41), lineno=71, col_offset=8, end_lineno=71, end_col_offset=41), Assert(test=Compare(left=Attribute(value=Name(id='response', ctx=Load(), lineno=72, col_offset=15, end_lineno=72, end_col_offset=23), attr='status_code', ctx=Load(), lineno=72, col_offset=15, end_lineno=72, end_col_offset=35), ops=[Eq()], comparators=[Constant(value=200, lineno=72, col_offset=39, end_lineno=72, end_col_offset=42)], lineno=72, col_offset=15, end_lineno=72, end_col_offset=42), lineno=72, col_offset=8, end_lineno=72, end_col_offset=42), Assert(test=Call(func=Name(id='hasattr', ctx=Load(), lineno=74, col_offset=15, end_lineno=74, end_col_offset=22), args=[Attribute(value=Name(id='app', ctx=Load(), lineno=74, col_offset=23, end_lineno=74, end_col_offset=26), attr='state', ctx=Load(), lineno=74, col_offset=23, end_lineno=74, end_col_offset=32), Constant(value='context', lineno=74, col_offset=34, end_lineno=74, end_col_offset=43)], lineno=74, col_offset=15, end_lineno=74, end_col_offset=44), lineno=74, col_offset=8, end_lineno=74, end_col_offset=44), Assert(test=Compare(left=Attribute(value=Attribute(value=Name(id='app', ctx=Load(), lineno=75, col_offset=15, end_lineno=75, end_col_offset=18), attr='state', ctx=Load(), lineno=75, col_offset=15, end_lineno=75, end_col_offset=24), attr='context', ctx=Load(), lineno=75, col_offset=15, end_lineno=75, end_col_offset=32), ops=[IsNot()], comparators=[Constant(value=None, lineno=75, col_offset=40, end_lineno=75, end_col_offset=44)], lineno=75, col_offset=15, end_lineno=75, end_col_offset=44), lineno=75, col_offset=8, end_lineno=75, end_col_offset=44)], lineno=69, col_offset=4, end_lineno=75, end_col_offset=44)], decorator_list=[Call(func=Attribute(value=Attribute(value=Name(id='pytest', ctx=Load(), lineno=66, col_offset=1, end_lineno=66, end_col_offset=7), attr='mark', ctx=Load(), lineno=66, col_offset=1, end_lineno=66, end_col_offset=12), attr='usefixtures', ctx=Load(), lineno=66, col_offset=1, end_lineno=66, end_col_offset=24), args=[Constant(value='test_repo', lineno=66, col_offset=25, end_lineno=66, end_col_offset=36)], lineno=66, col_offset=1, end_lineno=66, end_col_offset=37)], returns=Constant(value=None, lineno=67, col_offset=34, end_lineno=67, end_col_offset=38), lineno=67, col_offset=0, end_lineno=75, end_col_offset=44), FunctionDef(name='test_open_file_endpoint', args=arguments(), body=[Expr(value=Constant(value='Test that open_file endpoint calls adapter with context.', lineno=80, col_offset=4, end_lineno=80, end_col_offset=66), lineno=80, col_offset=4, end_lineno=80, end_col_offset=66), With(items=[withitem(context_expr=Call(func=Name(id='TestClient', ctx=Load(), lineno=81, col_offset=9, end_lineno=81, end_col_offset=19), args=[Name(id='app', ctx=Load(), lineno=81, col_offset=20, end_lineno=81, end_col_offset=23)], lineno=81, col_offset=9, end_lineno=81, end_col_offset=24), optional_vars=Name(id='client', ctx=Store(), lineno=81, col_offset=28, end_lineno=81, end_col_offset=34))], body=[Assign(targets=[Name(id='response', ctx=Store(), lineno=83, col_offset=8, end_lineno=83, end_col_offset=16)], value=Call(func=Attribute(value=Name(id='client', ctx=Load(), lineno=83, col_offset=19, end_lineno=83, end_col_offset=25), attr='get', ctx=Load(), lineno=83, col_offset=19, end_lineno=83, end_col_offset=29), args=[Constant(value='/healthz', lineno=83, col_offset=30, end_lineno=83, end_col_offset=40)], lineno=83, col_offset=19, end_lineno=83, end_col_offset=41), lineno=83, col_offset=8, end_lineno=83, end_col_offset=41), Assert(test=Compare(left=Attribute(value=Name(id='response', ctx=Load(), lineno=84, col_offset=15, end_lineno=84, end_col_offset=23), attr='status_code', ctx=Load(), lineno=84, col_offset=15, end_lineno=84, end_col_offset=35), ops=[Eq()], comparators=[Constant(value=200, lineno=84, col_offset=39, end_lineno=84, end_col_offset=42)], lineno=84, col_offset=15, end_lineno=84, end_col_offset=42), lineno=84, col_offset=8, end_lineno=84, end_col_offset=42), Assert(test=Call(func=Name(id='hasattr', ctx=Load(), lineno=85, col_offset=15, end_lineno=85, end_col_offset=22), args=[Attribute(value=Name(id='app', ctx=Load(), lineno=85, col_offset=23, end_lineno=85, end_col_offset=26), attr='state', ctx=Load(), lineno=85, col_offset=23, end_lineno=85, end_col_offset=32), Constant(value='context', lineno=85, col_offset=34, end_lineno=85, end_col_offset=43)], lineno=85, col_offset=15, end_lineno=85, end_col_offset=44), lineno=85, col_offset=8, end_lineno=85, end_col_offset=44)], lineno=81, col_offset=4, end_lineno=85, end_col_offset=44)], decorator_list=[Call(func=Attribute(value=Attribute(value=Name(id='pytest', ctx=Load(), lineno=78, col_offset=1, end_lineno=78, end_col_offset=7), attr='mark', ctx=Load(), lineno=78, col_offset=1, end_lineno=78, end_col_offset=12), attr='usefixtures', ctx=Load(), lineno=78, col_offset=1, end_lineno=78, end_col_offset=24), args=[Constant(value='test_repo', lineno=78, col_offset=25, end_lineno=78, end_col_offset=36)], lineno=78, col_offset=1, end_lineno=78, end_col_offset=37)], returns=Constant(value=None, lineno=79, col_offset=33, end_lineno=79, end_col_offset=37), lineno=79, col_offset=0, end_lineno=85, end_col_offset=44), FunctionDef(name='test_search_text_endpoint', args=arguments(), body=[Expr(value=Constant(value='Test that search_text endpoint calls adapter with context.', lineno=90, col_offset=4, end_lineno=90, end_col_offset=68), lineno=90, col_offset=4, end_lineno=90, end_col_offset=68), With(items=[withitem(context_expr=Call(func=Name(id='TestClient', ctx=Load(), lineno=91, col_offset=9, end_lineno=91, end_col_offset=19), args=[Name(id='app', ctx=Load(), lineno=91, col_offset=20, end_lineno=91, end_col_offset=23)], lineno=91, col_offset=9, end_lineno=91, end_col_offset=24), optional_vars=Name(id='client', ctx=Store(), lineno=91, col_offset=28, end_lineno=91, end_col_offset=34))], body=[Assign(targets=[Name(id='response', ctx=Store(), lineno=93, col_offset=8, end_lineno=93, end_col_offset=16)], value=Call(func=Attribute(value=Name(id='client', ctx=Load(), lineno=93, col_offset=19, end_lineno=93, end_col_offset=25), attr='get', ctx=Load(), lineno=93, col_offset=19, end_lineno=93, end_col_offset=29), args=[Constant(value='/healthz', lineno=93, col_offset=30, end_lineno=93, end_col_offset=40)], lineno=93, col_offset=19, end_lineno=93, end_col_offset=41), lineno=93, col_offset=8, end_lineno=93, end_col_offset=41), Assert(test=Compare(left=Attribute(value=Name(id='response', ctx=Load(), lineno=94, col_offset=15, end_lineno=94, end_col_offset=23), attr='status_code', ctx=Load(), lineno=94, col_offset=15, end_lineno=94, end_col_offset=35), ops=[Eq()], comparators=[Constant(value=200, lineno=94, col_offset=39, end_lineno=94, end_col_offset=42)], lineno=94, col_offset=15, end_lineno=94, end_col_offset=42), lineno=94, col_offset=8, end_lineno=94, end_col_offset=42), Assert(test=Call(func=Name(id='hasattr', ctx=Load(), lineno=95, col_offset=15, end_lineno=95, end_col_offset=22), args=[Attribute(value=Name(id='app', ctx=Load(), lineno=95, col_offset=23, end_lineno=95, end_col_offset=26), attr='state', ctx=Load(), lineno=95, col_offset=23, end_lineno=95, end_col_offset=32), Constant(value='context', lineno=95, col_offset=34, end_lineno=95, end_col_offset=43)], lineno=95, col_offset=15, end_lineno=95, end_col_offset=44), lineno=95, col_offset=8, end_lineno=95, end_col_offset=44)], lineno=91, col_offset=4, end_lineno=95, end_col_offset=44)], decorator_list=[Call(func=Attribute(value=Attribute(value=Name(id='pytest', ctx=Load(), lineno=88, col_offset=1, end_lineno=88, end_col_offset=7), attr='mark', ctx=Load(), lineno=88, col_offset=1, end_lineno=88, end_col_offset=12), attr='usefixtures', ctx=Load(), lineno=88, col_offset=1, end_lineno=88, end_col_offset=24), args=[Constant(value='test_repo', lineno=88, col_offset=25, end_lineno=88, end_col_offset=36)], lineno=88, col_offset=1, end_lineno=88, end_col_offset=37)], returns=Constant(value=None, lineno=89, col_offset=35, end_lineno=89, end_col_offset=39), lineno=89, col_offset=0, end_lineno=95, end_col_offset=44), FunctionDef(name='test_semantic_search_endpoint', args=arguments(), body=[Expr(value=Constant(value='Test that semantic_search endpoint calls adapter with context.', lineno=100, col_offset=4, end_lineno=100, end_col_offset=72), lineno=100, col_offset=4, end_lineno=100, end_col_offset=72), With(items=[withitem(context_expr=Call(func=Name(id='TestClient', ctx=Load(), lineno=101, col_offset=9, end_lineno=101, end_col_offset=19), args=[Name(id='app', ctx=Load(), lineno=101, col_offset=20, end_lineno=101, end_col_offset=23)], lineno=101, col_offset=9, end_lineno=101, end_col_offset=24), optional_vars=Name(id='client', ctx=Store(), lineno=101, col_offset=28, end_lineno=101, end_col_offset=34))], body=[Assign(targets=[Name(id='response', ctx=Store(), lineno=103, col_offset=8, end_lineno=103, end_col_offset=16)], value=Call(func=Attribute(value=Name(id='client', ctx=Load(), lineno=103, col_offset=19, end_lineno=103, end_col_offset=25), attr='get', ctx=Load(), lineno=103, col_offset=19, end_lineno=103, end_col_offset=29), args=[Constant(value='/healthz', lineno=103, col_offset=30, end_lineno=103, end_col_offset=40)], lineno=103, col_offset=19, end_lineno=103, end_col_offset=41), lineno=103, col_offset=8, end_lineno=103, end_col_offset=41), Assert(test=Compare(left=Attribute(value=Name(id='response', ctx=Load(), lineno=104, col_offset=15, end_lineno=104, end_col_offset=23), attr='status_code', ctx=Load(), lineno=104, col_offset=15, end_lineno=104, end_col_offset=35), ops=[Eq()], comparators=[Constant(value=200, lineno=104, col_offset=39, end_lineno=104, end_col_offset=42)], lineno=104, col_offset=15, end_lineno=104, end_col_offset=42), lineno=104, col_offset=8, end_lineno=104, end_col_offset=42), Assert(test=Call(func=Name(id='hasattr', ctx=Load(), lineno=105, col_offset=15, end_lineno=105, end_col_offset=22), args=[Attribute(value=Name(id='app', ctx=Load(), lineno=105, col_offset=23, end_lineno=105, end_col_offset=26), attr='state', ctx=Load(), lineno=105, col_offset=23, end_lineno=105, end_col_offset=32), Constant(value='context', lineno=105, col_offset=34, end_lineno=105, end_col_offset=43)], lineno=105, col_offset=15, end_lineno=105, end_col_offset=44), lineno=105, col_offset=8, end_lineno=105, end_col_offset=44)], lineno=101, col_offset=4, end_lineno=105, end_col_offset=44)], decorator_list=[Call(func=Attribute(value=Attribute(value=Name(id='pytest', ctx=Load(), lineno=98, col_offset=1, end_lineno=98, end_col_offset=7), attr='mark', ctx=Load(), lineno=98, col_offset=1, end_lineno=98, end_col_offset=12), attr='usefixtures', ctx=Load(), lineno=98, col_offset=1, end_lineno=98, end_col_offset=24), args=[Constant(value='test_repo', lineno=98, col_offset=25, end_lineno=98, end_col_offset=36)], lineno=98, col_offset=1, end_lineno=98, end_col_offset=37)], returns=Constant(value=None, lineno=99, col_offset=39, end_lineno=99, end_col_offset=43), lineno=99, col_offset=0, end_lineno=105, end_col_offset=44), FunctionDef(name='test_blame_range_endpoint', args=arguments(), body=[Expr(value=Constant(value='Test that blame_range endpoint calls adapter with context.', lineno=110, col_offset=4, end_lineno=110, end_col_offset=68), lineno=110, col_offset=4, end_lineno=110, end_col_offset=68), With(items=[withitem(context_expr=Call(func=Name(id='TestClient', ctx=Load(), lineno=111, col_offset=9, end_lineno=111, end_col_offset=19), args=[Name(id='app', ctx=Load(), lineno=111, col_offset=20, end_lineno=111, end_col_offset=23)], lineno=111, col_offset=9, end_lineno=111, end_col_offset=24), optional_vars=Name(id='client', ctx=Store(), lineno=111, col_offset=28, end_lineno=111, end_col_offset=34))], body=[Assign(targets=[Name(id='response', ctx=Store(), lineno=113, col_offset=8, end_lineno=113, end_col_offset=16)], value=Call(func=Attribute(value=Name(id='client', ctx=Load(), lineno=113, col_offset=19, end_lineno=113, end_col_offset=25), attr='get', ctx=Load(), lineno=113, col_offset=19, end_lineno=113, end_col_offset=29), args=[Constant(value='/healthz', lineno=113, col_offset=30, end_lineno=113, end_col_offset=40)], lineno=113, col_offset=19, end_lineno=113, end_col_offset=41), lineno=113, col_offset=8, end_lineno=113, end_col_offset=41), Assert(test=Compare(left=Attribute(value=Name(id='response', ctx=Load(), lineno=114, col_offset=15, end_lineno=114, end_col_offset=23), attr='status_code', ctx=Load(), lineno=114, col_offset=15, end_lineno=114, end_col_offset=35), ops=[Eq()], comparators=[Constant(value=200, lineno=114, col_offset=39, end_lineno=114, end_col_offset=42)], lineno=114, col_offset=15, end_lineno=114, end_col_offset=42), lineno=114, col_offset=8, end_lineno=114, end_col_offset=42), Assert(test=Call(func=Name(id='hasattr', ctx=Load(), lineno=115, col_offset=15, end_lineno=115, end_col_offset=22), args=[Attribute(value=Name(id='app', ctx=Load(), lineno=115, col_offset=23, end_lineno=115, end_col_offset=26), attr='state', ctx=Load(), lineno=115, col_offset=23, end_lineno=115, end_col_offset=32), Constant(value='context', lineno=115, col_offset=34, end_lineno=115, end_col_offset=43)], lineno=115, col_offset=15, end_lineno=115, end_col_offset=44), lineno=115, col_offset=8, end_lineno=115, end_col_offset=44)], lineno=111, col_offset=4, end_lineno=115, end_col_offset=44)], decorator_list=[Call(func=Attribute(value=Attribute(value=Name(id='pytest', ctx=Load(), lineno=108, col_offset=1, end_lineno=108, end_col_offset=7), attr='mark', ctx=Load(), lineno=108, col_offset=1, end_lineno=108, end_col_offset=12), attr='usefixtures', ctx=Load(), lineno=108, col_offset=1, end_lineno=108, end_col_offset=24), args=[Constant(value='test_repo', lineno=108, col_offset=25, end_lineno=108, end_col_offset=36)], lineno=108, col_offset=1, end_lineno=108, end_col_offset=37)], returns=Constant(value=None, lineno=109, col_offset=35, end_lineno=109, end_col_offset=39), lineno=109, col_offset=0, end_lineno=115, end_col_offset=44), FunctionDef(name='test_file_history_endpoint', args=arguments(), body=[Expr(value=Constant(value='Test that file_history endpoint calls adapter with context.', lineno=120, col_offset=4, end_lineno=120, end_col_offset=69), lineno=120, col_offset=4, end_lineno=120, end_col_offset=69), With(items=[withitem(context_expr=Call(func=Name(id='TestClient', ctx=Load(), lineno=121, col_offset=9, end_lineno=121, end_col_offset=19), args=[Name(id='app', ctx=Load(), lineno=121, col_offset=20, end_lineno=121, end_col_offset=23)], lineno=121, col_offset=9, end_lineno=121, end_col_offset=24), optional_vars=Name(id='client', ctx=Store(), lineno=121, col_offset=28, end_lineno=121, end_col_offset=34))], body=[Assign(targets=[Name(id='response', ctx=Store(), lineno=123, col_offset=8, end_lineno=123, end_col_offset=16)], value=Call(func=Attribute(value=Name(id='client', ctx=Load(), lineno=123, col_offset=19, end_lineno=123, end_col_offset=25), attr='get', ctx=Load(), lineno=123, col_offset=19, end_lineno=123, end_col_offset=29), args=[Constant(value='/healthz', lineno=123, col_offset=30, end_lineno=123, end_col_offset=40)], lineno=123, col_offset=19, end_lineno=123, end_col_offset=41), lineno=123, col_offset=8, end_lineno=123, end_col_offset=41), Assert(test=Compare(left=Attribute(value=Name(id='response', ctx=Load(), lineno=124, col_offset=15, end_lineno=124, end_col_offset=23), attr='status_code', ctx=Load(), lineno=124, col_offset=15, end_lineno=124, end_col_offset=35), ops=[Eq()], comparators=[Constant(value=200, lineno=124, col_offset=39, end_lineno=124, end_col_offset=42)], lineno=124, col_offset=15, end_lineno=124, end_col_offset=42), lineno=124, col_offset=8, end_lineno=124, end_col_offset=42), Assert(test=Call(func=Name(id='hasattr', ctx=Load(), lineno=125, col_offset=15, end_lineno=125, end_col_offset=22), args=[Attribute(value=Name(id='app', ctx=Load(), lineno=125, col_offset=23, end_lineno=125, end_col_offset=26), attr='state', ctx=Load(), lineno=125, col_offset=23, end_lineno=125, end_col_offset=32), Constant(value='context', lineno=125, col_offset=34, end_lineno=125, end_col_offset=43)], lineno=125, col_offset=15, end_lineno=125, end_col_offset=44), lineno=125, col_offset=8, end_lineno=125, end_col_offset=44)], lineno=121, col_offset=4, end_lineno=125, end_col_offset=44)], decorator_list=[Call(func=Attribute(value=Attribute(value=Name(id='pytest', ctx=Load(), lineno=118, col_offset=1, end_lineno=118, end_col_offset=7), attr='mark', ctx=Load(), lineno=118, col_offset=1, end_lineno=118, end_col_offset=12), attr='usefixtures', ctx=Load(), lineno=118, col_offset=1, end_lineno=118, end_col_offset=24), args=[Constant(value='test_repo', lineno=118, col_offset=25, end_lineno=118, end_col_offset=36)], lineno=118, col_offset=1, end_lineno=118, end_col_offset=37)], returns=Constant(value=None, lineno=119, col_offset=36, end_lineno=119, end_col_offset=40), lineno=119, col_offset=0, end_lineno=125, end_col_offset=44), FunctionDef(name='test_file_resource_endpoint', args=arguments(), body=[Expr(value=Constant(value='Test that file_resource endpoint calls adapter with context.', lineno=130, col_offset=4, end_lineno=130, end_col_offset=70), lineno=130, col_offset=4, end_lineno=130, end_col_offset=70), With(items=[withitem(context_expr=Call(func=Name(id='TestClient', ctx=Load(), lineno=131, col_offset=9, end_lineno=131, end_col_offset=19), args=[Name(id='app', ctx=Load(), lineno=131, col_offset=20, end_lineno=131, end_col_offset=23)], lineno=131, col_offset=9, end_lineno=131, end_col_offset=24), optional_vars=Name(id='client', ctx=Store(), lineno=131, col_offset=28, end_lineno=131, end_col_offset=34))], body=[Assign(targets=[Name(id='response', ctx=Store(), lineno=133, col_offset=8, end_lineno=133, end_col_offset=16)], value=Call(func=Attribute(value=Name(id='client', ctx=Load(), lineno=133, col_offset=19, end_lineno=133, end_col_offset=25), attr='get', ctx=Load(), lineno=133, col_offset=19, end_lineno=133, end_col_offset=29), args=[Constant(value='/healthz', lineno=133, col_offset=30, end_lineno=133, end_col_offset=40)], lineno=133, col_offset=19, end_lineno=133, end_col_offset=41), lineno=133, col_offset=8, end_lineno=133, end_col_offset=41), Assert(test=Compare(left=Attribute(value=Name(id='response', ctx=Load(), lineno=134, col_offset=15, end_lineno=134, end_col_offset=23), attr='status_code', ctx=Load(), lineno=134, col_offset=15, end_lineno=134, end_col_offset=35), ops=[Eq()], comparators=[Constant(value=200, lineno=134, col_offset=39, end_lineno=134, end_col_offset=42)], lineno=134, col_offset=15, end_lineno=134, end_col_offset=42), lineno=134, col_offset=8, end_lineno=134, end_col_offset=42), Assert(test=Call(func=Name(id='hasattr', ctx=Load(), lineno=135, col_offset=15, end_lineno=135, end_col_offset=22), args=[Attribute(value=Name(id='app', ctx=Load(), lineno=135, col_offset=23, end_lineno=135, end_col_offset=26), attr='state', ctx=Load(), lineno=135, col_offset=23, end_lineno=135, end_col_offset=32), Constant(value='context', lineno=135, col_offset=34, end_lineno=135, end_col_offset=43)], lineno=135, col_offset=15, end_lineno=135, end_col_offset=44), lineno=135, col_offset=8, end_lineno=135, end_col_offset=44)], lineno=131, col_offset=4, end_lineno=135, end_col_offset=44)], decorator_list=[Call(func=Attribute(value=Attribute(value=Name(id='pytest', ctx=Load(), lineno=128, col_offset=1, end_lineno=128, end_col_offset=7), attr='mark', ctx=Load(), lineno=128, col_offset=1, end_lineno=128, end_col_offset=12), attr='usefixtures', ctx=Load(), lineno=128, col_offset=1, end_lineno=128, end_col_offset=24), args=[Constant(value='test_repo', lineno=128, col_offset=25, end_lineno=128, end_col_offset=36)], lineno=128, col_offset=1, end_lineno=128, end_col_offset=37)], returns=Constant(value=None, lineno=129, col_offset=37, end_lineno=129, end_col_offset=41), lineno=129, col_offset=0, end_lineno=135, end_col_offset=44), FunctionDef(name='test_missing_context_raises_error', args=arguments(), body=[Expr(value=Constant(value='Test that missing context raises RuntimeError.', lineno=139, col_offset=4, end_lineno=139, end_col_offset=56), lineno=139, col_offset=4, end_lineno=139, end_col_offset=56), ImportFrom(module='codeintel_rev.mcp_server.server', names=[alias(name='app_context', lineno=141, col_offset=8, end_lineno=141, end_col_offset=19), alias(name='get_context', lineno=142, col_offset=8, end_lineno=142, end_col_offset=19)], level=0, lineno=140, col_offset=4, end_lineno=143, end_col_offset=5), Expr(value=Call(func=Attribute(value=Name(id='app_context', ctx=Load(), lineno=146, col_offset=4, end_lineno=146, end_col_offset=15), attr='set', ctx=Load(), lineno=146, col_offset=4, end_lineno=146, end_col_offset=19), args=[Constant(value=None, lineno=146, col_offset=20, end_lineno=146, end_col_offset=24)], lineno=146, col_offset=4, end_lineno=146, end_col_offset=25), lineno=146, col_offset=4, end_lineno=146, end_col_offset=25), With(items=[withitem(context_expr=Call(func=Attribute(value=Name(id='pytest', ctx=Load(), lineno=149, col_offset=9, end_lineno=149, end_col_offset=15), attr='raises', ctx=Load(), lineno=149, col_offset=9, end_lineno=149, end_col_offset=22), args=[Name(id='RuntimeError', ctx=Load(), lineno=149, col_offset=23, end_lineno=149, end_col_offset=35)], keywords=[keyword(arg='match', value=Constant(value='ApplicationContext not initialized', lineno=149, col_offset=43, end_lineno=149, end_col_offset=79), lineno=149, col_offset=37, end_lineno=149, end_col_offset=79)], lineno=149, col_offset=9, end_lineno=149, end_col_offset=80))], body=[Expr(value=Call(func=Name(id='get_context', ctx=Load(), lineno=150, col_offset=8, end_lineno=150, end_col_offset=19), lineno=150, col_offset=8, end_lineno=150, end_col_offset=21), lineno=150, col_offset=8, end_lineno=150, end_col_offset=21)], lineno=149, col_offset=4, end_lineno=150, end_col_offset=21)], returns=Constant(value=None, lineno=138, col_offset=43, end_lineno=138, end_col_offset=47), lineno=138, col_offset=0, end_lineno=150, end_col_offset=21), FunctionDef(name='test_get_context_success', args=arguments(args=[arg(arg='mock_application_context', annotation=Name(id='ApplicationContext', ctx=Load(), lineno=153, col_offset=55, end_lineno=153, end_col_offset=73), lineno=153, col_offset=29, end_lineno=153, end_col_offset=73)]), body=[Expr(value=Constant(value='Test that get_context returns context when available.', lineno=154, col_offset=4, end_lineno=154, end_col_offset=63), lineno=154, col_offset=4, end_lineno=154, end_col_offset=63), ImportFrom(module='codeintel_rev.mcp_server.server', names=[alias(name='app_context', lineno=156, col_offset=8, end_lineno=156, end_col_offset=19), alias(name='get_context', lineno=157, col_offset=8, end_lineno=157, end_col_offset=19)], level=0, lineno=155, col_offset=4, end_lineno=158, end_col_offset=5), Expr(value=Call(func=Attribute(value=Name(id='app_context', ctx=Load(), lineno=161, col_offset=4, end_lineno=161, end_col_offset=15), attr='set', ctx=Load(), lineno=161, col_offset=4, end_lineno=161, end_col_offset=19), args=[Name(id='mock_application_context', ctx=Load(), lineno=161, col_offset=20, end_lineno=161, end_col_offset=44)], lineno=161, col_offset=4, end_lineno=161, end_col_offset=45), lineno=161, col_offset=4, end_lineno=161, end_col_offset=45), Assign(targets=[Name(id='result', ctx=Store(), lineno=164, col_offset=4, end_lineno=164, end_col_offset=10)], value=Call(func=Name(id='get_context', ctx=Load(), lineno=164, col_offset=13, end_lineno=164, end_col_offset=24), lineno=164, col_offset=13, end_lineno=164, end_col_offset=26), lineno=164, col_offset=4, end_lineno=164, end_col_offset=26), Assert(test=Compare(left=Name(id='result', ctx=Load(), lineno=165, col_offset=11, end_lineno=165, end_col_offset=17), ops=[Is()], comparators=[Name(id='mock_application_context', ctx=Load(), lineno=165, col_offset=21, end_lineno=165, end_col_offset=45)], lineno=165, col_offset=11, end_lineno=165, end_col_offset=45), lineno=165, col_offset=4, end_lineno=165, end_col_offset=45), Expr(value=Call(func=Attribute(value=Name(id='app_context', ctx=Load(), lineno=168, col_offset=4, end_lineno=168, end_col_offset=15), attr='set', ctx=Load(), lineno=168, col_offset=4, end_lineno=168, end_col_offset=19), args=[Constant(value=None, lineno=168, col_offset=20, end_lineno=168, end_col_offset=24)], lineno=168, col_offset=4, end_lineno=168, end_col_offset=25), lineno=168, col_offset=4, end_lineno=168, end_col_offset=25)], returns=Constant(value=None, lineno=153, col_offset=78, end_lineno=153, end_col_offset=82), lineno=153, col_offset=0, end_lineno=168, end_col_offset=25)])