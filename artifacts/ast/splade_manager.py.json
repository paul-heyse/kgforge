Module(body=[Expr(value=Constant(value='SPLADE artifact management, encoding, and Lucene impact index builders.', lineno=1, col_offset=0, end_lineno=1, end_col_offset=77), lineno=1, col_offset=0, end_lineno=1, end_col_offset=77), ImportFrom(module='__future__', names=[alias(name='annotations', lineno=3, col_offset=23, end_lineno=3, end_col_offset=34)], level=0, lineno=3, col_offset=0, end_lineno=3, end_col_offset=34), Import(names=[alias(name='importlib', lineno=5, col_offset=7, end_lineno=5, end_col_offset=16)], lineno=5, col_offset=0, end_lineno=5, end_col_offset=16), Import(names=[alias(name='json', lineno=6, col_offset=7, end_lineno=6, end_col_offset=11)], lineno=6, col_offset=0, end_lineno=6, end_col_offset=11), Import(names=[alias(name='logging', lineno=7, col_offset=7, end_lineno=7, end_col_offset=14)], lineno=7, col_offset=0, end_lineno=7, end_col_offset=14), Import(names=[alias(name='math', lineno=8, col_offset=7, end_lineno=8, end_col_offset=11)], lineno=8, col_offset=0, end_lineno=8, end_col_offset=11), Import(names=[alias(name='os', lineno=9, col_offset=7, end_lineno=9, end_col_offset=9)], lineno=9, col_offset=0, end_lineno=9, end_col_offset=9), Import(names=[alias(name='shutil', lineno=10, col_offset=7, end_lineno=10, end_col_offset=13)], lineno=10, col_offset=0, end_lineno=10, end_col_offset=13), Import(names=[alias(name='statistics', lineno=11, col_offset=7, end_lineno=11, end_col_offset=17)], lineno=11, col_offset=0, end_lineno=11, end_col_offset=17), Import(names=[alias(name='sys', lineno=12, col_offset=7, end_lineno=12, end_col_offset=10)], lineno=12, col_offset=0, end_lineno=12, end_col_offset=10), ImportFrom(module='collections.abc', names=[alias(name='Iterable', lineno=13, col_offset=28, end_lineno=13, end_col_offset=36), alias(name='Sequence', lineno=13, col_offset=38, end_lineno=13, end_col_offset=46)], level=0, lineno=13, col_offset=0, end_lineno=13, end_col_offset=46), ImportFrom(module='dataclasses', names=[alias(name='dataclass', lineno=14, col_offset=24, end_lineno=14, end_col_offset=33)], level=0, lineno=14, col_offset=0, end_lineno=14, end_col_offset=33), ImportFrom(module='datetime', names=[alias(name='UTC', lineno=15, col_offset=21, end_lineno=15, end_col_offset=24), alias(name='datetime', lineno=15, col_offset=26, end_lineno=15, end_col_offset=34)], level=0, lineno=15, col_offset=0, end_lineno=15, end_col_offset=34), ImportFrom(module='pathlib', names=[alias(name='Path', lineno=16, col_offset=20, end_lineno=16, end_col_offset=24)], level=0, lineno=16, col_offset=0, end_lineno=16, end_col_offset=24), ImportFrom(module='time', names=[alias(name='perf_counter', lineno=17, col_offset=17, end_lineno=17, end_col_offset=29)], level=0, lineno=17, col_offset=0, end_lineno=17, end_col_offset=29), ImportFrom(module='typing', names=[alias(name='TYPE_CHECKING', lineno=18, col_offset=19, end_lineno=18, end_col_offset=32), alias(name='TextIO', lineno=18, col_offset=34, end_lineno=18, end_col_offset=40), alias(name='cast', lineno=18, col_offset=42, end_lineno=18, end_col_offset=46)], level=0, lineno=18, col_offset=0, end_lineno=18, end_col_offset=46), Import(names=[alias(name='msgspec', lineno=20, col_offset=7, end_lineno=20, end_col_offset=14)], lineno=20, col_offset=0, end_lineno=20, end_col_offset=14), ImportFrom(module='codeintel_rev.io.path_utils', names=[alias(name='resolve_within_repo', lineno=22, col_offset=40, end_lineno=22, end_col_offset=59)], level=0, lineno=22, col_offset=0, end_lineno=22, end_col_offset=59), ImportFrom(module='kgfoundry_common.subprocess_utils', names=[alias(name='run_subprocess', lineno=23, col_offset=46, end_lineno=23, end_col_offset=60)], level=0, lineno=23, col_offset=0, end_lineno=23, end_col_offset=60), If(test=Name(id='TYPE_CHECKING', ctx=Load(), lineno=25, col_offset=3, end_lineno=25, end_col_offset=16), body=[ImportFrom(module='typing', names=[alias(name='Protocol', lineno=26, col_offset=23, end_lineno=26, end_col_offset=31)], level=0, lineno=26, col_offset=4, end_lineno=26, end_col_offset=31), ImportFrom(module='codeintel_rev.config.settings', names=[alias(name='Settings', lineno=28, col_offset=46, end_lineno=28, end_col_offset=54)], level=0, lineno=28, col_offset=4, end_lineno=28, end_col_offset=54), ClassDef(name='_SparseEncoderProtocol', bases=[Name(id='Protocol', ctx=Load(), lineno=30, col_offset=33, end_lineno=30, end_col_offset=41)], body=[FunctionDef(name='encode_document', args=arguments(args=[arg(arg='self', lineno=31, col_offset=28, end_lineno=31, end_col_offset=32), arg(arg='sentences', annotation=Subscript(value=Name(id='Sequence', ctx=Load(), lineno=31, col_offset=45, end_lineno=31, end_col_offset=53), slice=Name(id='str', ctx=Load(), lineno=31, col_offset=54, end_lineno=31, end_col_offset=57), ctx=Load(), lineno=31, col_offset=45, end_lineno=31, end_col_offset=58), lineno=31, col_offset=34, end_lineno=31, end_col_offset=58)]), body=[Expr(value=Constant(value=Ellipsis, lineno=31, col_offset=81, end_lineno=31, end_col_offset=84), lineno=31, col_offset=81, end_lineno=31, end_col_offset=84)], returns=Subscript(value=Name(id='Sequence', ctx=Load(), lineno=31, col_offset=63, end_lineno=31, end_col_offset=71), slice=Name(id='object', ctx=Load(), lineno=31, col_offset=72, end_lineno=31, end_col_offset=78), ctx=Load(), lineno=31, col_offset=63, end_lineno=31, end_col_offset=79), lineno=31, col_offset=8, end_lineno=31, end_col_offset=84), FunctionDef(name='encode_query', args=arguments(args=[arg(arg='self', lineno=33, col_offset=25, end_lineno=33, end_col_offset=29), arg(arg='queries', annotation=Subscript(value=Name(id='Sequence', ctx=Load(), lineno=33, col_offset=40, end_lineno=33, end_col_offset=48), slice=Name(id='str', ctx=Load(), lineno=33, col_offset=49, end_lineno=33, end_col_offset=52), ctx=Load(), lineno=33, col_offset=40, end_lineno=33, end_col_offset=53), lineno=33, col_offset=31, end_lineno=33, end_col_offset=53)]), body=[Expr(value=Constant(value=Ellipsis, lineno=33, col_offset=76, end_lineno=33, end_col_offset=79), lineno=33, col_offset=76, end_lineno=33, end_col_offset=79)], returns=Subscript(value=Name(id='Sequence', ctx=Load(), lineno=33, col_offset=58, end_lineno=33, end_col_offset=66), slice=Name(id='object', ctx=Load(), lineno=33, col_offset=67, end_lineno=33, end_col_offset=73), ctx=Load(), lineno=33, col_offset=58, end_lineno=33, end_col_offset=74), lineno=33, col_offset=8, end_lineno=33, end_col_offset=79), FunctionDef(name='decode', args=arguments(args=[arg(arg='self', lineno=36, col_offset=12, end_lineno=36, end_col_offset=16), arg(arg='embeddings', annotation=Name(id='object', ctx=Load(), lineno=37, col_offset=24, end_lineno=37, end_col_offset=30), lineno=37, col_offset=12, end_lineno=37, end_col_offset=30), arg(arg='top_k', annotation=BinOp(left=Name(id='int', ctx=Load(), lineno=38, col_offset=19, end_lineno=38, end_col_offset=22), op=BitOr(), right=Constant(value=None, lineno=38, col_offset=25, end_lineno=38, end_col_offset=29), lineno=38, col_offset=19, end_lineno=38, end_col_offset=29), lineno=38, col_offset=12, end_lineno=38, end_col_offset=29)], defaults=[Constant(value=None, lineno=38, col_offset=32, end_lineno=38, end_col_offset=36)]), body=[Expr(value=Constant(value=Ellipsis, lineno=39, col_offset=52, end_lineno=39, end_col_offset=55), lineno=39, col_offset=52, end_lineno=39, end_col_offset=55)], returns=Subscript(value=Name(id='Sequence', ctx=Load(), lineno=39, col_offset=13, end_lineno=39, end_col_offset=21), slice=Subscript(value=Name(id='Sequence', ctx=Load(), lineno=39, col_offset=22, end_lineno=39, end_col_offset=30), slice=Subscript(value=Name(id='tuple', ctx=Load(), lineno=39, col_offset=31, end_lineno=39, end_col_offset=36), slice=Tuple(elts=[Name(id='str', ctx=Load(), lineno=39, col_offset=37, end_lineno=39, end_col_offset=40), Name(id='float', ctx=Load(), lineno=39, col_offset=42, end_lineno=39, end_col_offset=47)], ctx=Load(), lineno=39, col_offset=37, end_lineno=39, end_col_offset=47), ctx=Load(), lineno=39, col_offset=31, end_lineno=39, end_col_offset=48), ctx=Load(), lineno=39, col_offset=22, end_lineno=39, end_col_offset=49), ctx=Load(), lineno=39, col_offset=13, end_lineno=39, end_col_offset=50), lineno=35, col_offset=8, end_lineno=39, end_col_offset=55)], lineno=30, col_offset=4, end_lineno=39, end_col_offset=55), ClassDef(name='_OptimizerFunction', bases=[Name(id='Protocol', ctx=Load(), lineno=41, col_offset=29, end_lineno=41, end_col_offset=37)], body=[FunctionDef(name='__call__', args=arguments(args=[arg(arg='self', lineno=43, col_offset=12, end_lineno=43, end_col_offset=16), arg(arg='model', annotation=Name(id='_SparseEncoderProtocol', ctx=Load(), lineno=44, col_offset=19, end_lineno=44, end_col_offset=41), lineno=44, col_offset=12, end_lineno=44, end_col_offset=41)], kwonlyargs=[arg(arg='optimization_config', annotation=Name(id='str', ctx=Load(), lineno=46, col_offset=33, end_lineno=46, end_col_offset=36), lineno=46, col_offset=12, end_lineno=46, end_col_offset=36), arg(arg='model_name_or_path', annotation=Name(id='str', ctx=Load(), lineno=47, col_offset=32, end_lineno=47, end_col_offset=35), lineno=47, col_offset=12, end_lineno=47, end_col_offset=35), arg(arg='push_to_hub', annotation=Name(id='bool', ctx=Load(), lineno=48, col_offset=25, end_lineno=48, end_col_offset=29), lineno=48, col_offset=12, end_lineno=48, end_col_offset=29), arg(arg='create_pr', annotation=Name(id='bool', ctx=Load(), lineno=49, col_offset=23, end_lineno=49, end_col_offset=27), lineno=49, col_offset=12, end_lineno=49, end_col_offset=27)], kw_defaults=[None, None, None, None]), body=[Expr(value=Constant(value=Ellipsis, lineno=50, col_offset=19, end_lineno=50, end_col_offset=22), lineno=50, col_offset=19, end_lineno=50, end_col_offset=22)], returns=Constant(value=None, lineno=50, col_offset=13, end_lineno=50, end_col_offset=17), lineno=42, col_offset=8, end_lineno=50, end_col_offset=22)], lineno=41, col_offset=4, end_lineno=50, end_col_offset=22), ClassDef(name='_QuantizerFunction', bases=[Name(id='Protocol', ctx=Load(), lineno=52, col_offset=29, end_lineno=52, end_col_offset=37)], body=[FunctionDef(name='__call__', args=arguments(args=[arg(arg='self', lineno=54, col_offset=12, end_lineno=54, end_col_offset=16), arg(arg='model', annotation=Name(id='_SparseEncoderProtocol', ctx=Load(), lineno=55, col_offset=19, end_lineno=55, end_col_offset=41), lineno=55, col_offset=12, end_lineno=55, end_col_offset=41)], kwonlyargs=[arg(arg='quantization_config', annotation=BinOp(left=Name(id='str', ctx=Load(), lineno=57, col_offset=33, end_lineno=57, end_col_offset=36), op=BitOr(), right=Constant(value=None, lineno=57, col_offset=39, end_lineno=57, end_col_offset=43), lineno=57, col_offset=33, end_lineno=57, end_col_offset=43), lineno=57, col_offset=12, end_lineno=57, end_col_offset=43), arg(arg='model_name_or_path', annotation=Name(id='str', ctx=Load(), lineno=58, col_offset=32, end_lineno=58, end_col_offset=35), lineno=58, col_offset=12, end_lineno=58, end_col_offset=35), arg(arg='push_to_hub', annotation=Name(id='bool', ctx=Load(), lineno=59, col_offset=25, end_lineno=59, end_col_offset=29), lineno=59, col_offset=12, end_lineno=59, end_col_offset=29), arg(arg='create_pr', annotation=Name(id='bool', ctx=Load(), lineno=60, col_offset=23, end_lineno=60, end_col_offset=27), lineno=60, col_offset=12, end_lineno=60, end_col_offset=27)], kw_defaults=[None, None, None, None]), body=[Expr(value=Constant(value=Ellipsis, lineno=61, col_offset=19, end_lineno=61, end_col_offset=22), lineno=61, col_offset=19, end_lineno=61, end_col_offset=22)], returns=Constant(value=None, lineno=61, col_offset=13, end_lineno=61, end_col_offset=17), lineno=53, col_offset=8, end_lineno=61, end_col_offset=22)], lineno=52, col_offset=4, end_lineno=61, end_col_offset=22)], lineno=25, col_offset=0, end_lineno=61, end_col_offset=22), Try(body=[ImportFrom(module='sentence_transformers', names=[alias(name='SparseEncoder', lineno=65, col_offset=38, end_lineno=65, end_col_offset=51)], level=0, lineno=65, col_offset=4, end_lineno=65, end_col_offset=51)], handlers=[ExceptHandler(type=Name(id='ImportError', ctx=Load(), lineno=66, col_offset=7, end_lineno=66, end_col_offset=18), body=[Assign(targets=[Name(id='SparseEncoder', ctx=Store(), lineno=67, col_offset=4, end_lineno=67, end_col_offset=17)], value=Constant(value=None, lineno=67, col_offset=20, end_lineno=67, end_col_offset=24), lineno=67, col_offset=4, end_lineno=67, end_col_offset=24)], lineno=66, col_offset=0, end_lineno=67, end_col_offset=24)], lineno=64, col_offset=0, end_lineno=67, end_col_offset=24), Try(body=[ImportFrom(module='sentence_transformers', names=[alias(name='export_dynamic_quantized_onnx_model', lineno=71, col_offset=8, end_lineno=71, end_col_offset=43), alias(name='export_optimized_onnx_model', lineno=72, col_offset=8, end_lineno=72, end_col_offset=35)], level=0, lineno=70, col_offset=4, end_lineno=73, end_col_offset=5)], handlers=[ExceptHandler(type=Name(id='ImportError', ctx=Load(), lineno=74, col_offset=7, end_lineno=74, end_col_offset=18), body=[Assign(targets=[Name(id='export_dynamic_quantized_onnx_model', ctx=Store(), lineno=75, col_offset=4, end_lineno=75, end_col_offset=39)], value=Constant(value=None, lineno=75, col_offset=42, end_lineno=75, end_col_offset=46), lineno=75, col_offset=4, end_lineno=75, end_col_offset=46), Assign(targets=[Name(id='export_optimized_onnx_model', ctx=Store(), lineno=76, col_offset=4, end_lineno=76, end_col_offset=31)], value=Constant(value=None, lineno=76, col_offset=34, end_lineno=76, end_col_offset=38), lineno=76, col_offset=4, end_lineno=76, end_col_offset=38)], lineno=74, col_offset=0, end_lineno=76, end_col_offset=38)], lineno=69, col_offset=0, end_lineno=76, end_col_offset=38), Assign(targets=[Name(id='GENERATOR_NAME', ctx=Store(), lineno=79, col_offset=0, end_lineno=79, end_col_offset=14)], value=Constant(value='codeintel_rev.io.splade_manager', lineno=79, col_offset=17, end_lineno=79, end_col_offset=50), lineno=79, col_offset=0, end_lineno=79, end_col_offset=50), Assign(targets=[Name(id='ARTIFACT_METADATA_FILENAME', ctx=Store(), lineno=80, col_offset=0, end_lineno=80, end_col_offset=26)], value=Constant(value='artifacts.json', lineno=80, col_offset=29, end_lineno=80, end_col_offset=45), lineno=80, col_offset=0, end_lineno=80, end_col_offset=45), Assign(targets=[Name(id='ENCODING_METADATA_FILENAME', ctx=Store(), lineno=81, col_offset=0, end_lineno=81, end_col_offset=26)], value=Constant(value='vectors_metadata.json', lineno=81, col_offset=29, end_lineno=81, end_col_offset=52), lineno=81, col_offset=0, end_lineno=81, end_col_offset=52), Assign(targets=[Name(id='INDEX_METADATA_FILENAME', ctx=Store(), lineno=82, col_offset=0, end_lineno=82, end_col_offset=23)], value=Constant(value='metadata.json', lineno=82, col_offset=26, end_lineno=82, end_col_offset=41), lineno=82, col_offset=0, end_lineno=82, end_col_offset=41), Assign(targets=[Name(id='_PERCENTILE_MIN', ctx=Store(), lineno=83, col_offset=0, end_lineno=83, end_col_offset=15)], value=Constant(value=0.0, lineno=83, col_offset=18, end_lineno=83, end_col_offset=21), lineno=83, col_offset=0, end_lineno=83, end_col_offset=21), Assign(targets=[Name(id='_PERCENTILE_MAX', ctx=Store(), lineno=84, col_offset=0, end_lineno=84, end_col_offset=15)], value=Constant(value=100.0, lineno=84, col_offset=18, end_lineno=84, end_col_offset=23), lineno=84, col_offset=0, end_lineno=84, end_col_offset=23), Assign(targets=[Name(id='logger', ctx=Store(), lineno=87, col_offset=0, end_lineno=87, end_col_offset=6)], value=Call(func=Attribute(value=Name(id='logging', ctx=Load(), lineno=87, col_offset=9, end_lineno=87, end_col_offset=16), attr='getLogger', ctx=Load(), lineno=87, col_offset=9, end_lineno=87, end_col_offset=26), args=[Name(id='__name__', ctx=Load(), lineno=87, col_offset=27, end_lineno=87, end_col_offset=35)], lineno=87, col_offset=9, end_lineno=87, end_col_offset=36), lineno=87, col_offset=0, end_lineno=87, end_col_offset=36), ClassDef(name='SpladeArtifactMetadata', bases=[Attribute(value=Name(id='msgspec', ctx=Load(), lineno=90, col_offset=29, end_lineno=90, end_col_offset=36), attr='Struct', ctx=Load(), lineno=90, col_offset=29, end_lineno=90, end_col_offset=43)], keywords=[keyword(arg='frozen', value=Constant(value=True, lineno=90, col_offset=52, end_lineno=90, end_col_offset=56), lineno=90, col_offset=45, end_lineno=90, end_col_offset=56)], body=[Expr(value=Constant(value='Metadata describing exported SPLADE ONNX artifacts.', lineno=91, col_offset=4, end_lineno=91, end_col_offset=61), lineno=91, col_offset=4, end_lineno=91, end_col_offset=61), AnnAssign(target=Name(id='model_id', ctx=Store(), lineno=93, col_offset=4, end_lineno=93, end_col_offset=12), annotation=Name(id='str', ctx=Load(), lineno=93, col_offset=14, end_lineno=93, end_col_offset=17), simple=1, lineno=93, col_offset=4, end_lineno=93, end_col_offset=17), AnnAssign(target=Name(id='model_dir', ctx=Store(), lineno=94, col_offset=4, end_lineno=94, end_col_offset=13), annotation=Name(id='str', ctx=Load(), lineno=94, col_offset=15, end_lineno=94, end_col_offset=18), simple=1, lineno=94, col_offset=4, end_lineno=94, end_col_offset=18), AnnAssign(target=Name(id='onnx_dir', ctx=Store(), lineno=95, col_offset=4, end_lineno=95, end_col_offset=12), annotation=Name(id='str', ctx=Load(), lineno=95, col_offset=14, end_lineno=95, end_col_offset=17), simple=1, lineno=95, col_offset=4, end_lineno=95, end_col_offset=17), AnnAssign(target=Name(id='onnx_file', ctx=Store(), lineno=96, col_offset=4, end_lineno=96, end_col_offset=13), annotation=Name(id='str', ctx=Load(), lineno=96, col_offset=15, end_lineno=96, end_col_offset=18), simple=1, lineno=96, col_offset=4, end_lineno=96, end_col_offset=18), AnnAssign(target=Name(id='provider', ctx=Store(), lineno=97, col_offset=4, end_lineno=97, end_col_offset=12), annotation=Name(id='str', ctx=Load(), lineno=97, col_offset=14, end_lineno=97, end_col_offset=17), simple=1, lineno=97, col_offset=4, end_lineno=97, end_col_offset=17), AnnAssign(target=Name(id='optimized', ctx=Store(), lineno=98, col_offset=4, end_lineno=98, end_col_offset=13), annotation=Name(id='bool', ctx=Load(), lineno=98, col_offset=15, end_lineno=98, end_col_offset=19), simple=1, lineno=98, col_offset=4, end_lineno=98, end_col_offset=19), AnnAssign(target=Name(id='quantized', ctx=Store(), lineno=99, col_offset=4, end_lineno=99, end_col_offset=13), annotation=Name(id='bool', ctx=Load(), lineno=99, col_offset=15, end_lineno=99, end_col_offset=19), simple=1, lineno=99, col_offset=4, end_lineno=99, end_col_offset=19), AnnAssign(target=Name(id='quantization_config', ctx=Store(), lineno=100, col_offset=4, end_lineno=100, end_col_offset=23), annotation=BinOp(left=Name(id='str', ctx=Load(), lineno=100, col_offset=25, end_lineno=100, end_col_offset=28), op=BitOr(), right=Constant(value=None, lineno=100, col_offset=31, end_lineno=100, end_col_offset=35), lineno=100, col_offset=25, end_lineno=100, end_col_offset=35), simple=1, lineno=100, col_offset=4, end_lineno=100, end_col_offset=35), AnnAssign(target=Name(id='exported_at', ctx=Store(), lineno=101, col_offset=4, end_lineno=101, end_col_offset=15), annotation=Name(id='str', ctx=Load(), lineno=101, col_offset=17, end_lineno=101, end_col_offset=20), simple=1, lineno=101, col_offset=4, end_lineno=101, end_col_offset=20), AnnAssign(target=Name(id='generator', ctx=Store(), lineno=102, col_offset=4, end_lineno=102, end_col_offset=13), annotation=Name(id='str', ctx=Load(), lineno=102, col_offset=15, end_lineno=102, end_col_offset=18), simple=1, lineno=102, col_offset=4, end_lineno=102, end_col_offset=18)], lineno=90, col_offset=0, end_lineno=102, end_col_offset=18), ClassDef(name='SpladeExportSummary', bases=[Attribute(value=Name(id='msgspec', ctx=Load(), lineno=105, col_offset=26, end_lineno=105, end_col_offset=33), attr='Struct', ctx=Load(), lineno=105, col_offset=26, end_lineno=105, end_col_offset=40)], keywords=[keyword(arg='frozen', value=Constant(value=True, lineno=105, col_offset=49, end_lineno=105, end_col_offset=53), lineno=105, col_offset=42, end_lineno=105, end_col_offset=53)], body=[Expr(value=Constant(value='Summary returned after exporting SPLADE artifacts.', lineno=106, col_offset=4, end_lineno=106, end_col_offset=60), lineno=106, col_offset=4, end_lineno=106, end_col_offset=60), AnnAssign(target=Name(id='onnx_file', ctx=Store(), lineno=108, col_offset=4, end_lineno=108, end_col_offset=13), annotation=Name(id='str', ctx=Load(), lineno=108, col_offset=15, end_lineno=108, end_col_offset=18), simple=1, lineno=108, col_offset=4, end_lineno=108, end_col_offset=18), AnnAssign(target=Name(id='metadata_path', ctx=Store(), lineno=109, col_offset=4, end_lineno=109, end_col_offset=17), annotation=Name(id='str', ctx=Load(), lineno=109, col_offset=19, end_lineno=109, end_col_offset=22), simple=1, lineno=109, col_offset=4, end_lineno=109, end_col_offset=22)], lineno=105, col_offset=0, end_lineno=109, end_col_offset=22), ClassDef(name='SpladeEncodingMetadata', bases=[Attribute(value=Name(id='msgspec', ctx=Load(), lineno=112, col_offset=29, end_lineno=112, end_col_offset=36), attr='Struct', ctx=Load(), lineno=112, col_offset=29, end_lineno=112, end_col_offset=43)], keywords=[keyword(arg='frozen', value=Constant(value=True, lineno=112, col_offset=52, end_lineno=112, end_col_offset=56), lineno=112, col_offset=45, end_lineno=112, end_col_offset=56)], body=[Expr(value=Constant(value='Metadata describing SPLADE vector encoding runs.', lineno=113, col_offset=4, end_lineno=113, end_col_offset=58), lineno=113, col_offset=4, end_lineno=113, end_col_offset=58), AnnAssign(target=Name(id='doc_count', ctx=Store(), lineno=115, col_offset=4, end_lineno=115, end_col_offset=13), annotation=Name(id='int', ctx=Load(), lineno=115, col_offset=15, end_lineno=115, end_col_offset=18), simple=1, lineno=115, col_offset=4, end_lineno=115, end_col_offset=18), AnnAssign(target=Name(id='shard_count', ctx=Store(), lineno=116, col_offset=4, end_lineno=116, end_col_offset=15), annotation=Name(id='int', ctx=Load(), lineno=116, col_offset=17, end_lineno=116, end_col_offset=20), simple=1, lineno=116, col_offset=4, end_lineno=116, end_col_offset=20), AnnAssign(target=Name(id='quantization', ctx=Store(), lineno=117, col_offset=4, end_lineno=117, end_col_offset=16), annotation=Name(id='int', ctx=Load(), lineno=117, col_offset=18, end_lineno=117, end_col_offset=21), simple=1, lineno=117, col_offset=4, end_lineno=117, end_col_offset=21), AnnAssign(target=Name(id='batch_size', ctx=Store(), lineno=118, col_offset=4, end_lineno=118, end_col_offset=14), annotation=Name(id='int', ctx=Load(), lineno=118, col_offset=16, end_lineno=118, end_col_offset=19), simple=1, lineno=118, col_offset=4, end_lineno=118, end_col_offset=19), AnnAssign(target=Name(id='provider', ctx=Store(), lineno=119, col_offset=4, end_lineno=119, end_col_offset=12), annotation=Name(id='str', ctx=Load(), lineno=119, col_offset=14, end_lineno=119, end_col_offset=17), simple=1, lineno=119, col_offset=4, end_lineno=119, end_col_offset=17), AnnAssign(target=Name(id='vectors_dir', ctx=Store(), lineno=120, col_offset=4, end_lineno=120, end_col_offset=15), annotation=Name(id='str', ctx=Load(), lineno=120, col_offset=17, end_lineno=120, end_col_offset=20), simple=1, lineno=120, col_offset=4, end_lineno=120, end_col_offset=20), AnnAssign(target=Name(id='source_path', ctx=Store(), lineno=121, col_offset=4, end_lineno=121, end_col_offset=15), annotation=Name(id='str', ctx=Load(), lineno=121, col_offset=17, end_lineno=121, end_col_offset=20), simple=1, lineno=121, col_offset=4, end_lineno=121, end_col_offset=20), AnnAssign(target=Name(id='prepared_at', ctx=Store(), lineno=122, col_offset=4, end_lineno=122, end_col_offset=15), annotation=Name(id='str', ctx=Load(), lineno=122, col_offset=17, end_lineno=122, end_col_offset=20), simple=1, lineno=122, col_offset=4, end_lineno=122, end_col_offset=20), AnnAssign(target=Name(id='generator', ctx=Store(), lineno=123, col_offset=4, end_lineno=123, end_col_offset=13), annotation=Name(id='str', ctx=Load(), lineno=123, col_offset=15, end_lineno=123, end_col_offset=18), simple=1, lineno=123, col_offset=4, end_lineno=123, end_col_offset=18)], lineno=112, col_offset=0, end_lineno=123, end_col_offset=18), ClassDef(name='SpladeEncodingSummary', bases=[Attribute(value=Name(id='msgspec', ctx=Load(), lineno=126, col_offset=28, end_lineno=126, end_col_offset=35), attr='Struct', ctx=Load(), lineno=126, col_offset=28, end_lineno=126, end_col_offset=42)], keywords=[keyword(arg='frozen', value=Constant(value=True, lineno=126, col_offset=51, end_lineno=126, end_col_offset=55), lineno=126, col_offset=44, end_lineno=126, end_col_offset=55)], body=[Expr(value=Constant(value='Summary describing SPLADE encoding output.', lineno=127, col_offset=4, end_lineno=127, end_col_offset=52), lineno=127, col_offset=4, end_lineno=127, end_col_offset=52), AnnAssign(target=Name(id='doc_count', ctx=Store(), lineno=129, col_offset=4, end_lineno=129, end_col_offset=13), annotation=Name(id='int', ctx=Load(), lineno=129, col_offset=15, end_lineno=129, end_col_offset=18), simple=1, lineno=129, col_offset=4, end_lineno=129, end_col_offset=18), AnnAssign(target=Name(id='vectors_dir', ctx=Store(), lineno=130, col_offset=4, end_lineno=130, end_col_offset=15), annotation=Name(id='str', ctx=Load(), lineno=130, col_offset=17, end_lineno=130, end_col_offset=20), simple=1, lineno=130, col_offset=4, end_lineno=130, end_col_offset=20), AnnAssign(target=Name(id='metadata_path', ctx=Store(), lineno=131, col_offset=4, end_lineno=131, end_col_offset=17), annotation=Name(id='str', ctx=Load(), lineno=131, col_offset=19, end_lineno=131, end_col_offset=22), simple=1, lineno=131, col_offset=4, end_lineno=131, end_col_offset=22), AnnAssign(target=Name(id='shard_count', ctx=Store(), lineno=132, col_offset=4, end_lineno=132, end_col_offset=15), annotation=Name(id='int', ctx=Load(), lineno=132, col_offset=17, end_lineno=132, end_col_offset=20), simple=1, lineno=132, col_offset=4, end_lineno=132, end_col_offset=20)], lineno=126, col_offset=0, end_lineno=132, end_col_offset=20), ClassDef(name='SpladeBenchmarkOptions', bases=[Attribute(value=Name(id='msgspec', ctx=Load(), lineno=135, col_offset=29, end_lineno=135, end_col_offset=36), attr='Struct', ctx=Load(), lineno=135, col_offset=29, end_lineno=135, end_col_offset=43)], keywords=[keyword(arg='frozen', value=Constant(value=True, lineno=135, col_offset=52, end_lineno=135, end_col_offset=56), lineno=135, col_offset=45, end_lineno=135, end_col_offset=56)], body=[Expr(value=Constant(value='Options controlling SPLADE encoder latency benchmarks.', lineno=136, col_offset=4, end_lineno=136, end_col_offset=64), lineno=136, col_offset=4, end_lineno=136, end_col_offset=64), AnnAssign(target=Name(id='warmup_iterations', ctx=Store(), lineno=138, col_offset=4, end_lineno=138, end_col_offset=21), annotation=Name(id='int', ctx=Load(), lineno=138, col_offset=23, end_lineno=138, end_col_offset=26), value=Constant(value=3, lineno=138, col_offset=29, end_lineno=138, end_col_offset=30), simple=1, lineno=138, col_offset=4, end_lineno=138, end_col_offset=30), AnnAssign(target=Name(id='measure_iterations', ctx=Store(), lineno=139, col_offset=4, end_lineno=139, end_col_offset=22), annotation=Name(id='int', ctx=Load(), lineno=139, col_offset=24, end_lineno=139, end_col_offset=27), value=Constant(value=10, lineno=139, col_offset=30, end_lineno=139, end_col_offset=32), simple=1, lineno=139, col_offset=4, end_lineno=139, end_col_offset=32), AnnAssign(target=Name(id='provider', ctx=Store(), lineno=140, col_offset=4, end_lineno=140, end_col_offset=12), annotation=BinOp(left=Name(id='str', ctx=Load(), lineno=140, col_offset=14, end_lineno=140, end_col_offset=17), op=BitOr(), right=Constant(value=None, lineno=140, col_offset=20, end_lineno=140, end_col_offset=24), lineno=140, col_offset=14, end_lineno=140, end_col_offset=24), value=Constant(value=None, lineno=140, col_offset=27, end_lineno=140, end_col_offset=31), simple=1, lineno=140, col_offset=4, end_lineno=140, end_col_offset=31), AnnAssign(target=Name(id='onnx_file', ctx=Store(), lineno=141, col_offset=4, end_lineno=141, end_col_offset=13), annotation=BinOp(left=Name(id='str', ctx=Load(), lineno=141, col_offset=15, end_lineno=141, end_col_offset=18), op=BitOr(), right=Constant(value=None, lineno=141, col_offset=21, end_lineno=141, end_col_offset=25), lineno=141, col_offset=15, end_lineno=141, end_col_offset=25), value=Constant(value=None, lineno=141, col_offset=28, end_lineno=141, end_col_offset=32), simple=1, lineno=141, col_offset=4, end_lineno=141, end_col_offset=32)], lineno=135, col_offset=0, end_lineno=141, end_col_offset=32), ClassDef(name='SpladeBenchmarkSummary', bases=[Attribute(value=Name(id='msgspec', ctx=Load(), lineno=144, col_offset=29, end_lineno=144, end_col_offset=36), attr='Struct', ctx=Load(), lineno=144, col_offset=29, end_lineno=144, end_col_offset=43)], keywords=[keyword(arg='frozen', value=Constant(value=True, lineno=144, col_offset=52, end_lineno=144, end_col_offset=56), lineno=144, col_offset=45, end_lineno=144, end_col_offset=56)], body=[Expr(value=Constant(value='Summary describing SPLADE encoder latency benchmarks.', lineno=145, col_offset=4, end_lineno=145, end_col_offset=63), lineno=145, col_offset=4, end_lineno=145, end_col_offset=63), AnnAssign(target=Name(id='query_count', ctx=Store(), lineno=147, col_offset=4, end_lineno=147, end_col_offset=15), annotation=Name(id='int', ctx=Load(), lineno=147, col_offset=17, end_lineno=147, end_col_offset=20), simple=1, lineno=147, col_offset=4, end_lineno=147, end_col_offset=20), AnnAssign(target=Name(id='warmup_iterations', ctx=Store(), lineno=148, col_offset=4, end_lineno=148, end_col_offset=21), annotation=Name(id='int', ctx=Load(), lineno=148, col_offset=23, end_lineno=148, end_col_offset=26), simple=1, lineno=148, col_offset=4, end_lineno=148, end_col_offset=26), AnnAssign(target=Name(id='measure_iterations', ctx=Store(), lineno=149, col_offset=4, end_lineno=149, end_col_offset=22), annotation=Name(id='int', ctx=Load(), lineno=149, col_offset=24, end_lineno=149, end_col_offset=27), simple=1, lineno=149, col_offset=4, end_lineno=149, end_col_offset=27), AnnAssign(target=Name(id='min_latency_ms', ctx=Store(), lineno=150, col_offset=4, end_lineno=150, end_col_offset=18), annotation=Name(id='float', ctx=Load(), lineno=150, col_offset=20, end_lineno=150, end_col_offset=25), simple=1, lineno=150, col_offset=4, end_lineno=150, end_col_offset=25), AnnAssign(target=Name(id='max_latency_ms', ctx=Store(), lineno=151, col_offset=4, end_lineno=151, end_col_offset=18), annotation=Name(id='float', ctx=Load(), lineno=151, col_offset=20, end_lineno=151, end_col_offset=25), simple=1, lineno=151, col_offset=4, end_lineno=151, end_col_offset=25), AnnAssign(target=Name(id='mean_latency_ms', ctx=Store(), lineno=152, col_offset=4, end_lineno=152, end_col_offset=19), annotation=Name(id='float', ctx=Load(), lineno=152, col_offset=21, end_lineno=152, end_col_offset=26), simple=1, lineno=152, col_offset=4, end_lineno=152, end_col_offset=26), AnnAssign(target=Name(id='p50_latency_ms', ctx=Store(), lineno=153, col_offset=4, end_lineno=153, end_col_offset=18), annotation=Name(id='float', ctx=Load(), lineno=153, col_offset=20, end_lineno=153, end_col_offset=25), simple=1, lineno=153, col_offset=4, end_lineno=153, end_col_offset=25), AnnAssign(target=Name(id='p95_latency_ms', ctx=Store(), lineno=154, col_offset=4, end_lineno=154, end_col_offset=18), annotation=Name(id='float', ctx=Load(), lineno=154, col_offset=20, end_lineno=154, end_col_offset=25), simple=1, lineno=154, col_offset=4, end_lineno=154, end_col_offset=25), AnnAssign(target=Name(id='p99_latency_ms', ctx=Store(), lineno=155, col_offset=4, end_lineno=155, end_col_offset=18), annotation=Name(id='float', ctx=Load(), lineno=155, col_offset=20, end_lineno=155, end_col_offset=25), simple=1, lineno=155, col_offset=4, end_lineno=155, end_col_offset=25), AnnAssign(target=Name(id='provider', ctx=Store(), lineno=156, col_offset=4, end_lineno=156, end_col_offset=12), annotation=Name(id='str', ctx=Load(), lineno=156, col_offset=14, end_lineno=156, end_col_offset=17), simple=1, lineno=156, col_offset=4, end_lineno=156, end_col_offset=17), AnnAssign(target=Name(id='onnx_file', ctx=Store(), lineno=157, col_offset=4, end_lineno=157, end_col_offset=13), annotation=BinOp(left=Name(id='str', ctx=Load(), lineno=157, col_offset=15, end_lineno=157, end_col_offset=18), op=BitOr(), right=Constant(value=None, lineno=157, col_offset=21, end_lineno=157, end_col_offset=25), lineno=157, col_offset=15, end_lineno=157, end_col_offset=25), simple=1, lineno=157, col_offset=4, end_lineno=157, end_col_offset=25)], lineno=144, col_offset=0, end_lineno=157, end_col_offset=25), ClassDef(name='SpladeExportOptions', bases=[Attribute(value=Name(id='msgspec', ctx=Load(), lineno=160, col_offset=26, end_lineno=160, end_col_offset=33), attr='Struct', ctx=Load(), lineno=160, col_offset=26, end_lineno=160, end_col_offset=40)], keywords=[keyword(arg='frozen', value=Constant(value=True, lineno=160, col_offset=49, end_lineno=160, end_col_offset=53), lineno=160, col_offset=42, end_lineno=160, end_col_offset=53)], body=[Expr(value=Constant(value='Options controlling SPLADE ONNX export behaviour.', lineno=161, col_offset=4, end_lineno=161, end_col_offset=59), lineno=161, col_offset=4, end_lineno=161, end_col_offset=59), AnnAssign(target=Name(id='model_id', ctx=Store(), lineno=163, col_offset=4, end_lineno=163, end_col_offset=12), annotation=BinOp(left=Name(id='str', ctx=Load(), lineno=163, col_offset=14, end_lineno=163, end_col_offset=17), op=BitOr(), right=Constant(value=None, lineno=163, col_offset=20, end_lineno=163, end_col_offset=24), lineno=163, col_offset=14, end_lineno=163, end_col_offset=24), value=Constant(value=None, lineno=163, col_offset=27, end_lineno=163, end_col_offset=31), simple=1, lineno=163, col_offset=4, end_lineno=163, end_col_offset=31), AnnAssign(target=Name(id='provider', ctx=Store(), lineno=164, col_offset=4, end_lineno=164, end_col_offset=12), annotation=BinOp(left=Name(id='str', ctx=Load(), lineno=164, col_offset=14, end_lineno=164, end_col_offset=17), op=BitOr(), right=Constant(value=None, lineno=164, col_offset=20, end_lineno=164, end_col_offset=24), lineno=164, col_offset=14, end_lineno=164, end_col_offset=24), value=Constant(value=None, lineno=164, col_offset=27, end_lineno=164, end_col_offset=31), simple=1, lineno=164, col_offset=4, end_lineno=164, end_col_offset=31), AnnAssign(target=Name(id='file_name', ctx=Store(), lineno=165, col_offset=4, end_lineno=165, end_col_offset=13), annotation=BinOp(left=Name(id='str', ctx=Load(), lineno=165, col_offset=15, end_lineno=165, end_col_offset=18), op=BitOr(), right=Constant(value=None, lineno=165, col_offset=21, end_lineno=165, end_col_offset=25), lineno=165, col_offset=15, end_lineno=165, end_col_offset=25), value=Constant(value=None, lineno=165, col_offset=28, end_lineno=165, end_col_offset=32), simple=1, lineno=165, col_offset=4, end_lineno=165, end_col_offset=32), AnnAssign(target=Name(id='optimize', ctx=Store(), lineno=166, col_offset=4, end_lineno=166, end_col_offset=12), annotation=Name(id='bool', ctx=Load(), lineno=166, col_offset=14, end_lineno=166, end_col_offset=18), value=Constant(value=True, lineno=166, col_offset=21, end_lineno=166, end_col_offset=25), simple=1, lineno=166, col_offset=4, end_lineno=166, end_col_offset=25), AnnAssign(target=Name(id='quantize', ctx=Store(), lineno=167, col_offset=4, end_lineno=167, end_col_offset=12), annotation=Name(id='bool', ctx=Load(), lineno=167, col_offset=14, end_lineno=167, end_col_offset=18), value=Constant(value=True, lineno=167, col_offset=21, end_lineno=167, end_col_offset=25), simple=1, lineno=167, col_offset=4, end_lineno=167, end_col_offset=25), AnnAssign(target=Name(id='quantization_config', ctx=Store(), lineno=168, col_offset=4, end_lineno=168, end_col_offset=23), annotation=Name(id='str', ctx=Load(), lineno=168, col_offset=25, end_lineno=168, end_col_offset=28), value=Constant(value='avx2', lineno=168, col_offset=31, end_lineno=168, end_col_offset=37), simple=1, lineno=168, col_offset=4, end_lineno=168, end_col_offset=37)], lineno=160, col_offset=0, end_lineno=168, end_col_offset=37), ClassDef(name='SpladeEncodeOptions', bases=[Attribute(value=Name(id='msgspec', ctx=Load(), lineno=171, col_offset=26, end_lineno=171, end_col_offset=33), attr='Struct', ctx=Load(), lineno=171, col_offset=26, end_lineno=171, end_col_offset=40)], keywords=[keyword(arg='frozen', value=Constant(value=True, lineno=171, col_offset=49, end_lineno=171, end_col_offset=53), lineno=171, col_offset=42, end_lineno=171, end_col_offset=53)], body=[Expr(value=Constant(value='Options controlling SPLADE corpus encoding.', lineno=172, col_offset=4, end_lineno=172, end_col_offset=53), lineno=172, col_offset=4, end_lineno=172, end_col_offset=53), AnnAssign(target=Name(id='output_dir', ctx=Store(), lineno=174, col_offset=4, end_lineno=174, end_col_offset=14), annotation=BinOp(left=BinOp(left=Name(id='str', ctx=Load(), lineno=174, col_offset=16, end_lineno=174, end_col_offset=19), op=BitOr(), right=Name(id='Path', ctx=Load(), lineno=174, col_offset=22, end_lineno=174, end_col_offset=26), lineno=174, col_offset=16, end_lineno=174, end_col_offset=26), op=BitOr(), right=Constant(value=None, lineno=174, col_offset=29, end_lineno=174, end_col_offset=33), lineno=174, col_offset=16, end_lineno=174, end_col_offset=33), value=Constant(value=None, lineno=174, col_offset=36, end_lineno=174, end_col_offset=40), simple=1, lineno=174, col_offset=4, end_lineno=174, end_col_offset=40), AnnAssign(target=Name(id='batch_size', ctx=Store(), lineno=175, col_offset=4, end_lineno=175, end_col_offset=14), annotation=BinOp(left=Name(id='int', ctx=Load(), lineno=175, col_offset=16, end_lineno=175, end_col_offset=19), op=BitOr(), right=Constant(value=None, lineno=175, col_offset=22, end_lineno=175, end_col_offset=26), lineno=175, col_offset=16, end_lineno=175, end_col_offset=26), value=Constant(value=None, lineno=175, col_offset=29, end_lineno=175, end_col_offset=33), simple=1, lineno=175, col_offset=4, end_lineno=175, end_col_offset=33), AnnAssign(target=Name(id='quantization', ctx=Store(), lineno=176, col_offset=4, end_lineno=176, end_col_offset=16), annotation=BinOp(left=Name(id='int', ctx=Load(), lineno=176, col_offset=18, end_lineno=176, end_col_offset=21), op=BitOr(), right=Constant(value=None, lineno=176, col_offset=24, end_lineno=176, end_col_offset=28), lineno=176, col_offset=18, end_lineno=176, end_col_offset=28), value=Constant(value=None, lineno=176, col_offset=31, end_lineno=176, end_col_offset=35), simple=1, lineno=176, col_offset=4, end_lineno=176, end_col_offset=35), AnnAssign(target=Name(id='shard_size', ctx=Store(), lineno=177, col_offset=4, end_lineno=177, end_col_offset=14), annotation=Name(id='int', ctx=Load(), lineno=177, col_offset=16, end_lineno=177, end_col_offset=19), value=Constant(value=100000, lineno=177, col_offset=22, end_lineno=177, end_col_offset=29), simple=1, lineno=177, col_offset=4, end_lineno=177, end_col_offset=29), AnnAssign(target=Name(id='provider', ctx=Store(), lineno=178, col_offset=4, end_lineno=178, end_col_offset=12), annotation=BinOp(left=Name(id='str', ctx=Load(), lineno=178, col_offset=14, end_lineno=178, end_col_offset=17), op=BitOr(), right=Constant(value=None, lineno=178, col_offset=20, end_lineno=178, end_col_offset=24), lineno=178, col_offset=14, end_lineno=178, end_col_offset=24), value=Constant(value=None, lineno=178, col_offset=27, end_lineno=178, end_col_offset=31), simple=1, lineno=178, col_offset=4, end_lineno=178, end_col_offset=31), AnnAssign(target=Name(id='onnx_file', ctx=Store(), lineno=179, col_offset=4, end_lineno=179, end_col_offset=13), annotation=BinOp(left=Name(id='str', ctx=Load(), lineno=179, col_offset=15, end_lineno=179, end_col_offset=18), op=BitOr(), right=Constant(value=None, lineno=179, col_offset=21, end_lineno=179, end_col_offset=25), lineno=179, col_offset=15, end_lineno=179, end_col_offset=25), value=Constant(value=None, lineno=179, col_offset=28, end_lineno=179, end_col_offset=32), simple=1, lineno=179, col_offset=4, end_lineno=179, end_col_offset=32)], lineno=171, col_offset=0, end_lineno=179, end_col_offset=32), ClassDef(name='SpladeBuildOptions', bases=[Attribute(value=Name(id='msgspec', ctx=Load(), lineno=182, col_offset=25, end_lineno=182, end_col_offset=32), attr='Struct', ctx=Load(), lineno=182, col_offset=25, end_lineno=182, end_col_offset=39)], keywords=[keyword(arg='frozen', value=Constant(value=True, lineno=182, col_offset=48, end_lineno=182, end_col_offset=52), lineno=182, col_offset=41, end_lineno=182, end_col_offset=52)], body=[Expr(value=Constant(value='Options controlling SPLADE Lucene impact index builds.', lineno=183, col_offset=4, end_lineno=183, end_col_offset=64), lineno=183, col_offset=4, end_lineno=183, end_col_offset=64), AnnAssign(target=Name(id='vectors_dir', ctx=Store(), lineno=185, col_offset=4, end_lineno=185, end_col_offset=15), annotation=BinOp(left=BinOp(left=Name(id='str', ctx=Load(), lineno=185, col_offset=17, end_lineno=185, end_col_offset=20), op=BitOr(), right=Name(id='Path', ctx=Load(), lineno=185, col_offset=23, end_lineno=185, end_col_offset=27), lineno=185, col_offset=17, end_lineno=185, end_col_offset=27), op=BitOr(), right=Constant(value=None, lineno=185, col_offset=30, end_lineno=185, end_col_offset=34), lineno=185, col_offset=17, end_lineno=185, end_col_offset=34), value=Constant(value=None, lineno=185, col_offset=37, end_lineno=185, end_col_offset=41), simple=1, lineno=185, col_offset=4, end_lineno=185, end_col_offset=41), AnnAssign(target=Name(id='index_dir', ctx=Store(), lineno=186, col_offset=4, end_lineno=186, end_col_offset=13), annotation=BinOp(left=BinOp(left=Name(id='str', ctx=Load(), lineno=186, col_offset=15, end_lineno=186, end_col_offset=18), op=BitOr(), right=Name(id='Path', ctx=Load(), lineno=186, col_offset=21, end_lineno=186, end_col_offset=25), lineno=186, col_offset=15, end_lineno=186, end_col_offset=25), op=BitOr(), right=Constant(value=None, lineno=186, col_offset=28, end_lineno=186, end_col_offset=32), lineno=186, col_offset=15, end_lineno=186, end_col_offset=32), value=Constant(value=None, lineno=186, col_offset=35, end_lineno=186, end_col_offset=39), simple=1, lineno=186, col_offset=4, end_lineno=186, end_col_offset=39), AnnAssign(target=Name(id='threads', ctx=Store(), lineno=187, col_offset=4, end_lineno=187, end_col_offset=11), annotation=BinOp(left=Name(id='int', ctx=Load(), lineno=187, col_offset=13, end_lineno=187, end_col_offset=16), op=BitOr(), right=Constant(value=None, lineno=187, col_offset=19, end_lineno=187, end_col_offset=23), lineno=187, col_offset=13, end_lineno=187, end_col_offset=23), value=Constant(value=None, lineno=187, col_offset=26, end_lineno=187, end_col_offset=30), simple=1, lineno=187, col_offset=4, end_lineno=187, end_col_offset=30), AnnAssign(target=Name(id='max_clause_count', ctx=Store(), lineno=188, col_offset=4, end_lineno=188, end_col_offset=20), annotation=BinOp(left=Name(id='int', ctx=Load(), lineno=188, col_offset=22, end_lineno=188, end_col_offset=25), op=BitOr(), right=Constant(value=None, lineno=188, col_offset=28, end_lineno=188, end_col_offset=32), lineno=188, col_offset=22, end_lineno=188, end_col_offset=32), value=Constant(value=None, lineno=188, col_offset=35, end_lineno=188, end_col_offset=39), simple=1, lineno=188, col_offset=4, end_lineno=188, end_col_offset=39), AnnAssign(target=Name(id='overwrite', ctx=Store(), lineno=189, col_offset=4, end_lineno=189, end_col_offset=13), annotation=Name(id='bool', ctx=Load(), lineno=189, col_offset=15, end_lineno=189, end_col_offset=19), value=Constant(value=True, lineno=189, col_offset=22, end_lineno=189, end_col_offset=26), simple=1, lineno=189, col_offset=4, end_lineno=189, end_col_offset=26)], lineno=182, col_offset=0, end_lineno=189, end_col_offset=26), ClassDef(name='SpladeIndexMetadata', bases=[Attribute(value=Name(id='msgspec', ctx=Load(), lineno=192, col_offset=26, end_lineno=192, end_col_offset=33), attr='Struct', ctx=Load(), lineno=192, col_offset=26, end_lineno=192, end_col_offset=40)], keywords=[keyword(arg='frozen', value=Constant(value=True, lineno=192, col_offset=49, end_lineno=192, end_col_offset=53), lineno=192, col_offset=42, end_lineno=192, end_col_offset=53)], body=[Expr(value=Constant(value='Metadata describing a SPLADE Lucene impact index.', lineno=193, col_offset=4, end_lineno=193, end_col_offset=59), lineno=193, col_offset=4, end_lineno=193, end_col_offset=59), AnnAssign(target=Name(id='doc_count', ctx=Store(), lineno=195, col_offset=4, end_lineno=195, end_col_offset=13), annotation=BinOp(left=Name(id='int', ctx=Load(), lineno=195, col_offset=15, end_lineno=195, end_col_offset=18), op=BitOr(), right=Constant(value=None, lineno=195, col_offset=21, end_lineno=195, end_col_offset=25), lineno=195, col_offset=15, end_lineno=195, end_col_offset=25), simple=1, lineno=195, col_offset=4, end_lineno=195, end_col_offset=25), AnnAssign(target=Name(id='built_at', ctx=Store(), lineno=196, col_offset=4, end_lineno=196, end_col_offset=12), annotation=Name(id='str', ctx=Load(), lineno=196, col_offset=14, end_lineno=196, end_col_offset=17), simple=1, lineno=196, col_offset=4, end_lineno=196, end_col_offset=17), AnnAssign(target=Name(id='vectors_dir', ctx=Store(), lineno=197, col_offset=4, end_lineno=197, end_col_offset=15), annotation=Name(id='str', ctx=Load(), lineno=197, col_offset=17, end_lineno=197, end_col_offset=20), simple=1, lineno=197, col_offset=4, end_lineno=197, end_col_offset=20), AnnAssign(target=Name(id='corpus_digest', ctx=Store(), lineno=198, col_offset=4, end_lineno=198, end_col_offset=17), annotation=BinOp(left=Name(id='str', ctx=Load(), lineno=198, col_offset=19, end_lineno=198, end_col_offset=22), op=BitOr(), right=Constant(value=None, lineno=198, col_offset=25, end_lineno=198, end_col_offset=29), lineno=198, col_offset=19, end_lineno=198, end_col_offset=29), simple=1, lineno=198, col_offset=4, end_lineno=198, end_col_offset=29), AnnAssign(target=Name(id='pyserini_version', ctx=Store(), lineno=199, col_offset=4, end_lineno=199, end_col_offset=20), annotation=Name(id='str', ctx=Load(), lineno=199, col_offset=22, end_lineno=199, end_col_offset=25), simple=1, lineno=199, col_offset=4, end_lineno=199, end_col_offset=25), AnnAssign(target=Name(id='threads', ctx=Store(), lineno=200, col_offset=4, end_lineno=200, end_col_offset=11), annotation=Name(id='int', ctx=Load(), lineno=200, col_offset=13, end_lineno=200, end_col_offset=16), simple=1, lineno=200, col_offset=4, end_lineno=200, end_col_offset=16), AnnAssign(target=Name(id='index_dir', ctx=Store(), lineno=201, col_offset=4, end_lineno=201, end_col_offset=13), annotation=Name(id='str', ctx=Load(), lineno=201, col_offset=15, end_lineno=201, end_col_offset=18), simple=1, lineno=201, col_offset=4, end_lineno=201, end_col_offset=18), AnnAssign(target=Name(id='index_size_bytes', ctx=Store(), lineno=202, col_offset=4, end_lineno=202, end_col_offset=20), annotation=Name(id='int', ctx=Load(), lineno=202, col_offset=22, end_lineno=202, end_col_offset=25), simple=1, lineno=202, col_offset=4, end_lineno=202, end_col_offset=25), AnnAssign(target=Name(id='generator', ctx=Store(), lineno=203, col_offset=4, end_lineno=203, end_col_offset=13), annotation=Name(id='str', ctx=Load(), lineno=203, col_offset=15, end_lineno=203, end_col_offset=18), simple=1, lineno=203, col_offset=4, end_lineno=203, end_col_offset=18)], lineno=192, col_offset=0, end_lineno=203, end_col_offset=18), ClassDef(name='_ShardState', body=[Expr(value=Constant(value='Mutable encoding state for shard rotation.', lineno=208, col_offset=4, end_lineno=208, end_col_offset=52), lineno=208, col_offset=4, end_lineno=208, end_col_offset=52), AnnAssign(target=Name(id='vectors_dir', ctx=Store(), lineno=210, col_offset=4, end_lineno=210, end_col_offset=15), annotation=Name(id='Path', ctx=Load(), lineno=210, col_offset=17, end_lineno=210, end_col_offset=21), simple=1, lineno=210, col_offset=4, end_lineno=210, end_col_offset=21), AnnAssign(target=Name(id='quantization', ctx=Store(), lineno=211, col_offset=4, end_lineno=211, end_col_offset=16), annotation=Name(id='int', ctx=Load(), lineno=211, col_offset=18, end_lineno=211, end_col_offset=21), simple=1, lineno=211, col_offset=4, end_lineno=211, end_col_offset=21), AnnAssign(target=Name(id='shard_size', ctx=Store(), lineno=212, col_offset=4, end_lineno=212, end_col_offset=14), annotation=Name(id='int', ctx=Load(), lineno=212, col_offset=16, end_lineno=212, end_col_offset=19), simple=1, lineno=212, col_offset=4, end_lineno=212, end_col_offset=19), AnnAssign(target=Name(id='doc_count', ctx=Store(), lineno=213, col_offset=4, end_lineno=213, end_col_offset=13), annotation=Name(id='int', ctx=Load(), lineno=213, col_offset=15, end_lineno=213, end_col_offset=18), value=Constant(value=0, lineno=213, col_offset=21, end_lineno=213, end_col_offset=22), simple=1, lineno=213, col_offset=4, end_lineno=213, end_col_offset=22), AnnAssign(target=Name(id='shard_index', ctx=Store(), lineno=214, col_offset=4, end_lineno=214, end_col_offset=15), annotation=Name(id='int', ctx=Load(), lineno=214, col_offset=17, end_lineno=214, end_col_offset=20), value=Constant(value=0, lineno=214, col_offset=23, end_lineno=214, end_col_offset=24), simple=1, lineno=214, col_offset=4, end_lineno=214, end_col_offset=24), AnnAssign(target=Name(id='shard_handle', ctx=Store(), lineno=215, col_offset=4, end_lineno=215, end_col_offset=16), annotation=BinOp(left=Name(id='TextIO', ctx=Load(), lineno=215, col_offset=18, end_lineno=215, end_col_offset=24), op=BitOr(), right=Constant(value=None, lineno=215, col_offset=27, end_lineno=215, end_col_offset=31), lineno=215, col_offset=18, end_lineno=215, end_col_offset=31), value=Constant(value=None, lineno=215, col_offset=34, end_lineno=215, end_col_offset=38), simple=1, lineno=215, col_offset=4, end_lineno=215, end_col_offset=38), AnnAssign(target=Name(id='shard_count', ctx=Store(), lineno=216, col_offset=4, end_lineno=216, end_col_offset=15), annotation=Name(id='int', ctx=Load(), lineno=216, col_offset=17, end_lineno=216, end_col_offset=20), value=Constant(value=0, lineno=216, col_offset=23, end_lineno=216, end_col_offset=24), simple=1, lineno=216, col_offset=4, end_lineno=216, end_col_offset=24)], decorator_list=[Name(id='dataclass', ctx=Load(), lineno=206, col_offset=1, end_lineno=206, end_col_offset=10)], lineno=207, col_offset=0, end_lineno=216, end_col_offset=24), ClassDef(name='_ExportContext', body=[Expr(value=Constant(value='Context for SPLADE export operations.', lineno=221, col_offset=4, end_lineno=221, end_col_offset=47), lineno=221, col_offset=4, end_lineno=221, end_col_offset=47), AnnAssign(target=Name(id='model_id', ctx=Store(), lineno=223, col_offset=4, end_lineno=223, end_col_offset=12), annotation=Name(id='str', ctx=Load(), lineno=223, col_offset=14, end_lineno=223, end_col_offset=17), simple=1, lineno=223, col_offset=4, end_lineno=223, end_col_offset=17), AnnAssign(target=Name(id='model_dir', ctx=Store(), lineno=224, col_offset=4, end_lineno=224, end_col_offset=13), annotation=Name(id='Path', ctx=Load(), lineno=224, col_offset=15, end_lineno=224, end_col_offset=19), simple=1, lineno=224, col_offset=4, end_lineno=224, end_col_offset=19), AnnAssign(target=Name(id='onnx_dir', ctx=Store(), lineno=225, col_offset=4, end_lineno=225, end_col_offset=12), annotation=Name(id='Path', ctx=Load(), lineno=225, col_offset=14, end_lineno=225, end_col_offset=18), simple=1, lineno=225, col_offset=4, end_lineno=225, end_col_offset=18), AnnAssign(target=Name(id='provider', ctx=Store(), lineno=226, col_offset=4, end_lineno=226, end_col_offset=12), annotation=Name(id='str', ctx=Load(), lineno=226, col_offset=14, end_lineno=226, end_col_offset=17), simple=1, lineno=226, col_offset=4, end_lineno=226, end_col_offset=17), AnnAssign(target=Name(id='target_path', ctx=Store(), lineno=227, col_offset=4, end_lineno=227, end_col_offset=15), annotation=Name(id='Path', ctx=Load(), lineno=227, col_offset=17, end_lineno=227, end_col_offset=21), simple=1, lineno=227, col_offset=4, end_lineno=227, end_col_offset=21), AnnAssign(target=Name(id='options', ctx=Store(), lineno=228, col_offset=4, end_lineno=228, end_col_offset=11), annotation=Name(id='SpladeExportOptions', ctx=Load(), lineno=228, col_offset=13, end_lineno=228, end_col_offset=32), simple=1, lineno=228, col_offset=4, end_lineno=228, end_col_offset=32)], decorator_list=[Call(func=Name(id='dataclass', ctx=Load(), lineno=219, col_offset=1, end_lineno=219, end_col_offset=10), keywords=[keyword(arg='frozen', value=Constant(value=True, lineno=219, col_offset=18, end_lineno=219, end_col_offset=22), lineno=219, col_offset=11, end_lineno=219, end_col_offset=22)], lineno=219, col_offset=1, end_lineno=219, end_col_offset=23)], lineno=220, col_offset=0, end_lineno=228, end_col_offset=32), FunctionDef(name='_require_sparse_encoder', args=arguments(), body=[If(test=Compare(left=Name(id='SparseEncoder', ctx=Load(), lineno=232, col_offset=7, end_lineno=232, end_col_offset=20), ops=[Is()], comparators=[Constant(value=None, lineno=232, col_offset=24, end_lineno=232, end_col_offset=28)], lineno=232, col_offset=7, end_lineno=232, end_col_offset=28), body=[Assign(targets=[Name(id='msg', ctx=Store(), lineno=233, col_offset=8, end_lineno=233, end_col_offset=11)], value=Constant(value="sentence-transformers with SparseEncoder support is required for SPLADE operations. Install the 'sentence-transformers[onnx]' extra.", lineno=234, col_offset=12, end_lineno=235, end_col_offset=74), lineno=233, col_offset=8, end_lineno=236, end_col_offset=9), Raise(exc=Call(func=Name(id='RuntimeError', ctx=Load(), lineno=237, col_offset=14, end_lineno=237, end_col_offset=26), args=[Name(id='msg', ctx=Load(), lineno=237, col_offset=27, end_lineno=237, end_col_offset=30)], lineno=237, col_offset=14, end_lineno=237, end_col_offset=31), lineno=237, col_offset=8, end_lineno=237, end_col_offset=31)], lineno=232, col_offset=4, end_lineno=237, end_col_offset=31), Return(value=Name(id='SparseEncoder', ctx=Load(), lineno=238, col_offset=11, end_lineno=238, end_col_offset=24), lineno=238, col_offset=4, end_lineno=238, end_col_offset=24)], returns=Name(id='type', ctx=Load(), lineno=231, col_offset=33, end_lineno=231, end_col_offset=37), lineno=231, col_offset=0, end_lineno=238, end_col_offset=24), FunctionDef(name='_require_export_helpers', args=arguments(), body=[If(test=BoolOp(op=Or(), values=[Compare(left=Name(id='export_optimized_onnx_model', ctx=Load(), lineno=242, col_offset=7, end_lineno=242, end_col_offset=34), ops=[Is()], comparators=[Constant(value=None, lineno=242, col_offset=38, end_lineno=242, end_col_offset=42)], lineno=242, col_offset=7, end_lineno=242, end_col_offset=42), Compare(left=Name(id='export_dynamic_quantized_onnx_model', ctx=Load(), lineno=242, col_offset=46, end_lineno=242, end_col_offset=81), ops=[Is()], comparators=[Constant(value=None, lineno=242, col_offset=85, end_lineno=242, end_col_offset=89)], lineno=242, col_offset=46, end_lineno=242, end_col_offset=89)], lineno=242, col_offset=7, end_lineno=242, end_col_offset=89), body=[Assign(targets=[Name(id='msg', ctx=Store(), lineno=243, col_offset=8, end_lineno=243, end_col_offset=11)], value=Constant(value='SPLADE export helpers are unavailable. Upgrade sentence-transformers to a version providing export_optimized_onnx_model and export_dynamic_quantized_onnx_model.', lineno=244, col_offset=12, end_lineno=246, end_col_offset=50), lineno=243, col_offset=8, end_lineno=247, end_col_offset=9), Raise(exc=Call(func=Name(id='RuntimeError', ctx=Load(), lineno=248, col_offset=14, end_lineno=248, end_col_offset=26), args=[Name(id='msg', ctx=Load(), lineno=248, col_offset=27, end_lineno=248, end_col_offset=30)], lineno=248, col_offset=14, end_lineno=248, end_col_offset=31), lineno=248, col_offset=8, end_lineno=248, end_col_offset=31)], lineno=242, col_offset=4, end_lineno=248, end_col_offset=31), Return(value=Tuple(elts=[Call(func=Name(id='cast', ctx=Load(), lineno=249, col_offset=11, end_lineno=249, end_col_offset=15), args=[Constant(value='_OptimizerFunction', lineno=249, col_offset=16, end_lineno=249, end_col_offset=36), Name(id='export_optimized_onnx_model', ctx=Load(), lineno=249, col_offset=38, end_lineno=249, end_col_offset=65)], lineno=249, col_offset=11, end_lineno=249, end_col_offset=66), Call(func=Name(id='cast', ctx=Load(), lineno=249, col_offset=68, end_lineno=249, end_col_offset=72), args=[Constant(value='_QuantizerFunction', lineno=250, col_offset=8, end_lineno=250, end_col_offset=28), Name(id='export_dynamic_quantized_onnx_model', ctx=Load(), lineno=250, col_offset=30, end_lineno=250, end_col_offset=65)], lineno=249, col_offset=68, end_lineno=251, end_col_offset=5)], ctx=Load(), lineno=249, col_offset=11, end_lineno=251, end_col_offset=5), lineno=249, col_offset=4, end_lineno=251, end_col_offset=5)], returns=Subscript(value=Name(id='tuple', ctx=Load(), lineno=241, col_offset=33, end_lineno=241, end_col_offset=38), slice=Tuple(elts=[Name(id='_OptimizerFunction', ctx=Load(), lineno=241, col_offset=39, end_lineno=241, end_col_offset=57), Name(id='_QuantizerFunction', ctx=Load(), lineno=241, col_offset=59, end_lineno=241, end_col_offset=77)], ctx=Load(), lineno=241, col_offset=39, end_lineno=241, end_col_offset=77), ctx=Load(), lineno=241, col_offset=33, end_lineno=241, end_col_offset=78), lineno=241, col_offset=0, end_lineno=251, end_col_offset=5), FunctionDef(name='_write_struct', args=arguments(args=[arg(arg='target', annotation=Name(id='Path', ctx=Load(), lineno=254, col_offset=26, end_lineno=254, end_col_offset=30), lineno=254, col_offset=18, end_lineno=254, end_col_offset=30), arg(arg='payload', annotation=Attribute(value=Name(id='msgspec', ctx=Load(), lineno=254, col_offset=41, end_lineno=254, end_col_offset=48), attr='Struct', ctx=Load(), lineno=254, col_offset=41, end_lineno=254, end_col_offset=55), lineno=254, col_offset=32, end_lineno=254, end_col_offset=55)]), body=[Expr(value=Call(func=Attribute(value=Attribute(value=Name(id='target', ctx=Load(), lineno=255, col_offset=4, end_lineno=255, end_col_offset=10), attr='parent', ctx=Load(), lineno=255, col_offset=4, end_lineno=255, end_col_offset=17), attr='mkdir', ctx=Load(), lineno=255, col_offset=4, end_lineno=255, end_col_offset=23), keywords=[keyword(arg='parents', value=Constant(value=True, lineno=255, col_offset=32, end_lineno=255, end_col_offset=36), lineno=255, col_offset=24, end_lineno=255, end_col_offset=36), keyword(arg='exist_ok', value=Constant(value=True, lineno=255, col_offset=47, end_lineno=255, end_col_offset=51), lineno=255, col_offset=38, end_lineno=255, end_col_offset=51)], lineno=255, col_offset=4, end_lineno=255, end_col_offset=52), lineno=255, col_offset=4, end_lineno=255, end_col_offset=52), Expr(value=Call(func=Attribute(value=Name(id='target', ctx=Load(), lineno=256, col_offset=4, end_lineno=256, end_col_offset=10), attr='write_text', ctx=Load(), lineno=256, col_offset=4, end_lineno=256, end_col_offset=21), args=[Call(func=Attribute(value=Name(id='json', ctx=Load(), lineno=257, col_offset=8, end_lineno=257, end_col_offset=12), attr='dumps', ctx=Load(), lineno=257, col_offset=8, end_lineno=257, end_col_offset=18), args=[Call(func=Attribute(value=Name(id='msgspec', ctx=Load(), lineno=257, col_offset=19, end_lineno=257, end_col_offset=26), attr='to_builtins', ctx=Load(), lineno=257, col_offset=19, end_lineno=257, end_col_offset=38), args=[Name(id='payload', ctx=Load(), lineno=257, col_offset=39, end_lineno=257, end_col_offset=46)], lineno=257, col_offset=19, end_lineno=257, end_col_offset=47)], keywords=[keyword(arg='ensure_ascii', value=Constant(value=False, lineno=257, col_offset=62, end_lineno=257, end_col_offset=67), lineno=257, col_offset=49, end_lineno=257, end_col_offset=67), keyword(arg='indent', value=Constant(value=2, lineno=257, col_offset=76, end_lineno=257, end_col_offset=77), lineno=257, col_offset=69, end_lineno=257, end_col_offset=77)], lineno=257, col_offset=8, end_lineno=257, end_col_offset=78)], keywords=[keyword(arg='encoding', value=Constant(value='utf-8', lineno=258, col_offset=17, end_lineno=258, end_col_offset=24), lineno=258, col_offset=8, end_lineno=258, end_col_offset=24)], lineno=256, col_offset=4, end_lineno=259, end_col_offset=5), lineno=256, col_offset=4, end_lineno=259, end_col_offset=5)], returns=Constant(value=None, lineno=254, col_offset=60, end_lineno=254, end_col_offset=64), lineno=254, col_offset=0, end_lineno=259, end_col_offset=5), FunctionDef(name='_directory_size', args=arguments(args=[arg(arg='path', annotation=Name(id='Path', ctx=Load(), lineno=262, col_offset=26, end_lineno=262, end_col_offset=30), lineno=262, col_offset=20, end_lineno=262, end_col_offset=30)]), body=[Expr(value=Constant(value="Compute total size in bytes for all files beneath a directory.\n\n    This utility function recursively traverses a directory tree and sums the\n    sizes of all regular files found. It's used to calculate index sizes for\n    metadata purposes. Symbolic links are followed, but directories themselves\n    don't contribute to the size.\n\n    Parameters\n    ----------\n    path : Path\n        Root directory path to measure. The function recursively traverses all\n        subdirectories and sums file sizes. The path must exist and be a directory.\n\n    Returns\n    -------\n    int\n        Total size in bytes for all regular files contained within the directory\n        tree. Returns 0 if the directory is empty or contains no files. The\n        size is calculated using file system stat information (st_size).\n    ", lineno=263, col_offset=4, end_lineno=282, end_col_offset=7), lineno=263, col_offset=4, end_lineno=282, end_col_offset=7), Assign(targets=[Name(id='total', ctx=Store(), lineno=283, col_offset=4, end_lineno=283, end_col_offset=9)], value=Constant(value=0, lineno=283, col_offset=12, end_lineno=283, end_col_offset=13), lineno=283, col_offset=4, end_lineno=283, end_col_offset=13), For(target=Name(id='child', ctx=Store(), lineno=284, col_offset=8, end_lineno=284, end_col_offset=13), iter=Call(func=Attribute(value=Name(id='path', ctx=Load(), lineno=284, col_offset=17, end_lineno=284, end_col_offset=21), attr='rglob', ctx=Load(), lineno=284, col_offset=17, end_lineno=284, end_col_offset=27), args=[Constant(value='*', lineno=284, col_offset=28, end_lineno=284, end_col_offset=31)], lineno=284, col_offset=17, end_lineno=284, end_col_offset=32), body=[If(test=Call(func=Attribute(value=Name(id='child', ctx=Load(), lineno=285, col_offset=11, end_lineno=285, end_col_offset=16), attr='is_file', ctx=Load(), lineno=285, col_offset=11, end_lineno=285, end_col_offset=24), lineno=285, col_offset=11, end_lineno=285, end_col_offset=26), body=[AugAssign(target=Name(id='total', ctx=Store(), lineno=286, col_offset=12, end_lineno=286, end_col_offset=17), op=Add(), value=Attribute(value=Call(func=Attribute(value=Name(id='child', ctx=Load(), lineno=286, col_offset=21, end_lineno=286, end_col_offset=26), attr='stat', ctx=Load(), lineno=286, col_offset=21, end_lineno=286, end_col_offset=31), lineno=286, col_offset=21, end_lineno=286, end_col_offset=33), attr='st_size', ctx=Load(), lineno=286, col_offset=21, end_lineno=286, end_col_offset=41), lineno=286, col_offset=12, end_lineno=286, end_col_offset=41)], lineno=285, col_offset=8, end_lineno=286, end_col_offset=41)], lineno=284, col_offset=4, end_lineno=286, end_col_offset=41), Return(value=Name(id='total', ctx=Load(), lineno=287, col_offset=11, end_lineno=287, end_col_offset=16), lineno=287, col_offset=4, end_lineno=287, end_col_offset=16)], returns=Name(id='int', ctx=Load(), lineno=262, col_offset=35, end_lineno=262, end_col_offset=38), lineno=262, col_offset=0, end_lineno=287, end_col_offset=16), FunctionDef(name='_detect_pyserini_version', args=arguments(), body=[Try(body=[Assign(targets=[Name(id='module', ctx=Store(), lineno=292, col_offset=8, end_lineno=292, end_col_offset=14)], value=Call(func=Attribute(value=Name(id='importlib', ctx=Load(), lineno=292, col_offset=17, end_lineno=292, end_col_offset=26), attr='import_module', ctx=Load(), lineno=292, col_offset=17, end_lineno=292, end_col_offset=40), args=[Constant(value='pyserini', lineno=292, col_offset=41, end_lineno=292, end_col_offset=51)], lineno=292, col_offset=17, end_lineno=292, end_col_offset=52), lineno=292, col_offset=8, end_lineno=292, end_col_offset=52)], handlers=[ExceptHandler(type=Name(id='ModuleNotFoundError', ctx=Load(), lineno=293, col_offset=11, end_lineno=293, end_col_offset=30), body=[Return(value=Constant(value='unknown', lineno=294, col_offset=15, end_lineno=294, end_col_offset=24), lineno=294, col_offset=8, end_lineno=294, end_col_offset=24)], lineno=293, col_offset=4, end_lineno=294, end_col_offset=24)], lineno=291, col_offset=4, end_lineno=294, end_col_offset=24), Assign(targets=[Name(id='version', ctx=Store(), lineno=295, col_offset=4, end_lineno=295, end_col_offset=11)], value=Call(func=Name(id='getattr', ctx=Load(), lineno=295, col_offset=14, end_lineno=295, end_col_offset=21), args=[Name(id='module', ctx=Load(), lineno=295, col_offset=22, end_lineno=295, end_col_offset=28), Constant(value='__version__', lineno=295, col_offset=30, end_lineno=295, end_col_offset=43), Constant(value=None, lineno=295, col_offset=45, end_lineno=295, end_col_offset=49)], lineno=295, col_offset=14, end_lineno=295, end_col_offset=50), lineno=295, col_offset=4, end_lineno=295, end_col_offset=50), Return(value=IfExp(test=Compare(left=Name(id='version', ctx=Load(), lineno=296, col_offset=27, end_lineno=296, end_col_offset=34), ops=[IsNot()], comparators=[Constant(value=None, lineno=296, col_offset=42, end_lineno=296, end_col_offset=46)], lineno=296, col_offset=27, end_lineno=296, end_col_offset=46), body=Call(func=Name(id='str', ctx=Load(), lineno=296, col_offset=11, end_lineno=296, end_col_offset=14), args=[Name(id='version', ctx=Load(), lineno=296, col_offset=15, end_lineno=296, end_col_offset=22)], lineno=296, col_offset=11, end_lineno=296, end_col_offset=23), orelse=Constant(value='unknown', lineno=296, col_offset=52, end_lineno=296, end_col_offset=61), lineno=296, col_offset=11, end_lineno=296, end_col_offset=61), lineno=296, col_offset=4, end_lineno=296, end_col_offset=61)], returns=Name(id='str', ctx=Load(), lineno=290, col_offset=34, end_lineno=290, end_col_offset=37), lineno=290, col_offset=0, end_lineno=296, end_col_offset=61), FunctionDef(name='_serialize_relative', args=arguments(args=[arg(arg='path', annotation=Name(id='Path', ctx=Load(), lineno=299, col_offset=30, end_lineno=299, end_col_offset=34), lineno=299, col_offset=24, end_lineno=299, end_col_offset=34), arg(arg='base', annotation=Name(id='Path', ctx=Load(), lineno=299, col_offset=42, end_lineno=299, end_col_offset=46), lineno=299, col_offset=36, end_lineno=299, end_col_offset=46)]), body=[Try(body=[Return(value=Call(func=Name(id='str', ctx=Load(), lineno=301, col_offset=15, end_lineno=301, end_col_offset=18), args=[Call(func=Attribute(value=Name(id='path', ctx=Load(), lineno=301, col_offset=19, end_lineno=301, end_col_offset=23), attr='relative_to', ctx=Load(), lineno=301, col_offset=19, end_lineno=301, end_col_offset=35), args=[Name(id='base', ctx=Load(), lineno=301, col_offset=36, end_lineno=301, end_col_offset=40)], lineno=301, col_offset=19, end_lineno=301, end_col_offset=41)], lineno=301, col_offset=15, end_lineno=301, end_col_offset=42), lineno=301, col_offset=8, end_lineno=301, end_col_offset=42)], handlers=[ExceptHandler(type=Name(id='ValueError', ctx=Load(), lineno=302, col_offset=11, end_lineno=302, end_col_offset=21), body=[Return(value=Call(func=Name(id='str', ctx=Load(), lineno=303, col_offset=15, end_lineno=303, end_col_offset=18), args=[Name(id='path', ctx=Load(), lineno=303, col_offset=19, end_lineno=303, end_col_offset=23)], lineno=303, col_offset=15, end_lineno=303, end_col_offset=24), lineno=303, col_offset=8, end_lineno=303, end_col_offset=24)], lineno=302, col_offset=4, end_lineno=303, end_col_offset=24)], lineno=300, col_offset=4, end_lineno=303, end_col_offset=24)], returns=Name(id='str', ctx=Load(), lineno=299, col_offset=51, end_lineno=299, end_col_offset=54), lineno=299, col_offset=0, end_lineno=303, end_col_offset=24), FunctionDef(name='_percentile_value', args=arguments(args=[arg(arg='sorted_values', annotation=Subscript(value=Name(id='Sequence', ctx=Load(), lineno=306, col_offset=37, end_lineno=306, end_col_offset=45), slice=Name(id='float', ctx=Load(), lineno=306, col_offset=46, end_lineno=306, end_col_offset=51), ctx=Load(), lineno=306, col_offset=37, end_lineno=306, end_col_offset=52), lineno=306, col_offset=22, end_lineno=306, end_col_offset=52), arg(arg='percentile', annotation=Name(id='float', ctx=Load(), lineno=306, col_offset=66, end_lineno=306, end_col_offset=71), lineno=306, col_offset=54, end_lineno=306, end_col_offset=71)]), body=[Expr(value=Constant(value='Return the percentile value using linear interpolation.\n\n    Parameters\n    ----------\n    sorted_values : Sequence[float]\n        Non-empty sorted sequence of latency values.\n    percentile : float\n        Desired percentile in the inclusive range [0, 100].\n\n    Returns\n    -------\n    float\n        Interpolated percentile value.\n\n    Raises\n    ------\n    ValueError\n        If :paramref:`sorted_values` is empty.\n    ', lineno=307, col_offset=4, end_lineno=325, end_col_offset=7), lineno=307, col_offset=4, end_lineno=325, end_col_offset=7), If(test=UnaryOp(op=Not(), operand=Name(id='sorted_values', ctx=Load(), lineno=326, col_offset=11, end_lineno=326, end_col_offset=24), lineno=326, col_offset=7, end_lineno=326, end_col_offset=24), body=[Assign(targets=[Name(id='message', ctx=Store(), lineno=327, col_offset=8, end_lineno=327, end_col_offset=15)], value=Constant(value='sorted_values cannot be empty.', lineno=327, col_offset=18, end_lineno=327, end_col_offset=50), lineno=327, col_offset=8, end_lineno=327, end_col_offset=50), Raise(exc=Call(func=Name(id='ValueError', ctx=Load(), lineno=328, col_offset=14, end_lineno=328, end_col_offset=24), args=[Name(id='message', ctx=Load(), lineno=328, col_offset=25, end_lineno=328, end_col_offset=32)], lineno=328, col_offset=14, end_lineno=328, end_col_offset=33), lineno=328, col_offset=8, end_lineno=328, end_col_offset=33)], lineno=326, col_offset=4, end_lineno=328, end_col_offset=33), If(test=Compare(left=Call(func=Name(id='len', ctx=Load(), lineno=329, col_offset=7, end_lineno=329, end_col_offset=10), args=[Name(id='sorted_values', ctx=Load(), lineno=329, col_offset=11, end_lineno=329, end_col_offset=24)], lineno=329, col_offset=7, end_lineno=329, end_col_offset=25), ops=[Eq()], comparators=[Constant(value=1, lineno=329, col_offset=29, end_lineno=329, end_col_offset=30)], lineno=329, col_offset=7, end_lineno=329, end_col_offset=30), body=[Return(value=Subscript(value=Name(id='sorted_values', ctx=Load(), lineno=330, col_offset=15, end_lineno=330, end_col_offset=28), slice=Constant(value=0, lineno=330, col_offset=29, end_lineno=330, end_col_offset=30), ctx=Load(), lineno=330, col_offset=15, end_lineno=330, end_col_offset=31), lineno=330, col_offset=8, end_lineno=330, end_col_offset=31)], lineno=329, col_offset=4, end_lineno=330, end_col_offset=31), If(test=Compare(left=Name(id='percentile', ctx=Load(), lineno=331, col_offset=7, end_lineno=331, end_col_offset=17), ops=[LtE()], comparators=[Name(id='_PERCENTILE_MIN', ctx=Load(), lineno=331, col_offset=21, end_lineno=331, end_col_offset=36)], lineno=331, col_offset=7, end_lineno=331, end_col_offset=36), body=[Return(value=Subscript(value=Name(id='sorted_values', ctx=Load(), lineno=332, col_offset=15, end_lineno=332, end_col_offset=28), slice=Constant(value=0, lineno=332, col_offset=29, end_lineno=332, end_col_offset=30), ctx=Load(), lineno=332, col_offset=15, end_lineno=332, end_col_offset=31), lineno=332, col_offset=8, end_lineno=332, end_col_offset=31)], lineno=331, col_offset=4, end_lineno=332, end_col_offset=31), If(test=Compare(left=Name(id='percentile', ctx=Load(), lineno=333, col_offset=7, end_lineno=333, end_col_offset=17), ops=[GtE()], comparators=[Name(id='_PERCENTILE_MAX', ctx=Load(), lineno=333, col_offset=21, end_lineno=333, end_col_offset=36)], lineno=333, col_offset=7, end_lineno=333, end_col_offset=36), body=[Return(value=Subscript(value=Name(id='sorted_values', ctx=Load(), lineno=334, col_offset=15, end_lineno=334, end_col_offset=28), slice=UnaryOp(op=USub(), operand=Constant(value=1, lineno=334, col_offset=30, end_lineno=334, end_col_offset=31), lineno=334, col_offset=29, end_lineno=334, end_col_offset=31), ctx=Load(), lineno=334, col_offset=15, end_lineno=334, end_col_offset=32), lineno=334, col_offset=8, end_lineno=334, end_col_offset=32)], lineno=333, col_offset=4, end_lineno=334, end_col_offset=32), Assign(targets=[Name(id='rank', ctx=Store(), lineno=336, col_offset=4, end_lineno=336, end_col_offset=8)], value=BinOp(left=BinOp(left=Name(id='percentile', ctx=Load(), lineno=336, col_offset=12, end_lineno=336, end_col_offset=22), op=Div(), right=Name(id='_PERCENTILE_MAX', ctx=Load(), lineno=336, col_offset=25, end_lineno=336, end_col_offset=40), lineno=336, col_offset=12, end_lineno=336, end_col_offset=40), op=Mult(), right=BinOp(left=Call(func=Name(id='len', ctx=Load(), lineno=336, col_offset=45, end_lineno=336, end_col_offset=48), args=[Name(id='sorted_values', ctx=Load(), lineno=336, col_offset=49, end_lineno=336, end_col_offset=62)], lineno=336, col_offset=45, end_lineno=336, end_col_offset=63), op=Sub(), right=Constant(value=1, lineno=336, col_offset=66, end_lineno=336, end_col_offset=67), lineno=336, col_offset=45, end_lineno=336, end_col_offset=67), lineno=336, col_offset=11, end_lineno=336, end_col_offset=68), lineno=336, col_offset=4, end_lineno=336, end_col_offset=68), Assign(targets=[Name(id='lower_index', ctx=Store(), lineno=337, col_offset=4, end_lineno=337, end_col_offset=15)], value=Call(func=Attribute(value=Name(id='math', ctx=Load(), lineno=337, col_offset=18, end_lineno=337, end_col_offset=22), attr='floor', ctx=Load(), lineno=337, col_offset=18, end_lineno=337, end_col_offset=28), args=[Name(id='rank', ctx=Load(), lineno=337, col_offset=29, end_lineno=337, end_col_offset=33)], lineno=337, col_offset=18, end_lineno=337, end_col_offset=34), lineno=337, col_offset=4, end_lineno=337, end_col_offset=34), Assign(targets=[Name(id='upper_index', ctx=Store(), lineno=338, col_offset=4, end_lineno=338, end_col_offset=15)], value=Call(func=Attribute(value=Name(id='math', ctx=Load(), lineno=338, col_offset=18, end_lineno=338, end_col_offset=22), attr='ceil', ctx=Load(), lineno=338, col_offset=18, end_lineno=338, end_col_offset=27), args=[Name(id='rank', ctx=Load(), lineno=338, col_offset=28, end_lineno=338, end_col_offset=32)], lineno=338, col_offset=18, end_lineno=338, end_col_offset=33), lineno=338, col_offset=4, end_lineno=338, end_col_offset=33), If(test=Compare(left=Name(id='lower_index', ctx=Load(), lineno=339, col_offset=7, end_lineno=339, end_col_offset=18), ops=[Eq()], comparators=[Name(id='upper_index', ctx=Load(), lineno=339, col_offset=22, end_lineno=339, end_col_offset=33)], lineno=339, col_offset=7, end_lineno=339, end_col_offset=33), body=[Return(value=Subscript(value=Name(id='sorted_values', ctx=Load(), lineno=340, col_offset=15, end_lineno=340, end_col_offset=28), slice=Name(id='lower_index', ctx=Load(), lineno=340, col_offset=29, end_lineno=340, end_col_offset=40), ctx=Load(), lineno=340, col_offset=15, end_lineno=340, end_col_offset=41), lineno=340, col_offset=8, end_lineno=340, end_col_offset=41)], lineno=339, col_offset=4, end_lineno=340, end_col_offset=41), Assign(targets=[Name(id='interpolation', ctx=Store(), lineno=341, col_offset=4, end_lineno=341, end_col_offset=17)], value=BinOp(left=Name(id='rank', ctx=Load(), lineno=341, col_offset=20, end_lineno=341, end_col_offset=24), op=Sub(), right=Name(id='lower_index', ctx=Load(), lineno=341, col_offset=27, end_lineno=341, end_col_offset=38), lineno=341, col_offset=20, end_lineno=341, end_col_offset=38), lineno=341, col_offset=4, end_lineno=341, end_col_offset=38), Assign(targets=[Name(id='lower_value', ctx=Store(), lineno=342, col_offset=4, end_lineno=342, end_col_offset=15)], value=Subscript(value=Name(id='sorted_values', ctx=Load(), lineno=342, col_offset=18, end_lineno=342, end_col_offset=31), slice=Name(id='lower_index', ctx=Load(), lineno=342, col_offset=32, end_lineno=342, end_col_offset=43), ctx=Load(), lineno=342, col_offset=18, end_lineno=342, end_col_offset=44), lineno=342, col_offset=4, end_lineno=342, end_col_offset=44), Assign(targets=[Name(id='upper_value', ctx=Store(), lineno=343, col_offset=4, end_lineno=343, end_col_offset=15)], value=Subscript(value=Name(id='sorted_values', ctx=Load(), lineno=343, col_offset=18, end_lineno=343, end_col_offset=31), slice=Name(id='upper_index', ctx=Load(), lineno=343, col_offset=32, end_lineno=343, end_col_offset=43), ctx=Load(), lineno=343, col_offset=18, end_lineno=343, end_col_offset=44), lineno=343, col_offset=4, end_lineno=343, end_col_offset=44), Return(value=BinOp(left=Name(id='lower_value', ctx=Load(), lineno=344, col_offset=11, end_lineno=344, end_col_offset=22), op=Add(), right=BinOp(left=BinOp(left=Name(id='upper_value', ctx=Load(), lineno=344, col_offset=26, end_lineno=344, end_col_offset=37), op=Sub(), right=Name(id='lower_value', ctx=Load(), lineno=344, col_offset=40, end_lineno=344, end_col_offset=51), lineno=344, col_offset=26, end_lineno=344, end_col_offset=51), op=Mult(), right=Name(id='interpolation', ctx=Load(), lineno=344, col_offset=55, end_lineno=344, end_col_offset=68), lineno=344, col_offset=25, end_lineno=344, end_col_offset=68), lineno=344, col_offset=11, end_lineno=344, end_col_offset=68), lineno=344, col_offset=4, end_lineno=344, end_col_offset=68)], returns=Name(id='float', ctx=Load(), lineno=306, col_offset=76, end_lineno=306, end_col_offset=81), lineno=306, col_offset=0, end_lineno=344, end_col_offset=68), FunctionDef(name='_quantize_tokens', args=arguments(args=[arg(arg='pairs', annotation=Subscript(value=Name(id='Sequence', ctx=Load(), lineno=347, col_offset=28, end_lineno=347, end_col_offset=36), slice=Subscript(value=Name(id='tuple', ctx=Load(), lineno=347, col_offset=37, end_lineno=347, end_col_offset=42), slice=Tuple(elts=[Name(id='str', ctx=Load(), lineno=347, col_offset=43, end_lineno=347, end_col_offset=46), Name(id='float', ctx=Load(), lineno=347, col_offset=48, end_lineno=347, end_col_offset=53)], ctx=Load(), lineno=347, col_offset=43, end_lineno=347, end_col_offset=53), ctx=Load(), lineno=347, col_offset=37, end_lineno=347, end_col_offset=54), ctx=Load(), lineno=347, col_offset=28, end_lineno=347, end_col_offset=55), lineno=347, col_offset=21, end_lineno=347, end_col_offset=55), arg(arg='quantization', annotation=Name(id='int', ctx=Load(), lineno=347, col_offset=71, end_lineno=347, end_col_offset=74), lineno=347, col_offset=57, end_lineno=347, end_col_offset=74)]), body=[AnnAssign(target=Name(id='vector', ctx=Store(), lineno=348, col_offset=4, end_lineno=348, end_col_offset=10), annotation=Subscript(value=Name(id='dict', ctx=Load(), lineno=348, col_offset=12, end_lineno=348, end_col_offset=16), slice=Tuple(elts=[Name(id='str', ctx=Load(), lineno=348, col_offset=17, end_lineno=348, end_col_offset=20), Name(id='int', ctx=Load(), lineno=348, col_offset=22, end_lineno=348, end_col_offset=25)], ctx=Load(), lineno=348, col_offset=17, end_lineno=348, end_col_offset=25), ctx=Load(), lineno=348, col_offset=12, end_lineno=348, end_col_offset=26), value=Dict(lineno=348, col_offset=29, end_lineno=348, end_col_offset=31), simple=1, lineno=348, col_offset=4, end_lineno=348, end_col_offset=31), For(target=Tuple(elts=[Name(id='token', ctx=Store(), lineno=349, col_offset=8, end_lineno=349, end_col_offset=13), Name(id='weight', ctx=Store(), lineno=349, col_offset=15, end_lineno=349, end_col_offset=21)], ctx=Store(), lineno=349, col_offset=8, end_lineno=349, end_col_offset=21), iter=Name(id='pairs', ctx=Load(), lineno=349, col_offset=25, end_lineno=349, end_col_offset=30), body=[If(test=Compare(left=Name(id='weight', ctx=Load(), lineno=350, col_offset=11, end_lineno=350, end_col_offset=17), ops=[LtE()], comparators=[Constant(value=0, lineno=350, col_offset=21, end_lineno=350, end_col_offset=22)], lineno=350, col_offset=11, end_lineno=350, end_col_offset=22), body=[Continue(lineno=351, col_offset=12, end_lineno=351, end_col_offset=20)], lineno=350, col_offset=8, end_lineno=351, end_col_offset=20), Assign(targets=[Name(id='quantized', ctx=Store(), lineno=352, col_offset=8, end_lineno=352, end_col_offset=17)], value=Call(func=Attribute(value=Name(id='math', ctx=Load(), lineno=352, col_offset=20, end_lineno=352, end_col_offset=24), attr='floor', ctx=Load(), lineno=352, col_offset=20, end_lineno=352, end_col_offset=30), args=[BinOp(left=BinOp(left=Name(id='weight', ctx=Load(), lineno=352, col_offset=31, end_lineno=352, end_col_offset=37), op=Mult(), right=Call(func=Name(id='float', ctx=Load(), lineno=352, col_offset=40, end_lineno=352, end_col_offset=45), args=[Name(id='quantization', ctx=Load(), lineno=352, col_offset=46, end_lineno=352, end_col_offset=58)], lineno=352, col_offset=40, end_lineno=352, end_col_offset=59), lineno=352, col_offset=31, end_lineno=352, end_col_offset=59), op=Add(), right=Constant(value=0.5, lineno=352, col_offset=62, end_lineno=352, end_col_offset=65), lineno=352, col_offset=31, end_lineno=352, end_col_offset=65)], lineno=352, col_offset=20, end_lineno=352, end_col_offset=66), lineno=352, col_offset=8, end_lineno=352, end_col_offset=66), If(test=Compare(left=Name(id='quantized', ctx=Load(), lineno=353, col_offset=11, end_lineno=353, end_col_offset=20), ops=[Gt()], comparators=[Constant(value=0, lineno=353, col_offset=23, end_lineno=353, end_col_offset=24)], lineno=353, col_offset=11, end_lineno=353, end_col_offset=24), body=[Assign(targets=[Subscript(value=Name(id='vector', ctx=Load(), lineno=354, col_offset=12, end_lineno=354, end_col_offset=18), slice=Name(id='token', ctx=Load(), lineno=354, col_offset=19, end_lineno=354, end_col_offset=24), ctx=Store(), lineno=354, col_offset=12, end_lineno=354, end_col_offset=25)], value=Name(id='quantized', ctx=Load(), lineno=354, col_offset=28, end_lineno=354, end_col_offset=37), lineno=354, col_offset=12, end_lineno=354, end_col_offset=37)], lineno=353, col_offset=8, end_lineno=354, end_col_offset=37)], lineno=349, col_offset=4, end_lineno=354, end_col_offset=37), Return(value=Name(id='vector', ctx=Load(), lineno=355, col_offset=11, end_lineno=355, end_col_offset=17), lineno=355, col_offset=4, end_lineno=355, end_col_offset=17)], returns=Subscript(value=Name(id='dict', ctx=Load(), lineno=347, col_offset=79, end_lineno=347, end_col_offset=83), slice=Tuple(elts=[Name(id='str', ctx=Load(), lineno=347, col_offset=84, end_lineno=347, end_col_offset=87), Name(id='int', ctx=Load(), lineno=347, col_offset=89, end_lineno=347, end_col_offset=92)], ctx=Load(), lineno=347, col_offset=84, end_lineno=347, end_col_offset=92), ctx=Load(), lineno=347, col_offset=79, end_lineno=347, end_col_offset=93), lineno=347, col_offset=0, end_lineno=355, end_col_offset=17), FunctionDef(name='_iter_corpus', args=arguments(args=[arg(arg='path', annotation=Name(id='Path', ctx=Load(), lineno=358, col_offset=23, end_lineno=358, end_col_offset=27), lineno=358, col_offset=17, end_lineno=358, end_col_offset=27)]), body=[With(items=[withitem(context_expr=Call(func=Attribute(value=Name(id='path', ctx=Load(), lineno=359, col_offset=9, end_lineno=359, end_col_offset=13), attr='open', ctx=Load(), lineno=359, col_offset=9, end_lineno=359, end_col_offset=18), args=[Constant(value='r', lineno=359, col_offset=19, end_lineno=359, end_col_offset=22)], keywords=[keyword(arg='encoding', value=Constant(value='utf-8', lineno=359, col_offset=33, end_lineno=359, end_col_offset=40), lineno=359, col_offset=24, end_lineno=359, end_col_offset=40)], lineno=359, col_offset=9, end_lineno=359, end_col_offset=41), optional_vars=Name(id='handle', ctx=Store(), lineno=359, col_offset=45, end_lineno=359, end_col_offset=51))], body=[For(target=Name(id='raw_line', ctx=Store(), lineno=360, col_offset=12, end_lineno=360, end_col_offset=20), iter=Name(id='handle', ctx=Load(), lineno=360, col_offset=24, end_lineno=360, end_col_offset=30), body=[Assign(targets=[Name(id='line', ctx=Store(), lineno=361, col_offset=12, end_lineno=361, end_col_offset=16)], value=Call(func=Attribute(value=Name(id='raw_line', ctx=Load(), lineno=361, col_offset=19, end_lineno=361, end_col_offset=27), attr='strip', ctx=Load(), lineno=361, col_offset=19, end_lineno=361, end_col_offset=33), lineno=361, col_offset=19, end_lineno=361, end_col_offset=35), lineno=361, col_offset=12, end_lineno=361, end_col_offset=35), If(test=UnaryOp(op=Not(), operand=Name(id='line', ctx=Load(), lineno=362, col_offset=19, end_lineno=362, end_col_offset=23), lineno=362, col_offset=15, end_lineno=362, end_col_offset=23), body=[Continue(lineno=363, col_offset=16, end_lineno=363, end_col_offset=24)], lineno=362, col_offset=12, end_lineno=363, end_col_offset=24), Expr(value=Yield(value=Call(func=Attribute(value=Name(id='json', ctx=Load(), lineno=364, col_offset=18, end_lineno=364, end_col_offset=22), attr='loads', ctx=Load(), lineno=364, col_offset=18, end_lineno=364, end_col_offset=28), args=[Name(id='line', ctx=Load(), lineno=364, col_offset=29, end_lineno=364, end_col_offset=33)], lineno=364, col_offset=18, end_lineno=364, end_col_offset=34), lineno=364, col_offset=12, end_lineno=364, end_col_offset=34), lineno=364, col_offset=12, end_lineno=364, end_col_offset=34)], lineno=360, col_offset=8, end_lineno=364, end_col_offset=34)], lineno=359, col_offset=4, end_lineno=364, end_col_offset=34)], returns=Subscript(value=Name(id='Iterable', ctx=Load(), lineno=358, col_offset=32, end_lineno=358, end_col_offset=40), slice=Subscript(value=Name(id='dict', ctx=Load(), lineno=358, col_offset=41, end_lineno=358, end_col_offset=45), slice=Tuple(elts=[Name(id='str', ctx=Load(), lineno=358, col_offset=46, end_lineno=358, end_col_offset=49), Name(id='object', ctx=Load(), lineno=358, col_offset=51, end_lineno=358, end_col_offset=57)], ctx=Load(), lineno=358, col_offset=46, end_lineno=358, end_col_offset=57), ctx=Load(), lineno=358, col_offset=41, end_lineno=358, end_col_offset=58), ctx=Load(), lineno=358, col_offset=32, end_lineno=358, end_col_offset=59), lineno=358, col_offset=0, end_lineno=364, end_col_offset=34), FunctionDef(name='_open_writer', args=arguments(args=[arg(arg='vectors_dir', annotation=Name(id='Path', ctx=Load(), lineno=367, col_offset=30, end_lineno=367, end_col_offset=34), lineno=367, col_offset=17, end_lineno=367, end_col_offset=34), arg(arg='index', annotation=Name(id='int', ctx=Load(), lineno=367, col_offset=43, end_lineno=367, end_col_offset=46), lineno=367, col_offset=36, end_lineno=367, end_col_offset=46)]), body=[Expr(value=Constant(value='Create a shard writer for the given shard index.\n\n    This helper function creates a new JSONL shard file for writing encoded\n    vectors. Shard files are named with zero-padded indices (e.g., part-00000.jsonl,\n    part-00001.jsonl) to ensure proper ordering and easy identification. The file\n    is opened in write mode with UTF-8 encoding.\n\n    Parameters\n    ----------\n    vectors_dir : Path\n        Directory where shard files are stored. The directory should already\n        exist (created by the caller). Shard files are written directly to this\n        directory.\n    index : int\n        Zero-based shard index. Used to generate the shard filename with zero\n        padding (5 digits). Must be non-negative.\n\n    Returns\n    -------\n    tuple[Path, TextIO]\n        Tuple containing:\n        - Path to the created shard file (e.g., vectors_dir/part-00000.jsonl)\n        - Open text file handle in write mode, UTF-8 encoded, ready for writing\n          JSONL records. The caller is responsible for closing the handle.\n    ', lineno=368, col_offset=4, end_lineno=392, end_col_offset=7), lineno=368, col_offset=4, end_lineno=392, end_col_offset=7), Assign(targets=[Name(id='shard_path', ctx=Store(), lineno=393, col_offset=4, end_lineno=393, end_col_offset=14)], value=BinOp(left=Name(id='vectors_dir', ctx=Load(), lineno=393, col_offset=17, end_lineno=393, end_col_offset=28), op=Div(), right=JoinedStr(values=[Constant(value='part-', lineno=393, col_offset=33, end_lineno=393, end_col_offset=38), FormattedValue(value=Name(id='index', ctx=Load(), lineno=393, col_offset=39, end_lineno=393, end_col_offset=44), conversion=-1, format_spec=JoinedStr(values=[Constant(value='05d', lineno=393, col_offset=45, end_lineno=393, end_col_offset=48)], lineno=393, col_offset=44, end_lineno=393, end_col_offset=48), lineno=393, col_offset=38, end_lineno=393, end_col_offset=49), Constant(value='.jsonl', lineno=393, col_offset=49, end_lineno=393, end_col_offset=55)], lineno=393, col_offset=31, end_lineno=393, end_col_offset=56), lineno=393, col_offset=17, end_lineno=393, end_col_offset=56), lineno=393, col_offset=4, end_lineno=393, end_col_offset=56), Return(value=Tuple(elts=[Name(id='shard_path', ctx=Load(), lineno=394, col_offset=11, end_lineno=394, end_col_offset=21), Call(func=Attribute(value=Name(id='shard_path', ctx=Load(), lineno=394, col_offset=23, end_lineno=394, end_col_offset=33), attr='open', ctx=Load(), lineno=394, col_offset=23, end_lineno=394, end_col_offset=38), args=[Constant(value='w', lineno=394, col_offset=39, end_lineno=394, end_col_offset=42)], keywords=[keyword(arg='encoding', value=Constant(value='utf-8', lineno=394, col_offset=53, end_lineno=394, end_col_offset=60), lineno=394, col_offset=44, end_lineno=394, end_col_offset=60)], lineno=394, col_offset=23, end_lineno=394, end_col_offset=61)], ctx=Load(), lineno=394, col_offset=11, end_lineno=394, end_col_offset=61), lineno=394, col_offset=4, end_lineno=394, end_col_offset=61)], returns=Subscript(value=Name(id='tuple', ctx=Load(), lineno=367, col_offset=51, end_lineno=367, end_col_offset=56), slice=Tuple(elts=[Name(id='Path', ctx=Load(), lineno=367, col_offset=57, end_lineno=367, end_col_offset=61), Name(id='TextIO', ctx=Load(), lineno=367, col_offset=63, end_lineno=367, end_col_offset=69)], ctx=Load(), lineno=367, col_offset=57, end_lineno=367, end_col_offset=69), ctx=Load(), lineno=367, col_offset=51, end_lineno=367, end_col_offset=70), lineno=367, col_offset=0, end_lineno=394, end_col_offset=61), FunctionDef(name='_flush_batch', args=arguments(args=[arg(arg='encoder', annotation=Name(id='_SparseEncoderProtocol', ctx=Load(), lineno=398, col_offset=13, end_lineno=398, end_col_offset=35), lineno=398, col_offset=4, end_lineno=398, end_col_offset=35), arg(arg='batch', annotation=Subscript(value=Name(id='list', ctx=Load(), lineno=399, col_offset=11, end_lineno=399, end_col_offset=15), slice=Subscript(value=Name(id='tuple', ctx=Load(), lineno=399, col_offset=16, end_lineno=399, end_col_offset=21), slice=Tuple(elts=[Name(id='str', ctx=Load(), lineno=399, col_offset=22, end_lineno=399, end_col_offset=25), Name(id='str', ctx=Load(), lineno=399, col_offset=27, end_lineno=399, end_col_offset=30)], ctx=Load(), lineno=399, col_offset=22, end_lineno=399, end_col_offset=30), ctx=Load(), lineno=399, col_offset=16, end_lineno=399, end_col_offset=31), ctx=Load(), lineno=399, col_offset=11, end_lineno=399, end_col_offset=32), lineno=399, col_offset=4, end_lineno=399, end_col_offset=32), arg(arg='state', annotation=Name(id='_ShardState', ctx=Load(), lineno=400, col_offset=11, end_lineno=400, end_col_offset=22), lineno=400, col_offset=4, end_lineno=400, end_col_offset=22)]), body=[Expr(value=Constant(value='Encode and persist the current batch of documents.\n\n    This function processes a batch of documents by encoding them using the\n    SPLADE encoder, decoding the sparse vectors into token-weight pairs, quantizing\n    the weights, and writing the results to JSONL shard files. The batch is\n    cleared after processing.\n\n    The function handles shard file management automatically, creating new shard\n    files when needed based on the configured shard size. Documents are written\n    in JSONL format with document ID, empty contents (for compatibility), and\n    the quantized sparse vector.\n\n    Parameters\n    ----------\n    encoder : _SparseEncoderProtocol\n        SPLADE encoder instance used to encode document texts into sparse vectors.\n        The encoder must support encode_document() and decode() methods.\n    batch : list[tuple[str, str]]\n        List of (document_id, text) tuples to encode. Each tuple represents one\n        document from the corpus. The batch is cleared after processing.\n    state : _ShardState\n        Mutable state object tracking shard file handles, document counts, shard\n        indices, and encoding parameters. The state is updated as documents are\n        written and shard files are rotated.\n\n    Raises\n    ------\n    RuntimeError\n        If a shard file handle unexpectedly becomes None during writing. This\n        should not occur in normal operation and indicates a programming error\n        or resource management issue.\n    ', lineno=402, col_offset=4, end_lineno=433, end_col_offset=7), lineno=402, col_offset=4, end_lineno=433, end_col_offset=7), If(test=UnaryOp(op=Not(), operand=Name(id='batch', ctx=Load(), lineno=434, col_offset=11, end_lineno=434, end_col_offset=16), lineno=434, col_offset=7, end_lineno=434, end_col_offset=16), body=[Return(lineno=435, col_offset=8, end_lineno=435, end_col_offset=14)], lineno=434, col_offset=4, end_lineno=435, end_col_offset=14), Assign(targets=[Name(id='texts', ctx=Store(), lineno=437, col_offset=4, end_lineno=437, end_col_offset=9)], value=ListComp(elt=Name(id='text', ctx=Load(), lineno=437, col_offset=13, end_lineno=437, end_col_offset=17), generators=[comprehension(target=Tuple(elts=[Name(id='_', ctx=Store(), lineno=437, col_offset=22, end_lineno=437, end_col_offset=23), Name(id='text', ctx=Store(), lineno=437, col_offset=25, end_lineno=437, end_col_offset=29)], ctx=Store(), lineno=437, col_offset=22, end_lineno=437, end_col_offset=29), iter=Name(id='batch', ctx=Load(), lineno=437, col_offset=33, end_lineno=437, end_col_offset=38), is_async=0)], lineno=437, col_offset=12, end_lineno=437, end_col_offset=39), lineno=437, col_offset=4, end_lineno=437, end_col_offset=39), Assign(targets=[Name(id='embeddings', ctx=Store(), lineno=438, col_offset=4, end_lineno=438, end_col_offset=14)], value=Call(func=Attribute(value=Name(id='encoder', ctx=Load(), lineno=438, col_offset=17, end_lineno=438, end_col_offset=24), attr='encode_document', ctx=Load(), lineno=438, col_offset=17, end_lineno=438, end_col_offset=40), args=[Name(id='texts', ctx=Load(), lineno=438, col_offset=41, end_lineno=438, end_col_offset=46)], lineno=438, col_offset=17, end_lineno=438, end_col_offset=47), lineno=438, col_offset=4, end_lineno=438, end_col_offset=47), Assign(targets=[Name(id='decoded', ctx=Store(), lineno=439, col_offset=4, end_lineno=439, end_col_offset=11)], value=Call(func=Attribute(value=Name(id='encoder', ctx=Load(), lineno=439, col_offset=14, end_lineno=439, end_col_offset=21), attr='decode', ctx=Load(), lineno=439, col_offset=14, end_lineno=439, end_col_offset=28), args=[Name(id='embeddings', ctx=Load(), lineno=439, col_offset=29, end_lineno=439, end_col_offset=39)], keywords=[keyword(arg='top_k', value=Constant(value=None, lineno=439, col_offset=47, end_lineno=439, end_col_offset=51), lineno=439, col_offset=41, end_lineno=439, end_col_offset=51)], lineno=439, col_offset=14, end_lineno=439, end_col_offset=52), lineno=439, col_offset=4, end_lineno=439, end_col_offset=52), For(target=Tuple(elts=[Tuple(elts=[Name(id='doc_id', ctx=Store(), lineno=441, col_offset=9, end_lineno=441, end_col_offset=15), Name(id='_', ctx=Store(), lineno=441, col_offset=17, end_lineno=441, end_col_offset=18)], ctx=Store(), lineno=441, col_offset=8, end_lineno=441, end_col_offset=19), Name(id='token_pairs', ctx=Store(), lineno=441, col_offset=21, end_lineno=441, end_col_offset=32)], ctx=Store(), lineno=441, col_offset=8, end_lineno=441, end_col_offset=32), iter=Call(func=Name(id='zip', ctx=Load(), lineno=441, col_offset=36, end_lineno=441, end_col_offset=39), args=[Name(id='batch', ctx=Load(), lineno=441, col_offset=40, end_lineno=441, end_col_offset=45), Name(id='decoded', ctx=Load(), lineno=441, col_offset=47, end_lineno=441, end_col_offset=54)], keywords=[keyword(arg='strict', value=Constant(value=True, lineno=441, col_offset=63, end_lineno=441, end_col_offset=67), lineno=441, col_offset=56, end_lineno=441, end_col_offset=67)], lineno=441, col_offset=36, end_lineno=441, end_col_offset=68), body=[Assign(targets=[Name(id='vector', ctx=Store(), lineno=442, col_offset=8, end_lineno=442, end_col_offset=14)], value=Call(func=Name(id='_quantize_tokens', ctx=Load(), lineno=442, col_offset=17, end_lineno=442, end_col_offset=33), args=[Name(id='token_pairs', ctx=Load(), lineno=442, col_offset=34, end_lineno=442, end_col_offset=45), Attribute(value=Name(id='state', ctx=Load(), lineno=442, col_offset=47, end_lineno=442, end_col_offset=52), attr='quantization', ctx=Load(), lineno=442, col_offset=47, end_lineno=442, end_col_offset=65)], lineno=442, col_offset=17, end_lineno=442, end_col_offset=66), lineno=442, col_offset=8, end_lineno=442, end_col_offset=66), If(test=Compare(left=Attribute(value=Name(id='state', ctx=Load(), lineno=443, col_offset=11, end_lineno=443, end_col_offset=16), attr='shard_handle', ctx=Load(), lineno=443, col_offset=11, end_lineno=443, end_col_offset=29), ops=[Is()], comparators=[Constant(value=None, lineno=443, col_offset=33, end_lineno=443, end_col_offset=37)], lineno=443, col_offset=11, end_lineno=443, end_col_offset=37), body=[Assign(targets=[Tuple(elts=[Name(id='_', ctx=Store(), lineno=444, col_offset=12, end_lineno=444, end_col_offset=13), Name(id='handle', ctx=Store(), lineno=444, col_offset=15, end_lineno=444, end_col_offset=21)], ctx=Store(), lineno=444, col_offset=12, end_lineno=444, end_col_offset=21)], value=Call(func=Name(id='_open_writer', ctx=Load(), lineno=444, col_offset=24, end_lineno=444, end_col_offset=36), args=[Attribute(value=Name(id='state', ctx=Load(), lineno=444, col_offset=37, end_lineno=444, end_col_offset=42), attr='vectors_dir', ctx=Load(), lineno=444, col_offset=37, end_lineno=444, end_col_offset=54), Attribute(value=Name(id='state', ctx=Load(), lineno=444, col_offset=56, end_lineno=444, end_col_offset=61), attr='shard_index', ctx=Load(), lineno=444, col_offset=56, end_lineno=444, end_col_offset=73)], lineno=444, col_offset=24, end_lineno=444, end_col_offset=74), lineno=444, col_offset=12, end_lineno=444, end_col_offset=74), Assign(targets=[Attribute(value=Name(id='state', ctx=Load(), lineno=445, col_offset=12, end_lineno=445, end_col_offset=17), attr='shard_handle', ctx=Store(), lineno=445, col_offset=12, end_lineno=445, end_col_offset=30)], value=Name(id='handle', ctx=Load(), lineno=445, col_offset=33, end_lineno=445, end_col_offset=39), lineno=445, col_offset=12, end_lineno=445, end_col_offset=39), AugAssign(target=Attribute(value=Name(id='state', ctx=Load(), lineno=446, col_offset=12, end_lineno=446, end_col_offset=17), attr='shard_count', ctx=Store(), lineno=446, col_offset=12, end_lineno=446, end_col_offset=29), op=Add(), value=Constant(value=1, lineno=446, col_offset=33, end_lineno=446, end_col_offset=34), lineno=446, col_offset=12, end_lineno=446, end_col_offset=34)], lineno=443, col_offset=8, end_lineno=446, end_col_offset=34), Assign(targets=[Name(id='handle', ctx=Store(), lineno=447, col_offset=8, end_lineno=447, end_col_offset=14)], value=Attribute(value=Name(id='state', ctx=Load(), lineno=447, col_offset=17, end_lineno=447, end_col_offset=22), attr='shard_handle', ctx=Load(), lineno=447, col_offset=17, end_lineno=447, end_col_offset=35), lineno=447, col_offset=8, end_lineno=447, end_col_offset=35), If(test=Compare(left=Name(id='handle', ctx=Load(), lineno=448, col_offset=11, end_lineno=448, end_col_offset=17), ops=[Is()], comparators=[Constant(value=None, lineno=448, col_offset=21, end_lineno=448, end_col_offset=25)], lineno=448, col_offset=11, end_lineno=448, end_col_offset=25), body=[Assign(targets=[Name(id='msg', ctx=Store(), lineno=449, col_offset=12, end_lineno=449, end_col_offset=15)], value=Constant(value='Shard handle unexpectedly missing during encoding.', lineno=449, col_offset=18, end_lineno=449, end_col_offset=70), lineno=449, col_offset=12, end_lineno=449, end_col_offset=70), Raise(exc=Call(func=Name(id='RuntimeError', ctx=Load(), lineno=450, col_offset=18, end_lineno=450, end_col_offset=30), args=[Name(id='msg', ctx=Load(), lineno=450, col_offset=31, end_lineno=450, end_col_offset=34)], lineno=450, col_offset=18, end_lineno=450, end_col_offset=35), lineno=450, col_offset=12, end_lineno=450, end_col_offset=35)], lineno=448, col_offset=8, end_lineno=450, end_col_offset=35), Expr(value=Call(func=Attribute(value=Name(id='handle', ctx=Load(), lineno=451, col_offset=8, end_lineno=451, end_col_offset=14), attr='write', ctx=Load(), lineno=451, col_offset=8, end_lineno=451, end_col_offset=20), args=[BinOp(left=Call(func=Attribute(value=Name(id='json', ctx=Load(), lineno=452, col_offset=12, end_lineno=452, end_col_offset=16), attr='dumps', ctx=Load(), lineno=452, col_offset=12, end_lineno=452, end_col_offset=22), args=[Dict(keys=[Constant(value='id', lineno=452, col_offset=24, end_lineno=452, end_col_offset=28), Constant(value='contents', lineno=452, col_offset=38, end_lineno=452, end_col_offset=48), Constant(value='vector', lineno=452, col_offset=54, end_lineno=452, end_col_offset=62)], values=[Name(id='doc_id', ctx=Load(), lineno=452, col_offset=30, end_lineno=452, end_col_offset=36), Constant(value='', lineno=452, col_offset=50, end_lineno=452, end_col_offset=52), Name(id='vector', ctx=Load(), lineno=452, col_offset=64, end_lineno=452, end_col_offset=70)], lineno=452, col_offset=23, end_lineno=452, end_col_offset=71)], keywords=[keyword(arg='ensure_ascii', value=Constant(value=False, lineno=452, col_offset=86, end_lineno=452, end_col_offset=91), lineno=452, col_offset=73, end_lineno=452, end_col_offset=91)], lineno=452, col_offset=12, end_lineno=452, end_col_offset=92), op=Add(), right=Constant(value='\n', lineno=452, col_offset=95, end_lineno=452, end_col_offset=99), lineno=452, col_offset=12, end_lineno=452, end_col_offset=99)], lineno=451, col_offset=8, end_lineno=453, end_col_offset=9), lineno=451, col_offset=8, end_lineno=453, end_col_offset=9), AugAssign(target=Attribute(value=Name(id='state', ctx=Load(), lineno=454, col_offset=8, end_lineno=454, end_col_offset=13), attr='doc_count', ctx=Store(), lineno=454, col_offset=8, end_lineno=454, end_col_offset=23), op=Add(), value=Constant(value=1, lineno=454, col_offset=27, end_lineno=454, end_col_offset=28), lineno=454, col_offset=8, end_lineno=454, end_col_offset=28), If(test=Compare(left=BinOp(left=Attribute(value=Name(id='state', ctx=Load(), lineno=455, col_offset=11, end_lineno=455, end_col_offset=16), attr='doc_count', ctx=Load(), lineno=455, col_offset=11, end_lineno=455, end_col_offset=26), op=Mod(), right=Attribute(value=Name(id='state', ctx=Load(), lineno=455, col_offset=29, end_lineno=455, end_col_offset=34), attr='shard_size', ctx=Load(), lineno=455, col_offset=29, end_lineno=455, end_col_offset=45), lineno=455, col_offset=11, end_lineno=455, end_col_offset=45), ops=[Eq()], comparators=[Constant(value=0, lineno=455, col_offset=49, end_lineno=455, end_col_offset=50)], lineno=455, col_offset=11, end_lineno=455, end_col_offset=50), body=[Expr(value=Call(func=Attribute(value=Name(id='handle', ctx=Load(), lineno=456, col_offset=12, end_lineno=456, end_col_offset=18), attr='close', ctx=Load(), lineno=456, col_offset=12, end_lineno=456, end_col_offset=24), lineno=456, col_offset=12, end_lineno=456, end_col_offset=26), lineno=456, col_offset=12, end_lineno=456, end_col_offset=26), Assign(targets=[Attribute(value=Name(id='state', ctx=Load(), lineno=457, col_offset=12, end_lineno=457, end_col_offset=17), attr='shard_handle', ctx=Store(), lineno=457, col_offset=12, end_lineno=457, end_col_offset=30)], value=Constant(value=None, lineno=457, col_offset=33, end_lineno=457, end_col_offset=37), lineno=457, col_offset=12, end_lineno=457, end_col_offset=37), AugAssign(target=Attribute(value=Name(id='state', ctx=Load(), lineno=458, col_offset=12, end_lineno=458, end_col_offset=17), attr='shard_index', ctx=Store(), lineno=458, col_offset=12, end_lineno=458, end_col_offset=29), op=Add(), value=Constant(value=1, lineno=458, col_offset=33, end_lineno=458, end_col_offset=34), lineno=458, col_offset=12, end_lineno=458, end_col_offset=34)], lineno=455, col_offset=8, end_lineno=458, end_col_offset=34)], lineno=441, col_offset=4, end_lineno=458, end_col_offset=34), Expr(value=Call(func=Attribute(value=Name(id='batch', ctx=Load(), lineno=460, col_offset=4, end_lineno=460, end_col_offset=9), attr='clear', ctx=Load(), lineno=460, col_offset=4, end_lineno=460, end_col_offset=15), lineno=460, col_offset=4, end_lineno=460, end_col_offset=17), lineno=460, col_offset=4, end_lineno=460, end_col_offset=17)], returns=Constant(value=None, lineno=401, col_offset=5, end_lineno=401, end_col_offset=9), lineno=397, col_offset=0, end_lineno=460, end_col_offset=17), FunctionDef(name='_persist_encoding_metadata', args=arguments(kwonlyargs=[arg(arg='state', annotation=Name(id='_ShardState', ctx=Load(), lineno=465, col_offset=11, end_lineno=465, end_col_offset=22), lineno=465, col_offset=4, end_lineno=465, end_col_offset=22), arg(arg='vectors_dir', annotation=Name(id='Path', ctx=Load(), lineno=466, col_offset=17, end_lineno=466, end_col_offset=21), lineno=466, col_offset=4, end_lineno=466, end_col_offset=21), arg(arg='source_path', annotation=Name(id='Path', ctx=Load(), lineno=467, col_offset=17, end_lineno=467, end_col_offset=21), lineno=467, col_offset=4, end_lineno=467, end_col_offset=21), arg(arg='batch_size', annotation=Name(id='int', ctx=Load(), lineno=468, col_offset=16, end_lineno=468, end_col_offset=19), lineno=468, col_offset=4, end_lineno=468, end_col_offset=19), arg(arg='provider', annotation=Name(id='str', ctx=Load(), lineno=469, col_offset=14, end_lineno=469, end_col_offset=17), lineno=469, col_offset=4, end_lineno=469, end_col_offset=17)], kw_defaults=[None, None, None, None, None]), body=[Expr(value=Constant(value='Write metadata for an encoding run and return the summary.\n\n    This function creates and persists metadata about a SPLADE encoding operation,\n    including document counts, shard information, encoding parameters, and\n    provenance data. The metadata is written as JSON to a standard location\n    within the vectors directory and can be used later to verify corpus integrity\n    and understand encoding configuration.\n\n    Parameters\n    ----------\n    state : _ShardState\n        Encoding state object containing accumulated statistics: document count,\n        shard count, quantization parameter, and other encoding metadata. The\n        state reflects the final state after all documents have been encoded.\n    vectors_dir : Path\n        Directory where encoded vector shards are stored. The metadata file will\n        be written to this directory with a standard filename.\n    source_path : Path\n        Path to the original JSONL corpus file that was encoded. Stored in\n        metadata for provenance tracking and corpus identification.\n    batch_size : int\n        Batch size used during encoding. This parameter affects encoding\n        throughput and memory usage. Stored in metadata for reproducibility.\n    provider : str\n        ONNX runtime provider used for encoding (e.g., "cpu", "cuda", "tensorrt").\n        Affects encoding performance and hardware requirements. Stored for\n        reproducibility and performance analysis.\n\n    Returns\n    -------\n    SpladeEncodingSummary\n        Summary object containing:\n        - doc_count: Total number of documents encoded\n        - vectors_dir: Directory path where shards are stored\n        - metadata_path: Path to the written metadata JSON file\n        - shard_count: Number of shard files created\n    ', lineno=471, col_offset=4, end_lineno=507, end_col_offset=7), lineno=471, col_offset=4, end_lineno=507, end_col_offset=7), Assign(targets=[Name(id='metadata', ctx=Store(), lineno=508, col_offset=4, end_lineno=508, end_col_offset=12)], value=Call(func=Name(id='SpladeEncodingMetadata', ctx=Load(), lineno=508, col_offset=15, end_lineno=508, end_col_offset=37), keywords=[keyword(arg='doc_count', value=Attribute(value=Name(id='state', ctx=Load(), lineno=509, col_offset=18, end_lineno=509, end_col_offset=23), attr='doc_count', ctx=Load(), lineno=509, col_offset=18, end_lineno=509, end_col_offset=33), lineno=509, col_offset=8, end_lineno=509, end_col_offset=33), keyword(arg='shard_count', value=Attribute(value=Name(id='state', ctx=Load(), lineno=510, col_offset=20, end_lineno=510, end_col_offset=25), attr='shard_count', ctx=Load(), lineno=510, col_offset=20, end_lineno=510, end_col_offset=37), lineno=510, col_offset=8, end_lineno=510, end_col_offset=37), keyword(arg='quantization', value=Attribute(value=Name(id='state', ctx=Load(), lineno=511, col_offset=21, end_lineno=511, end_col_offset=26), attr='quantization', ctx=Load(), lineno=511, col_offset=21, end_lineno=511, end_col_offset=39), lineno=511, col_offset=8, end_lineno=511, end_col_offset=39), keyword(arg='batch_size', value=Name(id='batch_size', ctx=Load(), lineno=512, col_offset=19, end_lineno=512, end_col_offset=29), lineno=512, col_offset=8, end_lineno=512, end_col_offset=29), keyword(arg='provider', value=Name(id='provider', ctx=Load(), lineno=513, col_offset=17, end_lineno=513, end_col_offset=25), lineno=513, col_offset=8, end_lineno=513, end_col_offset=25), keyword(arg='vectors_dir', value=Call(func=Name(id='str', ctx=Load(), lineno=514, col_offset=20, end_lineno=514, end_col_offset=23), args=[Name(id='vectors_dir', ctx=Load(), lineno=514, col_offset=24, end_lineno=514, end_col_offset=35)], lineno=514, col_offset=20, end_lineno=514, end_col_offset=36), lineno=514, col_offset=8, end_lineno=514, end_col_offset=36), keyword(arg='source_path', value=Call(func=Name(id='str', ctx=Load(), lineno=515, col_offset=20, end_lineno=515, end_col_offset=23), args=[Name(id='source_path', ctx=Load(), lineno=515, col_offset=24, end_lineno=515, end_col_offset=35)], lineno=515, col_offset=20, end_lineno=515, end_col_offset=36), lineno=515, col_offset=8, end_lineno=515, end_col_offset=36), keyword(arg='prepared_at', value=Call(func=Attribute(value=Call(func=Attribute(value=Name(id='datetime', ctx=Load(), lineno=516, col_offset=20, end_lineno=516, end_col_offset=28), attr='now', ctx=Load(), lineno=516, col_offset=20, end_lineno=516, end_col_offset=32), args=[Name(id='UTC', ctx=Load(), lineno=516, col_offset=33, end_lineno=516, end_col_offset=36)], lineno=516, col_offset=20, end_lineno=516, end_col_offset=37), attr='isoformat', ctx=Load(), lineno=516, col_offset=20, end_lineno=516, end_col_offset=47), lineno=516, col_offset=20, end_lineno=516, end_col_offset=49), lineno=516, col_offset=8, end_lineno=516, end_col_offset=49), keyword(arg='generator', value=Name(id='GENERATOR_NAME', ctx=Load(), lineno=517, col_offset=18, end_lineno=517, end_col_offset=32), lineno=517, col_offset=8, end_lineno=517, end_col_offset=32)], lineno=508, col_offset=15, end_lineno=518, end_col_offset=5), lineno=508, col_offset=4, end_lineno=518, end_col_offset=5), Assign(targets=[Name(id='metadata_path', ctx=Store(), lineno=519, col_offset=4, end_lineno=519, end_col_offset=17)], value=BinOp(left=Name(id='vectors_dir', ctx=Load(), lineno=519, col_offset=20, end_lineno=519, end_col_offset=31), op=Div(), right=Name(id='ENCODING_METADATA_FILENAME', ctx=Load(), lineno=519, col_offset=34, end_lineno=519, end_col_offset=60), lineno=519, col_offset=20, end_lineno=519, end_col_offset=60), lineno=519, col_offset=4, end_lineno=519, end_col_offset=60), Expr(value=Call(func=Name(id='_write_struct', ctx=Load(), lineno=520, col_offset=4, end_lineno=520, end_col_offset=17), args=[Name(id='metadata_path', ctx=Load(), lineno=520, col_offset=18, end_lineno=520, end_col_offset=31), Name(id='metadata', ctx=Load(), lineno=520, col_offset=33, end_lineno=520, end_col_offset=41)], lineno=520, col_offset=4, end_lineno=520, end_col_offset=42), lineno=520, col_offset=4, end_lineno=520, end_col_offset=42), Return(value=Call(func=Name(id='SpladeEncodingSummary', ctx=Load(), lineno=521, col_offset=11, end_lineno=521, end_col_offset=32), keywords=[keyword(arg='doc_count', value=Attribute(value=Name(id='state', ctx=Load(), lineno=522, col_offset=18, end_lineno=522, end_col_offset=23), attr='doc_count', ctx=Load(), lineno=522, col_offset=18, end_lineno=522, end_col_offset=33), lineno=522, col_offset=8, end_lineno=522, end_col_offset=33), keyword(arg='vectors_dir', value=Call(func=Name(id='str', ctx=Load(), lineno=523, col_offset=20, end_lineno=523, end_col_offset=23), args=[Name(id='vectors_dir', ctx=Load(), lineno=523, col_offset=24, end_lineno=523, end_col_offset=35)], lineno=523, col_offset=20, end_lineno=523, end_col_offset=36), lineno=523, col_offset=8, end_lineno=523, end_col_offset=36), keyword(arg='metadata_path', value=Call(func=Name(id='str', ctx=Load(), lineno=524, col_offset=22, end_lineno=524, end_col_offset=25), args=[Name(id='metadata_path', ctx=Load(), lineno=524, col_offset=26, end_lineno=524, end_col_offset=39)], lineno=524, col_offset=22, end_lineno=524, end_col_offset=40), lineno=524, col_offset=8, end_lineno=524, end_col_offset=40), keyword(arg='shard_count', value=Attribute(value=Name(id='state', ctx=Load(), lineno=525, col_offset=20, end_lineno=525, end_col_offset=25), attr='shard_count', ctx=Load(), lineno=525, col_offset=20, end_lineno=525, end_col_offset=37), lineno=525, col_offset=8, end_lineno=525, end_col_offset=37)], lineno=521, col_offset=11, end_lineno=526, end_col_offset=5), lineno=521, col_offset=4, end_lineno=526, end_col_offset=5)], returns=Name(id='SpladeEncodingSummary', ctx=Load(), lineno=470, col_offset=5, end_lineno=470, end_col_offset=26), lineno=463, col_offset=0, end_lineno=526, end_col_offset=5), FunctionDef(name='_encode_records', args=arguments(kwonlyargs=[arg(arg='encoder', annotation=Name(id='_SparseEncoderProtocol', ctx=Load(), lineno=531, col_offset=13, end_lineno=531, end_col_offset=35), lineno=531, col_offset=4, end_lineno=531, end_col_offset=35), arg(arg='state', annotation=Name(id='_ShardState', ctx=Load(), lineno=532, col_offset=11, end_lineno=532, end_col_offset=22), lineno=532, col_offset=4, end_lineno=532, end_col_offset=22), arg(arg='batch', annotation=Subscript(value=Name(id='list', ctx=Load(), lineno=533, col_offset=11, end_lineno=533, end_col_offset=15), slice=Subscript(value=Name(id='tuple', ctx=Load(), lineno=533, col_offset=16, end_lineno=533, end_col_offset=21), slice=Tuple(elts=[Name(id='str', ctx=Load(), lineno=533, col_offset=22, end_lineno=533, end_col_offset=25), Name(id='str', ctx=Load(), lineno=533, col_offset=27, end_lineno=533, end_col_offset=30)], ctx=Load(), lineno=533, col_offset=22, end_lineno=533, end_col_offset=30), ctx=Load(), lineno=533, col_offset=16, end_lineno=533, end_col_offset=31), ctx=Load(), lineno=533, col_offset=11, end_lineno=533, end_col_offset=32), lineno=533, col_offset=4, end_lineno=533, end_col_offset=32), arg(arg='batch_size', annotation=Name(id='int', ctx=Load(), lineno=534, col_offset=16, end_lineno=534, end_col_offset=19), lineno=534, col_offset=4, end_lineno=534, end_col_offset=19), arg(arg='source_path', annotation=Name(id='Path', ctx=Load(), lineno=535, col_offset=17, end_lineno=535, end_col_offset=21), lineno=535, col_offset=4, end_lineno=535, end_col_offset=21)], kw_defaults=[None, None, None, None, None]), body=[Expr(value=Constant(value="Stream records from disk, validate them, and flush in batches.\n\n    This function orchestrates the encoding process by reading JSONL records from\n    a corpus file, validating that each record has required fields (id and\n    contents/text), accumulating records into batches, and flushing batches when\n    they reach the configured size. The final batch is flushed even if it's\n    smaller than the batch size.\n\n    The function handles streaming large corpora efficiently by processing records\n    one at a time and batching encoding operations. This minimizes memory usage\n    while maintaining good throughput through batch encoding.\n\n    Parameters\n    ----------\n    encoder : _SparseEncoderProtocol\n        SPLADE encoder instance used to encode document texts. The encoder\n        processes batches of texts and returns sparse vector representations.\n    state : _ShardState\n        Mutable encoding state tracking shard files, document counts, and encoding\n        parameters. Updated as batches are flushed and documents are written.\n    batch : list[tuple[str, str]]\n        Accumulator list for batching documents. Documents are added to this list\n        until it reaches batch_size, then the batch is flushed. The list is\n        cleared after each flush. Must be empty initially.\n    batch_size : int\n        Maximum number of documents to accumulate before flushing. Larger batches\n        improve encoding throughput but increase memory usage. Must be positive.\n    source_path : Path\n        Path to the JSONL corpus file to encode. The file is read line-by-line\n        and each line is parsed as JSON. The file must exist and be readable.\n\n    Raises\n    ------\n    TypeError\n        Raised when corpus entries violate type requirements:\n        - Document 'id' field is missing or not a string\n        - Document is missing both 'contents' and 'text' fields, or the content\n          field is not a string\n\n    Notes\n    -----\n    Exception Propagation:\n        This function may propagate exceptions from underlying operations:\n        - FileNotFoundError: If the source_path does not exist (from file operations\n          in _iter_corpus)\n        - json.JSONDecodeError: If a line in the corpus file contains invalid JSON\n          (from json.loads() in _iter_corpus)\n    ", lineno=537, col_offset=4, end_lineno=584, end_col_offset=7), lineno=537, col_offset=4, end_lineno=584, end_col_offset=7), For(target=Name(id='record', ctx=Store(), lineno=585, col_offset=8, end_lineno=585, end_col_offset=14), iter=Call(func=Name(id='_iter_corpus', ctx=Load(), lineno=585, col_offset=18, end_lineno=585, end_col_offset=30), args=[Name(id='source_path', ctx=Load(), lineno=585, col_offset=31, end_lineno=585, end_col_offset=42)], lineno=585, col_offset=18, end_lineno=585, end_col_offset=43), body=[Assign(targets=[Name(id='doc_id', ctx=Store(), lineno=586, col_offset=8, end_lineno=586, end_col_offset=14)], value=Call(func=Attribute(value=Name(id='record', ctx=Load(), lineno=586, col_offset=17, end_lineno=586, end_col_offset=23), attr='get', ctx=Load(), lineno=586, col_offset=17, end_lineno=586, end_col_offset=27), args=[Constant(value='id', lineno=586, col_offset=28, end_lineno=586, end_col_offset=32)], lineno=586, col_offset=17, end_lineno=586, end_col_offset=33), lineno=586, col_offset=8, end_lineno=586, end_col_offset=33), Assign(targets=[Name(id='contents', ctx=Store(), lineno=587, col_offset=8, end_lineno=587, end_col_offset=16)], value=BoolOp(op=Or(), values=[Call(func=Attribute(value=Name(id='record', ctx=Load(), lineno=587, col_offset=19, end_lineno=587, end_col_offset=25), attr='get', ctx=Load(), lineno=587, col_offset=19, end_lineno=587, end_col_offset=29), args=[Constant(value='contents', lineno=587, col_offset=30, end_lineno=587, end_col_offset=40)], lineno=587, col_offset=19, end_lineno=587, end_col_offset=41), Call(func=Attribute(value=Name(id='record', ctx=Load(), lineno=587, col_offset=45, end_lineno=587, end_col_offset=51), attr='get', ctx=Load(), lineno=587, col_offset=45, end_lineno=587, end_col_offset=55), args=[Constant(value='text', lineno=587, col_offset=56, end_lineno=587, end_col_offset=62)], lineno=587, col_offset=45, end_lineno=587, end_col_offset=63)], lineno=587, col_offset=19, end_lineno=587, end_col_offset=63), lineno=587, col_offset=8, end_lineno=587, end_col_offset=63), If(test=UnaryOp(op=Not(), operand=Call(func=Name(id='isinstance', ctx=Load(), lineno=588, col_offset=15, end_lineno=588, end_col_offset=25), args=[Name(id='doc_id', ctx=Load(), lineno=588, col_offset=26, end_lineno=588, end_col_offset=32), Name(id='str', ctx=Load(), lineno=588, col_offset=34, end_lineno=588, end_col_offset=37)], lineno=588, col_offset=15, end_lineno=588, end_col_offset=38), lineno=588, col_offset=11, end_lineno=588, end_col_offset=38), body=[Assign(targets=[Name(id='msg', ctx=Store(), lineno=589, col_offset=12, end_lineno=589, end_col_offset=15)], value=Constant(value="SPLADE corpus entries must include string 'id' fields", lineno=589, col_offset=18, end_lineno=589, end_col_offset=73), lineno=589, col_offset=12, end_lineno=589, end_col_offset=73), Raise(exc=Call(func=Name(id='TypeError', ctx=Load(), lineno=590, col_offset=18, end_lineno=590, end_col_offset=27), args=[Name(id='msg', ctx=Load(), lineno=590, col_offset=28, end_lineno=590, end_col_offset=31)], lineno=590, col_offset=18, end_lineno=590, end_col_offset=32), lineno=590, col_offset=12, end_lineno=590, end_col_offset=32)], lineno=588, col_offset=8, end_lineno=590, end_col_offset=32), If(test=UnaryOp(op=Not(), operand=Call(func=Name(id='isinstance', ctx=Load(), lineno=591, col_offset=15, end_lineno=591, end_col_offset=25), args=[Name(id='contents', ctx=Load(), lineno=591, col_offset=26, end_lineno=591, end_col_offset=34), Name(id='str', ctx=Load(), lineno=591, col_offset=36, end_lineno=591, end_col_offset=39)], lineno=591, col_offset=15, end_lineno=591, end_col_offset=40), lineno=591, col_offset=11, end_lineno=591, end_col_offset=40), body=[Assign(targets=[Name(id='msg', ctx=Store(), lineno=592, col_offset=12, end_lineno=592, end_col_offset=15)], value=JoinedStr(values=[Constant(value="Document '", lineno=592, col_offset=20, end_lineno=592, end_col_offset=30), FormattedValue(value=Name(id='doc_id', ctx=Load(), lineno=592, col_offset=31, end_lineno=592, end_col_offset=37), conversion=-1, lineno=592, col_offset=30, end_lineno=592, end_col_offset=38), Constant(value="' is missing textual contents", lineno=592, col_offset=38, end_lineno=592, end_col_offset=67)], lineno=592, col_offset=18, end_lineno=592, end_col_offset=68), lineno=592, col_offset=12, end_lineno=592, end_col_offset=68), Raise(exc=Call(func=Name(id='TypeError', ctx=Load(), lineno=593, col_offset=18, end_lineno=593, end_col_offset=27), args=[Name(id='msg', ctx=Load(), lineno=593, col_offset=28, end_lineno=593, end_col_offset=31)], lineno=593, col_offset=18, end_lineno=593, end_col_offset=32), lineno=593, col_offset=12, end_lineno=593, end_col_offset=32)], lineno=591, col_offset=8, end_lineno=593, end_col_offset=32), Expr(value=Call(func=Attribute(value=Name(id='batch', ctx=Load(), lineno=594, col_offset=8, end_lineno=594, end_col_offset=13), attr='append', ctx=Load(), lineno=594, col_offset=8, end_lineno=594, end_col_offset=20), args=[Tuple(elts=[Name(id='doc_id', ctx=Load(), lineno=594, col_offset=22, end_lineno=594, end_col_offset=28), Name(id='contents', ctx=Load(), lineno=594, col_offset=30, end_lineno=594, end_col_offset=38)], ctx=Load(), lineno=594, col_offset=21, end_lineno=594, end_col_offset=39)], lineno=594, col_offset=8, end_lineno=594, end_col_offset=40), lineno=594, col_offset=8, end_lineno=594, end_col_offset=40), If(test=Compare(left=Call(func=Name(id='len', ctx=Load(), lineno=595, col_offset=11, end_lineno=595, end_col_offset=14), args=[Name(id='batch', ctx=Load(), lineno=595, col_offset=15, end_lineno=595, end_col_offset=20)], lineno=595, col_offset=11, end_lineno=595, end_col_offset=21), ops=[GtE()], comparators=[Name(id='batch_size', ctx=Load(), lineno=595, col_offset=25, end_lineno=595, end_col_offset=35)], lineno=595, col_offset=11, end_lineno=595, end_col_offset=35), body=[Expr(value=Call(func=Name(id='_flush_batch', ctx=Load(), lineno=596, col_offset=12, end_lineno=596, end_col_offset=24), args=[Name(id='encoder', ctx=Load(), lineno=596, col_offset=25, end_lineno=596, end_col_offset=32), Name(id='batch', ctx=Load(), lineno=596, col_offset=34, end_lineno=596, end_col_offset=39), Name(id='state', ctx=Load(), lineno=596, col_offset=41, end_lineno=596, end_col_offset=46)], lineno=596, col_offset=12, end_lineno=596, end_col_offset=47), lineno=596, col_offset=12, end_lineno=596, end_col_offset=47)], lineno=595, col_offset=8, end_lineno=596, end_col_offset=47)], lineno=585, col_offset=4, end_lineno=596, end_col_offset=47), Expr(value=Call(func=Name(id='_flush_batch', ctx=Load(), lineno=598, col_offset=4, end_lineno=598, end_col_offset=16), args=[Name(id='encoder', ctx=Load(), lineno=598, col_offset=17, end_lineno=598, end_col_offset=24), Name(id='batch', ctx=Load(), lineno=598, col_offset=26, end_lineno=598, end_col_offset=31), Name(id='state', ctx=Load(), lineno=598, col_offset=33, end_lineno=598, end_col_offset=38)], lineno=598, col_offset=4, end_lineno=598, end_col_offset=39), lineno=598, col_offset=4, end_lineno=598, end_col_offset=39)], returns=Constant(value=None, lineno=536, col_offset=5, end_lineno=536, end_col_offset=9), lineno=529, col_offset=0, end_lineno=598, end_col_offset=39), FunctionDef(name='_optimize_export', args=arguments(args=[arg(arg='encoder', annotation=Name(id='_SparseEncoderProtocol', ctx=Load(), lineno=602, col_offset=13, end_lineno=602, end_col_offset=35), lineno=602, col_offset=4, end_lineno=602, end_col_offset=35), arg(arg='ctx', annotation=Name(id='_ExportContext', ctx=Load(), lineno=603, col_offset=9, end_lineno=603, end_col_offset=23), lineno=603, col_offset=4, end_lineno=603, end_col_offset=23)]), body=[Expr(value=Constant(value='Run graph optimization if requested and return the base ONNX path.\n\n    This function conditionally applies ONNX graph optimizations to improve\n    inference performance. If optimization is enabled in the export context,\n    it runs the optimizer with O3 optimization level (aggressive optimizations)\n    and returns the path to the optimized model. Otherwise, returns the path\n    to the original unoptimized model.\n\n    Graph optimization can significantly improve inference latency and reduce\n    model size by applying transformations like constant folding, operator fusion,\n    and dead code elimination. However, optimization may increase export time.\n\n    Parameters\n    ----------\n    encoder : _SparseEncoderProtocol\n        SPLADE encoder model to optimize. The encoder must support the optimization\n        interface provided by sentence-transformers export helpers.\n    ctx : _ExportContext\n        Export context containing export options, directory paths, model\n        identifier, and provider information. The ctx.options.optimize flag\n        determines whether optimization is performed.\n\n    Returns\n    -------\n    Path\n        Path to the ONNX model file to use as the base for further processing\n        (quantization, etc.). If optimization was performed and successful,\n        returns the optimized model path (model_O3.onnx). Otherwise, returns\n        the original model path (model.onnx).\n    ', lineno=605, col_offset=4, end_lineno=634, end_col_offset=7), lineno=605, col_offset=4, end_lineno=634, end_col_offset=7), Assign(targets=[Name(id='base_onnx', ctx=Store(), lineno=635, col_offset=4, end_lineno=635, end_col_offset=13)], value=BinOp(left=Attribute(value=Name(id='ctx', ctx=Load(), lineno=635, col_offset=16, end_lineno=635, end_col_offset=19), attr='onnx_dir', ctx=Load(), lineno=635, col_offset=16, end_lineno=635, end_col_offset=28), op=Div(), right=Constant(value='model.onnx', lineno=635, col_offset=31, end_lineno=635, end_col_offset=43), lineno=635, col_offset=16, end_lineno=635, end_col_offset=43), lineno=635, col_offset=4, end_lineno=635, end_col_offset=43), If(test=UnaryOp(op=Not(), operand=Attribute(value=Attribute(value=Name(id='ctx', ctx=Load(), lineno=636, col_offset=11, end_lineno=636, end_col_offset=14), attr='options', ctx=Load(), lineno=636, col_offset=11, end_lineno=636, end_col_offset=22), attr='optimize', ctx=Load(), lineno=636, col_offset=11, end_lineno=636, end_col_offset=31), lineno=636, col_offset=7, end_lineno=636, end_col_offset=31), body=[Return(value=Name(id='base_onnx', ctx=Load(), lineno=637, col_offset=15, end_lineno=637, end_col_offset=24), lineno=637, col_offset=8, end_lineno=637, end_col_offset=24)], lineno=636, col_offset=4, end_lineno=637, end_col_offset=24), Assign(targets=[Tuple(elts=[Name(id='optimizer', ctx=Store(), lineno=639, col_offset=4, end_lineno=639, end_col_offset=13), Name(id='_quantizer', ctx=Store(), lineno=639, col_offset=15, end_lineno=639, end_col_offset=25)], ctx=Store(), lineno=639, col_offset=4, end_lineno=639, end_col_offset=25)], value=Call(func=Name(id='_require_export_helpers', ctx=Load(), lineno=639, col_offset=28, end_lineno=639, end_col_offset=51), lineno=639, col_offset=28, end_lineno=639, end_col_offset=53), lineno=639, col_offset=4, end_lineno=639, end_col_offset=53), Assign(targets=[Name(id='optimized_path', ctx=Store(), lineno=640, col_offset=4, end_lineno=640, end_col_offset=18)], value=BinOp(left=Attribute(value=Name(id='ctx', ctx=Load(), lineno=640, col_offset=21, end_lineno=640, end_col_offset=24), attr='onnx_dir', ctx=Load(), lineno=640, col_offset=21, end_lineno=640, end_col_offset=33), op=Div(), right=Constant(value='model_O3.onnx', lineno=640, col_offset=36, end_lineno=640, end_col_offset=51), lineno=640, col_offset=21, end_lineno=640, end_col_offset=51), lineno=640, col_offset=4, end_lineno=640, end_col_offset=51), Expr(value=Call(func=Name(id='optimizer', ctx=Load(), lineno=641, col_offset=4, end_lineno=641, end_col_offset=13), keywords=[keyword(arg='model', value=Name(id='encoder', ctx=Load(), lineno=642, col_offset=14, end_lineno=642, end_col_offset=21), lineno=642, col_offset=8, end_lineno=642, end_col_offset=21), keyword(arg='optimization_config', value=Constant(value='O3', lineno=643, col_offset=28, end_lineno=643, end_col_offset=32), lineno=643, col_offset=8, end_lineno=643, end_col_offset=32), keyword(arg='model_name_or_path', value=Call(func=Name(id='str', ctx=Load(), lineno=644, col_offset=27, end_lineno=644, end_col_offset=30), args=[Attribute(value=Name(id='ctx', ctx=Load(), lineno=644, col_offset=31, end_lineno=644, end_col_offset=34), attr='model_dir', ctx=Load(), lineno=644, col_offset=31, end_lineno=644, end_col_offset=44)], lineno=644, col_offset=27, end_lineno=644, end_col_offset=45), lineno=644, col_offset=8, end_lineno=644, end_col_offset=45), keyword(arg='push_to_hub', value=Constant(value=False, lineno=645, col_offset=20, end_lineno=645, end_col_offset=25), lineno=645, col_offset=8, end_lineno=645, end_col_offset=25), keyword(arg='create_pr', value=Constant(value=False, lineno=646, col_offset=18, end_lineno=646, end_col_offset=23), lineno=646, col_offset=8, end_lineno=646, end_col_offset=23)], lineno=641, col_offset=4, end_lineno=647, end_col_offset=5), lineno=641, col_offset=4, end_lineno=647, end_col_offset=5), Return(value=IfExp(test=Call(func=Attribute(value=Name(id='optimized_path', ctx=Load(), lineno=648, col_offset=29, end_lineno=648, end_col_offset=43), attr='exists', ctx=Load(), lineno=648, col_offset=29, end_lineno=648, end_col_offset=50), lineno=648, col_offset=29, end_lineno=648, end_col_offset=52), body=Name(id='optimized_path', ctx=Load(), lineno=648, col_offset=11, end_lineno=648, end_col_offset=25), orelse=Name(id='base_onnx', ctx=Load(), lineno=648, col_offset=58, end_lineno=648, end_col_offset=67), lineno=648, col_offset=11, end_lineno=648, end_col_offset=67), lineno=648, col_offset=4, end_lineno=648, end_col_offset=67)], returns=Name(id='Path', ctx=Load(), lineno=604, col_offset=5, end_lineno=604, end_col_offset=9), lineno=601, col_offset=0, end_lineno=648, end_col_offset=67), FunctionDef(name='_quantize_export', args=arguments(kwonlyargs=[arg(arg='encoder', annotation=Name(id='_SparseEncoderProtocol', ctx=Load(), lineno=653, col_offset=13, end_lineno=653, end_col_offset=35), lineno=653, col_offset=4, end_lineno=653, end_col_offset=35), arg(arg='ctx', annotation=Name(id='_ExportContext', ctx=Load(), lineno=654, col_offset=9, end_lineno=654, end_col_offset=23), lineno=654, col_offset=4, end_lineno=654, end_col_offset=23), arg(arg='base_onnx', annotation=Name(id='Path', ctx=Load(), lineno=655, col_offset=15, end_lineno=655, end_col_offset=19), lineno=655, col_offset=4, end_lineno=655, end_col_offset=19)], kw_defaults=[None, None, None]), body=[Expr(value=Constant(value='Apply dynamic quantization and ensure the target ONNX exists.\n\n    This function conditionally applies dynamic quantization to the ONNX model\n    to reduce model size and potentially improve inference speed. If quantization\n    is enabled, it uses the configured quantization settings to produce a\n    quantized model. If quantization is disabled or fails, it ensures the target\n    path exists by copying the base model if needed.\n\n    Dynamic quantization converts floating-point weights to lower precision\n    (typically INT8) while maintaining model accuracy. This reduces model size\n    and can improve inference speed on certain hardware, but may slightly\n    degrade accuracy.\n\n    Parameters\n    ----------\n    encoder : _SparseEncoderProtocol\n        SPLADE encoder model to quantize. The encoder must support the quantization\n        interface provided by sentence-transformers export helpers.\n    ctx : _ExportContext\n        Export context containing quantization options, target path, model\n        directories, and provider information. The ctx.options.quantize flag\n        determines whether quantization is performed, and ctx.options.quantization_config\n        specifies quantization parameters.\n    base_onnx : Path\n        Path to the base ONNX model file (optimized or original). This is the\n        input for quantization. If quantization is disabled, this file is copied\n        to the target path.\n\n    Returns\n    -------\n    bool\n        True if a quantized artifact was successfully produced and exists at\n        the target path. False if quantization was disabled, failed, or the\n        base model was copied instead. Used by callers to determine which model\n        file was actually created.\n    ', lineno=657, col_offset=4, end_lineno=692, end_col_offset=7), lineno=657, col_offset=4, end_lineno=692, end_col_offset=7), Assign(targets=[Name(id='target_path', ctx=Store(), lineno=693, col_offset=4, end_lineno=693, end_col_offset=15)], value=Attribute(value=Name(id='ctx', ctx=Load(), lineno=693, col_offset=18, end_lineno=693, end_col_offset=21), attr='target_path', ctx=Load(), lineno=693, col_offset=18, end_lineno=693, end_col_offset=33), lineno=693, col_offset=4, end_lineno=693, end_col_offset=33), Assign(targets=[Name(id='options', ctx=Store(), lineno=694, col_offset=4, end_lineno=694, end_col_offset=11)], value=Attribute(value=Name(id='ctx', ctx=Load(), lineno=694, col_offset=14, end_lineno=694, end_col_offset=17), attr='options', ctx=Load(), lineno=694, col_offset=14, end_lineno=694, end_col_offset=25), lineno=694, col_offset=4, end_lineno=694, end_col_offset=25), If(test=UnaryOp(op=Not(), operand=Attribute(value=Name(id='options', ctx=Load(), lineno=695, col_offset=11, end_lineno=695, end_col_offset=18), attr='quantize', ctx=Load(), lineno=695, col_offset=11, end_lineno=695, end_col_offset=27), lineno=695, col_offset=7, end_lineno=695, end_col_offset=27), body=[If(test=BoolOp(op=And(), values=[Call(func=Attribute(value=Name(id='base_onnx', ctx=Load(), lineno=696, col_offset=11, end_lineno=696, end_col_offset=20), attr='exists', ctx=Load(), lineno=696, col_offset=11, end_lineno=696, end_col_offset=27), lineno=696, col_offset=11, end_lineno=696, end_col_offset=29), UnaryOp(op=Not(), operand=Call(func=Attribute(value=Name(id='target_path', ctx=Load(), lineno=696, col_offset=38, end_lineno=696, end_col_offset=49), attr='exists', ctx=Load(), lineno=696, col_offset=38, end_lineno=696, end_col_offset=56), lineno=696, col_offset=38, end_lineno=696, end_col_offset=58), lineno=696, col_offset=34, end_lineno=696, end_col_offset=58)], lineno=696, col_offset=11, end_lineno=696, end_col_offset=58), body=[Expr(value=Call(func=Attribute(value=Name(id='shutil', ctx=Load(), lineno=697, col_offset=12, end_lineno=697, end_col_offset=18), attr='copy2', ctx=Load(), lineno=697, col_offset=12, end_lineno=697, end_col_offset=24), args=[Name(id='base_onnx', ctx=Load(), lineno=697, col_offset=25, end_lineno=697, end_col_offset=34), Name(id='target_path', ctx=Load(), lineno=697, col_offset=36, end_lineno=697, end_col_offset=47)], lineno=697, col_offset=12, end_lineno=697, end_col_offset=48), lineno=697, col_offset=12, end_lineno=697, end_col_offset=48)], lineno=696, col_offset=8, end_lineno=697, end_col_offset=48), Return(value=Constant(value=False, lineno=698, col_offset=15, end_lineno=698, end_col_offset=20), lineno=698, col_offset=8, end_lineno=698, end_col_offset=20)], lineno=695, col_offset=4, end_lineno=698, end_col_offset=20), Assign(targets=[Tuple(elts=[Name(id='_optimizer', ctx=Store(), lineno=700, col_offset=4, end_lineno=700, end_col_offset=14), Name(id='quantizer', ctx=Store(), lineno=700, col_offset=16, end_lineno=700, end_col_offset=25)], ctx=Store(), lineno=700, col_offset=4, end_lineno=700, end_col_offset=25)], value=Call(func=Name(id='_require_export_helpers', ctx=Load(), lineno=700, col_offset=28, end_lineno=700, end_col_offset=51), lineno=700, col_offset=28, end_lineno=700, end_col_offset=53), lineno=700, col_offset=4, end_lineno=700, end_col_offset=53), Expr(value=Call(func=Name(id='quantizer', ctx=Load(), lineno=701, col_offset=4, end_lineno=701, end_col_offset=13), keywords=[keyword(arg='model', value=Name(id='encoder', ctx=Load(), lineno=702, col_offset=14, end_lineno=702, end_col_offset=21), lineno=702, col_offset=8, end_lineno=702, end_col_offset=21), keyword(arg='quantization_config', value=Attribute(value=Name(id='options', ctx=Load(), lineno=703, col_offset=28, end_lineno=703, end_col_offset=35), attr='quantization_config', ctx=Load(), lineno=703, col_offset=28, end_lineno=703, end_col_offset=55), lineno=703, col_offset=8, end_lineno=703, end_col_offset=55), keyword(arg='model_name_or_path', value=Call(func=Name(id='str', ctx=Load(), lineno=704, col_offset=27, end_lineno=704, end_col_offset=30), args=[Attribute(value=Name(id='ctx', ctx=Load(), lineno=704, col_offset=31, end_lineno=704, end_col_offset=34), attr='model_dir', ctx=Load(), lineno=704, col_offset=31, end_lineno=704, end_col_offset=44)], lineno=704, col_offset=27, end_lineno=704, end_col_offset=45), lineno=704, col_offset=8, end_lineno=704, end_col_offset=45), keyword(arg='push_to_hub', value=Constant(value=False, lineno=705, col_offset=20, end_lineno=705, end_col_offset=25), lineno=705, col_offset=8, end_lineno=705, end_col_offset=25), keyword(arg='create_pr', value=Constant(value=False, lineno=706, col_offset=18, end_lineno=706, end_col_offset=23), lineno=706, col_offset=8, end_lineno=706, end_col_offset=23)], lineno=701, col_offset=4, end_lineno=707, end_col_offset=5), lineno=701, col_offset=4, end_lineno=707, end_col_offset=5), If(test=Call(func=Attribute(value=Name(id='target_path', ctx=Load(), lineno=709, col_offset=7, end_lineno=709, end_col_offset=18), attr='exists', ctx=Load(), lineno=709, col_offset=7, end_lineno=709, end_col_offset=25), lineno=709, col_offset=7, end_lineno=709, end_col_offset=27), body=[Return(value=Constant(value=True, lineno=710, col_offset=15, end_lineno=710, end_col_offset=19), lineno=710, col_offset=8, end_lineno=710, end_col_offset=19)], lineno=709, col_offset=4, end_lineno=710, end_col_offset=19), If(test=Call(func=Attribute(value=Name(id='base_onnx', ctx=Load(), lineno=711, col_offset=7, end_lineno=711, end_col_offset=16), attr='exists', ctx=Load(), lineno=711, col_offset=7, end_lineno=711, end_col_offset=23), lineno=711, col_offset=7, end_lineno=711, end_col_offset=25), body=[Expr(value=Call(func=Attribute(value=Name(id='shutil', ctx=Load(), lineno=712, col_offset=8, end_lineno=712, end_col_offset=14), attr='copy2', ctx=Load(), lineno=712, col_offset=8, end_lineno=712, end_col_offset=20), args=[Name(id='base_onnx', ctx=Load(), lineno=712, col_offset=21, end_lineno=712, end_col_offset=30), Name(id='target_path', ctx=Load(), lineno=712, col_offset=32, end_lineno=712, end_col_offset=43)], lineno=712, col_offset=8, end_lineno=712, end_col_offset=44), lineno=712, col_offset=8, end_lineno=712, end_col_offset=44), Return(value=Constant(value=True, lineno=713, col_offset=15, end_lineno=713, end_col_offset=19), lineno=713, col_offset=8, end_lineno=713, end_col_offset=19)], lineno=711, col_offset=4, end_lineno=713, end_col_offset=19), Return(value=Constant(value=False, lineno=714, col_offset=11, end_lineno=714, end_col_offset=16), lineno=714, col_offset=4, end_lineno=714, end_col_offset=16)], returns=Name(id='bool', ctx=Load(), lineno=656, col_offset=5, end_lineno=656, end_col_offset=9), lineno=651, col_offset=0, end_lineno=714, end_col_offset=16), FunctionDef(name='_persist_export_metadata', args=arguments(kwonlyargs=[arg(arg='ctx', annotation=Name(id='_ExportContext', ctx=Load(), lineno=719, col_offset=9, end_lineno=719, end_col_offset=23), lineno=719, col_offset=4, end_lineno=719, end_col_offset=23), arg(arg='quantized', annotation=Name(id='bool', ctx=Load(), lineno=720, col_offset=15, end_lineno=720, end_col_offset=19), lineno=720, col_offset=4, end_lineno=720, end_col_offset=19)], kw_defaults=[None, None]), body=[Expr(value=Constant(value='Write export metadata and return the resulting summary.\n\n    This function creates and persists metadata about a SPLADE ONNX export\n    operation, including model identifier, export paths, provider information,\n    optimization and quantization status, and export timestamp. The metadata\n    is written as JSON to a standard location and can be used to verify exports\n    and understand export configuration.\n\n    Parameters\n    ----------\n    ctx : _ExportContext\n        Export context containing all export information: model identifier,\n        directory paths, provider, target file path, and export options\n        (optimization, quantization settings). Used to populate metadata fields.\n    quantized : bool\n        Flag indicating whether the exported model is quantized. Determines\n        which quantization configuration (if any) is stored in metadata. True\n        if dynamic quantization was successfully applied, False otherwise.\n\n    Returns\n    -------\n    SpladeExportSummary\n        Summary object containing:\n        - onnx_file: Path to the exported ONNX model file (relative or absolute)\n        - metadata_path: Path to the written metadata JSON file\n        The summary can be used to locate the exported artifacts and verify\n        export completion.\n    ', lineno=722, col_offset=4, end_lineno=749, end_col_offset=7), lineno=722, col_offset=4, end_lineno=749, end_col_offset=7), Assign(targets=[Name(id='metadata', ctx=Store(), lineno=750, col_offset=4, end_lineno=750, end_col_offset=12)], value=Call(func=Name(id='SpladeArtifactMetadata', ctx=Load(), lineno=750, col_offset=15, end_lineno=750, end_col_offset=37), keywords=[keyword(arg='model_id', value=Attribute(value=Name(id='ctx', ctx=Load(), lineno=751, col_offset=17, end_lineno=751, end_col_offset=20), attr='model_id', ctx=Load(), lineno=751, col_offset=17, end_lineno=751, end_col_offset=29), lineno=751, col_offset=8, end_lineno=751, end_col_offset=29), keyword(arg='model_dir', value=Call(func=Name(id='str', ctx=Load(), lineno=752, col_offset=18, end_lineno=752, end_col_offset=21), args=[Attribute(value=Name(id='ctx', ctx=Load(), lineno=752, col_offset=22, end_lineno=752, end_col_offset=25), attr='model_dir', ctx=Load(), lineno=752, col_offset=22, end_lineno=752, end_col_offset=35)], lineno=752, col_offset=18, end_lineno=752, end_col_offset=36), lineno=752, col_offset=8, end_lineno=752, end_col_offset=36), keyword(arg='onnx_dir', value=Call(func=Name(id='str', ctx=Load(), lineno=753, col_offset=17, end_lineno=753, end_col_offset=20), args=[Attribute(value=Name(id='ctx', ctx=Load(), lineno=753, col_offset=21, end_lineno=753, end_col_offset=24), attr='onnx_dir', ctx=Load(), lineno=753, col_offset=21, end_lineno=753, end_col_offset=33)], lineno=753, col_offset=17, end_lineno=753, end_col_offset=34), lineno=753, col_offset=8, end_lineno=753, end_col_offset=34), keyword(arg='onnx_file', value=Attribute(value=Attribute(value=Name(id='ctx', ctx=Load(), lineno=754, col_offset=18, end_lineno=754, end_col_offset=21), attr='target_path', ctx=Load(), lineno=754, col_offset=18, end_lineno=754, end_col_offset=33), attr='name', ctx=Load(), lineno=754, col_offset=18, end_lineno=754, end_col_offset=38), lineno=754, col_offset=8, end_lineno=754, end_col_offset=38), keyword(arg='provider', value=Attribute(value=Name(id='ctx', ctx=Load(), lineno=755, col_offset=17, end_lineno=755, end_col_offset=20), attr='provider', ctx=Load(), lineno=755, col_offset=17, end_lineno=755, end_col_offset=29), lineno=755, col_offset=8, end_lineno=755, end_col_offset=29), keyword(arg='optimized', value=Attribute(value=Attribute(value=Name(id='ctx', ctx=Load(), lineno=756, col_offset=18, end_lineno=756, end_col_offset=21), attr='options', ctx=Load(), lineno=756, col_offset=18, end_lineno=756, end_col_offset=29), attr='optimize', ctx=Load(), lineno=756, col_offset=18, end_lineno=756, end_col_offset=38), lineno=756, col_offset=8, end_lineno=756, end_col_offset=38), keyword(arg='quantized', value=Name(id='quantized', ctx=Load(), lineno=757, col_offset=18, end_lineno=757, end_col_offset=27), lineno=757, col_offset=8, end_lineno=757, end_col_offset=27), keyword(arg='quantization_config', value=IfExp(test=Attribute(value=Attribute(value=Name(id='ctx', ctx=Load(), lineno=758, col_offset=64, end_lineno=758, end_col_offset=67), attr='options', ctx=Load(), lineno=758, col_offset=64, end_lineno=758, end_col_offset=75), attr='quantize', ctx=Load(), lineno=758, col_offset=64, end_lineno=758, end_col_offset=84), body=Attribute(value=Attribute(value=Name(id='ctx', ctx=Load(), lineno=758, col_offset=29, end_lineno=758, end_col_offset=32), attr='options', ctx=Load(), lineno=758, col_offset=29, end_lineno=758, end_col_offset=40), attr='quantization_config', ctx=Load(), lineno=758, col_offset=29, end_lineno=758, end_col_offset=60), orelse=Constant(value=None, lineno=758, col_offset=90, end_lineno=758, end_col_offset=94), lineno=758, col_offset=29, end_lineno=758, end_col_offset=94), lineno=758, col_offset=8, end_lineno=758, end_col_offset=95), keyword(arg='exported_at', value=Call(func=Attribute(value=Call(func=Attribute(value=Name(id='datetime', ctx=Load(), lineno=759, col_offset=20, end_lineno=759, end_col_offset=28), attr='now', ctx=Load(), lineno=759, col_offset=20, end_lineno=759, end_col_offset=32), args=[Name(id='UTC', ctx=Load(), lineno=759, col_offset=33, end_lineno=759, end_col_offset=36)], lineno=759, col_offset=20, end_lineno=759, end_col_offset=37), attr='isoformat', ctx=Load(), lineno=759, col_offset=20, end_lineno=759, end_col_offset=47), lineno=759, col_offset=20, end_lineno=759, end_col_offset=49), lineno=759, col_offset=8, end_lineno=759, end_col_offset=49), keyword(arg='generator', value=Name(id='GENERATOR_NAME', ctx=Load(), lineno=760, col_offset=18, end_lineno=760, end_col_offset=32), lineno=760, col_offset=8, end_lineno=760, end_col_offset=32)], lineno=750, col_offset=15, end_lineno=761, end_col_offset=5), lineno=750, col_offset=4, end_lineno=761, end_col_offset=5), Assign(targets=[Name(id='metadata_path', ctx=Store(), lineno=762, col_offset=4, end_lineno=762, end_col_offset=17)], value=BinOp(left=Attribute(value=Name(id='ctx', ctx=Load(), lineno=762, col_offset=20, end_lineno=762, end_col_offset=23), attr='onnx_dir', ctx=Load(), lineno=762, col_offset=20, end_lineno=762, end_col_offset=32), op=Div(), right=Name(id='ARTIFACT_METADATA_FILENAME', ctx=Load(), lineno=762, col_offset=35, end_lineno=762, end_col_offset=61), lineno=762, col_offset=20, end_lineno=762, end_col_offset=61), lineno=762, col_offset=4, end_lineno=762, end_col_offset=61), Expr(value=Call(func=Name(id='_write_struct', ctx=Load(), lineno=763, col_offset=4, end_lineno=763, end_col_offset=17), args=[Name(id='metadata_path', ctx=Load(), lineno=763, col_offset=18, end_lineno=763, end_col_offset=31), Name(id='metadata', ctx=Load(), lineno=763, col_offset=33, end_lineno=763, end_col_offset=41)], lineno=763, col_offset=4, end_lineno=763, end_col_offset=42), lineno=763, col_offset=4, end_lineno=763, end_col_offset=42), Return(value=Call(func=Name(id='SpladeExportSummary', ctx=Load(), lineno=764, col_offset=11, end_lineno=764, end_col_offset=30), keywords=[keyword(arg='onnx_file', value=Call(func=Name(id='str', ctx=Load(), lineno=764, col_offset=41, end_lineno=764, end_col_offset=44), args=[Attribute(value=Name(id='ctx', ctx=Load(), lineno=764, col_offset=45, end_lineno=764, end_col_offset=48), attr='target_path', ctx=Load(), lineno=764, col_offset=45, end_lineno=764, end_col_offset=60)], lineno=764, col_offset=41, end_lineno=764, end_col_offset=61), lineno=764, col_offset=31, end_lineno=764, end_col_offset=61), keyword(arg='metadata_path', value=Call(func=Name(id='str', ctx=Load(), lineno=764, col_offset=77, end_lineno=764, end_col_offset=80), args=[Name(id='metadata_path', ctx=Load(), lineno=764, col_offset=81, end_lineno=764, end_col_offset=94)], lineno=764, col_offset=77, end_lineno=764, end_col_offset=95), lineno=764, col_offset=63, end_lineno=764, end_col_offset=95)], lineno=764, col_offset=11, end_lineno=764, end_col_offset=96), lineno=764, col_offset=4, end_lineno=764, end_col_offset=96)], returns=Name(id='SpladeExportSummary', ctx=Load(), lineno=721, col_offset=5, end_lineno=721, end_col_offset=24), lineno=717, col_offset=0, end_lineno=764, end_col_offset=96), ClassDef(name='SpladeArtifactsManager', body=[Expr(value=Constant(value='Manage SPLADE model exports and ONNX artifacts.', lineno=768, col_offset=4, end_lineno=768, end_col_offset=57), lineno=768, col_offset=4, end_lineno=768, end_col_offset=57), FunctionDef(name='__init__', args=arguments(args=[arg(arg='self', lineno=770, col_offset=17, end_lineno=770, end_col_offset=21), arg(arg='settings', annotation=Name(id='Settings', ctx=Load(), lineno=770, col_offset=33, end_lineno=770, end_col_offset=41), lineno=770, col_offset=23, end_lineno=770, end_col_offset=41)], kwonlyargs=[arg(arg='logger_', annotation=BinOp(left=Attribute(value=Name(id='logging', ctx=Load(), lineno=770, col_offset=55, end_lineno=770, end_col_offset=62), attr='Logger', ctx=Load(), lineno=770, col_offset=55, end_lineno=770, end_col_offset=69), op=BitOr(), right=Constant(value=None, lineno=770, col_offset=72, end_lineno=770, end_col_offset=76), lineno=770, col_offset=55, end_lineno=770, end_col_offset=76), lineno=770, col_offset=46, end_lineno=770, end_col_offset=76)], kw_defaults=[Constant(value=None, lineno=770, col_offset=79, end_lineno=770, end_col_offset=83)]), body=[Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=771, col_offset=8, end_lineno=771, end_col_offset=12), attr='_settings', ctx=Store(), lineno=771, col_offset=8, end_lineno=771, end_col_offset=22)], value=Name(id='settings', ctx=Load(), lineno=771, col_offset=25, end_lineno=771, end_col_offset=33), lineno=771, col_offset=8, end_lineno=771, end_col_offset=33), Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=772, col_offset=8, end_lineno=772, end_col_offset=12), attr='_logger', ctx=Store(), lineno=772, col_offset=8, end_lineno=772, end_col_offset=20)], value=BoolOp(op=Or(), values=[Name(id='logger_', ctx=Load(), lineno=772, col_offset=23, end_lineno=772, end_col_offset=30), Call(func=Attribute(value=Name(id='logging', ctx=Load(), lineno=772, col_offset=34, end_lineno=772, end_col_offset=41), attr='getLogger', ctx=Load(), lineno=772, col_offset=34, end_lineno=772, end_col_offset=51), args=[Name(id='__name__', ctx=Load(), lineno=772, col_offset=52, end_lineno=772, end_col_offset=60)], lineno=772, col_offset=34, end_lineno=772, end_col_offset=61)], lineno=772, col_offset=23, end_lineno=772, end_col_offset=61), lineno=772, col_offset=8, end_lineno=772, end_col_offset=61), Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=773, col_offset=8, end_lineno=773, end_col_offset=12), attr='_repo_root', ctx=Store(), lineno=773, col_offset=8, end_lineno=773, end_col_offset=23)], value=Call(func=Attribute(value=Call(func=Attribute(value=Call(func=Name(id='Path', ctx=Load(), lineno=773, col_offset=26, end_lineno=773, end_col_offset=30), args=[Attribute(value=Attribute(value=Name(id='settings', ctx=Load(), lineno=773, col_offset=31, end_lineno=773, end_col_offset=39), attr='paths', ctx=Load(), lineno=773, col_offset=31, end_lineno=773, end_col_offset=45), attr='repo_root', ctx=Load(), lineno=773, col_offset=31, end_lineno=773, end_col_offset=55)], lineno=773, col_offset=26, end_lineno=773, end_col_offset=56), attr='expanduser', ctx=Load(), lineno=773, col_offset=26, end_lineno=773, end_col_offset=67), lineno=773, col_offset=26, end_lineno=773, end_col_offset=69), attr='resolve', ctx=Load(), lineno=773, col_offset=26, end_lineno=773, end_col_offset=77), lineno=773, col_offset=26, end_lineno=773, end_col_offset=79), lineno=773, col_offset=8, end_lineno=773, end_col_offset=79), Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=774, col_offset=8, end_lineno=774, end_col_offset=12), attr='_config', ctx=Store(), lineno=774, col_offset=8, end_lineno=774, end_col_offset=20)], value=Attribute(value=Name(id='settings', ctx=Load(), lineno=774, col_offset=23, end_lineno=774, end_col_offset=31), attr='splade', ctx=Load(), lineno=774, col_offset=23, end_lineno=774, end_col_offset=38), lineno=774, col_offset=8, end_lineno=774, end_col_offset=38)], returns=Constant(value=None, lineno=770, col_offset=88, end_lineno=770, end_col_offset=92), lineno=770, col_offset=4, end_lineno=774, end_col_offset=38), FunctionDef(name='model_dir', args=arguments(args=[arg(arg='self', lineno=777, col_offset=18, end_lineno=777, end_col_offset=22)]), body=[Expr(value=Constant(value='Return the repository-relative directory containing saved SPLADE weights.\n\n        Returns\n        -------\n        Path\n            Absolute path to the configured SPLADE model directory.\n        ', lineno=778, col_offset=8, end_lineno=784, end_col_offset=11), lineno=778, col_offset=8, end_lineno=784, end_col_offset=11), Return(value=Call(func=Name(id='resolve_within_repo', ctx=Load(), lineno=785, col_offset=15, end_lineno=785, end_col_offset=34), args=[Attribute(value=Name(id='self', ctx=Load(), lineno=785, col_offset=35, end_lineno=785, end_col_offset=39), attr='_repo_root', ctx=Load(), lineno=785, col_offset=35, end_lineno=785, end_col_offset=50), Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=785, col_offset=52, end_lineno=785, end_col_offset=56), attr='_config', ctx=Load(), lineno=785, col_offset=52, end_lineno=785, end_col_offset=64), attr='model_dir', ctx=Load(), lineno=785, col_offset=52, end_lineno=785, end_col_offset=74)], lineno=785, col_offset=15, end_lineno=785, end_col_offset=75), lineno=785, col_offset=8, end_lineno=785, end_col_offset=75)], decorator_list=[Name(id='property', ctx=Load(), lineno=776, col_offset=5, end_lineno=776, end_col_offset=13)], returns=Name(id='Path', ctx=Load(), lineno=777, col_offset=27, end_lineno=777, end_col_offset=31), lineno=777, col_offset=4, end_lineno=785, end_col_offset=75), FunctionDef(name='onnx_dir', args=arguments(args=[arg(arg='self', lineno=788, col_offset=17, end_lineno=788, end_col_offset=21)]), body=[Expr(value=Constant(value='Return the directory where exported ONNX artifacts are stored.\n\n        Returns\n        -------\n        Path\n            Absolute path to the configured ONNX artifacts directory.\n        ', lineno=789, col_offset=8, end_lineno=795, end_col_offset=11), lineno=789, col_offset=8, end_lineno=795, end_col_offset=11), Return(value=Call(func=Name(id='resolve_within_repo', ctx=Load(), lineno=796, col_offset=15, end_lineno=796, end_col_offset=34), args=[Attribute(value=Name(id='self', ctx=Load(), lineno=796, col_offset=35, end_lineno=796, end_col_offset=39), attr='_repo_root', ctx=Load(), lineno=796, col_offset=35, end_lineno=796, end_col_offset=50), Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=796, col_offset=52, end_lineno=796, end_col_offset=56), attr='_config', ctx=Load(), lineno=796, col_offset=52, end_lineno=796, end_col_offset=64), attr='onnx_dir', ctx=Load(), lineno=796, col_offset=52, end_lineno=796, end_col_offset=73)], lineno=796, col_offset=15, end_lineno=796, end_col_offset=74), lineno=796, col_offset=8, end_lineno=796, end_col_offset=74)], decorator_list=[Name(id='property', ctx=Load(), lineno=787, col_offset=5, end_lineno=787, end_col_offset=13)], returns=Name(id='Path', ctx=Load(), lineno=788, col_offset=26, end_lineno=788, end_col_offset=30), lineno=788, col_offset=4, end_lineno=796, end_col_offset=74), FunctionDef(name='export_onnx', args=arguments(args=[arg(arg='self', lineno=798, col_offset=20, end_lineno=798, end_col_offset=24), arg(arg='options', annotation=BinOp(left=Name(id='SpladeExportOptions', ctx=Load(), lineno=798, col_offset=35, end_lineno=798, end_col_offset=54), op=BitOr(), right=Constant(value=None, lineno=798, col_offset=57, end_lineno=798, end_col_offset=61), lineno=798, col_offset=35, end_lineno=798, end_col_offset=61), lineno=798, col_offset=26, end_lineno=798, end_col_offset=61)], defaults=[Constant(value=None, lineno=798, col_offset=64, end_lineno=798, end_col_offset=68)]), body=[Expr(value=Constant(value='Export SPLADE ONNX artifacts and record metadata.\n\n        Parameters\n        ----------\n        options : SpladeExportOptions | None, optional\n            Overrides for model identifier, provider, and export behaviour.\n\n        Returns\n        -------\n        SpladeExportSummary\n            Summary describing the exported artifact and metadata path.\n        ', lineno=799, col_offset=8, end_lineno=810, end_col_offset=11), lineno=799, col_offset=8, end_lineno=810, end_col_offset=11), Assign(targets=[Name(id='opts', ctx=Store(), lineno=811, col_offset=8, end_lineno=811, end_col_offset=12)], value=BoolOp(op=Or(), values=[Name(id='options', ctx=Load(), lineno=811, col_offset=15, end_lineno=811, end_col_offset=22), Call(func=Name(id='SpladeExportOptions', ctx=Load(), lineno=811, col_offset=26, end_lineno=811, end_col_offset=45), lineno=811, col_offset=26, end_lineno=811, end_col_offset=47)], lineno=811, col_offset=15, end_lineno=811, end_col_offset=47), lineno=811, col_offset=8, end_lineno=811, end_col_offset=47), Assign(targets=[Name(id='sparse_encoder_cls', ctx=Store(), lineno=812, col_offset=8, end_lineno=812, end_col_offset=26)], value=Call(func=Name(id='_require_sparse_encoder', ctx=Load(), lineno=812, col_offset=29, end_lineno=812, end_col_offset=52), lineno=812, col_offset=29, end_lineno=812, end_col_offset=54), lineno=812, col_offset=8, end_lineno=812, end_col_offset=54), Assign(targets=[Name(id='model_id', ctx=Store(), lineno=813, col_offset=8, end_lineno=813, end_col_offset=16)], value=BoolOp(op=Or(), values=[Attribute(value=Name(id='opts', ctx=Load(), lineno=813, col_offset=19, end_lineno=813, end_col_offset=23), attr='model_id', ctx=Load(), lineno=813, col_offset=19, end_lineno=813, end_col_offset=32), Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=813, col_offset=36, end_lineno=813, end_col_offset=40), attr='_config', ctx=Load(), lineno=813, col_offset=36, end_lineno=813, end_col_offset=48), attr='model_id', ctx=Load(), lineno=813, col_offset=36, end_lineno=813, end_col_offset=57)], lineno=813, col_offset=19, end_lineno=813, end_col_offset=57), lineno=813, col_offset=8, end_lineno=813, end_col_offset=57), Assign(targets=[Name(id='provider', ctx=Store(), lineno=814, col_offset=8, end_lineno=814, end_col_offset=16)], value=BoolOp(op=Or(), values=[Attribute(value=Name(id='opts', ctx=Load(), lineno=814, col_offset=19, end_lineno=814, end_col_offset=23), attr='provider', ctx=Load(), lineno=814, col_offset=19, end_lineno=814, end_col_offset=32), Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=814, col_offset=36, end_lineno=814, end_col_offset=40), attr='_config', ctx=Load(), lineno=814, col_offset=36, end_lineno=814, end_col_offset=48), attr='provider', ctx=Load(), lineno=814, col_offset=36, end_lineno=814, end_col_offset=57)], lineno=814, col_offset=19, end_lineno=814, end_col_offset=57), lineno=814, col_offset=8, end_lineno=814, end_col_offset=57), Assign(targets=[Name(id='model_dir', ctx=Store(), lineno=815, col_offset=8, end_lineno=815, end_col_offset=17)], value=Attribute(value=Name(id='self', ctx=Load(), lineno=815, col_offset=20, end_lineno=815, end_col_offset=24), attr='model_dir', ctx=Load(), lineno=815, col_offset=20, end_lineno=815, end_col_offset=34), lineno=815, col_offset=8, end_lineno=815, end_col_offset=34), Assign(targets=[Name(id='onnx_dir', ctx=Store(), lineno=816, col_offset=8, end_lineno=816, end_col_offset=16)], value=Attribute(value=Name(id='self', ctx=Load(), lineno=816, col_offset=19, end_lineno=816, end_col_offset=23), attr='onnx_dir', ctx=Load(), lineno=816, col_offset=19, end_lineno=816, end_col_offset=32), lineno=816, col_offset=8, end_lineno=816, end_col_offset=32), Expr(value=Call(func=Attribute(value=Name(id='onnx_dir', ctx=Load(), lineno=817, col_offset=8, end_lineno=817, end_col_offset=16), attr='mkdir', ctx=Load(), lineno=817, col_offset=8, end_lineno=817, end_col_offset=22), keywords=[keyword(arg='parents', value=Constant(value=True, lineno=817, col_offset=31, end_lineno=817, end_col_offset=35), lineno=817, col_offset=23, end_lineno=817, end_col_offset=35), keyword(arg='exist_ok', value=Constant(value=True, lineno=817, col_offset=46, end_lineno=817, end_col_offset=50), lineno=817, col_offset=37, end_lineno=817, end_col_offset=50)], lineno=817, col_offset=8, end_lineno=817, end_col_offset=51), lineno=817, col_offset=8, end_lineno=817, end_col_offset=51), Expr(value=Call(func=Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=819, col_offset=8, end_lineno=819, end_col_offset=12), attr='_logger', ctx=Load(), lineno=819, col_offset=8, end_lineno=819, end_col_offset=20), attr='info', ctx=Load(), lineno=819, col_offset=8, end_lineno=819, end_col_offset=25), args=[Constant(value='Exporting SPLADE model', lineno=820, col_offset=12, end_lineno=820, end_col_offset=36)], keywords=[keyword(arg='extra', value=Dict(keys=[Constant(value='model_id', lineno=822, col_offset=16, end_lineno=822, end_col_offset=26), Constant(value='model_dir', lineno=823, col_offset=16, end_lineno=823, end_col_offset=27), Constant(value='provider', lineno=824, col_offset=16, end_lineno=824, end_col_offset=26)], values=[Name(id='model_id', ctx=Load(), lineno=822, col_offset=28, end_lineno=822, end_col_offset=36), Call(func=Name(id='str', ctx=Load(), lineno=823, col_offset=29, end_lineno=823, end_col_offset=32), args=[Name(id='model_dir', ctx=Load(), lineno=823, col_offset=33, end_lineno=823, end_col_offset=42)], lineno=823, col_offset=29, end_lineno=823, end_col_offset=43), Name(id='provider', ctx=Load(), lineno=824, col_offset=28, end_lineno=824, end_col_offset=36)], lineno=821, col_offset=18, end_lineno=825, end_col_offset=13), lineno=821, col_offset=12, end_lineno=825, end_col_offset=13)], lineno=819, col_offset=8, end_lineno=826, end_col_offset=9), lineno=819, col_offset=8, end_lineno=826, end_col_offset=9), Assign(targets=[Name(id='encoder', ctx=Store(), lineno=828, col_offset=8, end_lineno=828, end_col_offset=15)], value=Call(func=Name(id='sparse_encoder_cls', ctx=Load(), lineno=828, col_offset=18, end_lineno=828, end_col_offset=36), args=[Name(id='model_id', ctx=Load(), lineno=828, col_offset=37, end_lineno=828, end_col_offset=45)], keywords=[keyword(arg='backend', value=Constant(value='onnx', lineno=828, col_offset=55, end_lineno=828, end_col_offset=61), lineno=828, col_offset=47, end_lineno=828, end_col_offset=61), keyword(arg='model_kwargs', value=Dict(keys=[Constant(value='provider', lineno=828, col_offset=77, end_lineno=828, end_col_offset=87)], values=[Name(id='provider', ctx=Load(), lineno=828, col_offset=89, end_lineno=828, end_col_offset=97)], lineno=828, col_offset=76, end_lineno=828, end_col_offset=98), lineno=828, col_offset=63, end_lineno=828, end_col_offset=98)], lineno=828, col_offset=18, end_lineno=828, end_col_offset=99), lineno=828, col_offset=8, end_lineno=828, end_col_offset=99), Expr(value=Call(func=Attribute(value=Name(id='encoder', ctx=Load(), lineno=829, col_offset=8, end_lineno=829, end_col_offset=15), attr='save_pretrained', ctx=Load(), lineno=829, col_offset=8, end_lineno=829, end_col_offset=31), args=[Call(func=Name(id='str', ctx=Load(), lineno=829, col_offset=32, end_lineno=829, end_col_offset=35), args=[Name(id='model_dir', ctx=Load(), lineno=829, col_offset=36, end_lineno=829, end_col_offset=45)], lineno=829, col_offset=32, end_lineno=829, end_col_offset=46)], lineno=829, col_offset=8, end_lineno=829, end_col_offset=47), lineno=829, col_offset=8, end_lineno=829, end_col_offset=47), Assign(targets=[Name(id='ctx', ctx=Store(), lineno=830, col_offset=8, end_lineno=830, end_col_offset=11)], value=Call(func=Name(id='_ExportContext', ctx=Load(), lineno=830, col_offset=14, end_lineno=830, end_col_offset=28), keywords=[keyword(arg='model_id', value=Name(id='model_id', ctx=Load(), lineno=831, col_offset=21, end_lineno=831, end_col_offset=29), lineno=831, col_offset=12, end_lineno=831, end_col_offset=29), keyword(arg='model_dir', value=Name(id='model_dir', ctx=Load(), lineno=832, col_offset=22, end_lineno=832, end_col_offset=31), lineno=832, col_offset=12, end_lineno=832, end_col_offset=31), keyword(arg='onnx_dir', value=Name(id='onnx_dir', ctx=Load(), lineno=833, col_offset=21, end_lineno=833, end_col_offset=29), lineno=833, col_offset=12, end_lineno=833, end_col_offset=29), keyword(arg='provider', value=Name(id='provider', ctx=Load(), lineno=834, col_offset=21, end_lineno=834, end_col_offset=29), lineno=834, col_offset=12, end_lineno=834, end_col_offset=29), keyword(arg='target_path', value=BinOp(left=Name(id='onnx_dir', ctx=Load(), lineno=835, col_offset=24, end_lineno=835, end_col_offset=32), op=Div(), right=BoolOp(op=Or(), values=[Attribute(value=Name(id='opts', ctx=Load(), lineno=835, col_offset=36, end_lineno=835, end_col_offset=40), attr='file_name', ctx=Load(), lineno=835, col_offset=36, end_lineno=835, end_col_offset=50), Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=835, col_offset=54, end_lineno=835, end_col_offset=58), attr='_config', ctx=Load(), lineno=835, col_offset=54, end_lineno=835, end_col_offset=66), attr='onnx_file', ctx=Load(), lineno=835, col_offset=54, end_lineno=835, end_col_offset=76)], lineno=835, col_offset=36, end_lineno=835, end_col_offset=76), lineno=835, col_offset=24, end_lineno=835, end_col_offset=77), lineno=835, col_offset=12, end_lineno=835, end_col_offset=77), keyword(arg='options', value=Name(id='opts', ctx=Load(), lineno=836, col_offset=20, end_lineno=836, end_col_offset=24), lineno=836, col_offset=12, end_lineno=836, end_col_offset=24)], lineno=830, col_offset=14, end_lineno=837, end_col_offset=9), lineno=830, col_offset=8, end_lineno=837, end_col_offset=9), Assign(targets=[Name(id='base_onnx', ctx=Store(), lineno=838, col_offset=8, end_lineno=838, end_col_offset=17)], value=Call(func=Name(id='_optimize_export', ctx=Load(), lineno=838, col_offset=20, end_lineno=838, end_col_offset=36), args=[Name(id='encoder', ctx=Load(), lineno=838, col_offset=37, end_lineno=838, end_col_offset=44), Name(id='ctx', ctx=Load(), lineno=838, col_offset=46, end_lineno=838, end_col_offset=49)], lineno=838, col_offset=20, end_lineno=838, end_col_offset=50), lineno=838, col_offset=8, end_lineno=838, end_col_offset=50), Assign(targets=[Name(id='quantized', ctx=Store(), lineno=839, col_offset=8, end_lineno=839, end_col_offset=17)], value=Call(func=Name(id='_quantize_export', ctx=Load(), lineno=839, col_offset=20, end_lineno=839, end_col_offset=36), keywords=[keyword(arg='encoder', value=Name(id='encoder', ctx=Load(), lineno=839, col_offset=45, end_lineno=839, end_col_offset=52), lineno=839, col_offset=37, end_lineno=839, end_col_offset=52), keyword(arg='ctx', value=Name(id='ctx', ctx=Load(), lineno=839, col_offset=58, end_lineno=839, end_col_offset=61), lineno=839, col_offset=54, end_lineno=839, end_col_offset=61), keyword(arg='base_onnx', value=Name(id='base_onnx', ctx=Load(), lineno=839, col_offset=73, end_lineno=839, end_col_offset=82), lineno=839, col_offset=63, end_lineno=839, end_col_offset=82)], lineno=839, col_offset=20, end_lineno=839, end_col_offset=83), lineno=839, col_offset=8, end_lineno=839, end_col_offset=83), Assign(targets=[Name(id='summary', ctx=Store(), lineno=841, col_offset=8, end_lineno=841, end_col_offset=15)], value=Call(func=Name(id='_persist_export_metadata', ctx=Load(), lineno=841, col_offset=18, end_lineno=841, end_col_offset=42), keywords=[keyword(arg='ctx', value=Name(id='ctx', ctx=Load(), lineno=841, col_offset=47, end_lineno=841, end_col_offset=50), lineno=841, col_offset=43, end_lineno=841, end_col_offset=50), keyword(arg='quantized', value=Name(id='quantized', ctx=Load(), lineno=841, col_offset=62, end_lineno=841, end_col_offset=71), lineno=841, col_offset=52, end_lineno=841, end_col_offset=71)], lineno=841, col_offset=18, end_lineno=841, end_col_offset=72), lineno=841, col_offset=8, end_lineno=841, end_col_offset=72), Expr(value=Call(func=Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=842, col_offset=8, end_lineno=842, end_col_offset=12), attr='_logger', ctx=Load(), lineno=842, col_offset=8, end_lineno=842, end_col_offset=20), attr='info', ctx=Load(), lineno=842, col_offset=8, end_lineno=842, end_col_offset=25), args=[Constant(value='Exported SPLADE artifacts', lineno=843, col_offset=12, end_lineno=843, end_col_offset=39)], keywords=[keyword(arg='extra', value=Dict(keys=[Constant(value='onnx_file', lineno=844, col_offset=19, end_lineno=844, end_col_offset=30), Constant(value='metadata', lineno=844, col_offset=51, end_lineno=844, end_col_offset=61)], values=[Attribute(value=Name(id='summary', ctx=Load(), lineno=844, col_offset=32, end_lineno=844, end_col_offset=39), attr='onnx_file', ctx=Load(), lineno=844, col_offset=32, end_lineno=844, end_col_offset=49), Attribute(value=Name(id='summary', ctx=Load(), lineno=844, col_offset=63, end_lineno=844, end_col_offset=70), attr='metadata_path', ctx=Load(), lineno=844, col_offset=63, end_lineno=844, end_col_offset=84)], lineno=844, col_offset=18, end_lineno=844, end_col_offset=85), lineno=844, col_offset=12, end_lineno=844, end_col_offset=85)], lineno=842, col_offset=8, end_lineno=845, end_col_offset=9), lineno=842, col_offset=8, end_lineno=845, end_col_offset=9), Return(value=Name(id='summary', ctx=Load(), lineno=846, col_offset=15, end_lineno=846, end_col_offset=22), lineno=846, col_offset=8, end_lineno=846, end_col_offset=22)], returns=Name(id='SpladeExportSummary', ctx=Load(), lineno=798, col_offset=73, end_lineno=798, end_col_offset=92), lineno=798, col_offset=4, end_lineno=846, end_col_offset=22)], lineno=767, col_offset=0, end_lineno=846, end_col_offset=22), ClassDef(name='SpladeEncoderService', body=[Expr(value=Constant(value='Encode corpora into SPLADE JsonVectorCollection shards.', lineno=850, col_offset=4, end_lineno=850, end_col_offset=65), lineno=850, col_offset=4, end_lineno=850, end_col_offset=65), FunctionDef(name='__init__', args=arguments(args=[arg(arg='self', lineno=852, col_offset=17, end_lineno=852, end_col_offset=21), arg(arg='settings', annotation=Name(id='Settings', ctx=Load(), lineno=852, col_offset=33, end_lineno=852, end_col_offset=41), lineno=852, col_offset=23, end_lineno=852, end_col_offset=41)], kwonlyargs=[arg(arg='logger_', annotation=BinOp(left=Attribute(value=Name(id='logging', ctx=Load(), lineno=852, col_offset=55, end_lineno=852, end_col_offset=62), attr='Logger', ctx=Load(), lineno=852, col_offset=55, end_lineno=852, end_col_offset=69), op=BitOr(), right=Constant(value=None, lineno=852, col_offset=72, end_lineno=852, end_col_offset=76), lineno=852, col_offset=55, end_lineno=852, end_col_offset=76), lineno=852, col_offset=46, end_lineno=852, end_col_offset=76)], kw_defaults=[Constant(value=None, lineno=852, col_offset=79, end_lineno=852, end_col_offset=83)]), body=[Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=853, col_offset=8, end_lineno=853, end_col_offset=12), attr='_settings', ctx=Store(), lineno=853, col_offset=8, end_lineno=853, end_col_offset=22)], value=Name(id='settings', ctx=Load(), lineno=853, col_offset=25, end_lineno=853, end_col_offset=33), lineno=853, col_offset=8, end_lineno=853, end_col_offset=33), Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=854, col_offset=8, end_lineno=854, end_col_offset=12), attr='_logger', ctx=Store(), lineno=854, col_offset=8, end_lineno=854, end_col_offset=20)], value=BoolOp(op=Or(), values=[Name(id='logger_', ctx=Load(), lineno=854, col_offset=23, end_lineno=854, end_col_offset=30), Call(func=Attribute(value=Name(id='logging', ctx=Load(), lineno=854, col_offset=34, end_lineno=854, end_col_offset=41), attr='getLogger', ctx=Load(), lineno=854, col_offset=34, end_lineno=854, end_col_offset=51), args=[Name(id='__name__', ctx=Load(), lineno=854, col_offset=52, end_lineno=854, end_col_offset=60)], lineno=854, col_offset=34, end_lineno=854, end_col_offset=61)], lineno=854, col_offset=23, end_lineno=854, end_col_offset=61), lineno=854, col_offset=8, end_lineno=854, end_col_offset=61), Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=855, col_offset=8, end_lineno=855, end_col_offset=12), attr='_repo_root', ctx=Store(), lineno=855, col_offset=8, end_lineno=855, end_col_offset=23)], value=Call(func=Attribute(value=Call(func=Attribute(value=Call(func=Name(id='Path', ctx=Load(), lineno=855, col_offset=26, end_lineno=855, end_col_offset=30), args=[Attribute(value=Attribute(value=Name(id='settings', ctx=Load(), lineno=855, col_offset=31, end_lineno=855, end_col_offset=39), attr='paths', ctx=Load(), lineno=855, col_offset=31, end_lineno=855, end_col_offset=45), attr='repo_root', ctx=Load(), lineno=855, col_offset=31, end_lineno=855, end_col_offset=55)], lineno=855, col_offset=26, end_lineno=855, end_col_offset=56), attr='expanduser', ctx=Load(), lineno=855, col_offset=26, end_lineno=855, end_col_offset=67), lineno=855, col_offset=26, end_lineno=855, end_col_offset=69), attr='resolve', ctx=Load(), lineno=855, col_offset=26, end_lineno=855, end_col_offset=77), lineno=855, col_offset=26, end_lineno=855, end_col_offset=79), lineno=855, col_offset=8, end_lineno=855, end_col_offset=79), Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=856, col_offset=8, end_lineno=856, end_col_offset=12), attr='_config', ctx=Store(), lineno=856, col_offset=8, end_lineno=856, end_col_offset=20)], value=Attribute(value=Name(id='settings', ctx=Load(), lineno=856, col_offset=23, end_lineno=856, end_col_offset=31), attr='splade', ctx=Load(), lineno=856, col_offset=23, end_lineno=856, end_col_offset=38), lineno=856, col_offset=8, end_lineno=856, end_col_offset=38)], returns=Constant(value=None, lineno=852, col_offset=88, end_lineno=852, end_col_offset=92), lineno=852, col_offset=4, end_lineno=856, end_col_offset=38), FunctionDef(name='vectors_dir', args=arguments(args=[arg(arg='self', lineno=859, col_offset=20, end_lineno=859, end_col_offset=24)]), body=[Expr(value=Constant(value='Return the directory that stores SPLADE JsonVectorCollection shards.\n\n        Returns\n        -------\n        Path\n            Absolute path to the configured vectors directory.\n        ', lineno=860, col_offset=8, end_lineno=866, end_col_offset=11), lineno=860, col_offset=8, end_lineno=866, end_col_offset=11), Return(value=Call(func=Name(id='resolve_within_repo', ctx=Load(), lineno=867, col_offset=15, end_lineno=867, end_col_offset=34), args=[Attribute(value=Name(id='self', ctx=Load(), lineno=867, col_offset=35, end_lineno=867, end_col_offset=39), attr='_repo_root', ctx=Load(), lineno=867, col_offset=35, end_lineno=867, end_col_offset=50), Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=867, col_offset=52, end_lineno=867, end_col_offset=56), attr='_config', ctx=Load(), lineno=867, col_offset=52, end_lineno=867, end_col_offset=64), attr='vectors_dir', ctx=Load(), lineno=867, col_offset=52, end_lineno=867, end_col_offset=76)], lineno=867, col_offset=15, end_lineno=867, end_col_offset=77), lineno=867, col_offset=8, end_lineno=867, end_col_offset=77)], decorator_list=[Name(id='property', ctx=Load(), lineno=858, col_offset=5, end_lineno=858, end_col_offset=13)], returns=Name(id='Path', ctx=Load(), lineno=859, col_offset=29, end_lineno=859, end_col_offset=33), lineno=859, col_offset=4, end_lineno=867, end_col_offset=77), FunctionDef(name='_resolve_vectors_dir', args=arguments(args=[arg(arg='self', lineno=869, col_offset=29, end_lineno=869, end_col_offset=33), arg(arg='override', annotation=BinOp(left=BinOp(left=Name(id='str', ctx=Load(), lineno=869, col_offset=45, end_lineno=869, end_col_offset=48), op=BitOr(), right=Name(id='Path', ctx=Load(), lineno=869, col_offset=51, end_lineno=869, end_col_offset=55), lineno=869, col_offset=45, end_lineno=869, end_col_offset=55), op=BitOr(), right=Constant(value=None, lineno=869, col_offset=58, end_lineno=869, end_col_offset=62), lineno=869, col_offset=45, end_lineno=869, end_col_offset=62), lineno=869, col_offset=35, end_lineno=869, end_col_offset=62)]), body=[Expr(value=Constant(value="Resolve the vectors directory override or fall back to the configured path.\n\n        This method resolves the output directory for encoded vectors, either\n        using an explicit override path or falling back to the configured default.\n        The directory is created if it doesn't exist, ensuring it's ready for\n        writing shard files.\n\n        Parameters\n        ----------\n        override : str | Path | None, optional\n            Optional override path for the vectors directory. If provided, this\n            path is resolved relative to the repository root and used instead of\n            the configured default. If None, uses the configured vectors_dir\n            from settings. Defaults to None.\n\n        Returns\n        -------\n        Path\n            Absolute path to the directory where encoded vectors will be written.\n            The directory is guaranteed to exist (created if necessary). The path\n            is resolved relative to the repository root and normalized.\n        ", lineno=870, col_offset=8, end_lineno=891, end_col_offset=11), lineno=870, col_offset=8, end_lineno=891, end_col_offset=11), If(test=Compare(left=Name(id='override', ctx=Load(), lineno=892, col_offset=11, end_lineno=892, end_col_offset=19), ops=[Is()], comparators=[Constant(value=None, lineno=892, col_offset=23, end_lineno=892, end_col_offset=27)], lineno=892, col_offset=11, end_lineno=892, end_col_offset=27), body=[Assign(targets=[Name(id='resolved', ctx=Store(), lineno=893, col_offset=12, end_lineno=893, end_col_offset=20)], value=Attribute(value=Name(id='self', ctx=Load(), lineno=893, col_offset=23, end_lineno=893, end_col_offset=27), attr='vectors_dir', ctx=Load(), lineno=893, col_offset=23, end_lineno=893, end_col_offset=39), lineno=893, col_offset=12, end_lineno=893, end_col_offset=39)], orelse=[Assign(targets=[Name(id='resolved', ctx=Store(), lineno=895, col_offset=12, end_lineno=895, end_col_offset=20)], value=Call(func=Name(id='resolve_within_repo', ctx=Load(), lineno=895, col_offset=23, end_lineno=895, end_col_offset=42), args=[Attribute(value=Name(id='self', ctx=Load(), lineno=895, col_offset=43, end_lineno=895, end_col_offset=47), attr='_repo_root', ctx=Load(), lineno=895, col_offset=43, end_lineno=895, end_col_offset=58), Name(id='override', ctx=Load(), lineno=895, col_offset=60, end_lineno=895, end_col_offset=68)], lineno=895, col_offset=23, end_lineno=895, end_col_offset=69), lineno=895, col_offset=12, end_lineno=895, end_col_offset=69)], lineno=892, col_offset=8, end_lineno=895, end_col_offset=69), Expr(value=Call(func=Attribute(value=Name(id='resolved', ctx=Load(), lineno=896, col_offset=8, end_lineno=896, end_col_offset=16), attr='mkdir', ctx=Load(), lineno=896, col_offset=8, end_lineno=896, end_col_offset=22), keywords=[keyword(arg='parents', value=Constant(value=True, lineno=896, col_offset=31, end_lineno=896, end_col_offset=35), lineno=896, col_offset=23, end_lineno=896, end_col_offset=35), keyword(arg='exist_ok', value=Constant(value=True, lineno=896, col_offset=46, end_lineno=896, end_col_offset=50), lineno=896, col_offset=37, end_lineno=896, end_col_offset=50)], lineno=896, col_offset=8, end_lineno=896, end_col_offset=51), lineno=896, col_offset=8, end_lineno=896, end_col_offset=51), Return(value=Name(id='resolved', ctx=Load(), lineno=897, col_offset=15, end_lineno=897, end_col_offset=23), lineno=897, col_offset=8, end_lineno=897, end_col_offset=23)], returns=Name(id='Path', ctx=Load(), lineno=869, col_offset=67, end_lineno=869, end_col_offset=71), lineno=869, col_offset=4, end_lineno=897, end_col_offset=23), FunctionDef(name='_initialise_encoder', args=arguments(args=[arg(arg='self', lineno=900, col_offset=8, end_lineno=900, end_col_offset=12)], kwonlyargs=[arg(arg='provider', annotation=Name(id='str', ctx=Load(), lineno=902, col_offset=18, end_lineno=902, end_col_offset=21), lineno=902, col_offset=8, end_lineno=902, end_col_offset=21), arg(arg='onnx_file', annotation=BinOp(left=Name(id='str', ctx=Load(), lineno=903, col_offset=19, end_lineno=903, end_col_offset=22), op=BitOr(), right=Constant(value=None, lineno=903, col_offset=25, end_lineno=903, end_col_offset=29), lineno=903, col_offset=19, end_lineno=903, end_col_offset=29), lineno=903, col_offset=8, end_lineno=903, end_col_offset=29)], kw_defaults=[None, None]), body=[Expr(value=Constant(value='Instantiate a SparseEncoder and return the resolved ONNX artifact (if any).\n\n        This method initializes a SPLADE sparse encoder instance, searching for\n        ONNX model files in a priority order: explicit onnx_file parameter,\n        configured default ONNX file, or falls back to PyTorch model if no ONNX\n        file is found. The encoder is configured with the specified provider\n        (CPU, CUDA, etc.) for inference.\n\n        The method searches multiple candidate paths to find an available ONNX\n        model, preferring explicitly specified files over defaults. If an ONNX\n        file is found, it\'s used for faster inference. Otherwise, the encoder\n        falls back to the PyTorch model.\n\n        Parameters\n        ----------\n        provider : str\n            ONNX runtime provider to use for inference (e.g., "cpu", "cuda",\n            "tensorrt"). The provider determines which hardware/backend is used\n            for model execution. Must be a valid provider name supported by the\n            ONNX runtime.\n        onnx_file : str | None, optional\n            Optional explicit ONNX filename to use. If provided, this file is\n            searched first in the ONNX directory. If not found or None, falls\n            back to the configured default ONNX filename. Defaults to None.\n\n        Returns\n        -------\n        tuple[_SparseEncoderProtocol, str | None]\n            Tuple containing:\n            - Encoder instance ready for encoding operations. The encoder is\n              configured with the found ONNX model (if available) or PyTorch\n              model, using the specified provider.\n            - Relative path to the ONNX file used (relative to model_dir), or\n              None if no ONNX file was found and PyTorch model was used instead.\n              This path can be stored in metadata for reproducibility.\n        ', lineno=905, col_offset=8, end_lineno=940, end_col_offset=11), lineno=905, col_offset=8, end_lineno=940, end_col_offset=11), Assign(targets=[Name(id='sparse_encoder_cls', ctx=Store(), lineno=941, col_offset=8, end_lineno=941, end_col_offset=26)], value=Call(func=Name(id='_require_sparse_encoder', ctx=Load(), lineno=941, col_offset=29, end_lineno=941, end_col_offset=52), lineno=941, col_offset=29, end_lineno=941, end_col_offset=54), lineno=941, col_offset=8, end_lineno=941, end_col_offset=54), Assign(targets=[Name(id='model_dir', ctx=Store(), lineno=942, col_offset=8, end_lineno=942, end_col_offset=17)], value=Call(func=Name(id='resolve_within_repo', ctx=Load(), lineno=942, col_offset=20, end_lineno=942, end_col_offset=39), args=[Attribute(value=Name(id='self', ctx=Load(), lineno=942, col_offset=40, end_lineno=942, end_col_offset=44), attr='_repo_root', ctx=Load(), lineno=942, col_offset=40, end_lineno=942, end_col_offset=55), Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=942, col_offset=57, end_lineno=942, end_col_offset=61), attr='_config', ctx=Load(), lineno=942, col_offset=57, end_lineno=942, end_col_offset=69), attr='model_dir', ctx=Load(), lineno=942, col_offset=57, end_lineno=942, end_col_offset=79)], lineno=942, col_offset=20, end_lineno=942, end_col_offset=80), lineno=942, col_offset=8, end_lineno=942, end_col_offset=80), Assign(targets=[Name(id='onnx_dir', ctx=Store(), lineno=943, col_offset=8, end_lineno=943, end_col_offset=16)], value=Call(func=Name(id='resolve_within_repo', ctx=Load(), lineno=943, col_offset=19, end_lineno=943, end_col_offset=38), args=[Attribute(value=Name(id='self', ctx=Load(), lineno=943, col_offset=39, end_lineno=943, end_col_offset=43), attr='_repo_root', ctx=Load(), lineno=943, col_offset=39, end_lineno=943, end_col_offset=54), Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=943, col_offset=56, end_lineno=943, end_col_offset=60), attr='_config', ctx=Load(), lineno=943, col_offset=56, end_lineno=943, end_col_offset=68), attr='onnx_dir', ctx=Load(), lineno=943, col_offset=56, end_lineno=943, end_col_offset=77)], lineno=943, col_offset=19, end_lineno=943, end_col_offset=78), lineno=943, col_offset=8, end_lineno=943, end_col_offset=78), AnnAssign(target=Name(id='search_paths', ctx=Store(), lineno=944, col_offset=8, end_lineno=944, end_col_offset=20), annotation=Subscript(value=Name(id='list', ctx=Load(), lineno=944, col_offset=22, end_lineno=944, end_col_offset=26), slice=Name(id='Path', ctx=Load(), lineno=944, col_offset=27, end_lineno=944, end_col_offset=31), ctx=Load(), lineno=944, col_offset=22, end_lineno=944, end_col_offset=32), value=List(ctx=Load(), lineno=944, col_offset=35, end_lineno=944, end_col_offset=37), simple=1, lineno=944, col_offset=8, end_lineno=944, end_col_offset=37), If(test=Compare(left=Name(id='onnx_file', ctx=Load(), lineno=945, col_offset=11, end_lineno=945, end_col_offset=20), ops=[IsNot()], comparators=[Constant(value=None, lineno=945, col_offset=28, end_lineno=945, end_col_offset=32)], lineno=945, col_offset=11, end_lineno=945, end_col_offset=32), body=[Expr(value=Call(func=Attribute(value=Name(id='search_paths', ctx=Load(), lineno=946, col_offset=12, end_lineno=946, end_col_offset=24), attr='append', ctx=Load(), lineno=946, col_offset=12, end_lineno=946, end_col_offset=31), args=[BinOp(left=Name(id='onnx_dir', ctx=Load(), lineno=946, col_offset=32, end_lineno=946, end_col_offset=40), op=Div(), right=Name(id='onnx_file', ctx=Load(), lineno=946, col_offset=43, end_lineno=946, end_col_offset=52), lineno=946, col_offset=32, end_lineno=946, end_col_offset=52)], lineno=946, col_offset=12, end_lineno=946, end_col_offset=53), lineno=946, col_offset=12, end_lineno=946, end_col_offset=53)], lineno=945, col_offset=8, end_lineno=946, end_col_offset=53), Assign(targets=[Name(id='default_candidate', ctx=Store(), lineno=947, col_offset=8, end_lineno=947, end_col_offset=25)], value=BinOp(left=Name(id='onnx_dir', ctx=Load(), lineno=947, col_offset=28, end_lineno=947, end_col_offset=36), op=Div(), right=Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=947, col_offset=39, end_lineno=947, end_col_offset=43), attr='_config', ctx=Load(), lineno=947, col_offset=39, end_lineno=947, end_col_offset=51), attr='onnx_file', ctx=Load(), lineno=947, col_offset=39, end_lineno=947, end_col_offset=61), lineno=947, col_offset=28, end_lineno=947, end_col_offset=61), lineno=947, col_offset=8, end_lineno=947, end_col_offset=61), If(test=Compare(left=Name(id='default_candidate', ctx=Load(), lineno=948, col_offset=11, end_lineno=948, end_col_offset=28), ops=[NotIn()], comparators=[Name(id='search_paths', ctx=Load(), lineno=948, col_offset=36, end_lineno=948, end_col_offset=48)], lineno=948, col_offset=11, end_lineno=948, end_col_offset=48), body=[Expr(value=Call(func=Attribute(value=Name(id='search_paths', ctx=Load(), lineno=949, col_offset=12, end_lineno=949, end_col_offset=24), attr='append', ctx=Load(), lineno=949, col_offset=12, end_lineno=949, end_col_offset=31), args=[Name(id='default_candidate', ctx=Load(), lineno=949, col_offset=32, end_lineno=949, end_col_offset=49)], lineno=949, col_offset=12, end_lineno=949, end_col_offset=50), lineno=949, col_offset=12, end_lineno=949, end_col_offset=50)], lineno=948, col_offset=8, end_lineno=949, end_col_offset=50), AnnAssign(target=Name(id='model_kwargs', ctx=Store(), lineno=951, col_offset=8, end_lineno=951, end_col_offset=20), annotation=Subscript(value=Name(id='dict', ctx=Load(), lineno=951, col_offset=22, end_lineno=951, end_col_offset=26), slice=Tuple(elts=[Name(id='str', ctx=Load(), lineno=951, col_offset=27, end_lineno=951, end_col_offset=30), Name(id='str', ctx=Load(), lineno=951, col_offset=32, end_lineno=951, end_col_offset=35)], ctx=Load(), lineno=951, col_offset=27, end_lineno=951, end_col_offset=35), ctx=Load(), lineno=951, col_offset=22, end_lineno=951, end_col_offset=36), value=Dict(keys=[Constant(value='provider', lineno=951, col_offset=40, end_lineno=951, end_col_offset=50)], values=[Name(id='provider', ctx=Load(), lineno=951, col_offset=52, end_lineno=951, end_col_offset=60)], lineno=951, col_offset=39, end_lineno=951, end_col_offset=61), simple=1, lineno=951, col_offset=8, end_lineno=951, end_col_offset=61), AnnAssign(target=Name(id='selected_relative', ctx=Store(), lineno=952, col_offset=8, end_lineno=952, end_col_offset=25), annotation=BinOp(left=Name(id='str', ctx=Load(), lineno=952, col_offset=27, end_lineno=952, end_col_offset=30), op=BitOr(), right=Constant(value=None, lineno=952, col_offset=33, end_lineno=952, end_col_offset=37), lineno=952, col_offset=27, end_lineno=952, end_col_offset=37), value=Constant(value=None, lineno=952, col_offset=40, end_lineno=952, end_col_offset=44), simple=1, lineno=952, col_offset=8, end_lineno=952, end_col_offset=44), For(target=Name(id='candidate', ctx=Store(), lineno=953, col_offset=12, end_lineno=953, end_col_offset=21), iter=Name(id='search_paths', ctx=Load(), lineno=953, col_offset=25, end_lineno=953, end_col_offset=37), body=[If(test=Call(func=Attribute(value=Name(id='candidate', ctx=Load(), lineno=954, col_offset=15, end_lineno=954, end_col_offset=24), attr='exists', ctx=Load(), lineno=954, col_offset=15, end_lineno=954, end_col_offset=31), lineno=954, col_offset=15, end_lineno=954, end_col_offset=33), body=[Assign(targets=[Name(id='relative_path', ctx=Store(), lineno=955, col_offset=16, end_lineno=955, end_col_offset=29)], value=Call(func=Name(id='_serialize_relative', ctx=Load(), lineno=955, col_offset=32, end_lineno=955, end_col_offset=51), args=[Name(id='candidate', ctx=Load(), lineno=955, col_offset=52, end_lineno=955, end_col_offset=61), Name(id='model_dir', ctx=Load(), lineno=955, col_offset=63, end_lineno=955, end_col_offset=72)], lineno=955, col_offset=32, end_lineno=955, end_col_offset=73), lineno=955, col_offset=16, end_lineno=955, end_col_offset=73), Assign(targets=[Subscript(value=Name(id='model_kwargs', ctx=Load(), lineno=956, col_offset=16, end_lineno=956, end_col_offset=28), slice=Constant(value='file_name', lineno=956, col_offset=29, end_lineno=956, end_col_offset=40), ctx=Store(), lineno=956, col_offset=16, end_lineno=956, end_col_offset=41)], value=Name(id='relative_path', ctx=Load(), lineno=956, col_offset=44, end_lineno=956, end_col_offset=57), lineno=956, col_offset=16, end_lineno=956, end_col_offset=57), Assign(targets=[Name(id='selected_relative', ctx=Store(), lineno=957, col_offset=16, end_lineno=957, end_col_offset=33)], value=Name(id='relative_path', ctx=Load(), lineno=957, col_offset=36, end_lineno=957, end_col_offset=49), lineno=957, col_offset=16, end_lineno=957, end_col_offset=49), Break(lineno=958, col_offset=16, end_lineno=958, end_col_offset=21)], lineno=954, col_offset=12, end_lineno=958, end_col_offset=21)], lineno=953, col_offset=8, end_lineno=958, end_col_offset=21), Assign(targets=[Name(id='encoder', ctx=Store(), lineno=960, col_offset=8, end_lineno=960, end_col_offset=15)], value=Call(func=Name(id='sparse_encoder_cls', ctx=Load(), lineno=960, col_offset=18, end_lineno=960, end_col_offset=36), args=[Call(func=Name(id='str', ctx=Load(), lineno=961, col_offset=12, end_lineno=961, end_col_offset=15), args=[Name(id='model_dir', ctx=Load(), lineno=961, col_offset=16, end_lineno=961, end_col_offset=25)], lineno=961, col_offset=12, end_lineno=961, end_col_offset=26)], keywords=[keyword(arg='backend', value=Constant(value='onnx', lineno=962, col_offset=20, end_lineno=962, end_col_offset=26), lineno=962, col_offset=12, end_lineno=962, end_col_offset=26), keyword(arg='model_kwargs', value=Name(id='model_kwargs', ctx=Load(), lineno=963, col_offset=25, end_lineno=963, end_col_offset=37), lineno=963, col_offset=12, end_lineno=963, end_col_offset=37)], lineno=960, col_offset=18, end_lineno=964, end_col_offset=9), lineno=960, col_offset=8, end_lineno=964, end_col_offset=9), Return(value=Tuple(elts=[Name(id='encoder', ctx=Load(), lineno=965, col_offset=15, end_lineno=965, end_col_offset=22), Name(id='selected_relative', ctx=Load(), lineno=965, col_offset=24, end_lineno=965, end_col_offset=41)], ctx=Load(), lineno=965, col_offset=15, end_lineno=965, end_col_offset=41), lineno=965, col_offset=8, end_lineno=965, end_col_offset=41)], returns=Subscript(value=Name(id='tuple', ctx=Load(), lineno=904, col_offset=9, end_lineno=904, end_col_offset=14), slice=Tuple(elts=[Name(id='_SparseEncoderProtocol', ctx=Load(), lineno=904, col_offset=15, end_lineno=904, end_col_offset=37), BinOp(left=Name(id='str', ctx=Load(), lineno=904, col_offset=39, end_lineno=904, end_col_offset=42), op=BitOr(), right=Constant(value=None, lineno=904, col_offset=45, end_lineno=904, end_col_offset=49), lineno=904, col_offset=39, end_lineno=904, end_col_offset=49)], ctx=Load(), lineno=904, col_offset=15, end_lineno=904, end_col_offset=49), ctx=Load(), lineno=904, col_offset=9, end_lineno=904, end_col_offset=50), lineno=899, col_offset=4, end_lineno=965, end_col_offset=41), FunctionDef(name='_build_encoder', args=arguments(args=[arg(arg='self', lineno=967, col_offset=23, end_lineno=967, end_col_offset=27)], kwonlyargs=[arg(arg='provider', annotation=Name(id='str', ctx=Load(), lineno=967, col_offset=42, end_lineno=967, end_col_offset=45), lineno=967, col_offset=32, end_lineno=967, end_col_offset=45), arg(arg='onnx_file', annotation=BinOp(left=Name(id='str', ctx=Load(), lineno=967, col_offset=58, end_lineno=967, end_col_offset=61), op=BitOr(), right=Constant(value=None, lineno=967, col_offset=64, end_lineno=967, end_col_offset=68), lineno=967, col_offset=58, end_lineno=967, end_col_offset=68), lineno=967, col_offset=47, end_lineno=967, end_col_offset=68)], kw_defaults=[None, None]), body=[Assign(targets=[Tuple(elts=[Name(id='encoder', ctx=Store(), lineno=968, col_offset=8, end_lineno=968, end_col_offset=15), Name(id='_', ctx=Store(), lineno=968, col_offset=17, end_lineno=968, end_col_offset=18)], ctx=Store(), lineno=968, col_offset=8, end_lineno=968, end_col_offset=18)], value=Call(func=Attribute(value=Name(id='self', ctx=Load(), lineno=968, col_offset=21, end_lineno=968, end_col_offset=25), attr='_initialise_encoder', ctx=Load(), lineno=968, col_offset=21, end_lineno=968, end_col_offset=45), keywords=[keyword(arg='provider', value=Name(id='provider', ctx=Load(), lineno=968, col_offset=55, end_lineno=968, end_col_offset=63), lineno=968, col_offset=46, end_lineno=968, end_col_offset=63), keyword(arg='onnx_file', value=Name(id='onnx_file', ctx=Load(), lineno=968, col_offset=75, end_lineno=968, end_col_offset=84), lineno=968, col_offset=65, end_lineno=968, end_col_offset=84)], lineno=968, col_offset=21, end_lineno=968, end_col_offset=85), lineno=968, col_offset=8, end_lineno=968, end_col_offset=85), Return(value=Name(id='encoder', ctx=Load(), lineno=969, col_offset=15, end_lineno=969, end_col_offset=22), lineno=969, col_offset=8, end_lineno=969, end_col_offset=22)], returns=Name(id='_SparseEncoderProtocol', ctx=Load(), lineno=967, col_offset=73, end_lineno=967, end_col_offset=95), lineno=967, col_offset=4, end_lineno=969, end_col_offset=22), FunctionDef(name='encode_corpus', args=arguments(args=[arg(arg='self', lineno=972, col_offset=8, end_lineno=972, end_col_offset=12), arg(arg='source', annotation=BinOp(left=Name(id='str', ctx=Load(), lineno=973, col_offset=16, end_lineno=973, end_col_offset=19), op=BitOr(), right=Name(id='Path', ctx=Load(), lineno=973, col_offset=22, end_lineno=973, end_col_offset=26), lineno=973, col_offset=16, end_lineno=973, end_col_offset=26), lineno=973, col_offset=8, end_lineno=973, end_col_offset=26), arg(arg='options', annotation=BinOp(left=Name(id='SpladeEncodeOptions', ctx=Load(), lineno=974, col_offset=17, end_lineno=974, end_col_offset=36), op=BitOr(), right=Constant(value=None, lineno=974, col_offset=39, end_lineno=974, end_col_offset=43), lineno=974, col_offset=17, end_lineno=974, end_col_offset=43), lineno=974, col_offset=8, end_lineno=974, end_col_offset=43)], defaults=[Constant(value=None, lineno=974, col_offset=46, end_lineno=974, end_col_offset=50)]), body=[Expr(value=Constant(value='Encode ``source`` JSONL into SPLADE JsonVectorCollection shards.\n\n        Parameters\n        ----------\n        source : str | Path\n            Path to the JSONL corpus containing ``id`` and ``contents``/``text`` fields.\n        options : SpladeEncodeOptions | None, optional\n            Overrides for output directory, batch size, quantization, provider, and ONNX file.\n\n        Returns\n        -------\n        SpladeEncodingSummary\n            Summary including document count, vectors directory, metadata path, and shard count.\n\n        Raises\n        ------\n        TypeError\n            If corpus entries are missing identifiers or textual content.\n        ', lineno=976, col_offset=8, end_lineno=994, end_col_offset=11), lineno=976, col_offset=8, end_lineno=994, end_col_offset=11), Assign(targets=[Name(id='opts', ctx=Store(), lineno=995, col_offset=8, end_lineno=995, end_col_offset=12)], value=BoolOp(op=Or(), values=[Name(id='options', ctx=Load(), lineno=995, col_offset=15, end_lineno=995, end_col_offset=22), Call(func=Name(id='SpladeEncodeOptions', ctx=Load(), lineno=995, col_offset=26, end_lineno=995, end_col_offset=45), lineno=995, col_offset=26, end_lineno=995, end_col_offset=47)], lineno=995, col_offset=15, end_lineno=995, end_col_offset=47), lineno=995, col_offset=8, end_lineno=995, end_col_offset=47), Assign(targets=[Name(id='source_path', ctx=Store(), lineno=997, col_offset=8, end_lineno=997, end_col_offset=19)], value=Call(func=Name(id='resolve_within_repo', ctx=Load(), lineno=997, col_offset=22, end_lineno=997, end_col_offset=41), args=[Attribute(value=Name(id='self', ctx=Load(), lineno=997, col_offset=42, end_lineno=997, end_col_offset=46), attr='_repo_root', ctx=Load(), lineno=997, col_offset=42, end_lineno=997, end_col_offset=57), Name(id='source', ctx=Load(), lineno=997, col_offset=59, end_lineno=997, end_col_offset=65)], keywords=[keyword(arg='allow_nonexistent', value=Constant(value=False, lineno=997, col_offset=85, end_lineno=997, end_col_offset=90), lineno=997, col_offset=67, end_lineno=997, end_col_offset=90)], lineno=997, col_offset=22, end_lineno=997, end_col_offset=91), lineno=997, col_offset=8, end_lineno=997, end_col_offset=91), Assign(targets=[Name(id='vectors_dir', ctx=Store(), lineno=998, col_offset=8, end_lineno=998, end_col_offset=19)], value=Call(func=Attribute(value=Name(id='self', ctx=Load(), lineno=998, col_offset=22, end_lineno=998, end_col_offset=26), attr='_resolve_vectors_dir', ctx=Load(), lineno=998, col_offset=22, end_lineno=998, end_col_offset=47), args=[Attribute(value=Name(id='opts', ctx=Load(), lineno=998, col_offset=48, end_lineno=998, end_col_offset=52), attr='output_dir', ctx=Load(), lineno=998, col_offset=48, end_lineno=998, end_col_offset=63)], lineno=998, col_offset=22, end_lineno=998, end_col_offset=64), lineno=998, col_offset=8, end_lineno=998, end_col_offset=64), Assign(targets=[Name(id='batch_size', ctx=Store(), lineno=999, col_offset=8, end_lineno=999, end_col_offset=18)], value=BoolOp(op=Or(), values=[Attribute(value=Name(id='opts', ctx=Load(), lineno=999, col_offset=21, end_lineno=999, end_col_offset=25), attr='batch_size', ctx=Load(), lineno=999, col_offset=21, end_lineno=999, end_col_offset=36), Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=999, col_offset=40, end_lineno=999, end_col_offset=44), attr='_config', ctx=Load(), lineno=999, col_offset=40, end_lineno=999, end_col_offset=52), attr='batch_size', ctx=Load(), lineno=999, col_offset=40, end_lineno=999, end_col_offset=63)], lineno=999, col_offset=21, end_lineno=999, end_col_offset=63), lineno=999, col_offset=8, end_lineno=999, end_col_offset=63), Assign(targets=[Name(id='provider', ctx=Store(), lineno=1000, col_offset=8, end_lineno=1000, end_col_offset=16)], value=BoolOp(op=Or(), values=[Attribute(value=Name(id='opts', ctx=Load(), lineno=1000, col_offset=19, end_lineno=1000, end_col_offset=23), attr='provider', ctx=Load(), lineno=1000, col_offset=19, end_lineno=1000, end_col_offset=32), Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=1000, col_offset=36, end_lineno=1000, end_col_offset=40), attr='_config', ctx=Load(), lineno=1000, col_offset=36, end_lineno=1000, end_col_offset=48), attr='provider', ctx=Load(), lineno=1000, col_offset=36, end_lineno=1000, end_col_offset=57)], lineno=1000, col_offset=19, end_lineno=1000, end_col_offset=57), lineno=1000, col_offset=8, end_lineno=1000, end_col_offset=57), Assign(targets=[Name(id='encoder', ctx=Store(), lineno=1002, col_offset=8, end_lineno=1002, end_col_offset=15)], value=Call(func=Attribute(value=Name(id='self', ctx=Load(), lineno=1002, col_offset=18, end_lineno=1002, end_col_offset=22), attr='_build_encoder', ctx=Load(), lineno=1002, col_offset=18, end_lineno=1002, end_col_offset=37), keywords=[keyword(arg='provider', value=Name(id='provider', ctx=Load(), lineno=1002, col_offset=47, end_lineno=1002, end_col_offset=55), lineno=1002, col_offset=38, end_lineno=1002, end_col_offset=55), keyword(arg='onnx_file', value=Attribute(value=Name(id='opts', ctx=Load(), lineno=1002, col_offset=67, end_lineno=1002, end_col_offset=71), attr='onnx_file', ctx=Load(), lineno=1002, col_offset=67, end_lineno=1002, end_col_offset=81), lineno=1002, col_offset=57, end_lineno=1002, end_col_offset=81)], lineno=1002, col_offset=18, end_lineno=1002, end_col_offset=82), lineno=1002, col_offset=8, end_lineno=1002, end_col_offset=82), Assign(targets=[Name(id='state', ctx=Store(), lineno=1004, col_offset=8, end_lineno=1004, end_col_offset=13)], value=Call(func=Name(id='_ShardState', ctx=Load(), lineno=1004, col_offset=16, end_lineno=1004, end_col_offset=27), keywords=[keyword(arg='vectors_dir', value=Name(id='vectors_dir', ctx=Load(), lineno=1005, col_offset=24, end_lineno=1005, end_col_offset=35), lineno=1005, col_offset=12, end_lineno=1005, end_col_offset=35), keyword(arg='quantization', value=BoolOp(op=Or(), values=[Attribute(value=Name(id='opts', ctx=Load(), lineno=1006, col_offset=25, end_lineno=1006, end_col_offset=29), attr='quantization', ctx=Load(), lineno=1006, col_offset=25, end_lineno=1006, end_col_offset=42), Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=1006, col_offset=46, end_lineno=1006, end_col_offset=50), attr='_config', ctx=Load(), lineno=1006, col_offset=46, end_lineno=1006, end_col_offset=58), attr='quantization', ctx=Load(), lineno=1006, col_offset=46, end_lineno=1006, end_col_offset=71)], lineno=1006, col_offset=25, end_lineno=1006, end_col_offset=71), lineno=1006, col_offset=12, end_lineno=1006, end_col_offset=71), keyword(arg='shard_size', value=Attribute(value=Name(id='opts', ctx=Load(), lineno=1007, col_offset=23, end_lineno=1007, end_col_offset=27), attr='shard_size', ctx=Load(), lineno=1007, col_offset=23, end_lineno=1007, end_col_offset=38), lineno=1007, col_offset=12, end_lineno=1007, end_col_offset=38)], lineno=1004, col_offset=16, end_lineno=1008, end_col_offset=9), lineno=1004, col_offset=8, end_lineno=1008, end_col_offset=9), AnnAssign(target=Name(id='batch', ctx=Store(), lineno=1009, col_offset=8, end_lineno=1009, end_col_offset=13), annotation=Subscript(value=Name(id='list', ctx=Load(), lineno=1009, col_offset=15, end_lineno=1009, end_col_offset=19), slice=Subscript(value=Name(id='tuple', ctx=Load(), lineno=1009, col_offset=20, end_lineno=1009, end_col_offset=25), slice=Tuple(elts=[Name(id='str', ctx=Load(), lineno=1009, col_offset=26, end_lineno=1009, end_col_offset=29), Name(id='str', ctx=Load(), lineno=1009, col_offset=31, end_lineno=1009, end_col_offset=34)], ctx=Load(), lineno=1009, col_offset=26, end_lineno=1009, end_col_offset=34), ctx=Load(), lineno=1009, col_offset=20, end_lineno=1009, end_col_offset=35), ctx=Load(), lineno=1009, col_offset=15, end_lineno=1009, end_col_offset=36), value=List(ctx=Load(), lineno=1009, col_offset=39, end_lineno=1009, end_col_offset=41), simple=1, lineno=1009, col_offset=8, end_lineno=1009, end_col_offset=41), Try(body=[Expr(value=Call(func=Name(id='_encode_records', ctx=Load(), lineno=1012, col_offset=12, end_lineno=1012, end_col_offset=27), keywords=[keyword(arg='encoder', value=Name(id='encoder', ctx=Load(), lineno=1013, col_offset=24, end_lineno=1013, end_col_offset=31), lineno=1013, col_offset=16, end_lineno=1013, end_col_offset=31), keyword(arg='state', value=Name(id='state', ctx=Load(), lineno=1014, col_offset=22, end_lineno=1014, end_col_offset=27), lineno=1014, col_offset=16, end_lineno=1014, end_col_offset=27), keyword(arg='batch', value=Name(id='batch', ctx=Load(), lineno=1015, col_offset=22, end_lineno=1015, end_col_offset=27), lineno=1015, col_offset=16, end_lineno=1015, end_col_offset=27), keyword(arg='batch_size', value=Name(id='batch_size', ctx=Load(), lineno=1016, col_offset=27, end_lineno=1016, end_col_offset=37), lineno=1016, col_offset=16, end_lineno=1016, end_col_offset=37), keyword(arg='source_path', value=Name(id='source_path', ctx=Load(), lineno=1017, col_offset=28, end_lineno=1017, end_col_offset=39), lineno=1017, col_offset=16, end_lineno=1017, end_col_offset=39)], lineno=1012, col_offset=12, end_lineno=1018, end_col_offset=13), lineno=1012, col_offset=12, end_lineno=1018, end_col_offset=13)], handlers=[ExceptHandler(type=Name(id='TypeError', ctx=Load(), lineno=1019, col_offset=15, end_lineno=1019, end_col_offset=24), name='exc', body=[Raise(exc=Call(func=Name(id='TypeError', ctx=Load(), lineno=1020, col_offset=18, end_lineno=1020, end_col_offset=27), args=[Call(func=Name(id='str', ctx=Load(), lineno=1020, col_offset=28, end_lineno=1020, end_col_offset=31), args=[Name(id='exc', ctx=Load(), lineno=1020, col_offset=32, end_lineno=1020, end_col_offset=35)], lineno=1020, col_offset=28, end_lineno=1020, end_col_offset=36)], lineno=1020, col_offset=18, end_lineno=1020, end_col_offset=37), cause=Name(id='exc', ctx=Load(), lineno=1020, col_offset=43, end_lineno=1020, end_col_offset=46), lineno=1020, col_offset=12, end_lineno=1020, end_col_offset=46)], lineno=1019, col_offset=8, end_lineno=1020, end_col_offset=46)], lineno=1011, col_offset=8, end_lineno=1020, end_col_offset=46), If(test=Compare(left=Attribute(value=Name(id='state', ctx=Load(), lineno=1022, col_offset=11, end_lineno=1022, end_col_offset=16), attr='shard_handle', ctx=Load(), lineno=1022, col_offset=11, end_lineno=1022, end_col_offset=29), ops=[IsNot()], comparators=[Constant(value=None, lineno=1022, col_offset=37, end_lineno=1022, end_col_offset=41)], lineno=1022, col_offset=11, end_lineno=1022, end_col_offset=41), body=[Expr(value=Call(func=Attribute(value=Attribute(value=Name(id='state', ctx=Load(), lineno=1023, col_offset=12, end_lineno=1023, end_col_offset=17), attr='shard_handle', ctx=Load(), lineno=1023, col_offset=12, end_lineno=1023, end_col_offset=30), attr='close', ctx=Load(), lineno=1023, col_offset=12, end_lineno=1023, end_col_offset=36), lineno=1023, col_offset=12, end_lineno=1023, end_col_offset=38), lineno=1023, col_offset=12, end_lineno=1023, end_col_offset=38), Assign(targets=[Attribute(value=Name(id='state', ctx=Load(), lineno=1024, col_offset=12, end_lineno=1024, end_col_offset=17), attr='shard_handle', ctx=Store(), lineno=1024, col_offset=12, end_lineno=1024, end_col_offset=30)], value=Constant(value=None, lineno=1024, col_offset=33, end_lineno=1024, end_col_offset=37), lineno=1024, col_offset=12, end_lineno=1024, end_col_offset=37)], lineno=1022, col_offset=8, end_lineno=1024, end_col_offset=37), Assign(targets=[Name(id='summary', ctx=Store(), lineno=1026, col_offset=8, end_lineno=1026, end_col_offset=15)], value=Call(func=Name(id='_persist_encoding_metadata', ctx=Load(), lineno=1026, col_offset=18, end_lineno=1026, end_col_offset=44), keywords=[keyword(arg='state', value=Name(id='state', ctx=Load(), lineno=1027, col_offset=18, end_lineno=1027, end_col_offset=23), lineno=1027, col_offset=12, end_lineno=1027, end_col_offset=23), keyword(arg='vectors_dir', value=Name(id='vectors_dir', ctx=Load(), lineno=1028, col_offset=24, end_lineno=1028, end_col_offset=35), lineno=1028, col_offset=12, end_lineno=1028, end_col_offset=35), keyword(arg='source_path', value=Name(id='source_path', ctx=Load(), lineno=1029, col_offset=24, end_lineno=1029, end_col_offset=35), lineno=1029, col_offset=12, end_lineno=1029, end_col_offset=35), keyword(arg='batch_size', value=Name(id='batch_size', ctx=Load(), lineno=1030, col_offset=23, end_lineno=1030, end_col_offset=33), lineno=1030, col_offset=12, end_lineno=1030, end_col_offset=33), keyword(arg='provider', value=Name(id='provider', ctx=Load(), lineno=1031, col_offset=21, end_lineno=1031, end_col_offset=29), lineno=1031, col_offset=12, end_lineno=1031, end_col_offset=29)], lineno=1026, col_offset=18, end_lineno=1032, end_col_offset=9), lineno=1026, col_offset=8, end_lineno=1032, end_col_offset=9), Expr(value=Call(func=Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=1034, col_offset=8, end_lineno=1034, end_col_offset=12), attr='_logger', ctx=Load(), lineno=1034, col_offset=8, end_lineno=1034, end_col_offset=20), attr='info', ctx=Load(), lineno=1034, col_offset=8, end_lineno=1034, end_col_offset=25), args=[Constant(value='Encoded SPLADE corpus', lineno=1035, col_offset=12, end_lineno=1035, end_col_offset=35)], keywords=[keyword(arg='extra', value=Dict(keys=[Constant(value='doc_count', lineno=1037, col_offset=16, end_lineno=1037, end_col_offset=27), Constant(value='vectors_dir', lineno=1038, col_offset=16, end_lineno=1038, end_col_offset=29), Constant(value='metadata', lineno=1039, col_offset=16, end_lineno=1039, end_col_offset=26)], values=[Attribute(value=Name(id='summary', ctx=Load(), lineno=1037, col_offset=29, end_lineno=1037, end_col_offset=36), attr='doc_count', ctx=Load(), lineno=1037, col_offset=29, end_lineno=1037, end_col_offset=46), Attribute(value=Name(id='summary', ctx=Load(), lineno=1038, col_offset=31, end_lineno=1038, end_col_offset=38), attr='vectors_dir', ctx=Load(), lineno=1038, col_offset=31, end_lineno=1038, end_col_offset=50), Attribute(value=Name(id='summary', ctx=Load(), lineno=1039, col_offset=28, end_lineno=1039, end_col_offset=35), attr='metadata_path', ctx=Load(), lineno=1039, col_offset=28, end_lineno=1039, end_col_offset=49)], lineno=1036, col_offset=18, end_lineno=1040, end_col_offset=13), lineno=1036, col_offset=12, end_lineno=1040, end_col_offset=13)], lineno=1034, col_offset=8, end_lineno=1041, end_col_offset=9), lineno=1034, col_offset=8, end_lineno=1041, end_col_offset=9), Return(value=Name(id='summary', ctx=Load(), lineno=1042, col_offset=15, end_lineno=1042, end_col_offset=22), lineno=1042, col_offset=8, end_lineno=1042, end_col_offset=22)], returns=Name(id='SpladeEncodingSummary', ctx=Load(), lineno=975, col_offset=9, end_lineno=975, end_col_offset=30), lineno=971, col_offset=4, end_lineno=1042, end_col_offset=22), FunctionDef(name='benchmark_queries', args=arguments(args=[arg(arg='self', lineno=1045, col_offset=8, end_lineno=1045, end_col_offset=12), arg(arg='queries', annotation=Subscript(value=Name(id='Sequence', ctx=Load(), lineno=1046, col_offset=17, end_lineno=1046, end_col_offset=25), slice=Name(id='str', ctx=Load(), lineno=1046, col_offset=26, end_lineno=1046, end_col_offset=29), ctx=Load(), lineno=1046, col_offset=17, end_lineno=1046, end_col_offset=30), lineno=1046, col_offset=8, end_lineno=1046, end_col_offset=30), arg(arg='options', annotation=BinOp(left=Name(id='SpladeBenchmarkOptions', ctx=Load(), lineno=1047, col_offset=17, end_lineno=1047, end_col_offset=39), op=BitOr(), right=Constant(value=None, lineno=1047, col_offset=42, end_lineno=1047, end_col_offset=46), lineno=1047, col_offset=17, end_lineno=1047, end_col_offset=46), lineno=1047, col_offset=8, end_lineno=1047, end_col_offset=46)], defaults=[Constant(value=None, lineno=1047, col_offset=49, end_lineno=1047, end_col_offset=53)]), body=[Expr(value=Constant(value='Benchmark SPLADE query encoding latency.\n\n        Parameters\n        ----------\n        queries : Sequence[str]\n            One or more query strings to encode during the benchmark.\n        options : SpladeBenchmarkOptions | None, optional\n            Benchmark configuration overrides. Defaults to :class:`SpladeBenchmarkOptions`.\n\n        Returns\n        -------\n        SpladeBenchmarkSummary\n            Latency statistics captured across the measured iterations.\n\n        Raises\n        ------\n        ValueError\n            Raised when the query list is empty or the benchmark configuration is invalid.\n        ', lineno=1049, col_offset=8, end_lineno=1067, end_col_offset=11), lineno=1049, col_offset=8, end_lineno=1067, end_col_offset=11), Assign(targets=[Name(id='normalised', ctx=Store(), lineno=1068, col_offset=8, end_lineno=1068, end_col_offset=18)], value=ListComp(elt=Call(func=Attribute(value=Name(id='query', ctx=Load(), lineno=1069, col_offset=12, end_lineno=1069, end_col_offset=17), attr='strip', ctx=Load(), lineno=1069, col_offset=12, end_lineno=1069, end_col_offset=23), lineno=1069, col_offset=12, end_lineno=1069, end_col_offset=25), generators=[comprehension(target=Name(id='query', ctx=Store(), lineno=1069, col_offset=30, end_lineno=1069, end_col_offset=35), iter=Name(id='queries', ctx=Load(), lineno=1069, col_offset=39, end_lineno=1069, end_col_offset=46), ifs=[BoolOp(op=And(), values=[Call(func=Name(id='isinstance', ctx=Load(), lineno=1069, col_offset=50, end_lineno=1069, end_col_offset=60), args=[Name(id='query', ctx=Load(), lineno=1069, col_offset=61, end_lineno=1069, end_col_offset=66), Name(id='str', ctx=Load(), lineno=1069, col_offset=68, end_lineno=1069, end_col_offset=71)], lineno=1069, col_offset=50, end_lineno=1069, end_col_offset=72), Call(func=Attribute(value=Name(id='query', ctx=Load(), lineno=1069, col_offset=77, end_lineno=1069, end_col_offset=82), attr='strip', ctx=Load(), lineno=1069, col_offset=77, end_lineno=1069, end_col_offset=88), lineno=1069, col_offset=77, end_lineno=1069, end_col_offset=90)], lineno=1069, col_offset=50, end_lineno=1069, end_col_offset=90)], is_async=0)], lineno=1068, col_offset=21, end_lineno=1070, end_col_offset=9), lineno=1068, col_offset=8, end_lineno=1070, end_col_offset=9), If(test=UnaryOp(op=Not(), operand=Name(id='normalised', ctx=Load(), lineno=1071, col_offset=15, end_lineno=1071, end_col_offset=25), lineno=1071, col_offset=11, end_lineno=1071, end_col_offset=25), body=[Assign(targets=[Name(id='msg', ctx=Store(), lineno=1072, col_offset=12, end_lineno=1072, end_col_offset=15)], value=Constant(value='At least one non-empty query must be provided for benchmarking.', lineno=1072, col_offset=18, end_lineno=1072, end_col_offset=83), lineno=1072, col_offset=12, end_lineno=1072, end_col_offset=83), Raise(exc=Call(func=Name(id='ValueError', ctx=Load(), lineno=1073, col_offset=18, end_lineno=1073, end_col_offset=28), args=[Name(id='msg', ctx=Load(), lineno=1073, col_offset=29, end_lineno=1073, end_col_offset=32)], lineno=1073, col_offset=18, end_lineno=1073, end_col_offset=33), lineno=1073, col_offset=12, end_lineno=1073, end_col_offset=33)], lineno=1071, col_offset=8, end_lineno=1073, end_col_offset=33), Assign(targets=[Name(id='opts', ctx=Store(), lineno=1075, col_offset=8, end_lineno=1075, end_col_offset=12)], value=BoolOp(op=Or(), values=[Name(id='options', ctx=Load(), lineno=1075, col_offset=15, end_lineno=1075, end_col_offset=22), Call(func=Name(id='SpladeBenchmarkOptions', ctx=Load(), lineno=1075, col_offset=26, end_lineno=1075, end_col_offset=48), lineno=1075, col_offset=26, end_lineno=1075, end_col_offset=50)], lineno=1075, col_offset=15, end_lineno=1075, end_col_offset=50), lineno=1075, col_offset=8, end_lineno=1075, end_col_offset=50), If(test=Compare(left=Attribute(value=Name(id='opts', ctx=Load(), lineno=1076, col_offset=11, end_lineno=1076, end_col_offset=15), attr='warmup_iterations', ctx=Load(), lineno=1076, col_offset=11, end_lineno=1076, end_col_offset=33), ops=[Lt()], comparators=[Constant(value=0, lineno=1076, col_offset=36, end_lineno=1076, end_col_offset=37)], lineno=1076, col_offset=11, end_lineno=1076, end_col_offset=37), body=[Assign(targets=[Name(id='msg', ctx=Store(), lineno=1077, col_offset=12, end_lineno=1077, end_col_offset=15)], value=Constant(value='warmup_iterations must be zero or greater.', lineno=1077, col_offset=18, end_lineno=1077, end_col_offset=62), lineno=1077, col_offset=12, end_lineno=1077, end_col_offset=62), Raise(exc=Call(func=Name(id='ValueError', ctx=Load(), lineno=1078, col_offset=18, end_lineno=1078, end_col_offset=28), args=[Name(id='msg', ctx=Load(), lineno=1078, col_offset=29, end_lineno=1078, end_col_offset=32)], lineno=1078, col_offset=18, end_lineno=1078, end_col_offset=33), lineno=1078, col_offset=12, end_lineno=1078, end_col_offset=33)], lineno=1076, col_offset=8, end_lineno=1078, end_col_offset=33), If(test=Compare(left=Attribute(value=Name(id='opts', ctx=Load(), lineno=1079, col_offset=11, end_lineno=1079, end_col_offset=15), attr='measure_iterations', ctx=Load(), lineno=1079, col_offset=11, end_lineno=1079, end_col_offset=34), ops=[Lt()], comparators=[Constant(value=1, lineno=1079, col_offset=37, end_lineno=1079, end_col_offset=38)], lineno=1079, col_offset=11, end_lineno=1079, end_col_offset=38), body=[Assign(targets=[Name(id='msg', ctx=Store(), lineno=1080, col_offset=12, end_lineno=1080, end_col_offset=15)], value=Constant(value='measure_iterations must be at least one.', lineno=1080, col_offset=18, end_lineno=1080, end_col_offset=60), lineno=1080, col_offset=12, end_lineno=1080, end_col_offset=60), Raise(exc=Call(func=Name(id='ValueError', ctx=Load(), lineno=1081, col_offset=18, end_lineno=1081, end_col_offset=28), args=[Name(id='msg', ctx=Load(), lineno=1081, col_offset=29, end_lineno=1081, end_col_offset=32)], lineno=1081, col_offset=18, end_lineno=1081, end_col_offset=33), lineno=1081, col_offset=12, end_lineno=1081, end_col_offset=33)], lineno=1079, col_offset=8, end_lineno=1081, end_col_offset=33), Assign(targets=[Name(id='provider', ctx=Store(), lineno=1083, col_offset=8, end_lineno=1083, end_col_offset=16)], value=BoolOp(op=Or(), values=[Attribute(value=Name(id='opts', ctx=Load(), lineno=1083, col_offset=19, end_lineno=1083, end_col_offset=23), attr='provider', ctx=Load(), lineno=1083, col_offset=19, end_lineno=1083, end_col_offset=32), Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=1083, col_offset=36, end_lineno=1083, end_col_offset=40), attr='_config', ctx=Load(), lineno=1083, col_offset=36, end_lineno=1083, end_col_offset=48), attr='provider', ctx=Load(), lineno=1083, col_offset=36, end_lineno=1083, end_col_offset=57)], lineno=1083, col_offset=19, end_lineno=1083, end_col_offset=57), lineno=1083, col_offset=8, end_lineno=1083, end_col_offset=57), Assign(targets=[Tuple(elts=[Name(id='encoder', ctx=Store(), lineno=1084, col_offset=8, end_lineno=1084, end_col_offset=15), Name(id='selected_relative', ctx=Store(), lineno=1084, col_offset=17, end_lineno=1084, end_col_offset=34)], ctx=Store(), lineno=1084, col_offset=8, end_lineno=1084, end_col_offset=34)], value=Call(func=Attribute(value=Name(id='self', ctx=Load(), lineno=1084, col_offset=37, end_lineno=1084, end_col_offset=41), attr='_initialise_encoder', ctx=Load(), lineno=1084, col_offset=37, end_lineno=1084, end_col_offset=61), keywords=[keyword(arg='provider', value=Name(id='provider', ctx=Load(), lineno=1085, col_offset=21, end_lineno=1085, end_col_offset=29), lineno=1085, col_offset=12, end_lineno=1085, end_col_offset=29), keyword(arg='onnx_file', value=Attribute(value=Name(id='opts', ctx=Load(), lineno=1086, col_offset=22, end_lineno=1086, end_col_offset=26), attr='onnx_file', ctx=Load(), lineno=1086, col_offset=22, end_lineno=1086, end_col_offset=36), lineno=1086, col_offset=12, end_lineno=1086, end_col_offset=36)], lineno=1084, col_offset=37, end_lineno=1087, end_col_offset=9), lineno=1084, col_offset=8, end_lineno=1087, end_col_offset=9), For(target=Name(id='_', ctx=Store(), lineno=1090, col_offset=12, end_lineno=1090, end_col_offset=13), iter=Call(func=Name(id='range', ctx=Load(), lineno=1090, col_offset=17, end_lineno=1090, end_col_offset=22), args=[Attribute(value=Name(id='opts', ctx=Load(), lineno=1090, col_offset=23, end_lineno=1090, end_col_offset=27), attr='warmup_iterations', ctx=Load(), lineno=1090, col_offset=23, end_lineno=1090, end_col_offset=45)], lineno=1090, col_offset=17, end_lineno=1090, end_col_offset=46), body=[Expr(value=Call(func=Attribute(value=Name(id='encoder', ctx=Load(), lineno=1091, col_offset=12, end_lineno=1091, end_col_offset=19), attr='encode_query', ctx=Load(), lineno=1091, col_offset=12, end_lineno=1091, end_col_offset=32), args=[Call(func=Name(id='list', ctx=Load(), lineno=1091, col_offset=33, end_lineno=1091, end_col_offset=37), args=[Name(id='normalised', ctx=Load(), lineno=1091, col_offset=38, end_lineno=1091, end_col_offset=48)], lineno=1091, col_offset=33, end_lineno=1091, end_col_offset=49)], lineno=1091, col_offset=12, end_lineno=1091, end_col_offset=50), lineno=1091, col_offset=12, end_lineno=1091, end_col_offset=50)], lineno=1090, col_offset=8, end_lineno=1091, end_col_offset=50), AnnAssign(target=Name(id='latencies', ctx=Store(), lineno=1093, col_offset=8, end_lineno=1093, end_col_offset=17), annotation=Subscript(value=Name(id='list', ctx=Load(), lineno=1093, col_offset=19, end_lineno=1093, end_col_offset=23), slice=Name(id='float', ctx=Load(), lineno=1093, col_offset=24, end_lineno=1093, end_col_offset=29), ctx=Load(), lineno=1093, col_offset=19, end_lineno=1093, end_col_offset=30), value=List(ctx=Load(), lineno=1093, col_offset=33, end_lineno=1093, end_col_offset=35), simple=1, lineno=1093, col_offset=8, end_lineno=1093, end_col_offset=35), For(target=Name(id='_', ctx=Store(), lineno=1094, col_offset=12, end_lineno=1094, end_col_offset=13), iter=Call(func=Name(id='range', ctx=Load(), lineno=1094, col_offset=17, end_lineno=1094, end_col_offset=22), args=[Attribute(value=Name(id='opts', ctx=Load(), lineno=1094, col_offset=23, end_lineno=1094, end_col_offset=27), attr='measure_iterations', ctx=Load(), lineno=1094, col_offset=23, end_lineno=1094, end_col_offset=46)], lineno=1094, col_offset=17, end_lineno=1094, end_col_offset=47), body=[Assign(targets=[Name(id='start', ctx=Store(), lineno=1095, col_offset=12, end_lineno=1095, end_col_offset=17)], value=Call(func=Name(id='perf_counter', ctx=Load(), lineno=1095, col_offset=20, end_lineno=1095, end_col_offset=32), lineno=1095, col_offset=20, end_lineno=1095, end_col_offset=34), lineno=1095, col_offset=12, end_lineno=1095, end_col_offset=34), Expr(value=Call(func=Attribute(value=Name(id='encoder', ctx=Load(), lineno=1096, col_offset=12, end_lineno=1096, end_col_offset=19), attr='encode_query', ctx=Load(), lineno=1096, col_offset=12, end_lineno=1096, end_col_offset=32), args=[Call(func=Name(id='list', ctx=Load(), lineno=1096, col_offset=33, end_lineno=1096, end_col_offset=37), args=[Name(id='normalised', ctx=Load(), lineno=1096, col_offset=38, end_lineno=1096, end_col_offset=48)], lineno=1096, col_offset=33, end_lineno=1096, end_col_offset=49)], lineno=1096, col_offset=12, end_lineno=1096, end_col_offset=50), lineno=1096, col_offset=12, end_lineno=1096, end_col_offset=50), Assign(targets=[Name(id='elapsed', ctx=Store(), lineno=1097, col_offset=12, end_lineno=1097, end_col_offset=19)], value=BinOp(left=BinOp(left=Call(func=Name(id='perf_counter', ctx=Load(), lineno=1097, col_offset=23, end_lineno=1097, end_col_offset=35), lineno=1097, col_offset=23, end_lineno=1097, end_col_offset=37), op=Sub(), right=Name(id='start', ctx=Load(), lineno=1097, col_offset=40, end_lineno=1097, end_col_offset=45), lineno=1097, col_offset=23, end_lineno=1097, end_col_offset=45), op=Mult(), right=Constant(value=1000.0, lineno=1097, col_offset=49, end_lineno=1097, end_col_offset=55), lineno=1097, col_offset=22, end_lineno=1097, end_col_offset=55), lineno=1097, col_offset=12, end_lineno=1097, end_col_offset=55), Expr(value=Call(func=Attribute(value=Name(id='latencies', ctx=Load(), lineno=1098, col_offset=12, end_lineno=1098, end_col_offset=21), attr='append', ctx=Load(), lineno=1098, col_offset=12, end_lineno=1098, end_col_offset=28), args=[Name(id='elapsed', ctx=Load(), lineno=1098, col_offset=29, end_lineno=1098, end_col_offset=36)], lineno=1098, col_offset=12, end_lineno=1098, end_col_offset=37), lineno=1098, col_offset=12, end_lineno=1098, end_col_offset=37)], lineno=1094, col_offset=8, end_lineno=1098, end_col_offset=37), Expr(value=Call(func=Attribute(value=Name(id='latencies', ctx=Load(), lineno=1100, col_offset=8, end_lineno=1100, end_col_offset=17), attr='sort', ctx=Load(), lineno=1100, col_offset=8, end_lineno=1100, end_col_offset=22), lineno=1100, col_offset=8, end_lineno=1100, end_col_offset=24), lineno=1100, col_offset=8, end_lineno=1100, end_col_offset=24), Assign(targets=[Name(id='summary', ctx=Store(), lineno=1101, col_offset=8, end_lineno=1101, end_col_offset=15)], value=Call(func=Name(id='SpladeBenchmarkSummary', ctx=Load(), lineno=1101, col_offset=18, end_lineno=1101, end_col_offset=40), keywords=[keyword(arg='query_count', value=Call(func=Name(id='len', ctx=Load(), lineno=1102, col_offset=24, end_lineno=1102, end_col_offset=27), args=[Name(id='normalised', ctx=Load(), lineno=1102, col_offset=28, end_lineno=1102, end_col_offset=38)], lineno=1102, col_offset=24, end_lineno=1102, end_col_offset=39), lineno=1102, col_offset=12, end_lineno=1102, end_col_offset=39), keyword(arg='warmup_iterations', value=Attribute(value=Name(id='opts', ctx=Load(), lineno=1103, col_offset=30, end_lineno=1103, end_col_offset=34), attr='warmup_iterations', ctx=Load(), lineno=1103, col_offset=30, end_lineno=1103, end_col_offset=52), lineno=1103, col_offset=12, end_lineno=1103, end_col_offset=52), keyword(arg='measure_iterations', value=Attribute(value=Name(id='opts', ctx=Load(), lineno=1104, col_offset=31, end_lineno=1104, end_col_offset=35), attr='measure_iterations', ctx=Load(), lineno=1104, col_offset=31, end_lineno=1104, end_col_offset=54), lineno=1104, col_offset=12, end_lineno=1104, end_col_offset=54), keyword(arg='min_latency_ms', value=Call(func=Name(id='min', ctx=Load(), lineno=1105, col_offset=27, end_lineno=1105, end_col_offset=30), args=[Name(id='latencies', ctx=Load(), lineno=1105, col_offset=31, end_lineno=1105, end_col_offset=40)], lineno=1105, col_offset=27, end_lineno=1105, end_col_offset=41), lineno=1105, col_offset=12, end_lineno=1105, end_col_offset=41), keyword(arg='max_latency_ms', value=Call(func=Name(id='max', ctx=Load(), lineno=1106, col_offset=27, end_lineno=1106, end_col_offset=30), args=[Name(id='latencies', ctx=Load(), lineno=1106, col_offset=31, end_lineno=1106, end_col_offset=40)], lineno=1106, col_offset=27, end_lineno=1106, end_col_offset=41), lineno=1106, col_offset=12, end_lineno=1106, end_col_offset=41), keyword(arg='mean_latency_ms', value=Call(func=Attribute(value=Name(id='statistics', ctx=Load(), lineno=1107, col_offset=28, end_lineno=1107, end_col_offset=38), attr='fmean', ctx=Load(), lineno=1107, col_offset=28, end_lineno=1107, end_col_offset=44), args=[Name(id='latencies', ctx=Load(), lineno=1107, col_offset=45, end_lineno=1107, end_col_offset=54)], lineno=1107, col_offset=28, end_lineno=1107, end_col_offset=55), lineno=1107, col_offset=12, end_lineno=1107, end_col_offset=55), keyword(arg='p50_latency_ms', value=Call(func=Attribute(value=Name(id='statistics', ctx=Load(), lineno=1108, col_offset=27, end_lineno=1108, end_col_offset=37), attr='median', ctx=Load(), lineno=1108, col_offset=27, end_lineno=1108, end_col_offset=44), args=[Name(id='latencies', ctx=Load(), lineno=1108, col_offset=45, end_lineno=1108, end_col_offset=54)], lineno=1108, col_offset=27, end_lineno=1108, end_col_offset=55), lineno=1108, col_offset=12, end_lineno=1108, end_col_offset=55), keyword(arg='p95_latency_ms', value=Call(func=Name(id='_percentile_value', ctx=Load(), lineno=1109, col_offset=27, end_lineno=1109, end_col_offset=44), args=[Name(id='latencies', ctx=Load(), lineno=1109, col_offset=45, end_lineno=1109, end_col_offset=54), Constant(value=95.0, lineno=1109, col_offset=56, end_lineno=1109, end_col_offset=60)], lineno=1109, col_offset=27, end_lineno=1109, end_col_offset=61), lineno=1109, col_offset=12, end_lineno=1109, end_col_offset=61), keyword(arg='p99_latency_ms', value=Call(func=Name(id='_percentile_value', ctx=Load(), lineno=1110, col_offset=27, end_lineno=1110, end_col_offset=44), args=[Name(id='latencies', ctx=Load(), lineno=1110, col_offset=45, end_lineno=1110, end_col_offset=54), Constant(value=99.0, lineno=1110, col_offset=56, end_lineno=1110, end_col_offset=60)], lineno=1110, col_offset=27, end_lineno=1110, end_col_offset=61), lineno=1110, col_offset=12, end_lineno=1110, end_col_offset=61), keyword(arg='provider', value=Name(id='provider', ctx=Load(), lineno=1111, col_offset=21, end_lineno=1111, end_col_offset=29), lineno=1111, col_offset=12, end_lineno=1111, end_col_offset=29), keyword(arg='onnx_file', value=Name(id='selected_relative', ctx=Load(), lineno=1112, col_offset=22, end_lineno=1112, end_col_offset=39), lineno=1112, col_offset=12, end_lineno=1112, end_col_offset=39)], lineno=1101, col_offset=18, end_lineno=1113, end_col_offset=9), lineno=1101, col_offset=8, end_lineno=1113, end_col_offset=9), Expr(value=Call(func=Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=1115, col_offset=8, end_lineno=1115, end_col_offset=12), attr='_logger', ctx=Load(), lineno=1115, col_offset=8, end_lineno=1115, end_col_offset=20), attr='info', ctx=Load(), lineno=1115, col_offset=8, end_lineno=1115, end_col_offset=25), args=[Constant(value='Benchmarked SPLADE encoder', lineno=1116, col_offset=12, end_lineno=1116, end_col_offset=40)], keywords=[keyword(arg='extra', value=Dict(keys=[Constant(value='query_count', lineno=1118, col_offset=16, end_lineno=1118, end_col_offset=29), Constant(value='warmup_iterations', lineno=1119, col_offset=16, end_lineno=1119, end_col_offset=35), Constant(value='measure_iterations', lineno=1120, col_offset=16, end_lineno=1120, end_col_offset=36), Constant(value='p50_ms', lineno=1121, col_offset=16, end_lineno=1121, end_col_offset=24), Constant(value='p95_ms', lineno=1122, col_offset=16, end_lineno=1122, end_col_offset=24), Constant(value='provider', lineno=1123, col_offset=16, end_lineno=1123, end_col_offset=26)], values=[Attribute(value=Name(id='summary', ctx=Load(), lineno=1118, col_offset=31, end_lineno=1118, end_col_offset=38), attr='query_count', ctx=Load(), lineno=1118, col_offset=31, end_lineno=1118, end_col_offset=50), Attribute(value=Name(id='summary', ctx=Load(), lineno=1119, col_offset=37, end_lineno=1119, end_col_offset=44), attr='warmup_iterations', ctx=Load(), lineno=1119, col_offset=37, end_lineno=1119, end_col_offset=62), Attribute(value=Name(id='summary', ctx=Load(), lineno=1120, col_offset=38, end_lineno=1120, end_col_offset=45), attr='measure_iterations', ctx=Load(), lineno=1120, col_offset=38, end_lineno=1120, end_col_offset=64), Attribute(value=Name(id='summary', ctx=Load(), lineno=1121, col_offset=26, end_lineno=1121, end_col_offset=33), attr='p50_latency_ms', ctx=Load(), lineno=1121, col_offset=26, end_lineno=1121, end_col_offset=48), Attribute(value=Name(id='summary', ctx=Load(), lineno=1122, col_offset=26, end_lineno=1122, end_col_offset=33), attr='p95_latency_ms', ctx=Load(), lineno=1122, col_offset=26, end_lineno=1122, end_col_offset=48), Attribute(value=Name(id='summary', ctx=Load(), lineno=1123, col_offset=28, end_lineno=1123, end_col_offset=35), attr='provider', ctx=Load(), lineno=1123, col_offset=28, end_lineno=1123, end_col_offset=44)], lineno=1117, col_offset=18, end_lineno=1124, end_col_offset=13), lineno=1117, col_offset=12, end_lineno=1124, end_col_offset=13)], lineno=1115, col_offset=8, end_lineno=1125, end_col_offset=9), lineno=1115, col_offset=8, end_lineno=1125, end_col_offset=9), Return(value=Name(id='summary', ctx=Load(), lineno=1127, col_offset=15, end_lineno=1127, end_col_offset=22), lineno=1127, col_offset=8, end_lineno=1127, end_col_offset=22)], returns=Name(id='SpladeBenchmarkSummary', ctx=Load(), lineno=1048, col_offset=9, end_lineno=1048, end_col_offset=31), lineno=1044, col_offset=4, end_lineno=1127, end_col_offset=22)], lineno=849, col_offset=0, end_lineno=1127, end_col_offset=22), ClassDef(name='SpladeIndexManager', body=[Expr(value=Constant(value='Build SPLADE Lucene impact indexes from vector collections.', lineno=1131, col_offset=4, end_lineno=1131, end_col_offset=69), lineno=1131, col_offset=4, end_lineno=1131, end_col_offset=69), FunctionDef(name='__init__', args=arguments(args=[arg(arg='self', lineno=1133, col_offset=17, end_lineno=1133, end_col_offset=21), arg(arg='settings', annotation=Name(id='Settings', ctx=Load(), lineno=1133, col_offset=33, end_lineno=1133, end_col_offset=41), lineno=1133, col_offset=23, end_lineno=1133, end_col_offset=41)], kwonlyargs=[arg(arg='logger_', annotation=BinOp(left=Attribute(value=Name(id='logging', ctx=Load(), lineno=1133, col_offset=55, end_lineno=1133, end_col_offset=62), attr='Logger', ctx=Load(), lineno=1133, col_offset=55, end_lineno=1133, end_col_offset=69), op=BitOr(), right=Constant(value=None, lineno=1133, col_offset=72, end_lineno=1133, end_col_offset=76), lineno=1133, col_offset=55, end_lineno=1133, end_col_offset=76), lineno=1133, col_offset=46, end_lineno=1133, end_col_offset=76)], kw_defaults=[Constant(value=None, lineno=1133, col_offset=79, end_lineno=1133, end_col_offset=83)]), body=[Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=1134, col_offset=8, end_lineno=1134, end_col_offset=12), attr='_settings', ctx=Store(), lineno=1134, col_offset=8, end_lineno=1134, end_col_offset=22)], value=Name(id='settings', ctx=Load(), lineno=1134, col_offset=25, end_lineno=1134, end_col_offset=33), lineno=1134, col_offset=8, end_lineno=1134, end_col_offset=33), Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=1135, col_offset=8, end_lineno=1135, end_col_offset=12), attr='_logger', ctx=Store(), lineno=1135, col_offset=8, end_lineno=1135, end_col_offset=20)], value=BoolOp(op=Or(), values=[Name(id='logger_', ctx=Load(), lineno=1135, col_offset=23, end_lineno=1135, end_col_offset=30), Call(func=Attribute(value=Name(id='logging', ctx=Load(), lineno=1135, col_offset=34, end_lineno=1135, end_col_offset=41), attr='getLogger', ctx=Load(), lineno=1135, col_offset=34, end_lineno=1135, end_col_offset=51), args=[Name(id='__name__', ctx=Load(), lineno=1135, col_offset=52, end_lineno=1135, end_col_offset=60)], lineno=1135, col_offset=34, end_lineno=1135, end_col_offset=61)], lineno=1135, col_offset=23, end_lineno=1135, end_col_offset=61), lineno=1135, col_offset=8, end_lineno=1135, end_col_offset=61), Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=1136, col_offset=8, end_lineno=1136, end_col_offset=12), attr='_repo_root', ctx=Store(), lineno=1136, col_offset=8, end_lineno=1136, end_col_offset=23)], value=Call(func=Attribute(value=Call(func=Attribute(value=Call(func=Name(id='Path', ctx=Load(), lineno=1136, col_offset=26, end_lineno=1136, end_col_offset=30), args=[Attribute(value=Attribute(value=Name(id='settings', ctx=Load(), lineno=1136, col_offset=31, end_lineno=1136, end_col_offset=39), attr='paths', ctx=Load(), lineno=1136, col_offset=31, end_lineno=1136, end_col_offset=45), attr='repo_root', ctx=Load(), lineno=1136, col_offset=31, end_lineno=1136, end_col_offset=55)], lineno=1136, col_offset=26, end_lineno=1136, end_col_offset=56), attr='expanduser', ctx=Load(), lineno=1136, col_offset=26, end_lineno=1136, end_col_offset=67), lineno=1136, col_offset=26, end_lineno=1136, end_col_offset=69), attr='resolve', ctx=Load(), lineno=1136, col_offset=26, end_lineno=1136, end_col_offset=77), lineno=1136, col_offset=26, end_lineno=1136, end_col_offset=79), lineno=1136, col_offset=8, end_lineno=1136, end_col_offset=79), Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=1137, col_offset=8, end_lineno=1137, end_col_offset=12), attr='_config', ctx=Store(), lineno=1137, col_offset=8, end_lineno=1137, end_col_offset=20)], value=Attribute(value=Name(id='settings', ctx=Load(), lineno=1137, col_offset=23, end_lineno=1137, end_col_offset=31), attr='splade', ctx=Load(), lineno=1137, col_offset=23, end_lineno=1137, end_col_offset=38), lineno=1137, col_offset=8, end_lineno=1137, end_col_offset=38)], returns=Constant(value=None, lineno=1133, col_offset=88, end_lineno=1133, end_col_offset=92), lineno=1133, col_offset=4, end_lineno=1137, end_col_offset=38), FunctionDef(name='vectors_dir', args=arguments(args=[arg(arg='self', lineno=1140, col_offset=20, end_lineno=1140, end_col_offset=24)]), body=[Expr(value=Constant(value='Return the configured JsonVectorCollection directory.\n\n        Returns\n        -------\n        Path\n            Absolute path to the JsonVectorCollection directory used for indexing.\n        ', lineno=1141, col_offset=8, end_lineno=1147, end_col_offset=11), lineno=1141, col_offset=8, end_lineno=1147, end_col_offset=11), Return(value=Call(func=Name(id='resolve_within_repo', ctx=Load(), lineno=1148, col_offset=15, end_lineno=1148, end_col_offset=34), args=[Attribute(value=Name(id='self', ctx=Load(), lineno=1148, col_offset=35, end_lineno=1148, end_col_offset=39), attr='_repo_root', ctx=Load(), lineno=1148, col_offset=35, end_lineno=1148, end_col_offset=50), Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=1148, col_offset=52, end_lineno=1148, end_col_offset=56), attr='_config', ctx=Load(), lineno=1148, col_offset=52, end_lineno=1148, end_col_offset=64), attr='vectors_dir', ctx=Load(), lineno=1148, col_offset=52, end_lineno=1148, end_col_offset=76)], lineno=1148, col_offset=15, end_lineno=1148, end_col_offset=77), lineno=1148, col_offset=8, end_lineno=1148, end_col_offset=77)], decorator_list=[Name(id='property', ctx=Load(), lineno=1139, col_offset=5, end_lineno=1139, end_col_offset=13)], returns=Name(id='Path', ctx=Load(), lineno=1140, col_offset=29, end_lineno=1140, end_col_offset=33), lineno=1140, col_offset=4, end_lineno=1148, end_col_offset=77), FunctionDef(name='index_dir', args=arguments(args=[arg(arg='self', lineno=1151, col_offset=18, end_lineno=1151, end_col_offset=22)]), body=[Expr(value=Constant(value='Return the configured Lucene impact index directory.\n\n        Returns\n        -------\n        Path\n            Absolute path to the Lucene impact index output directory.\n        ', lineno=1152, col_offset=8, end_lineno=1158, end_col_offset=11), lineno=1152, col_offset=8, end_lineno=1158, end_col_offset=11), Return(value=Call(func=Name(id='resolve_within_repo', ctx=Load(), lineno=1159, col_offset=15, end_lineno=1159, end_col_offset=34), args=[Attribute(value=Name(id='self', ctx=Load(), lineno=1159, col_offset=35, end_lineno=1159, end_col_offset=39), attr='_repo_root', ctx=Load(), lineno=1159, col_offset=35, end_lineno=1159, end_col_offset=50), Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=1159, col_offset=52, end_lineno=1159, end_col_offset=56), attr='_config', ctx=Load(), lineno=1159, col_offset=52, end_lineno=1159, end_col_offset=64), attr='index_dir', ctx=Load(), lineno=1159, col_offset=52, end_lineno=1159, end_col_offset=74)], lineno=1159, col_offset=15, end_lineno=1159, end_col_offset=75), lineno=1159, col_offset=8, end_lineno=1159, end_col_offset=75)], decorator_list=[Name(id='property', ctx=Load(), lineno=1150, col_offset=5, end_lineno=1150, end_col_offset=13)], returns=Name(id='Path', ctx=Load(), lineno=1151, col_offset=27, end_lineno=1151, end_col_offset=31), lineno=1151, col_offset=4, end_lineno=1159, end_col_offset=75), FunctionDef(name='build_index', args=arguments(args=[arg(arg='self', lineno=1161, col_offset=20, end_lineno=1161, end_col_offset=24), arg(arg='options', annotation=BinOp(left=Name(id='SpladeBuildOptions', ctx=Load(), lineno=1161, col_offset=35, end_lineno=1161, end_col_offset=53), op=BitOr(), right=Constant(value=None, lineno=1161, col_offset=56, end_lineno=1161, end_col_offset=60), lineno=1161, col_offset=35, end_lineno=1161, end_col_offset=60), lineno=1161, col_offset=26, end_lineno=1161, end_col_offset=60)], defaults=[Constant(value=None, lineno=1161, col_offset=63, end_lineno=1161, end_col_offset=67)]), body=[Expr(value=Constant(value='Invoke Pyserini to build a SPLADE Lucene impact index.\n\n        Parameters\n        ----------\n        options : SpladeBuildOptions | None, optional\n            Overrides for vectors/index directories, thread count, clause limit, and overwrite.\n\n        Returns\n        -------\n        SpladeIndexMetadata\n            Metadata describing the resulting Lucene impact index.\n\n        Raises\n        ------\n        FileExistsError\n            If the index directory already exists and ``overwrite`` is ``False``.\n        ', lineno=1162, col_offset=8, end_lineno=1178, end_col_offset=11), lineno=1162, col_offset=8, end_lineno=1178, end_col_offset=11), Assign(targets=[Name(id='options', ctx=Store(), lineno=1179, col_offset=8, end_lineno=1179, end_col_offset=15)], value=BoolOp(op=Or(), values=[Name(id='options', ctx=Load(), lineno=1179, col_offset=18, end_lineno=1179, end_col_offset=25), Call(func=Name(id='SpladeBuildOptions', ctx=Load(), lineno=1179, col_offset=29, end_lineno=1179, end_col_offset=47), lineno=1179, col_offset=29, end_lineno=1179, end_col_offset=49)], lineno=1179, col_offset=18, end_lineno=1179, end_col_offset=49), lineno=1179, col_offset=8, end_lineno=1179, end_col_offset=49), Assign(targets=[Name(id='vectors_dir', ctx=Store(), lineno=1180, col_offset=8, end_lineno=1180, end_col_offset=19)], value=IfExp(test=Compare(left=Attribute(value=Name(id='options', ctx=Load(), lineno=1182, col_offset=15, end_lineno=1182, end_col_offset=22), attr='vectors_dir', ctx=Load(), lineno=1182, col_offset=15, end_lineno=1182, end_col_offset=34), ops=[IsNot()], comparators=[Constant(value=None, lineno=1182, col_offset=42, end_lineno=1182, end_col_offset=46)], lineno=1182, col_offset=15, end_lineno=1182, end_col_offset=46), body=Call(func=Name(id='resolve_within_repo', ctx=Load(), lineno=1181, col_offset=12, end_lineno=1181, end_col_offset=31), args=[Attribute(value=Name(id='self', ctx=Load(), lineno=1181, col_offset=32, end_lineno=1181, end_col_offset=36), attr='_repo_root', ctx=Load(), lineno=1181, col_offset=32, end_lineno=1181, end_col_offset=47), Attribute(value=Name(id='options', ctx=Load(), lineno=1181, col_offset=49, end_lineno=1181, end_col_offset=56), attr='vectors_dir', ctx=Load(), lineno=1181, col_offset=49, end_lineno=1181, end_col_offset=68)], lineno=1181, col_offset=12, end_lineno=1181, end_col_offset=69), orelse=Attribute(value=Name(id='self', ctx=Load(), lineno=1183, col_offset=17, end_lineno=1183, end_col_offset=21), attr='vectors_dir', ctx=Load(), lineno=1183, col_offset=17, end_lineno=1183, end_col_offset=33), lineno=1181, col_offset=12, end_lineno=1183, end_col_offset=33), lineno=1180, col_offset=8, end_lineno=1184, end_col_offset=9), Assign(targets=[Name(id='index_dir', ctx=Store(), lineno=1185, col_offset=8, end_lineno=1185, end_col_offset=17)], value=IfExp(test=Compare(left=Attribute(value=Name(id='options', ctx=Load(), lineno=1187, col_offset=15, end_lineno=1187, end_col_offset=22), attr='index_dir', ctx=Load(), lineno=1187, col_offset=15, end_lineno=1187, end_col_offset=32), ops=[IsNot()], comparators=[Constant(value=None, lineno=1187, col_offset=40, end_lineno=1187, end_col_offset=44)], lineno=1187, col_offset=15, end_lineno=1187, end_col_offset=44), body=Call(func=Name(id='resolve_within_repo', ctx=Load(), lineno=1186, col_offset=12, end_lineno=1186, end_col_offset=31), args=[Attribute(value=Name(id='self', ctx=Load(), lineno=1186, col_offset=32, end_lineno=1186, end_col_offset=36), attr='_repo_root', ctx=Load(), lineno=1186, col_offset=32, end_lineno=1186, end_col_offset=47), Attribute(value=Name(id='options', ctx=Load(), lineno=1186, col_offset=49, end_lineno=1186, end_col_offset=56), attr='index_dir', ctx=Load(), lineno=1186, col_offset=49, end_lineno=1186, end_col_offset=66)], lineno=1186, col_offset=12, end_lineno=1186, end_col_offset=67), orelse=Attribute(value=Name(id='self', ctx=Load(), lineno=1188, col_offset=17, end_lineno=1188, end_col_offset=21), attr='index_dir', ctx=Load(), lineno=1188, col_offset=17, end_lineno=1188, end_col_offset=31), lineno=1186, col_offset=12, end_lineno=1188, end_col_offset=31), lineno=1185, col_offset=8, end_lineno=1189, end_col_offset=9), Expr(value=Call(func=Attribute(value=Attribute(value=Name(id='index_dir', ctx=Load(), lineno=1190, col_offset=8, end_lineno=1190, end_col_offset=17), attr='parent', ctx=Load(), lineno=1190, col_offset=8, end_lineno=1190, end_col_offset=24), attr='mkdir', ctx=Load(), lineno=1190, col_offset=8, end_lineno=1190, end_col_offset=30), keywords=[keyword(arg='parents', value=Constant(value=True, lineno=1190, col_offset=39, end_lineno=1190, end_col_offset=43), lineno=1190, col_offset=31, end_lineno=1190, end_col_offset=43), keyword(arg='exist_ok', value=Constant(value=True, lineno=1190, col_offset=54, end_lineno=1190, end_col_offset=58), lineno=1190, col_offset=45, end_lineno=1190, end_col_offset=58)], lineno=1190, col_offset=8, end_lineno=1190, end_col_offset=59), lineno=1190, col_offset=8, end_lineno=1190, end_col_offset=59), Assign(targets=[Name(id='threads', ctx=Store(), lineno=1191, col_offset=8, end_lineno=1191, end_col_offset=15)], value=BoolOp(op=Or(), values=[Attribute(value=Name(id='options', ctx=Load(), lineno=1191, col_offset=18, end_lineno=1191, end_col_offset=25), attr='threads', ctx=Load(), lineno=1191, col_offset=18, end_lineno=1191, end_col_offset=33), Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=1191, col_offset=37, end_lineno=1191, end_col_offset=41), attr='_config', ctx=Load(), lineno=1191, col_offset=37, end_lineno=1191, end_col_offset=49), attr='threads', ctx=Load(), lineno=1191, col_offset=37, end_lineno=1191, end_col_offset=57)], lineno=1191, col_offset=18, end_lineno=1191, end_col_offset=57), lineno=1191, col_offset=8, end_lineno=1191, end_col_offset=57), Assign(targets=[Name(id='max_clause', ctx=Store(), lineno=1192, col_offset=8, end_lineno=1192, end_col_offset=18)], value=BoolOp(op=Or(), values=[Attribute(value=Name(id='options', ctx=Load(), lineno=1192, col_offset=21, end_lineno=1192, end_col_offset=28), attr='max_clause_count', ctx=Load(), lineno=1192, col_offset=21, end_lineno=1192, end_col_offset=45), Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=1192, col_offset=49, end_lineno=1192, end_col_offset=53), attr='_config', ctx=Load(), lineno=1192, col_offset=49, end_lineno=1192, end_col_offset=61), attr='max_clause_count', ctx=Load(), lineno=1192, col_offset=49, end_lineno=1192, end_col_offset=78)], lineno=1192, col_offset=21, end_lineno=1192, end_col_offset=78), lineno=1192, col_offset=8, end_lineno=1192, end_col_offset=78), If(test=BoolOp(op=And(), values=[Call(func=Attribute(value=Name(id='index_dir', ctx=Load(), lineno=1194, col_offset=11, end_lineno=1194, end_col_offset=20), attr='exists', ctx=Load(), lineno=1194, col_offset=11, end_lineno=1194, end_col_offset=27), lineno=1194, col_offset=11, end_lineno=1194, end_col_offset=29), Attribute(value=Name(id='options', ctx=Load(), lineno=1194, col_offset=34, end_lineno=1194, end_col_offset=41), attr='overwrite', ctx=Load(), lineno=1194, col_offset=34, end_lineno=1194, end_col_offset=51)], lineno=1194, col_offset=11, end_lineno=1194, end_col_offset=51), body=[Expr(value=Call(func=Attribute(value=Name(id='shutil', ctx=Load(), lineno=1195, col_offset=12, end_lineno=1195, end_col_offset=18), attr='rmtree', ctx=Load(), lineno=1195, col_offset=12, end_lineno=1195, end_col_offset=25), args=[Name(id='index_dir', ctx=Load(), lineno=1195, col_offset=26, end_lineno=1195, end_col_offset=35)], lineno=1195, col_offset=12, end_lineno=1195, end_col_offset=36), lineno=1195, col_offset=12, end_lineno=1195, end_col_offset=36)], orelse=[If(test=Call(func=Attribute(value=Name(id='index_dir', ctx=Load(), lineno=1196, col_offset=13, end_lineno=1196, end_col_offset=22), attr='exists', ctx=Load(), lineno=1196, col_offset=13, end_lineno=1196, end_col_offset=29), lineno=1196, col_offset=13, end_lineno=1196, end_col_offset=31), body=[Assign(targets=[Name(id='msg', ctx=Store(), lineno=1197, col_offset=12, end_lineno=1197, end_col_offset=15)], value=JoinedStr(values=[Constant(value='Index directory ', lineno=1197, col_offset=20, end_lineno=1197, end_col_offset=36), FormattedValue(value=Name(id='index_dir', ctx=Load(), lineno=1197, col_offset=37, end_lineno=1197, end_col_offset=46), conversion=-1, lineno=1197, col_offset=36, end_lineno=1197, end_col_offset=47), Constant(value=' already exists and overwrite is disabled.', lineno=1197, col_offset=47, end_lineno=1197, end_col_offset=89)], lineno=1197, col_offset=18, end_lineno=1197, end_col_offset=90), lineno=1197, col_offset=12, end_lineno=1197, end_col_offset=90), Raise(exc=Call(func=Name(id='FileExistsError', ctx=Load(), lineno=1198, col_offset=18, end_lineno=1198, end_col_offset=33), args=[Name(id='msg', ctx=Load(), lineno=1198, col_offset=34, end_lineno=1198, end_col_offset=37)], lineno=1198, col_offset=18, end_lineno=1198, end_col_offset=38), lineno=1198, col_offset=12, end_lineno=1198, end_col_offset=38)], lineno=1196, col_offset=8, end_lineno=1198, end_col_offset=38)], lineno=1194, col_offset=8, end_lineno=1198, end_col_offset=38), Assign(targets=[Name(id='env_overrides', ctx=Store(), lineno=1200, col_offset=8, end_lineno=1200, end_col_offset=21)], value=Call(func=Attribute(value=Attribute(value=Name(id='os', ctx=Load(), lineno=1200, col_offset=24, end_lineno=1200, end_col_offset=26), attr='environ', ctx=Load(), lineno=1200, col_offset=24, end_lineno=1200, end_col_offset=34), attr='copy', ctx=Load(), lineno=1200, col_offset=24, end_lineno=1200, end_col_offset=39), lineno=1200, col_offset=24, end_lineno=1200, end_col_offset=41), lineno=1200, col_offset=8, end_lineno=1200, end_col_offset=41), Expr(value=Call(func=Attribute(value=Name(id='env_overrides', ctx=Load(), lineno=1201, col_offset=8, end_lineno=1201, end_col_offset=21), attr='setdefault', ctx=Load(), lineno=1201, col_offset=8, end_lineno=1201, end_col_offset=32), args=[Constant(value='JAVA_TOOL_OPTIONS', lineno=1202, col_offset=12, end_lineno=1202, end_col_offset=31), JoinedStr(values=[Constant(value='-Dorg.apache.lucene.maxClauseCount=', lineno=1203, col_offset=14, end_lineno=1203, end_col_offset=49), FormattedValue(value=Name(id='max_clause', ctx=Load(), lineno=1203, col_offset=50, end_lineno=1203, end_col_offset=60), conversion=-1, lineno=1203, col_offset=49, end_lineno=1203, end_col_offset=61)], lineno=1203, col_offset=12, end_lineno=1203, end_col_offset=62)], lineno=1201, col_offset=8, end_lineno=1204, end_col_offset=9), lineno=1201, col_offset=8, end_lineno=1204, end_col_offset=9), Assign(targets=[Name(id='cmd', ctx=Store(), lineno=1206, col_offset=8, end_lineno=1206, end_col_offset=11)], value=List(elts=[Call(func=Attribute(value=Name(id='os', ctx=Load(), lineno=1207, col_offset=12, end_lineno=1207, end_col_offset=14), attr='fspath', ctx=Load(), lineno=1207, col_offset=12, end_lineno=1207, end_col_offset=21), args=[Call(func=Name(id='Path', ctx=Load(), lineno=1207, col_offset=22, end_lineno=1207, end_col_offset=26), args=[Attribute(value=Name(id='sys', ctx=Load(), lineno=1207, col_offset=27, end_lineno=1207, end_col_offset=30), attr='executable', ctx=Load(), lineno=1207, col_offset=27, end_lineno=1207, end_col_offset=41)], lineno=1207, col_offset=22, end_lineno=1207, end_col_offset=42)], lineno=1207, col_offset=12, end_lineno=1207, end_col_offset=43), Constant(value='-m', lineno=1208, col_offset=12, end_lineno=1208, end_col_offset=16), Constant(value='pyserini.index.lucene', lineno=1209, col_offset=12, end_lineno=1209, end_col_offset=35), Constant(value='--collection', lineno=1210, col_offset=12, end_lineno=1210, end_col_offset=26), Constant(value='JsonVectorCollection', lineno=1211, col_offset=12, end_lineno=1211, end_col_offset=34), Constant(value='--input', lineno=1212, col_offset=12, end_lineno=1212, end_col_offset=21), Call(func=Name(id='str', ctx=Load(), lineno=1213, col_offset=12, end_lineno=1213, end_col_offset=15), args=[Name(id='vectors_dir', ctx=Load(), lineno=1213, col_offset=16, end_lineno=1213, end_col_offset=27)], lineno=1213, col_offset=12, end_lineno=1213, end_col_offset=28), Constant(value='--index', lineno=1214, col_offset=12, end_lineno=1214, end_col_offset=21), Call(func=Name(id='str', ctx=Load(), lineno=1215, col_offset=12, end_lineno=1215, end_col_offset=15), args=[Name(id='index_dir', ctx=Load(), lineno=1215, col_offset=16, end_lineno=1215, end_col_offset=25)], lineno=1215, col_offset=12, end_lineno=1215, end_col_offset=26), Constant(value='--generator', lineno=1216, col_offset=12, end_lineno=1216, end_col_offset=25), Constant(value='DefaultLuceneDocumentGenerator', lineno=1217, col_offset=12, end_lineno=1217, end_col_offset=44), Constant(value='--threads', lineno=1218, col_offset=12, end_lineno=1218, end_col_offset=23), Call(func=Name(id='str', ctx=Load(), lineno=1219, col_offset=12, end_lineno=1219, end_col_offset=15), args=[Name(id='threads', ctx=Load(), lineno=1219, col_offset=16, end_lineno=1219, end_col_offset=23)], lineno=1219, col_offset=12, end_lineno=1219, end_col_offset=24), Constant(value='--impact', lineno=1220, col_offset=12, end_lineno=1220, end_col_offset=22), Constant(value='--pretokenized', lineno=1221, col_offset=12, end_lineno=1221, end_col_offset=28), Constant(value='--optimize', lineno=1222, col_offset=12, end_lineno=1222, end_col_offset=24)], ctx=Load(), lineno=1206, col_offset=14, end_lineno=1223, end_col_offset=9), lineno=1206, col_offset=8, end_lineno=1223, end_col_offset=9), Expr(value=Call(func=Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=1225, col_offset=8, end_lineno=1225, end_col_offset=12), attr='_logger', ctx=Load(), lineno=1225, col_offset=8, end_lineno=1225, end_col_offset=20), attr='info', ctx=Load(), lineno=1225, col_offset=8, end_lineno=1225, end_col_offset=25), args=[Constant(value='Building SPLADE impact index', lineno=1226, col_offset=12, end_lineno=1226, end_col_offset=42)], keywords=[keyword(arg='extra', value=Dict(keys=[Constant(value='vectors_dir', lineno=1228, col_offset=16, end_lineno=1228, end_col_offset=29), Constant(value='index_dir', lineno=1229, col_offset=16, end_lineno=1229, end_col_offset=27), Constant(value='threads', lineno=1230, col_offset=16, end_lineno=1230, end_col_offset=25), Constant(value='max_clause_count', lineno=1231, col_offset=16, end_lineno=1231, end_col_offset=34)], values=[Call(func=Name(id='str', ctx=Load(), lineno=1228, col_offset=31, end_lineno=1228, end_col_offset=34), args=[Name(id='vectors_dir', ctx=Load(), lineno=1228, col_offset=35, end_lineno=1228, end_col_offset=46)], lineno=1228, col_offset=31, end_lineno=1228, end_col_offset=47), Call(func=Name(id='str', ctx=Load(), lineno=1229, col_offset=29, end_lineno=1229, end_col_offset=32), args=[Name(id='index_dir', ctx=Load(), lineno=1229, col_offset=33, end_lineno=1229, end_col_offset=42)], lineno=1229, col_offset=29, end_lineno=1229, end_col_offset=43), Name(id='threads', ctx=Load(), lineno=1230, col_offset=27, end_lineno=1230, end_col_offset=34), Name(id='max_clause', ctx=Load(), lineno=1231, col_offset=36, end_lineno=1231, end_col_offset=46)], lineno=1227, col_offset=18, end_lineno=1232, end_col_offset=13), lineno=1227, col_offset=12, end_lineno=1232, end_col_offset=13)], lineno=1225, col_offset=8, end_lineno=1233, end_col_offset=9), lineno=1225, col_offset=8, end_lineno=1233, end_col_offset=9), Expr(value=Call(func=Name(id='run_subprocess', ctx=Load(), lineno=1234, col_offset=8, end_lineno=1234, end_col_offset=22), args=[Name(id='cmd', ctx=Load(), lineno=1234, col_offset=23, end_lineno=1234, end_col_offset=26)], keywords=[keyword(arg='env', value=Name(id='env_overrides', ctx=Load(), lineno=1234, col_offset=32, end_lineno=1234, end_col_offset=45), lineno=1234, col_offset=28, end_lineno=1234, end_col_offset=45)], lineno=1234, col_offset=8, end_lineno=1234, end_col_offset=46), lineno=1234, col_offset=8, end_lineno=1234, end_col_offset=46), Assign(targets=[Name(id='metadata_path', ctx=Store(), lineno=1236, col_offset=8, end_lineno=1236, end_col_offset=21)], value=BinOp(left=Name(id='vectors_dir', ctx=Load(), lineno=1236, col_offset=24, end_lineno=1236, end_col_offset=35), op=Div(), right=Name(id='ENCODING_METADATA_FILENAME', ctx=Load(), lineno=1236, col_offset=38, end_lineno=1236, end_col_offset=64), lineno=1236, col_offset=24, end_lineno=1236, end_col_offset=64), lineno=1236, col_offset=8, end_lineno=1236, end_col_offset=64), Assign(targets=[Name(id='corpus_digest', ctx=Store(), lineno=1237, col_offset=8, end_lineno=1237, end_col_offset=21)], value=Constant(value=None, lineno=1237, col_offset=24, end_lineno=1237, end_col_offset=28), lineno=1237, col_offset=8, end_lineno=1237, end_col_offset=28), AnnAssign(target=Name(id='doc_count', ctx=Store(), lineno=1238, col_offset=8, end_lineno=1238, end_col_offset=17), annotation=BinOp(left=Name(id='int', ctx=Load(), lineno=1238, col_offset=19, end_lineno=1238, end_col_offset=22), op=BitOr(), right=Constant(value=None, lineno=1238, col_offset=25, end_lineno=1238, end_col_offset=29), lineno=1238, col_offset=19, end_lineno=1238, end_col_offset=29), value=Constant(value=None, lineno=1238, col_offset=32, end_lineno=1238, end_col_offset=36), simple=1, lineno=1238, col_offset=8, end_lineno=1238, end_col_offset=36), If(test=Call(func=Attribute(value=Name(id='metadata_path', ctx=Load(), lineno=1239, col_offset=11, end_lineno=1239, end_col_offset=24), attr='exists', ctx=Load(), lineno=1239, col_offset=11, end_lineno=1239, end_col_offset=31), lineno=1239, col_offset=11, end_lineno=1239, end_col_offset=33), body=[Assign(targets=[Name(id='metadata', ctx=Store(), lineno=1240, col_offset=12, end_lineno=1240, end_col_offset=20)], value=Call(func=Attribute(value=Attribute(value=Name(id='msgspec', ctx=Load(), lineno=1240, col_offset=23, end_lineno=1240, end_col_offset=30), attr='json', ctx=Load(), lineno=1240, col_offset=23, end_lineno=1240, end_col_offset=35), attr='decode', ctx=Load(), lineno=1240, col_offset=23, end_lineno=1240, end_col_offset=42), args=[Call(func=Attribute(value=Name(id='metadata_path', ctx=Load(), lineno=1240, col_offset=43, end_lineno=1240, end_col_offset=56), attr='read_bytes', ctx=Load(), lineno=1240, col_offset=43, end_lineno=1240, end_col_offset=67), lineno=1240, col_offset=43, end_lineno=1240, end_col_offset=69)], keywords=[keyword(arg='type', value=Name(id='SpladeEncodingMetadata', ctx=Load(), lineno=1240, col_offset=76, end_lineno=1240, end_col_offset=98), lineno=1240, col_offset=71, end_lineno=1240, end_col_offset=98)], lineno=1240, col_offset=23, end_lineno=1240, end_col_offset=99), lineno=1240, col_offset=12, end_lineno=1240, end_col_offset=99), Assign(targets=[Name(id='doc_count', ctx=Store(), lineno=1241, col_offset=12, end_lineno=1241, end_col_offset=21)], value=Attribute(value=Name(id='metadata', ctx=Load(), lineno=1241, col_offset=24, end_lineno=1241, end_col_offset=32), attr='doc_count', ctx=Load(), lineno=1241, col_offset=24, end_lineno=1241, end_col_offset=42), lineno=1241, col_offset=12, end_lineno=1241, end_col_offset=42), Assign(targets=[Name(id='corpus_digest', ctx=Store(), lineno=1242, col_offset=12, end_lineno=1242, end_col_offset=25)], value=Attribute(value=Name(id='metadata', ctx=Load(), lineno=1242, col_offset=28, end_lineno=1242, end_col_offset=36), attr='source_path', ctx=Load(), lineno=1242, col_offset=28, end_lineno=1242, end_col_offset=48), lineno=1242, col_offset=12, end_lineno=1242, end_col_offset=48)], lineno=1239, col_offset=8, end_lineno=1242, end_col_offset=48), Assign(targets=[Name(id='pyserini_version', ctx=Store(), lineno=1243, col_offset=8, end_lineno=1243, end_col_offset=24)], value=Call(func=Name(id='_detect_pyserini_version', ctx=Load(), lineno=1243, col_offset=27, end_lineno=1243, end_col_offset=51), lineno=1243, col_offset=27, end_lineno=1243, end_col_offset=53), lineno=1243, col_offset=8, end_lineno=1243, end_col_offset=53), Assign(targets=[Name(id='index_metadata', ctx=Store(), lineno=1244, col_offset=8, end_lineno=1244, end_col_offset=22)], value=Call(func=Name(id='SpladeIndexMetadata', ctx=Load(), lineno=1244, col_offset=25, end_lineno=1244, end_col_offset=44), keywords=[keyword(arg='doc_count', value=Name(id='doc_count', ctx=Load(), lineno=1245, col_offset=22, end_lineno=1245, end_col_offset=31), lineno=1245, col_offset=12, end_lineno=1245, end_col_offset=31), keyword(arg='built_at', value=Call(func=Attribute(value=Call(func=Attribute(value=Name(id='datetime', ctx=Load(), lineno=1246, col_offset=21, end_lineno=1246, end_col_offset=29), attr='now', ctx=Load(), lineno=1246, col_offset=21, end_lineno=1246, end_col_offset=33), args=[Name(id='UTC', ctx=Load(), lineno=1246, col_offset=34, end_lineno=1246, end_col_offset=37)], lineno=1246, col_offset=21, end_lineno=1246, end_col_offset=38), attr='isoformat', ctx=Load(), lineno=1246, col_offset=21, end_lineno=1246, end_col_offset=48), lineno=1246, col_offset=21, end_lineno=1246, end_col_offset=50), lineno=1246, col_offset=12, end_lineno=1246, end_col_offset=50), keyword(arg='vectors_dir', value=Call(func=Name(id='str', ctx=Load(), lineno=1247, col_offset=24, end_lineno=1247, end_col_offset=27), args=[Name(id='vectors_dir', ctx=Load(), lineno=1247, col_offset=28, end_lineno=1247, end_col_offset=39)], lineno=1247, col_offset=24, end_lineno=1247, end_col_offset=40), lineno=1247, col_offset=12, end_lineno=1247, end_col_offset=40), keyword(arg='corpus_digest', value=Name(id='corpus_digest', ctx=Load(), lineno=1248, col_offset=26, end_lineno=1248, end_col_offset=39), lineno=1248, col_offset=12, end_lineno=1248, end_col_offset=39), keyword(arg='pyserini_version', value=Name(id='pyserini_version', ctx=Load(), lineno=1249, col_offset=29, end_lineno=1249, end_col_offset=45), lineno=1249, col_offset=12, end_lineno=1249, end_col_offset=45), keyword(arg='threads', value=Name(id='threads', ctx=Load(), lineno=1250, col_offset=20, end_lineno=1250, end_col_offset=27), lineno=1250, col_offset=12, end_lineno=1250, end_col_offset=27), keyword(arg='index_dir', value=Call(func=Name(id='str', ctx=Load(), lineno=1251, col_offset=22, end_lineno=1251, end_col_offset=25), args=[Name(id='index_dir', ctx=Load(), lineno=1251, col_offset=26, end_lineno=1251, end_col_offset=35)], lineno=1251, col_offset=22, end_lineno=1251, end_col_offset=36), lineno=1251, col_offset=12, end_lineno=1251, end_col_offset=36), keyword(arg='index_size_bytes', value=Call(func=Name(id='_directory_size', ctx=Load(), lineno=1252, col_offset=29, end_lineno=1252, end_col_offset=44), args=[Name(id='index_dir', ctx=Load(), lineno=1252, col_offset=45, end_lineno=1252, end_col_offset=54)], lineno=1252, col_offset=29, end_lineno=1252, end_col_offset=55), lineno=1252, col_offset=12, end_lineno=1252, end_col_offset=55), keyword(arg='generator', value=Name(id='GENERATOR_NAME', ctx=Load(), lineno=1253, col_offset=22, end_lineno=1253, end_col_offset=36), lineno=1253, col_offset=12, end_lineno=1253, end_col_offset=36)], lineno=1244, col_offset=25, end_lineno=1254, end_col_offset=9), lineno=1244, col_offset=8, end_lineno=1254, end_col_offset=9), Assign(targets=[Name(id='metadata_output', ctx=Store(), lineno=1255, col_offset=8, end_lineno=1255, end_col_offset=23)], value=BinOp(left=Name(id='index_dir', ctx=Load(), lineno=1255, col_offset=26, end_lineno=1255, end_col_offset=35), op=Div(), right=Name(id='INDEX_METADATA_FILENAME', ctx=Load(), lineno=1255, col_offset=38, end_lineno=1255, end_col_offset=61), lineno=1255, col_offset=26, end_lineno=1255, end_col_offset=61), lineno=1255, col_offset=8, end_lineno=1255, end_col_offset=61), Expr(value=Call(func=Name(id='_write_struct', ctx=Load(), lineno=1256, col_offset=8, end_lineno=1256, end_col_offset=21), args=[Name(id='metadata_output', ctx=Load(), lineno=1256, col_offset=22, end_lineno=1256, end_col_offset=37), Name(id='index_metadata', ctx=Load(), lineno=1256, col_offset=39, end_lineno=1256, end_col_offset=53)], lineno=1256, col_offset=8, end_lineno=1256, end_col_offset=54), lineno=1256, col_offset=8, end_lineno=1256, end_col_offset=54), Expr(value=Call(func=Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=1257, col_offset=8, end_lineno=1257, end_col_offset=12), attr='_logger', ctx=Load(), lineno=1257, col_offset=8, end_lineno=1257, end_col_offset=20), attr='info', ctx=Load(), lineno=1257, col_offset=8, end_lineno=1257, end_col_offset=25), args=[Constant(value='Built SPLADE impact index', lineno=1258, col_offset=12, end_lineno=1258, end_col_offset=39)], keywords=[keyword(arg='extra', value=Dict(keys=[Constant(value='index_dir', lineno=1260, col_offset=16, end_lineno=1260, end_col_offset=27), Constant(value='metadata', lineno=1261, col_offset=16, end_lineno=1261, end_col_offset=26), Constant(value='doc_count', lineno=1262, col_offset=16, end_lineno=1262, end_col_offset=27)], values=[Call(func=Name(id='str', ctx=Load(), lineno=1260, col_offset=29, end_lineno=1260, end_col_offset=32), args=[Name(id='index_dir', ctx=Load(), lineno=1260, col_offset=33, end_lineno=1260, end_col_offset=42)], lineno=1260, col_offset=29, end_lineno=1260, end_col_offset=43), Call(func=Name(id='str', ctx=Load(), lineno=1261, col_offset=28, end_lineno=1261, end_col_offset=31), args=[Name(id='metadata_output', ctx=Load(), lineno=1261, col_offset=32, end_lineno=1261, end_col_offset=47)], lineno=1261, col_offset=28, end_lineno=1261, end_col_offset=48), Name(id='doc_count', ctx=Load(), lineno=1262, col_offset=29, end_lineno=1262, end_col_offset=38)], lineno=1259, col_offset=18, end_lineno=1263, end_col_offset=13), lineno=1259, col_offset=12, end_lineno=1263, end_col_offset=13)], lineno=1257, col_offset=8, end_lineno=1264, end_col_offset=9), lineno=1257, col_offset=8, end_lineno=1264, end_col_offset=9), Return(value=Name(id='index_metadata', ctx=Load(), lineno=1265, col_offset=15, end_lineno=1265, end_col_offset=29), lineno=1265, col_offset=8, end_lineno=1265, end_col_offset=29)], returns=Name(id='SpladeIndexMetadata', ctx=Load(), lineno=1161, col_offset=72, end_lineno=1161, end_col_offset=91), lineno=1161, col_offset=4, end_lineno=1265, end_col_offset=29)], lineno=1130, col_offset=0, end_lineno=1265, end_col_offset=29), Assign(targets=[Name(id='__all__', ctx=Store(), lineno=1268, col_offset=0, end_lineno=1268, end_col_offset=7)], value=List(elts=[Constant(value='SpladeArtifactMetadata', lineno=1269, col_offset=4, end_lineno=1269, end_col_offset=28), Constant(value='SpladeArtifactsManager', lineno=1270, col_offset=4, end_lineno=1270, end_col_offset=28), Constant(value='SpladeBuildOptions', lineno=1271, col_offset=4, end_lineno=1271, end_col_offset=24), Constant(value='SpladeEncodeOptions', lineno=1272, col_offset=4, end_lineno=1272, end_col_offset=25), Constant(value='SpladeEncodingMetadata', lineno=1273, col_offset=4, end_lineno=1273, end_col_offset=28), Constant(value='SpladeEncodingSummary', lineno=1274, col_offset=4, end_lineno=1274, end_col_offset=27), Constant(value='SpladeExportOptions', lineno=1275, col_offset=4, end_lineno=1275, end_col_offset=25), Constant(value='SpladeExportSummary', lineno=1276, col_offset=4, end_lineno=1276, end_col_offset=25), Constant(value='SpladeIndexManager', lineno=1277, col_offset=4, end_lineno=1277, end_col_offset=24), Constant(value='SpladeIndexMetadata', lineno=1278, col_offset=4, end_lineno=1278, end_col_offset=25)], ctx=Load(), lineno=1268, col_offset=10, end_lineno=1279, end_col_offset=1), lineno=1268, col_offset=0, end_lineno=1279, end_col_offset=1)])