Module(body=[Expr(value=Constant(value='Typed helpers for working with FAISS GPU bindings.\n\nThis module hides optional GPU initialisation and cloning logic behind a small typed surface so the\nrest of the search stack can import a single, well-typed facade. The helpers are resilient to\nmissing GPU extras and fall back to CPU behaviour automatically.\n', lineno=1, col_offset=0, end_lineno=6, end_col_offset=3), lineno=1, col_offset=0, end_lineno=6, end_col_offset=3), ImportFrom(module='__future__', names=[alias(name='annotations', lineno=10, col_offset=23, end_lineno=10, end_col_offset=34)], level=0, lineno=10, col_offset=0, end_lineno=10, end_col_offset=34), Import(names=[alias(name='logging', lineno=12, col_offset=7, end_lineno=12, end_col_offset=14)], lineno=12, col_offset=0, end_lineno=12, end_col_offset=14), ImportFrom(module='collections.abc', names=[alias(name='Callable', lineno=13, col_offset=28, end_lineno=13, end_col_offset=36), alias(name='Sequence', lineno=13, col_offset=38, end_lineno=13, end_col_offset=46)], level=0, lineno=13, col_offset=0, end_lineno=13, end_col_offset=46), ImportFrom(module='dataclasses', names=[alias(name='dataclass', lineno=14, col_offset=24, end_lineno=14, end_col_offset=33)], level=0, lineno=14, col_offset=0, end_lineno=14, end_col_offset=33), ImportFrom(module='typing', names=[alias(name='cast', lineno=15, col_offset=19, end_lineno=15, end_col_offset=23)], level=0, lineno=15, col_offset=0, end_lineno=15, end_col_offset=23), ImportFrom(module='kgfoundry_common.navmap_loader', names=[alias(name='load_nav_metadata', lineno=17, col_offset=43, end_lineno=17, end_col_offset=60)], level=0, lineno=17, col_offset=0, end_lineno=17, end_col_offset=60), ImportFrom(module='kgfoundry_common.sequence_guards', names=[alias(name='first_or_error', lineno=19, col_offset=4, end_lineno=19, end_col_offset=18), alias(name='first_or_error_multi_device', lineno=20, col_offset=4, end_lineno=20, end_col_offset=31)], level=0, lineno=18, col_offset=0, end_lineno=21, end_col_offset=1), ImportFrom(module='search_api.types', names=[alias(name='FaissIndexProtocol', lineno=23, col_offset=4, end_lineno=23, end_col_offset=22), alias(name='FaissModuleProtocol', lineno=24, col_offset=4, end_lineno=24, end_col_offset=23), alias(name='GpuClonerOptionsProtocol', lineno=25, col_offset=4, end_lineno=25, end_col_offset=28), alias(name='GpuResourcesProtocol', lineno=26, col_offset=4, end_lineno=26, end_col_offset=24)], level=0, lineno=22, col_offset=0, end_lineno=27, end_col_offset=1), Assign(targets=[Name(id='logger', ctx=Store(), lineno=29, col_offset=0, end_lineno=29, end_col_offset=6)], value=Call(func=Attribute(value=Name(id='logging', ctx=Load(), lineno=29, col_offset=9, end_lineno=29, end_col_offset=16), attr='getLogger', ctx=Load(), lineno=29, col_offset=9, end_lineno=29, end_col_offset=26), args=[Name(id='__name__', ctx=Load(), lineno=29, col_offset=27, end_lineno=29, end_col_offset=35)], lineno=29, col_offset=9, end_lineno=29, end_col_offset=36), lineno=29, col_offset=0, end_lineno=29, end_col_offset=36), Assign(targets=[Name(id='__all__', ctx=Store(), lineno=31, col_offset=0, end_lineno=31, end_col_offset=7)], value=List(elts=[Constant(value='GpuContext', lineno=32, col_offset=4, end_lineno=32, end_col_offset=16), Constant(value='clone_index_to_gpu', lineno=33, col_offset=4, end_lineno=33, end_col_offset=24), Constant(value='configure_search_parameters', lineno=34, col_offset=4, end_lineno=34, end_col_offset=33), Constant(value='detect_gpu_context', lineno=35, col_offset=4, end_lineno=35, end_col_offset=24)], ctx=Load(), lineno=31, col_offset=10, end_lineno=36, end_col_offset=1), lineno=31, col_offset=0, end_lineno=36, end_col_offset=1), Assign(targets=[Name(id='__navmap__', ctx=Store(), lineno=37, col_offset=0, end_lineno=37, end_col_offset=10)], value=Call(func=Name(id='load_nav_metadata', ctx=Load(), lineno=37, col_offset=13, end_lineno=37, end_col_offset=30), args=[Name(id='__name__', ctx=Load(), lineno=37, col_offset=31, end_lineno=37, end_col_offset=39), Call(func=Name(id='tuple', ctx=Load(), lineno=37, col_offset=41, end_lineno=37, end_col_offset=46), args=[Name(id='__all__', ctx=Load(), lineno=37, col_offset=47, end_lineno=37, end_col_offset=54)], lineno=37, col_offset=41, end_lineno=37, end_col_offset=55)], lineno=37, col_offset=13, end_lineno=37, end_col_offset=56), lineno=37, col_offset=0, end_lineno=37, end_col_offset=56), ClassDef(name='GpuContext', body=[Expr(value=Constant(value='Container describing GPU resources associated with a FAISS module.', lineno=43, col_offset=4, end_lineno=43, end_col_offset=76), lineno=43, col_offset=4, end_lineno=43, end_col_offset=76), AnnAssign(target=Name(id='module', ctx=Store(), lineno=45, col_offset=4, end_lineno=45, end_col_offset=10), annotation=Name(id='FaissModuleProtocol', ctx=Load(), lineno=45, col_offset=12, end_lineno=45, end_col_offset=31), simple=1, lineno=45, col_offset=4, end_lineno=45, end_col_offset=31), AnnAssign(target=Name(id='resources', ctx=Store(), lineno=46, col_offset=4, end_lineno=46, end_col_offset=13), annotation=Name(id='GpuResourcesProtocol', ctx=Load(), lineno=46, col_offset=15, end_lineno=46, end_col_offset=35), simple=1, lineno=46, col_offset=4, end_lineno=46, end_col_offset=35), AnnAssign(target=Name(id='options', ctx=Store(), lineno=47, col_offset=4, end_lineno=47, end_col_offset=11), annotation=BinOp(left=Name(id='GpuClonerOptionsProtocol', ctx=Load(), lineno=47, col_offset=13, end_lineno=47, end_col_offset=37), op=BitOr(), right=Constant(value=None, lineno=47, col_offset=40, end_lineno=47, end_col_offset=44), lineno=47, col_offset=13, end_lineno=47, end_col_offset=44), simple=1, lineno=47, col_offset=4, end_lineno=47, end_col_offset=44), AnnAssign(target=Name(id='device_ids', ctx=Store(), lineno=48, col_offset=4, end_lineno=48, end_col_offset=14), annotation=Subscript(value=Name(id='tuple', ctx=Load(), lineno=48, col_offset=16, end_lineno=48, end_col_offset=21), slice=Tuple(elts=[Name(id='int', ctx=Load(), lineno=48, col_offset=22, end_lineno=48, end_col_offset=25), Constant(value=Ellipsis, lineno=48, col_offset=27, end_lineno=48, end_col_offset=30)], ctx=Load(), lineno=48, col_offset=22, end_lineno=48, end_col_offset=30), ctx=Load(), lineno=48, col_offset=16, end_lineno=48, end_col_offset=31), simple=1, lineno=48, col_offset=4, end_lineno=48, end_col_offset=31)], decorator_list=[Call(func=Name(id='dataclass', ctx=Load(), lineno=40, col_offset=1, end_lineno=40, end_col_offset=10), keywords=[keyword(arg='frozen', value=Constant(value=True, lineno=40, col_offset=18, end_lineno=40, end_col_offset=22), lineno=40, col_offset=11, end_lineno=40, end_col_offset=22)], lineno=40, col_offset=1, end_lineno=40, end_col_offset=23)], lineno=42, col_offset=0, end_lineno=48, end_col_offset=31), FunctionDef(name='detect_gpu_context', args=arguments(args=[arg(arg='module', annotation=Name(id='FaissModuleProtocol', ctx=Load(), lineno=53, col_offset=12, end_lineno=53, end_col_offset=31), lineno=53, col_offset=4, end_lineno=53, end_col_offset=31)], kwonlyargs=[arg(arg='use_cuvs', annotation=Name(id='bool', ctx=Load(), lineno=55, col_offset=14, end_lineno=55, end_col_offset=18), lineno=55, col_offset=4, end_lineno=55, end_col_offset=18), arg(arg='device_ids', annotation=BinOp(left=Subscript(value=Name(id='Sequence', ctx=Load(), lineno=56, col_offset=16, end_lineno=56, end_col_offset=24), slice=Name(id='int', ctx=Load(), lineno=56, col_offset=25, end_lineno=56, end_col_offset=28), ctx=Load(), lineno=56, col_offset=16, end_lineno=56, end_col_offset=29), op=BitOr(), right=Constant(value=None, lineno=56, col_offset=32, end_lineno=56, end_col_offset=36), lineno=56, col_offset=16, end_lineno=56, end_col_offset=36), lineno=56, col_offset=4, end_lineno=56, end_col_offset=36)], kw_defaults=[Constant(value=True, lineno=55, col_offset=21, end_lineno=55, end_col_offset=25), Constant(value=None, lineno=56, col_offset=39, end_lineno=56, end_col_offset=43)]), body=[Expr(value=Constant(value='Return a :class:`GpuContext` when GPU helpers are available.\n\n    Parameters\n    ----------\n    module : FaissModuleProtocol\n        FAISS module previously imported (may be CPU-only).\n    use_cuvs : bool, optional\n        Whether to request cuVS acceleration when the module exposes the\n        ``GpuClonerOptions`` flag. Defaults to ``True``.\n    device_ids : Sequence[int] | None, optional\n        Specific GPU device IDs to target. Defaults to ``(0,)`` when omitted.\n\n    Returns\n    -------\n    GpuContext | None\n        GPU context if GPU helpers are available, None otherwise.\n    ', lineno=58, col_offset=4, end_lineno=74, end_col_offset=7), lineno=58, col_offset=4, end_lineno=74, end_col_offset=7), Assign(targets=[Name(id='standard_gpu_resources_raw', ctx=Store(), lineno=75, col_offset=4, end_lineno=75, end_col_offset=30)], value=Call(func=Name(id='cast', ctx=Load(), lineno=75, col_offset=33, end_lineno=75, end_col_offset=37), args=[Constant(value='object | None', lineno=76, col_offset=8, end_lineno=76, end_col_offset=23), Call(func=Name(id='getattr', ctx=Load(), lineno=76, col_offset=25, end_lineno=76, end_col_offset=32), args=[Name(id='module', ctx=Load(), lineno=76, col_offset=33, end_lineno=76, end_col_offset=39), Constant(value='StandardGpuResources', lineno=76, col_offset=41, end_lineno=76, end_col_offset=63), Constant(value=None, lineno=76, col_offset=65, end_lineno=76, end_col_offset=69)], lineno=76, col_offset=25, end_lineno=76, end_col_offset=70)], lineno=75, col_offset=33, end_lineno=77, end_col_offset=5), lineno=75, col_offset=4, end_lineno=77, end_col_offset=5), If(test=Compare(left=Name(id='standard_gpu_resources_raw', ctx=Load(), lineno=78, col_offset=7, end_lineno=78, end_col_offset=33), ops=[Is()], comparators=[Constant(value=None, lineno=78, col_offset=37, end_lineno=78, end_col_offset=41)], lineno=78, col_offset=7, end_lineno=78, end_col_offset=41), body=[Return(value=Constant(value=None, lineno=79, col_offset=15, end_lineno=79, end_col_offset=19), lineno=79, col_offset=8, end_lineno=79, end_col_offset=19)], lineno=78, col_offset=4, end_lineno=79, end_col_offset=19), Assign(targets=[Name(id='resources_ctor', ctx=Store(), lineno=81, col_offset=4, end_lineno=81, end_col_offset=18)], value=Call(func=Name(id='cast', ctx=Load(), lineno=81, col_offset=21, end_lineno=81, end_col_offset=25), args=[Constant(value='Callable[[], GpuResourcesProtocol]', lineno=81, col_offset=26, end_lineno=81, end_col_offset=62), Name(id='standard_gpu_resources_raw', ctx=Load(), lineno=81, col_offset=64, end_lineno=81, end_col_offset=90)], lineno=81, col_offset=21, end_lineno=81, end_col_offset=91), lineno=81, col_offset=4, end_lineno=81, end_col_offset=91), Assign(targets=[Name(id='resources', ctx=Store(), lineno=82, col_offset=4, end_lineno=82, end_col_offset=13)], value=Call(func=Name(id='resources_ctor', ctx=Load(), lineno=82, col_offset=16, end_lineno=82, end_col_offset=30), lineno=82, col_offset=16, end_lineno=82, end_col_offset=32), lineno=82, col_offset=4, end_lineno=82, end_col_offset=32), Assign(targets=[Name(id='options_ctor_raw', ctx=Store(), lineno=84, col_offset=4, end_lineno=84, end_col_offset=20)], value=Call(func=Name(id='cast', ctx=Load(), lineno=84, col_offset=23, end_lineno=84, end_col_offset=27), args=[Constant(value='object | None', lineno=84, col_offset=28, end_lineno=84, end_col_offset=43), Call(func=Name(id='getattr', ctx=Load(), lineno=84, col_offset=45, end_lineno=84, end_col_offset=52), args=[Name(id='module', ctx=Load(), lineno=84, col_offset=53, end_lineno=84, end_col_offset=59), Constant(value='GpuClonerOptions', lineno=84, col_offset=61, end_lineno=84, end_col_offset=79), Constant(value=None, lineno=84, col_offset=81, end_lineno=84, end_col_offset=85)], lineno=84, col_offset=45, end_lineno=84, end_col_offset=86)], lineno=84, col_offset=23, end_lineno=84, end_col_offset=87), lineno=84, col_offset=4, end_lineno=84, end_col_offset=87), AnnAssign(target=Name(id='options', ctx=Store(), lineno=85, col_offset=4, end_lineno=85, end_col_offset=11), annotation=BinOp(left=Name(id='GpuClonerOptionsProtocol', ctx=Load(), lineno=85, col_offset=13, end_lineno=85, end_col_offset=37), op=BitOr(), right=Constant(value=None, lineno=85, col_offset=40, end_lineno=85, end_col_offset=44), lineno=85, col_offset=13, end_lineno=85, end_col_offset=44), value=Constant(value=None, lineno=85, col_offset=47, end_lineno=85, end_col_offset=51), simple=1, lineno=85, col_offset=4, end_lineno=85, end_col_offset=51), If(test=Compare(left=Name(id='options_ctor_raw', ctx=Load(), lineno=86, col_offset=7, end_lineno=86, end_col_offset=23), ops=[IsNot()], comparators=[Constant(value=None, lineno=86, col_offset=31, end_lineno=86, end_col_offset=35)], lineno=86, col_offset=7, end_lineno=86, end_col_offset=35), body=[Assign(targets=[Name(id='options_ctor', ctx=Store(), lineno=87, col_offset=8, end_lineno=87, end_col_offset=20)], value=Call(func=Name(id='cast', ctx=Load(), lineno=87, col_offset=23, end_lineno=87, end_col_offset=27), args=[Constant(value='Callable[[], GpuClonerOptionsProtocol]', lineno=87, col_offset=28, end_lineno=87, end_col_offset=68), Name(id='options_ctor_raw', ctx=Load(), lineno=87, col_offset=70, end_lineno=87, end_col_offset=86)], lineno=87, col_offset=23, end_lineno=87, end_col_offset=87), lineno=87, col_offset=8, end_lineno=87, end_col_offset=87), Assign(targets=[Name(id='options', ctx=Store(), lineno=88, col_offset=8, end_lineno=88, end_col_offset=15)], value=Call(func=Name(id='options_ctor', ctx=Load(), lineno=88, col_offset=18, end_lineno=88, end_col_offset=30), lineno=88, col_offset=18, end_lineno=88, end_col_offset=32), lineno=88, col_offset=8, end_lineno=88, end_col_offset=32), If(test=Call(func=Name(id='hasattr', ctx=Load(), lineno=89, col_offset=11, end_lineno=89, end_col_offset=18), args=[Name(id='options', ctx=Load(), lineno=89, col_offset=19, end_lineno=89, end_col_offset=26), Constant(value='use_cuvs', lineno=89, col_offset=28, end_lineno=89, end_col_offset=38)], lineno=89, col_offset=11, end_lineno=89, end_col_offset=39), body=[Assign(targets=[Attribute(value=Name(id='options', ctx=Load(), lineno=90, col_offset=12, end_lineno=90, end_col_offset=19), attr='use_cuvs', ctx=Store(), lineno=90, col_offset=12, end_lineno=90, end_col_offset=28)], value=Call(func=Name(id='bool', ctx=Load(), lineno=90, col_offset=31, end_lineno=90, end_col_offset=35), args=[Name(id='use_cuvs', ctx=Load(), lineno=90, col_offset=36, end_lineno=90, end_col_offset=44)], lineno=90, col_offset=31, end_lineno=90, end_col_offset=45), lineno=90, col_offset=12, end_lineno=90, end_col_offset=45)], lineno=89, col_offset=8, end_lineno=90, end_col_offset=45)], lineno=86, col_offset=4, end_lineno=90, end_col_offset=45), Assign(targets=[Name(id='devices', ctx=Store(), lineno=92, col_offset=4, end_lineno=92, end_col_offset=11)], value=IfExp(test=Name(id='device_ids', ctx=Load(), lineno=92, col_offset=61, end_lineno=92, end_col_offset=71), body=Call(func=Name(id='tuple', ctx=Load(), lineno=92, col_offset=14, end_lineno=92, end_col_offset=19), args=[GeneratorExp(elt=Call(func=Name(id='int', ctx=Load(), lineno=92, col_offset=20, end_lineno=92, end_col_offset=23), args=[Name(id='device', ctx=Load(), lineno=92, col_offset=24, end_lineno=92, end_col_offset=30)], lineno=92, col_offset=20, end_lineno=92, end_col_offset=31), generators=[comprehension(target=Name(id='device', ctx=Store(), lineno=92, col_offset=36, end_lineno=92, end_col_offset=42), iter=Name(id='device_ids', ctx=Load(), lineno=92, col_offset=46, end_lineno=92, end_col_offset=56), is_async=0)], lineno=92, col_offset=19, end_lineno=92, end_col_offset=57)], lineno=92, col_offset=14, end_lineno=92, end_col_offset=57), orelse=Tuple(elts=[Constant(value=0, lineno=92, col_offset=78, end_lineno=92, end_col_offset=79)], ctx=Load(), lineno=92, col_offset=77, end_lineno=92, end_col_offset=81), lineno=92, col_offset=14, end_lineno=92, end_col_offset=81), lineno=92, col_offset=4, end_lineno=92, end_col_offset=81), Return(value=Call(func=Name(id='GpuContext', ctx=Load(), lineno=94, col_offset=11, end_lineno=94, end_col_offset=21), keywords=[keyword(arg='module', value=Name(id='module', ctx=Load(), lineno=94, col_offset=29, end_lineno=94, end_col_offset=35), lineno=94, col_offset=22, end_lineno=94, end_col_offset=35), keyword(arg='resources', value=Name(id='resources', ctx=Load(), lineno=94, col_offset=47, end_lineno=94, end_col_offset=56), lineno=94, col_offset=37, end_lineno=94, end_col_offset=56), keyword(arg='options', value=Name(id='options', ctx=Load(), lineno=94, col_offset=66, end_lineno=94, end_col_offset=73), lineno=94, col_offset=58, end_lineno=94, end_col_offset=73), keyword(arg='device_ids', value=Name(id='devices', ctx=Load(), lineno=94, col_offset=86, end_lineno=94, end_col_offset=93), lineno=94, col_offset=75, end_lineno=94, end_col_offset=93)], lineno=94, col_offset=11, end_lineno=94, end_col_offset=94), lineno=94, col_offset=4, end_lineno=94, end_col_offset=94)], returns=BinOp(left=Name(id='GpuContext', ctx=Load(), lineno=57, col_offset=5, end_lineno=57, end_col_offset=15), op=BitOr(), right=Constant(value=None, lineno=57, col_offset=18, end_lineno=57, end_col_offset=22), lineno=57, col_offset=5, end_lineno=57, end_col_offset=22), lineno=52, col_offset=0, end_lineno=94, end_col_offset=94), FunctionDef(name='clone_index_to_gpu', args=arguments(args=[arg(arg='index', annotation=Name(id='FaissIndexProtocol', ctx=Load(), lineno=98, col_offset=30, end_lineno=98, end_col_offset=48), lineno=98, col_offset=23, end_lineno=98, end_col_offset=48), arg(arg='context', annotation=Name(id='GpuContext', ctx=Load(), lineno=98, col_offset=59, end_lineno=98, end_col_offset=69), lineno=98, col_offset=50, end_lineno=98, end_col_offset=69)]), body=[Expr(value=Constant(value='Clone ``index`` onto GPU hardware described by ``context``.\n\n    If GPU helpers are unavailable or cloning fails, the original CPU index is returned. All\n    exceptions are caught and logged at debug level so callers can emit typed Problem Details\n    without leaking driver internals to clients.\n\n    Parameters\n    ----------\n    index : FaissIndexProtocol\n        CPU index to clone.\n    context : GpuContext\n        GPU context for cloning.\n\n    Returns\n    -------\n    FaissIndexProtocol\n        GPU index if cloning succeeds, otherwise the original CPU index.\n    ', lineno=99, col_offset=4, end_lineno=116, end_col_offset=7), lineno=99, col_offset=4, end_lineno=116, end_col_offset=7), Assign(targets=[Name(id='module', ctx=Store(), lineno=117, col_offset=4, end_lineno=117, end_col_offset=10)], value=Attribute(value=Name(id='context', ctx=Load(), lineno=117, col_offset=13, end_lineno=117, end_col_offset=20), attr='module', ctx=Load(), lineno=117, col_offset=13, end_lineno=117, end_col_offset=27), lineno=117, col_offset=4, end_lineno=117, end_col_offset=27), Assign(targets=[Name(id='devices', ctx=Store(), lineno=118, col_offset=4, end_lineno=118, end_col_offset=11)], value=Attribute(value=Name(id='context', ctx=Load(), lineno=118, col_offset=14, end_lineno=118, end_col_offset=21), attr='device_ids', ctx=Load(), lineno=118, col_offset=14, end_lineno=118, end_col_offset=32), lineno=118, col_offset=4, end_lineno=118, end_col_offset=32), Assign(targets=[Name(id='options', ctx=Store(), lineno=119, col_offset=4, end_lineno=119, end_col_offset=11)], value=Attribute(value=Name(id='context', ctx=Load(), lineno=119, col_offset=14, end_lineno=119, end_col_offset=21), attr='options', ctx=Load(), lineno=119, col_offset=14, end_lineno=119, end_col_offset=29), lineno=119, col_offset=4, end_lineno=119, end_col_offset=29), Try(body=[If(test=Compare(left=Call(func=Name(id='len', ctx=Load(), lineno=122, col_offset=11, end_lineno=122, end_col_offset=14), args=[Name(id='devices', ctx=Load(), lineno=122, col_offset=15, end_lineno=122, end_col_offset=22)], lineno=122, col_offset=11, end_lineno=122, end_col_offset=23), ops=[Gt()], comparators=[Constant(value=1, lineno=122, col_offset=26, end_lineno=122, end_col_offset=27)], lineno=122, col_offset=11, end_lineno=122, end_col_offset=27), body=[Assign(targets=[Name(id='multi_clone_raw', ctx=Store(), lineno=123, col_offset=12, end_lineno=123, end_col_offset=27)], value=Call(func=Name(id='cast', ctx=Load(), lineno=123, col_offset=30, end_lineno=123, end_col_offset=34), args=[Constant(value='object | None', lineno=124, col_offset=16, end_lineno=124, end_col_offset=31), Call(func=Name(id='getattr', ctx=Load(), lineno=124, col_offset=33, end_lineno=124, end_col_offset=40), args=[Name(id='module', ctx=Load(), lineno=124, col_offset=41, end_lineno=124, end_col_offset=47), Constant(value='index_cpu_to_gpu_multiple', lineno=124, col_offset=49, end_lineno=124, end_col_offset=76), Constant(value=None, lineno=124, col_offset=78, end_lineno=124, end_col_offset=82)], lineno=124, col_offset=33, end_lineno=124, end_col_offset=83)], lineno=123, col_offset=30, end_lineno=125, end_col_offset=13), lineno=123, col_offset=12, end_lineno=125, end_col_offset=13), If(test=Compare(left=Name(id='multi_clone_raw', ctx=Load(), lineno=126, col_offset=15, end_lineno=126, end_col_offset=30), ops=[IsNot()], comparators=[Constant(value=None, lineno=126, col_offset=38, end_lineno=126, end_col_offset=42)], lineno=126, col_offset=15, end_lineno=126, end_col_offset=42), body=[Assign(targets=[Name(id='multi_clone', ctx=Store(), lineno=127, col_offset=16, end_lineno=127, end_col_offset=27)], value=Call(func=Name(id='cast', ctx=Load(), lineno=127, col_offset=30, end_lineno=127, end_col_offset=34), args=[Constant(value='Callable[[GpuResourcesProtocol, Sequence[int], FaissIndexProtocol, GpuClonerOptionsProtocol | None], list[FaissIndexProtocol]]', lineno=128, col_offset=20, end_lineno=128, end_col_offset=148), Name(id='multi_clone_raw', ctx=Load(), lineno=129, col_offset=20, end_lineno=129, end_col_offset=35)], lineno=127, col_offset=30, end_lineno=130, end_col_offset=17), lineno=127, col_offset=16, end_lineno=130, end_col_offset=17), Assign(targets=[Name(id='gpu_indices', ctx=Store(), lineno=131, col_offset=16, end_lineno=131, end_col_offset=27)], value=Call(func=Name(id='multi_clone', ctx=Load(), lineno=131, col_offset=30, end_lineno=131, end_col_offset=41), args=[Attribute(value=Name(id='context', ctx=Load(), lineno=131, col_offset=42, end_lineno=131, end_col_offset=49), attr='resources', ctx=Load(), lineno=131, col_offset=42, end_lineno=131, end_col_offset=59), Call(func=Name(id='list', ctx=Load(), lineno=131, col_offset=61, end_lineno=131, end_col_offset=65), args=[Name(id='devices', ctx=Load(), lineno=131, col_offset=66, end_lineno=131, end_col_offset=73)], lineno=131, col_offset=61, end_lineno=131, end_col_offset=74), Name(id='index', ctx=Load(), lineno=131, col_offset=76, end_lineno=131, end_col_offset=81), Name(id='options', ctx=Load(), lineno=131, col_offset=83, end_lineno=131, end_col_offset=90)], lineno=131, col_offset=30, end_lineno=131, end_col_offset=91), lineno=131, col_offset=16, end_lineno=131, end_col_offset=91), If(test=Name(id='gpu_indices', ctx=Load(), lineno=132, col_offset=19, end_lineno=132, end_col_offset=30), body=[Return(value=Call(func=Name(id='first_or_error_multi_device', ctx=Load(), lineno=133, col_offset=27, end_lineno=133, end_col_offset=54), args=[Name(id='gpu_indices', ctx=Load(), lineno=134, col_offset=24, end_lineno=134, end_col_offset=35)], keywords=[keyword(arg='context', value=Constant(value='gpu_indices_from_multi_clone', lineno=134, col_offset=45, end_lineno=134, end_col_offset=75), lineno=134, col_offset=37, end_lineno=134, end_col_offset=75)], lineno=133, col_offset=27, end_lineno=135, end_col_offset=21), lineno=133, col_offset=20, end_lineno=135, end_col_offset=21)], lineno=132, col_offset=16, end_lineno=135, end_col_offset=21)], lineno=126, col_offset=12, end_lineno=135, end_col_offset=21)], lineno=122, col_offset=8, end_lineno=135, end_col_offset=21), Assign(targets=[Name(id='clone_raw', ctx=Store(), lineno=137, col_offset=8, end_lineno=137, end_col_offset=17)], value=Call(func=Name(id='cast', ctx=Load(), lineno=137, col_offset=20, end_lineno=137, end_col_offset=24), args=[Constant(value='object | None', lineno=137, col_offset=25, end_lineno=137, end_col_offset=40), Call(func=Name(id='getattr', ctx=Load(), lineno=137, col_offset=42, end_lineno=137, end_col_offset=49), args=[Name(id='module', ctx=Load(), lineno=137, col_offset=50, end_lineno=137, end_col_offset=56), Constant(value='index_cpu_to_gpu', lineno=137, col_offset=58, end_lineno=137, end_col_offset=76), Constant(value=None, lineno=137, col_offset=78, end_lineno=137, end_col_offset=82)], lineno=137, col_offset=42, end_lineno=137, end_col_offset=83)], lineno=137, col_offset=20, end_lineno=137, end_col_offset=84), lineno=137, col_offset=8, end_lineno=137, end_col_offset=84), If(test=Compare(left=Name(id='clone_raw', ctx=Load(), lineno=138, col_offset=11, end_lineno=138, end_col_offset=20), ops=[Is()], comparators=[Constant(value=None, lineno=138, col_offset=24, end_lineno=138, end_col_offset=28)], lineno=138, col_offset=11, end_lineno=138, end_col_offset=28), body=[Return(value=Name(id='index', ctx=Load(), lineno=139, col_offset=19, end_lineno=139, end_col_offset=24), lineno=139, col_offset=12, end_lineno=139, end_col_offset=24)], lineno=138, col_offset=8, end_lineno=139, end_col_offset=24), If(test=Compare(left=Name(id='options', ctx=Load(), lineno=141, col_offset=11, end_lineno=141, end_col_offset=18), ops=[IsNot()], comparators=[Constant(value=None, lineno=141, col_offset=26, end_lineno=141, end_col_offset=30)], lineno=141, col_offset=11, end_lineno=141, end_col_offset=30), body=[Assign(targets=[Name(id='clone', ctx=Store(), lineno=142, col_offset=12, end_lineno=142, end_col_offset=17)], value=Call(func=Name(id='cast', ctx=Load(), lineno=142, col_offset=20, end_lineno=142, end_col_offset=24), args=[Constant(value='Callable[[GpuResourcesProtocol, int, FaissIndexProtocol, GpuClonerOptionsProtocol], FaissIndexProtocol]', lineno=143, col_offset=16, end_lineno=143, end_col_offset=121), Name(id='clone_raw', ctx=Load(), lineno=144, col_offset=16, end_lineno=144, end_col_offset=25)], lineno=142, col_offset=20, end_lineno=145, end_col_offset=13), lineno=142, col_offset=12, end_lineno=145, end_col_offset=13), Return(value=Call(func=Name(id='clone', ctx=Load(), lineno=146, col_offset=19, end_lineno=146, end_col_offset=24), args=[Attribute(value=Name(id='context', ctx=Load(), lineno=147, col_offset=16, end_lineno=147, end_col_offset=23), attr='resources', ctx=Load(), lineno=147, col_offset=16, end_lineno=147, end_col_offset=33), Call(func=Name(id='first_or_error', ctx=Load(), lineno=148, col_offset=16, end_lineno=148, end_col_offset=30), args=[Name(id='devices', ctx=Load(), lineno=148, col_offset=31, end_lineno=148, end_col_offset=38)], keywords=[keyword(arg='context', value=Constant(value='device_ids_single_clone', lineno=148, col_offset=48, end_lineno=148, end_col_offset=73), lineno=148, col_offset=40, end_lineno=148, end_col_offset=73)], lineno=148, col_offset=16, end_lineno=148, end_col_offset=74), Name(id='index', ctx=Load(), lineno=149, col_offset=16, end_lineno=149, end_col_offset=21), Name(id='options', ctx=Load(), lineno=150, col_offset=16, end_lineno=150, end_col_offset=23)], lineno=146, col_offset=19, end_lineno=151, end_col_offset=13), lineno=146, col_offset=12, end_lineno=151, end_col_offset=13)], lineno=141, col_offset=8, end_lineno=151, end_col_offset=13), Assign(targets=[Name(id='clone_without_options', ctx=Store(), lineno=153, col_offset=8, end_lineno=153, end_col_offset=29)], value=Call(func=Name(id='cast', ctx=Load(), lineno=153, col_offset=32, end_lineno=153, end_col_offset=36), args=[Constant(value='Callable[[GpuResourcesProtocol, int, FaissIndexProtocol], FaissIndexProtocol]', lineno=154, col_offset=12, end_lineno=154, end_col_offset=91), Name(id='clone_raw', ctx=Load(), lineno=155, col_offset=12, end_lineno=155, end_col_offset=21)], lineno=153, col_offset=32, end_lineno=156, end_col_offset=9), lineno=153, col_offset=8, end_lineno=156, end_col_offset=9), Return(value=Call(func=Name(id='clone_without_options', ctx=Load(), lineno=157, col_offset=15, end_lineno=157, end_col_offset=36), args=[Attribute(value=Name(id='context', ctx=Load(), lineno=158, col_offset=12, end_lineno=158, end_col_offset=19), attr='resources', ctx=Load(), lineno=158, col_offset=12, end_lineno=158, end_col_offset=29), Call(func=Name(id='first_or_error', ctx=Load(), lineno=159, col_offset=12, end_lineno=159, end_col_offset=26), args=[Name(id='devices', ctx=Load(), lineno=159, col_offset=27, end_lineno=159, end_col_offset=34)], keywords=[keyword(arg='context', value=Constant(value='device_ids_no_options', lineno=159, col_offset=44, end_lineno=159, end_col_offset=67), lineno=159, col_offset=36, end_lineno=159, end_col_offset=67)], lineno=159, col_offset=12, end_lineno=159, end_col_offset=68), Name(id='index', ctx=Load(), lineno=160, col_offset=12, end_lineno=160, end_col_offset=17)], lineno=157, col_offset=15, end_lineno=161, end_col_offset=9), lineno=157, col_offset=8, end_lineno=161, end_col_offset=9)], handlers=[ExceptHandler(type=Tuple(elts=[Name(id='RuntimeError', ctx=Load(), lineno=163, col_offset=8, end_lineno=163, end_col_offset=20), Name(id='OSError', ctx=Load(), lineno=164, col_offset=8, end_lineno=164, end_col_offset=15), Name(id='ValueError', ctx=Load(), lineno=165, col_offset=8, end_lineno=165, end_col_offset=18)], ctx=Load(), lineno=162, col_offset=11, end_lineno=166, end_col_offset=5), name='exc', body=[Expr(value=Call(func=Attribute(value=Name(id='logger', ctx=Load(), lineno=167, col_offset=8, end_lineno=167, end_col_offset=14), attr='debug', ctx=Load(), lineno=167, col_offset=8, end_lineno=167, end_col_offset=20), args=[Constant(value='FAISS GPU cloning failed: %s', lineno=167, col_offset=21, end_lineno=167, end_col_offset=51), Name(id='exc', ctx=Load(), lineno=167, col_offset=53, end_lineno=167, end_col_offset=56)], keywords=[keyword(arg='exc_info', value=Constant(value=True, lineno=167, col_offset=67, end_lineno=167, end_col_offset=71), lineno=167, col_offset=58, end_lineno=167, end_col_offset=71)], lineno=167, col_offset=8, end_lineno=167, end_col_offset=72), lineno=167, col_offset=8, end_lineno=167, end_col_offset=72), Return(value=Name(id='index', ctx=Load(), lineno=168, col_offset=15, end_lineno=168, end_col_offset=20), lineno=168, col_offset=8, end_lineno=168, end_col_offset=20)], lineno=162, col_offset=4, end_lineno=168, end_col_offset=20)], lineno=121, col_offset=4, end_lineno=168, end_col_offset=20)], returns=Name(id='FaissIndexProtocol', ctx=Load(), lineno=98, col_offset=74, end_lineno=98, end_col_offset=92), lineno=98, col_offset=0, end_lineno=168, end_col_offset=20), FunctionDef(name='configure_search_parameters', args=arguments(args=[arg(arg='module', annotation=Name(id='FaissModuleProtocol', ctx=Load(), lineno=173, col_offset=12, end_lineno=173, end_col_offset=31), lineno=173, col_offset=4, end_lineno=173, end_col_offset=31), arg(arg='index', annotation=Name(id='FaissIndexProtocol', ctx=Load(), lineno=174, col_offset=11, end_lineno=174, end_col_offset=29), lineno=174, col_offset=4, end_lineno=174, end_col_offset=29)], kwonlyargs=[arg(arg='nprobe', annotation=Name(id='int', ctx=Load(), lineno=176, col_offset=12, end_lineno=176, end_col_offset=15), lineno=176, col_offset=4, end_lineno=176, end_col_offset=15), arg(arg='gpu_enabled', annotation=Name(id='bool', ctx=Load(), lineno=177, col_offset=17, end_lineno=177, end_col_offset=21), lineno=177, col_offset=4, end_lineno=177, end_col_offset=21)], kw_defaults=[None, None]), body=[Expr(value=Constant(value='Apply FAISS search parameters (such as ``nprobe``) to ``index``.\n\n    Parameters\n    ----------\n    module : FaissModuleProtocol\n        FAISS module to query for parameter space helpers.\n    index : FaissIndexProtocol\n        Index to configure.\n    nprobe : int\n        Number of inverted lists to probe during search.\n    gpu_enabled : bool\n        Whether the index runs on GPU (selects GPU or CPU parameter space).\n    ', lineno=179, col_offset=4, end_lineno=191, end_col_offset=7), lineno=179, col_offset=4, end_lineno=191, end_col_offset=7), Assign(targets=[Name(id='params_name', ctx=Store(), lineno=192, col_offset=4, end_lineno=192, end_col_offset=15)], value=IfExp(test=Name(id='gpu_enabled', ctx=Load(), lineno=192, col_offset=41, end_lineno=192, end_col_offset=52), body=Constant(value='GpuParameterSpace', lineno=192, col_offset=18, end_lineno=192, end_col_offset=37), orelse=Constant(value='ParameterSpace', lineno=192, col_offset=58, end_lineno=192, end_col_offset=74), lineno=192, col_offset=18, end_lineno=192, end_col_offset=74), lineno=192, col_offset=4, end_lineno=192, end_col_offset=74), Assign(targets=[Name(id='params_ctor_raw', ctx=Store(), lineno=193, col_offset=4, end_lineno=193, end_col_offset=19)], value=Call(func=Name(id='cast', ctx=Load(), lineno=193, col_offset=22, end_lineno=193, end_col_offset=26), args=[Constant(value='object | None', lineno=193, col_offset=27, end_lineno=193, end_col_offset=42), Call(func=Name(id='getattr', ctx=Load(), lineno=193, col_offset=44, end_lineno=193, end_col_offset=51), args=[Name(id='module', ctx=Load(), lineno=193, col_offset=52, end_lineno=193, end_col_offset=58), Name(id='params_name', ctx=Load(), lineno=193, col_offset=60, end_lineno=193, end_col_offset=71), Constant(value=None, lineno=193, col_offset=73, end_lineno=193, end_col_offset=77)], lineno=193, col_offset=44, end_lineno=193, end_col_offset=78)], lineno=193, col_offset=22, end_lineno=193, end_col_offset=79), lineno=193, col_offset=4, end_lineno=193, end_col_offset=79), If(test=Compare(left=Name(id='params_ctor_raw', ctx=Load(), lineno=194, col_offset=7, end_lineno=194, end_col_offset=22), ops=[Is()], comparators=[Constant(value=None, lineno=194, col_offset=26, end_lineno=194, end_col_offset=30)], lineno=194, col_offset=7, end_lineno=194, end_col_offset=30), body=[Return(lineno=195, col_offset=8, end_lineno=195, end_col_offset=14)], lineno=194, col_offset=4, end_lineno=195, end_col_offset=14), Assign(targets=[Name(id='params_ctor', ctx=Store(), lineno=197, col_offset=4, end_lineno=197, end_col_offset=15)], value=Call(func=Name(id='cast', ctx=Load(), lineno=197, col_offset=18, end_lineno=197, end_col_offset=22), args=[Constant(value='Callable[[], object]', lineno=197, col_offset=23, end_lineno=197, end_col_offset=45), Name(id='params_ctor_raw', ctx=Load(), lineno=197, col_offset=47, end_lineno=197, end_col_offset=62)], lineno=197, col_offset=18, end_lineno=197, end_col_offset=63), lineno=197, col_offset=4, end_lineno=197, end_col_offset=63), Assign(targets=[Name(id='params', ctx=Store(), lineno=198, col_offset=4, end_lineno=198, end_col_offset=10)], value=Call(func=Name(id='params_ctor', ctx=Load(), lineno=198, col_offset=13, end_lineno=198, end_col_offset=24), lineno=198, col_offset=13, end_lineno=198, end_col_offset=26), lineno=198, col_offset=4, end_lineno=198, end_col_offset=26), Assign(targets=[Name(id='setter_raw', ctx=Store(), lineno=199, col_offset=4, end_lineno=199, end_col_offset=14)], value=Call(func=Name(id='cast', ctx=Load(), lineno=199, col_offset=17, end_lineno=199, end_col_offset=21), args=[Constant(value='object | None', lineno=199, col_offset=22, end_lineno=199, end_col_offset=37), Call(func=Name(id='getattr', ctx=Load(), lineno=199, col_offset=39, end_lineno=199, end_col_offset=46), args=[Name(id='params', ctx=Load(), lineno=199, col_offset=47, end_lineno=199, end_col_offset=53), Constant(value='set_index_parameter', lineno=199, col_offset=55, end_lineno=199, end_col_offset=76), Constant(value=None, lineno=199, col_offset=78, end_lineno=199, end_col_offset=82)], lineno=199, col_offset=39, end_lineno=199, end_col_offset=83)], lineno=199, col_offset=17, end_lineno=199, end_col_offset=84), lineno=199, col_offset=4, end_lineno=199, end_col_offset=84), If(test=Compare(left=Name(id='setter_raw', ctx=Load(), lineno=200, col_offset=7, end_lineno=200, end_col_offset=17), ops=[Is()], comparators=[Constant(value=None, lineno=200, col_offset=21, end_lineno=200, end_col_offset=25)], lineno=200, col_offset=7, end_lineno=200, end_col_offset=25), body=[Return(lineno=201, col_offset=8, end_lineno=201, end_col_offset=14)], lineno=200, col_offset=4, end_lineno=201, end_col_offset=14), Assign(targets=[Name(id='setter', ctx=Store(), lineno=203, col_offset=4, end_lineno=203, end_col_offset=10)], value=Call(func=Name(id='cast', ctx=Load(), lineno=203, col_offset=13, end_lineno=203, end_col_offset=17), args=[Constant(value='Callable[[FaissIndexProtocol, str, object], None]', lineno=203, col_offset=18, end_lineno=203, end_col_offset=69), Name(id='setter_raw', ctx=Load(), lineno=203, col_offset=71, end_lineno=203, end_col_offset=81)], lineno=203, col_offset=13, end_lineno=203, end_col_offset=82), lineno=203, col_offset=4, end_lineno=203, end_col_offset=82), Try(body=[Expr(value=Call(func=Name(id='setter', ctx=Load(), lineno=205, col_offset=8, end_lineno=205, end_col_offset=14), args=[Name(id='index', ctx=Load(), lineno=205, col_offset=15, end_lineno=205, end_col_offset=20), Constant(value='nprobe', lineno=205, col_offset=22, end_lineno=205, end_col_offset=30), Name(id='nprobe', ctx=Load(), lineno=205, col_offset=32, end_lineno=205, end_col_offset=38)], lineno=205, col_offset=8, end_lineno=205, end_col_offset=39), lineno=205, col_offset=8, end_lineno=205, end_col_offset=39)], handlers=[ExceptHandler(type=Tuple(elts=[Name(id='RuntimeError', ctx=Load(), lineno=207, col_offset=8, end_lineno=207, end_col_offset=20), Name(id='AttributeError', ctx=Load(), lineno=208, col_offset=8, end_lineno=208, end_col_offset=22), Name(id='ValueError', ctx=Load(), lineno=209, col_offset=8, end_lineno=209, end_col_offset=18)], ctx=Load(), lineno=206, col_offset=11, end_lineno=210, end_col_offset=5), name='exc', body=[Expr(value=Call(func=Attribute(value=Name(id='logger', ctx=Load(), lineno=211, col_offset=8, end_lineno=211, end_col_offset=14), attr='debug', ctx=Load(), lineno=211, col_offset=8, end_lineno=211, end_col_offset=20), args=[Constant(value="Unable to configure FAISS parameter 'nprobe': %s", lineno=211, col_offset=21, end_lineno=211, end_col_offset=71), Name(id='exc', ctx=Load(), lineno=211, col_offset=73, end_lineno=211, end_col_offset=76)], keywords=[keyword(arg='exc_info', value=Constant(value=True, lineno=211, col_offset=87, end_lineno=211, end_col_offset=91), lineno=211, col_offset=78, end_lineno=211, end_col_offset=91)], lineno=211, col_offset=8, end_lineno=211, end_col_offset=92), lineno=211, col_offset=8, end_lineno=211, end_col_offset=92)], lineno=206, col_offset=4, end_lineno=211, end_col_offset=92)], lineno=204, col_offset=4, end_lineno=211, end_col_offset=92)], returns=Constant(value=None, lineno=178, col_offset=5, end_lineno=178, end_col_offset=9), lineno=172, col_offset=0, end_lineno=211, end_col_offset=92)])