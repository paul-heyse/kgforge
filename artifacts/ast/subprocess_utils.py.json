Module(body=[Expr(value=Constant(value='Subprocess execution with timeouts, path sanitization, and error handling.\n\nThis module provides hardened subprocess operations with:\n- Explicit timeout enforcement\n- Path sanitization via pathlib.Path.resolve()\n- Structured error reporting via Problem Details\n- Environment variable passing via settings\n\nExamples\n--------\n>>> from pathlib import Path\n>>> from kgfoundry_common.subprocess_utils import run_subprocess\n>>> result = run_subprocess(\n...     ["echo", "hello"],\n...     timeout=10,\n...     cwd=Path("/tmp"),\n... )\n>>> print(result)\nhello\n', lineno=1, col_offset=0, end_lineno=20, end_col_offset=3), lineno=1, col_offset=0, end_lineno=20, end_col_offset=3), ImportFrom(module='__future__', names=[alias(name='annotations', lineno=24, col_offset=23, end_lineno=24, end_col_offset=34)], level=0, lineno=24, col_offset=0, end_lineno=24, end_col_offset=34), Import(names=[alias(name='logging', lineno=26, col_offset=7, end_lineno=26, end_col_offset=14)], lineno=26, col_offset=0, end_lineno=26, end_col_offset=14), ImportFrom(module='importlib', names=[alias(name='import_module', lineno=27, col_offset=22, end_lineno=27, end_col_offset=35)], level=0, lineno=27, col_offset=0, end_lineno=27, end_col_offset=35), ImportFrom(module='typing', names=[alias(name='TYPE_CHECKING', lineno=28, col_offset=19, end_lineno=28, end_col_offset=32), alias(name='Final', lineno=28, col_offset=34, end_lineno=28, end_col_offset=39), alias(name='NoReturn', lineno=28, col_offset=41, end_lineno=28, end_col_offset=49), alias(name='Protocol', lineno=28, col_offset=51, end_lineno=28, end_col_offset=59), alias(name='cast', lineno=28, col_offset=61, end_lineno=28, end_col_offset=65)], level=0, lineno=28, col_offset=0, end_lineno=28, end_col_offset=65), ImportFrom(module='kgfoundry_common.navmap_loader', names=[alias(name='load_nav_metadata', lineno=30, col_offset=43, end_lineno=30, end_col_offset=60)], level=0, lineno=30, col_offset=0, end_lineno=30, end_col_offset=60), If(test=Name(id='TYPE_CHECKING', ctx=Load(), lineno=32, col_offset=3, end_lineno=32, end_col_offset=16), body=[Import(names=[alias(name='io', lineno=33, col_offset=11, end_lineno=33, end_col_offset=13)], lineno=33, col_offset=4, end_lineno=33, end_col_offset=13), ImportFrom(module='collections.abc', names=[alias(name='Mapping', lineno=34, col_offset=32, end_lineno=34, end_col_offset=39), alias(name='Sequence', lineno=34, col_offset=41, end_lineno=34, end_col_offset=49)], level=0, lineno=34, col_offset=4, end_lineno=34, end_col_offset=49), ImportFrom(module='pathlib', names=[alias(name='Path', lineno=35, col_offset=24, end_lineno=35, end_col_offset=28)], level=0, lineno=35, col_offset=4, end_lineno=35, end_col_offset=28)], lineno=32, col_offset=0, end_lineno=35, end_col_offset=28), Assign(targets=[Name(id='logger', ctx=Store(), lineno=37, col_offset=0, end_lineno=37, end_col_offset=6)], value=Call(func=Attribute(value=Name(id='logging', ctx=Load(), lineno=37, col_offset=9, end_lineno=37, end_col_offset=16), attr='getLogger', ctx=Load(), lineno=37, col_offset=9, end_lineno=37, end_col_offset=26), args=[Name(id='__name__', ctx=Load(), lineno=37, col_offset=27, end_lineno=37, end_col_offset=35)], lineno=37, col_offset=9, end_lineno=37, end_col_offset=36), lineno=37, col_offset=0, end_lineno=37, end_col_offset=36), AnnAssign(target=Name(id='DEFAULT_TIMEOUT', ctx=Store(), lineno=40, col_offset=0, end_lineno=40, end_col_offset=15), annotation=Subscript(value=Name(id='Final', ctx=Load(), lineno=40, col_offset=17, end_lineno=40, end_col_offset=22), slice=Name(id='int', ctx=Load(), lineno=40, col_offset=23, end_lineno=40, end_col_offset=26), ctx=Load(), lineno=40, col_offset=17, end_lineno=40, end_col_offset=27), value=Constant(value=300, lineno=40, col_offset=30, end_lineno=40, end_col_offset=33), simple=1, lineno=40, col_offset=0, end_lineno=40, end_col_offset=33), AnnAssign(target=Name(id='MIN_TIMEOUT', ctx=Store(), lineno=41, col_offset=0, end_lineno=41, end_col_offset=11), annotation=Subscript(value=Name(id='Final', ctx=Load(), lineno=41, col_offset=13, end_lineno=41, end_col_offset=18), slice=Name(id='int', ctx=Load(), lineno=41, col_offset=19, end_lineno=41, end_col_offset=22), ctx=Load(), lineno=41, col_offset=13, end_lineno=41, end_col_offset=23), value=Constant(value=1, lineno=41, col_offset=26, end_lineno=41, end_col_offset=27), simple=1, lineno=41, col_offset=0, end_lineno=41, end_col_offset=27), AnnAssign(target=Name(id='MAX_TIMEOUT', ctx=Store(), lineno=42, col_offset=0, end_lineno=42, end_col_offset=11), annotation=Subscript(value=Name(id='Final', ctx=Load(), lineno=42, col_offset=13, end_lineno=42, end_col_offset=18), slice=Name(id='int', ctx=Load(), lineno=42, col_offset=19, end_lineno=42, end_col_offset=22), ctx=Load(), lineno=42, col_offset=13, end_lineno=42, end_col_offset=23), value=Constant(value=3600, lineno=42, col_offset=26, end_lineno=42, end_col_offset=30), simple=1, lineno=42, col_offset=0, end_lineno=42, end_col_offset=30), ClassDef(name='_PopenFactory', bases=[Name(id='Protocol', ctx=Load(), lineno=45, col_offset=20, end_lineno=45, end_col_offset=28)], body=[FunctionDef(name='__call__', args=arguments(args=[arg(arg='self', lineno=47, col_offset=8, end_lineno=47, end_col_offset=12), arg(arg='args', annotation=Subscript(value=Name(id='Sequence', ctx=Load(), lineno=48, col_offset=14, end_lineno=48, end_col_offset=22), slice=Name(id='str', ctx=Load(), lineno=48, col_offset=23, end_lineno=48, end_col_offset=26), ctx=Load(), lineno=48, col_offset=14, end_lineno=48, end_col_offset=27), lineno=48, col_offset=8, end_lineno=48, end_col_offset=27)], vararg=arg(arg='_unsafe_args', annotation=Name(id='object', ctx=Load(), lineno=49, col_offset=23, end_lineno=49, end_col_offset=29), lineno=49, col_offset=9, end_lineno=49, end_col_offset=29), kwarg=arg(arg='_unsafe_kwargs', annotation=Name(id='object', ctx=Load(), lineno=50, col_offset=26, end_lineno=50, end_col_offset=32), lineno=50, col_offset=10, end_lineno=50, end_col_offset=32)), body=[Expr(value=Constant(value='Create subprocess instance.\n\n        Parameters\n        ----------\n        args : Sequence[str]\n            Command arguments.\n        *_unsafe_args : object\n            Additional positional arguments (unsafe, not used).\n        **_unsafe_kwargs : object\n            Additional keyword arguments (unsafe, not used).\n\n        Returns\n        -------\n        TextProcess\n            Process instance with text I/O streams.\n        ', lineno=52, col_offset=8, end_lineno=67, end_col_offset=11), lineno=52, col_offset=8, end_lineno=67, end_col_offset=11), Expr(value=Constant(value=Ellipsis, lineno=68, col_offset=8, end_lineno=68, end_col_offset=11), lineno=68, col_offset=8, end_lineno=68, end_col_offset=11)], returns=Name(id='TextProcess', ctx=Load(), lineno=51, col_offset=9, end_lineno=51, end_col_offset=20), lineno=46, col_offset=4, end_lineno=68, end_col_offset=11)], lineno=45, col_offset=0, end_lineno=68, end_col_offset=11), ClassDef(name='_TextProcess', bases=[Name(id='Protocol', ctx=Load(), lineno=71, col_offset=19, end_lineno=71, end_col_offset=27)], body=[Expr(value=Constant(value='Protocol describing the streaming process surface we expose.', lineno=72, col_offset=4, end_lineno=72, end_col_offset=70), lineno=72, col_offset=4, end_lineno=72, end_col_offset=70), AnnAssign(target=Name(id='stdin', ctx=Store(), lineno=74, col_offset=4, end_lineno=74, end_col_offset=9), annotation=BinOp(left=Attribute(value=Name(id='io', ctx=Load(), lineno=74, col_offset=11, end_lineno=74, end_col_offset=13), attr='TextIOBase', ctx=Load(), lineno=74, col_offset=11, end_lineno=74, end_col_offset=24), op=BitOr(), right=Constant(value=None, lineno=74, col_offset=27, end_lineno=74, end_col_offset=31), lineno=74, col_offset=11, end_lineno=74, end_col_offset=31), simple=1, lineno=74, col_offset=4, end_lineno=74, end_col_offset=31), AnnAssign(target=Name(id='stdout', ctx=Store(), lineno=75, col_offset=4, end_lineno=75, end_col_offset=10), annotation=BinOp(left=Attribute(value=Name(id='io', ctx=Load(), lineno=75, col_offset=12, end_lineno=75, end_col_offset=14), attr='TextIOBase', ctx=Load(), lineno=75, col_offset=12, end_lineno=75, end_col_offset=25), op=BitOr(), right=Constant(value=None, lineno=75, col_offset=28, end_lineno=75, end_col_offset=32), lineno=75, col_offset=12, end_lineno=75, end_col_offset=32), simple=1, lineno=75, col_offset=4, end_lineno=75, end_col_offset=32), AnnAssign(target=Name(id='stderr', ctx=Store(), lineno=76, col_offset=4, end_lineno=76, end_col_offset=10), annotation=BinOp(left=Attribute(value=Name(id='io', ctx=Load(), lineno=76, col_offset=12, end_lineno=76, end_col_offset=14), attr='TextIOBase', ctx=Load(), lineno=76, col_offset=12, end_lineno=76, end_col_offset=25), op=BitOr(), right=Constant(value=None, lineno=76, col_offset=28, end_lineno=76, end_col_offset=32), lineno=76, col_offset=12, end_lineno=76, end_col_offset=32), simple=1, lineno=76, col_offset=4, end_lineno=76, end_col_offset=32), FunctionDef(name='poll', args=arguments(args=[arg(arg='self', lineno=78, col_offset=13, end_lineno=78, end_col_offset=17)]), body=[Expr(value=Constant(value='Check if process has terminated.\n\n        Returns\n        -------\n        int | None\n            Return code if process has terminated, None otherwise.\n        ', lineno=79, col_offset=8, end_lineno=85, end_col_offset=11), lineno=79, col_offset=8, end_lineno=85, end_col_offset=11), Expr(value=Constant(value=Ellipsis, lineno=86, col_offset=8, end_lineno=86, end_col_offset=11), lineno=86, col_offset=8, end_lineno=86, end_col_offset=11)], returns=BinOp(left=Name(id='int', ctx=Load(), lineno=78, col_offset=22, end_lineno=78, end_col_offset=25), op=BitOr(), right=Constant(value=None, lineno=78, col_offset=28, end_lineno=78, end_col_offset=32), lineno=78, col_offset=22, end_lineno=78, end_col_offset=32), lineno=78, col_offset=4, end_lineno=86, end_col_offset=11), FunctionDef(name='wait', args=arguments(args=[arg(arg='self', lineno=88, col_offset=13, end_lineno=88, end_col_offset=17), arg(arg='timeout', annotation=BinOp(left=Name(id='float', ctx=Load(), lineno=88, col_offset=28, end_lineno=88, end_col_offset=33), op=BitOr(), right=Constant(value=None, lineno=88, col_offset=36, end_lineno=88, end_col_offset=40), lineno=88, col_offset=28, end_lineno=88, end_col_offset=40), lineno=88, col_offset=19, end_lineno=88, end_col_offset=40)], defaults=[Constant(value=Ellipsis, lineno=88, col_offset=43, end_lineno=88, end_col_offset=46)]), body=[Expr(value=Constant(value='Wait for process to terminate.\n\n        Parameters\n        ----------\n        timeout : float | None, optional\n            Maximum time to wait in seconds.\n\n        Returns\n        -------\n        int\n            Process return code.\n        ', lineno=89, col_offset=8, end_lineno=100, end_col_offset=11), lineno=89, col_offset=8, end_lineno=100, end_col_offset=11), Expr(value=Constant(value=Ellipsis, lineno=101, col_offset=8, end_lineno=101, end_col_offset=11), lineno=101, col_offset=8, end_lineno=101, end_col_offset=11)], returns=Name(id='int', ctx=Load(), lineno=88, col_offset=51, end_lineno=88, end_col_offset=54), lineno=88, col_offset=4, end_lineno=101, end_col_offset=11), FunctionDef(name='terminate', args=arguments(args=[arg(arg='self', lineno=103, col_offset=18, end_lineno=103, end_col_offset=22)]), body=[Expr(value=Constant(value='Send SIGTERM signal to process.', lineno=104, col_offset=8, end_lineno=104, end_col_offset=45), lineno=104, col_offset=8, end_lineno=104, end_col_offset=45), Expr(value=Constant(value=Ellipsis, lineno=105, col_offset=8, end_lineno=105, end_col_offset=11), lineno=105, col_offset=8, end_lineno=105, end_col_offset=11)], returns=Constant(value=None, lineno=103, col_offset=27, end_lineno=103, end_col_offset=31), lineno=103, col_offset=4, end_lineno=105, end_col_offset=11), FunctionDef(name='kill', args=arguments(args=[arg(arg='self', lineno=107, col_offset=13, end_lineno=107, end_col_offset=17)]), body=[Expr(value=Constant(value='Send SIGKILL signal to process.', lineno=108, col_offset=8, end_lineno=108, end_col_offset=45), lineno=108, col_offset=8, end_lineno=108, end_col_offset=45), Expr(value=Constant(value=Ellipsis, lineno=109, col_offset=8, end_lineno=109, end_col_offset=11), lineno=109, col_offset=8, end_lineno=109, end_col_offset=11)], returns=Constant(value=None, lineno=107, col_offset=22, end_lineno=107, end_col_offset=26), lineno=107, col_offset=4, end_lineno=109, end_col_offset=11)], lineno=71, col_offset=0, end_lineno=109, end_col_offset=11), Assign(targets=[Name(id='TextProcess', ctx=Store(), lineno=113, col_offset=0, end_lineno=113, end_col_offset=11)], value=Name(id='_TextProcess', ctx=Load(), lineno=113, col_offset=14, end_lineno=113, end_col_offset=26), lineno=113, col_offset=0, end_lineno=113, end_col_offset=26), ClassDef(name='_ToolRunResultProtocol', bases=[Name(id='Protocol', ctx=Load(), lineno=116, col_offset=29, end_lineno=116, end_col_offset=37)], body=[AnnAssign(target=Name(id='stdout', ctx=Store(), lineno=117, col_offset=4, end_lineno=117, end_col_offset=10), annotation=Name(id='str', ctx=Load(), lineno=117, col_offset=12, end_lineno=117, end_col_offset=15), simple=1, lineno=117, col_offset=4, end_lineno=117, end_col_offset=15), AnnAssign(target=Name(id='stderr', ctx=Store(), lineno=118, col_offset=4, end_lineno=118, end_col_offset=10), annotation=Name(id='str', ctx=Load(), lineno=118, col_offset=12, end_lineno=118, end_col_offset=15), simple=1, lineno=118, col_offset=4, end_lineno=118, end_col_offset=15), AnnAssign(target=Name(id='returncode', ctx=Store(), lineno=119, col_offset=4, end_lineno=119, end_col_offset=14), annotation=Name(id='int', ctx=Load(), lineno=119, col_offset=16, end_lineno=119, end_col_offset=19), simple=1, lineno=119, col_offset=4, end_lineno=119, end_col_offset=19)], lineno=116, col_offset=0, end_lineno=119, end_col_offset=19), ClassDef(name='_AllowListPolicyProtocol', bases=[Name(id='Protocol', ctx=Load(), lineno=122, col_offset=31, end_lineno=122, end_col_offset=39)], body=[FunctionDef(name='resolve', args=arguments(args=[arg(arg='self', lineno=123, col_offset=16, end_lineno=123, end_col_offset=20), arg(arg='executable', annotation=Name(id='str', ctx=Load(), lineno=123, col_offset=34, end_lineno=123, end_col_offset=37), lineno=123, col_offset=22, end_lineno=123, end_col_offset=37), arg(arg='command', annotation=Subscript(value=Name(id='Sequence', ctx=Load(), lineno=123, col_offset=48, end_lineno=123, end_col_offset=56), slice=Name(id='str', ctx=Load(), lineno=123, col_offset=57, end_lineno=123, end_col_offset=60), ctx=Load(), lineno=123, col_offset=48, end_lineno=123, end_col_offset=61), lineno=123, col_offset=39, end_lineno=123, end_col_offset=61)]), body=[Expr(value=Constant(value='Resolve executable path using allow-list policy.\n\n        Parameters\n        ----------\n        executable : str\n            Executable name or path.\n        command : Sequence[str]\n            Full command sequence.\n\n        Returns\n        -------\n        Path\n            Resolved executable path.\n        ', lineno=124, col_offset=8, end_lineno=137, end_col_offset=11), lineno=124, col_offset=8, end_lineno=137, end_col_offset=11), Expr(value=Constant(value=Ellipsis, lineno=138, col_offset=8, end_lineno=138, end_col_offset=11), lineno=138, col_offset=8, end_lineno=138, end_col_offset=11)], returns=Name(id='Path', ctx=Load(), lineno=123, col_offset=66, end_lineno=123, end_col_offset=70), lineno=123, col_offset=4, end_lineno=138, end_col_offset=11)], lineno=122, col_offset=0, end_lineno=138, end_col_offset=11), ClassDef(name='_EnvironmentPolicyProtocol', bases=[Name(id='Protocol', ctx=Load(), lineno=141, col_offset=33, end_lineno=141, end_col_offset=41)], body=[FunctionDef(name='build', args=arguments(args=[arg(arg='self', lineno=142, col_offset=14, end_lineno=142, end_col_offset=18), arg(arg='overrides', annotation=BinOp(left=Subscript(value=Name(id='Mapping', ctx=Load(), lineno=142, col_offset=31, end_lineno=142, end_col_offset=38), slice=Tuple(elts=[Name(id='str', ctx=Load(), lineno=142, col_offset=39, end_lineno=142, end_col_offset=42), Name(id='str', ctx=Load(), lineno=142, col_offset=44, end_lineno=142, end_col_offset=47)], ctx=Load(), lineno=142, col_offset=39, end_lineno=142, end_col_offset=47), ctx=Load(), lineno=142, col_offset=31, end_lineno=142, end_col_offset=48), op=BitOr(), right=Constant(value=None, lineno=142, col_offset=51, end_lineno=142, end_col_offset=55), lineno=142, col_offset=31, end_lineno=142, end_col_offset=55), lineno=142, col_offset=20, end_lineno=142, end_col_offset=55)]), body=[Expr(value=Constant(value='Build environment mapping with overrides.\n\n        Parameters\n        ----------\n        overrides : Mapping[str, str] | None, optional\n            Environment variable overrides.\n\n        Returns\n        -------\n        Mapping[str, str]\n            Environment variable mapping.\n        ', lineno=143, col_offset=8, end_lineno=154, end_col_offset=11), lineno=143, col_offset=8, end_lineno=154, end_col_offset=11), Expr(value=Constant(value=Ellipsis, lineno=155, col_offset=8, end_lineno=155, end_col_offset=11), lineno=155, col_offset=8, end_lineno=155, end_col_offset=11)], returns=Subscript(value=Name(id='Mapping', ctx=Load(), lineno=142, col_offset=60, end_lineno=142, end_col_offset=67), slice=Tuple(elts=[Name(id='str', ctx=Load(), lineno=142, col_offset=68, end_lineno=142, end_col_offset=71), Name(id='str', ctx=Load(), lineno=142, col_offset=73, end_lineno=142, end_col_offset=76)], ctx=Load(), lineno=142, col_offset=68, end_lineno=142, end_col_offset=76), ctx=Load(), lineno=142, col_offset=60, end_lineno=142, end_col_offset=77), lineno=142, col_offset=4, end_lineno=155, end_col_offset=11)], lineno=141, col_offset=0, end_lineno=155, end_col_offset=11), ClassDef(name='_ProcessRunnerProtocol', bases=[Name(id='Protocol', ctx=Load(), lineno=158, col_offset=29, end_lineno=158, end_col_offset=37)], body=[AnnAssign(target=Name(id='allowlist', ctx=Store(), lineno=159, col_offset=4, end_lineno=159, end_col_offset=13), annotation=Name(id='_AllowListPolicyProtocol', ctx=Load(), lineno=159, col_offset=15, end_lineno=159, end_col_offset=39), simple=1, lineno=159, col_offset=4, end_lineno=159, end_col_offset=39), AnnAssign(target=Name(id='environment', ctx=Store(), lineno=160, col_offset=4, end_lineno=160, end_col_offset=15), annotation=Name(id='_EnvironmentPolicyProtocol', ctx=Load(), lineno=160, col_offset=17, end_lineno=160, end_col_offset=43), simple=1, lineno=160, col_offset=4, end_lineno=160, end_col_offset=43)], lineno=158, col_offset=0, end_lineno=160, end_col_offset=43), ClassDef(name='_RunToolCallable', bases=[Name(id='Protocol', ctx=Load(), lineno=163, col_offset=23, end_lineno=163, end_col_offset=31)], body=[FunctionDef(name='__call__', args=arguments(args=[arg(arg='self', lineno=165, col_offset=8, end_lineno=165, end_col_offset=12), arg(arg='command', annotation=Subscript(value=Name(id='Sequence', ctx=Load(), lineno=166, col_offset=17, end_lineno=166, end_col_offset=25), slice=Name(id='str', ctx=Load(), lineno=166, col_offset=26, end_lineno=166, end_col_offset=29), ctx=Load(), lineno=166, col_offset=17, end_lineno=166, end_col_offset=30), lineno=166, col_offset=8, end_lineno=166, end_col_offset=30)], kwonlyargs=[arg(arg='cwd', annotation=BinOp(left=Name(id='Path', ctx=Load(), lineno=168, col_offset=13, end_lineno=168, end_col_offset=17), op=BitOr(), right=Constant(value=None, lineno=168, col_offset=20, end_lineno=168, end_col_offset=24), lineno=168, col_offset=13, end_lineno=168, end_col_offset=24), lineno=168, col_offset=8, end_lineno=168, end_col_offset=24), arg(arg='env', annotation=BinOp(left=Subscript(value=Name(id='Mapping', ctx=Load(), lineno=169, col_offset=13, end_lineno=169, end_col_offset=20), slice=Tuple(elts=[Name(id='str', ctx=Load(), lineno=169, col_offset=21, end_lineno=169, end_col_offset=24), Name(id='str', ctx=Load(), lineno=169, col_offset=26, end_lineno=169, end_col_offset=29)], ctx=Load(), lineno=169, col_offset=21, end_lineno=169, end_col_offset=29), ctx=Load(), lineno=169, col_offset=13, end_lineno=169, end_col_offset=30), op=BitOr(), right=Constant(value=None, lineno=169, col_offset=33, end_lineno=169, end_col_offset=37), lineno=169, col_offset=13, end_lineno=169, end_col_offset=37), lineno=169, col_offset=8, end_lineno=169, end_col_offset=37), arg(arg='timeout', annotation=BinOp(left=Name(id='float', ctx=Load(), lineno=170, col_offset=17, end_lineno=170, end_col_offset=22), op=BitOr(), right=Constant(value=None, lineno=170, col_offset=25, end_lineno=170, end_col_offset=29), lineno=170, col_offset=17, end_lineno=170, end_col_offset=29), lineno=170, col_offset=8, end_lineno=170, end_col_offset=29), arg(arg='check', annotation=Name(id='bool', ctx=Load(), lineno=171, col_offset=15, end_lineno=171, end_col_offset=19), lineno=171, col_offset=8, end_lineno=171, end_col_offset=19)], kw_defaults=[Constant(value=Ellipsis, lineno=168, col_offset=27, end_lineno=168, end_col_offset=30), Constant(value=Ellipsis, lineno=169, col_offset=40, end_lineno=169, end_col_offset=43), Constant(value=Ellipsis, lineno=170, col_offset=32, end_lineno=170, end_col_offset=35), Constant(value=Ellipsis, lineno=171, col_offset=22, end_lineno=171, end_col_offset=25)]), body=[Expr(value=Constant(value='Execute a tool command.\n\n        Parameters\n        ----------\n        command : Sequence[str]\n            Command to execute.\n        cwd : Path | None, optional\n            Working directory for execution.\n        env : Mapping[str, str] | None, optional\n            Environment variable overrides.\n        timeout : float | None, optional\n            Maximum execution time in seconds.\n        check : bool, optional\n            Whether to raise on non-zero return code.\n\n        Returns\n        -------\n        _ToolRunResultProtocol\n            Execution result with stdout, stderr, and returncode.\n        ', lineno=173, col_offset=8, end_lineno=192, end_col_offset=11), lineno=173, col_offset=8, end_lineno=192, end_col_offset=11), Expr(value=Constant(value=Ellipsis, lineno=193, col_offset=8, end_lineno=193, end_col_offset=11), lineno=193, col_offset=8, end_lineno=193, end_col_offset=11)], returns=Name(id='_ToolRunResultProtocol', ctx=Load(), lineno=172, col_offset=9, end_lineno=172, end_col_offset=31), lineno=164, col_offset=4, end_lineno=193, end_col_offset=11)], lineno=163, col_offset=0, end_lineno=193, end_col_offset=11), ClassDef(name='_GetProcessRunnerCallable', bases=[Name(id='Protocol', ctx=Load(), lineno=196, col_offset=32, end_lineno=196, end_col_offset=40)], body=[FunctionDef(name='__call__', args=arguments(args=[arg(arg='self', lineno=197, col_offset=17, end_lineno=197, end_col_offset=21)]), body=[Expr(value=Constant(value='Get process runner instance.\n\n        Returns\n        -------\n        _ProcessRunnerProtocol\n            Process runner with allowlist and environment policies.\n        ', lineno=198, col_offset=8, end_lineno=204, end_col_offset=11), lineno=198, col_offset=8, end_lineno=204, end_col_offset=11), Expr(value=Constant(value=Ellipsis, lineno=205, col_offset=8, end_lineno=205, end_col_offset=11), lineno=205, col_offset=8, end_lineno=205, end_col_offset=11)], returns=Name(id='_ProcessRunnerProtocol', ctx=Load(), lineno=197, col_offset=26, end_lineno=197, end_col_offset=48), lineno=197, col_offset=4, end_lineno=205, end_col_offset=11)], lineno=196, col_offset=0, end_lineno=205, end_col_offset=11), ClassDef(name='_ToolsSurface', bases=[Name(id='Protocol', ctx=Load(), lineno=208, col_offset=20, end_lineno=208, end_col_offset=28)], body=[AnnAssign(target=Name(id='ToolExecutionError', ctx=Store(), lineno=209, col_offset=4, end_lineno=209, end_col_offset=22), annotation=Subscript(value=Name(id='type', ctx=Load(), lineno=209, col_offset=24, end_lineno=209, end_col_offset=28), slice=Name(id='Exception', ctx=Load(), lineno=209, col_offset=29, end_lineno=209, end_col_offset=38), ctx=Load(), lineno=209, col_offset=24, end_lineno=209, end_col_offset=39), simple=1, lineno=209, col_offset=4, end_lineno=209, end_col_offset=39), AnnAssign(target=Name(id='run_tool', ctx=Store(), lineno=210, col_offset=4, end_lineno=210, end_col_offset=12), annotation=Name(id='_RunToolCallable', ctx=Load(), lineno=210, col_offset=14, end_lineno=210, end_col_offset=30), simple=1, lineno=210, col_offset=4, end_lineno=210, end_col_offset=30), AnnAssign(target=Name(id='get_process_runner', ctx=Store(), lineno=211, col_offset=4, end_lineno=211, end_col_offset=22), annotation=Name(id='_GetProcessRunnerCallable', ctx=Load(), lineno=211, col_offset=24, end_lineno=211, end_col_offset=49), simple=1, lineno=211, col_offset=4, end_lineno=211, end_col_offset=49)], lineno=208, col_offset=0, end_lineno=211, end_col_offset=49), ClassDef(name='_ToolExecutionErrorSurface', bases=[Name(id='Protocol', ctx=Load(), lineno=214, col_offset=33, end_lineno=214, end_col_offset=41)], body=[AnnAssign(target=Name(id='problem', ctx=Store(), lineno=215, col_offset=4, end_lineno=215, end_col_offset=11), annotation=BinOp(left=Subscript(value=Name(id='Mapping', ctx=Load(), lineno=215, col_offset=13, end_lineno=215, end_col_offset=20), slice=Tuple(elts=[Name(id='str', ctx=Load(), lineno=215, col_offset=21, end_lineno=215, end_col_offset=24), Name(id='object', ctx=Load(), lineno=215, col_offset=26, end_lineno=215, end_col_offset=32)], ctx=Load(), lineno=215, col_offset=21, end_lineno=215, end_col_offset=32), ctx=Load(), lineno=215, col_offset=13, end_lineno=215, end_col_offset=33), op=BitOr(), right=Constant(value=None, lineno=215, col_offset=36, end_lineno=215, end_col_offset=40), lineno=215, col_offset=13, end_lineno=215, end_col_offset=40), simple=1, lineno=215, col_offset=4, end_lineno=215, end_col_offset=40), AnnAssign(target=Name(id='returncode', ctx=Store(), lineno=216, col_offset=4, end_lineno=216, end_col_offset=14), annotation=BinOp(left=Name(id='int', ctx=Load(), lineno=216, col_offset=16, end_lineno=216, end_col_offset=19), op=BitOr(), right=Constant(value=None, lineno=216, col_offset=22, end_lineno=216, end_col_offset=26), lineno=216, col_offset=16, end_lineno=216, end_col_offset=26), simple=1, lineno=216, col_offset=4, end_lineno=216, end_col_offset=26), AnnAssign(target=Name(id='stderr', ctx=Store(), lineno=217, col_offset=4, end_lineno=217, end_col_offset=10), annotation=Name(id='str', ctx=Load(), lineno=217, col_offset=12, end_lineno=217, end_col_offset=15), simple=1, lineno=217, col_offset=4, end_lineno=217, end_col_offset=15)], lineno=214, col_offset=0, end_lineno=217, end_col_offset=15), ClassDef(name='_ToolExecutionErrorConstructor', bases=[Name(id='Protocol', ctx=Load(), lineno=220, col_offset=37, end_lineno=220, end_col_offset=45)], body=[FunctionDef(name='__call__', args=arguments(args=[arg(arg='self', lineno=221, col_offset=17, end_lineno=221, end_col_offset=21), arg(arg='message', annotation=Name(id='str', ctx=Load(), lineno=221, col_offset=32, end_lineno=221, end_col_offset=35), lineno=221, col_offset=23, end_lineno=221, end_col_offset=35)], kwonlyargs=[arg(arg='command', annotation=Subscript(value=Name(id='Sequence', ctx=Load(), lineno=221, col_offset=49, end_lineno=221, end_col_offset=57), slice=Name(id='str', ctx=Load(), lineno=221, col_offset=58, end_lineno=221, end_col_offset=61), ctx=Load(), lineno=221, col_offset=49, end_lineno=221, end_col_offset=62), lineno=221, col_offset=40, end_lineno=221, end_col_offset=62)], kw_defaults=[None], kwarg=arg(arg='kwargs', annotation=Name(id='object', ctx=Load(), lineno=221, col_offset=74, end_lineno=221, end_col_offset=80), lineno=221, col_offset=66, end_lineno=221, end_col_offset=80)), body=[Expr(value=Constant(value='Create tool execution error.\n\n        Parameters\n        ----------\n        message : str\n            Error message.\n        command : Sequence[str]\n            Command that failed.\n        **kwargs : object\n            Additional error context.\n\n        Returns\n        -------\n        Exception\n            Exception instance.\n        ', lineno=222, col_offset=8, end_lineno=237, end_col_offset=11), lineno=222, col_offset=8, end_lineno=237, end_col_offset=11), Expr(value=Constant(value=Ellipsis, lineno=238, col_offset=8, end_lineno=238, end_col_offset=11), lineno=238, col_offset=8, end_lineno=238, end_col_offset=11)], returns=Name(id='Exception', ctx=Load(), lineno=221, col_offset=85, end_lineno=221, end_col_offset=94), lineno=221, col_offset=4, end_lineno=238, end_col_offset=11)], lineno=220, col_offset=0, end_lineno=238, end_col_offset=11), FunctionDef(name='_load_tools_surface', args=arguments(), body=[Try(body=[Assign(targets=[Name(id='module', ctx=Store(), lineno=243, col_offset=8, end_lineno=243, end_col_offset=14)], value=Call(func=Name(id='import_module', ctx=Load(), lineno=243, col_offset=17, end_lineno=243, end_col_offset=30), args=[Constant(value='tools', lineno=243, col_offset=31, end_lineno=243, end_col_offset=38)], lineno=243, col_offset=17, end_lineno=243, end_col_offset=39), lineno=243, col_offset=8, end_lineno=243, end_col_offset=39)], handlers=[ExceptHandler(type=Name(id='ImportError', ctx=Load(), lineno=244, col_offset=11, end_lineno=244, end_col_offset=22), name='exc', body=[Assign(targets=[Name(id='msg', ctx=Store(), lineno=245, col_offset=8, end_lineno=245, end_col_offset=11)], value=Constant(value="The 'tools' package is required to execute subprocess utilities. Install the 'kgfoundry[tools]' extra and retry.", lineno=246, col_offset=12, end_lineno=247, end_col_offset=61), lineno=245, col_offset=8, end_lineno=248, end_col_offset=9), Raise(exc=Call(func=Name(id='RuntimeError', ctx=Load(), lineno=249, col_offset=14, end_lineno=249, end_col_offset=26), args=[Name(id='msg', ctx=Load(), lineno=249, col_offset=27, end_lineno=249, end_col_offset=30)], lineno=249, col_offset=14, end_lineno=249, end_col_offset=31), cause=Name(id='exc', ctx=Load(), lineno=249, col_offset=37, end_lineno=249, end_col_offset=40), lineno=249, col_offset=8, end_lineno=249, end_col_offset=40)], lineno=244, col_offset=4, end_lineno=249, end_col_offset=40)], lineno=242, col_offset=4, end_lineno=249, end_col_offset=40), Return(value=Call(func=Name(id='cast', ctx=Load(), lineno=250, col_offset=11, end_lineno=250, end_col_offset=15), args=[Constant(value='_ToolsSurface', lineno=250, col_offset=16, end_lineno=250, end_col_offset=31), Name(id='module', ctx=Load(), lineno=250, col_offset=33, end_lineno=250, end_col_offset=39)], lineno=250, col_offset=11, end_lineno=250, end_col_offset=40), lineno=250, col_offset=4, end_lineno=250, end_col_offset=40)], returns=Name(id='_ToolsSurface', ctx=Load(), lineno=241, col_offset=29, end_lineno=241, end_col_offset=42), lineno=241, col_offset=0, end_lineno=250, end_col_offset=40), FunctionDef(name='_raise_tool_execution_error', args=arguments(args=[arg(arg='tools_surface', annotation=Name(id='_ToolsSurface', ctx=Load(), lineno=254, col_offset=19, end_lineno=254, end_col_offset=32), lineno=254, col_offset=4, end_lineno=254, end_col_offset=32), arg(arg='message', annotation=Name(id='str', ctx=Load(), lineno=255, col_offset=13, end_lineno=255, end_col_offset=16), lineno=255, col_offset=4, end_lineno=255, end_col_offset=16)], kwonlyargs=[arg(arg='command', annotation=Subscript(value=Name(id='Sequence', ctx=Load(), lineno=257, col_offset=13, end_lineno=257, end_col_offset=21), slice=Name(id='str', ctx=Load(), lineno=257, col_offset=22, end_lineno=257, end_col_offset=25), ctx=Load(), lineno=257, col_offset=13, end_lineno=257, end_col_offset=26), lineno=257, col_offset=4, end_lineno=257, end_col_offset=26)], kw_defaults=[None]), body=[Assign(targets=[Name(id='tool_error', ctx=Store(), lineno=259, col_offset=4, end_lineno=259, end_col_offset=14)], value=Call(func=Name(id='cast', ctx=Load(), lineno=259, col_offset=17, end_lineno=259, end_col_offset=21), args=[Constant(value='_ToolExecutionErrorConstructor', lineno=259, col_offset=22, end_lineno=259, end_col_offset=54), Attribute(value=Name(id='tools_surface', ctx=Load(), lineno=259, col_offset=56, end_lineno=259, end_col_offset=69), attr='ToolExecutionError', ctx=Load(), lineno=259, col_offset=56, end_lineno=259, end_col_offset=88)], lineno=259, col_offset=17, end_lineno=259, end_col_offset=89), lineno=259, col_offset=4, end_lineno=259, end_col_offset=89), Raise(exc=Call(func=Name(id='tool_error', ctx=Load(), lineno=260, col_offset=10, end_lineno=260, end_col_offset=20), args=[Name(id='message', ctx=Load(), lineno=260, col_offset=21, end_lineno=260, end_col_offset=28)], keywords=[keyword(arg='command', value=Call(func=Name(id='list', ctx=Load(), lineno=260, col_offset=38, end_lineno=260, end_col_offset=42), args=[Name(id='command', ctx=Load(), lineno=260, col_offset=43, end_lineno=260, end_col_offset=50)], lineno=260, col_offset=38, end_lineno=260, end_col_offset=51), lineno=260, col_offset=30, end_lineno=260, end_col_offset=51)], lineno=260, col_offset=10, end_lineno=260, end_col_offset=52), lineno=260, col_offset=4, end_lineno=260, end_col_offset=52)], returns=Name(id='NoReturn', ctx=Load(), lineno=258, col_offset=5, end_lineno=258, end_col_offset=13), lineno=253, col_offset=0, end_lineno=260, end_col_offset=52), Assign(targets=[Name(id='_subprocess_module', ctx=Store(), lineno=263, col_offset=0, end_lineno=263, end_col_offset=18)], value=Call(func=Name(id='import_module', ctx=Load(), lineno=263, col_offset=21, end_lineno=263, end_col_offset=34), args=[BinOp(left=Constant(value='sub', lineno=263, col_offset=35, end_lineno=263, end_col_offset=40), op=Add(), right=Constant(value='process', lineno=263, col_offset=43, end_lineno=263, end_col_offset=52), lineno=263, col_offset=35, end_lineno=263, end_col_offset=52)], lineno=263, col_offset=21, end_lineno=263, end_col_offset=53), lineno=263, col_offset=0, end_lineno=263, end_col_offset=53), Assign(targets=[Name(id='_PIPE', ctx=Store(), lineno=264, col_offset=0, end_lineno=264, end_col_offset=5)], value=Call(func=Name(id='cast', ctx=Load(), lineno=264, col_offset=8, end_lineno=264, end_col_offset=12), args=[Constant(value='int', lineno=264, col_offset=13, end_lineno=264, end_col_offset=18), Attribute(value=Name(id='_subprocess_module', ctx=Load(), lineno=264, col_offset=20, end_lineno=264, end_col_offset=38), attr='PIPE', ctx=Load(), lineno=264, col_offset=20, end_lineno=264, end_col_offset=43)], lineno=264, col_offset=8, end_lineno=264, end_col_offset=44), lineno=264, col_offset=0, end_lineno=264, end_col_offset=44), Assign(targets=[Name(id='_Popen', ctx=Store(), lineno=265, col_offset=0, end_lineno=265, end_col_offset=6)], value=Call(func=Name(id='cast', ctx=Load(), lineno=265, col_offset=9, end_lineno=265, end_col_offset=13), args=[Constant(value='_PopenFactory', lineno=265, col_offset=14, end_lineno=265, end_col_offset=29), Attribute(value=Name(id='_subprocess_module', ctx=Load(), lineno=265, col_offset=31, end_lineno=265, end_col_offset=49), attr='Popen', ctx=Load(), lineno=265, col_offset=31, end_lineno=265, end_col_offset=55)], lineno=265, col_offset=9, end_lineno=265, end_col_offset=56), lineno=265, col_offset=0, end_lineno=265, end_col_offset=56), Assign(targets=[Name(id='TimeoutExpired', ctx=Store(), lineno=267, col_offset=0, end_lineno=267, end_col_offset=14)], value=Call(func=Name(id='cast', ctx=Load(), lineno=267, col_offset=17, end_lineno=267, end_col_offset=21), args=[Constant(value='type[TimeoutError]', lineno=267, col_offset=22, end_lineno=267, end_col_offset=42), Attribute(value=Name(id='_subprocess_module', ctx=Load(), lineno=267, col_offset=44, end_lineno=267, end_col_offset=62), attr='TimeoutExpired', ctx=Load(), lineno=267, col_offset=44, end_lineno=267, end_col_offset=77)], lineno=267, col_offset=17, end_lineno=267, end_col_offset=78), lineno=267, col_offset=0, end_lineno=267, end_col_offset=78), ClassDef(name='SubprocessTimeoutError', bases=[Name(id='TimeoutError', ctx=Load(), lineno=271, col_offset=29, end_lineno=271, end_col_offset=41)], body=[Expr(value=Constant(value='Raised when subprocess exceeds configured timeout.\n\n    Parameters\n    ----------\n    message : str\n        Error description.\n    command : list[str] | None, optional\n        The command that timed out.\n    timeout_seconds : int | None, optional\n        The timeout that was configured.\n    ', lineno=272, col_offset=4, end_lineno=282, end_col_offset=7), lineno=272, col_offset=4, end_lineno=282, end_col_offset=7), FunctionDef(name='__init__', args=arguments(args=[arg(arg='self', lineno=285, col_offset=8, end_lineno=285, end_col_offset=12), arg(arg='message', annotation=Name(id='str', ctx=Load(), lineno=286, col_offset=17, end_lineno=286, end_col_offset=20), lineno=286, col_offset=8, end_lineno=286, end_col_offset=20), arg(arg='command', annotation=BinOp(left=Subscript(value=Name(id='list', ctx=Load(), lineno=287, col_offset=17, end_lineno=287, end_col_offset=21), slice=Name(id='str', ctx=Load(), lineno=287, col_offset=22, end_lineno=287, end_col_offset=25), ctx=Load(), lineno=287, col_offset=17, end_lineno=287, end_col_offset=26), op=BitOr(), right=Constant(value=None, lineno=287, col_offset=29, end_lineno=287, end_col_offset=33), lineno=287, col_offset=17, end_lineno=287, end_col_offset=33), lineno=287, col_offset=8, end_lineno=287, end_col_offset=33), arg(arg='timeout_seconds', annotation=BinOp(left=Name(id='int', ctx=Load(), lineno=288, col_offset=25, end_lineno=288, end_col_offset=28), op=BitOr(), right=Constant(value=None, lineno=288, col_offset=31, end_lineno=288, end_col_offset=35), lineno=288, col_offset=25, end_lineno=288, end_col_offset=35), lineno=288, col_offset=8, end_lineno=288, end_col_offset=35)], defaults=[Constant(value=None, lineno=287, col_offset=36, end_lineno=287, end_col_offset=40), Constant(value=None, lineno=288, col_offset=38, end_lineno=288, end_col_offset=42)]), body=[Expr(value=Call(func=Attribute(value=Call(func=Name(id='super', ctx=Load(), lineno=290, col_offset=8, end_lineno=290, end_col_offset=13), lineno=290, col_offset=8, end_lineno=290, end_col_offset=15), attr='__init__', ctx=Load(), lineno=290, col_offset=8, end_lineno=290, end_col_offset=24), args=[Name(id='message', ctx=Load(), lineno=290, col_offset=25, end_lineno=290, end_col_offset=32)], lineno=290, col_offset=8, end_lineno=290, end_col_offset=33), lineno=290, col_offset=8, end_lineno=290, end_col_offset=33), Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=291, col_offset=8, end_lineno=291, end_col_offset=12), attr='command', ctx=Store(), lineno=291, col_offset=8, end_lineno=291, end_col_offset=20)], value=Name(id='command', ctx=Load(), lineno=291, col_offset=23, end_lineno=291, end_col_offset=30), lineno=291, col_offset=8, end_lineno=291, end_col_offset=30), Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=292, col_offset=8, end_lineno=292, end_col_offset=12), attr='timeout_seconds', ctx=Store(), lineno=292, col_offset=8, end_lineno=292, end_col_offset=28)], value=Name(id='timeout_seconds', ctx=Load(), lineno=292, col_offset=31, end_lineno=292, end_col_offset=46), lineno=292, col_offset=8, end_lineno=292, end_col_offset=46)], returns=Constant(value=None, lineno=289, col_offset=9, end_lineno=289, end_col_offset=13), lineno=284, col_offset=4, end_lineno=292, end_col_offset=46)], lineno=271, col_offset=0, end_lineno=292, end_col_offset=46), ClassDef(name='SubprocessError', bases=[Name(id='RuntimeError', ctx=Load(), lineno=296, col_offset=22, end_lineno=296, end_col_offset=34)], body=[Expr(value=Constant(value='Raised when subprocess execution fails.\n\n    Parameters\n    ----------\n    message : str\n        Error description.\n    returncode : int | None, optional\n        Exit code from subprocess. Defaults to None.\n    stderr : str | None, optional\n        Captured stderr output. Defaults to None.\n    ', lineno=297, col_offset=4, end_lineno=307, end_col_offset=7), lineno=297, col_offset=4, end_lineno=307, end_col_offset=7), FunctionDef(name='__init__', args=arguments(args=[arg(arg='self', lineno=310, col_offset=8, end_lineno=310, end_col_offset=12), arg(arg='message', annotation=Name(id='str', ctx=Load(), lineno=310, col_offset=23, end_lineno=310, end_col_offset=26), lineno=310, col_offset=14, end_lineno=310, end_col_offset=26), arg(arg='returncode', annotation=BinOp(left=Name(id='int', ctx=Load(), lineno=310, col_offset=40, end_lineno=310, end_col_offset=43), op=BitOr(), right=Constant(value=None, lineno=310, col_offset=46, end_lineno=310, end_col_offset=50), lineno=310, col_offset=40, end_lineno=310, end_col_offset=50), lineno=310, col_offset=28, end_lineno=310, end_col_offset=50), arg(arg='stderr', annotation=BinOp(left=Name(id='str', ctx=Load(), lineno=310, col_offset=67, end_lineno=310, end_col_offset=70), op=BitOr(), right=Constant(value=None, lineno=310, col_offset=73, end_lineno=310, end_col_offset=77), lineno=310, col_offset=67, end_lineno=310, end_col_offset=77), lineno=310, col_offset=59, end_lineno=310, end_col_offset=77)], defaults=[Constant(value=None, lineno=310, col_offset=53, end_lineno=310, end_col_offset=57), Constant(value=None, lineno=310, col_offset=80, end_lineno=310, end_col_offset=84)]), body=[Expr(value=Call(func=Attribute(value=Call(func=Name(id='super', ctx=Load(), lineno=312, col_offset=8, end_lineno=312, end_col_offset=13), lineno=312, col_offset=8, end_lineno=312, end_col_offset=15), attr='__init__', ctx=Load(), lineno=312, col_offset=8, end_lineno=312, end_col_offset=24), args=[Name(id='message', ctx=Load(), lineno=312, col_offset=25, end_lineno=312, end_col_offset=32)], lineno=312, col_offset=8, end_lineno=312, end_col_offset=33), lineno=312, col_offset=8, end_lineno=312, end_col_offset=33), Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=313, col_offset=8, end_lineno=313, end_col_offset=12), attr='returncode', ctx=Store(), lineno=313, col_offset=8, end_lineno=313, end_col_offset=23)], value=Name(id='returncode', ctx=Load(), lineno=313, col_offset=26, end_lineno=313, end_col_offset=36), lineno=313, col_offset=8, end_lineno=313, end_col_offset=36), Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=314, col_offset=8, end_lineno=314, end_col_offset=12), attr='stderr', ctx=Store(), lineno=314, col_offset=8, end_lineno=314, end_col_offset=19)], value=Name(id='stderr', ctx=Load(), lineno=314, col_offset=22, end_lineno=314, end_col_offset=28), lineno=314, col_offset=8, end_lineno=314, end_col_offset=28)], returns=Constant(value=None, lineno=311, col_offset=9, end_lineno=311, end_col_offset=13), lineno=309, col_offset=4, end_lineno=314, end_col_offset=28)], lineno=296, col_offset=0, end_lineno=314, end_col_offset=28), FunctionDef(name='run_subprocess', args=arguments(args=[arg(arg='cmd', annotation=Subscript(value=Name(id='list', ctx=Load(), lineno=319, col_offset=9, end_lineno=319, end_col_offset=13), slice=Name(id='str', ctx=Load(), lineno=319, col_offset=14, end_lineno=319, end_col_offset=17), ctx=Load(), lineno=319, col_offset=9, end_lineno=319, end_col_offset=18), lineno=319, col_offset=4, end_lineno=319, end_col_offset=18)], kwonlyargs=[arg(arg='timeout', annotation=BinOp(left=Name(id='int', ctx=Load(), lineno=321, col_offset=13, end_lineno=321, end_col_offset=16), op=BitOr(), right=Constant(value=None, lineno=321, col_offset=19, end_lineno=321, end_col_offset=23), lineno=321, col_offset=13, end_lineno=321, end_col_offset=23), lineno=321, col_offset=4, end_lineno=321, end_col_offset=23), arg(arg='cwd', annotation=BinOp(left=Name(id='Path', ctx=Load(), lineno=322, col_offset=9, end_lineno=322, end_col_offset=13), op=BitOr(), right=Constant(value=None, lineno=322, col_offset=16, end_lineno=322, end_col_offset=20), lineno=322, col_offset=9, end_lineno=322, end_col_offset=20), lineno=322, col_offset=4, end_lineno=322, end_col_offset=20), arg(arg='env', annotation=BinOp(left=Subscript(value=Name(id='Mapping', ctx=Load(), lineno=323, col_offset=9, end_lineno=323, end_col_offset=16), slice=Tuple(elts=[Name(id='str', ctx=Load(), lineno=323, col_offset=17, end_lineno=323, end_col_offset=20), Name(id='str', ctx=Load(), lineno=323, col_offset=22, end_lineno=323, end_col_offset=25)], ctx=Load(), lineno=323, col_offset=17, end_lineno=323, end_col_offset=25), ctx=Load(), lineno=323, col_offset=9, end_lineno=323, end_col_offset=26), op=BitOr(), right=Constant(value=None, lineno=323, col_offset=29, end_lineno=323, end_col_offset=33), lineno=323, col_offset=9, end_lineno=323, end_col_offset=33), lineno=323, col_offset=4, end_lineno=323, end_col_offset=33)], kw_defaults=[Constant(value=None, lineno=321, col_offset=26, end_lineno=321, end_col_offset=30), Constant(value=None, lineno=322, col_offset=23, end_lineno=322, end_col_offset=27), Constant(value=None, lineno=323, col_offset=36, end_lineno=323, end_col_offset=40)]), body=[Expr(value=Constant(value='Execute subprocess with timeout, path sanitization, and error handling.\n\n    Parameters\n    ----------\n    cmd : list[str]\n        Command and arguments to execute.\n        Command arguments are NOT shell-interpreted; each arg is literal.\n    timeout : int | None, optional\n        Maximum execution time in seconds.\n        If None, defaults to DEFAULT_TIMEOUT.\n        Must be between MIN_TIMEOUT and MAX_TIMEOUT.\n    cwd : Path | None, optional\n        Working directory for subprocess.\n        If provided, will be resolved to absolute path and sanitized.\n    env : Mapping[str, str] | None, optional\n        Environment variables to pass to subprocess.\n        If None, inherits parent environment.\n\n    Returns\n    -------\n    str\n        Captured stdout from subprocess.\n\n    Raises\n    ------\n    SubprocessTimeoutError\n        If subprocess exceeds timeout.\n    SubprocessError\n        If subprocess exits with non-zero status.\n    ValueError\n        If parameters are invalid (negative timeout, etc).\n\n    Examples\n    --------\n    >>> result = run_subprocess(\n    ...     ["python", "-c", "print(\'test\')"],\n    ...     timeout=10,\n    ... )\n    >>> assert "test" in result\n\n    Notes\n    -----\n    This function does NOT use shell=True; each command element is\n    passed literally to the OS, preventing shell injection attacks.\n    ', lineno=325, col_offset=4, end_lineno=369, end_col_offset=7), lineno=325, col_offset=4, end_lineno=369, end_col_offset=7), If(test=Compare(left=Name(id='timeout', ctx=Load(), lineno=371, col_offset=7, end_lineno=371, end_col_offset=14), ops=[Is()], comparators=[Constant(value=None, lineno=371, col_offset=18, end_lineno=371, end_col_offset=22)], lineno=371, col_offset=7, end_lineno=371, end_col_offset=22), body=[Assign(targets=[Name(id='timeout', ctx=Store(), lineno=372, col_offset=8, end_lineno=372, end_col_offset=15)], value=Name(id='DEFAULT_TIMEOUT', ctx=Load(), lineno=372, col_offset=18, end_lineno=372, end_col_offset=33), lineno=372, col_offset=8, end_lineno=372, end_col_offset=33)], lineno=371, col_offset=4, end_lineno=372, end_col_offset=33), If(test=UnaryOp(op=Not(), operand=Compare(left=Name(id='MIN_TIMEOUT', ctx=Load(), lineno=373, col_offset=11, end_lineno=373, end_col_offset=22), ops=[LtE(), LtE()], comparators=[Name(id='timeout', ctx=Load(), lineno=373, col_offset=26, end_lineno=373, end_col_offset=33), Name(id='MAX_TIMEOUT', ctx=Load(), lineno=373, col_offset=37, end_lineno=373, end_col_offset=48)], lineno=373, col_offset=11, end_lineno=373, end_col_offset=48), lineno=373, col_offset=7, end_lineno=373, end_col_offset=48), body=[Assign(targets=[Name(id='msg', ctx=Store(), lineno=374, col_offset=8, end_lineno=374, end_col_offset=11)], value=JoinedStr(values=[Constant(value='Timeout must be between ', lineno=374, col_offset=16, end_lineno=374, end_col_offset=40), FormattedValue(value=Name(id='MIN_TIMEOUT', ctx=Load(), lineno=374, col_offset=41, end_lineno=374, end_col_offset=52), conversion=-1, lineno=374, col_offset=40, end_lineno=374, end_col_offset=53), Constant(value=' and ', lineno=374, col_offset=53, end_lineno=374, end_col_offset=58), FormattedValue(value=Name(id='MAX_TIMEOUT', ctx=Load(), lineno=374, col_offset=59, end_lineno=374, end_col_offset=70), conversion=-1, lineno=374, col_offset=58, end_lineno=374, end_col_offset=71), Constant(value=', got ', lineno=374, col_offset=71, end_lineno=374, end_col_offset=77), FormattedValue(value=Name(id='timeout', ctx=Load(), lineno=374, col_offset=78, end_lineno=374, end_col_offset=85), conversion=-1, lineno=374, col_offset=77, end_lineno=374, end_col_offset=86)], lineno=374, col_offset=14, end_lineno=374, end_col_offset=87), lineno=374, col_offset=8, end_lineno=374, end_col_offset=87), Raise(exc=Call(func=Name(id='ValueError', ctx=Load(), lineno=375, col_offset=14, end_lineno=375, end_col_offset=24), args=[Name(id='msg', ctx=Load(), lineno=375, col_offset=25, end_lineno=375, end_col_offset=28)], lineno=375, col_offset=14, end_lineno=375, end_col_offset=29), lineno=375, col_offset=8, end_lineno=375, end_col_offset=29)], lineno=373, col_offset=4, end_lineno=375, end_col_offset=29), If(test=Compare(left=Name(id='cwd', ctx=Load(), lineno=378, col_offset=7, end_lineno=378, end_col_offset=10), ops=[IsNot()], comparators=[Constant(value=None, lineno=378, col_offset=18, end_lineno=378, end_col_offset=22)], lineno=378, col_offset=7, end_lineno=378, end_col_offset=22), body=[Assign(targets=[Name(id='cwd', ctx=Store(), lineno=379, col_offset=8, end_lineno=379, end_col_offset=11)], value=Call(func=Attribute(value=Name(id='cwd', ctx=Load(), lineno=379, col_offset=14, end_lineno=379, end_col_offset=17), attr='resolve', ctx=Load(), lineno=379, col_offset=14, end_lineno=379, end_col_offset=25), lineno=379, col_offset=14, end_lineno=379, end_col_offset=27), lineno=379, col_offset=8, end_lineno=379, end_col_offset=27), Expr(value=Call(func=Attribute(value=Name(id='logger', ctx=Load(), lineno=380, col_offset=8, end_lineno=380, end_col_offset=14), attr='debug', ctx=Load(), lineno=380, col_offset=8, end_lineno=380, end_col_offset=20), args=[Constant(value='Subprocess working directory sanitized', lineno=380, col_offset=21, end_lineno=380, end_col_offset=61)], keywords=[keyword(arg='extra', value=Dict(keys=[Constant(value='cwd', lineno=380, col_offset=70, end_lineno=380, end_col_offset=75)], values=[Call(func=Name(id='str', ctx=Load(), lineno=380, col_offset=77, end_lineno=380, end_col_offset=80), args=[Name(id='cwd', ctx=Load(), lineno=380, col_offset=81, end_lineno=380, end_col_offset=84)], lineno=380, col_offset=77, end_lineno=380, end_col_offset=85)], lineno=380, col_offset=69, end_lineno=380, end_col_offset=86), lineno=380, col_offset=63, end_lineno=380, end_col_offset=86)], lineno=380, col_offset=8, end_lineno=380, end_col_offset=87), lineno=380, col_offset=8, end_lineno=380, end_col_offset=87)], lineno=378, col_offset=4, end_lineno=380, end_col_offset=87), Expr(value=Call(func=Attribute(value=Name(id='logger', ctx=Load(), lineno=382, col_offset=4, end_lineno=382, end_col_offset=10), attr='debug', ctx=Load(), lineno=382, col_offset=4, end_lineno=382, end_col_offset=16), args=[Constant(value='Executing subprocess', lineno=383, col_offset=8, end_lineno=383, end_col_offset=30)], keywords=[keyword(arg='extra', value=Dict(keys=[Constant(value='command', lineno=385, col_offset=12, end_lineno=385, end_col_offset=21), Constant(value='timeout', lineno=386, col_offset=12, end_lineno=386, end_col_offset=21), Constant(value='cwd', lineno=387, col_offset=12, end_lineno=387, end_col_offset=17)], values=[Call(func=Attribute(value=Constant(value=' ', lineno=385, col_offset=23, end_lineno=385, end_col_offset=26), attr='join', ctx=Load(), lineno=385, col_offset=23, end_lineno=385, end_col_offset=31), args=[Name(id='cmd', ctx=Load(), lineno=385, col_offset=32, end_lineno=385, end_col_offset=35)], lineno=385, col_offset=23, end_lineno=385, end_col_offset=36), Name(id='timeout', ctx=Load(), lineno=386, col_offset=23, end_lineno=386, end_col_offset=30), IfExp(test=Name(id='cwd', ctx=Load(), lineno=387, col_offset=31, end_lineno=387, end_col_offset=34), body=Call(func=Name(id='str', ctx=Load(), lineno=387, col_offset=19, end_lineno=387, end_col_offset=22), args=[Name(id='cwd', ctx=Load(), lineno=387, col_offset=23, end_lineno=387, end_col_offset=26)], lineno=387, col_offset=19, end_lineno=387, end_col_offset=27), orelse=Constant(value=None, lineno=387, col_offset=40, end_lineno=387, end_col_offset=44), lineno=387, col_offset=19, end_lineno=387, end_col_offset=44)], lineno=384, col_offset=14, end_lineno=388, end_col_offset=9), lineno=384, col_offset=8, end_lineno=388, end_col_offset=9)], lineno=382, col_offset=4, end_lineno=389, end_col_offset=5), lineno=382, col_offset=4, end_lineno=389, end_col_offset=5), Assign(targets=[Name(id='effective_timeout', ctx=Store(), lineno=391, col_offset=4, end_lineno=391, end_col_offset=21)], value=Call(func=Name(id='float', ctx=Load(), lineno=391, col_offset=24, end_lineno=391, end_col_offset=29), args=[Name(id='timeout', ctx=Load(), lineno=391, col_offset=30, end_lineno=391, end_col_offset=37)], lineno=391, col_offset=24, end_lineno=391, end_col_offset=38), lineno=391, col_offset=4, end_lineno=391, end_col_offset=38), Assign(targets=[Name(id='tools_surface', ctx=Store(), lineno=393, col_offset=4, end_lineno=393, end_col_offset=17)], value=Call(func=Name(id='_load_tools_surface', ctx=Load(), lineno=393, col_offset=20, end_lineno=393, end_col_offset=39), lineno=393, col_offset=20, end_lineno=393, end_col_offset=41), lineno=393, col_offset=4, end_lineno=393, end_col_offset=41), Assign(targets=[Name(id='tool_execution_error_type', ctx=Store(), lineno=394, col_offset=4, end_lineno=394, end_col_offset=29)], value=Attribute(value=Name(id='tools_surface', ctx=Load(), lineno=394, col_offset=32, end_lineno=394, end_col_offset=45), attr='ToolExecutionError', ctx=Load(), lineno=394, col_offset=32, end_lineno=394, end_col_offset=64), lineno=394, col_offset=4, end_lineno=394, end_col_offset=64), Assign(targets=[Name(id='run_tool_impl', ctx=Store(), lineno=395, col_offset=4, end_lineno=395, end_col_offset=17)], value=Attribute(value=Name(id='tools_surface', ctx=Load(), lineno=395, col_offset=20, end_lineno=395, end_col_offset=33), attr='run_tool', ctx=Load(), lineno=395, col_offset=20, end_lineno=395, end_col_offset=42), lineno=395, col_offset=4, end_lineno=395, end_col_offset=42), Try(body=[Assign(targets=[Name(id='run_result', ctx=Store(), lineno=398, col_offset=8, end_lineno=398, end_col_offset=18)], value=Call(func=Name(id='run_tool_impl', ctx=Load(), lineno=398, col_offset=21, end_lineno=398, end_col_offset=34), args=[Name(id='cmd', ctx=Load(), lineno=399, col_offset=12, end_lineno=399, end_col_offset=15)], keywords=[keyword(arg='cwd', value=Name(id='cwd', ctx=Load(), lineno=400, col_offset=16, end_lineno=400, end_col_offset=19), lineno=400, col_offset=12, end_lineno=400, end_col_offset=19), keyword(arg='env', value=IfExp(test=Name(id='env', ctx=Load(), lineno=401, col_offset=29, end_lineno=401, end_col_offset=32), body=Call(func=Name(id='dict', ctx=Load(), lineno=401, col_offset=16, end_lineno=401, end_col_offset=20), args=[Name(id='env', ctx=Load(), lineno=401, col_offset=21, end_lineno=401, end_col_offset=24)], lineno=401, col_offset=16, end_lineno=401, end_col_offset=25), orelse=Constant(value=None, lineno=401, col_offset=38, end_lineno=401, end_col_offset=42), lineno=401, col_offset=16, end_lineno=401, end_col_offset=42), lineno=401, col_offset=12, end_lineno=401, end_col_offset=42), keyword(arg='timeout', value=Name(id='effective_timeout', ctx=Load(), lineno=402, col_offset=20, end_lineno=402, end_col_offset=37), lineno=402, col_offset=12, end_lineno=402, end_col_offset=37), keyword(arg='check', value=Constant(value=True, lineno=403, col_offset=18, end_lineno=403, end_col_offset=22), lineno=403, col_offset=12, end_lineno=403, end_col_offset=22)], lineno=398, col_offset=21, end_lineno=404, end_col_offset=9), lineno=398, col_offset=8, end_lineno=404, end_col_offset=9)], handlers=[ExceptHandler(type=Name(id='tool_execution_error_type', ctx=Load(), lineno=405, col_offset=11, end_lineno=405, end_col_offset=36), name='exc', body=[Assign(targets=[Name(id='tool_error', ctx=Store(), lineno=406, col_offset=8, end_lineno=406, end_col_offset=18)], value=Call(func=Name(id='cast', ctx=Load(), lineno=406, col_offset=21, end_lineno=406, end_col_offset=25), args=[Constant(value='_ToolExecutionErrorSurface', lineno=406, col_offset=26, end_lineno=406, end_col_offset=54), Name(id='exc', ctx=Load(), lineno=406, col_offset=56, end_lineno=406, end_col_offset=59)], lineno=406, col_offset=21, end_lineno=406, end_col_offset=60), lineno=406, col_offset=8, end_lineno=406, end_col_offset=60), If(test=Call(func=Name(id='_is_timeout_error', ctx=Load(), lineno=407, col_offset=11, end_lineno=407, end_col_offset=28), args=[Name(id='tool_error', ctx=Load(), lineno=407, col_offset=29, end_lineno=407, end_col_offset=39)], lineno=407, col_offset=11, end_lineno=407, end_col_offset=40), body=[Assign(targets=[Name(id='timeout_seconds', ctx=Store(), lineno=408, col_offset=12, end_lineno=408, end_col_offset=27)], value=Call(func=Name(id='int', ctx=Load(), lineno=408, col_offset=30, end_lineno=408, end_col_offset=33), args=[Name(id='effective_timeout', ctx=Load(), lineno=408, col_offset=34, end_lineno=408, end_col_offset=51)], lineno=408, col_offset=30, end_lineno=408, end_col_offset=52), lineno=408, col_offset=12, end_lineno=408, end_col_offset=52), Assign(targets=[Name(id='msg', ctx=Store(), lineno=409, col_offset=12, end_lineno=409, end_col_offset=15)], value=JoinedStr(values=[Constant(value='Subprocess exceeded timeout of ', lineno=409, col_offset=20, end_lineno=409, end_col_offset=51), FormattedValue(value=Name(id='timeout_seconds', ctx=Load(), lineno=409, col_offset=52, end_lineno=409, end_col_offset=67), conversion=-1, lineno=409, col_offset=51, end_lineno=409, end_col_offset=68), Constant(value=' seconds: ', lineno=409, col_offset=68, end_lineno=409, end_col_offset=78), FormattedValue(value=Call(func=Attribute(value=Constant(value=' ', lineno=409, col_offset=79, end_lineno=409, end_col_offset=82), attr='join', ctx=Load(), lineno=409, col_offset=79, end_lineno=409, end_col_offset=87), args=[Name(id='cmd', ctx=Load(), lineno=409, col_offset=88, end_lineno=409, end_col_offset=91)], lineno=409, col_offset=79, end_lineno=409, end_col_offset=92), conversion=-1, lineno=409, col_offset=78, end_lineno=409, end_col_offset=93)], lineno=409, col_offset=18, end_lineno=409, end_col_offset=94), lineno=409, col_offset=12, end_lineno=409, end_col_offset=94), Expr(value=Call(func=Attribute(value=Name(id='logger', ctx=Load(), lineno=410, col_offset=12, end_lineno=410, end_col_offset=18), attr='exception', ctx=Load(), lineno=410, col_offset=12, end_lineno=410, end_col_offset=28), args=[Name(id='msg', ctx=Load(), lineno=410, col_offset=29, end_lineno=410, end_col_offset=32)], keywords=[keyword(arg='extra', value=Dict(keys=[Constant(value='command', lineno=410, col_offset=41, end_lineno=410, end_col_offset=50), Constant(value='timeout', lineno=410, col_offset=67, end_lineno=410, end_col_offset=76)], values=[Call(func=Attribute(value=Constant(value=' ', lineno=410, col_offset=52, end_lineno=410, end_col_offset=55), attr='join', ctx=Load(), lineno=410, col_offset=52, end_lineno=410, end_col_offset=60), args=[Name(id='cmd', ctx=Load(), lineno=410, col_offset=61, end_lineno=410, end_col_offset=64)], lineno=410, col_offset=52, end_lineno=410, end_col_offset=65), Name(id='timeout_seconds', ctx=Load(), lineno=410, col_offset=78, end_lineno=410, end_col_offset=93)], lineno=410, col_offset=40, end_lineno=410, end_col_offset=94), lineno=410, col_offset=34, end_lineno=410, end_col_offset=94)], lineno=410, col_offset=12, end_lineno=410, end_col_offset=95), lineno=410, col_offset=12, end_lineno=410, end_col_offset=95), Raise(exc=Call(func=Name(id='SubprocessTimeoutError', ctx=Load(), lineno=411, col_offset=18, end_lineno=411, end_col_offset=40), args=[Name(id='msg', ctx=Load(), lineno=411, col_offset=41, end_lineno=411, end_col_offset=44)], keywords=[keyword(arg='command', value=Name(id='cmd', ctx=Load(), lineno=411, col_offset=54, end_lineno=411, end_col_offset=57), lineno=411, col_offset=46, end_lineno=411, end_col_offset=57), keyword(arg='timeout_seconds', value=Name(id='timeout_seconds', ctx=Load(), lineno=411, col_offset=75, end_lineno=411, end_col_offset=90), lineno=411, col_offset=59, end_lineno=411, end_col_offset=90)], lineno=411, col_offset=18, end_lineno=411, end_col_offset=91), cause=Name(id='exc', ctx=Load(), lineno=411, col_offset=97, end_lineno=411, end_col_offset=100), lineno=411, col_offset=12, end_lineno=411, end_col_offset=100)], lineno=407, col_offset=8, end_lineno=411, end_col_offset=100), Assign(targets=[Name(id='returncode', ctx=Store(), lineno=413, col_offset=8, end_lineno=413, end_col_offset=18)], value=Attribute(value=Name(id='tool_error', ctx=Load(), lineno=413, col_offset=21, end_lineno=413, end_col_offset=31), attr='returncode', ctx=Load(), lineno=413, col_offset=21, end_lineno=413, end_col_offset=42), lineno=413, col_offset=8, end_lineno=413, end_col_offset=42), Assign(targets=[Name(id='stderr_output', ctx=Store(), lineno=414, col_offset=8, end_lineno=414, end_col_offset=21)], value=BoolOp(op=Or(), values=[Attribute(value=Name(id='tool_error', ctx=Load(), lineno=414, col_offset=24, end_lineno=414, end_col_offset=34), attr='stderr', ctx=Load(), lineno=414, col_offset=24, end_lineno=414, end_col_offset=41), Constant(value=None, lineno=414, col_offset=45, end_lineno=414, end_col_offset=49)], lineno=414, col_offset=24, end_lineno=414, end_col_offset=49), lineno=414, col_offset=8, end_lineno=414, end_col_offset=49), If(test=Compare(left=Name(id='returncode', ctx=Load(), lineno=415, col_offset=11, end_lineno=415, end_col_offset=21), ops=[Is()], comparators=[Constant(value=None, lineno=415, col_offset=25, end_lineno=415, end_col_offset=29)], lineno=415, col_offset=11, end_lineno=415, end_col_offset=29), body=[Assign(targets=[Name(id='message', ctx=Store(), lineno=416, col_offset=12, end_lineno=416, end_col_offset=19)], value=Call(func=Name(id='str', ctx=Load(), lineno=416, col_offset=22, end_lineno=416, end_col_offset=25), args=[Name(id='tool_error', ctx=Load(), lineno=416, col_offset=26, end_lineno=416, end_col_offset=36)], lineno=416, col_offset=22, end_lineno=416, end_col_offset=37), lineno=416, col_offset=12, end_lineno=416, end_col_offset=37)], orelse=[Assign(targets=[Name(id='message', ctx=Store(), lineno=418, col_offset=12, end_lineno=418, end_col_offset=19)], value=JoinedStr(values=[Constant(value='Subprocess failed with exit code ', lineno=418, col_offset=24, end_lineno=418, end_col_offset=57), FormattedValue(value=Name(id='returncode', ctx=Load(), lineno=418, col_offset=58, end_lineno=418, end_col_offset=68), conversion=-1, lineno=418, col_offset=57, end_lineno=418, end_col_offset=69), Constant(value=': ', lineno=418, col_offset=69, end_lineno=418, end_col_offset=71), FormattedValue(value=Call(func=Attribute(value=Constant(value=' ', lineno=418, col_offset=72, end_lineno=418, end_col_offset=75), attr='join', ctx=Load(), lineno=418, col_offset=72, end_lineno=418, end_col_offset=80), args=[Name(id='cmd', ctx=Load(), lineno=418, col_offset=81, end_lineno=418, end_col_offset=84)], lineno=418, col_offset=72, end_lineno=418, end_col_offset=85), conversion=-1, lineno=418, col_offset=71, end_lineno=418, end_col_offset=86)], lineno=418, col_offset=22, end_lineno=418, end_col_offset=87), lineno=418, col_offset=12, end_lineno=418, end_col_offset=87)], lineno=415, col_offset=8, end_lineno=418, end_col_offset=87), Expr(value=Call(func=Attribute(value=Name(id='logger', ctx=Load(), lineno=419, col_offset=8, end_lineno=419, end_col_offset=14), attr='exception', ctx=Load(), lineno=419, col_offset=8, end_lineno=419, end_col_offset=24), args=[Name(id='message', ctx=Load(), lineno=420, col_offset=12, end_lineno=420, end_col_offset=19)], keywords=[keyword(arg='extra', value=Dict(keys=[Constant(value='command', lineno=422, col_offset=16, end_lineno=422, end_col_offset=25), Constant(value='returncode', lineno=423, col_offset=16, end_lineno=423, end_col_offset=28), Constant(value='stderr', lineno=424, col_offset=16, end_lineno=424, end_col_offset=24)], values=[Call(func=Attribute(value=Constant(value=' ', lineno=422, col_offset=27, end_lineno=422, end_col_offset=30), attr='join', ctx=Load(), lineno=422, col_offset=27, end_lineno=422, end_col_offset=35), args=[Name(id='cmd', ctx=Load(), lineno=422, col_offset=36, end_lineno=422, end_col_offset=39)], lineno=422, col_offset=27, end_lineno=422, end_col_offset=40), Name(id='returncode', ctx=Load(), lineno=423, col_offset=30, end_lineno=423, end_col_offset=40), Name(id='stderr_output', ctx=Load(), lineno=424, col_offset=26, end_lineno=424, end_col_offset=39)], lineno=421, col_offset=18, end_lineno=425, end_col_offset=13), lineno=421, col_offset=12, end_lineno=425, end_col_offset=13)], lineno=419, col_offset=8, end_lineno=426, end_col_offset=9), lineno=419, col_offset=8, end_lineno=426, end_col_offset=9), Raise(exc=Call(func=Name(id='SubprocessError', ctx=Load(), lineno=427, col_offset=14, end_lineno=427, end_col_offset=29), args=[Name(id='message', ctx=Load(), lineno=427, col_offset=30, end_lineno=427, end_col_offset=37)], keywords=[keyword(arg='returncode', value=Name(id='returncode', ctx=Load(), lineno=427, col_offset=50, end_lineno=427, end_col_offset=60), lineno=427, col_offset=39, end_lineno=427, end_col_offset=60), keyword(arg='stderr', value=Name(id='stderr_output', ctx=Load(), lineno=427, col_offset=69, end_lineno=427, end_col_offset=82), lineno=427, col_offset=62, end_lineno=427, end_col_offset=82)], lineno=427, col_offset=14, end_lineno=427, end_col_offset=83), cause=Name(id='exc', ctx=Load(), lineno=427, col_offset=89, end_lineno=427, end_col_offset=92), lineno=427, col_offset=8, end_lineno=427, end_col_offset=92)], lineno=405, col_offset=4, end_lineno=427, end_col_offset=92), ExceptHandler(type=Name(id='Exception', ctx=Load(), lineno=428, col_offset=11, end_lineno=428, end_col_offset=20), name='exc', body=[Assign(targets=[Name(id='msg', ctx=Store(), lineno=429, col_offset=8, end_lineno=429, end_col_offset=11)], value=JoinedStr(values=[Constant(value='Unexpected error executing subprocess: ', lineno=429, col_offset=16, end_lineno=429, end_col_offset=55), FormattedValue(value=Name(id='exc', ctx=Load(), lineno=429, col_offset=56, end_lineno=429, end_col_offset=59), conversion=-1, lineno=429, col_offset=55, end_lineno=429, end_col_offset=60)], lineno=429, col_offset=14, end_lineno=429, end_col_offset=61), lineno=429, col_offset=8, end_lineno=429, end_col_offset=61), Expr(value=Call(func=Attribute(value=Name(id='logger', ctx=Load(), lineno=430, col_offset=8, end_lineno=430, end_col_offset=14), attr='exception', ctx=Load(), lineno=430, col_offset=8, end_lineno=430, end_col_offset=24), args=[Name(id='msg', ctx=Load(), lineno=430, col_offset=25, end_lineno=430, end_col_offset=28)], keywords=[keyword(arg='extra', value=Dict(keys=[Constant(value='command', lineno=430, col_offset=37, end_lineno=430, end_col_offset=46)], values=[Call(func=Attribute(value=Constant(value=' ', lineno=430, col_offset=48, end_lineno=430, end_col_offset=51), attr='join', ctx=Load(), lineno=430, col_offset=48, end_lineno=430, end_col_offset=56), args=[Name(id='cmd', ctx=Load(), lineno=430, col_offset=57, end_lineno=430, end_col_offset=60)], lineno=430, col_offset=48, end_lineno=430, end_col_offset=61)], lineno=430, col_offset=36, end_lineno=430, end_col_offset=62), lineno=430, col_offset=30, end_lineno=430, end_col_offset=62)], lineno=430, col_offset=8, end_lineno=430, end_col_offset=63), lineno=430, col_offset=8, end_lineno=430, end_col_offset=63), Raise(exc=Call(func=Name(id='SubprocessError', ctx=Load(), lineno=431, col_offset=14, end_lineno=431, end_col_offset=29), args=[Name(id='msg', ctx=Load(), lineno=431, col_offset=30, end_lineno=431, end_col_offset=33)], lineno=431, col_offset=14, end_lineno=431, end_col_offset=34), cause=Name(id='exc', ctx=Load(), lineno=431, col_offset=40, end_lineno=431, end_col_offset=43), lineno=431, col_offset=8, end_lineno=431, end_col_offset=43)], lineno=428, col_offset=4, end_lineno=431, end_col_offset=43)], lineno=397, col_offset=4, end_lineno=431, end_col_offset=43), Expr(value=Call(func=Attribute(value=Name(id='logger', ctx=Load(), lineno=433, col_offset=4, end_lineno=433, end_col_offset=10), attr='debug', ctx=Load(), lineno=433, col_offset=4, end_lineno=433, end_col_offset=16), args=[Constant(value='Subprocess completed successfully', lineno=433, col_offset=17, end_lineno=433, end_col_offset=52)], keywords=[keyword(arg='extra', value=Dict(keys=[Constant(value='returncode', lineno=433, col_offset=61, end_lineno=433, end_col_offset=73)], values=[Attribute(value=Name(id='run_result', ctx=Load(), lineno=433, col_offset=75, end_lineno=433, end_col_offset=85), attr='returncode', ctx=Load(), lineno=433, col_offset=75, end_lineno=433, end_col_offset=96)], lineno=433, col_offset=60, end_lineno=433, end_col_offset=97), lineno=433, col_offset=54, end_lineno=433, end_col_offset=97)], lineno=433, col_offset=4, end_lineno=433, end_col_offset=98), lineno=433, col_offset=4, end_lineno=433, end_col_offset=98), Return(value=Attribute(value=Name(id='run_result', ctx=Load(), lineno=434, col_offset=11, end_lineno=434, end_col_offset=21), attr='stdout', ctx=Load(), lineno=434, col_offset=11, end_lineno=434, end_col_offset=28), lineno=434, col_offset=4, end_lineno=434, end_col_offset=28)], returns=Name(id='str', ctx=Load(), lineno=324, col_offset=5, end_lineno=324, end_col_offset=8), lineno=318, col_offset=0, end_lineno=434, end_col_offset=28), FunctionDef(name='_is_timeout_error', args=arguments(args=[arg(arg='error', annotation=Name(id='_ToolExecutionErrorSurface', ctx=Load(), lineno=437, col_offset=29, end_lineno=437, end_col_offset=55), lineno=437, col_offset=22, end_lineno=437, end_col_offset=55)]), body=[Assign(targets=[Name(id='problem', ctx=Store(), lineno=438, col_offset=4, end_lineno=438, end_col_offset=11)], value=Call(func=Name(id='cast', ctx=Load(), lineno=438, col_offset=14, end_lineno=438, end_col_offset=18), args=[Constant(value='Mapping[str, object] | None', lineno=438, col_offset=19, end_lineno=438, end_col_offset=48), Call(func=Name(id='getattr', ctx=Load(), lineno=438, col_offset=50, end_lineno=438, end_col_offset=57), args=[Name(id='error', ctx=Load(), lineno=438, col_offset=58, end_lineno=438, end_col_offset=63), Constant(value='problem', lineno=438, col_offset=65, end_lineno=438, end_col_offset=74), Constant(value=None, lineno=438, col_offset=76, end_lineno=438, end_col_offset=80)], lineno=438, col_offset=50, end_lineno=438, end_col_offset=81)], lineno=438, col_offset=14, end_lineno=438, end_col_offset=82), lineno=438, col_offset=4, end_lineno=438, end_col_offset=82), If(test=Compare(left=Name(id='problem', ctx=Load(), lineno=439, col_offset=7, end_lineno=439, end_col_offset=14), ops=[IsNot()], comparators=[Constant(value=None, lineno=439, col_offset=22, end_lineno=439, end_col_offset=26)], lineno=439, col_offset=7, end_lineno=439, end_col_offset=26), body=[Assign(targets=[Name(id='raw_type', ctx=Store(), lineno=440, col_offset=8, end_lineno=440, end_col_offset=16)], value=Call(func=Attribute(value=Name(id='problem', ctx=Load(), lineno=440, col_offset=19, end_lineno=440, end_col_offset=26), attr='get', ctx=Load(), lineno=440, col_offset=19, end_lineno=440, end_col_offset=30), args=[Constant(value='type', lineno=440, col_offset=31, end_lineno=440, end_col_offset=37)], lineno=440, col_offset=19, end_lineno=440, end_col_offset=38), lineno=440, col_offset=8, end_lineno=440, end_col_offset=38), If(test=BoolOp(op=And(), values=[Call(func=Name(id='isinstance', ctx=Load(), lineno=441, col_offset=11, end_lineno=441, end_col_offset=21), args=[Name(id='raw_type', ctx=Load(), lineno=441, col_offset=22, end_lineno=441, end_col_offset=30), Name(id='str', ctx=Load(), lineno=441, col_offset=32, end_lineno=441, end_col_offset=35)], lineno=441, col_offset=11, end_lineno=441, end_col_offset=36), Call(func=Attribute(value=Name(id='raw_type', ctx=Load(), lineno=441, col_offset=41, end_lineno=441, end_col_offset=49), attr='endswith', ctx=Load(), lineno=441, col_offset=41, end_lineno=441, end_col_offset=58), args=[Constant(value='tool-timeout', lineno=441, col_offset=59, end_lineno=441, end_col_offset=73)], lineno=441, col_offset=41, end_lineno=441, end_col_offset=74)], lineno=441, col_offset=11, end_lineno=441, end_col_offset=74), body=[Return(value=Constant(value=True, lineno=442, col_offset=19, end_lineno=442, end_col_offset=23), lineno=442, col_offset=12, end_lineno=442, end_col_offset=23)], lineno=441, col_offset=8, end_lineno=442, end_col_offset=23)], lineno=439, col_offset=4, end_lineno=442, end_col_offset=23), Return(value=Compare(left=Constant(value='timed out', lineno=443, col_offset=11, end_lineno=443, end_col_offset=22), ops=[In()], comparators=[Call(func=Name(id='str', ctx=Load(), lineno=443, col_offset=26, end_lineno=443, end_col_offset=29), args=[Name(id='error', ctx=Load(), lineno=443, col_offset=30, end_lineno=443, end_col_offset=35)], lineno=443, col_offset=26, end_lineno=443, end_col_offset=36)], lineno=443, col_offset=11, end_lineno=443, end_col_offset=36), lineno=443, col_offset=4, end_lineno=443, end_col_offset=36)], returns=Name(id='bool', ctx=Load(), lineno=437, col_offset=60, end_lineno=437, end_col_offset=64), lineno=437, col_offset=0, end_lineno=443, end_col_offset=36), FunctionDef(name='spawn_text_process', args=arguments(args=[arg(arg='command', annotation=Subscript(value=Name(id='Sequence', ctx=Load(), lineno=448, col_offset=13, end_lineno=448, end_col_offset=21), slice=Name(id='str', ctx=Load(), lineno=448, col_offset=22, end_lineno=448, end_col_offset=25), ctx=Load(), lineno=448, col_offset=13, end_lineno=448, end_col_offset=26), lineno=448, col_offset=4, end_lineno=448, end_col_offset=26)], kwonlyargs=[arg(arg='cwd', annotation=BinOp(left=Name(id='Path', ctx=Load(), lineno=450, col_offset=9, end_lineno=450, end_col_offset=13), op=BitOr(), right=Constant(value=None, lineno=450, col_offset=16, end_lineno=450, end_col_offset=20), lineno=450, col_offset=9, end_lineno=450, end_col_offset=20), lineno=450, col_offset=4, end_lineno=450, end_col_offset=20), arg(arg='env', annotation=BinOp(left=Subscript(value=Name(id='Mapping', ctx=Load(), lineno=451, col_offset=9, end_lineno=451, end_col_offset=16), slice=Tuple(elts=[Name(id='str', ctx=Load(), lineno=451, col_offset=17, end_lineno=451, end_col_offset=20), Name(id='str', ctx=Load(), lineno=451, col_offset=22, end_lineno=451, end_col_offset=25)], ctx=Load(), lineno=451, col_offset=17, end_lineno=451, end_col_offset=25), ctx=Load(), lineno=451, col_offset=9, end_lineno=451, end_col_offset=26), op=BitOr(), right=Constant(value=None, lineno=451, col_offset=29, end_lineno=451, end_col_offset=33), lineno=451, col_offset=9, end_lineno=451, end_col_offset=33), lineno=451, col_offset=4, end_lineno=451, end_col_offset=33)], kw_defaults=[Constant(value=None, lineno=450, col_offset=23, end_lineno=450, end_col_offset=27), Constant(value=None, lineno=451, col_offset=36, end_lineno=451, end_col_offset=40)]), body=[Expr(value=Constant(value='Spawn a long-lived subprocess with hardened command checks.\n\n    The command is resolved through the shared allow-list policy to ensure the executable path is\n    trusted, and the environment is sanitised to drop inherited state that could affect tooling\n    deterministically.\n\n    Parameters\n    ----------\n    command : Sequence[str]\n        Command and arguments to execute.\n    cwd : Path | None, optional\n        Working directory for the process.\n    env : Mapping[str, str] | None, optional\n        Environment variables.\n\n    Returns\n    -------\n    TextProcess\n        Text process instance.\n\n    Notes\n    -----\n    The tool execution error type is loaded dynamically from the shared tooling\n    facade to avoid importing heavy dependencies at module import time.\n    ', lineno=453, col_offset=4, end_lineno=477, end_col_offset=7), lineno=453, col_offset=4, end_lineno=477, end_col_offset=7), Assign(targets=[Name(id='tools_surface', ctx=Store(), lineno=478, col_offset=4, end_lineno=478, end_col_offset=17)], value=Call(func=Name(id='_load_tools_surface', ctx=Load(), lineno=478, col_offset=20, end_lineno=478, end_col_offset=39), lineno=478, col_offset=20, end_lineno=478, end_col_offset=41), lineno=478, col_offset=4, end_lineno=478, end_col_offset=41), If(test=UnaryOp(op=Not(), operand=Name(id='command', ctx=Load(), lineno=479, col_offset=11, end_lineno=479, end_col_offset=18), lineno=479, col_offset=7, end_lineno=479, end_col_offset=18), body=[Assign(targets=[Name(id='msg', ctx=Store(), lineno=480, col_offset=8, end_lineno=480, end_col_offset=11)], value=Constant(value='Command must contain at least one argument', lineno=480, col_offset=14, end_lineno=480, end_col_offset=58), lineno=480, col_offset=8, end_lineno=480, end_col_offset=58), Expr(value=Call(func=Name(id='_raise_tool_execution_error', ctx=Load(), lineno=481, col_offset=8, end_lineno=481, end_col_offset=35), args=[Name(id='tools_surface', ctx=Load(), lineno=481, col_offset=36, end_lineno=481, end_col_offset=49), Name(id='msg', ctx=Load(), lineno=481, col_offset=51, end_lineno=481, end_col_offset=54)], keywords=[keyword(arg='command', value=List(ctx=Load(), lineno=481, col_offset=64, end_lineno=481, end_col_offset=66), lineno=481, col_offset=56, end_lineno=481, end_col_offset=66)], lineno=481, col_offset=8, end_lineno=481, end_col_offset=67), lineno=481, col_offset=8, end_lineno=481, end_col_offset=67)], lineno=479, col_offset=4, end_lineno=481, end_col_offset=67), Assign(targets=[Name(id='get_runner', ctx=Store(), lineno=483, col_offset=4, end_lineno=483, end_col_offset=14)], value=Attribute(value=Name(id='tools_surface', ctx=Load(), lineno=483, col_offset=17, end_lineno=483, end_col_offset=30), attr='get_process_runner', ctx=Load(), lineno=483, col_offset=17, end_lineno=483, end_col_offset=49), lineno=483, col_offset=4, end_lineno=483, end_col_offset=49), Assign(targets=[Name(id='runner', ctx=Store(), lineno=484, col_offset=4, end_lineno=484, end_col_offset=10)], value=Call(func=Name(id='get_runner', ctx=Load(), lineno=484, col_offset=13, end_lineno=484, end_col_offset=23), lineno=484, col_offset=13, end_lineno=484, end_col_offset=25), lineno=484, col_offset=4, end_lineno=484, end_col_offset=25), Assign(targets=[Name(id='executable', ctx=Store(), lineno=486, col_offset=4, end_lineno=486, end_col_offset=14)], value=Call(func=Attribute(value=Attribute(value=Name(id='runner', ctx=Load(), lineno=486, col_offset=17, end_lineno=486, end_col_offset=23), attr='allowlist', ctx=Load(), lineno=486, col_offset=17, end_lineno=486, end_col_offset=33), attr='resolve', ctx=Load(), lineno=486, col_offset=17, end_lineno=486, end_col_offset=41), args=[Subscript(value=Name(id='command', ctx=Load(), lineno=486, col_offset=42, end_lineno=486, end_col_offset=49), slice=Constant(value=0, lineno=486, col_offset=50, end_lineno=486, end_col_offset=51), ctx=Load(), lineno=486, col_offset=42, end_lineno=486, end_col_offset=52), Name(id='command', ctx=Load(), lineno=486, col_offset=54, end_lineno=486, end_col_offset=61)], lineno=486, col_offset=17, end_lineno=486, end_col_offset=62), lineno=486, col_offset=4, end_lineno=486, end_col_offset=62), Assign(targets=[Name(id='final_command', ctx=Store(), lineno=487, col_offset=4, end_lineno=487, end_col_offset=17)], value=Tuple(elts=[Call(func=Name(id='str', ctx=Load(), lineno=487, col_offset=21, end_lineno=487, end_col_offset=24), args=[Name(id='executable', ctx=Load(), lineno=487, col_offset=25, end_lineno=487, end_col_offset=35)], lineno=487, col_offset=21, end_lineno=487, end_col_offset=36), Starred(value=Subscript(value=Name(id='command', ctx=Load(), lineno=487, col_offset=39, end_lineno=487, end_col_offset=46), slice=Slice(lower=Constant(value=1, lineno=487, col_offset=47, end_lineno=487, end_col_offset=48), lineno=487, col_offset=47, end_lineno=487, end_col_offset=49), ctx=Load(), lineno=487, col_offset=39, end_lineno=487, end_col_offset=50), ctx=Load(), lineno=487, col_offset=38, end_lineno=487, end_col_offset=50)], ctx=Load(), lineno=487, col_offset=20, end_lineno=487, end_col_offset=51), lineno=487, col_offset=4, end_lineno=487, end_col_offset=51), Assign(targets=[Name(id='sanitised_env', ctx=Store(), lineno=488, col_offset=4, end_lineno=488, end_col_offset=17)], value=Call(func=Attribute(value=Attribute(value=Name(id='runner', ctx=Load(), lineno=488, col_offset=20, end_lineno=488, end_col_offset=26), attr='environment', ctx=Load(), lineno=488, col_offset=20, end_lineno=488, end_col_offset=38), attr='build', ctx=Load(), lineno=488, col_offset=20, end_lineno=488, end_col_offset=44), args=[Name(id='env', ctx=Load(), lineno=488, col_offset=45, end_lineno=488, end_col_offset=48)], lineno=488, col_offset=20, end_lineno=488, end_col_offset=49), lineno=488, col_offset=4, end_lineno=488, end_col_offset=49), Return(value=Call(func=Name(id='_Popen', ctx=Load(), lineno=490, col_offset=11, end_lineno=490, end_col_offset=17), args=[Name(id='final_command', ctx=Load(), lineno=491, col_offset=8, end_lineno=491, end_col_offset=21)], keywords=[keyword(arg='stdin', value=Name(id='_PIPE', ctx=Load(), lineno=492, col_offset=14, end_lineno=492, end_col_offset=19), lineno=492, col_offset=8, end_lineno=492, end_col_offset=19), keyword(arg='stdout', value=Name(id='_PIPE', ctx=Load(), lineno=493, col_offset=15, end_lineno=493, end_col_offset=20), lineno=493, col_offset=8, end_lineno=493, end_col_offset=20), keyword(arg='stderr', value=Name(id='_PIPE', ctx=Load(), lineno=494, col_offset=15, end_lineno=494, end_col_offset=20), lineno=494, col_offset=8, end_lineno=494, end_col_offset=20), keyword(arg='text', value=Constant(value=True, lineno=495, col_offset=13, end_lineno=495, end_col_offset=17), lineno=495, col_offset=8, end_lineno=495, end_col_offset=17), keyword(arg='cwd', value=IfExp(test=Name(id='cwd', ctx=Load(), lineno=496, col_offset=24, end_lineno=496, end_col_offset=27), body=Call(func=Name(id='str', ctx=Load(), lineno=496, col_offset=12, end_lineno=496, end_col_offset=15), args=[Name(id='cwd', ctx=Load(), lineno=496, col_offset=16, end_lineno=496, end_col_offset=19)], lineno=496, col_offset=12, end_lineno=496, end_col_offset=20), orelse=Constant(value=None, lineno=496, col_offset=33, end_lineno=496, end_col_offset=37), lineno=496, col_offset=12, end_lineno=496, end_col_offset=37), lineno=496, col_offset=8, end_lineno=496, end_col_offset=37), keyword(arg='env', value=Call(func=Name(id='dict', ctx=Load(), lineno=497, col_offset=12, end_lineno=497, end_col_offset=16), args=[Name(id='sanitised_env', ctx=Load(), lineno=497, col_offset=17, end_lineno=497, end_col_offset=30)], lineno=497, col_offset=12, end_lineno=497, end_col_offset=31), lineno=497, col_offset=8, end_lineno=497, end_col_offset=31)], lineno=490, col_offset=11, end_lineno=498, end_col_offset=5), lineno=490, col_offset=4, end_lineno=498, end_col_offset=5)], returns=Name(id='TextProcess', ctx=Load(), lineno=452, col_offset=5, end_lineno=452, end_col_offset=16), lineno=447, col_offset=0, end_lineno=498, end_col_offset=5), Assign(targets=[Name(id='__all__', ctx=Store(), lineno=501, col_offset=0, end_lineno=501, end_col_offset=7)], value=List(elts=[Constant(value='SubprocessError', lineno=502, col_offset=4, end_lineno=502, end_col_offset=21), Constant(value='SubprocessTimeoutError', lineno=503, col_offset=4, end_lineno=503, end_col_offset=28), Constant(value='TextProcess', lineno=504, col_offset=4, end_lineno=504, end_col_offset=17), Constant(value='TimeoutExpired', lineno=505, col_offset=4, end_lineno=505, end_col_offset=20), Constant(value='run_subprocess', lineno=506, col_offset=4, end_lineno=506, end_col_offset=20), Constant(value='spawn_text_process', lineno=507, col_offset=4, end_lineno=507, end_col_offset=24)], ctx=Load(), lineno=501, col_offset=10, end_lineno=508, end_col_offset=1), lineno=501, col_offset=0, end_lineno=508, end_col_offset=1), Assign(targets=[Name(id='__navmap__', ctx=Store(), lineno=509, col_offset=0, end_lineno=509, end_col_offset=10)], value=Call(func=Name(id='load_nav_metadata', ctx=Load(), lineno=509, col_offset=13, end_lineno=509, end_col_offset=30), args=[Name(id='__name__', ctx=Load(), lineno=509, col_offset=31, end_lineno=509, end_col_offset=39), Call(func=Name(id='tuple', ctx=Load(), lineno=509, col_offset=41, end_lineno=509, end_col_offset=46), args=[Name(id='__all__', ctx=Load(), lineno=509, col_offset=47, end_lineno=509, end_col_offset=54)], lineno=509, col_offset=41, end_lineno=509, end_col_offset=55)], lineno=509, col_offset=13, end_lineno=509, end_col_offset=56), lineno=509, col_offset=0, end_lineno=509, end_col_offset=56)])