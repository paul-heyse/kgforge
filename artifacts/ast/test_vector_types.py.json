Module(body=[Expr(value=Constant(value='Unit tests for typed vector ingestion helpers.\n\nThese tests exercise ``kgfoundry_common.vector_types`` to ensure the shared\nvector contract enforces dtype/shape invariants and raises\n``VectorValidationError`` with informative messages.\n', lineno=1, col_offset=0, end_lineno=6, end_col_offset=3), lineno=1, col_offset=0, end_lineno=6, end_col_offset=3), ImportFrom(module='__future__', names=[alias(name='annotations', lineno=8, col_offset=23, end_lineno=8, end_col_offset=34)], level=0, lineno=8, col_offset=0, end_lineno=8, end_col_offset=34), ImportFrom(module='typing', names=[alias(name='TYPE_CHECKING', lineno=10, col_offset=19, end_lineno=10, end_col_offset=32), alias(name='cast', lineno=10, col_offset=34, end_lineno=10, end_col_offset=38)], level=0, lineno=10, col_offset=0, end_lineno=10, end_col_offset=38), Import(names=[alias(name='numpy', asname='np', lineno=12, col_offset=7, end_lineno=12, end_col_offset=18)], lineno=12, col_offset=0, end_lineno=12, end_col_offset=18), Import(names=[alias(name='pytest', lineno=13, col_offset=7, end_lineno=13, end_col_offset=13)], lineno=13, col_offset=0, end_lineno=13, end_col_offset=13), ImportFrom(module='kgfoundry_common.vector_types', names=[alias(name='VectorBatch', lineno=16, col_offset=4, end_lineno=16, end_col_offset=15), alias(name='VectorId', lineno=17, col_offset=4, end_lineno=17, end_col_offset=12), alias(name='VectorValidationError', lineno=18, col_offset=4, end_lineno=18, end_col_offset=25), alias(name='assert_vector_matrix', lineno=19, col_offset=4, end_lineno=19, end_col_offset=24), alias(name='coerce_vector_batch', lineno=20, col_offset=4, end_lineno=20, end_col_offset=23), alias(name='validate_vector_batch', lineno=21, col_offset=4, end_lineno=21, end_col_offset=25)], level=0, lineno=15, col_offset=0, end_lineno=22, end_col_offset=1), If(test=Name(id='TYPE_CHECKING', ctx=Load(), lineno=24, col_offset=3, end_lineno=24, end_col_offset=16), body=[ImportFrom(module='collections.abc', names=[alias(name='Iterable', lineno=25, col_offset=32, end_lineno=25, end_col_offset=40), alias(name='Mapping', lineno=25, col_offset=42, end_lineno=25, end_col_offset=49), alias(name='Sequence', lineno=25, col_offset=51, end_lineno=25, end_col_offset=59)], level=0, lineno=25, col_offset=4, end_lineno=25, end_col_offset=59), ImportFrom(module='kgfoundry_common.vector_types', names=[alias(name='VectorMatrix', lineno=28, col_offset=8, end_lineno=28, end_col_offset=20)], level=0, lineno=27, col_offset=4, end_lineno=29, end_col_offset=5)], lineno=24, col_offset=0, end_lineno=29, end_col_offset=5), FunctionDef(name='test_coerce_vector_batch_produces_float32_matrix', args=arguments(args=[arg(arg='canonical_vector_payload', annotation=Subscript(value=Name(id='list', ctx=Load(), lineno=33, col_offset=30, end_lineno=33, end_col_offset=34), slice=Subscript(value=Name(id='dict', ctx=Load(), lineno=33, col_offset=35, end_lineno=33, end_col_offset=39), slice=Tuple(elts=[Name(id='str', ctx=Load(), lineno=33, col_offset=40, end_lineno=33, end_col_offset=43), Name(id='object', ctx=Load(), lineno=33, col_offset=45, end_lineno=33, end_col_offset=51)], ctx=Load(), lineno=33, col_offset=40, end_lineno=33, end_col_offset=51), ctx=Load(), lineno=33, col_offset=35, end_lineno=33, end_col_offset=52), ctx=Load(), lineno=33, col_offset=30, end_lineno=33, end_col_offset=53), lineno=33, col_offset=4, end_lineno=33, end_col_offset=53)]), body=[Expr(value=Constant(value='`coerce_vector_batch` converts payloads into contiguous float32 batches.', lineno=35, col_offset=4, end_lineno=35, end_col_offset=82), lineno=35, col_offset=4, end_lineno=35, end_col_offset=82), Assign(targets=[Name(id='batch', ctx=Store(), lineno=36, col_offset=4, end_lineno=36, end_col_offset=9)], value=Call(func=Name(id='coerce_vector_batch', ctx=Load(), lineno=36, col_offset=12, end_lineno=36, end_col_offset=31), args=[Name(id='canonical_vector_payload', ctx=Load(), lineno=36, col_offset=32, end_lineno=36, end_col_offset=56)], lineno=36, col_offset=12, end_lineno=36, end_col_offset=57), lineno=36, col_offset=4, end_lineno=36, end_col_offset=57), Assert(test=Compare(left=Attribute(value=Name(id='batch', ctx=Load(), lineno=38, col_offset=11, end_lineno=38, end_col_offset=16), attr='ids', ctx=Load(), lineno=38, col_offset=11, end_lineno=38, end_col_offset=20), ops=[Eq()], comparators=[Tuple(elts=[Call(func=Name(id='VectorId', ctx=Load(), lineno=38, col_offset=25, end_lineno=38, end_col_offset=33), args=[Constant(value='vec-1', lineno=38, col_offset=34, end_lineno=38, end_col_offset=41)], lineno=38, col_offset=25, end_lineno=38, end_col_offset=42), Call(func=Name(id='VectorId', ctx=Load(), lineno=38, col_offset=44, end_lineno=38, end_col_offset=52), args=[Constant(value='vec-2', lineno=38, col_offset=53, end_lineno=38, end_col_offset=60)], lineno=38, col_offset=44, end_lineno=38, end_col_offset=61)], ctx=Load(), lineno=38, col_offset=24, end_lineno=38, end_col_offset=62)], lineno=38, col_offset=11, end_lineno=38, end_col_offset=62), lineno=38, col_offset=4, end_lineno=38, end_col_offset=62), Assert(test=Compare(left=Attribute(value=Name(id='batch', ctx=Load(), lineno=39, col_offset=11, end_lineno=39, end_col_offset=16), attr='count', ctx=Load(), lineno=39, col_offset=11, end_lineno=39, end_col_offset=22), ops=[Eq()], comparators=[Constant(value=2, lineno=39, col_offset=26, end_lineno=39, end_col_offset=27)], lineno=39, col_offset=11, end_lineno=39, end_col_offset=27), lineno=39, col_offset=4, end_lineno=39, end_col_offset=27), Assert(test=Compare(left=Attribute(value=Name(id='batch', ctx=Load(), lineno=40, col_offset=11, end_lineno=40, end_col_offset=16), attr='dimension', ctx=Load(), lineno=40, col_offset=11, end_lineno=40, end_col_offset=26), ops=[Eq()], comparators=[Constant(value=3, lineno=40, col_offset=30, end_lineno=40, end_col_offset=31)], lineno=40, col_offset=11, end_lineno=40, end_col_offset=31), lineno=40, col_offset=4, end_lineno=40, end_col_offset=31), Assert(test=Compare(left=Attribute(value=Attribute(value=Name(id='batch', ctx=Load(), lineno=41, col_offset=11, end_lineno=41, end_col_offset=16), attr='matrix', ctx=Load(), lineno=41, col_offset=11, end_lineno=41, end_col_offset=23), attr='dtype', ctx=Load(), lineno=41, col_offset=11, end_lineno=41, end_col_offset=29), ops=[Eq()], comparators=[Attribute(value=Name(id='np', ctx=Load(), lineno=41, col_offset=33, end_lineno=41, end_col_offset=35), attr='float32', ctx=Load(), lineno=41, col_offset=33, end_lineno=41, end_col_offset=43)], lineno=41, col_offset=11, end_lineno=41, end_col_offset=43), lineno=41, col_offset=4, end_lineno=41, end_col_offset=43), Assert(test=Attribute(value=Attribute(value=Attribute(value=Name(id='batch', ctx=Load(), lineno=42, col_offset=11, end_lineno=42, end_col_offset=16), attr='matrix', ctx=Load(), lineno=42, col_offset=11, end_lineno=42, end_col_offset=23), attr='flags', ctx=Load(), lineno=42, col_offset=11, end_lineno=42, end_col_offset=29), attr='c_contiguous', ctx=Load(), lineno=42, col_offset=11, end_lineno=42, end_col_offset=42), lineno=42, col_offset=4, end_lineno=42, end_col_offset=42)], returns=Constant(value=None, lineno=34, col_offset=5, end_lineno=34, end_col_offset=9), lineno=32, col_offset=0, end_lineno=42, end_col_offset=42), FunctionDef(name='test_coerce_vector_batch_rejects_inconsistent_dimensions', args=arguments(args=[arg(arg='inconsistent_dimension_payload', annotation=Subscript(value=Name(id='list', ctx=Load(), lineno=46, col_offset=36, end_lineno=46, end_col_offset=40), slice=Subscript(value=Name(id='dict', ctx=Load(), lineno=46, col_offset=41, end_lineno=46, end_col_offset=45), slice=Tuple(elts=[Name(id='str', ctx=Load(), lineno=46, col_offset=46, end_lineno=46, end_col_offset=49), Name(id='object', ctx=Load(), lineno=46, col_offset=51, end_lineno=46, end_col_offset=57)], ctx=Load(), lineno=46, col_offset=46, end_lineno=46, end_col_offset=57), ctx=Load(), lineno=46, col_offset=41, end_lineno=46, end_col_offset=58), ctx=Load(), lineno=46, col_offset=36, end_lineno=46, end_col_offset=59), lineno=46, col_offset=4, end_lineno=46, end_col_offset=59)]), body=[Expr(value=Constant(value='Ragged vectors should trigger a `VectorValidationError`.', lineno=48, col_offset=4, end_lineno=48, end_col_offset=66), lineno=48, col_offset=4, end_lineno=48, end_col_offset=66), With(items=[withitem(context_expr=Call(func=Attribute(value=Name(id='pytest', ctx=Load(), lineno=49, col_offset=9, end_lineno=49, end_col_offset=15), attr='raises', ctx=Load(), lineno=49, col_offset=9, end_lineno=49, end_col_offset=22), args=[Name(id='VectorValidationError', ctx=Load(), lineno=49, col_offset=23, end_lineno=49, end_col_offset=44)], keywords=[keyword(arg='match', value=Constant(value='differs from the expected dimension', lineno=49, col_offset=52, end_lineno=49, end_col_offset=89), lineno=49, col_offset=46, end_lineno=49, end_col_offset=89)], lineno=49, col_offset=9, end_lineno=49, end_col_offset=90))], body=[Expr(value=Call(func=Name(id='coerce_vector_batch', ctx=Load(), lineno=50, col_offset=8, end_lineno=50, end_col_offset=27), args=[Name(id='inconsistent_dimension_payload', ctx=Load(), lineno=50, col_offset=28, end_lineno=50, end_col_offset=58)], lineno=50, col_offset=8, end_lineno=50, end_col_offset=59), lineno=50, col_offset=8, end_lineno=50, end_col_offset=59)], lineno=49, col_offset=4, end_lineno=50, end_col_offset=59)], returns=Constant(value=None, lineno=47, col_offset=5, end_lineno=47, end_col_offset=9), lineno=45, col_offset=0, end_lineno=50, end_col_offset=59), FunctionDef(name='test_coerce_vector_batch_rejects_non_numeric', args=arguments(args=[arg(arg='non_numeric_payload', annotation=Subscript(value=Name(id='list', ctx=Load(), lineno=54, col_offset=25, end_lineno=54, end_col_offset=29), slice=Subscript(value=Name(id='dict', ctx=Load(), lineno=54, col_offset=30, end_lineno=54, end_col_offset=34), slice=Tuple(elts=[Name(id='str', ctx=Load(), lineno=54, col_offset=35, end_lineno=54, end_col_offset=38), Name(id='object', ctx=Load(), lineno=54, col_offset=40, end_lineno=54, end_col_offset=46)], ctx=Load(), lineno=54, col_offset=35, end_lineno=54, end_col_offset=46), ctx=Load(), lineno=54, col_offset=30, end_lineno=54, end_col_offset=47), ctx=Load(), lineno=54, col_offset=25, end_lineno=54, end_col_offset=48), lineno=54, col_offset=4, end_lineno=54, end_col_offset=48)]), body=[Expr(value=Constant(value='Non-numeric vector entries bubble up as validation errors.', lineno=56, col_offset=4, end_lineno=56, end_col_offset=68), lineno=56, col_offset=4, end_lineno=56, end_col_offset=68), With(items=[withitem(context_expr=Call(func=Attribute(value=Name(id='pytest', ctx=Load(), lineno=57, col_offset=9, end_lineno=57, end_col_offset=15), attr='raises', ctx=Load(), lineno=57, col_offset=9, end_lineno=57, end_col_offset=22), args=[Name(id='VectorValidationError', ctx=Load(), lineno=57, col_offset=23, end_lineno=57, end_col_offset=44)], keywords=[keyword(arg='match', value=Constant(value='non-numeric vector entries', lineno=57, col_offset=52, end_lineno=57, end_col_offset=80), lineno=57, col_offset=46, end_lineno=57, end_col_offset=80)], lineno=57, col_offset=9, end_lineno=57, end_col_offset=81))], body=[Expr(value=Call(func=Name(id='coerce_vector_batch', ctx=Load(), lineno=58, col_offset=8, end_lineno=58, end_col_offset=27), args=[Name(id='non_numeric_payload', ctx=Load(), lineno=58, col_offset=28, end_lineno=58, end_col_offset=47)], lineno=58, col_offset=8, end_lineno=58, end_col_offset=48), lineno=58, col_offset=8, end_lineno=58, end_col_offset=48)], lineno=57, col_offset=4, end_lineno=58, end_col_offset=48)], returns=Constant(value=None, lineno=55, col_offset=5, end_lineno=55, end_col_offset=9), lineno=53, col_offset=0, end_lineno=58, end_col_offset=48), FunctionDef(name='test_coerce_vector_batch_requires_mapping', args=arguments(), body=[Expr(value=Constant(value='Vector records must be mapping objects with `key`/`vector` entries.', lineno=62, col_offset=4, end_lineno=62, end_col_offset=77), lineno=62, col_offset=4, end_lineno=62, end_col_offset=77), AnnAssign(target=Name(id='records', ctx=Store(), lineno=63, col_offset=4, end_lineno=63, end_col_offset=11), annotation=Subscript(value=Name(id='Iterable', ctx=Load(), lineno=63, col_offset=13, end_lineno=63, end_col_offset=21), slice=Name(id='object', ctx=Load(), lineno=63, col_offset=22, end_lineno=63, end_col_offset=28), ctx=Load(), lineno=63, col_offset=13, end_lineno=63, end_col_offset=29), value=List(elts=[List(elts=[Constant(value=0.1, lineno=63, col_offset=34, end_lineno=63, end_col_offset=37), Constant(value=0.2, lineno=63, col_offset=39, end_lineno=63, end_col_offset=42), Constant(value=0.3, lineno=63, col_offset=44, end_lineno=63, end_col_offset=47)], ctx=Load(), lineno=63, col_offset=33, end_lineno=63, end_col_offset=48)], ctx=Load(), lineno=63, col_offset=32, end_lineno=63, end_col_offset=49), simple=1, lineno=63, col_offset=4, end_lineno=63, end_col_offset=49), With(items=[withitem(context_expr=Call(func=Attribute(value=Name(id='pytest', ctx=Load(), lineno=65, col_offset=9, end_lineno=65, end_col_offset=15), attr='raises', ctx=Load(), lineno=65, col_offset=9, end_lineno=65, end_col_offset=22), args=[Name(id='VectorValidationError', ctx=Load(), lineno=65, col_offset=23, end_lineno=65, end_col_offset=44)], keywords=[keyword(arg='match', value=Constant(value="Record 0 is missing a non-empty 'key' string", lineno=65, col_offset=52, end_lineno=65, end_col_offset=98), lineno=65, col_offset=46, end_lineno=65, end_col_offset=98)], lineno=65, col_offset=9, end_lineno=65, end_col_offset=99))], body=[Expr(value=Call(func=Name(id='coerce_vector_batch', ctx=Load(), lineno=66, col_offset=8, end_lineno=66, end_col_offset=27), args=[Call(func=Name(id='cast', ctx=Load(), lineno=66, col_offset=28, end_lineno=66, end_col_offset=32), args=[Constant(value='Iterable[Mapping[str, object]]', lineno=66, col_offset=33, end_lineno=66, end_col_offset=65), Name(id='records', ctx=Load(), lineno=66, col_offset=67, end_lineno=66, end_col_offset=74)], lineno=66, col_offset=28, end_lineno=66, end_col_offset=75)], lineno=66, col_offset=8, end_lineno=66, end_col_offset=76), lineno=66, col_offset=8, end_lineno=66, end_col_offset=76)], lineno=65, col_offset=4, end_lineno=66, end_col_offset=76)], returns=Constant(value=None, lineno=61, col_offset=51, end_lineno=61, end_col_offset=55), lineno=61, col_offset=0, end_lineno=66, end_col_offset=76), FunctionDef(name='test_coerce_vector_batch_rejects_empty_or_duplicate_keys', args=arguments(), body=[Expr(value=Constant(value='Empty datasets or duplicate ids should fail validation.', lineno=70, col_offset=4, end_lineno=70, end_col_offset=65), lineno=70, col_offset=4, end_lineno=70, end_col_offset=65), AnnAssign(target=Name(id='cases', ctx=Store(), lineno=71, col_offset=4, end_lineno=71, end_col_offset=9), annotation=Subscript(value=Name(id='Sequence', ctx=Load(), lineno=71, col_offset=11, end_lineno=71, end_col_offset=19), slice=Subscript(value=Name(id='list', ctx=Load(), lineno=71, col_offset=20, end_lineno=71, end_col_offset=24), slice=Subscript(value=Name(id='dict', ctx=Load(), lineno=71, col_offset=25, end_lineno=71, end_col_offset=29), slice=Tuple(elts=[Name(id='str', ctx=Load(), lineno=71, col_offset=30, end_lineno=71, end_col_offset=33), Name(id='object', ctx=Load(), lineno=71, col_offset=35, end_lineno=71, end_col_offset=41)], ctx=Load(), lineno=71, col_offset=30, end_lineno=71, end_col_offset=41), ctx=Load(), lineno=71, col_offset=25, end_lineno=71, end_col_offset=42), ctx=Load(), lineno=71, col_offset=20, end_lineno=71, end_col_offset=43), ctx=Load(), lineno=71, col_offset=11, end_lineno=71, end_col_offset=44), value=List(elts=[List(ctx=Load(), lineno=72, col_offset=8, end_lineno=72, end_col_offset=10), List(elts=[Dict(keys=[Constant(value='key', lineno=73, col_offset=10, end_lineno=73, end_col_offset=15), Constant(value='vector', lineno=73, col_offset=21, end_lineno=73, end_col_offset=29)], values=[Constant(value='', lineno=73, col_offset=17, end_lineno=73, end_col_offset=19), List(elts=[Constant(value=0.1, lineno=73, col_offset=32, end_lineno=73, end_col_offset=35), Constant(value=0.2, lineno=73, col_offset=37, end_lineno=73, end_col_offset=40)], ctx=Load(), lineno=73, col_offset=31, end_lineno=73, end_col_offset=41)], lineno=73, col_offset=9, end_lineno=73, end_col_offset=42)], ctx=Load(), lineno=73, col_offset=8, end_lineno=73, end_col_offset=43), List(elts=[Dict(keys=[Constant(value='key', lineno=75, col_offset=13, end_lineno=75, end_col_offset=18), Constant(value='vector', lineno=75, col_offset=27, end_lineno=75, end_col_offset=35)], values=[Constant(value='dup', lineno=75, col_offset=20, end_lineno=75, end_col_offset=25), List(elts=[Constant(value=0.1, lineno=75, col_offset=38, end_lineno=75, end_col_offset=41), Constant(value=0.2, lineno=75, col_offset=43, end_lineno=75, end_col_offset=46)], ctx=Load(), lineno=75, col_offset=37, end_lineno=75, end_col_offset=47)], lineno=75, col_offset=12, end_lineno=75, end_col_offset=48), Dict(keys=[Constant(value='key', lineno=76, col_offset=13, end_lineno=76, end_col_offset=18), Constant(value='vector', lineno=76, col_offset=27, end_lineno=76, end_col_offset=35)], values=[Constant(value='dup', lineno=76, col_offset=20, end_lineno=76, end_col_offset=25), List(elts=[Constant(value=0.1, lineno=76, col_offset=38, end_lineno=76, end_col_offset=41), Constant(value=0.2, lineno=76, col_offset=43, end_lineno=76, end_col_offset=46)], ctx=Load(), lineno=76, col_offset=37, end_lineno=76, end_col_offset=47)], lineno=76, col_offset=12, end_lineno=76, end_col_offset=48)], ctx=Load(), lineno=74, col_offset=8, end_lineno=77, end_col_offset=9)], ctx=Load(), lineno=71, col_offset=47, end_lineno=78, end_col_offset=5), simple=1, lineno=71, col_offset=4, end_lineno=78, end_col_offset=5), For(target=Name(id='candidate', ctx=Store(), lineno=80, col_offset=8, end_lineno=80, end_col_offset=17), iter=Name(id='cases', ctx=Load(), lineno=80, col_offset=21, end_lineno=80, end_col_offset=26), body=[With(items=[withitem(context_expr=Call(func=Attribute(value=Name(id='pytest', ctx=Load(), lineno=81, col_offset=13, end_lineno=81, end_col_offset=19), attr='raises', ctx=Load(), lineno=81, col_offset=13, end_lineno=81, end_col_offset=26), args=[Name(id='VectorValidationError', ctx=Load(), lineno=81, col_offset=27, end_lineno=81, end_col_offset=48)], lineno=81, col_offset=13, end_lineno=81, end_col_offset=49))], body=[Expr(value=Call(func=Name(id='coerce_vector_batch', ctx=Load(), lineno=82, col_offset=12, end_lineno=82, end_col_offset=31), args=[Name(id='candidate', ctx=Load(), lineno=82, col_offset=32, end_lineno=82, end_col_offset=41)], lineno=82, col_offset=12, end_lineno=82, end_col_offset=42), lineno=82, col_offset=12, end_lineno=82, end_col_offset=42)], lineno=81, col_offset=8, end_lineno=82, end_col_offset=42)], lineno=80, col_offset=4, end_lineno=82, end_col_offset=42)], returns=Constant(value=None, lineno=69, col_offset=66, end_lineno=69, end_col_offset=70), lineno=69, col_offset=0, end_lineno=82, end_col_offset=42), FunctionDef(name='test_assert_vector_matrix_accepts_float_lists', args=arguments(), body=[Expr(value=Constant(value='`assert_vector_matrix` coerces nested sequences into contiguous float32 matrices.', lineno=86, col_offset=4, end_lineno=86, end_col_offset=91), lineno=86, col_offset=4, end_lineno=86, end_col_offset=91), AnnAssign(target=Name(id='matrix_input', ctx=Store(), lineno=87, col_offset=4, end_lineno=87, end_col_offset=16), annotation=Subscript(value=Name(id='Sequence', ctx=Load(), lineno=87, col_offset=18, end_lineno=87, end_col_offset=26), slice=Subscript(value=Name(id='Sequence', ctx=Load(), lineno=87, col_offset=27, end_lineno=87, end_col_offset=35), slice=Name(id='float', ctx=Load(), lineno=87, col_offset=36, end_lineno=87, end_col_offset=41), ctx=Load(), lineno=87, col_offset=27, end_lineno=87, end_col_offset=42), ctx=Load(), lineno=87, col_offset=18, end_lineno=87, end_col_offset=43), value=Tuple(elts=[List(elts=[Constant(value=1.0, lineno=87, col_offset=48, end_lineno=87, end_col_offset=51), Constant(value=2.0, lineno=87, col_offset=53, end_lineno=87, end_col_offset=56)], ctx=Load(), lineno=87, col_offset=47, end_lineno=87, end_col_offset=57), List(elts=[Constant(value=3.0, lineno=87, col_offset=60, end_lineno=87, end_col_offset=63), Constant(value=4.0, lineno=87, col_offset=65, end_lineno=87, end_col_offset=68)], ctx=Load(), lineno=87, col_offset=59, end_lineno=87, end_col_offset=69)], ctx=Load(), lineno=87, col_offset=46, end_lineno=87, end_col_offset=70), simple=1, lineno=87, col_offset=4, end_lineno=87, end_col_offset=70), Assign(targets=[Name(id='matrix', ctx=Store(), lineno=88, col_offset=4, end_lineno=88, end_col_offset=10)], value=Call(func=Name(id='assert_vector_matrix', ctx=Load(), lineno=88, col_offset=13, end_lineno=88, end_col_offset=33), args=[Name(id='matrix_input', ctx=Load(), lineno=88, col_offset=34, end_lineno=88, end_col_offset=46)], lineno=88, col_offset=13, end_lineno=88, end_col_offset=47), lineno=88, col_offset=4, end_lineno=88, end_col_offset=47), Assert(test=Compare(left=Attribute(value=Name(id='matrix', ctx=Load(), lineno=89, col_offset=11, end_lineno=89, end_col_offset=17), attr='dtype', ctx=Load(), lineno=89, col_offset=11, end_lineno=89, end_col_offset=23), ops=[Eq()], comparators=[Attribute(value=Name(id='np', ctx=Load(), lineno=89, col_offset=27, end_lineno=89, end_col_offset=29), attr='float32', ctx=Load(), lineno=89, col_offset=27, end_lineno=89, end_col_offset=37)], lineno=89, col_offset=11, end_lineno=89, end_col_offset=37), lineno=89, col_offset=4, end_lineno=89, end_col_offset=37), Assert(test=Compare(left=Attribute(value=Name(id='matrix', ctx=Load(), lineno=90, col_offset=11, end_lineno=90, end_col_offset=17), attr='shape', ctx=Load(), lineno=90, col_offset=11, end_lineno=90, end_col_offset=23), ops=[Eq()], comparators=[Tuple(elts=[Constant(value=2, lineno=90, col_offset=28, end_lineno=90, end_col_offset=29), Constant(value=2, lineno=90, col_offset=31, end_lineno=90, end_col_offset=32)], ctx=Load(), lineno=90, col_offset=27, end_lineno=90, end_col_offset=33)], lineno=90, col_offset=11, end_lineno=90, end_col_offset=33), lineno=90, col_offset=4, end_lineno=90, end_col_offset=33), Assert(test=Attribute(value=Attribute(value=Name(id='matrix', ctx=Load(), lineno=91, col_offset=11, end_lineno=91, end_col_offset=17), attr='flags', ctx=Load(), lineno=91, col_offset=11, end_lineno=91, end_col_offset=23), attr='c_contiguous', ctx=Load(), lineno=91, col_offset=11, end_lineno=91, end_col_offset=36), lineno=91, col_offset=4, end_lineno=91, end_col_offset=36)], returns=Constant(value=None, lineno=85, col_offset=55, end_lineno=85, end_col_offset=59), lineno=85, col_offset=0, end_lineno=91, end_col_offset=36), FunctionDef(name='test_assert_vector_matrix_invalid_inputs', args=arguments(), body=[Expr(value=Constant(value='Invalid matrices raise `VectorValidationError` with descriptive messages.', lineno=95, col_offset=4, end_lineno=95, end_col_offset=83), lineno=95, col_offset=4, end_lineno=95, end_col_offset=83), With(items=[withitem(context_expr=Call(func=Attribute(value=Name(id='pytest', ctx=Load(), lineno=96, col_offset=9, end_lineno=96, end_col_offset=15), attr='raises', ctx=Load(), lineno=96, col_offset=9, end_lineno=96, end_col_offset=22), args=[Name(id='VectorValidationError', ctx=Load(), lineno=96, col_offset=23, end_lineno=96, end_col_offset=44)], keywords=[keyword(arg='match', value=Constant(value='must be two-dimensional', lineno=96, col_offset=52, end_lineno=96, end_col_offset=77), lineno=96, col_offset=46, end_lineno=96, end_col_offset=77)], lineno=96, col_offset=9, end_lineno=96, end_col_offset=78))], body=[Expr(value=Call(func=Name(id='assert_vector_matrix', ctx=Load(), lineno=97, col_offset=8, end_lineno=97, end_col_offset=28), args=[List(elts=[Constant(value=1.0, lineno=97, col_offset=30, end_lineno=97, end_col_offset=33), Constant(value=2.0, lineno=97, col_offset=35, end_lineno=97, end_col_offset=38), Constant(value=3.0, lineno=97, col_offset=40, end_lineno=97, end_col_offset=43)], ctx=Load(), lineno=97, col_offset=29, end_lineno=97, end_col_offset=44)], lineno=97, col_offset=8, end_lineno=97, end_col_offset=45), lineno=97, col_offset=8, end_lineno=97, end_col_offset=45)], lineno=96, col_offset=4, end_lineno=97, end_col_offset=45), With(items=[withitem(context_expr=Call(func=Attribute(value=Name(id='pytest', ctx=Load(), lineno=99, col_offset=9, end_lineno=99, end_col_offset=15), attr='raises', ctx=Load(), lineno=99, col_offset=9, end_lineno=99, end_col_offset=22), args=[Name(id='VectorValidationError', ctx=Load(), lineno=99, col_offset=23, end_lineno=99, end_col_offset=44)], keywords=[keyword(arg='match', value=Constant(value='dimensionality must be greater than zero', lineno=99, col_offset=52, end_lineno=99, end_col_offset=94), lineno=99, col_offset=46, end_lineno=99, end_col_offset=94)], lineno=99, col_offset=9, end_lineno=99, end_col_offset=95))], body=[Expr(value=Call(func=Name(id='assert_vector_matrix', ctx=Load(), lineno=100, col_offset=8, end_lineno=100, end_col_offset=28), args=[Call(func=Attribute(value=Name(id='np', ctx=Load(), lineno=100, col_offset=29, end_lineno=100, end_col_offset=31), attr='zeros', ctx=Load(), lineno=100, col_offset=29, end_lineno=100, end_col_offset=37), args=[Tuple(elts=[Constant(value=1, lineno=100, col_offset=39, end_lineno=100, end_col_offset=40), Constant(value=0, lineno=100, col_offset=42, end_lineno=100, end_col_offset=43)], ctx=Load(), lineno=100, col_offset=38, end_lineno=100, end_col_offset=44)], keywords=[keyword(arg='dtype', value=Attribute(value=Name(id='np', ctx=Load(), lineno=100, col_offset=52, end_lineno=100, end_col_offset=54), attr='float32', ctx=Load(), lineno=100, col_offset=52, end_lineno=100, end_col_offset=62), lineno=100, col_offset=46, end_lineno=100, end_col_offset=62)], lineno=100, col_offset=29, end_lineno=100, end_col_offset=63)], lineno=100, col_offset=8, end_lineno=100, end_col_offset=64), lineno=100, col_offset=8, end_lineno=100, end_col_offset=64)], lineno=99, col_offset=4, end_lineno=100, end_col_offset=64)], returns=Constant(value=None, lineno=94, col_offset=50, end_lineno=94, end_col_offset=54), lineno=94, col_offset=0, end_lineno=100, end_col_offset=64), FunctionDef(name='test_validate_vector_batch_returns_same_instance', args=arguments(args=[arg(arg='canonical_vector_payload', annotation=Subscript(value=Name(id='list', ctx=Load(), lineno=104, col_offset=30, end_lineno=104, end_col_offset=34), slice=Subscript(value=Name(id='dict', ctx=Load(), lineno=104, col_offset=35, end_lineno=104, end_col_offset=39), slice=Tuple(elts=[Name(id='str', ctx=Load(), lineno=104, col_offset=40, end_lineno=104, end_col_offset=43), Name(id='object', ctx=Load(), lineno=104, col_offset=45, end_lineno=104, end_col_offset=51)], ctx=Load(), lineno=104, col_offset=40, end_lineno=104, end_col_offset=51), ctx=Load(), lineno=104, col_offset=35, end_lineno=104, end_col_offset=52), ctx=Load(), lineno=104, col_offset=30, end_lineno=104, end_col_offset=53), lineno=104, col_offset=4, end_lineno=104, end_col_offset=53)]), body=[Expr(value=Constant(value='`validate_vector_batch` should not copy when invariants hold.', lineno=106, col_offset=4, end_lineno=106, end_col_offset=71), lineno=106, col_offset=4, end_lineno=106, end_col_offset=71), Assign(targets=[Name(id='batch', ctx=Store(), lineno=107, col_offset=4, end_lineno=107, end_col_offset=9)], value=Call(func=Name(id='coerce_vector_batch', ctx=Load(), lineno=107, col_offset=12, end_lineno=107, end_col_offset=31), args=[Name(id='canonical_vector_payload', ctx=Load(), lineno=107, col_offset=32, end_lineno=107, end_col_offset=56)], lineno=107, col_offset=12, end_lineno=107, end_col_offset=57), lineno=107, col_offset=4, end_lineno=107, end_col_offset=57), Assign(targets=[Name(id='validated', ctx=Store(), lineno=108, col_offset=4, end_lineno=108, end_col_offset=13)], value=Call(func=Name(id='validate_vector_batch', ctx=Load(), lineno=108, col_offset=16, end_lineno=108, end_col_offset=37), args=[Name(id='batch', ctx=Load(), lineno=108, col_offset=38, end_lineno=108, end_col_offset=43)], lineno=108, col_offset=16, end_lineno=108, end_col_offset=44), lineno=108, col_offset=4, end_lineno=108, end_col_offset=44), Assert(test=Compare(left=Name(id='validated', ctx=Load(), lineno=110, col_offset=11, end_lineno=110, end_col_offset=20), ops=[Is()], comparators=[Name(id='batch', ctx=Load(), lineno=110, col_offset=24, end_lineno=110, end_col_offset=29)], lineno=110, col_offset=11, end_lineno=110, end_col_offset=29), lineno=110, col_offset=4, end_lineno=110, end_col_offset=29)], returns=Constant(value=None, lineno=105, col_offset=5, end_lineno=105, end_col_offset=9), lineno=103, col_offset=0, end_lineno=110, end_col_offset=29), FunctionDef(name='test_validate_vector_batch_detects_mismatched_ids', args=arguments(args=[arg(arg='canonical_vector_matrix', annotation=Name(id='VectorMatrix', ctx=Load(), lineno=114, col_offset=29, end_lineno=114, end_col_offset=41), lineno=114, col_offset=4, end_lineno=114, end_col_offset=41)]), body=[Expr(value=Constant(value='Row count mismatches raise `VectorValidationError`.', lineno=116, col_offset=4, end_lineno=116, end_col_offset=61), lineno=116, col_offset=4, end_lineno=116, end_col_offset=61), Assign(targets=[Name(id='ids', ctx=Store(), lineno=117, col_offset=4, end_lineno=117, end_col_offset=7)], value=Tuple(elts=[Call(func=Name(id='VectorId', ctx=Load(), lineno=117, col_offset=11, end_lineno=117, end_col_offset=19), args=[Constant(value='vec-1', lineno=117, col_offset=20, end_lineno=117, end_col_offset=27)], lineno=117, col_offset=11, end_lineno=117, end_col_offset=28)], ctx=Load(), lineno=117, col_offset=10, end_lineno=117, end_col_offset=30), lineno=117, col_offset=4, end_lineno=117, end_col_offset=30), Assign(targets=[Name(id='batch', ctx=Store(), lineno=118, col_offset=4, end_lineno=118, end_col_offset=9)], value=Call(func=Name(id='VectorBatch', ctx=Load(), lineno=118, col_offset=12, end_lineno=118, end_col_offset=23), keywords=[keyword(arg='ids', value=Name(id='ids', ctx=Load(), lineno=118, col_offset=28, end_lineno=118, end_col_offset=31), lineno=118, col_offset=24, end_lineno=118, end_col_offset=31), keyword(arg='matrix', value=Name(id='canonical_vector_matrix', ctx=Load(), lineno=118, col_offset=40, end_lineno=118, end_col_offset=63), lineno=118, col_offset=33, end_lineno=118, end_col_offset=63)], lineno=118, col_offset=12, end_lineno=118, end_col_offset=64), lineno=118, col_offset=4, end_lineno=118, end_col_offset=64), Assign(targets=[Name(id='mismatched', ctx=Store(), lineno=119, col_offset=4, end_lineno=119, end_col_offset=14)], value=Call(func=Name(id='VectorBatch', ctx=Load(), lineno=119, col_offset=17, end_lineno=119, end_col_offset=28), keywords=[keyword(arg='ids', value=Tuple(elts=[Call(func=Name(id='VectorId', ctx=Load(), lineno=120, col_offset=13, end_lineno=120, end_col_offset=21), args=[Constant(value='vec-1', lineno=120, col_offset=22, end_lineno=120, end_col_offset=29)], lineno=120, col_offset=13, end_lineno=120, end_col_offset=30), Call(func=Name(id='VectorId', ctx=Load(), lineno=120, col_offset=32, end_lineno=120, end_col_offset=40), args=[Constant(value='vec-1', lineno=120, col_offset=41, end_lineno=120, end_col_offset=48)], lineno=120, col_offset=32, end_lineno=120, end_col_offset=49)], ctx=Load(), lineno=120, col_offset=12, end_lineno=120, end_col_offset=50), lineno=120, col_offset=8, end_lineno=120, end_col_offset=50), keyword(arg='matrix', value=Name(id='canonical_vector_matrix', ctx=Load(), lineno=120, col_offset=59, end_lineno=120, end_col_offset=82), lineno=120, col_offset=52, end_lineno=120, end_col_offset=82)], lineno=119, col_offset=17, end_lineno=121, end_col_offset=5), lineno=119, col_offset=4, end_lineno=121, end_col_offset=5), With(items=[withitem(context_expr=Call(func=Attribute(value=Name(id='pytest', ctx=Load(), lineno=123, col_offset=9, end_lineno=123, end_col_offset=15), attr='raises', ctx=Load(), lineno=123, col_offset=9, end_lineno=123, end_col_offset=22), args=[Name(id='VectorValidationError', ctx=Load(), lineno=123, col_offset=23, end_lineno=123, end_col_offset=44)], keywords=[keyword(arg='match', value=Constant(value='row count', lineno=123, col_offset=52, end_lineno=123, end_col_offset=63), lineno=123, col_offset=46, end_lineno=123, end_col_offset=63)], lineno=123, col_offset=9, end_lineno=123, end_col_offset=64))], body=[Expr(value=Call(func=Name(id='validate_vector_batch', ctx=Load(), lineno=124, col_offset=8, end_lineno=124, end_col_offset=29), args=[Name(id='batch', ctx=Load(), lineno=124, col_offset=30, end_lineno=124, end_col_offset=35)], lineno=124, col_offset=8, end_lineno=124, end_col_offset=36), lineno=124, col_offset=8, end_lineno=124, end_col_offset=36)], lineno=123, col_offset=4, end_lineno=124, end_col_offset=36), With(items=[withitem(context_expr=Call(func=Attribute(value=Name(id='pytest', ctx=Load(), lineno=126, col_offset=9, end_lineno=126, end_col_offset=15), attr='raises', ctx=Load(), lineno=126, col_offset=9, end_lineno=126, end_col_offset=22), args=[Name(id='VectorValidationError', ctx=Load(), lineno=126, col_offset=23, end_lineno=126, end_col_offset=44)], keywords=[keyword(arg='match', value=Constant(value='unique', lineno=126, col_offset=52, end_lineno=126, end_col_offset=60), lineno=126, col_offset=46, end_lineno=126, end_col_offset=60)], lineno=126, col_offset=9, end_lineno=126, end_col_offset=61))], body=[Expr(value=Call(func=Name(id='validate_vector_batch', ctx=Load(), lineno=127, col_offset=8, end_lineno=127, end_col_offset=29), args=[Name(id='mismatched', ctx=Load(), lineno=127, col_offset=30, end_lineno=127, end_col_offset=40)], lineno=127, col_offset=8, end_lineno=127, end_col_offset=41), lineno=127, col_offset=8, end_lineno=127, end_col_offset=41)], lineno=126, col_offset=4, end_lineno=127, end_col_offset=41)], returns=Constant(value=None, lineno=115, col_offset=5, end_lineno=115, end_col_offset=9), lineno=113, col_offset=0, end_lineno=127, end_col_offset=41), FunctionDef(name='test_vector_batch_dimension_and_count_properties', args=arguments(args=[arg(arg='canonical_vector_payload', annotation=Subscript(value=Name(id='list', ctx=Load(), lineno=131, col_offset=30, end_lineno=131, end_col_offset=34), slice=Subscript(value=Name(id='dict', ctx=Load(), lineno=131, col_offset=35, end_lineno=131, end_col_offset=39), slice=Tuple(elts=[Name(id='str', ctx=Load(), lineno=131, col_offset=40, end_lineno=131, end_col_offset=43), Name(id='object', ctx=Load(), lineno=131, col_offset=45, end_lineno=131, end_col_offset=51)], ctx=Load(), lineno=131, col_offset=40, end_lineno=131, end_col_offset=51), ctx=Load(), lineno=131, col_offset=35, end_lineno=131, end_col_offset=52), ctx=Load(), lineno=131, col_offset=30, end_lineno=131, end_col_offset=53), lineno=131, col_offset=4, end_lineno=131, end_col_offset=53)]), body=[Expr(value=Constant(value='`VectorBatch` exposes convenience properties for dimension and count.', lineno=133, col_offset=4, end_lineno=133, end_col_offset=79), lineno=133, col_offset=4, end_lineno=133, end_col_offset=79), Assign(targets=[Name(id='batch', ctx=Store(), lineno=134, col_offset=4, end_lineno=134, end_col_offset=9)], value=Call(func=Name(id='coerce_vector_batch', ctx=Load(), lineno=134, col_offset=12, end_lineno=134, end_col_offset=31), args=[Name(id='canonical_vector_payload', ctx=Load(), lineno=134, col_offset=32, end_lineno=134, end_col_offset=56)], lineno=134, col_offset=12, end_lineno=134, end_col_offset=57), lineno=134, col_offset=4, end_lineno=134, end_col_offset=57), Assert(test=Compare(left=Attribute(value=Name(id='batch', ctx=Load(), lineno=136, col_offset=11, end_lineno=136, end_col_offset=16), attr='count', ctx=Load(), lineno=136, col_offset=11, end_lineno=136, end_col_offset=22), ops=[Eq()], comparators=[Constant(value=2, lineno=136, col_offset=26, end_lineno=136, end_col_offset=27)], lineno=136, col_offset=11, end_lineno=136, end_col_offset=27), lineno=136, col_offset=4, end_lineno=136, end_col_offset=27), Assert(test=Compare(left=Attribute(value=Name(id='batch', ctx=Load(), lineno=137, col_offset=11, end_lineno=137, end_col_offset=16), attr='dimension', ctx=Load(), lineno=137, col_offset=11, end_lineno=137, end_col_offset=26), ops=[Eq()], comparators=[Constant(value=3, lineno=137, col_offset=30, end_lineno=137, end_col_offset=31)], lineno=137, col_offset=11, end_lineno=137, end_col_offset=31), lineno=137, col_offset=4, end_lineno=137, end_col_offset=31)], returns=Constant(value=None, lineno=132, col_offset=5, end_lineno=132, end_col_offset=9), lineno=130, col_offset=0, end_lineno=137, end_col_offset=31)])