Module(body=[Expr(value=Constant(value='FastMCP server with QueryScope tools.\n\nImplements full MCP tool catalog for code intelligence.\n', lineno=1, col_offset=0, end_lineno=4, end_col_offset=3), lineno=1, col_offset=0, end_lineno=4, end_col_offset=3), ImportFrom(module='__future__', names=[alias(name='annotations', lineno=6, col_offset=23, end_lineno=6, end_col_offset=34)], level=0, lineno=6, col_offset=0, end_lineno=6, end_col_offset=34), Import(names=[alias(name='contextvars', lineno=8, col_offset=7, end_lineno=8, end_col_offset=18)], lineno=8, col_offset=0, end_lineno=8, end_col_offset=18), ImportFrom(module='fastmcp', names=[alias(name='FastMCP', lineno=10, col_offset=20, end_lineno=10, end_col_offset=27)], level=0, lineno=10, col_offset=0, end_lineno=10, end_col_offset=27), ImportFrom(module='codeintel_rev.app.config_context', names=[alias(name='ApplicationContext', lineno=12, col_offset=45, end_lineno=12, end_col_offset=63)], level=0, lineno=12, col_offset=0, end_lineno=12, end_col_offset=63), ImportFrom(module='codeintel_rev.mcp_server.adapters', names=[alias(name='files', asname='files_adapter', lineno=13, col_offset=46, end_lineno=13, end_col_offset=68)], level=0, lineno=13, col_offset=0, end_lineno=13, end_col_offset=68), ImportFrom(module='codeintel_rev.mcp_server.adapters', names=[alias(name='history', asname='history_adapter', lineno=14, col_offset=46, end_lineno=14, end_col_offset=72)], level=0, lineno=14, col_offset=0, end_lineno=14, end_col_offset=72), ImportFrom(module='codeintel_rev.mcp_server.adapters', names=[alias(name='semantic', asname='semantic_adapter', lineno=15, col_offset=46, end_lineno=15, end_col_offset=74)], level=0, lineno=15, col_offset=0, end_lineno=15, end_col_offset=74), ImportFrom(module='codeintel_rev.mcp_server.adapters', names=[alias(name='semantic_pro', asname='semantic_pro_adapter', lineno=16, col_offset=46, end_lineno=16, end_col_offset=82)], level=0, lineno=16, col_offset=0, end_lineno=16, end_col_offset=82), ImportFrom(module='codeintel_rev.mcp_server.adapters', names=[alias(name='text_search', asname='text_search_adapter', lineno=17, col_offset=46, end_lineno=17, end_col_offset=80)], level=0, lineno=17, col_offset=0, end_lineno=17, end_col_offset=80), ImportFrom(module='codeintel_rev.mcp_server.error_handling', names=[alias(name='handle_adapter_errors', lineno=18, col_offset=52, end_lineno=18, end_col_offset=73)], level=0, lineno=18, col_offset=0, end_lineno=18, end_col_offset=73), ImportFrom(module='codeintel_rev.mcp_server.schemas', names=[alias(name='AnswerEnvelope', lineno=20, col_offset=4, end_lineno=20, end_col_offset=18), alias(name='Location', lineno=21, col_offset=4, end_lineno=21, end_col_offset=12), alias(name='ScopeIn', lineno=22, col_offset=4, end_lineno=22, end_col_offset=11), alias(name='SymbolInfo', lineno=23, col_offset=4, end_lineno=23, end_col_offset=14)], level=0, lineno=19, col_offset=0, end_lineno=24, end_col_offset=1), Assign(targets=[Name(id='mcp', ctx=Store(), lineno=27, col_offset=0, end_lineno=27, end_col_offset=3)], value=Call(func=Name(id='FastMCP', ctx=Load(), lineno=27, col_offset=6, end_lineno=27, end_col_offset=13), args=[Constant(value='CodeIntel MCP', lineno=27, col_offset=14, end_lineno=27, end_col_offset=29)], lineno=27, col_offset=6, end_lineno=27, end_col_offset=30), lineno=27, col_offset=0, end_lineno=27, end_col_offset=30), AnnAssign(target=Name(id='app_context', ctx=Store(), lineno=32, col_offset=0, end_lineno=32, end_col_offset=11), annotation=Subscript(value=Attribute(value=Name(id='contextvars', ctx=Load(), lineno=32, col_offset=13, end_lineno=32, end_col_offset=24), attr='ContextVar', ctx=Load(), lineno=32, col_offset=13, end_lineno=32, end_col_offset=35), slice=BinOp(left=Name(id='ApplicationContext', ctx=Load(), lineno=32, col_offset=36, end_lineno=32, end_col_offset=54), op=BitOr(), right=Constant(value=None, lineno=32, col_offset=57, end_lineno=32, end_col_offset=61), lineno=32, col_offset=36, end_lineno=32, end_col_offset=61), ctx=Load(), lineno=32, col_offset=13, end_lineno=32, end_col_offset=62), value=Call(func=Attribute(value=Name(id='contextvars', ctx=Load(), lineno=32, col_offset=65, end_lineno=32, end_col_offset=76), attr='ContextVar', ctx=Load(), lineno=32, col_offset=65, end_lineno=32, end_col_offset=87), args=[Constant(value='app_context', lineno=33, col_offset=4, end_lineno=33, end_col_offset=17)], keywords=[keyword(arg='default', value=Constant(value=None, lineno=33, col_offset=27, end_lineno=33, end_col_offset=31), lineno=33, col_offset=19, end_lineno=33, end_col_offset=31)], lineno=32, col_offset=65, end_lineno=34, end_col_offset=1), simple=1, lineno=32, col_offset=0, end_lineno=34, end_col_offset=1), FunctionDef(name='get_context', args=arguments(), body=[Expr(value=Constant(value="Extract ApplicationContext from context variable.\n\n    The context is set by middleware in main.py for each request.\n    This allows tool handlers to access ApplicationContext without\n    requiring Request injection (which FastMCP doesn't support).\n\n    Returns\n    -------\n    ApplicationContext\n        Application context for the current request.\n\n    Raises\n    ------\n    RuntimeError\n        If context is not initialized (should never happen after startup).\n    ", lineno=38, col_offset=4, end_lineno=53, end_col_offset=7), lineno=38, col_offset=4, end_lineno=53, end_col_offset=7), Assign(targets=[Name(id='context', ctx=Store(), lineno=54, col_offset=4, end_lineno=54, end_col_offset=11)], value=Call(func=Attribute(value=Name(id='app_context', ctx=Load(), lineno=54, col_offset=14, end_lineno=54, end_col_offset=25), attr='get', ctx=Load(), lineno=54, col_offset=14, end_lineno=54, end_col_offset=29), lineno=54, col_offset=14, end_lineno=54, end_col_offset=31), lineno=54, col_offset=4, end_lineno=54, end_col_offset=31), If(test=Compare(left=Name(id='context', ctx=Load(), lineno=55, col_offset=7, end_lineno=55, end_col_offset=14), ops=[Is()], comparators=[Constant(value=None, lineno=55, col_offset=18, end_lineno=55, end_col_offset=22)], lineno=55, col_offset=7, end_lineno=55, end_col_offset=22), body=[Assign(targets=[Name(id='msg', ctx=Store(), lineno=56, col_offset=8, end_lineno=56, end_col_offset=11)], value=Constant(value='ApplicationContext not initialized in request context', lineno=56, col_offset=14, end_lineno=56, end_col_offset=69), lineno=56, col_offset=8, end_lineno=56, end_col_offset=69), Raise(exc=Call(func=Name(id='RuntimeError', ctx=Load(), lineno=57, col_offset=14, end_lineno=57, end_col_offset=26), args=[Name(id='msg', ctx=Load(), lineno=57, col_offset=27, end_lineno=57, end_col_offset=30)], lineno=57, col_offset=14, end_lineno=57, end_col_offset=31), lineno=57, col_offset=8, end_lineno=57, end_col_offset=31)], lineno=55, col_offset=4, end_lineno=57, end_col_offset=31), Return(value=Name(id='context', ctx=Load(), lineno=58, col_offset=11, end_lineno=58, end_col_offset=18), lineno=58, col_offset=4, end_lineno=58, end_col_offset=18)], returns=Name(id='ApplicationContext', ctx=Load(), lineno=37, col_offset=21, end_lineno=37, end_col_offset=39), lineno=37, col_offset=0, end_lineno=58, end_col_offset=18), AsyncFunctionDef(name='set_scope', args=arguments(args=[arg(arg='scope', annotation=Name(id='ScopeIn', ctx=Load(), lineno=65, col_offset=27, end_lineno=65, end_col_offset=34), lineno=65, col_offset=20, end_lineno=65, end_col_offset=34)]), body=[Expr(value=Constant(value='Set query scope for subsequent operations.\n\n    Parameters\n    ----------\n    scope : ScopeIn\n        Scope parameters (repos, branches, paths, languages).\n\n    Returns\n    -------\n    dict\n        Effective scope configuration.\n    ', lineno=66, col_offset=4, end_lineno=77, end_col_offset=7), lineno=66, col_offset=4, end_lineno=77, end_col_offset=7), Assign(targets=[Name(id='context', ctx=Store(), lineno=78, col_offset=4, end_lineno=78, end_col_offset=11)], value=Call(func=Name(id='get_context', ctx=Load(), lineno=78, col_offset=14, end_lineno=78, end_col_offset=25), lineno=78, col_offset=14, end_lineno=78, end_col_offset=27), lineno=78, col_offset=4, end_lineno=78, end_col_offset=27), Return(value=Await(value=Call(func=Attribute(value=Name(id='files_adapter', ctx=Load(), lineno=79, col_offset=17, end_lineno=79, end_col_offset=30), attr='set_scope', ctx=Load(), lineno=79, col_offset=17, end_lineno=79, end_col_offset=40), args=[Name(id='context', ctx=Load(), lineno=79, col_offset=41, end_lineno=79, end_col_offset=48), Name(id='scope', ctx=Load(), lineno=79, col_offset=50, end_lineno=79, end_col_offset=55)], lineno=79, col_offset=17, end_lineno=79, end_col_offset=56), lineno=79, col_offset=11, end_lineno=79, end_col_offset=56), lineno=79, col_offset=4, end_lineno=79, end_col_offset=56)], decorator_list=[Call(func=Attribute(value=Name(id='mcp', ctx=Load(), lineno=64, col_offset=1, end_lineno=64, end_col_offset=4), attr='tool', ctx=Load(), lineno=64, col_offset=1, end_lineno=64, end_col_offset=9), lineno=64, col_offset=1, end_lineno=64, end_col_offset=11)], returns=Name(id='dict', ctx=Load(), lineno=65, col_offset=39, end_lineno=65, end_col_offset=43), lineno=65, col_offset=0, end_lineno=79, end_col_offset=56), AsyncFunctionDef(name='list_paths', args=arguments(args=[arg(arg='path', annotation=BinOp(left=Name(id='str', ctx=Load(), lineno=88, col_offset=10, end_lineno=88, end_col_offset=13), op=BitOr(), right=Constant(value=None, lineno=88, col_offset=16, end_lineno=88, end_col_offset=20), lineno=88, col_offset=10, end_lineno=88, end_col_offset=20), lineno=88, col_offset=4, end_lineno=88, end_col_offset=20), arg(arg='include_globs', annotation=BinOp(left=Subscript(value=Name(id='list', ctx=Load(), lineno=89, col_offset=19, end_lineno=89, end_col_offset=23), slice=Name(id='str', ctx=Load(), lineno=89, col_offset=24, end_lineno=89, end_col_offset=27), ctx=Load(), lineno=89, col_offset=19, end_lineno=89, end_col_offset=28), op=BitOr(), right=Constant(value=None, lineno=89, col_offset=31, end_lineno=89, end_col_offset=35), lineno=89, col_offset=19, end_lineno=89, end_col_offset=35), lineno=89, col_offset=4, end_lineno=89, end_col_offset=35), arg(arg='exclude_globs', annotation=BinOp(left=Subscript(value=Name(id='list', ctx=Load(), lineno=90, col_offset=19, end_lineno=90, end_col_offset=23), slice=Name(id='str', ctx=Load(), lineno=90, col_offset=24, end_lineno=90, end_col_offset=27), ctx=Load(), lineno=90, col_offset=19, end_lineno=90, end_col_offset=28), op=BitOr(), right=Constant(value=None, lineno=90, col_offset=31, end_lineno=90, end_col_offset=35), lineno=90, col_offset=19, end_lineno=90, end_col_offset=35), lineno=90, col_offset=4, end_lineno=90, end_col_offset=35), arg(arg='languages', annotation=BinOp(left=Subscript(value=Name(id='list', ctx=Load(), lineno=91, col_offset=15, end_lineno=91, end_col_offset=19), slice=Name(id='str', ctx=Load(), lineno=91, col_offset=20, end_lineno=91, end_col_offset=23), ctx=Load(), lineno=91, col_offset=15, end_lineno=91, end_col_offset=24), op=BitOr(), right=Constant(value=None, lineno=91, col_offset=27, end_lineno=91, end_col_offset=31), lineno=91, col_offset=15, end_lineno=91, end_col_offset=31), lineno=91, col_offset=4, end_lineno=91, end_col_offset=31), arg(arg='max_results', annotation=Name(id='int', ctx=Load(), lineno=92, col_offset=17, end_lineno=92, end_col_offset=20), lineno=92, col_offset=4, end_lineno=92, end_col_offset=20)], defaults=[Constant(value=None, lineno=88, col_offset=23, end_lineno=88, end_col_offset=27), Constant(value=None, lineno=89, col_offset=38, end_lineno=89, end_col_offset=42), Constant(value=None, lineno=90, col_offset=38, end_lineno=90, end_col_offset=42), Constant(value=None, lineno=91, col_offset=34, end_lineno=91, end_col_offset=38), Constant(value=1000, lineno=92, col_offset=23, end_lineno=92, end_col_offset=27)]), body=[Expr(value=Constant(value='List files in scope (async).\n\n    Error handling is automatic via decorator. All exceptions are caught\n    and converted to unified error envelopes with Problem Details.\n\n    Parameters\n    ----------\n    path : str | None\n        Starting path (defaults to repo root).\n    include_globs : list[str] | None\n        Glob patterns to include.\n    exclude_globs : list[str] | None\n        Glob patterns to exclude.\n    languages : list[str] | None\n        Programming languages to include.\n    max_results : int\n        Maximum results to return.\n\n    Returns\n    -------\n    dict\n        File listing with paths. On error, returns error envelope with\n        empty result fields and Problem Details.\n    ', lineno=94, col_offset=4, end_lineno=117, end_col_offset=7), lineno=94, col_offset=4, end_lineno=117, end_col_offset=7), Assign(targets=[Name(id='context', ctx=Store(), lineno=118, col_offset=4, end_lineno=118, end_col_offset=11)], value=Call(func=Name(id='get_context', ctx=Load(), lineno=118, col_offset=14, end_lineno=118, end_col_offset=25), lineno=118, col_offset=14, end_lineno=118, end_col_offset=27), lineno=118, col_offset=4, end_lineno=118, end_col_offset=27), Return(value=Await(value=Call(func=Attribute(value=Name(id='files_adapter', ctx=Load(), lineno=119, col_offset=17, end_lineno=119, end_col_offset=30), attr='list_paths', ctx=Load(), lineno=119, col_offset=17, end_lineno=119, end_col_offset=41), args=[Name(id='context', ctx=Load(), lineno=120, col_offset=8, end_lineno=120, end_col_offset=15)], keywords=[keyword(arg='path', value=Name(id='path', ctx=Load(), lineno=121, col_offset=13, end_lineno=121, end_col_offset=17), lineno=121, col_offset=8, end_lineno=121, end_col_offset=17), keyword(arg='include_globs', value=Name(id='include_globs', ctx=Load(), lineno=122, col_offset=22, end_lineno=122, end_col_offset=35), lineno=122, col_offset=8, end_lineno=122, end_col_offset=35), keyword(arg='exclude_globs', value=Name(id='exclude_globs', ctx=Load(), lineno=123, col_offset=22, end_lineno=123, end_col_offset=35), lineno=123, col_offset=8, end_lineno=123, end_col_offset=35), keyword(arg='languages', value=Name(id='languages', ctx=Load(), lineno=124, col_offset=18, end_lineno=124, end_col_offset=27), lineno=124, col_offset=8, end_lineno=124, end_col_offset=27), keyword(arg='max_results', value=Name(id='max_results', ctx=Load(), lineno=125, col_offset=20, end_lineno=125, end_col_offset=31), lineno=125, col_offset=8, end_lineno=125, end_col_offset=31)], lineno=119, col_offset=17, end_lineno=126, end_col_offset=5), lineno=119, col_offset=11, end_lineno=126, end_col_offset=5), lineno=119, col_offset=4, end_lineno=126, end_col_offset=5)], decorator_list=[Call(func=Attribute(value=Name(id='mcp', ctx=Load(), lineno=82, col_offset=1, end_lineno=82, end_col_offset=4), attr='tool', ctx=Load(), lineno=82, col_offset=1, end_lineno=82, end_col_offset=9), lineno=82, col_offset=1, end_lineno=82, end_col_offset=11), Call(func=Name(id='handle_adapter_errors', ctx=Load(), lineno=83, col_offset=1, end_lineno=83, end_col_offset=22), keywords=[keyword(arg='operation', value=Constant(value='files:list_paths', lineno=84, col_offset=14, end_lineno=84, end_col_offset=32), lineno=84, col_offset=4, end_lineno=84, end_col_offset=32), keyword(arg='empty_result', value=Dict(keys=[Constant(value='items', lineno=85, col_offset=18, end_lineno=85, end_col_offset=25), Constant(value='total', lineno=85, col_offset=31, end_lineno=85, end_col_offset=38), Constant(value='truncated', lineno=85, col_offset=43, end_lineno=85, end_col_offset=54)], values=[List(ctx=Load(), lineno=85, col_offset=27, end_lineno=85, end_col_offset=29), Constant(value=0, lineno=85, col_offset=40, end_lineno=85, end_col_offset=41), Constant(value=False, lineno=85, col_offset=56, end_lineno=85, end_col_offset=61)], lineno=85, col_offset=17, end_lineno=85, end_col_offset=62), lineno=85, col_offset=4, end_lineno=85, end_col_offset=62)], lineno=83, col_offset=1, end_lineno=86, end_col_offset=1)], returns=Name(id='dict', ctx=Load(), lineno=93, col_offset=5, end_lineno=93, end_col_offset=9), lineno=87, col_offset=0, end_lineno=126, end_col_offset=5), FunctionDef(name='open_file', args=arguments(args=[arg(arg='path', annotation=Name(id='str', ctx=Load(), lineno=135, col_offset=10, end_lineno=135, end_col_offset=13), lineno=135, col_offset=4, end_lineno=135, end_col_offset=13), arg(arg='start_line', annotation=BinOp(left=Name(id='int', ctx=Load(), lineno=136, col_offset=16, end_lineno=136, end_col_offset=19), op=BitOr(), right=Constant(value=None, lineno=136, col_offset=22, end_lineno=136, end_col_offset=26), lineno=136, col_offset=16, end_lineno=136, end_col_offset=26), lineno=136, col_offset=4, end_lineno=136, end_col_offset=26), arg(arg='end_line', annotation=BinOp(left=Name(id='int', ctx=Load(), lineno=137, col_offset=14, end_lineno=137, end_col_offset=17), op=BitOr(), right=Constant(value=None, lineno=137, col_offset=20, end_lineno=137, end_col_offset=24), lineno=137, col_offset=14, end_lineno=137, end_col_offset=24), lineno=137, col_offset=4, end_lineno=137, end_col_offset=24)], defaults=[Constant(value=None, lineno=136, col_offset=29, end_lineno=136, end_col_offset=33), Constant(value=None, lineno=137, col_offset=27, end_lineno=137, end_col_offset=31)]), body=[Expr(value=Constant(value='Read file content.\n\n    Error handling is automatic via decorator. All exceptions are caught\n    and converted to unified error envelopes with Problem Details.\n\n    Parameters\n    ----------\n    path : str\n        File path.\n    start_line : int | None\n        Start line (1-indexed, inclusive).\n    end_line : int | None\n        End line (1-indexed, inclusive).\n\n    Returns\n    -------\n    dict\n        File content and metadata. On error, returns error envelope with\n        empty result fields and Problem Details.\n    ', lineno=139, col_offset=4, end_lineno=158, end_col_offset=7), lineno=139, col_offset=4, end_lineno=158, end_col_offset=7), Assign(targets=[Name(id='context', ctx=Store(), lineno=159, col_offset=4, end_lineno=159, end_col_offset=11)], value=Call(func=Name(id='get_context', ctx=Load(), lineno=159, col_offset=14, end_lineno=159, end_col_offset=25), lineno=159, col_offset=14, end_lineno=159, end_col_offset=27), lineno=159, col_offset=4, end_lineno=159, end_col_offset=27), Return(value=Call(func=Attribute(value=Name(id='files_adapter', ctx=Load(), lineno=160, col_offset=11, end_lineno=160, end_col_offset=24), attr='open_file', ctx=Load(), lineno=160, col_offset=11, end_lineno=160, end_col_offset=34), args=[Name(id='context', ctx=Load(), lineno=160, col_offset=35, end_lineno=160, end_col_offset=42), Name(id='path', ctx=Load(), lineno=160, col_offset=44, end_lineno=160, end_col_offset=48), Name(id='start_line', ctx=Load(), lineno=160, col_offset=50, end_lineno=160, end_col_offset=60), Name(id='end_line', ctx=Load(), lineno=160, col_offset=62, end_lineno=160, end_col_offset=70)], lineno=160, col_offset=11, end_lineno=160, end_col_offset=71), lineno=160, col_offset=4, end_lineno=160, end_col_offset=71)], decorator_list=[Call(func=Attribute(value=Name(id='mcp', ctx=Load(), lineno=129, col_offset=1, end_lineno=129, end_col_offset=4), attr='tool', ctx=Load(), lineno=129, col_offset=1, end_lineno=129, end_col_offset=9), lineno=129, col_offset=1, end_lineno=129, end_col_offset=11), Call(func=Name(id='handle_adapter_errors', ctx=Load(), lineno=130, col_offset=1, end_lineno=130, end_col_offset=22), keywords=[keyword(arg='operation', value=Constant(value='files:open_file', lineno=131, col_offset=14, end_lineno=131, end_col_offset=31), lineno=131, col_offset=4, end_lineno=131, end_col_offset=31), keyword(arg='empty_result', value=Dict(keys=[Constant(value='path', lineno=132, col_offset=18, end_lineno=132, end_col_offset=24), Constant(value='content', lineno=132, col_offset=30, end_lineno=132, end_col_offset=39), Constant(value='lines', lineno=132, col_offset=45, end_lineno=132, end_col_offset=52), Constant(value='size', lineno=132, col_offset=57, end_lineno=132, end_col_offset=63)], values=[Constant(value='', lineno=132, col_offset=26, end_lineno=132, end_col_offset=28), Constant(value='', lineno=132, col_offset=41, end_lineno=132, end_col_offset=43), Constant(value=0, lineno=132, col_offset=54, end_lineno=132, end_col_offset=55), Constant(value=0, lineno=132, col_offset=65, end_lineno=132, end_col_offset=66)], lineno=132, col_offset=17, end_lineno=132, end_col_offset=67), lineno=132, col_offset=4, end_lineno=132, end_col_offset=67)], lineno=130, col_offset=1, end_lineno=133, end_col_offset=1)], returns=Name(id='dict', ctx=Load(), lineno=138, col_offset=5, end_lineno=138, end_col_offset=9), lineno=134, col_offset=0, end_lineno=160, end_col_offset=71), AsyncFunctionDef(name='search_text', args=arguments(args=[arg(arg='query', annotation=Name(id='str', ctx=Load(), lineno=172, col_offset=11, end_lineno=172, end_col_offset=14), lineno=172, col_offset=4, end_lineno=172, end_col_offset=14)], kwonlyargs=[arg(arg='regex', annotation=Name(id='bool', ctx=Load(), lineno=174, col_offset=11, end_lineno=174, end_col_offset=15), lineno=174, col_offset=4, end_lineno=174, end_col_offset=15), arg(arg='case_sensitive', annotation=Name(id='bool', ctx=Load(), lineno=175, col_offset=20, end_lineno=175, end_col_offset=24), lineno=175, col_offset=4, end_lineno=175, end_col_offset=24), arg(arg='paths', annotation=BinOp(left=Subscript(value=Name(id='list', ctx=Load(), lineno=176, col_offset=11, end_lineno=176, end_col_offset=15), slice=Name(id='str', ctx=Load(), lineno=176, col_offset=16, end_lineno=176, end_col_offset=19), ctx=Load(), lineno=176, col_offset=11, end_lineno=176, end_col_offset=20), op=BitOr(), right=Constant(value=None, lineno=176, col_offset=23, end_lineno=176, end_col_offset=27), lineno=176, col_offset=11, end_lineno=176, end_col_offset=27), lineno=176, col_offset=4, end_lineno=176, end_col_offset=27), arg(arg='max_results', annotation=Name(id='int', ctx=Load(), lineno=177, col_offset=17, end_lineno=177, end_col_offset=20), lineno=177, col_offset=4, end_lineno=177, end_col_offset=20)], kw_defaults=[Constant(value=False, lineno=174, col_offset=18, end_lineno=174, end_col_offset=23), Constant(value=False, lineno=175, col_offset=27, end_lineno=175, end_col_offset=32), Constant(value=None, lineno=176, col_offset=30, end_lineno=176, end_col_offset=34), Constant(value=50, lineno=177, col_offset=23, end_lineno=177, end_col_offset=25)]), body=[Expr(value=Constant(value='Fast text search (ripgrep-like).\n\n    Error handling is automatic via decorator. All exceptions are caught\n    and converted to unified error envelopes with Problem Details.\n\n    Parameters\n    ----------\n    query : str\n        Search query.\n    regex : bool\n        Treat query as regex.\n    case_sensitive : bool\n        Case-sensitive search.\n    paths : list[str] | None\n        Paths to search in.\n    max_results : int\n        Maximum results.\n\n    Returns\n    -------\n    dict\n        Search matches. On error, returns error envelope with empty result\n        fields and Problem Details.\n    ', lineno=179, col_offset=4, end_lineno=202, end_col_offset=7), lineno=179, col_offset=4, end_lineno=202, end_col_offset=7), Assign(targets=[Name(id='context', ctx=Store(), lineno=203, col_offset=4, end_lineno=203, end_col_offset=11)], value=Call(func=Name(id='get_context', ctx=Load(), lineno=203, col_offset=14, end_lineno=203, end_col_offset=25), lineno=203, col_offset=14, end_lineno=203, end_col_offset=27), lineno=203, col_offset=4, end_lineno=203, end_col_offset=27), Return(value=Await(value=Call(func=Attribute(value=Name(id='text_search_adapter', ctx=Load(), lineno=204, col_offset=17, end_lineno=204, end_col_offset=36), attr='search_text', ctx=Load(), lineno=204, col_offset=17, end_lineno=204, end_col_offset=48), args=[Name(id='context', ctx=Load(), lineno=205, col_offset=8, end_lineno=205, end_col_offset=15), Name(id='query', ctx=Load(), lineno=206, col_offset=8, end_lineno=206, end_col_offset=13)], keywords=[keyword(arg='regex', value=Name(id='regex', ctx=Load(), lineno=207, col_offset=14, end_lineno=207, end_col_offset=19), lineno=207, col_offset=8, end_lineno=207, end_col_offset=19), keyword(arg='case_sensitive', value=Name(id='case_sensitive', ctx=Load(), lineno=208, col_offset=23, end_lineno=208, end_col_offset=37), lineno=208, col_offset=8, end_lineno=208, end_col_offset=37), keyword(arg='paths', value=Name(id='paths', ctx=Load(), lineno=209, col_offset=14, end_lineno=209, end_col_offset=19), lineno=209, col_offset=8, end_lineno=209, end_col_offset=19), keyword(arg='max_results', value=Name(id='max_results', ctx=Load(), lineno=210, col_offset=20, end_lineno=210, end_col_offset=31), lineno=210, col_offset=8, end_lineno=210, end_col_offset=31)], lineno=204, col_offset=17, end_lineno=211, end_col_offset=5), lineno=204, col_offset=11, end_lineno=211, end_col_offset=5), lineno=204, col_offset=4, end_lineno=211, end_col_offset=5)], decorator_list=[Call(func=Attribute(value=Name(id='mcp', ctx=Load(), lineno=166, col_offset=1, end_lineno=166, end_col_offset=4), attr='tool', ctx=Load(), lineno=166, col_offset=1, end_lineno=166, end_col_offset=9), lineno=166, col_offset=1, end_lineno=166, end_col_offset=11), Call(func=Name(id='handle_adapter_errors', ctx=Load(), lineno=167, col_offset=1, end_lineno=167, end_col_offset=22), keywords=[keyword(arg='operation', value=Constant(value='search:text', lineno=168, col_offset=14, end_lineno=168, end_col_offset=27), lineno=168, col_offset=4, end_lineno=168, end_col_offset=27), keyword(arg='empty_result', value=Dict(keys=[Constant(value='matches', lineno=169, col_offset=18, end_lineno=169, end_col_offset=27), Constant(value='total', lineno=169, col_offset=33, end_lineno=169, end_col_offset=40), Constant(value='truncated', lineno=169, col_offset=45, end_lineno=169, end_col_offset=56)], values=[List(ctx=Load(), lineno=169, col_offset=29, end_lineno=169, end_col_offset=31), Constant(value=0, lineno=169, col_offset=42, end_lineno=169, end_col_offset=43), Constant(value=False, lineno=169, col_offset=58, end_lineno=169, end_col_offset=63)], lineno=169, col_offset=17, end_lineno=169, end_col_offset=64), lineno=169, col_offset=4, end_lineno=169, end_col_offset=64)], lineno=167, col_offset=1, end_lineno=170, end_col_offset=1)], returns=Name(id='dict', ctx=Load(), lineno=178, col_offset=5, end_lineno=178, end_col_offset=9), lineno=171, col_offset=0, end_lineno=211, end_col_offset=5), AsyncFunctionDef(name='semantic_search', args=arguments(args=[arg(arg='query', annotation=Name(id='str', ctx=Load(), lineno=220, col_offset=11, end_lineno=220, end_col_offset=14), lineno=220, col_offset=4, end_lineno=220, end_col_offset=14), arg(arg='limit', annotation=Name(id='int', ctx=Load(), lineno=221, col_offset=11, end_lineno=221, end_col_offset=14), lineno=221, col_offset=4, end_lineno=221, end_col_offset=14)], defaults=[Constant(value=20, lineno=221, col_offset=17, end_lineno=221, end_col_offset=19)]), body=[Expr(value=Constant(value='Semantic code search using embeddings.\n\n    Error handling is automatic via decorator. All exceptions are caught\n    and converted to unified error envelopes with Problem Details.\n\n    Parameters\n    ----------\n    query : str\n        Natural language or code query.\n    limit : int\n        Maximum results.\n\n    Returns\n    -------\n    AnswerEnvelope\n        Search results with findings. On error, returns error envelope with\n        empty result fields and Problem Details.\n    ', lineno=223, col_offset=4, end_lineno=240, end_col_offset=7), lineno=223, col_offset=4, end_lineno=240, end_col_offset=7), Assign(targets=[Name(id='context', ctx=Store(), lineno=241, col_offset=4, end_lineno=241, end_col_offset=11)], value=Call(func=Name(id='get_context', ctx=Load(), lineno=241, col_offset=14, end_lineno=241, end_col_offset=25), lineno=241, col_offset=14, end_lineno=241, end_col_offset=27), lineno=241, col_offset=4, end_lineno=241, end_col_offset=27), Return(value=Await(value=Call(func=Attribute(value=Name(id='semantic_adapter', ctx=Load(), lineno=242, col_offset=17, end_lineno=242, end_col_offset=33), attr='semantic_search', ctx=Load(), lineno=242, col_offset=17, end_lineno=242, end_col_offset=49), args=[Name(id='context', ctx=Load(), lineno=242, col_offset=50, end_lineno=242, end_col_offset=57), Name(id='query', ctx=Load(), lineno=242, col_offset=59, end_lineno=242, end_col_offset=64), Name(id='limit', ctx=Load(), lineno=242, col_offset=66, end_lineno=242, end_col_offset=71)], lineno=242, col_offset=17, end_lineno=242, end_col_offset=72), lineno=242, col_offset=11, end_lineno=242, end_col_offset=72), lineno=242, col_offset=4, end_lineno=242, end_col_offset=72)], decorator_list=[Call(func=Attribute(value=Name(id='mcp', ctx=Load(), lineno=214, col_offset=1, end_lineno=214, end_col_offset=4), attr='tool', ctx=Load(), lineno=214, col_offset=1, end_lineno=214, end_col_offset=9), lineno=214, col_offset=1, end_lineno=214, end_col_offset=11), Call(func=Name(id='handle_adapter_errors', ctx=Load(), lineno=215, col_offset=1, end_lineno=215, end_col_offset=22), keywords=[keyword(arg='operation', value=Constant(value='search:semantic', lineno=216, col_offset=14, end_lineno=216, end_col_offset=31), lineno=216, col_offset=4, end_lineno=216, end_col_offset=31), keyword(arg='empty_result', value=Dict(keys=[Constant(value='findings', lineno=217, col_offset=18, end_lineno=217, end_col_offset=28), Constant(value='answer', lineno=217, col_offset=34, end_lineno=217, end_col_offset=42), Constant(value='confidence', lineno=217, col_offset=48, end_lineno=217, end_col_offset=60)], values=[List(ctx=Load(), lineno=217, col_offset=30, end_lineno=217, end_col_offset=32), Constant(value='', lineno=217, col_offset=44, end_lineno=217, end_col_offset=46), Constant(value=0.0, lineno=217, col_offset=62, end_lineno=217, end_col_offset=65)], lineno=217, col_offset=17, end_lineno=217, end_col_offset=66), lineno=217, col_offset=4, end_lineno=217, end_col_offset=66)], lineno=215, col_offset=1, end_lineno=218, end_col_offset=1)], returns=Name(id='AnswerEnvelope', ctx=Load(), lineno=222, col_offset=5, end_lineno=222, end_col_offset=19), lineno=219, col_offset=0, end_lineno=242, end_col_offset=72), AsyncFunctionDef(name='semantic_search_pro', args=arguments(args=[arg(arg='query', annotation=Name(id='str', ctx=Load(), lineno=251, col_offset=11, end_lineno=251, end_col_offset=14), lineno=251, col_offset=4, end_lineno=251, end_col_offset=14), arg(arg='limit', annotation=Name(id='int', ctx=Load(), lineno=252, col_offset=11, end_lineno=252, end_col_offset=14), lineno=252, col_offset=4, end_lineno=252, end_col_offset=14)], kwonlyargs=[arg(arg='options', annotation=BinOp(left=Attribute(value=Name(id='semantic_pro_adapter', ctx=Load(), lineno=254, col_offset=13, end_lineno=254, end_col_offset=33), attr='SemanticProOptions', ctx=Load(), lineno=254, col_offset=13, end_lineno=254, end_col_offset=52), op=BitOr(), right=Constant(value=None, lineno=254, col_offset=55, end_lineno=254, end_col_offset=59), lineno=254, col_offset=13, end_lineno=254, end_col_offset=59), lineno=254, col_offset=4, end_lineno=254, end_col_offset=59)], kw_defaults=[Constant(value=None, lineno=254, col_offset=62, end_lineno=254, end_col_offset=66)], defaults=[Constant(value=20, lineno=252, col_offset=17, end_lineno=252, end_col_offset=19)]), body=[Expr(value=Constant(value='Two-stage semantic retrieval with optional late interaction and reranker.\n\n    Parameters\n    ----------\n    query : str\n        Natural language or code query text.\n    limit : int, optional\n        Maximum number of hydrated findings to return (default 20).\n    options : semantic_pro_adapter.SemanticProOptions | None, optional\n        Optional runtime options for stage toggles and fusion weights. Controls\n        which retrieval stages are enabled and their configuration parameters.\n\n    Returns\n    -------\n    AnswerEnvelope\n        Structured response with findings and method metadata.\n    ', lineno=256, col_offset=4, end_lineno=272, end_col_offset=7), lineno=256, col_offset=4, end_lineno=272, end_col_offset=7), Assign(targets=[Name(id='context', ctx=Store(), lineno=273, col_offset=4, end_lineno=273, end_col_offset=11)], value=Call(func=Name(id='get_context', ctx=Load(), lineno=273, col_offset=14, end_lineno=273, end_col_offset=25), lineno=273, col_offset=14, end_lineno=273, end_col_offset=27), lineno=273, col_offset=4, end_lineno=273, end_col_offset=27), Return(value=Await(value=Call(func=Attribute(value=Name(id='semantic_pro_adapter', ctx=Load(), lineno=274, col_offset=17, end_lineno=274, end_col_offset=37), attr='semantic_search_pro', ctx=Load(), lineno=274, col_offset=17, end_lineno=274, end_col_offset=57), args=[Name(id='context', ctx=Load(), lineno=275, col_offset=8, end_lineno=275, end_col_offset=15)], keywords=[keyword(arg='query', value=Name(id='query', ctx=Load(), lineno=276, col_offset=14, end_lineno=276, end_col_offset=19), lineno=276, col_offset=8, end_lineno=276, end_col_offset=19), keyword(arg='limit', value=Name(id='limit', ctx=Load(), lineno=277, col_offset=14, end_lineno=277, end_col_offset=19), lineno=277, col_offset=8, end_lineno=277, end_col_offset=19), keyword(arg='options', value=Name(id='options', ctx=Load(), lineno=278, col_offset=16, end_lineno=278, end_col_offset=23), lineno=278, col_offset=8, end_lineno=278, end_col_offset=23)], lineno=274, col_offset=17, end_lineno=279, end_col_offset=5), lineno=274, col_offset=11, end_lineno=279, end_col_offset=5), lineno=274, col_offset=4, end_lineno=279, end_col_offset=5)], decorator_list=[Call(func=Attribute(value=Name(id='mcp', ctx=Load(), lineno=245, col_offset=1, end_lineno=245, end_col_offset=4), attr='tool', ctx=Load(), lineno=245, col_offset=1, end_lineno=245, end_col_offset=9), lineno=245, col_offset=1, end_lineno=245, end_col_offset=11), Call(func=Name(id='handle_adapter_errors', ctx=Load(), lineno=246, col_offset=1, end_lineno=246, end_col_offset=22), keywords=[keyword(arg='operation', value=Constant(value='search:semantic_pro', lineno=247, col_offset=14, end_lineno=247, end_col_offset=35), lineno=247, col_offset=4, end_lineno=247, end_col_offset=35), keyword(arg='empty_result', value=Dict(keys=[Constant(value='findings', lineno=248, col_offset=18, end_lineno=248, end_col_offset=28), Constant(value='answer', lineno=248, col_offset=34, end_lineno=248, end_col_offset=42), Constant(value='confidence', lineno=248, col_offset=48, end_lineno=248, end_col_offset=60)], values=[List(ctx=Load(), lineno=248, col_offset=30, end_lineno=248, end_col_offset=32), Constant(value='', lineno=248, col_offset=44, end_lineno=248, end_col_offset=46), Constant(value=0.0, lineno=248, col_offset=62, end_lineno=248, end_col_offset=65)], lineno=248, col_offset=17, end_lineno=248, end_col_offset=66), lineno=248, col_offset=4, end_lineno=248, end_col_offset=66)], lineno=246, col_offset=1, end_lineno=249, end_col_offset=1)], returns=Name(id='AnswerEnvelope', ctx=Load(), lineno=255, col_offset=5, end_lineno=255, end_col_offset=19), lineno=250, col_offset=0, end_lineno=279, end_col_offset=5), FunctionDef(name='symbol_search', args=arguments(args=[arg(arg='query', annotation=Name(id='str', ctx=Load(), lineno=291, col_offset=11, end_lineno=291, end_col_offset=14), lineno=291, col_offset=4, end_lineno=291, end_col_offset=14), arg(arg='kind', annotation=BinOp(left=Name(id='str', ctx=Load(), lineno=292, col_offset=10, end_lineno=292, end_col_offset=13), op=BitOr(), right=Constant(value=None, lineno=292, col_offset=16, end_lineno=292, end_col_offset=20), lineno=292, col_offset=10, end_lineno=292, end_col_offset=20), lineno=292, col_offset=4, end_lineno=292, end_col_offset=20), arg(arg='language', annotation=BinOp(left=Name(id='str', ctx=Load(), lineno=293, col_offset=14, end_lineno=293, end_col_offset=17), op=BitOr(), right=Constant(value=None, lineno=293, col_offset=20, end_lineno=293, end_col_offset=24), lineno=293, col_offset=14, end_lineno=293, end_col_offset=24), lineno=293, col_offset=4, end_lineno=293, end_col_offset=24)], defaults=[Constant(value=None, lineno=292, col_offset=23, end_lineno=292, end_col_offset=27), Constant(value=None, lineno=293, col_offset=27, end_lineno=293, end_col_offset=31)]), body=[Expr(value=Constant(value='Search for symbols (functions, classes, etc).\n\n    Parameters\n    ----------\n    query : str\n        Symbol name query.\n    kind : str | None\n        Symbol kind filter (function, class, variable).\n    language : str | None\n        Language filter.\n\n    Returns\n    -------\n    dict\n        Symbol matches.\n    ', lineno=295, col_offset=4, end_lineno=310, end_col_offset=7), lineno=295, col_offset=4, end_lineno=310, end_col_offset=7), Assign(targets=[Name(id='context', ctx=Store(), lineno=311, col_offset=4, end_lineno=311, end_col_offset=11)], value=Call(func=Name(id='get_context', ctx=Load(), lineno=311, col_offset=14, end_lineno=311, end_col_offset=25), lineno=311, col_offset=14, end_lineno=311, end_col_offset=27), lineno=311, col_offset=4, end_lineno=311, end_col_offset=27), With(items=[withitem(context_expr=Call(func=Attribute(value=Name(id='context', ctx=Load(), lineno=312, col_offset=9, end_lineno=312, end_col_offset=16), attr='open_catalog', ctx=Load(), lineno=312, col_offset=9, end_lineno=312, end_col_offset=29), lineno=312, col_offset=9, end_lineno=312, end_col_offset=31), optional_vars=Name(id='catalog', ctx=Store(), lineno=312, col_offset=35, end_lineno=312, end_col_offset=42)), withitem(context_expr=Call(func=Attribute(value=Name(id='catalog', ctx=Load(), lineno=312, col_offset=44, end_lineno=312, end_col_offset=51), attr='connection', ctx=Load(), lineno=312, col_offset=44, end_lineno=312, end_col_offset=62), lineno=312, col_offset=44, end_lineno=312, end_col_offset=64), optional_vars=Name(id='conn', ctx=Store(), lineno=312, col_offset=68, end_lineno=312, end_col_offset=72))], body=[Assign(targets=[Name(id='sql_lines', ctx=Store(), lineno=313, col_offset=8, end_lineno=313, end_col_offset=17)], value=List(elts=[Constant(value='SELECT display_name, kind, language, uri, start_line, start_col, end_line, end_col', lineno=314, col_offset=12, end_lineno=314, end_col_offset=96), Constant(value='FROM symbol_defs WHERE 1=1', lineno=315, col_offset=12, end_lineno=315, end_col_offset=40)], ctx=Load(), lineno=313, col_offset=20, end_lineno=316, end_col_offset=9), lineno=313, col_offset=8, end_lineno=316, end_col_offset=9), AnnAssign(target=Name(id='params', ctx=Store(), lineno=317, col_offset=8, end_lineno=317, end_col_offset=14), annotation=Subscript(value=Name(id='list', ctx=Load(), lineno=317, col_offset=16, end_lineno=317, end_col_offset=20), slice=Name(id='object', ctx=Load(), lineno=317, col_offset=21, end_lineno=317, end_col_offset=27), ctx=Load(), lineno=317, col_offset=16, end_lineno=317, end_col_offset=28), value=List(ctx=Load(), lineno=317, col_offset=31, end_lineno=317, end_col_offset=33), simple=1, lineno=317, col_offset=8, end_lineno=317, end_col_offset=33), If(test=Name(id='query', ctx=Load(), lineno=318, col_offset=11, end_lineno=318, end_col_offset=16), body=[Assign(targets=[Name(id='trimmed', ctx=Store(), lineno=319, col_offset=12, end_lineno=319, end_col_offset=19)], value=Call(func=Attribute(value=Name(id='query', ctx=Load(), lineno=319, col_offset=22, end_lineno=319, end_col_offset=27), attr='strip', ctx=Load(), lineno=319, col_offset=22, end_lineno=319, end_col_offset=33), lineno=319, col_offset=22, end_lineno=319, end_col_offset=35), lineno=319, col_offset=12, end_lineno=319, end_col_offset=35), Expr(value=Call(func=Attribute(value=Name(id='sql_lines', ctx=Load(), lineno=320, col_offset=12, end_lineno=320, end_col_offset=21), attr='append', ctx=Load(), lineno=320, col_offset=12, end_lineno=320, end_col_offset=28), args=[Constant(value='AND LOWER(display_name) LIKE LOWER(?)', lineno=320, col_offset=29, end_lineno=320, end_col_offset=68)], lineno=320, col_offset=12, end_lineno=320, end_col_offset=69), lineno=320, col_offset=12, end_lineno=320, end_col_offset=69), Expr(value=Call(func=Attribute(value=Name(id='params', ctx=Load(), lineno=321, col_offset=12, end_lineno=321, end_col_offset=18), attr='append', ctx=Load(), lineno=321, col_offset=12, end_lineno=321, end_col_offset=25), args=[JoinedStr(values=[FormattedValue(value=Name(id='trimmed', ctx=Load(), lineno=321, col_offset=29, end_lineno=321, end_col_offset=36), conversion=-1, lineno=321, col_offset=28, end_lineno=321, end_col_offset=37), Constant(value='%', lineno=321, col_offset=37, end_lineno=321, end_col_offset=38)], lineno=321, col_offset=26, end_lineno=321, end_col_offset=39)], lineno=321, col_offset=12, end_lineno=321, end_col_offset=40), lineno=321, col_offset=12, end_lineno=321, end_col_offset=40)], lineno=318, col_offset=8, end_lineno=321, end_col_offset=40), If(test=Name(id='kind', ctx=Load(), lineno=322, col_offset=11, end_lineno=322, end_col_offset=15), body=[Expr(value=Call(func=Attribute(value=Name(id='sql_lines', ctx=Load(), lineno=323, col_offset=12, end_lineno=323, end_col_offset=21), attr='append', ctx=Load(), lineno=323, col_offset=12, end_lineno=323, end_col_offset=28), args=[Constant(value='AND kind = ?', lineno=323, col_offset=29, end_lineno=323, end_col_offset=43)], lineno=323, col_offset=12, end_lineno=323, end_col_offset=44), lineno=323, col_offset=12, end_lineno=323, end_col_offset=44), Expr(value=Call(func=Attribute(value=Name(id='params', ctx=Load(), lineno=324, col_offset=12, end_lineno=324, end_col_offset=18), attr='append', ctx=Load(), lineno=324, col_offset=12, end_lineno=324, end_col_offset=25), args=[Name(id='kind', ctx=Load(), lineno=324, col_offset=26, end_lineno=324, end_col_offset=30)], lineno=324, col_offset=12, end_lineno=324, end_col_offset=31), lineno=324, col_offset=12, end_lineno=324, end_col_offset=31)], lineno=322, col_offset=8, end_lineno=324, end_col_offset=31), If(test=Name(id='language', ctx=Load(), lineno=325, col_offset=11, end_lineno=325, end_col_offset=19), body=[Expr(value=Call(func=Attribute(value=Name(id='sql_lines', ctx=Load(), lineno=326, col_offset=12, end_lineno=326, end_col_offset=21), attr='append', ctx=Load(), lineno=326, col_offset=12, end_lineno=326, end_col_offset=28), args=[Constant(value='AND language = ?', lineno=326, col_offset=29, end_lineno=326, end_col_offset=47)], lineno=326, col_offset=12, end_lineno=326, end_col_offset=48), lineno=326, col_offset=12, end_lineno=326, end_col_offset=48), Expr(value=Call(func=Attribute(value=Name(id='params', ctx=Load(), lineno=327, col_offset=12, end_lineno=327, end_col_offset=18), attr='append', ctx=Load(), lineno=327, col_offset=12, end_lineno=327, end_col_offset=25), args=[Name(id='language', ctx=Load(), lineno=327, col_offset=26, end_lineno=327, end_col_offset=34)], lineno=327, col_offset=12, end_lineno=327, end_col_offset=35), lineno=327, col_offset=12, end_lineno=327, end_col_offset=35)], lineno=325, col_offset=8, end_lineno=327, end_col_offset=35), Expr(value=Call(func=Attribute(value=Name(id='sql_lines', ctx=Load(), lineno=328, col_offset=8, end_lineno=328, end_col_offset=17), attr='append', ctx=Load(), lineno=328, col_offset=8, end_lineno=328, end_col_offset=24), args=[Constant(value='ORDER BY LENGTH(display_name), kind, uri LIMIT 200', lineno=328, col_offset=25, end_lineno=328, end_col_offset=77)], lineno=328, col_offset=8, end_lineno=328, end_col_offset=78), lineno=328, col_offset=8, end_lineno=328, end_col_offset=78), Assign(targets=[Name(id='relation', ctx=Store(), lineno=330, col_offset=8, end_lineno=330, end_col_offset=16)], value=Call(func=Attribute(value=Name(id='conn', ctx=Load(), lineno=330, col_offset=19, end_lineno=330, end_col_offset=23), attr='execute', ctx=Load(), lineno=330, col_offset=19, end_lineno=330, end_col_offset=31), args=[Call(func=Attribute(value=Constant(value='\n', lineno=330, col_offset=32, end_lineno=330, end_col_offset=36), attr='join', ctx=Load(), lineno=330, col_offset=32, end_lineno=330, end_col_offset=41), args=[Name(id='sql_lines', ctx=Load(), lineno=330, col_offset=42, end_lineno=330, end_col_offset=51)], lineno=330, col_offset=32, end_lineno=330, end_col_offset=52), Name(id='params', ctx=Load(), lineno=330, col_offset=54, end_lineno=330, end_col_offset=60)], lineno=330, col_offset=19, end_lineno=330, end_col_offset=61), lineno=330, col_offset=8, end_lineno=330, end_col_offset=61), Assign(targets=[Name(id='rows', ctx=Store(), lineno=331, col_offset=8, end_lineno=331, end_col_offset=12)], value=Call(func=Attribute(value=Name(id='relation', ctx=Load(), lineno=331, col_offset=15, end_lineno=331, end_col_offset=23), attr='fetchall', ctx=Load(), lineno=331, col_offset=15, end_lineno=331, end_col_offset=32), lineno=331, col_offset=15, end_lineno=331, end_col_offset=34), lineno=331, col_offset=8, end_lineno=331, end_col_offset=34)], lineno=312, col_offset=4, end_lineno=331, end_col_offset=34), AnnAssign(target=Name(id='items', ctx=Store(), lineno=333, col_offset=4, end_lineno=333, end_col_offset=9), annotation=Subscript(value=Name(id='list', ctx=Load(), lineno=333, col_offset=11, end_lineno=333, end_col_offset=15), slice=Name(id='SymbolInfo', ctx=Load(), lineno=333, col_offset=16, end_lineno=333, end_col_offset=26), ctx=Load(), lineno=333, col_offset=11, end_lineno=333, end_col_offset=27), value=List(ctx=Load(), lineno=333, col_offset=30, end_lineno=333, end_col_offset=32), simple=1, lineno=333, col_offset=4, end_lineno=333, end_col_offset=32), For(target=Tuple(elts=[Name(id='name', ctx=Store(), lineno=334, col_offset=8, end_lineno=334, end_col_offset=12), Name(id='k', ctx=Store(), lineno=334, col_offset=14, end_lineno=334, end_col_offset=15), Name(id='_lang', ctx=Store(), lineno=334, col_offset=17, end_lineno=334, end_col_offset=22), Name(id='uri', ctx=Store(), lineno=334, col_offset=24, end_lineno=334, end_col_offset=27), Name(id='sl', ctx=Store(), lineno=334, col_offset=29, end_lineno=334, end_col_offset=31), Name(id='sc', ctx=Store(), lineno=334, col_offset=33, end_lineno=334, end_col_offset=35), Name(id='el', ctx=Store(), lineno=334, col_offset=37, end_lineno=334, end_col_offset=39), Name(id='ec', ctx=Store(), lineno=334, col_offset=41, end_lineno=334, end_col_offset=43)], ctx=Store(), lineno=334, col_offset=8, end_lineno=334, end_col_offset=43), iter=Name(id='rows', ctx=Load(), lineno=334, col_offset=47, end_lineno=334, end_col_offset=51), body=[Expr(value=Call(func=Attribute(value=Name(id='items', ctx=Load(), lineno=335, col_offset=8, end_lineno=335, end_col_offset=13), attr='append', ctx=Load(), lineno=335, col_offset=8, end_lineno=335, end_col_offset=20), args=[Dict(keys=[Constant(value='name', lineno=337, col_offset=16, end_lineno=337, end_col_offset=22), Constant(value='kind', lineno=338, col_offset=16, end_lineno=338, end_col_offset=22), Constant(value='location', lineno=339, col_offset=16, end_lineno=339, end_col_offset=26)], values=[Name(id='name', ctx=Load(), lineno=337, col_offset=24, end_lineno=337, end_col_offset=28), BoolOp(op=Or(), values=[Name(id='k', ctx=Load(), lineno=338, col_offset=24, end_lineno=338, end_col_offset=25), Constant(value='symbol', lineno=338, col_offset=29, end_lineno=338, end_col_offset=37)], lineno=338, col_offset=24, end_lineno=338, end_col_offset=37), Dict(keys=[Constant(value='uri', lineno=340, col_offset=20, end_lineno=340, end_col_offset=25), Constant(value='start_line', lineno=341, col_offset=20, end_lineno=341, end_col_offset=32), Constant(value='start_column', lineno=342, col_offset=20, end_lineno=342, end_col_offset=34), Constant(value='end_line', lineno=343, col_offset=20, end_lineno=343, end_col_offset=30), Constant(value='end_column', lineno=344, col_offset=20, end_lineno=344, end_col_offset=32)], values=[Name(id='uri', ctx=Load(), lineno=340, col_offset=27, end_lineno=340, end_col_offset=30), Name(id='sl', ctx=Load(), lineno=341, col_offset=34, end_lineno=341, end_col_offset=36), Name(id='sc', ctx=Load(), lineno=342, col_offset=36, end_lineno=342, end_col_offset=38), Name(id='el', ctx=Load(), lineno=343, col_offset=32, end_lineno=343, end_col_offset=34), Name(id='ec', ctx=Load(), lineno=344, col_offset=34, end_lineno=344, end_col_offset=36)], lineno=339, col_offset=28, end_lineno=345, end_col_offset=17)], lineno=336, col_offset=12, end_lineno=346, end_col_offset=13)], lineno=335, col_offset=8, end_lineno=347, end_col_offset=9), lineno=335, col_offset=8, end_lineno=347, end_col_offset=9)], lineno=334, col_offset=4, end_lineno=347, end_col_offset=9), Return(value=Dict(keys=[Constant(value='symbols', lineno=348, col_offset=12, end_lineno=348, end_col_offset=21), Constant(value='total', lineno=348, col_offset=30, end_lineno=348, end_col_offset=37)], values=[Name(id='items', ctx=Load(), lineno=348, col_offset=23, end_lineno=348, end_col_offset=28), Call(func=Name(id='len', ctx=Load(), lineno=348, col_offset=39, end_lineno=348, end_col_offset=42), args=[Name(id='items', ctx=Load(), lineno=348, col_offset=43, end_lineno=348, end_col_offset=48)], lineno=348, col_offset=39, end_lineno=348, end_col_offset=49)], lineno=348, col_offset=11, end_lineno=348, end_col_offset=50), lineno=348, col_offset=4, end_lineno=348, end_col_offset=50)], decorator_list=[Call(func=Attribute(value=Name(id='mcp', ctx=Load(), lineno=285, col_offset=1, end_lineno=285, end_col_offset=4), attr='tool', ctx=Load(), lineno=285, col_offset=1, end_lineno=285, end_col_offset=9), lineno=285, col_offset=1, end_lineno=285, end_col_offset=11), Call(func=Name(id='handle_adapter_errors', ctx=Load(), lineno=286, col_offset=1, end_lineno=286, end_col_offset=22), keywords=[keyword(arg='operation', value=Constant(value='symbols:search', lineno=287, col_offset=14, end_lineno=287, end_col_offset=30), lineno=287, col_offset=4, end_lineno=287, end_col_offset=30), keyword(arg='empty_result', value=Dict(keys=[Constant(value='symbols', lineno=288, col_offset=18, end_lineno=288, end_col_offset=27), Constant(value='total', lineno=288, col_offset=33, end_lineno=288, end_col_offset=40)], values=[List(ctx=Load(), lineno=288, col_offset=29, end_lineno=288, end_col_offset=31), Constant(value=0, lineno=288, col_offset=42, end_lineno=288, end_col_offset=43)], lineno=288, col_offset=17, end_lineno=288, end_col_offset=44), lineno=288, col_offset=4, end_lineno=288, end_col_offset=44)], lineno=286, col_offset=1, end_lineno=289, end_col_offset=1)], returns=Name(id='dict', ctx=Load(), lineno=294, col_offset=5, end_lineno=294, end_col_offset=9), lineno=290, col_offset=0, end_lineno=348, end_col_offset=50), FunctionDef(name='definition_at', args=arguments(args=[arg(arg='path', annotation=Name(id='str', ctx=Load(), lineno=357, col_offset=10, end_lineno=357, end_col_offset=13), lineno=357, col_offset=4, end_lineno=357, end_col_offset=13), arg(arg='line', annotation=Name(id='int', ctx=Load(), lineno=358, col_offset=10, end_lineno=358, end_col_offset=13), lineno=358, col_offset=4, end_lineno=358, end_col_offset=13), arg(arg='character', annotation=Name(id='int', ctx=Load(), lineno=359, col_offset=15, end_lineno=359, end_col_offset=18), lineno=359, col_offset=4, end_lineno=359, end_col_offset=18)]), body=[Expr(value=Constant(value='Find definition at position.\n\n    Parameters\n    ----------\n    path : str\n        File path.\n    line : int\n        Line number (1-indexed).\n    character : int\n        Character offset (0-indexed).\n\n    Returns\n    -------\n    dict\n        Definition locations.\n    ', lineno=361, col_offset=4, end_lineno=376, end_col_offset=7), lineno=361, col_offset=4, end_lineno=376, end_col_offset=7), Assign(targets=[Name(id='context', ctx=Store(), lineno=377, col_offset=4, end_lineno=377, end_col_offset=11)], value=Call(func=Name(id='get_context', ctx=Load(), lineno=377, col_offset=14, end_lineno=377, end_col_offset=25), lineno=377, col_offset=14, end_lineno=377, end_col_offset=27), lineno=377, col_offset=4, end_lineno=377, end_col_offset=27), With(items=[withitem(context_expr=Call(func=Attribute(value=Name(id='context', ctx=Load(), lineno=378, col_offset=9, end_lineno=378, end_col_offset=16), attr='open_catalog', ctx=Load(), lineno=378, col_offset=9, end_lineno=378, end_col_offset=29), lineno=378, col_offset=9, end_lineno=378, end_col_offset=31), optional_vars=Name(id='catalog', ctx=Store(), lineno=378, col_offset=35, end_lineno=378, end_col_offset=42)), withitem(context_expr=Call(func=Attribute(value=Name(id='catalog', ctx=Load(), lineno=378, col_offset=44, end_lineno=378, end_col_offset=51), attr='connection', ctx=Load(), lineno=378, col_offset=44, end_lineno=378, end_col_offset=62), lineno=378, col_offset=44, end_lineno=378, end_col_offset=64), optional_vars=Name(id='conn', ctx=Store(), lineno=378, col_offset=68, end_lineno=378, end_col_offset=72))], body=[Assign(targets=[Name(id='occ', ctx=Store(), lineno=379, col_offset=8, end_lineno=379, end_col_offset=11)], value=Call(func=Attribute(value=Call(func=Attribute(value=Name(id='conn', ctx=Load(), lineno=379, col_offset=14, end_lineno=379, end_col_offset=18), attr='execute', ctx=Load(), lineno=379, col_offset=14, end_lineno=379, end_col_offset=26), args=[Constant(value='\n                SELECT symbol FROM symbol_occurrences\n                WHERE uri = ?\n                  AND (start_line < ? OR (start_line = ? AND start_col <= ?))\n                  AND (end_line   > ? OR (end_line   = ? AND end_col   >= ?))\n                ORDER BY (end_line - start_line) ASC, (end_col - start_col) ASC\n                LIMIT 1\n                ', lineno=380, col_offset=12, end_lineno=387, end_col_offset=19), List(elts=[Name(id='path', ctx=Load(), lineno=388, col_offset=13, end_lineno=388, end_col_offset=17), BinOp(left=Name(id='line', ctx=Load(), lineno=388, col_offset=19, end_lineno=388, end_col_offset=23), op=Sub(), right=Constant(value=1, lineno=388, col_offset=26, end_lineno=388, end_col_offset=27), lineno=388, col_offset=19, end_lineno=388, end_col_offset=27), BinOp(left=Name(id='line', ctx=Load(), lineno=388, col_offset=29, end_lineno=388, end_col_offset=33), op=Sub(), right=Constant(value=1, lineno=388, col_offset=36, end_lineno=388, end_col_offset=37), lineno=388, col_offset=29, end_lineno=388, end_col_offset=37), Name(id='character', ctx=Load(), lineno=388, col_offset=39, end_lineno=388, end_col_offset=48), BinOp(left=Name(id='line', ctx=Load(), lineno=388, col_offset=50, end_lineno=388, end_col_offset=54), op=Sub(), right=Constant(value=1, lineno=388, col_offset=57, end_lineno=388, end_col_offset=58), lineno=388, col_offset=50, end_lineno=388, end_col_offset=58), BinOp(left=Name(id='line', ctx=Load(), lineno=388, col_offset=60, end_lineno=388, end_col_offset=64), op=Sub(), right=Constant(value=1, lineno=388, col_offset=67, end_lineno=388, end_col_offset=68), lineno=388, col_offset=60, end_lineno=388, end_col_offset=68), Name(id='character', ctx=Load(), lineno=388, col_offset=70, end_lineno=388, end_col_offset=79)], ctx=Load(), lineno=388, col_offset=12, end_lineno=388, end_col_offset=80)], lineno=379, col_offset=14, end_lineno=389, end_col_offset=9), attr='fetchone', ctx=Load(), lineno=379, col_offset=14, end_lineno=389, end_col_offset=18), lineno=379, col_offset=14, end_lineno=389, end_col_offset=20), lineno=379, col_offset=8, end_lineno=389, end_col_offset=20), If(test=UnaryOp(op=Not(), operand=Name(id='occ', ctx=Load(), lineno=390, col_offset=15, end_lineno=390, end_col_offset=18), lineno=390, col_offset=11, end_lineno=390, end_col_offset=18), body=[Return(value=Dict(keys=[Constant(value='locations', lineno=391, col_offset=20, end_lineno=391, end_col_offset=31)], values=[List(ctx=Load(), lineno=391, col_offset=33, end_lineno=391, end_col_offset=35)], lineno=391, col_offset=19, end_lineno=391, end_col_offset=36), lineno=391, col_offset=12, end_lineno=391, end_col_offset=36)], lineno=390, col_offset=8, end_lineno=391, end_col_offset=36), Assign(targets=[Name(id='sym', ctx=Store(), lineno=392, col_offset=8, end_lineno=392, end_col_offset=11)], value=Subscript(value=Name(id='occ', ctx=Load(), lineno=392, col_offset=14, end_lineno=392, end_col_offset=17), slice=Constant(value=0, lineno=392, col_offset=18, end_lineno=392, end_col_offset=19), ctx=Load(), lineno=392, col_offset=14, end_lineno=392, end_col_offset=20), lineno=392, col_offset=8, end_lineno=392, end_col_offset=20), Assign(targets=[Name(id='row', ctx=Store(), lineno=393, col_offset=8, end_lineno=393, end_col_offset=11)], value=Call(func=Attribute(value=Call(func=Attribute(value=Name(id='conn', ctx=Load(), lineno=393, col_offset=14, end_lineno=393, end_col_offset=18), attr='execute', ctx=Load(), lineno=393, col_offset=14, end_lineno=393, end_col_offset=26), args=[Constant(value='\n                SELECT uri, start_line, start_col, end_line, end_col\n                FROM symbol_defs WHERE symbol = ? LIMIT 1\n                ', lineno=394, col_offset=12, end_lineno=397, end_col_offset=19), List(elts=[Name(id='sym', ctx=Load(), lineno=398, col_offset=13, end_lineno=398, end_col_offset=16)], ctx=Load(), lineno=398, col_offset=12, end_lineno=398, end_col_offset=17)], lineno=393, col_offset=14, end_lineno=399, end_col_offset=9), attr='fetchone', ctx=Load(), lineno=393, col_offset=14, end_lineno=399, end_col_offset=18), lineno=393, col_offset=14, end_lineno=399, end_col_offset=20), lineno=393, col_offset=8, end_lineno=399, end_col_offset=20)], lineno=378, col_offset=4, end_lineno=399, end_col_offset=20), If(test=UnaryOp(op=Not(), operand=Name(id='row', ctx=Load(), lineno=400, col_offset=11, end_lineno=400, end_col_offset=14), lineno=400, col_offset=7, end_lineno=400, end_col_offset=14), body=[Return(value=Dict(keys=[Constant(value='locations', lineno=401, col_offset=16, end_lineno=401, end_col_offset=27)], values=[List(ctx=Load(), lineno=401, col_offset=29, end_lineno=401, end_col_offset=31)], lineno=401, col_offset=15, end_lineno=401, end_col_offset=32), lineno=401, col_offset=8, end_lineno=401, end_col_offset=32)], lineno=400, col_offset=4, end_lineno=401, end_col_offset=32), Assign(targets=[Tuple(elts=[Name(id='uri', ctx=Store(), lineno=402, col_offset=4, end_lineno=402, end_col_offset=7), Name(id='sl', ctx=Store(), lineno=402, col_offset=9, end_lineno=402, end_col_offset=11), Name(id='sc', ctx=Store(), lineno=402, col_offset=13, end_lineno=402, end_col_offset=15), Name(id='el', ctx=Store(), lineno=402, col_offset=17, end_lineno=402, end_col_offset=19), Name(id='ec', ctx=Store(), lineno=402, col_offset=21, end_lineno=402, end_col_offset=23)], ctx=Store(), lineno=402, col_offset=4, end_lineno=402, end_col_offset=23)], value=Name(id='row', ctx=Load(), lineno=402, col_offset=26, end_lineno=402, end_col_offset=29), lineno=402, col_offset=4, end_lineno=402, end_col_offset=29), Return(value=Dict(keys=[Constant(value='locations', lineno=404, col_offset=8, end_lineno=404, end_col_offset=19)], values=[List(elts=[Dict(keys=[Constant(value='uri', lineno=406, col_offset=16, end_lineno=406, end_col_offset=21), Constant(value='start_line', lineno=407, col_offset=16, end_lineno=407, end_col_offset=28), Constant(value='start_column', lineno=408, col_offset=16, end_lineno=408, end_col_offset=30), Constant(value='end_line', lineno=409, col_offset=16, end_lineno=409, end_col_offset=26), Constant(value='end_column', lineno=410, col_offset=16, end_lineno=410, end_col_offset=28)], values=[Name(id='uri', ctx=Load(), lineno=406, col_offset=23, end_lineno=406, end_col_offset=26), Name(id='sl', ctx=Load(), lineno=407, col_offset=30, end_lineno=407, end_col_offset=32), Name(id='sc', ctx=Load(), lineno=408, col_offset=32, end_lineno=408, end_col_offset=34), Name(id='el', ctx=Load(), lineno=409, col_offset=28, end_lineno=409, end_col_offset=30), Name(id='ec', ctx=Load(), lineno=410, col_offset=30, end_lineno=410, end_col_offset=32)], lineno=405, col_offset=12, end_lineno=411, end_col_offset=13)], ctx=Load(), lineno=404, col_offset=21, end_lineno=412, end_col_offset=9)], lineno=403, col_offset=11, end_lineno=413, end_col_offset=5), lineno=403, col_offset=4, end_lineno=413, end_col_offset=5)], decorator_list=[Call(func=Attribute(value=Name(id='mcp', ctx=Load(), lineno=351, col_offset=1, end_lineno=351, end_col_offset=4), attr='tool', ctx=Load(), lineno=351, col_offset=1, end_lineno=351, end_col_offset=9), lineno=351, col_offset=1, end_lineno=351, end_col_offset=11), Call(func=Name(id='handle_adapter_errors', ctx=Load(), lineno=352, col_offset=1, end_lineno=352, end_col_offset=22), keywords=[keyword(arg='operation', value=Constant(value='symbols:definition_at', lineno=353, col_offset=14, end_lineno=353, end_col_offset=37), lineno=353, col_offset=4, end_lineno=353, end_col_offset=37), keyword(arg='empty_result', value=Dict(keys=[Constant(value='locations', lineno=354, col_offset=18, end_lineno=354, end_col_offset=29)], values=[List(ctx=Load(), lineno=354, col_offset=31, end_lineno=354, end_col_offset=33)], lineno=354, col_offset=17, end_lineno=354, end_col_offset=34), lineno=354, col_offset=4, end_lineno=354, end_col_offset=34)], lineno=352, col_offset=1, end_lineno=355, end_col_offset=1)], returns=Name(id='dict', ctx=Load(), lineno=360, col_offset=5, end_lineno=360, end_col_offset=9), lineno=356, col_offset=0, end_lineno=413, end_col_offset=5), FunctionDef(name='references_at', args=arguments(args=[arg(arg='path', annotation=Name(id='str', ctx=Load(), lineno=422, col_offset=10, end_lineno=422, end_col_offset=13), lineno=422, col_offset=4, end_lineno=422, end_col_offset=13), arg(arg='line', annotation=Name(id='int', ctx=Load(), lineno=423, col_offset=10, end_lineno=423, end_col_offset=13), lineno=423, col_offset=4, end_lineno=423, end_col_offset=13), arg(arg='character', annotation=Name(id='int', ctx=Load(), lineno=424, col_offset=15, end_lineno=424, end_col_offset=18), lineno=424, col_offset=4, end_lineno=424, end_col_offset=18)]), body=[Expr(value=Constant(value='Find references at position.\n\n    Parameters\n    ----------\n    path : str\n        File path.\n    line : int\n        Line number (1-indexed).\n    character : int\n        Character offset (0-indexed).\n\n    Returns\n    -------\n    dict\n        Reference locations.\n    ', lineno=426, col_offset=4, end_lineno=441, end_col_offset=7), lineno=426, col_offset=4, end_lineno=441, end_col_offset=7), Assign(targets=[Name(id='context', ctx=Store(), lineno=442, col_offset=4, end_lineno=442, end_col_offset=11)], value=Call(func=Name(id='get_context', ctx=Load(), lineno=442, col_offset=14, end_lineno=442, end_col_offset=25), lineno=442, col_offset=14, end_lineno=442, end_col_offset=27), lineno=442, col_offset=4, end_lineno=442, end_col_offset=27), With(items=[withitem(context_expr=Call(func=Attribute(value=Name(id='context', ctx=Load(), lineno=443, col_offset=9, end_lineno=443, end_col_offset=16), attr='open_catalog', ctx=Load(), lineno=443, col_offset=9, end_lineno=443, end_col_offset=29), lineno=443, col_offset=9, end_lineno=443, end_col_offset=31), optional_vars=Name(id='catalog', ctx=Store(), lineno=443, col_offset=35, end_lineno=443, end_col_offset=42)), withitem(context_expr=Call(func=Attribute(value=Name(id='catalog', ctx=Load(), lineno=443, col_offset=44, end_lineno=443, end_col_offset=51), attr='connection', ctx=Load(), lineno=443, col_offset=44, end_lineno=443, end_col_offset=62), lineno=443, col_offset=44, end_lineno=443, end_col_offset=64), optional_vars=Name(id='conn', ctx=Store(), lineno=443, col_offset=68, end_lineno=443, end_col_offset=72))], body=[Assign(targets=[Name(id='occ', ctx=Store(), lineno=444, col_offset=8, end_lineno=444, end_col_offset=11)], value=Call(func=Attribute(value=Call(func=Attribute(value=Name(id='conn', ctx=Load(), lineno=444, col_offset=14, end_lineno=444, end_col_offset=18), attr='execute', ctx=Load(), lineno=444, col_offset=14, end_lineno=444, end_col_offset=26), args=[Constant(value='\n                SELECT symbol FROM symbol_occurrences\n                WHERE uri = ?\n                  AND (start_line < ? OR (start_line = ? AND start_col <= ?))\n                  AND (end_line   > ? OR (end_line   = ? AND end_col   >= ?))\n                ORDER BY (end_line - start_line) ASC, (end_col - start_col) ASC\n                LIMIT 1\n                ', lineno=445, col_offset=12, end_lineno=452, end_col_offset=19), List(elts=[Name(id='path', ctx=Load(), lineno=453, col_offset=13, end_lineno=453, end_col_offset=17), BinOp(left=Name(id='line', ctx=Load(), lineno=453, col_offset=19, end_lineno=453, end_col_offset=23), op=Sub(), right=Constant(value=1, lineno=453, col_offset=26, end_lineno=453, end_col_offset=27), lineno=453, col_offset=19, end_lineno=453, end_col_offset=27), BinOp(left=Name(id='line', ctx=Load(), lineno=453, col_offset=29, end_lineno=453, end_col_offset=33), op=Sub(), right=Constant(value=1, lineno=453, col_offset=36, end_lineno=453, end_col_offset=37), lineno=453, col_offset=29, end_lineno=453, end_col_offset=37), Name(id='character', ctx=Load(), lineno=453, col_offset=39, end_lineno=453, end_col_offset=48), BinOp(left=Name(id='line', ctx=Load(), lineno=453, col_offset=50, end_lineno=453, end_col_offset=54), op=Sub(), right=Constant(value=1, lineno=453, col_offset=57, end_lineno=453, end_col_offset=58), lineno=453, col_offset=50, end_lineno=453, end_col_offset=58), BinOp(left=Name(id='line', ctx=Load(), lineno=453, col_offset=60, end_lineno=453, end_col_offset=64), op=Sub(), right=Constant(value=1, lineno=453, col_offset=67, end_lineno=453, end_col_offset=68), lineno=453, col_offset=60, end_lineno=453, end_col_offset=68), Name(id='character', ctx=Load(), lineno=453, col_offset=70, end_lineno=453, end_col_offset=79)], ctx=Load(), lineno=453, col_offset=12, end_lineno=453, end_col_offset=80)], lineno=444, col_offset=14, end_lineno=454, end_col_offset=9), attr='fetchone', ctx=Load(), lineno=444, col_offset=14, end_lineno=454, end_col_offset=18), lineno=444, col_offset=14, end_lineno=454, end_col_offset=20), lineno=444, col_offset=8, end_lineno=454, end_col_offset=20), If(test=UnaryOp(op=Not(), operand=Name(id='occ', ctx=Load(), lineno=455, col_offset=15, end_lineno=455, end_col_offset=18), lineno=455, col_offset=11, end_lineno=455, end_col_offset=18), body=[Return(value=Dict(keys=[Constant(value='locations', lineno=456, col_offset=20, end_lineno=456, end_col_offset=31)], values=[List(ctx=Load(), lineno=456, col_offset=33, end_lineno=456, end_col_offset=35)], lineno=456, col_offset=19, end_lineno=456, end_col_offset=36), lineno=456, col_offset=12, end_lineno=456, end_col_offset=36)], lineno=455, col_offset=8, end_lineno=456, end_col_offset=36), Assign(targets=[Name(id='sym', ctx=Store(), lineno=457, col_offset=8, end_lineno=457, end_col_offset=11)], value=Subscript(value=Name(id='occ', ctx=Load(), lineno=457, col_offset=14, end_lineno=457, end_col_offset=17), slice=Constant(value=0, lineno=457, col_offset=18, end_lineno=457, end_col_offset=19), ctx=Load(), lineno=457, col_offset=14, end_lineno=457, end_col_offset=20), lineno=457, col_offset=8, end_lineno=457, end_col_offset=20), Assign(targets=[Name(id='rows', ctx=Store(), lineno=458, col_offset=8, end_lineno=458, end_col_offset=12)], value=Call(func=Attribute(value=Call(func=Attribute(value=Name(id='conn', ctx=Load(), lineno=458, col_offset=15, end_lineno=458, end_col_offset=19), attr='execute', ctx=Load(), lineno=458, col_offset=15, end_lineno=458, end_col_offset=27), args=[Constant(value='\n                SELECT uri, start_line, start_col, end_line, end_col, roles\n                FROM symbol_occurrences WHERE symbol = ?\n                ', lineno=459, col_offset=12, end_lineno=462, end_col_offset=19), List(elts=[Name(id='sym', ctx=Load(), lineno=463, col_offset=13, end_lineno=463, end_col_offset=16)], ctx=Load(), lineno=463, col_offset=12, end_lineno=463, end_col_offset=17)], lineno=458, col_offset=15, end_lineno=464, end_col_offset=9), attr='fetchall', ctx=Load(), lineno=458, col_offset=15, end_lineno=464, end_col_offset=18), lineno=458, col_offset=15, end_lineno=464, end_col_offset=20), lineno=458, col_offset=8, end_lineno=464, end_col_offset=20)], lineno=443, col_offset=4, end_lineno=464, end_col_offset=20), AnnAssign(target=Name(id='locs', ctx=Store(), lineno=465, col_offset=4, end_lineno=465, end_col_offset=8), annotation=Subscript(value=Name(id='list', ctx=Load(), lineno=465, col_offset=10, end_lineno=465, end_col_offset=14), slice=Name(id='Location', ctx=Load(), lineno=465, col_offset=15, end_lineno=465, end_col_offset=23), ctx=Load(), lineno=465, col_offset=10, end_lineno=465, end_col_offset=24), value=List(ctx=Load(), lineno=465, col_offset=27, end_lineno=465, end_col_offset=29), simple=1, lineno=465, col_offset=4, end_lineno=465, end_col_offset=29), For(target=Tuple(elts=[Name(id='uri', ctx=Store(), lineno=466, col_offset=8, end_lineno=466, end_col_offset=11), Name(id='sl', ctx=Store(), lineno=466, col_offset=13, end_lineno=466, end_col_offset=15), Name(id='sc', ctx=Store(), lineno=466, col_offset=17, end_lineno=466, end_col_offset=19), Name(id='el', ctx=Store(), lineno=466, col_offset=21, end_lineno=466, end_col_offset=23), Name(id='ec', ctx=Store(), lineno=466, col_offset=25, end_lineno=466, end_col_offset=27), Name(id='roles', ctx=Store(), lineno=466, col_offset=29, end_lineno=466, end_col_offset=34)], ctx=Store(), lineno=466, col_offset=8, end_lineno=466, end_col_offset=34), iter=Name(id='rows', ctx=Load(), lineno=466, col_offset=38, end_lineno=466, end_col_offset=42), body=[If(test=BinOp(left=Call(func=Name(id='int', ctx=Load(), lineno=467, col_offset=11, end_lineno=467, end_col_offset=14), args=[Name(id='roles', ctx=Load(), lineno=467, col_offset=15, end_lineno=467, end_col_offset=20)], lineno=467, col_offset=11, end_lineno=467, end_col_offset=21), op=BitAnd(), right=Constant(value=1, lineno=467, col_offset=24, end_lineno=467, end_col_offset=25), lineno=467, col_offset=11, end_lineno=467, end_col_offset=25), body=[Continue(lineno=468, col_offset=12, end_lineno=468, end_col_offset=20)], lineno=467, col_offset=8, end_lineno=468, end_col_offset=20), Expr(value=Call(func=Attribute(value=Name(id='locs', ctx=Load(), lineno=469, col_offset=8, end_lineno=469, end_col_offset=12), attr='append', ctx=Load(), lineno=469, col_offset=8, end_lineno=469, end_col_offset=19), args=[Dict(keys=[Constant(value='uri', lineno=471, col_offset=16, end_lineno=471, end_col_offset=21), Constant(value='start_line', lineno=472, col_offset=16, end_lineno=472, end_col_offset=28), Constant(value='start_column', lineno=473, col_offset=16, end_lineno=473, end_col_offset=30), Constant(value='end_line', lineno=474, col_offset=16, end_lineno=474, end_col_offset=26), Constant(value='end_column', lineno=475, col_offset=16, end_lineno=475, end_col_offset=28)], values=[Name(id='uri', ctx=Load(), lineno=471, col_offset=23, end_lineno=471, end_col_offset=26), Name(id='sl', ctx=Load(), lineno=472, col_offset=30, end_lineno=472, end_col_offset=32), Name(id='sc', ctx=Load(), lineno=473, col_offset=32, end_lineno=473, end_col_offset=34), Name(id='el', ctx=Load(), lineno=474, col_offset=28, end_lineno=474, end_col_offset=30), Name(id='ec', ctx=Load(), lineno=475, col_offset=30, end_lineno=475, end_col_offset=32)], lineno=470, col_offset=12, end_lineno=476, end_col_offset=13)], lineno=469, col_offset=8, end_lineno=477, end_col_offset=9), lineno=469, col_offset=8, end_lineno=477, end_col_offset=9)], lineno=466, col_offset=4, end_lineno=477, end_col_offset=9), Return(value=Dict(keys=[Constant(value='locations', lineno=478, col_offset=12, end_lineno=478, end_col_offset=23)], values=[Name(id='locs', ctx=Load(), lineno=478, col_offset=25, end_lineno=478, end_col_offset=29)], lineno=478, col_offset=11, end_lineno=478, end_col_offset=30), lineno=478, col_offset=4, end_lineno=478, end_col_offset=30)], decorator_list=[Call(func=Attribute(value=Name(id='mcp', ctx=Load(), lineno=416, col_offset=1, end_lineno=416, end_col_offset=4), attr='tool', ctx=Load(), lineno=416, col_offset=1, end_lineno=416, end_col_offset=9), lineno=416, col_offset=1, end_lineno=416, end_col_offset=11), Call(func=Name(id='handle_adapter_errors', ctx=Load(), lineno=417, col_offset=1, end_lineno=417, end_col_offset=22), keywords=[keyword(arg='operation', value=Constant(value='symbols:references_at', lineno=418, col_offset=14, end_lineno=418, end_col_offset=37), lineno=418, col_offset=4, end_lineno=418, end_col_offset=37), keyword(arg='empty_result', value=Dict(keys=[Constant(value='locations', lineno=419, col_offset=18, end_lineno=419, end_col_offset=29)], values=[List(ctx=Load(), lineno=419, col_offset=31, end_lineno=419, end_col_offset=33)], lineno=419, col_offset=17, end_lineno=419, end_col_offset=34), lineno=419, col_offset=4, end_lineno=419, end_col_offset=34)], lineno=417, col_offset=1, end_lineno=420, end_col_offset=1)], returns=Name(id='dict', ctx=Load(), lineno=425, col_offset=5, end_lineno=425, end_col_offset=9), lineno=421, col_offset=0, end_lineno=478, end_col_offset=30), AsyncFunctionDef(name='blame_range', args=arguments(args=[arg(arg='path', annotation=Name(id='str', ctx=Load(), lineno=490, col_offset=10, end_lineno=490, end_col_offset=13), lineno=490, col_offset=4, end_lineno=490, end_col_offset=13), arg(arg='start_line', annotation=Name(id='int', ctx=Load(), lineno=491, col_offset=16, end_lineno=491, end_col_offset=19), lineno=491, col_offset=4, end_lineno=491, end_col_offset=19), arg(arg='end_line', annotation=Name(id='int', ctx=Load(), lineno=492, col_offset=14, end_lineno=492, end_col_offset=17), lineno=492, col_offset=4, end_lineno=492, end_col_offset=17)]), body=[Expr(value=Constant(value='Git blame for line range (async).\n\n    Error handling is automatic via decorator. All exceptions are caught\n    and converted to unified error envelopes with Problem Details.\n\n    Parameters\n    ----------\n    path : str\n        File path.\n    start_line : int\n        Start line (1-indexed).\n    end_line : int\n        End line (1-indexed).\n\n    Returns\n    -------\n    dict\n        Blame entries for each line. On error, returns error envelope with\n        empty result fields and Problem Details.\n    ', lineno=494, col_offset=4, end_lineno=513, end_col_offset=7), lineno=494, col_offset=4, end_lineno=513, end_col_offset=7), Assign(targets=[Name(id='context', ctx=Store(), lineno=514, col_offset=4, end_lineno=514, end_col_offset=11)], value=Call(func=Name(id='get_context', ctx=Load(), lineno=514, col_offset=14, end_lineno=514, end_col_offset=25), lineno=514, col_offset=14, end_lineno=514, end_col_offset=27), lineno=514, col_offset=4, end_lineno=514, end_col_offset=27), Return(value=Await(value=Call(func=Attribute(value=Name(id='history_adapter', ctx=Load(), lineno=515, col_offset=17, end_lineno=515, end_col_offset=32), attr='blame_range', ctx=Load(), lineno=515, col_offset=17, end_lineno=515, end_col_offset=44), args=[Name(id='context', ctx=Load(), lineno=515, col_offset=45, end_lineno=515, end_col_offset=52), Name(id='path', ctx=Load(), lineno=515, col_offset=54, end_lineno=515, end_col_offset=58), Name(id='start_line', ctx=Load(), lineno=515, col_offset=60, end_lineno=515, end_col_offset=70), Name(id='end_line', ctx=Load(), lineno=515, col_offset=72, end_lineno=515, end_col_offset=80)], lineno=515, col_offset=17, end_lineno=515, end_col_offset=81), lineno=515, col_offset=11, end_lineno=515, end_col_offset=81), lineno=515, col_offset=4, end_lineno=515, end_col_offset=81)], decorator_list=[Call(func=Attribute(value=Name(id='mcp', ctx=Load(), lineno=484, col_offset=1, end_lineno=484, end_col_offset=4), attr='tool', ctx=Load(), lineno=484, col_offset=1, end_lineno=484, end_col_offset=9), lineno=484, col_offset=1, end_lineno=484, end_col_offset=11), Call(func=Name(id='handle_adapter_errors', ctx=Load(), lineno=485, col_offset=1, end_lineno=485, end_col_offset=22), keywords=[keyword(arg='operation', value=Constant(value='git:blame_range', lineno=486, col_offset=14, end_lineno=486, end_col_offset=31), lineno=486, col_offset=4, end_lineno=486, end_col_offset=31), keyword(arg='empty_result', value=Dict(keys=[Constant(value='blame', lineno=487, col_offset=18, end_lineno=487, end_col_offset=25)], values=[List(ctx=Load(), lineno=487, col_offset=27, end_lineno=487, end_col_offset=29)], lineno=487, col_offset=17, end_lineno=487, end_col_offset=30), lineno=487, col_offset=4, end_lineno=487, end_col_offset=30)], lineno=485, col_offset=1, end_lineno=488, end_col_offset=1)], returns=Name(id='dict', ctx=Load(), lineno=493, col_offset=5, end_lineno=493, end_col_offset=9), lineno=489, col_offset=0, end_lineno=515, end_col_offset=81), AsyncFunctionDef(name='file_history', args=arguments(args=[arg(arg='path', annotation=Name(id='str', ctx=Load(), lineno=524, col_offset=10, end_lineno=524, end_col_offset=13), lineno=524, col_offset=4, end_lineno=524, end_col_offset=13), arg(arg='limit', annotation=Name(id='int', ctx=Load(), lineno=525, col_offset=11, end_lineno=525, end_col_offset=14), lineno=525, col_offset=4, end_lineno=525, end_col_offset=14)], defaults=[Constant(value=50, lineno=525, col_offset=17, end_lineno=525, end_col_offset=19)]), body=[Expr(value=Constant(value='Get file commit history (async).\n\n    Error handling is automatic via decorator. All exceptions are caught\n    and converted to unified error envelopes with Problem Details.\n\n    Parameters\n    ----------\n    path : str\n        File path.\n    limit : int\n        Maximum commits.\n\n    Returns\n    -------\n    dict\n        Commit history. On error, returns error envelope with empty result\n        fields and Problem Details.\n    ', lineno=527, col_offset=4, end_lineno=544, end_col_offset=7), lineno=527, col_offset=4, end_lineno=544, end_col_offset=7), Assign(targets=[Name(id='context', ctx=Store(), lineno=545, col_offset=4, end_lineno=545, end_col_offset=11)], value=Call(func=Name(id='get_context', ctx=Load(), lineno=545, col_offset=14, end_lineno=545, end_col_offset=25), lineno=545, col_offset=14, end_lineno=545, end_col_offset=27), lineno=545, col_offset=4, end_lineno=545, end_col_offset=27), Return(value=Await(value=Call(func=Attribute(value=Name(id='history_adapter', ctx=Load(), lineno=546, col_offset=17, end_lineno=546, end_col_offset=32), attr='file_history', ctx=Load(), lineno=546, col_offset=17, end_lineno=546, end_col_offset=45), args=[Name(id='context', ctx=Load(), lineno=546, col_offset=46, end_lineno=546, end_col_offset=53), Name(id='path', ctx=Load(), lineno=546, col_offset=55, end_lineno=546, end_col_offset=59), Name(id='limit', ctx=Load(), lineno=546, col_offset=61, end_lineno=546, end_col_offset=66)], lineno=546, col_offset=17, end_lineno=546, end_col_offset=67), lineno=546, col_offset=11, end_lineno=546, end_col_offset=67), lineno=546, col_offset=4, end_lineno=546, end_col_offset=67)], decorator_list=[Call(func=Attribute(value=Name(id='mcp', ctx=Load(), lineno=518, col_offset=1, end_lineno=518, end_col_offset=4), attr='tool', ctx=Load(), lineno=518, col_offset=1, end_lineno=518, end_col_offset=9), lineno=518, col_offset=1, end_lineno=518, end_col_offset=11), Call(func=Name(id='handle_adapter_errors', ctx=Load(), lineno=519, col_offset=1, end_lineno=519, end_col_offset=22), keywords=[keyword(arg='operation', value=Constant(value='git:file_history', lineno=520, col_offset=14, end_lineno=520, end_col_offset=32), lineno=520, col_offset=4, end_lineno=520, end_col_offset=32), keyword(arg='empty_result', value=Dict(keys=[Constant(value='commits', lineno=521, col_offset=18, end_lineno=521, end_col_offset=27)], values=[List(ctx=Load(), lineno=521, col_offset=29, end_lineno=521, end_col_offset=31)], lineno=521, col_offset=17, end_lineno=521, end_col_offset=32), lineno=521, col_offset=4, end_lineno=521, end_col_offset=32)], lineno=519, col_offset=1, end_lineno=522, end_col_offset=1)], returns=Name(id='dict', ctx=Load(), lineno=526, col_offset=5, end_lineno=526, end_col_offset=9), lineno=523, col_offset=0, end_lineno=546, end_col_offset=67), FunctionDef(name='file_resource', args=arguments(args=[arg(arg='path', annotation=Name(id='str', ctx=Load(), lineno=553, col_offset=24, end_lineno=553, end_col_offset=27), lineno=553, col_offset=18, end_lineno=553, end_col_offset=27)]), body=[Expr(value=Constant(value='Serve file content as resource.\n\n    Parameters\n    ----------\n    path : str\n        File path.\n\n    Returns\n    -------\n    str\n        File content.\n    ', lineno=554, col_offset=4, end_lineno=565, end_col_offset=7), lineno=554, col_offset=4, end_lineno=565, end_col_offset=7), Assign(targets=[Name(id='context', ctx=Store(), lineno=566, col_offset=4, end_lineno=566, end_col_offset=11)], value=Call(func=Name(id='get_context', ctx=Load(), lineno=566, col_offset=14, end_lineno=566, end_col_offset=25), lineno=566, col_offset=14, end_lineno=566, end_col_offset=27), lineno=566, col_offset=4, end_lineno=566, end_col_offset=27), Assign(targets=[Name(id='file_result', ctx=Store(), lineno=567, col_offset=4, end_lineno=567, end_col_offset=15)], value=Call(func=Attribute(value=Name(id='files_adapter', ctx=Load(), lineno=567, col_offset=18, end_lineno=567, end_col_offset=31), attr='open_file', ctx=Load(), lineno=567, col_offset=18, end_lineno=567, end_col_offset=41), args=[Name(id='context', ctx=Load(), lineno=567, col_offset=42, end_lineno=567, end_col_offset=49), Name(id='path', ctx=Load(), lineno=567, col_offset=51, end_lineno=567, end_col_offset=55)], lineno=567, col_offset=18, end_lineno=567, end_col_offset=56), lineno=567, col_offset=4, end_lineno=567, end_col_offset=56), If(test=Compare(left=Constant(value='error', lineno=568, col_offset=7, end_lineno=568, end_col_offset=14), ops=[In()], comparators=[Name(id='file_result', ctx=Load(), lineno=568, col_offset=18, end_lineno=568, end_col_offset=29)], lineno=568, col_offset=7, end_lineno=568, end_col_offset=29), body=[Return(value=JoinedStr(values=[Constant(value='Error reading file ', lineno=569, col_offset=17, end_lineno=569, end_col_offset=36), FormattedValue(value=Name(id='path', ctx=Load(), lineno=569, col_offset=37, end_lineno=569, end_col_offset=41), conversion=-1, lineno=569, col_offset=36, end_lineno=569, end_col_offset=42), Constant(value=': ', lineno=569, col_offset=42, end_lineno=569, end_col_offset=44), FormattedValue(value=Subscript(value=Name(id='file_result', ctx=Load(), lineno=569, col_offset=45, end_lineno=569, end_col_offset=56), slice=Constant(value='error', lineno=569, col_offset=57, end_lineno=569, end_col_offset=64), ctx=Load(), lineno=569, col_offset=45, end_lineno=569, end_col_offset=65), conversion=-1, lineno=569, col_offset=44, end_lineno=569, end_col_offset=66)], lineno=569, col_offset=15, end_lineno=569, end_col_offset=67), lineno=569, col_offset=8, end_lineno=569, end_col_offset=67)], lineno=568, col_offset=4, end_lineno=569, end_col_offset=67), Return(value=Call(func=Attribute(value=Name(id='file_result', ctx=Load(), lineno=570, col_offset=11, end_lineno=570, end_col_offset=22), attr='get', ctx=Load(), lineno=570, col_offset=11, end_lineno=570, end_col_offset=26), args=[Constant(value='content', lineno=570, col_offset=27, end_lineno=570, end_col_offset=36), Constant(value='', lineno=570, col_offset=38, end_lineno=570, end_col_offset=40)], lineno=570, col_offset=11, end_lineno=570, end_col_offset=41), lineno=570, col_offset=4, end_lineno=570, end_col_offset=41)], decorator_list=[Call(func=Attribute(value=Name(id='mcp', ctx=Load(), lineno=552, col_offset=1, end_lineno=552, end_col_offset=4), attr='resource', ctx=Load(), lineno=552, col_offset=1, end_lineno=552, end_col_offset=13), args=[Constant(value='file://{path}', lineno=552, col_offset=14, end_lineno=552, end_col_offset=29)], lineno=552, col_offset=1, end_lineno=552, end_col_offset=30)], returns=Name(id='str', ctx=Load(), lineno=553, col_offset=32, end_lineno=553, end_col_offset=35), lineno=553, col_offset=0, end_lineno=570, end_col_offset=41), FunctionDef(name='prompt_code_review', args=arguments(args=[arg(arg='area', annotation=Name(id='str', ctx=Load(), lineno=577, col_offset=29, end_lineno=577, end_col_offset=32), lineno=577, col_offset=23, end_lineno=577, end_col_offset=32)]), body=[Expr(value=Constant(value='Code review prompt template.\n\n    Parameters\n    ----------\n    area : str\n        Code area to review.\n\n    Returns\n    -------\n    str\n        Prompt template.\n    ', lineno=578, col_offset=4, end_lineno=589, end_col_offset=7), lineno=578, col_offset=4, end_lineno=589, end_col_offset=7), Return(value=JoinedStr(values=[Constant(value='Review the code in ', lineno=590, col_offset=13, end_lineno=590, end_col_offset=32), FormattedValue(value=Name(id='area', ctx=Load(), lineno=590, col_offset=33, end_lineno=590, end_col_offset=37), conversion=-1, lineno=590, col_offset=32, end_lineno=590, end_col_offset=38), Constant(value='. Focus on correctness, performance, and style.', lineno=590, col_offset=38, end_lineno=590, end_col_offset=85)], lineno=590, col_offset=11, end_lineno=590, end_col_offset=86), lineno=590, col_offset=4, end_lineno=590, end_col_offset=86)], decorator_list=[Call(func=Attribute(value=Name(id='mcp', ctx=Load(), lineno=576, col_offset=1, end_lineno=576, end_col_offset=4), attr='prompt', ctx=Load(), lineno=576, col_offset=1, end_lineno=576, end_col_offset=11), lineno=576, col_offset=1, end_lineno=576, end_col_offset=13)], returns=Name(id='str', ctx=Load(), lineno=577, col_offset=37, end_lineno=577, end_col_offset=40), lineno=577, col_offset=0, end_lineno=590, end_col_offset=86), Assign(targets=[Name(id='asgi_app', ctx=Store(), lineno=597, col_offset=0, end_lineno=597, end_col_offset=8)], value=Call(func=Attribute(value=Name(id='mcp', ctx=Load(), lineno=597, col_offset=11, end_lineno=597, end_col_offset=14), attr='http_app', ctx=Load(), lineno=597, col_offset=11, end_lineno=597, end_col_offset=23), lineno=597, col_offset=11, end_lineno=597, end_col_offset=25), lineno=597, col_offset=0, end_lineno=597, end_col_offset=25), Assign(targets=[Name(id='__all__', ctx=Store(), lineno=599, col_offset=0, end_lineno=599, end_col_offset=7)], value=List(elts=[Constant(value='asgi_app', lineno=599, col_offset=11, end_lineno=599, end_col_offset=21), Constant(value='mcp', lineno=599, col_offset=23, end_lineno=599, end_col_offset=28)], ctx=Load(), lineno=599, col_offset=10, end_lineno=599, end_col_offset=29), lineno=599, col_offset=0, end_lineno=599, end_col_offset=29)])