Module(body=[Expr(value=Constant(value='FastAPI application with MCP server mount.\n\nProvides health/readiness endpoints, CORS, and streaming support.\n', lineno=1, col_offset=0, end_lineno=4, end_col_offset=3), lineno=1, col_offset=0, end_lineno=4, end_col_offset=3), ImportFrom(module='__future__', names=[alias(name='annotations', lineno=6, col_offset=23, end_lineno=6, end_col_offset=34)], level=0, lineno=6, col_offset=0, end_lineno=6, end_col_offset=34), Import(names=[alias(name='asyncio', lineno=8, col_offset=7, end_lineno=8, end_col_offset=14)], lineno=8, col_offset=0, end_lineno=8, end_col_offset=14), ImportFrom(module='collections.abc', names=[alias(name='AsyncIterator', lineno=9, col_offset=28, end_lineno=9, end_col_offset=41), alias(name='Awaitable', lineno=9, col_offset=43, end_lineno=9, end_col_offset=52), alias(name='Callable', lineno=9, col_offset=54, end_lineno=9, end_col_offset=62)], level=0, lineno=9, col_offset=0, end_lineno=9, end_col_offset=62), ImportFrom(module='contextlib', names=[alias(name='asynccontextmanager', lineno=10, col_offset=23, end_lineno=10, end_col_offset=42)], level=0, lineno=10, col_offset=0, end_lineno=10, end_col_offset=42), ImportFrom(module='fastapi', names=[alias(name='FastAPI', lineno=12, col_offset=20, end_lineno=12, end_col_offset=27), alias(name='Request', lineno=12, col_offset=29, end_lineno=12, end_col_offset=36)], level=0, lineno=12, col_offset=0, end_lineno=12, end_col_offset=36), ImportFrom(module='fastapi.middleware.cors', names=[alias(name='CORSMiddleware', lineno=13, col_offset=36, end_lineno=13, end_col_offset=50)], level=0, lineno=13, col_offset=0, end_lineno=13, end_col_offset=50), ImportFrom(module='fastapi.responses', names=[alias(name='JSONResponse', lineno=14, col_offset=30, end_lineno=14, end_col_offset=42), alias(name='StreamingResponse', lineno=14, col_offset=44, end_lineno=14, end_col_offset=61)], level=0, lineno=14, col_offset=0, end_lineno=14, end_col_offset=61), ImportFrom(module='starlette.responses', names=[alias(name='Response', lineno=15, col_offset=32, end_lineno=15, end_col_offset=40)], level=0, lineno=15, col_offset=0, end_lineno=15, end_col_offset=40), ImportFrom(module='codeintel_rev.app.config_context', names=[alias(name='ApplicationContext', lineno=17, col_offset=45, end_lineno=17, end_col_offset=63)], level=0, lineno=17, col_offset=0, end_lineno=17, end_col_offset=63), ImportFrom(module='codeintel_rev.app.gpu_warmup', names=[alias(name='warmup_gpu', lineno=18, col_offset=41, end_lineno=18, end_col_offset=51)], level=0, lineno=18, col_offset=0, end_lineno=18, end_col_offset=51), ImportFrom(module='codeintel_rev.app.middleware', names=[alias(name='SessionScopeMiddleware', lineno=19, col_offset=41, end_lineno=19, end_col_offset=63)], level=0, lineno=19, col_offset=0, end_lineno=19, end_col_offset=63), ImportFrom(module='codeintel_rev.app.readiness', names=[alias(name='ReadinessProbe', lineno=20, col_offset=40, end_lineno=20, end_col_offset=54)], level=0, lineno=20, col_offset=0, end_lineno=20, end_col_offset=54), ImportFrom(module='codeintel_rev.mcp_server.server', names=[alias(name='app_context', lineno=21, col_offset=44, end_lineno=21, end_col_offset=55)], level=0, lineno=21, col_offset=0, end_lineno=21, end_col_offset=55), ImportFrom(module='codeintel_rev.mcp_server.server', names=[alias(name='asgi_app', asname='mcp_asgi', lineno=22, col_offset=44, end_lineno=22, end_col_offset=64)], level=0, lineno=22, col_offset=0, end_lineno=22, end_col_offset=64), ImportFrom(module='kgfoundry_common.errors', names=[alias(name='ConfigurationError', lineno=23, col_offset=36, end_lineno=23, end_col_offset=54)], level=0, lineno=23, col_offset=0, end_lineno=23, end_col_offset=54), ImportFrom(module='kgfoundry_common.logging', names=[alias(name='get_logger', lineno=24, col_offset=37, end_lineno=24, end_col_offset=47)], level=0, lineno=24, col_offset=0, end_lineno=24, end_col_offset=47), Assign(targets=[Name(id='LOGGER', ctx=Store(), lineno=26, col_offset=0, end_lineno=26, end_col_offset=6)], value=Call(func=Name(id='get_logger', ctx=Load(), lineno=26, col_offset=9, end_lineno=26, end_col_offset=19), args=[Name(id='__name__', ctx=Load(), lineno=26, col_offset=20, end_lineno=26, end_col_offset=28)], lineno=26, col_offset=9, end_lineno=26, end_col_offset=29), lineno=26, col_offset=0, end_lineno=26, end_col_offset=29), FunctionDef(name='_preload_faiss_index', args=arguments(args=[arg(arg='context', annotation=Name(id='ApplicationContext', ctx=Load(), lineno=29, col_offset=34, end_lineno=29, end_col_offset=52), lineno=29, col_offset=25, end_lineno=29, end_col_offset=52)]), body=[Expr(value=Constant(value='Pre-load FAISS index during startup to avoid first-request latency.\n\n    Parameters\n    ----------\n    context : ApplicationContext\n        Application context containing FAISS manager.\n\n    Returns\n    -------\n    bool\n        True if index loaded successfully, False otherwise.\n    ', lineno=30, col_offset=4, end_lineno=41, end_col_offset=7), lineno=30, col_offset=4, end_lineno=41, end_col_offset=7), Try(body=[Expr(value=Call(func=Attribute(value=Attribute(value=Name(id='context', ctx=Load(), lineno=43, col_offset=8, end_lineno=43, end_col_offset=15), attr='faiss_manager', ctx=Load(), lineno=43, col_offset=8, end_lineno=43, end_col_offset=29), attr='load_cpu_index', ctx=Load(), lineno=43, col_offset=8, end_lineno=43, end_col_offset=44), lineno=43, col_offset=8, end_lineno=43, end_col_offset=46), lineno=43, col_offset=8, end_lineno=43, end_col_offset=46), Expr(value=Call(func=Attribute(value=Name(id='LOGGER', ctx=Load(), lineno=44, col_offset=8, end_lineno=44, end_col_offset=14), attr='info', ctx=Load(), lineno=44, col_offset=8, end_lineno=44, end_col_offset=19), args=[Constant(value='FAISS CPU index loaded successfully', lineno=44, col_offset=20, end_lineno=44, end_col_offset=57)], lineno=44, col_offset=8, end_lineno=44, end_col_offset=58), lineno=44, col_offset=8, end_lineno=44, end_col_offset=58), Assign(targets=[Name(id='gpu_enabled', ctx=Store(), lineno=47, col_offset=8, end_lineno=47, end_col_offset=19)], value=Call(func=Attribute(value=Attribute(value=Name(id='context', ctx=Load(), lineno=47, col_offset=22, end_lineno=47, end_col_offset=29), attr='faiss_manager', ctx=Load(), lineno=47, col_offset=22, end_lineno=47, end_col_offset=43), attr='clone_to_gpu', ctx=Load(), lineno=47, col_offset=22, end_lineno=47, end_col_offset=56), lineno=47, col_offset=22, end_lineno=47, end_col_offset=58), lineno=47, col_offset=8, end_lineno=47, end_col_offset=58), If(test=Name(id='gpu_enabled', ctx=Load(), lineno=48, col_offset=11, end_lineno=48, end_col_offset=22), body=[Expr(value=Call(func=Attribute(value=Name(id='LOGGER', ctx=Load(), lineno=49, col_offset=12, end_lineno=49, end_col_offset=18), attr='info', ctx=Load(), lineno=49, col_offset=12, end_lineno=49, end_col_offset=23), args=[Constant(value='FAISS GPU acceleration enabled', lineno=49, col_offset=24, end_lineno=49, end_col_offset=56)], lineno=49, col_offset=12, end_lineno=49, end_col_offset=57), lineno=49, col_offset=12, end_lineno=49, end_col_offset=57)], orelse=[Assign(targets=[Name(id='reason', ctx=Store(), lineno=51, col_offset=12, end_lineno=51, end_col_offset=18)], value=BoolOp(op=Or(), values=[Attribute(value=Attribute(value=Name(id='context', ctx=Load(), lineno=51, col_offset=21, end_lineno=51, end_col_offset=28), attr='faiss_manager', ctx=Load(), lineno=51, col_offset=21, end_lineno=51, end_col_offset=42), attr='gpu_disabled_reason', ctx=Load(), lineno=51, col_offset=21, end_lineno=51, end_col_offset=62), Constant(value='Unknown', lineno=51, col_offset=66, end_lineno=51, end_col_offset=75)], lineno=51, col_offset=21, end_lineno=51, end_col_offset=75), lineno=51, col_offset=12, end_lineno=51, end_col_offset=75), Expr(value=Call(func=Attribute(value=Name(id='LOGGER', ctx=Load(), lineno=52, col_offset=12, end_lineno=52, end_col_offset=18), attr='warning', ctx=Load(), lineno=52, col_offset=12, end_lineno=52, end_col_offset=26), args=[Constant(value='FAISS GPU acceleration unavailable: %s', lineno=52, col_offset=27, end_lineno=52, end_col_offset=67), Name(id='reason', ctx=Load(), lineno=52, col_offset=69, end_lineno=52, end_col_offset=75)], lineno=52, col_offset=12, end_lineno=52, end_col_offset=76), lineno=52, col_offset=12, end_lineno=52, end_col_offset=76)], lineno=48, col_offset=8, end_lineno=52, end_col_offset=76)], handlers=[ExceptHandler(type=Tuple(elts=[Name(id='FileNotFoundError', ctx=Load(), lineno=53, col_offset=12, end_lineno=53, end_col_offset=29), Name(id='RuntimeError', ctx=Load(), lineno=53, col_offset=31, end_lineno=53, end_col_offset=43)], ctx=Load(), lineno=53, col_offset=11, end_lineno=53, end_col_offset=44), name='exc', body=[Expr(value=Call(func=Attribute(value=Name(id='LOGGER', ctx=Load(), lineno=54, col_offset=8, end_lineno=54, end_col_offset=14), attr='warning', ctx=Load(), lineno=54, col_offset=8, end_lineno=54, end_col_offset=22), args=[Constant(value='FAISS index pre-load failed: %s', lineno=54, col_offset=23, end_lineno=54, end_col_offset=56), Name(id='exc', ctx=Load(), lineno=54, col_offset=58, end_lineno=54, end_col_offset=61)], lineno=54, col_offset=8, end_lineno=54, end_col_offset=62), lineno=54, col_offset=8, end_lineno=54, end_col_offset=62), Return(value=Constant(value=False, lineno=55, col_offset=15, end_lineno=55, end_col_offset=20), lineno=55, col_offset=8, end_lineno=55, end_col_offset=20)], lineno=53, col_offset=4, end_lineno=55, end_col_offset=20)], orelse=[Return(value=Constant(value=True, lineno=57, col_offset=15, end_lineno=57, end_col_offset=19), lineno=57, col_offset=8, end_lineno=57, end_col_offset=19)], lineno=42, col_offset=4, end_lineno=57, end_col_offset=19)], returns=Name(id='bool', ctx=Load(), lineno=29, col_offset=57, end_lineno=29, end_col_offset=61), lineno=29, col_offset=0, end_lineno=57, end_col_offset=19), AsyncFunctionDef(name='lifespan', args=arguments(args=[arg(arg='app', annotation=Name(id='FastAPI', ctx=Load(), lineno=62, col_offset=9, end_lineno=62, end_col_offset=16), lineno=62, col_offset=4, end_lineno=62, end_col_offset=16)]), body=[Expr(value=Constant(value='Application lifespan manager with explicit configuration initialization.\n\n    This function runs during FastAPI startup and shutdown, managing the\n    configuration lifecycle explicitly rather than relying on lazy loading.\n\n    Parameters\n    ----------\n    app : FastAPI\n        FastAPI application instance. Used to store application context and\n        readiness probe in app.state.\n\n    Yields\n    ------\n    None\n        Control to the FastAPI application after successful initialization.\n\n    Raises\n    ------\n    ConfigurationError\n        If configuration is invalid or required resources are missing.\n        FastAPI will fail to start, preventing broken deployment.\n    Exception\n        If an unexpected error occurs during application startup. The error\n        is logged and re-raised to prevent FastAPI from starting in a broken state.\n\n    Notes\n    -----\n    Startup sequence:\n    1. Load configuration from environment (fail fast if invalid)\n    2. Perform GPU warmup sequence (verify CUDA/torch/FAISS GPU availability)\n    3. Initialize long-lived clients (vLLM, FAISS manager)\n    4. Initialize scope registry for session-scoped query constraints\n    5. Run readiness checks (verify indexes exist, vLLM reachable)\n    6. Optionally pre-load FAISS index (controlled by FAISS_PRELOAD env var)\n    7. Start background pruning task for expired sessions\n\n    Shutdown sequence:\n    1. Cancel background pruning task\n    2. Clear readiness state\n    3. Explicitly close any open resources\n    ', lineno=64, col_offset=4, end_lineno=104, end_col_offset=7), lineno=64, col_offset=4, end_lineno=104, end_col_offset=7), Expr(value=Call(func=Attribute(value=Name(id='LOGGER', ctx=Load(), lineno=105, col_offset=4, end_lineno=105, end_col_offset=10), attr='info', ctx=Load(), lineno=105, col_offset=4, end_lineno=105, end_col_offset=15), args=[Constant(value='Starting application initialization', lineno=105, col_offset=16, end_lineno=105, end_col_offset=53)], lineno=105, col_offset=4, end_lineno=105, end_col_offset=54), lineno=105, col_offset=4, end_lineno=105, end_col_offset=54), Try(body=[Assign(targets=[Name(id='context', ctx=Store(), lineno=109, col_offset=8, end_lineno=109, end_col_offset=15)], value=Call(func=Attribute(value=Name(id='ApplicationContext', ctx=Load(), lineno=109, col_offset=18, end_lineno=109, end_col_offset=36), attr='create', ctx=Load(), lineno=109, col_offset=18, end_lineno=109, end_col_offset=43), lineno=109, col_offset=18, end_lineno=109, end_col_offset=45), lineno=109, col_offset=8, end_lineno=109, end_col_offset=45), Assign(targets=[Attribute(value=Attribute(value=Name(id='app', ctx=Load(), lineno=110, col_offset=8, end_lineno=110, end_col_offset=11), attr='state', ctx=Load(), lineno=110, col_offset=8, end_lineno=110, end_col_offset=17), attr='context', ctx=Store(), lineno=110, col_offset=8, end_lineno=110, end_col_offset=25)], value=Name(id='context', ctx=Load(), lineno=110, col_offset=28, end_lineno=110, end_col_offset=35), lineno=110, col_offset=8, end_lineno=110, end_col_offset=35), Assign(targets=[Name(id='gpu_status', ctx=Store(), lineno=113, col_offset=8, end_lineno=113, end_col_offset=18)], value=Call(func=Name(id='warmup_gpu', ctx=Load(), lineno=113, col_offset=21, end_lineno=113, end_col_offset=31), lineno=113, col_offset=21, end_lineno=113, end_col_offset=33), lineno=113, col_offset=8, end_lineno=113, end_col_offset=33), If(test=Compare(left=Subscript(value=Name(id='gpu_status', ctx=Load(), lineno=114, col_offset=11, end_lineno=114, end_col_offset=21), slice=Constant(value='overall_status', lineno=114, col_offset=22, end_lineno=114, end_col_offset=38), ctx=Load(), lineno=114, col_offset=11, end_lineno=114, end_col_offset=39), ops=[Eq()], comparators=[Constant(value='ready', lineno=114, col_offset=43, end_lineno=114, end_col_offset=50)], lineno=114, col_offset=11, end_lineno=114, end_col_offset=50), body=[Expr(value=Call(func=Attribute(value=Name(id='LOGGER', ctx=Load(), lineno=115, col_offset=12, end_lineno=115, end_col_offset=18), attr='info', ctx=Load(), lineno=115, col_offset=12, end_lineno=115, end_col_offset=23), args=[Constant(value='GPU warmup successful - GPU acceleration available', lineno=115, col_offset=24, end_lineno=115, end_col_offset=76)], lineno=115, col_offset=12, end_lineno=115, end_col_offset=77), lineno=115, col_offset=12, end_lineno=115, end_col_offset=77)], orelse=[If(test=Compare(left=Subscript(value=Name(id='gpu_status', ctx=Load(), lineno=116, col_offset=13, end_lineno=116, end_col_offset=23), slice=Constant(value='overall_status', lineno=116, col_offset=24, end_lineno=116, end_col_offset=40), ctx=Load(), lineno=116, col_offset=13, end_lineno=116, end_col_offset=41), ops=[Eq()], comparators=[Constant(value='degraded', lineno=116, col_offset=45, end_lineno=116, end_col_offset=55)], lineno=116, col_offset=13, end_lineno=116, end_col_offset=55), body=[Expr(value=Call(func=Attribute(value=Name(id='LOGGER', ctx=Load(), lineno=117, col_offset=12, end_lineno=117, end_col_offset=18), attr='warning', ctx=Load(), lineno=117, col_offset=12, end_lineno=117, end_col_offset=26), args=[Constant(value='GPU warmup partial - some GPU features unavailable: %s', lineno=118, col_offset=16, end_lineno=118, end_col_offset=72), Subscript(value=Name(id='gpu_status', ctx=Load(), lineno=119, col_offset=16, end_lineno=119, end_col_offset=26), slice=Constant(value='details', lineno=119, col_offset=27, end_lineno=119, end_col_offset=36), ctx=Load(), lineno=119, col_offset=16, end_lineno=119, end_col_offset=37)], lineno=117, col_offset=12, end_lineno=120, end_col_offset=13), lineno=117, col_offset=12, end_lineno=120, end_col_offset=13)], orelse=[Expr(value=Call(func=Attribute(value=Name(id='LOGGER', ctx=Load(), lineno=122, col_offset=12, end_lineno=122, end_col_offset=18), attr='info', ctx=Load(), lineno=122, col_offset=12, end_lineno=122, end_col_offset=23), args=[Constant(value='GPU warmup indicates GPU unavailable - continuing with CPU-only mode', lineno=122, col_offset=24, end_lineno=122, end_col_offset=94)], lineno=122, col_offset=12, end_lineno=122, end_col_offset=95), lineno=122, col_offset=12, end_lineno=122, end_col_offset=95)], lineno=116, col_offset=8, end_lineno=122, end_col_offset=95)], lineno=114, col_offset=8, end_lineno=122, end_col_offset=95), Assign(targets=[Name(id='readiness', ctx=Store(), lineno=125, col_offset=8, end_lineno=125, end_col_offset=17)], value=Call(func=Name(id='ReadinessProbe', ctx=Load(), lineno=125, col_offset=20, end_lineno=125, end_col_offset=34), args=[Name(id='context', ctx=Load(), lineno=125, col_offset=35, end_lineno=125, end_col_offset=42)], lineno=125, col_offset=20, end_lineno=125, end_col_offset=43), lineno=125, col_offset=8, end_lineno=125, end_col_offset=43), Expr(value=Await(value=Call(func=Attribute(value=Name(id='readiness', ctx=Load(), lineno=126, col_offset=14, end_lineno=126, end_col_offset=23), attr='initialize', ctx=Load(), lineno=126, col_offset=14, end_lineno=126, end_col_offset=34), lineno=126, col_offset=14, end_lineno=126, end_col_offset=36), lineno=126, col_offset=8, end_lineno=126, end_col_offset=36), lineno=126, col_offset=8, end_lineno=126, end_col_offset=36), Assign(targets=[Attribute(value=Attribute(value=Name(id='app', ctx=Load(), lineno=127, col_offset=8, end_lineno=127, end_col_offset=11), attr='state', ctx=Load(), lineno=127, col_offset=8, end_lineno=127, end_col_offset=17), attr='readiness', ctx=Store(), lineno=127, col_offset=8, end_lineno=127, end_col_offset=27)], value=Name(id='readiness', ctx=Load(), lineno=127, col_offset=30, end_lineno=127, end_col_offset=39), lineno=127, col_offset=8, end_lineno=127, end_col_offset=39), If(test=Attribute(value=Attribute(value=Attribute(value=Name(id='context', ctx=Load(), lineno=130, col_offset=11, end_lineno=130, end_col_offset=18), attr='settings', ctx=Load(), lineno=130, col_offset=11, end_lineno=130, end_col_offset=27), attr='index', ctx=Load(), lineno=130, col_offset=11, end_lineno=130, end_col_offset=33), attr='faiss_preload', ctx=Load(), lineno=130, col_offset=11, end_lineno=130, end_col_offset=47), body=[Expr(value=Call(func=Attribute(value=Name(id='LOGGER', ctx=Load(), lineno=131, col_offset=12, end_lineno=131, end_col_offset=18), attr='info', ctx=Load(), lineno=131, col_offset=12, end_lineno=131, end_col_offset=23), args=[Constant(value='Pre-loading FAISS index during startup', lineno=131, col_offset=24, end_lineno=131, end_col_offset=64)], lineno=131, col_offset=12, end_lineno=131, end_col_offset=65), lineno=131, col_offset=12, end_lineno=131, end_col_offset=65), Assign(targets=[Name(id='preload_success', ctx=Store(), lineno=132, col_offset=12, end_lineno=132, end_col_offset=27)], value=Await(value=Call(func=Attribute(value=Name(id='asyncio', ctx=Load(), lineno=132, col_offset=36, end_lineno=132, end_col_offset=43), attr='to_thread', ctx=Load(), lineno=132, col_offset=36, end_lineno=132, end_col_offset=53), args=[Name(id='_preload_faiss_index', ctx=Load(), lineno=132, col_offset=54, end_lineno=132, end_col_offset=74), Name(id='context', ctx=Load(), lineno=132, col_offset=76, end_lineno=132, end_col_offset=83)], lineno=132, col_offset=36, end_lineno=132, end_col_offset=84), lineno=132, col_offset=30, end_lineno=132, end_col_offset=84), lineno=132, col_offset=12, end_lineno=132, end_col_offset=84), If(test=UnaryOp(op=Not(), operand=Name(id='preload_success', ctx=Load(), lineno=133, col_offset=19, end_lineno=133, end_col_offset=34), lineno=133, col_offset=15, end_lineno=133, end_col_offset=34), body=[Expr(value=Call(func=Attribute(value=Name(id='LOGGER', ctx=Load(), lineno=134, col_offset=16, end_lineno=134, end_col_offset=22), attr='warning', ctx=Load(), lineno=134, col_offset=16, end_lineno=134, end_col_offset=30), args=[Constant(value='FAISS index pre-load failed; will lazy-load on first search', lineno=134, col_offset=31, end_lineno=134, end_col_offset=92)], lineno=134, col_offset=16, end_lineno=134, end_col_offset=93), lineno=134, col_offset=16, end_lineno=134, end_col_offset=93)], lineno=133, col_offset=12, end_lineno=134, end_col_offset=93)], lineno=130, col_offset=8, end_lineno=134, end_col_offset=93), Expr(value=Call(func=Attribute(value=Name(id='LOGGER', ctx=Load(), lineno=136, col_offset=8, end_lineno=136, end_col_offset=14), attr='info', ctx=Load(), lineno=136, col_offset=8, end_lineno=136, end_col_offset=19), args=[Constant(value='Application initialization complete', lineno=136, col_offset=20, end_lineno=136, end_col_offset=57)], lineno=136, col_offset=8, end_lineno=136, end_col_offset=58), lineno=136, col_offset=8, end_lineno=136, end_col_offset=58)], handlers=[ExceptHandler(type=Name(id='ConfigurationError', ctx=Load(), lineno=138, col_offset=11, end_lineno=138, end_col_offset=29), name='exc', body=[Expr(value=Call(func=Attribute(value=Name(id='LOGGER', ctx=Load(), lineno=140, col_offset=8, end_lineno=140, end_col_offset=14), attr='exception', ctx=Load(), lineno=140, col_offset=8, end_lineno=140, end_col_offset=24), args=[Constant(value='Application startup failed due to configuration error', lineno=141, col_offset=12, end_lineno=141, end_col_offset=67)], keywords=[keyword(arg='extra', value=Dict(keys=[Constant(value='error_code', lineno=142, col_offset=19, end_lineno=142, end_col_offset=31), Constant(value='context', lineno=142, col_offset=49, end_lineno=142, end_col_offset=58)], values=[Attribute(value=Attribute(value=Name(id='exc', ctx=Load(), lineno=142, col_offset=33, end_lineno=142, end_col_offset=36), attr='code', ctx=Load(), lineno=142, col_offset=33, end_lineno=142, end_col_offset=41), attr='value', ctx=Load(), lineno=142, col_offset=33, end_lineno=142, end_col_offset=47), Attribute(value=Name(id='exc', ctx=Load(), lineno=142, col_offset=60, end_lineno=142, end_col_offset=63), attr='context', ctx=Load(), lineno=142, col_offset=60, end_lineno=142, end_col_offset=71)], lineno=142, col_offset=18, end_lineno=142, end_col_offset=72), lineno=142, col_offset=12, end_lineno=142, end_col_offset=72)], lineno=140, col_offset=8, end_lineno=143, end_col_offset=9), lineno=140, col_offset=8, end_lineno=143, end_col_offset=9), Raise(lineno=144, col_offset=8, end_lineno=144, end_col_offset=13)], lineno=138, col_offset=4, end_lineno=144, end_col_offset=13), ExceptHandler(type=Name(id='Exception', ctx=Load(), lineno=145, col_offset=11, end_lineno=145, end_col_offset=20), body=[Expr(value=Call(func=Attribute(value=Name(id='LOGGER', ctx=Load(), lineno=146, col_offset=8, end_lineno=146, end_col_offset=14), attr='exception', ctx=Load(), lineno=146, col_offset=8, end_lineno=146, end_col_offset=24), args=[Constant(value='Unexpected error during application startup', lineno=146, col_offset=25, end_lineno=146, end_col_offset=70)], lineno=146, col_offset=8, end_lineno=146, end_col_offset=71), lineno=146, col_offset=8, end_lineno=146, end_col_offset=71), Raise(lineno=147, col_offset=8, end_lineno=147, end_col_offset=13)], lineno=145, col_offset=4, end_lineno=147, end_col_offset=13)], lineno=107, col_offset=4, end_lineno=147, end_col_offset=13), Try(body=[Expr(value=Yield(lineno=150, col_offset=8, end_lineno=150, end_col_offset=13), lineno=150, col_offset=8, end_lineno=150, end_col_offset=13)], finalbody=[Expr(value=Call(func=Attribute(value=Name(id='LOGGER', ctx=Load(), lineno=152, col_offset=8, end_lineno=152, end_col_offset=14), attr='info', ctx=Load(), lineno=152, col_offset=8, end_lineno=152, end_col_offset=19), args=[Constant(value='Starting application shutdown', lineno=152, col_offset=20, end_lineno=152, end_col_offset=51)], lineno=152, col_offset=8, end_lineno=152, end_col_offset=52), lineno=152, col_offset=8, end_lineno=152, end_col_offset=52), Expr(value=Call(func=Attribute(value=Attribute(value=Name(id='context', ctx=Load(), lineno=156, col_offset=8, end_lineno=156, end_col_offset=15), attr='vllm_client', ctx=Load(), lineno=156, col_offset=8, end_lineno=156, end_col_offset=27), attr='close', ctx=Load(), lineno=156, col_offset=8, end_lineno=156, end_col_offset=33), lineno=156, col_offset=8, end_lineno=156, end_col_offset=35), lineno=156, col_offset=8, end_lineno=156, end_col_offset=35), Expr(value=Call(func=Attribute(value=Name(id='LOGGER', ctx=Load(), lineno=157, col_offset=8, end_lineno=157, end_col_offset=14), attr='debug', ctx=Load(), lineno=157, col_offset=8, end_lineno=157, end_col_offset=20), args=[Constant(value='VLLMClient HTTP connections closed during shutdown', lineno=157, col_offset=21, end_lineno=157, end_col_offset=73)], lineno=157, col_offset=8, end_lineno=157, end_col_offset=74), lineno=157, col_offset=8, end_lineno=157, end_col_offset=74), Expr(value=Await(value=Call(func=Attribute(value=Attribute(value=Name(id='context', ctx=Load(), lineno=158, col_offset=14, end_lineno=158, end_col_offset=21), attr='scope_store', ctx=Load(), lineno=158, col_offset=14, end_lineno=158, end_col_offset=33), attr='close', ctx=Load(), lineno=158, col_offset=14, end_lineno=158, end_col_offset=39), lineno=158, col_offset=14, end_lineno=158, end_col_offset=41), lineno=158, col_offset=8, end_lineno=158, end_col_offset=41), lineno=158, col_offset=8, end_lineno=158, end_col_offset=41), Expr(value=Await(value=Call(func=Attribute(value=Name(id='readiness', ctx=Load(), lineno=159, col_offset=14, end_lineno=159, end_col_offset=23), attr='shutdown', ctx=Load(), lineno=159, col_offset=14, end_lineno=159, end_col_offset=32), lineno=159, col_offset=14, end_lineno=159, end_col_offset=34), lineno=159, col_offset=8, end_lineno=159, end_col_offset=34), lineno=159, col_offset=8, end_lineno=159, end_col_offset=34), Expr(value=Call(func=Attribute(value=Name(id='LOGGER', ctx=Load(), lineno=160, col_offset=8, end_lineno=160, end_col_offset=14), attr='info', ctx=Load(), lineno=160, col_offset=8, end_lineno=160, end_col_offset=19), args=[Constant(value='Application shutdown complete', lineno=160, col_offset=20, end_lineno=160, end_col_offset=51)], lineno=160, col_offset=8, end_lineno=160, end_col_offset=52), lineno=160, col_offset=8, end_lineno=160, end_col_offset=52)], lineno=149, col_offset=4, end_lineno=160, end_col_offset=52)], decorator_list=[Name(id='asynccontextmanager', ctx=Load(), lineno=60, col_offset=1, end_lineno=60, end_col_offset=20)], returns=Subscript(value=Name(id='AsyncIterator', ctx=Load(), lineno=63, col_offset=5, end_lineno=63, end_col_offset=18), slice=Constant(value=None, lineno=63, col_offset=19, end_lineno=63, end_col_offset=23), ctx=Load(), lineno=63, col_offset=5, end_lineno=63, end_col_offset=24), lineno=61, col_offset=0, end_lineno=160, end_col_offset=52), Assign(targets=[Name(id='app', ctx=Store(), lineno=163, col_offset=0, end_lineno=163, end_col_offset=3)], value=Call(func=Name(id='FastAPI', ctx=Load(), lineno=163, col_offset=6, end_lineno=163, end_col_offset=13), keywords=[keyword(arg='title', value=Constant(value='CodeIntel MCP Gateway', lineno=164, col_offset=10, end_lineno=164, end_col_offset=33), lineno=164, col_offset=4, end_lineno=164, end_col_offset=33), keyword(arg='version', value=Constant(value='0.1.0', lineno=165, col_offset=12, end_lineno=165, end_col_offset=19), lineno=165, col_offset=4, end_lineno=165, end_col_offset=19), keyword(arg='lifespan', value=Name(id='lifespan', ctx=Load(), lineno=166, col_offset=13, end_lineno=166, end_col_offset=21), lineno=166, col_offset=4, end_lineno=166, end_col_offset=21)], lineno=163, col_offset=6, end_lineno=167, end_col_offset=1), lineno=163, col_offset=0, end_lineno=167, end_col_offset=1), Expr(value=Call(func=Attribute(value=Name(id='app', ctx=Load(), lineno=170, col_offset=0, end_lineno=170, end_col_offset=3), attr='add_middleware', ctx=Load(), lineno=170, col_offset=0, end_lineno=170, end_col_offset=18), args=[Name(id='SessionScopeMiddleware', ctx=Load(), lineno=170, col_offset=19, end_lineno=170, end_col_offset=41)], lineno=170, col_offset=0, end_lineno=170, end_col_offset=42), lineno=170, col_offset=0, end_lineno=170, end_col_offset=42), Expr(value=Call(func=Attribute(value=Name(id='app', ctx=Load(), lineno=173, col_offset=0, end_lineno=173, end_col_offset=3), attr='add_middleware', ctx=Load(), lineno=173, col_offset=0, end_lineno=173, end_col_offset=18), args=[Name(id='CORSMiddleware', ctx=Load(), lineno=174, col_offset=4, end_lineno=174, end_col_offset=18)], keywords=[keyword(arg='allow_origins', value=List(elts=[Constant(value='https://chat.openai.com', lineno=176, col_offset=8, end_lineno=176, end_col_offset=33), Constant(value='http://localhost:3000', lineno=177, col_offset=8, end_lineno=177, end_col_offset=31)], ctx=Load(), lineno=175, col_offset=18, end_lineno=178, end_col_offset=5), lineno=175, col_offset=4, end_lineno=178, end_col_offset=5), keyword(arg='allow_credentials', value=Constant(value=True, lineno=179, col_offset=22, end_lineno=179, end_col_offset=26), lineno=179, col_offset=4, end_lineno=179, end_col_offset=26), keyword(arg='allow_methods', value=List(elts=[Constant(value='*', lineno=180, col_offset=19, end_lineno=180, end_col_offset=22)], ctx=Load(), lineno=180, col_offset=18, end_lineno=180, end_col_offset=23), lineno=180, col_offset=4, end_lineno=180, end_col_offset=23), keyword(arg='allow_headers', value=List(elts=[Constant(value='*', lineno=181, col_offset=19, end_lineno=181, end_col_offset=22)], ctx=Load(), lineno=181, col_offset=18, end_lineno=181, end_col_offset=23), lineno=181, col_offset=4, end_lineno=181, end_col_offset=23)], lineno=173, col_offset=0, end_lineno=182, end_col_offset=1), lineno=173, col_offset=0, end_lineno=182, end_col_offset=1), AsyncFunctionDef(name='set_mcp_context', args=arguments(args=[arg(arg='request', annotation=Name(id='Request', ctx=Load(), lineno=187, col_offset=13, end_lineno=187, end_col_offset=20), lineno=187, col_offset=4, end_lineno=187, end_col_offset=20), arg(arg='call_next', annotation=Subscript(value=Name(id='Callable', ctx=Load(), lineno=187, col_offset=33, end_lineno=187, end_col_offset=41), slice=Tuple(elts=[List(elts=[Name(id='Request', ctx=Load(), lineno=187, col_offset=43, end_lineno=187, end_col_offset=50)], ctx=Load(), lineno=187, col_offset=42, end_lineno=187, end_col_offset=51), Subscript(value=Name(id='Awaitable', ctx=Load(), lineno=187, col_offset=53, end_lineno=187, end_col_offset=62), slice=Name(id='Response', ctx=Load(), lineno=187, col_offset=63, end_lineno=187, end_col_offset=71), ctx=Load(), lineno=187, col_offset=53, end_lineno=187, end_col_offset=72)], ctx=Load(), lineno=187, col_offset=42, end_lineno=187, end_col_offset=72), ctx=Load(), lineno=187, col_offset=33, end_lineno=187, end_col_offset=73), lineno=187, col_offset=22, end_lineno=187, end_col_offset=73)]), body=[Expr(value=Constant(value="Set ApplicationContext in context variable for MCP tool handlers.\n\n    This middleware sets the ApplicationContext in a context variable that\n    can be accessed by FastMCP tool handlers. FastMCP doesn't support Request\n    injection directly, so we use contextvars to pass the context.\n\n    Parameters\n    ----------\n    request : Request\n        Incoming HTTP request from FastAPI/Starlette.\n    call_next : Callable[[Request], Awaitable[Response]]\n        Next middleware or route handler in the chain.\n\n    Returns\n    -------\n    Response\n        Response from the next handler.\n    ", lineno=189, col_offset=4, end_lineno=206, end_col_offset=7), lineno=189, col_offset=4, end_lineno=206, end_col_offset=7), AnnAssign(target=Name(id='context', ctx=Store(), lineno=208, col_offset=4, end_lineno=208, end_col_offset=11), annotation=BinOp(left=Name(id='ApplicationContext', ctx=Load(), lineno=208, col_offset=13, end_lineno=208, end_col_offset=31), op=BitOr(), right=Constant(value=None, lineno=208, col_offset=34, end_lineno=208, end_col_offset=38), lineno=208, col_offset=13, end_lineno=208, end_col_offset=38), value=Call(func=Name(id='getattr', ctx=Load(), lineno=208, col_offset=41, end_lineno=208, end_col_offset=48), args=[Attribute(value=Attribute(value=Name(id='request', ctx=Load(), lineno=208, col_offset=49, end_lineno=208, end_col_offset=56), attr='app', ctx=Load(), lineno=208, col_offset=49, end_lineno=208, end_col_offset=60), attr='state', ctx=Load(), lineno=208, col_offset=49, end_lineno=208, end_col_offset=66), Constant(value='context', lineno=208, col_offset=68, end_lineno=208, end_col_offset=77), Constant(value=None, lineno=208, col_offset=79, end_lineno=208, end_col_offset=83)], lineno=208, col_offset=41, end_lineno=208, end_col_offset=84), simple=1, lineno=208, col_offset=4, end_lineno=208, end_col_offset=84), If(test=Compare(left=Name(id='context', ctx=Load(), lineno=209, col_offset=7, end_lineno=209, end_col_offset=14), ops=[IsNot()], comparators=[Constant(value=None, lineno=209, col_offset=22, end_lineno=209, end_col_offset=26)], lineno=209, col_offset=7, end_lineno=209, end_col_offset=26), body=[Expr(value=Call(func=Attribute(value=Name(id='app_context', ctx=Load(), lineno=210, col_offset=8, end_lineno=210, end_col_offset=19), attr='set', ctx=Load(), lineno=210, col_offset=8, end_lineno=210, end_col_offset=23), args=[Name(id='context', ctx=Load(), lineno=210, col_offset=24, end_lineno=210, end_col_offset=31)], lineno=210, col_offset=8, end_lineno=210, end_col_offset=32), lineno=210, col_offset=8, end_lineno=210, end_col_offset=32)], lineno=209, col_offset=4, end_lineno=210, end_col_offset=32), Return(value=Await(value=Call(func=Name(id='call_next', ctx=Load(), lineno=212, col_offset=17, end_lineno=212, end_col_offset=26), args=[Name(id='request', ctx=Load(), lineno=212, col_offset=27, end_lineno=212, end_col_offset=34)], lineno=212, col_offset=17, end_lineno=212, end_col_offset=35), lineno=212, col_offset=11, end_lineno=212, end_col_offset=35), lineno=212, col_offset=4, end_lineno=212, end_col_offset=35)], decorator_list=[Call(func=Attribute(value=Name(id='app', ctx=Load(), lineno=185, col_offset=1, end_lineno=185, end_col_offset=4), attr='middleware', ctx=Load(), lineno=185, col_offset=1, end_lineno=185, end_col_offset=15), args=[Constant(value='http', lineno=185, col_offset=16, end_lineno=185, end_col_offset=22)], lineno=185, col_offset=1, end_lineno=185, end_col_offset=23)], returns=Name(id='Response', ctx=Load(), lineno=188, col_offset=5, end_lineno=188, end_col_offset=13), lineno=186, col_offset=0, end_lineno=212, end_col_offset=35), AsyncFunctionDef(name='disable_nginx_buffering', args=arguments(args=[arg(arg='request', annotation=Name(id='Request', ctx=Load(), lineno=217, col_offset=13, end_lineno=217, end_col_offset=20), lineno=217, col_offset=4, end_lineno=217, end_col_offset=20), arg(arg='call_next', annotation=Subscript(value=Name(id='Callable', ctx=Load(), lineno=217, col_offset=33, end_lineno=217, end_col_offset=41), slice=Tuple(elts=[List(elts=[Name(id='Request', ctx=Load(), lineno=217, col_offset=43, end_lineno=217, end_col_offset=50)], ctx=Load(), lineno=217, col_offset=42, end_lineno=217, end_col_offset=51), Subscript(value=Name(id='Awaitable', ctx=Load(), lineno=217, col_offset=53, end_lineno=217, end_col_offset=62), slice=Name(id='Response', ctx=Load(), lineno=217, col_offset=63, end_lineno=217, end_col_offset=71), ctx=Load(), lineno=217, col_offset=53, end_lineno=217, end_col_offset=72)], ctx=Load(), lineno=217, col_offset=42, end_lineno=217, end_col_offset=72), ctx=Load(), lineno=217, col_offset=33, end_lineno=217, end_col_offset=73), lineno=217, col_offset=22, end_lineno=217, end_col_offset=73)]), body=[Expr(value=Constant(value='Disable NGINX buffering for streaming responses.\n\n    This middleware sets the X-Accel-Buffering header to "no" on all responses,\n    which instructs NGINX to disable buffering and enable streaming. This is\n    critical for Server-Sent Events (SSE) and other streaming protocols where\n    backpressure and real-time delivery are important.\n\n    The middleware runs after the request handler executes, modifying the\n    response headers before it\'s sent to the client. This ensures that NGINX\n    will stream the response directly to the client rather than buffering it\n    in memory, which is essential for long-running streams and prevents memory\n    issues with large responses.\n\n    Parameters\n    ----------\n    request : Request\n        Incoming HTTP request from FastAPI/Starlette.\n    call_next : Callable[[Request], Awaitable[Response]]\n        Next middleware or route handler in the chain. This is an async callable\n        that takes a Request and returns an awaitable Response.\n\n    Returns\n    -------\n    Response\n        Response object with X-Accel-Buffering header set to "no". The response\n        is the same as returned by call_next, but with the streaming header added.\n    ', lineno=219, col_offset=4, end_lineno=245, end_col_offset=7), lineno=219, col_offset=4, end_lineno=245, end_col_offset=7), Assign(targets=[Name(id='response', ctx=Store(), lineno=246, col_offset=4, end_lineno=246, end_col_offset=12)], value=Await(value=Call(func=Name(id='call_next', ctx=Load(), lineno=246, col_offset=21, end_lineno=246, end_col_offset=30), args=[Name(id='request', ctx=Load(), lineno=246, col_offset=31, end_lineno=246, end_col_offset=38)], lineno=246, col_offset=21, end_lineno=246, end_col_offset=39), lineno=246, col_offset=15, end_lineno=246, end_col_offset=39), lineno=246, col_offset=4, end_lineno=246, end_col_offset=39), Expr(value=Call(func=Attribute(value=Attribute(value=Name(id='response', ctx=Load(), lineno=247, col_offset=4, end_lineno=247, end_col_offset=12), attr='headers', ctx=Load(), lineno=247, col_offset=4, end_lineno=247, end_col_offset=20), attr='setdefault', ctx=Load(), lineno=247, col_offset=4, end_lineno=247, end_col_offset=31), args=[Constant(value='X-Accel-Buffering', lineno=247, col_offset=32, end_lineno=247, end_col_offset=51), Constant(value='no', lineno=247, col_offset=53, end_lineno=247, end_col_offset=57)], lineno=247, col_offset=4, end_lineno=247, end_col_offset=58), lineno=247, col_offset=4, end_lineno=247, end_col_offset=58), Return(value=Name(id='response', ctx=Load(), lineno=248, col_offset=11, end_lineno=248, end_col_offset=19), lineno=248, col_offset=4, end_lineno=248, end_col_offset=19)], decorator_list=[Call(func=Attribute(value=Name(id='app', ctx=Load(), lineno=215, col_offset=1, end_lineno=215, end_col_offset=4), attr='middleware', ctx=Load(), lineno=215, col_offset=1, end_lineno=215, end_col_offset=15), args=[Constant(value='http', lineno=215, col_offset=16, end_lineno=215, end_col_offset=22)], lineno=215, col_offset=1, end_lineno=215, end_col_offset=23)], returns=Name(id='Response', ctx=Load(), lineno=218, col_offset=5, end_lineno=218, end_col_offset=13), lineno=216, col_offset=0, end_lineno=248, end_col_offset=19), AsyncFunctionDef(name='healthz', args=arguments(), body=[Expr(value=Constant(value='Health check endpoint (network-only).\n\n    Returns\n    -------\n    JSONResponse\n        Health status.\n    ', lineno=253, col_offset=4, end_lineno=259, end_col_offset=7), lineno=253, col_offset=4, end_lineno=259, end_col_offset=7), Return(value=Call(func=Name(id='JSONResponse', ctx=Load(), lineno=260, col_offset=11, end_lineno=260, end_col_offset=23), args=[Dict(keys=[Constant(value='status', lineno=260, col_offset=25, end_lineno=260, end_col_offset=33)], values=[Constant(value='ok', lineno=260, col_offset=35, end_lineno=260, end_col_offset=39)], lineno=260, col_offset=24, end_lineno=260, end_col_offset=40)], lineno=260, col_offset=11, end_lineno=260, end_col_offset=41), lineno=260, col_offset=4, end_lineno=260, end_col_offset=41)], decorator_list=[Call(func=Attribute(value=Name(id='app', ctx=Load(), lineno=251, col_offset=1, end_lineno=251, end_col_offset=4), attr='get', ctx=Load(), lineno=251, col_offset=1, end_lineno=251, end_col_offset=8), args=[Constant(value='/healthz', lineno=251, col_offset=9, end_lineno=251, end_col_offset=19)], lineno=251, col_offset=1, end_lineno=251, end_col_offset=20)], returns=Name(id='JSONResponse', ctx=Load(), lineno=252, col_offset=23, end_lineno=252, end_col_offset=35), lineno=252, col_offset=0, end_lineno=260, end_col_offset=41), AsyncFunctionDef(name='readyz', args=arguments(args=[arg(arg='request', annotation=Name(id='Request', ctx=Load(), lineno=264, col_offset=26, end_lineno=264, end_col_offset=33), lineno=264, col_offset=17, end_lineno=264, end_col_offset=33)]), body=[Expr(value=Constant(value='Readiness check endpoint.\n\n    Verifies that dependent services are available. This endpoint always returns\n    HTTP 200, but the payload indicates whether all resources are healthy. Kubernetes\n    readiness probes should check the "ready" field in the response.\n\n    Parameters\n    ----------\n    request : Request\n        FastAPI request object.\n\n    Returns\n    -------\n    JSONResponse\n        Readiness status with detailed check results.\n    ', lineno=265, col_offset=4, end_lineno=280, end_col_offset=7), lineno=265, col_offset=4, end_lineno=280, end_col_offset=7), AnnAssign(target=Name(id='readiness', ctx=Store(), lineno=281, col_offset=4, end_lineno=281, end_col_offset=13), annotation=Name(id='ReadinessProbe', ctx=Load(), lineno=281, col_offset=15, end_lineno=281, end_col_offset=29), value=Attribute(value=Attribute(value=Attribute(value=Name(id='request', ctx=Load(), lineno=281, col_offset=32, end_lineno=281, end_col_offset=39), attr='app', ctx=Load(), lineno=281, col_offset=32, end_lineno=281, end_col_offset=43), attr='state', ctx=Load(), lineno=281, col_offset=32, end_lineno=281, end_col_offset=49), attr='readiness', ctx=Load(), lineno=281, col_offset=32, end_lineno=281, end_col_offset=59), simple=1, lineno=281, col_offset=4, end_lineno=281, end_col_offset=59), Assign(targets=[Name(id='results', ctx=Store(), lineno=282, col_offset=4, end_lineno=282, end_col_offset=11)], value=Await(value=Call(func=Attribute(value=Name(id='readiness', ctx=Load(), lineno=282, col_offset=20, end_lineno=282, end_col_offset=29), attr='refresh', ctx=Load(), lineno=282, col_offset=20, end_lineno=282, end_col_offset=37), lineno=282, col_offset=20, end_lineno=282, end_col_offset=39), lineno=282, col_offset=14, end_lineno=282, end_col_offset=39), lineno=282, col_offset=4, end_lineno=282, end_col_offset=39), Assign(targets=[Name(id='payload', ctx=Store(), lineno=283, col_offset=4, end_lineno=283, end_col_offset=11)], value=DictComp(key=Name(id='name', ctx=Load(), lineno=283, col_offset=15, end_lineno=283, end_col_offset=19), value=Call(func=Attribute(value=Name(id='result', ctx=Load(), lineno=283, col_offset=21, end_lineno=283, end_col_offset=27), attr='as_payload', ctx=Load(), lineno=283, col_offset=21, end_lineno=283, end_col_offset=38), lineno=283, col_offset=21, end_lineno=283, end_col_offset=40), generators=[comprehension(target=Tuple(elts=[Name(id='name', ctx=Store(), lineno=283, col_offset=45, end_lineno=283, end_col_offset=49), Name(id='result', ctx=Store(), lineno=283, col_offset=51, end_lineno=283, end_col_offset=57)], ctx=Store(), lineno=283, col_offset=45, end_lineno=283, end_col_offset=57), iter=Call(func=Attribute(value=Name(id='results', ctx=Load(), lineno=283, col_offset=61, end_lineno=283, end_col_offset=68), attr='items', ctx=Load(), lineno=283, col_offset=61, end_lineno=283, end_col_offset=74), lineno=283, col_offset=61, end_lineno=283, end_col_offset=76), is_async=0)], lineno=283, col_offset=14, end_lineno=283, end_col_offset=77), lineno=283, col_offset=4, end_lineno=283, end_col_offset=77), Assign(targets=[Name(id='overall_ready', ctx=Store(), lineno=284, col_offset=4, end_lineno=284, end_col_offset=17)], value=Call(func=Name(id='all', ctx=Load(), lineno=284, col_offset=20, end_lineno=284, end_col_offset=23), args=[GeneratorExp(elt=Attribute(value=Name(id='result', ctx=Load(), lineno=284, col_offset=24, end_lineno=284, end_col_offset=30), attr='healthy', ctx=Load(), lineno=284, col_offset=24, end_lineno=284, end_col_offset=38), generators=[comprehension(target=Name(id='result', ctx=Store(), lineno=284, col_offset=43, end_lineno=284, end_col_offset=49), iter=Call(func=Attribute(value=Name(id='results', ctx=Load(), lineno=284, col_offset=53, end_lineno=284, end_col_offset=60), attr='values', ctx=Load(), lineno=284, col_offset=53, end_lineno=284, end_col_offset=67), lineno=284, col_offset=53, end_lineno=284, end_col_offset=69), is_async=0)], lineno=284, col_offset=23, end_lineno=284, end_col_offset=70)], lineno=284, col_offset=20, end_lineno=284, end_col_offset=70), lineno=284, col_offset=4, end_lineno=284, end_col_offset=70), Return(value=Call(func=Name(id='JSONResponse', ctx=Load(), lineno=285, col_offset=11, end_lineno=285, end_col_offset=23), args=[Dict(keys=[Constant(value='ready', lineno=285, col_offset=25, end_lineno=285, end_col_offset=32), Constant(value='checks', lineno=285, col_offset=49, end_lineno=285, end_col_offset=57)], values=[Name(id='overall_ready', ctx=Load(), lineno=285, col_offset=34, end_lineno=285, end_col_offset=47), Name(id='payload', ctx=Load(), lineno=285, col_offset=59, end_lineno=285, end_col_offset=66)], lineno=285, col_offset=24, end_lineno=285, end_col_offset=67)], lineno=285, col_offset=11, end_lineno=285, end_col_offset=68), lineno=285, col_offset=4, end_lineno=285, end_col_offset=68)], decorator_list=[Call(func=Attribute(value=Name(id='app', ctx=Load(), lineno=263, col_offset=1, end_lineno=263, end_col_offset=4), attr='get', ctx=Load(), lineno=263, col_offset=1, end_lineno=263, end_col_offset=8), args=[Constant(value='/readyz', lineno=263, col_offset=9, end_lineno=263, end_col_offset=18)], lineno=263, col_offset=1, end_lineno=263, end_col_offset=19)], returns=Name(id='JSONResponse', ctx=Load(), lineno=264, col_offset=38, end_lineno=264, end_col_offset=50), lineno=264, col_offset=0, end_lineno=285, end_col_offset=68), AsyncFunctionDef(name='sse_demo', args=arguments(), body=[Expr(value=Constant(value='SSE streaming demo endpoint.\n\n    Returns\n    -------\n    StreamingResponse\n        Server-sent events stream.\n    ', lineno=290, col_offset=4, end_lineno=296, end_col_offset=7), lineno=290, col_offset=4, end_lineno=296, end_col_offset=7), AsyncFunctionDef(name='event_generator', args=arguments(), body=[Expr(value=Yield(value=Constant(value=b'event: ready\ndata: {}\n\n', lineno=299, col_offset=14, end_lineno=299, end_col_offset=43), lineno=299, col_offset=8, end_lineno=299, end_col_offset=43), lineno=299, col_offset=8, end_lineno=299, end_col_offset=43), For(target=Name(id='i', ctx=Store(), lineno=300, col_offset=12, end_lineno=300, end_col_offset=13), iter=Call(func=Name(id='range', ctx=Load(), lineno=300, col_offset=17, end_lineno=300, end_col_offset=22), args=[Constant(value=5, lineno=300, col_offset=23, end_lineno=300, end_col_offset=24)], lineno=300, col_offset=17, end_lineno=300, end_col_offset=25), body=[Expr(value=Yield(value=Call(func=Attribute(value=JoinedStr(values=[Constant(value='data: ', lineno=301, col_offset=20, end_lineno=301, end_col_offset=26), FormattedValue(value=Name(id='i', ctx=Load(), lineno=301, col_offset=27, end_lineno=301, end_col_offset=28), conversion=-1, lineno=301, col_offset=26, end_lineno=301, end_col_offset=29), Constant(value='\n\n', lineno=301, col_offset=29, end_lineno=301, end_col_offset=33)], lineno=301, col_offset=18, end_lineno=301, end_col_offset=34), attr='encode', ctx=Load(), lineno=301, col_offset=18, end_lineno=301, end_col_offset=41), lineno=301, col_offset=18, end_lineno=301, end_col_offset=43), lineno=301, col_offset=12, end_lineno=301, end_col_offset=43), lineno=301, col_offset=12, end_lineno=301, end_col_offset=43), Expr(value=Await(value=Call(func=Attribute(value=Name(id='asyncio', ctx=Load(), lineno=302, col_offset=18, end_lineno=302, end_col_offset=25), attr='sleep', ctx=Load(), lineno=302, col_offset=18, end_lineno=302, end_col_offset=31), args=[Constant(value=0.5, lineno=302, col_offset=32, end_lineno=302, end_col_offset=35)], lineno=302, col_offset=18, end_lineno=302, end_col_offset=36), lineno=302, col_offset=12, end_lineno=302, end_col_offset=36), lineno=302, col_offset=12, end_lineno=302, end_col_offset=36)], lineno=300, col_offset=8, end_lineno=302, end_col_offset=36)], returns=Subscript(value=Name(id='AsyncIterator', ctx=Load(), lineno=298, col_offset=35, end_lineno=298, end_col_offset=48), slice=Name(id='bytes', ctx=Load(), lineno=298, col_offset=49, end_lineno=298, end_col_offset=54), ctx=Load(), lineno=298, col_offset=35, end_lineno=298, end_col_offset=55), lineno=298, col_offset=4, end_lineno=302, end_col_offset=36), Return(value=Call(func=Name(id='StreamingResponse', ctx=Load(), lineno=304, col_offset=11, end_lineno=304, end_col_offset=28), args=[Call(func=Name(id='event_generator', ctx=Load(), lineno=305, col_offset=8, end_lineno=305, end_col_offset=23), lineno=305, col_offset=8, end_lineno=305, end_col_offset=25)], keywords=[keyword(arg='media_type', value=Constant(value='text/event-stream', lineno=306, col_offset=19, end_lineno=306, end_col_offset=38), lineno=306, col_offset=8, end_lineno=306, end_col_offset=38)], lineno=304, col_offset=11, end_lineno=307, end_col_offset=5), lineno=304, col_offset=4, end_lineno=307, end_col_offset=5)], decorator_list=[Call(func=Attribute(value=Name(id='app', ctx=Load(), lineno=288, col_offset=1, end_lineno=288, end_col_offset=4), attr='get', ctx=Load(), lineno=288, col_offset=1, end_lineno=288, end_col_offset=8), args=[Constant(value='/sse', lineno=288, col_offset=9, end_lineno=288, end_col_offset=15)], lineno=288, col_offset=1, end_lineno=288, end_col_offset=16)], returns=Name(id='StreamingResponse', ctx=Load(), lineno=289, col_offset=24, end_lineno=289, end_col_offset=41), lineno=289, col_offset=0, end_lineno=307, end_col_offset=5), Expr(value=Call(func=Attribute(value=Name(id='app', ctx=Load(), lineno=311, col_offset=0, end_lineno=311, end_col_offset=3), attr='mount', ctx=Load(), lineno=311, col_offset=0, end_lineno=311, end_col_offset=9), args=[Constant(value='/mcp', lineno=311, col_offset=10, end_lineno=311, end_col_offset=16), Name(id='mcp_asgi', ctx=Load(), lineno=311, col_offset=18, end_lineno=311, end_col_offset=26)], lineno=311, col_offset=0, end_lineno=311, end_col_offset=27), lineno=311, col_offset=0, end_lineno=311, end_col_offset=27), Assign(targets=[Name(id='__all__', ctx=Store(), lineno=313, col_offset=0, end_lineno=313, end_col_offset=7)], value=List(elts=[Constant(value='app', lineno=313, col_offset=11, end_lineno=313, end_col_offset=16)], ctx=Load(), lineno=313, col_offset=10, end_lineno=313, end_col_offset=17), lineno=313, col_offset=0, end_lineno=313, end_col_offset=17)])