Module(body=[Expr(value=Constant(value='Performance benchmarks for adaptive FAISS indexing.\n\nThese benchmarks measure training time improvements from adaptive index\nselection, showing that small/medium corpora benefit significantly from\nflat/IVFFlat indexes compared to fixed IVF-PQ.\n\n**IMPORTANT**: These benchmarks are skipped by default. To run them:\n  - Set environment variable: RUN_BENCHMARKS=1 pytest ...\n  - Or explicitly request: pytest -m benchmark ...\n\nFor GPU-required benchmarks, also ensure GPU is available or use -m "benchmark and gpu".\n', lineno=1, col_offset=0, end_lineno=12, end_col_offset=3), lineno=1, col_offset=0, end_lineno=12, end_col_offset=3), ImportFrom(module='__future__', names=[alias(name='annotations', lineno=14, col_offset=23, end_lineno=14, end_col_offset=34)], level=0, lineno=14, col_offset=0, end_lineno=14, end_col_offset=34), Import(names=[alias(name='os', lineno=16, col_offset=7, end_lineno=16, end_col_offset=9)], lineno=16, col_offset=0, end_lineno=16, end_col_offset=9), ImportFrom(module='pathlib', names=[alias(name='Path', lineno=17, col_offset=20, end_lineno=17, end_col_offset=24)], level=0, lineno=17, col_offset=0, end_lineno=17, end_col_offset=24), ImportFrom(module='typing', names=[alias(name='TYPE_CHECKING', lineno=18, col_offset=19, end_lineno=18, end_col_offset=32), alias(name='Any', lineno=18, col_offset=34, end_lineno=18, end_col_offset=37), alias(name='cast', lineno=18, col_offset=39, end_lineno=18, end_col_offset=43)], level=0, lineno=18, col_offset=0, end_lineno=18, end_col_offset=43), Import(names=[alias(name='numpy', asname='np', lineno=20, col_offset=7, end_lineno=20, end_col_offset=18)], lineno=20, col_offset=0, end_lineno=20, end_col_offset=18), Import(names=[alias(name='pytest', lineno=21, col_offset=7, end_lineno=21, end_col_offset=13)], lineno=21, col_offset=0, end_lineno=21, end_col_offset=13), ImportFrom(module='codeintel_rev.io.faiss_manager', names=[alias(name='FAISSManager', lineno=22, col_offset=43, end_lineno=22, end_col_offset=55)], level=0, lineno=22, col_offset=0, end_lineno=22, end_col_offset=55), ImportFrom(module='tests.conftest', names=[alias(name='FAISS_MODULE', lineno=24, col_offset=27, end_lineno=24, end_col_offset=39), alias(name='HAS_FAISS_SUPPORT', lineno=24, col_offset=41, end_lineno=24, end_col_offset=58)], level=0, lineno=24, col_offset=0, end_lineno=24, end_col_offset=58), If(test=Name(id='TYPE_CHECKING', ctx=Load(), lineno=26, col_offset=3, end_lineno=26, end_col_offset=16), body=[Import(names=[alias(name='faiss', lineno=27, col_offset=11, end_lineno=27, end_col_offset=16)], lineno=27, col_offset=4, end_lineno=27, end_col_offset=16)], lineno=26, col_offset=0, end_lineno=27, end_col_offset=16), Assign(targets=[Name(id='_rng', ctx=Store(), lineno=30, col_offset=0, end_lineno=30, end_col_offset=4)], value=Call(func=Attribute(value=Attribute(value=Name(id='np', ctx=Load(), lineno=30, col_offset=7, end_lineno=30, end_col_offset=9), attr='random', ctx=Load(), lineno=30, col_offset=7, end_lineno=30, end_col_offset=16), attr='default_rng', ctx=Load(), lineno=30, col_offset=7, end_lineno=30, end_col_offset=28), args=[Constant(value=42, lineno=30, col_offset=29, end_lineno=30, end_col_offset=31)], lineno=30, col_offset=7, end_lineno=30, end_col_offset=32), lineno=30, col_offset=0, end_lineno=30, end_col_offset=32), Assign(targets=[Name(id='_benchmark_gate', ctx=Store(), lineno=32, col_offset=0, end_lineno=32, end_col_offset=15)], value=Call(func=Attribute(value=Attribute(value=Name(id='pytest', ctx=Load(), lineno=32, col_offset=18, end_lineno=32, end_col_offset=24), attr='mark', ctx=Load(), lineno=32, col_offset=18, end_lineno=32, end_col_offset=29), attr='skipif', ctx=Load(), lineno=32, col_offset=18, end_lineno=32, end_col_offset=36), args=[UnaryOp(op=Not(), operand=Call(func=Attribute(value=Name(id='os', ctx=Load(), lineno=33, col_offset=8, end_lineno=33, end_col_offset=10), attr='getenv', ctx=Load(), lineno=33, col_offset=8, end_lineno=33, end_col_offset=17), args=[Constant(value='RUN_BENCHMARKS', lineno=33, col_offset=18, end_lineno=33, end_col_offset=34)], lineno=33, col_offset=8, end_lineno=33, end_col_offset=35), lineno=33, col_offset=4, end_lineno=33, end_col_offset=35)], keywords=[keyword(arg='reason', value=Constant(value='Benchmarks skipped by default. Set RUN_BENCHMARKS=1 to enable.', lineno=34, col_offset=11, end_lineno=34, end_col_offset=75), lineno=34, col_offset=4, end_lineno=34, end_col_offset=75)], lineno=32, col_offset=18, end_lineno=35, end_col_offset=1), lineno=32, col_offset=0, end_lineno=35, end_col_offset=1), If(test=UnaryOp(op=Not(), operand=Name(id='HAS_FAISS_SUPPORT', ctx=Load(), lineno=37, col_offset=7, end_lineno=37, end_col_offset=24), lineno=37, col_offset=3, end_lineno=37, end_col_offset=24), body=[Assign(targets=[Name(id='pytestmark', ctx=Store(), lineno=38, col_offset=4, end_lineno=38, end_col_offset=14)], value=List(elts=[Name(id='_benchmark_gate', ctx=Load(), lineno=39, col_offset=8, end_lineno=39, end_col_offset=23), Call(func=Attribute(value=Attribute(value=Name(id='pytest', ctx=Load(), lineno=40, col_offset=8, end_lineno=40, end_col_offset=14), attr='mark', ctx=Load(), lineno=40, col_offset=8, end_lineno=40, end_col_offset=19), attr='skip', ctx=Load(), lineno=40, col_offset=8, end_lineno=40, end_col_offset=24), keywords=[keyword(arg='reason', value=Constant(value='FAISS bindings unavailable', lineno=40, col_offset=32, end_lineno=40, end_col_offset=60), lineno=40, col_offset=25, end_lineno=40, end_col_offset=60)], lineno=40, col_offset=8, end_lineno=40, end_col_offset=61)], ctx=Load(), lineno=38, col_offset=17, end_lineno=41, end_col_offset=5), lineno=38, col_offset=4, end_lineno=41, end_col_offset=5)], orelse=[Assert(test=Compare(left=Name(id='FAISS_MODULE', ctx=Load(), lineno=43, col_offset=11, end_lineno=43, end_col_offset=23), ops=[IsNot()], comparators=[Constant(value=None, lineno=43, col_offset=31, end_lineno=43, end_col_offset=35)], lineno=43, col_offset=11, end_lineno=43, end_col_offset=35), lineno=43, col_offset=4, end_lineno=43, end_col_offset=35), Assign(targets=[Name(id='pytestmark', ctx=Store(), lineno=44, col_offset=4, end_lineno=44, end_col_offset=14)], value=List(elts=[Name(id='_benchmark_gate', ctx=Load(), lineno=44, col_offset=18, end_lineno=44, end_col_offset=33)], ctx=Load(), lineno=44, col_offset=17, end_lineno=44, end_col_offset=34), lineno=44, col_offset=4, end_lineno=44, end_col_offset=34)], lineno=37, col_offset=0, end_lineno=44, end_col_offset=34), FunctionDef(name='_get_underlying_index', args=arguments(args=[arg(arg='cpu_index', annotation=Name(id='Any', ctx=Load(), lineno=47, col_offset=37, end_lineno=47, end_col_offset=40), lineno=47, col_offset=26, end_lineno=47, end_col_offset=40)]), body=[Expr(value=Constant(value='Return the underlying FAISS index from an ID map wrapper.\n\n    Returns\n    -------\n    Any\n        Underlying FAISS index instance.\n    ', lineno=48, col_offset=4, end_lineno=54, end_col_offset=7), lineno=48, col_offset=4, end_lineno=54, end_col_offset=7), Assert(test=Call(func=Name(id='hasattr', ctx=Load(), lineno=55, col_offset=11, end_lineno=55, end_col_offset=18), args=[Name(id='cpu_index', ctx=Load(), lineno=55, col_offset=19, end_lineno=55, end_col_offset=28), Constant(value='index', lineno=55, col_offset=30, end_lineno=55, end_col_offset=37)], lineno=55, col_offset=11, end_lineno=55, end_col_offset=38), msg=Constant(value='Expected FAISS index wrapper to expose `index` attribute', lineno=55, col_offset=40, end_lineno=55, end_col_offset=98), lineno=55, col_offset=4, end_lineno=55, end_col_offset=98), Assign(targets=[Name(id='index_map', ctx=Store(), lineno=56, col_offset=4, end_lineno=56, end_col_offset=13)], value=Call(func=Name(id='cast', ctx=Load(), lineno=56, col_offset=16, end_lineno=56, end_col_offset=20), args=[Constant(value='faiss.IndexIDMap2', lineno=56, col_offset=21, end_lineno=56, end_col_offset=40), Name(id='cpu_index', ctx=Load(), lineno=56, col_offset=42, end_lineno=56, end_col_offset=51)], lineno=56, col_offset=16, end_lineno=56, end_col_offset=52), lineno=56, col_offset=4, end_lineno=56, end_col_offset=52), Return(value=Attribute(value=Name(id='index_map', ctx=Load(), lineno=57, col_offset=11, end_lineno=57, end_col_offset=20), attr='index', ctx=Load(), lineno=57, col_offset=11, end_lineno=57, end_col_offset=26), lineno=57, col_offset=4, end_lineno=57, end_col_offset=26)], returns=Name(id='Any', ctx=Load(), lineno=47, col_offset=45, end_lineno=47, end_col_offset=48), lineno=47, col_offset=0, end_lineno=57, end_col_offset=26), FunctionDef(name='tmp_index_path', args=arguments(args=[arg(arg='tmp_path', annotation=Name(id='Path', ctx=Load(), lineno=61, col_offset=29, end_lineno=61, end_col_offset=33), lineno=61, col_offset=19, end_lineno=61, end_col_offset=33)]), body=[Expr(value=Constant(value='Create a temporary index path for benchmarking.\n\n    Parameters\n    ----------\n    tmp_path : Path\n        Temporary directory fixture.\n\n    Returns\n    -------\n    Path\n        Path to temporary FAISS index file.\n    ', lineno=62, col_offset=4, end_lineno=73, end_col_offset=7), lineno=62, col_offset=4, end_lineno=73, end_col_offset=7), Return(value=BinOp(left=Name(id='tmp_path', ctx=Load(), lineno=74, col_offset=11, end_lineno=74, end_col_offset=19), op=Div(), right=Constant(value='benchmark_index.faiss', lineno=74, col_offset=22, end_lineno=74, end_col_offset=45), lineno=74, col_offset=11, end_lineno=74, end_col_offset=45), lineno=74, col_offset=4, end_lineno=74, end_col_offset=45)], decorator_list=[Attribute(value=Name(id='pytest', ctx=Load(), lineno=60, col_offset=1, end_lineno=60, end_col_offset=7), attr='fixture', ctx=Load(), lineno=60, col_offset=1, end_lineno=60, end_col_offset=15)], returns=Name(id='Path', ctx=Load(), lineno=61, col_offset=38, end_lineno=61, end_col_offset=42), lineno=61, col_offset=0, end_lineno=74, end_col_offset=45), FunctionDef(name='test_small_corpus_flat_vs_ivf_pq', args=arguments(args=[arg(arg='benchmark', lineno=78, col_offset=37, end_lineno=78, end_col_offset=46), arg(arg='tmp_index_path', annotation=Name(id='Path', ctx=Load(), lineno=78, col_offset=64, end_lineno=78, end_col_offset=68), lineno=78, col_offset=48, end_lineno=78, end_col_offset=68)]), body=[Expr(value=Constant(value='Benchmark small corpus: flat index vs fixed IVF-PQ.\n\n    Small corpus (<5K vectors) should use flat index which requires\n    no training, providing ≥10x speedup compared to fixed IVF-PQ.\n\n    Parameters\n    ----------\n    benchmark : pytest_benchmark.fixture.BenchmarkFixture\n        Benchmark fixture.\n    tmp_index_path : Path\n        Temporary index path.\n    ', lineno=79, col_offset=4, end_lineno=90, end_col_offset=7), lineno=79, col_offset=4, end_lineno=90, end_col_offset=7), Assign(targets=[Name(id='vec_dim', ctx=Store(), lineno=91, col_offset=4, end_lineno=91, end_col_offset=11)], value=Constant(value=256, lineno=91, col_offset=14, end_lineno=91, end_col_offset=17), lineno=91, col_offset=4, end_lineno=91, end_col_offset=17), Assign(targets=[Name(id='n_vectors', ctx=Store(), lineno=92, col_offset=4, end_lineno=92, end_col_offset=13)], value=Constant(value=100, lineno=92, col_offset=16, end_lineno=92, end_col_offset=19), lineno=92, col_offset=4, end_lineno=92, end_col_offset=19), Assign(targets=[Name(id='vectors', ctx=Store(), lineno=94, col_offset=4, end_lineno=94, end_col_offset=11)], value=Call(func=Attribute(value=Call(func=Attribute(value=Name(id='_rng', ctx=Load(), lineno=94, col_offset=14, end_lineno=94, end_col_offset=18), attr='normal', ctx=Load(), lineno=94, col_offset=14, end_lineno=94, end_col_offset=25), args=[Constant(value=0.5, lineno=94, col_offset=26, end_lineno=94, end_col_offset=29), Constant(value=0.15, lineno=94, col_offset=31, end_lineno=94, end_col_offset=35), Tuple(elts=[Name(id='n_vectors', ctx=Load(), lineno=94, col_offset=38, end_lineno=94, end_col_offset=47), Name(id='vec_dim', ctx=Load(), lineno=94, col_offset=49, end_lineno=94, end_col_offset=56)], ctx=Load(), lineno=94, col_offset=37, end_lineno=94, end_col_offset=57)], lineno=94, col_offset=14, end_lineno=94, end_col_offset=58), attr='astype', ctx=Load(), lineno=94, col_offset=14, end_lineno=94, end_col_offset=65), args=[Attribute(value=Name(id='np', ctx=Load(), lineno=94, col_offset=66, end_lineno=94, end_col_offset=68), attr='float32', ctx=Load(), lineno=94, col_offset=66, end_lineno=94, end_col_offset=76)], lineno=94, col_offset=14, end_lineno=94, end_col_offset=77), lineno=94, col_offset=4, end_lineno=94, end_col_offset=77), Assign(targets=[Name(id='vectors', ctx=Store(), lineno=95, col_offset=4, end_lineno=95, end_col_offset=11)], value=Call(func=Attribute(value=Name(id='np', ctx=Load(), lineno=95, col_offset=14, end_lineno=95, end_col_offset=16), attr='clip', ctx=Load(), lineno=95, col_offset=14, end_lineno=95, end_col_offset=21), args=[Name(id='vectors', ctx=Load(), lineno=95, col_offset=22, end_lineno=95, end_col_offset=29), Constant(value=0.0, lineno=95, col_offset=31, end_lineno=95, end_col_offset=34), Constant(value=1.0, lineno=95, col_offset=36, end_lineno=95, end_col_offset=39)], lineno=95, col_offset=14, end_lineno=95, end_col_offset=40), lineno=95, col_offset=4, end_lineno=95, end_col_offset=40), FunctionDef(name='build_adaptive', args=arguments(), body=[Expr(value=Constant(value='Build index with adaptive selection (should use flat).', lineno=98, col_offset=8, end_lineno=98, end_col_offset=68), lineno=98, col_offset=8, end_lineno=98, end_col_offset=68), Assign(targets=[Name(id='manager', ctx=Store(), lineno=99, col_offset=8, end_lineno=99, end_col_offset=15)], value=Call(func=Name(id='FAISSManager', ctx=Load(), lineno=99, col_offset=18, end_lineno=99, end_col_offset=30), keywords=[keyword(arg='index_path', value=Name(id='tmp_index_path', ctx=Load(), lineno=99, col_offset=42, end_lineno=99, end_col_offset=56), lineno=99, col_offset=31, end_lineno=99, end_col_offset=56), keyword(arg='vec_dim', value=Name(id='vec_dim', ctx=Load(), lineno=99, col_offset=66, end_lineno=99, end_col_offset=73), lineno=99, col_offset=58, end_lineno=99, end_col_offset=73)], lineno=99, col_offset=18, end_lineno=99, end_col_offset=74), lineno=99, col_offset=8, end_lineno=99, end_col_offset=74), Expr(value=Call(func=Attribute(value=Name(id='manager', ctx=Load(), lineno=100, col_offset=8, end_lineno=100, end_col_offset=15), attr='build_index', ctx=Load(), lineno=100, col_offset=8, end_lineno=100, end_col_offset=27), args=[Name(id='vectors', ctx=Load(), lineno=100, col_offset=28, end_lineno=100, end_col_offset=35)], lineno=100, col_offset=8, end_lineno=100, end_col_offset=36), lineno=100, col_offset=8, end_lineno=100, end_col_offset=36)], returns=Constant(value=None, lineno=97, col_offset=28, end_lineno=97, end_col_offset=32), lineno=97, col_offset=4, end_lineno=100, end_col_offset=36), Expr(value=Call(func=Attribute(value=Name(id='benchmark', ctx=Load(), lineno=103, col_offset=4, end_lineno=103, end_col_offset=13), attr='pedantic', ctx=Load(), lineno=103, col_offset=4, end_lineno=103, end_col_offset=22), args=[Name(id='build_adaptive', ctx=Load(), lineno=103, col_offset=23, end_lineno=103, end_col_offset=37)], keywords=[keyword(arg='rounds', value=Constant(value=5, lineno=103, col_offset=46, end_lineno=103, end_col_offset=47), lineno=103, col_offset=39, end_lineno=103, end_col_offset=47), keyword(arg='iterations', value=Constant(value=1, lineno=103, col_offset=60, end_lineno=103, end_col_offset=61), lineno=103, col_offset=49, end_lineno=103, end_col_offset=61)], lineno=103, col_offset=4, end_lineno=103, end_col_offset=62), lineno=103, col_offset=4, end_lineno=103, end_col_offset=62), Assign(targets=[Name(id='manager', ctx=Store(), lineno=106, col_offset=4, end_lineno=106, end_col_offset=11)], value=Call(func=Name(id='FAISSManager', ctx=Load(), lineno=106, col_offset=14, end_lineno=106, end_col_offset=26), keywords=[keyword(arg='index_path', value=Name(id='tmp_index_path', ctx=Load(), lineno=106, col_offset=38, end_lineno=106, end_col_offset=52), lineno=106, col_offset=27, end_lineno=106, end_col_offset=52), keyword(arg='vec_dim', value=Name(id='vec_dim', ctx=Load(), lineno=106, col_offset=62, end_lineno=106, end_col_offset=69), lineno=106, col_offset=54, end_lineno=106, end_col_offset=69)], lineno=106, col_offset=14, end_lineno=106, end_col_offset=70), lineno=106, col_offset=4, end_lineno=106, end_col_offset=70), Expr(value=Call(func=Attribute(value=Name(id='manager', ctx=Load(), lineno=107, col_offset=4, end_lineno=107, end_col_offset=11), attr='build_index', ctx=Load(), lineno=107, col_offset=4, end_lineno=107, end_col_offset=23), args=[Name(id='vectors', ctx=Load(), lineno=107, col_offset=24, end_lineno=107, end_col_offset=31)], lineno=107, col_offset=4, end_lineno=107, end_col_offset=32), lineno=107, col_offset=4, end_lineno=107, end_col_offset=32), Assert(test=Compare(left=Attribute(value=Name(id='manager', ctx=Load(), lineno=108, col_offset=11, end_lineno=108, end_col_offset=18), attr='cpu_index', ctx=Load(), lineno=108, col_offset=11, end_lineno=108, end_col_offset=28), ops=[IsNot()], comparators=[Constant(value=None, lineno=108, col_offset=36, end_lineno=108, end_col_offset=40)], lineno=108, col_offset=11, end_lineno=108, end_col_offset=40), lineno=108, col_offset=4, end_lineno=108, end_col_offset=40), Assign(targets=[Name(id='cpu_index', ctx=Store(), lineno=109, col_offset=4, end_lineno=109, end_col_offset=13)], value=Attribute(value=Name(id='manager', ctx=Load(), lineno=109, col_offset=16, end_lineno=109, end_col_offset=23), attr='cpu_index', ctx=Load(), lineno=109, col_offset=16, end_lineno=109, end_col_offset=33), lineno=109, col_offset=4, end_lineno=109, end_col_offset=33), Assign(targets=[Name(id='underlying', ctx=Store(), lineno=110, col_offset=4, end_lineno=110, end_col_offset=14)], value=Call(func=Name(id='_get_underlying_index', ctx=Load(), lineno=110, col_offset=17, end_lineno=110, end_col_offset=38), args=[Name(id='cpu_index', ctx=Load(), lineno=110, col_offset=39, end_lineno=110, end_col_offset=48)], lineno=110, col_offset=17, end_lineno=110, end_col_offset=49), lineno=110, col_offset=4, end_lineno=110, end_col_offset=49), Assert(test=Compare(left=Attribute(value=Attribute(value=Name(id='underlying', ctx=Load(), lineno=111, col_offset=11, end_lineno=111, end_col_offset=21), attr='__class__', ctx=Load(), lineno=111, col_offset=11, end_lineno=111, end_col_offset=31), attr='__name__', ctx=Load(), lineno=111, col_offset=11, end_lineno=111, end_col_offset=40), ops=[Eq()], comparators=[Constant(value='IndexFlatIP', lineno=111, col_offset=44, end_lineno=111, end_col_offset=57)], lineno=111, col_offset=11, end_lineno=111, end_col_offset=57), lineno=111, col_offset=4, end_lineno=111, end_col_offset=57), Expr(value=Call(func=Name(id='print', ctx=Load(), lineno=113, col_offset=4, end_lineno=113, end_col_offset=9), args=[Constant(value='\nSmall corpus benchmark (5K vectors):', lineno=113, col_offset=10, end_lineno=113, end_col_offset=50)], lineno=113, col_offset=4, end_lineno=113, end_col_offset=51), lineno=113, col_offset=4, end_lineno=113, end_col_offset=51), Expr(value=Call(func=Name(id='print', ctx=Load(), lineno=114, col_offset=4, end_lineno=114, end_col_offset=9), args=[Constant(value='  Adaptive selection uses flat index (no training)', lineno=114, col_offset=10, end_lineno=114, end_col_offset=62)], lineno=114, col_offset=4, end_lineno=114, end_col_offset=63), lineno=114, col_offset=4, end_lineno=114, end_col_offset=63), Expr(value=Call(func=Name(id='print', ctx=Load(), lineno=115, col_offset=4, end_lineno=115, end_col_offset=9), args=[Constant(value='  Expected: ≥10x faster than fixed IVF-PQ', lineno=115, col_offset=10, end_lineno=115, end_col_offset=55)], lineno=115, col_offset=4, end_lineno=115, end_col_offset=56), lineno=115, col_offset=4, end_lineno=115, end_col_offset=56)], decorator_list=[Attribute(value=Attribute(value=Name(id='pytest', ctx=Load(), lineno=77, col_offset=1, end_lineno=77, end_col_offset=7), attr='mark', ctx=Load(), lineno=77, col_offset=1, end_lineno=77, end_col_offset=12), attr='benchmark', ctx=Load(), lineno=77, col_offset=1, end_lineno=77, end_col_offset=22)], returns=Constant(value=None, lineno=78, col_offset=73, end_lineno=78, end_col_offset=77), lineno=78, col_offset=0, end_lineno=115, end_col_offset=56), FunctionDef(name='test_medium_corpus_ivf_flat_vs_ivf_pq', args=arguments(args=[arg(arg='benchmark', lineno=119, col_offset=42, end_lineno=119, end_col_offset=51), arg(arg='tmp_index_path', annotation=Name(id='Path', ctx=Load(), lineno=119, col_offset=69, end_lineno=119, end_col_offset=73), lineno=119, col_offset=53, end_lineno=119, end_col_offset=73)]), body=[Expr(value=Constant(value='Benchmark medium corpus: IVFFlat vs fixed IVF-PQ.\n\n    Medium corpus (5K-50K vectors) should use IVFFlat with dynamic nlist,\n    providing ≥2x speedup compared to fixed IVF-PQ with nlist=8192.\n\n    Parameters\n    ----------\n    benchmark : pytest_benchmark.fixture.BenchmarkFixture\n        Benchmark fixture.\n    tmp_index_path : Path\n        Temporary index path.\n    ', lineno=120, col_offset=4, end_lineno=131, end_col_offset=7), lineno=120, col_offset=4, end_lineno=131, end_col_offset=7), Assign(targets=[Name(id='vec_dim', ctx=Store(), lineno=132, col_offset=4, end_lineno=132, end_col_offset=11)], value=Constant(value=256, lineno=132, col_offset=14, end_lineno=132, end_col_offset=17), lineno=132, col_offset=4, end_lineno=132, end_col_offset=17), Assign(targets=[Name(id='n_vectors', ctx=Store(), lineno=133, col_offset=4, end_lineno=133, end_col_offset=13)], value=Constant(value=5000, lineno=133, col_offset=16, end_lineno=133, end_col_offset=20), lineno=133, col_offset=4, end_lineno=133, end_col_offset=20), Assign(targets=[Name(id='vectors', ctx=Store(), lineno=135, col_offset=4, end_lineno=135, end_col_offset=11)], value=Call(func=Attribute(value=Call(func=Attribute(value=Name(id='_rng', ctx=Load(), lineno=135, col_offset=14, end_lineno=135, end_col_offset=18), attr='normal', ctx=Load(), lineno=135, col_offset=14, end_lineno=135, end_col_offset=25), args=[Constant(value=0.5, lineno=135, col_offset=26, end_lineno=135, end_col_offset=29), Constant(value=0.15, lineno=135, col_offset=31, end_lineno=135, end_col_offset=35), Tuple(elts=[Name(id='n_vectors', ctx=Load(), lineno=135, col_offset=38, end_lineno=135, end_col_offset=47), Name(id='vec_dim', ctx=Load(), lineno=135, col_offset=49, end_lineno=135, end_col_offset=56)], ctx=Load(), lineno=135, col_offset=37, end_lineno=135, end_col_offset=57)], lineno=135, col_offset=14, end_lineno=135, end_col_offset=58), attr='astype', ctx=Load(), lineno=135, col_offset=14, end_lineno=135, end_col_offset=65), args=[Attribute(value=Name(id='np', ctx=Load(), lineno=135, col_offset=66, end_lineno=135, end_col_offset=68), attr='float32', ctx=Load(), lineno=135, col_offset=66, end_lineno=135, end_col_offset=76)], lineno=135, col_offset=14, end_lineno=135, end_col_offset=77), lineno=135, col_offset=4, end_lineno=135, end_col_offset=77), Assign(targets=[Name(id='vectors', ctx=Store(), lineno=136, col_offset=4, end_lineno=136, end_col_offset=11)], value=Call(func=Attribute(value=Name(id='np', ctx=Load(), lineno=136, col_offset=14, end_lineno=136, end_col_offset=16), attr='clip', ctx=Load(), lineno=136, col_offset=14, end_lineno=136, end_col_offset=21), args=[Name(id='vectors', ctx=Load(), lineno=136, col_offset=22, end_lineno=136, end_col_offset=29), Constant(value=0.0, lineno=136, col_offset=31, end_lineno=136, end_col_offset=34), Constant(value=1.0, lineno=136, col_offset=36, end_lineno=136, end_col_offset=39)], lineno=136, col_offset=14, end_lineno=136, end_col_offset=40), lineno=136, col_offset=4, end_lineno=136, end_col_offset=40), FunctionDef(name='build_adaptive', args=arguments(), body=[Expr(value=Constant(value='Build index with adaptive selection (should use IVFFlat).', lineno=139, col_offset=8, end_lineno=139, end_col_offset=71), lineno=139, col_offset=8, end_lineno=139, end_col_offset=71), Assign(targets=[Name(id='manager', ctx=Store(), lineno=140, col_offset=8, end_lineno=140, end_col_offset=15)], value=Call(func=Name(id='FAISSManager', ctx=Load(), lineno=140, col_offset=18, end_lineno=140, end_col_offset=30), keywords=[keyword(arg='index_path', value=Name(id='tmp_index_path', ctx=Load(), lineno=140, col_offset=42, end_lineno=140, end_col_offset=56), lineno=140, col_offset=31, end_lineno=140, end_col_offset=56), keyword(arg='vec_dim', value=Name(id='vec_dim', ctx=Load(), lineno=140, col_offset=66, end_lineno=140, end_col_offset=73), lineno=140, col_offset=58, end_lineno=140, end_col_offset=73)], lineno=140, col_offset=18, end_lineno=140, end_col_offset=74), lineno=140, col_offset=8, end_lineno=140, end_col_offset=74), Expr(value=Call(func=Attribute(value=Name(id='manager', ctx=Load(), lineno=141, col_offset=8, end_lineno=141, end_col_offset=15), attr='build_index', ctx=Load(), lineno=141, col_offset=8, end_lineno=141, end_col_offset=27), args=[Name(id='vectors', ctx=Load(), lineno=141, col_offset=28, end_lineno=141, end_col_offset=35)], lineno=141, col_offset=8, end_lineno=141, end_col_offset=36), lineno=141, col_offset=8, end_lineno=141, end_col_offset=36)], returns=Constant(value=None, lineno=138, col_offset=28, end_lineno=138, end_col_offset=32), lineno=138, col_offset=4, end_lineno=141, end_col_offset=36), Expr(value=Call(func=Attribute(value=Name(id='benchmark', ctx=Load(), lineno=144, col_offset=4, end_lineno=144, end_col_offset=13), attr='pedantic', ctx=Load(), lineno=144, col_offset=4, end_lineno=144, end_col_offset=22), args=[Name(id='build_adaptive', ctx=Load(), lineno=144, col_offset=23, end_lineno=144, end_col_offset=37)], keywords=[keyword(arg='rounds', value=Constant(value=3, lineno=144, col_offset=46, end_lineno=144, end_col_offset=47), lineno=144, col_offset=39, end_lineno=144, end_col_offset=47), keyword(arg='iterations', value=Constant(value=1, lineno=144, col_offset=60, end_lineno=144, end_col_offset=61), lineno=144, col_offset=49, end_lineno=144, end_col_offset=61)], lineno=144, col_offset=4, end_lineno=144, end_col_offset=62), lineno=144, col_offset=4, end_lineno=144, end_col_offset=62), Assign(targets=[Name(id='manager', ctx=Store(), lineno=147, col_offset=4, end_lineno=147, end_col_offset=11)], value=Call(func=Name(id='FAISSManager', ctx=Load(), lineno=147, col_offset=14, end_lineno=147, end_col_offset=26), keywords=[keyword(arg='index_path', value=Name(id='tmp_index_path', ctx=Load(), lineno=147, col_offset=38, end_lineno=147, end_col_offset=52), lineno=147, col_offset=27, end_lineno=147, end_col_offset=52), keyword(arg='vec_dim', value=Name(id='vec_dim', ctx=Load(), lineno=147, col_offset=62, end_lineno=147, end_col_offset=69), lineno=147, col_offset=54, end_lineno=147, end_col_offset=69)], lineno=147, col_offset=14, end_lineno=147, end_col_offset=70), lineno=147, col_offset=4, end_lineno=147, end_col_offset=70), Expr(value=Call(func=Attribute(value=Name(id='manager', ctx=Load(), lineno=148, col_offset=4, end_lineno=148, end_col_offset=11), attr='build_index', ctx=Load(), lineno=148, col_offset=4, end_lineno=148, end_col_offset=23), args=[Name(id='vectors', ctx=Load(), lineno=148, col_offset=24, end_lineno=148, end_col_offset=31)], lineno=148, col_offset=4, end_lineno=148, end_col_offset=32), lineno=148, col_offset=4, end_lineno=148, end_col_offset=32), Assert(test=Compare(left=Attribute(value=Name(id='manager', ctx=Load(), lineno=149, col_offset=11, end_lineno=149, end_col_offset=18), attr='cpu_index', ctx=Load(), lineno=149, col_offset=11, end_lineno=149, end_col_offset=28), ops=[IsNot()], comparators=[Constant(value=None, lineno=149, col_offset=36, end_lineno=149, end_col_offset=40)], lineno=149, col_offset=11, end_lineno=149, end_col_offset=40), lineno=149, col_offset=4, end_lineno=149, end_col_offset=40), Assign(targets=[Name(id='cpu_index', ctx=Store(), lineno=150, col_offset=4, end_lineno=150, end_col_offset=13)], value=Attribute(value=Name(id='manager', ctx=Load(), lineno=150, col_offset=16, end_lineno=150, end_col_offset=23), attr='cpu_index', ctx=Load(), lineno=150, col_offset=16, end_lineno=150, end_col_offset=33), lineno=150, col_offset=4, end_lineno=150, end_col_offset=33), Assign(targets=[Name(id='underlying', ctx=Store(), lineno=151, col_offset=4, end_lineno=151, end_col_offset=14)], value=Call(func=Name(id='_get_underlying_index', ctx=Load(), lineno=151, col_offset=17, end_lineno=151, end_col_offset=38), args=[Name(id='cpu_index', ctx=Load(), lineno=151, col_offset=39, end_lineno=151, end_col_offset=48)], lineno=151, col_offset=17, end_lineno=151, end_col_offset=49), lineno=151, col_offset=4, end_lineno=151, end_col_offset=49), Assert(test=Compare(left=Attribute(value=Attribute(value=Name(id='underlying', ctx=Load(), lineno=152, col_offset=11, end_lineno=152, end_col_offset=21), attr='__class__', ctx=Load(), lineno=152, col_offset=11, end_lineno=152, end_col_offset=31), attr='__name__', ctx=Load(), lineno=152, col_offset=11, end_lineno=152, end_col_offset=40), ops=[Eq()], comparators=[Constant(value='IndexIVFFlat', lineno=152, col_offset=44, end_lineno=152, end_col_offset=58)], lineno=152, col_offset=11, end_lineno=152, end_col_offset=58), lineno=152, col_offset=4, end_lineno=152, end_col_offset=58), Expr(value=Call(func=Name(id='print', ctx=Load(), lineno=154, col_offset=4, end_lineno=154, end_col_offset=9), args=[Constant(value='\nMedium corpus benchmark (50K vectors):', lineno=154, col_offset=10, end_lineno=154, end_col_offset=52)], lineno=154, col_offset=4, end_lineno=154, end_col_offset=53), lineno=154, col_offset=4, end_lineno=154, end_col_offset=53), Expr(value=Call(func=Name(id='print', ctx=Load(), lineno=155, col_offset=4, end_lineno=155, end_col_offset=9), args=[Constant(value='  Adaptive selection uses IVFFlat with dynamic nlist', lineno=155, col_offset=10, end_lineno=155, end_col_offset=64)], lineno=155, col_offset=4, end_lineno=155, end_col_offset=65), lineno=155, col_offset=4, end_lineno=155, end_col_offset=65), Expr(value=Call(func=Name(id='print', ctx=Load(), lineno=156, col_offset=4, end_lineno=156, end_col_offset=9), args=[Constant(value='  Expected: ≥2x faster than fixed IVF-PQ', lineno=156, col_offset=10, end_lineno=156, end_col_offset=54)], lineno=156, col_offset=4, end_lineno=156, end_col_offset=55), lineno=156, col_offset=4, end_lineno=156, end_col_offset=55)], decorator_list=[Attribute(value=Attribute(value=Name(id='pytest', ctx=Load(), lineno=118, col_offset=1, end_lineno=118, end_col_offset=7), attr='mark', ctx=Load(), lineno=118, col_offset=1, end_lineno=118, end_col_offset=12), attr='benchmark', ctx=Load(), lineno=118, col_offset=1, end_lineno=118, end_col_offset=22)], returns=Constant(value=None, lineno=119, col_offset=78, end_lineno=119, end_col_offset=82), lineno=119, col_offset=0, end_lineno=156, end_col_offset=55), FunctionDef(name='test_large_corpus_adaptive_vs_fixed', args=arguments(args=[arg(arg='benchmark', lineno=161, col_offset=40, end_lineno=161, end_col_offset=49), arg(arg='tmp_index_path', annotation=Name(id='Path', ctx=Load(), lineno=161, col_offset=67, end_lineno=161, end_col_offset=71), lineno=161, col_offset=51, end_lineno=161, end_col_offset=71)]), body=[Expr(value=Constant(value='Benchmark large corpus: adaptive vs fixed IVF-PQ.\n\n    Large corpus (>50K vectors) should use IVF-PQ with dynamic nlist,\n    providing similar performance to fixed IVF-PQ but with better\n    parameter selection.\n\n    **Requires GPU** - This benchmark uses large vectors and is marked\n    with @pytest.mark.gpu. It will be skipped unless GPU is available\n    or explicitly requested.\n\n    Parameters\n    ----------\n    benchmark : pytest_benchmark.fixture.BenchmarkFixture\n        Benchmark fixture.\n    tmp_index_path : Path\n        Temporary index path.\n    ', lineno=162, col_offset=4, end_lineno=178, end_col_offset=7), lineno=162, col_offset=4, end_lineno=178, end_col_offset=7), Assign(targets=[Name(id='vec_dim', ctx=Store(), lineno=179, col_offset=4, end_lineno=179, end_col_offset=11)], value=Constant(value=256, lineno=179, col_offset=14, end_lineno=179, end_col_offset=17), lineno=179, col_offset=4, end_lineno=179, end_col_offset=17), Assign(targets=[Name(id='n_vectors', ctx=Store(), lineno=180, col_offset=4, end_lineno=180, end_col_offset=13)], value=Constant(value=50000, lineno=180, col_offset=16, end_lineno=180, end_col_offset=21), lineno=180, col_offset=4, end_lineno=180, end_col_offset=21), Assign(targets=[Name(id='vectors', ctx=Store(), lineno=182, col_offset=4, end_lineno=182, end_col_offset=11)], value=Call(func=Attribute(value=Call(func=Attribute(value=Name(id='_rng', ctx=Load(), lineno=182, col_offset=14, end_lineno=182, end_col_offset=18), attr='normal', ctx=Load(), lineno=182, col_offset=14, end_lineno=182, end_col_offset=25), args=[Constant(value=0.5, lineno=182, col_offset=26, end_lineno=182, end_col_offset=29), Constant(value=0.15, lineno=182, col_offset=31, end_lineno=182, end_col_offset=35), Tuple(elts=[Name(id='n_vectors', ctx=Load(), lineno=182, col_offset=38, end_lineno=182, end_col_offset=47), Name(id='vec_dim', ctx=Load(), lineno=182, col_offset=49, end_lineno=182, end_col_offset=56)], ctx=Load(), lineno=182, col_offset=37, end_lineno=182, end_col_offset=57)], lineno=182, col_offset=14, end_lineno=182, end_col_offset=58), attr='astype', ctx=Load(), lineno=182, col_offset=14, end_lineno=182, end_col_offset=65), args=[Attribute(value=Name(id='np', ctx=Load(), lineno=182, col_offset=66, end_lineno=182, end_col_offset=68), attr='float32', ctx=Load(), lineno=182, col_offset=66, end_lineno=182, end_col_offset=76)], lineno=182, col_offset=14, end_lineno=182, end_col_offset=77), lineno=182, col_offset=4, end_lineno=182, end_col_offset=77), Assign(targets=[Name(id='vectors', ctx=Store(), lineno=183, col_offset=4, end_lineno=183, end_col_offset=11)], value=Call(func=Attribute(value=Name(id='np', ctx=Load(), lineno=183, col_offset=14, end_lineno=183, end_col_offset=16), attr='clip', ctx=Load(), lineno=183, col_offset=14, end_lineno=183, end_col_offset=21), args=[Name(id='vectors', ctx=Load(), lineno=183, col_offset=22, end_lineno=183, end_col_offset=29), Constant(value=0.0, lineno=183, col_offset=31, end_lineno=183, end_col_offset=34), Constant(value=1.0, lineno=183, col_offset=36, end_lineno=183, end_col_offset=39)], lineno=183, col_offset=14, end_lineno=183, end_col_offset=40), lineno=183, col_offset=4, end_lineno=183, end_col_offset=40), FunctionDef(name='build_adaptive', args=arguments(), body=[Expr(value=Constant(value='Build index with adaptive selection (should use IVF-PQ).', lineno=186, col_offset=8, end_lineno=186, end_col_offset=70), lineno=186, col_offset=8, end_lineno=186, end_col_offset=70), Assign(targets=[Name(id='manager', ctx=Store(), lineno=187, col_offset=8, end_lineno=187, end_col_offset=15)], value=Call(func=Name(id='FAISSManager', ctx=Load(), lineno=187, col_offset=18, end_lineno=187, end_col_offset=30), keywords=[keyword(arg='index_path', value=Name(id='tmp_index_path', ctx=Load(), lineno=187, col_offset=42, end_lineno=187, end_col_offset=56), lineno=187, col_offset=31, end_lineno=187, end_col_offset=56), keyword(arg='vec_dim', value=Name(id='vec_dim', ctx=Load(), lineno=187, col_offset=66, end_lineno=187, end_col_offset=73), lineno=187, col_offset=58, end_lineno=187, end_col_offset=73)], lineno=187, col_offset=18, end_lineno=187, end_col_offset=74), lineno=187, col_offset=8, end_lineno=187, end_col_offset=74), Expr(value=Call(func=Attribute(value=Name(id='manager', ctx=Load(), lineno=188, col_offset=8, end_lineno=188, end_col_offset=15), attr='build_index', ctx=Load(), lineno=188, col_offset=8, end_lineno=188, end_col_offset=27), args=[Name(id='vectors', ctx=Load(), lineno=188, col_offset=28, end_lineno=188, end_col_offset=35)], lineno=188, col_offset=8, end_lineno=188, end_col_offset=36), lineno=188, col_offset=8, end_lineno=188, end_col_offset=36)], returns=Constant(value=None, lineno=185, col_offset=28, end_lineno=185, end_col_offset=32), lineno=185, col_offset=4, end_lineno=188, end_col_offset=36), Expr(value=Call(func=Attribute(value=Name(id='benchmark', ctx=Load(), lineno=191, col_offset=4, end_lineno=191, end_col_offset=13), attr='pedantic', ctx=Load(), lineno=191, col_offset=4, end_lineno=191, end_col_offset=22), args=[Name(id='build_adaptive', ctx=Load(), lineno=191, col_offset=23, end_lineno=191, end_col_offset=37)], keywords=[keyword(arg='rounds', value=Constant(value=3, lineno=191, col_offset=46, end_lineno=191, end_col_offset=47), lineno=191, col_offset=39, end_lineno=191, end_col_offset=47), keyword(arg='iterations', value=Constant(value=1, lineno=191, col_offset=60, end_lineno=191, end_col_offset=61), lineno=191, col_offset=49, end_lineno=191, end_col_offset=61)], lineno=191, col_offset=4, end_lineno=191, end_col_offset=62), lineno=191, col_offset=4, end_lineno=191, end_col_offset=62), Assign(targets=[Name(id='manager', ctx=Store(), lineno=194, col_offset=4, end_lineno=194, end_col_offset=11)], value=Call(func=Name(id='FAISSManager', ctx=Load(), lineno=194, col_offset=14, end_lineno=194, end_col_offset=26), keywords=[keyword(arg='index_path', value=Name(id='tmp_index_path', ctx=Load(), lineno=194, col_offset=38, end_lineno=194, end_col_offset=52), lineno=194, col_offset=27, end_lineno=194, end_col_offset=52), keyword(arg='vec_dim', value=Name(id='vec_dim', ctx=Load(), lineno=194, col_offset=62, end_lineno=194, end_col_offset=69), lineno=194, col_offset=54, end_lineno=194, end_col_offset=69)], lineno=194, col_offset=14, end_lineno=194, end_col_offset=70), lineno=194, col_offset=4, end_lineno=194, end_col_offset=70), Expr(value=Call(func=Attribute(value=Name(id='manager', ctx=Load(), lineno=195, col_offset=4, end_lineno=195, end_col_offset=11), attr='build_index', ctx=Load(), lineno=195, col_offset=4, end_lineno=195, end_col_offset=23), args=[Name(id='vectors', ctx=Load(), lineno=195, col_offset=24, end_lineno=195, end_col_offset=31)], lineno=195, col_offset=4, end_lineno=195, end_col_offset=32), lineno=195, col_offset=4, end_lineno=195, end_col_offset=32), Assert(test=Compare(left=Attribute(value=Name(id='manager', ctx=Load(), lineno=196, col_offset=11, end_lineno=196, end_col_offset=18), attr='cpu_index', ctx=Load(), lineno=196, col_offset=11, end_lineno=196, end_col_offset=28), ops=[IsNot()], comparators=[Constant(value=None, lineno=196, col_offset=36, end_lineno=196, end_col_offset=40)], lineno=196, col_offset=11, end_lineno=196, end_col_offset=40), lineno=196, col_offset=4, end_lineno=196, end_col_offset=40), Assign(targets=[Name(id='cpu_index', ctx=Store(), lineno=197, col_offset=4, end_lineno=197, end_col_offset=13)], value=Attribute(value=Name(id='manager', ctx=Load(), lineno=197, col_offset=16, end_lineno=197, end_col_offset=23), attr='cpu_index', ctx=Load(), lineno=197, col_offset=16, end_lineno=197, end_col_offset=33), lineno=197, col_offset=4, end_lineno=197, end_col_offset=33), Assign(targets=[Name(id='underlying', ctx=Store(), lineno=198, col_offset=4, end_lineno=198, end_col_offset=14)], value=Call(func=Name(id='_get_underlying_index', ctx=Load(), lineno=198, col_offset=17, end_lineno=198, end_col_offset=38), args=[Name(id='cpu_index', ctx=Load(), lineno=198, col_offset=39, end_lineno=198, end_col_offset=48)], lineno=198, col_offset=17, end_lineno=198, end_col_offset=49), lineno=198, col_offset=4, end_lineno=198, end_col_offset=49), Assert(test=Call(func=Name(id='hasattr', ctx=Load(), lineno=199, col_offset=11, end_lineno=199, end_col_offset=18), args=[Name(id='underlying', ctx=Load(), lineno=199, col_offset=19, end_lineno=199, end_col_offset=29), Constant(value='nlist', lineno=199, col_offset=31, end_lineno=199, end_col_offset=38)], lineno=199, col_offset=11, end_lineno=199, end_col_offset=39), lineno=199, col_offset=4, end_lineno=199, end_col_offset=39), Expr(value=Call(func=Name(id='print', ctx=Load(), lineno=201, col_offset=4, end_lineno=201, end_col_offset=9), args=[Constant(value='\nLarge corpus benchmark (100K vectors):', lineno=201, col_offset=10, end_lineno=201, end_col_offset=52)], lineno=201, col_offset=4, end_lineno=201, end_col_offset=53), lineno=201, col_offset=4, end_lineno=201, end_col_offset=53), Expr(value=Call(func=Name(id='print', ctx=Load(), lineno=202, col_offset=4, end_lineno=202, end_col_offset=9), args=[Constant(value='  Adaptive selection uses IVF-PQ with dynamic nlist', lineno=202, col_offset=10, end_lineno=202, end_col_offset=63)], lineno=202, col_offset=4, end_lineno=202, end_col_offset=64), lineno=202, col_offset=4, end_lineno=202, end_col_offset=64), Expr(value=Call(func=Name(id='print', ctx=Load(), lineno=203, col_offset=4, end_lineno=203, end_col_offset=9), args=[Constant(value='  Expected: Similar performance to fixed IVF-PQ', lineno=203, col_offset=10, end_lineno=203, end_col_offset=59)], lineno=203, col_offset=4, end_lineno=203, end_col_offset=60), lineno=203, col_offset=4, end_lineno=203, end_col_offset=60)], decorator_list=[Attribute(value=Attribute(value=Name(id='pytest', ctx=Load(), lineno=159, col_offset=1, end_lineno=159, end_col_offset=7), attr='mark', ctx=Load(), lineno=159, col_offset=1, end_lineno=159, end_col_offset=12), attr='benchmark', ctx=Load(), lineno=159, col_offset=1, end_lineno=159, end_col_offset=22), Attribute(value=Attribute(value=Name(id='pytest', ctx=Load(), lineno=160, col_offset=1, end_lineno=160, end_col_offset=7), attr='mark', ctx=Load(), lineno=160, col_offset=1, end_lineno=160, end_col_offset=12), attr='gpu', ctx=Load(), lineno=160, col_offset=1, end_lineno=160, end_col_offset=16)], returns=Constant(value=None, lineno=161, col_offset=76, end_lineno=161, end_col_offset=80), lineno=161, col_offset=0, end_lineno=203, end_col_offset=60), FunctionDef(name='test_training_time_scaling', args=arguments(args=[arg(arg='benchmark', lineno=207, col_offset=31, end_lineno=207, end_col_offset=40), arg(arg='tmp_index_path', annotation=Name(id='Path', ctx=Load(), lineno=207, col_offset=58, end_lineno=207, end_col_offset=62), lineno=207, col_offset=42, end_lineno=207, end_col_offset=62)]), body=[Expr(value=Constant(value='Benchmark training time scaling across corpus sizes.\n\n    Verifies that training time scales appropriately with corpus size:\n    - Small (<5K): <5s (flat, no training)\n    - Medium (5K-50K): <30s (IVFFlat)\n\n    Parameters\n    ----------\n    benchmark : pytest_benchmark.fixture.BenchmarkFixture\n        Benchmark fixture.\n    tmp_index_path : Path\n        Temporary index path.\n    ', lineno=208, col_offset=4, end_lineno=220, end_col_offset=7), lineno=208, col_offset=4, end_lineno=220, end_col_offset=7), Assign(targets=[Name(id='vec_dim', ctx=Store(), lineno=221, col_offset=4, end_lineno=221, end_col_offset=11)], value=Constant(value=256, lineno=221, col_offset=14, end_lineno=221, end_col_offset=17), lineno=221, col_offset=4, end_lineno=221, end_col_offset=17), For(target=Tuple(elts=[Name(id='n_vectors', ctx=Store(), lineno=224, col_offset=8, end_lineno=224, end_col_offset=17), Name(id='max_time', ctx=Store(), lineno=224, col_offset=19, end_lineno=224, end_col_offset=27)], ctx=Store(), lineno=224, col_offset=8, end_lineno=224, end_col_offset=27), iter=List(elts=[Tuple(elts=[Constant(value=100, lineno=224, col_offset=33, end_lineno=224, end_col_offset=36), Constant(value=2, lineno=224, col_offset=38, end_lineno=224, end_col_offset=39)], ctx=Load(), lineno=224, col_offset=32, end_lineno=224, end_col_offset=40), Tuple(elts=[Constant(value=5000, lineno=224, col_offset=43, end_lineno=224, end_col_offset=47), Constant(value=15, lineno=224, col_offset=49, end_lineno=224, end_col_offset=51)], ctx=Load(), lineno=224, col_offset=42, end_lineno=224, end_col_offset=52)], ctx=Load(), lineno=224, col_offset=31, end_lineno=224, end_col_offset=53), body=[Assign(targets=[Name(id='vectors', ctx=Store(), lineno=226, col_offset=8, end_lineno=226, end_col_offset=15)], value=Call(func=Attribute(value=Call(func=Attribute(value=Name(id='_rng', ctx=Load(), lineno=226, col_offset=18, end_lineno=226, end_col_offset=22), attr='normal', ctx=Load(), lineno=226, col_offset=18, end_lineno=226, end_col_offset=29), args=[Constant(value=0.5, lineno=226, col_offset=30, end_lineno=226, end_col_offset=33), Constant(value=0.15, lineno=226, col_offset=35, end_lineno=226, end_col_offset=39), Tuple(elts=[Name(id='n_vectors', ctx=Load(), lineno=226, col_offset=42, end_lineno=226, end_col_offset=51), Name(id='vec_dim', ctx=Load(), lineno=226, col_offset=53, end_lineno=226, end_col_offset=60)], ctx=Load(), lineno=226, col_offset=41, end_lineno=226, end_col_offset=61)], lineno=226, col_offset=18, end_lineno=226, end_col_offset=62), attr='astype', ctx=Load(), lineno=226, col_offset=18, end_lineno=226, end_col_offset=69), args=[Attribute(value=Name(id='np', ctx=Load(), lineno=226, col_offset=70, end_lineno=226, end_col_offset=72), attr='float32', ctx=Load(), lineno=226, col_offset=70, end_lineno=226, end_col_offset=80)], lineno=226, col_offset=18, end_lineno=226, end_col_offset=81), lineno=226, col_offset=8, end_lineno=226, end_col_offset=81), Assign(targets=[Name(id='vectors', ctx=Store(), lineno=227, col_offset=8, end_lineno=227, end_col_offset=15)], value=Call(func=Attribute(value=Name(id='np', ctx=Load(), lineno=227, col_offset=18, end_lineno=227, end_col_offset=20), attr='clip', ctx=Load(), lineno=227, col_offset=18, end_lineno=227, end_col_offset=25), args=[Name(id='vectors', ctx=Load(), lineno=227, col_offset=26, end_lineno=227, end_col_offset=33), Constant(value=0.0, lineno=227, col_offset=35, end_lineno=227, end_col_offset=38), Constant(value=1.0, lineno=227, col_offset=40, end_lineno=227, end_col_offset=43)], lineno=227, col_offset=18, end_lineno=227, end_col_offset=44), lineno=227, col_offset=8, end_lineno=227, end_col_offset=44), FunctionDef(name='build_index', args=arguments(args=[arg(arg='vectors', lineno=229, col_offset=24, end_lineno=229, end_col_offset=31)], defaults=[Name(id='vectors', ctx=Load(), lineno=229, col_offset=32, end_lineno=229, end_col_offset=39)]), body=[Expr(value=Constant(value='Build index for current corpus size.', lineno=230, col_offset=12, end_lineno=230, end_col_offset=54), lineno=230, col_offset=12, end_lineno=230, end_col_offset=54), Assign(targets=[Name(id='manager', ctx=Store(), lineno=231, col_offset=12, end_lineno=231, end_col_offset=19)], value=Call(func=Name(id='FAISSManager', ctx=Load(), lineno=231, col_offset=22, end_lineno=231, end_col_offset=34), keywords=[keyword(arg='index_path', value=Name(id='tmp_index_path', ctx=Load(), lineno=231, col_offset=46, end_lineno=231, end_col_offset=60), lineno=231, col_offset=35, end_lineno=231, end_col_offset=60), keyword(arg='vec_dim', value=Name(id='vec_dim', ctx=Load(), lineno=231, col_offset=70, end_lineno=231, end_col_offset=77), lineno=231, col_offset=62, end_lineno=231, end_col_offset=77)], lineno=231, col_offset=22, end_lineno=231, end_col_offset=78), lineno=231, col_offset=12, end_lineno=231, end_col_offset=78), Expr(value=Call(func=Attribute(value=Name(id='manager', ctx=Load(), lineno=232, col_offset=12, end_lineno=232, end_col_offset=19), attr='build_index', ctx=Load(), lineno=232, col_offset=12, end_lineno=232, end_col_offset=31), args=[Name(id='vectors', ctx=Load(), lineno=232, col_offset=32, end_lineno=232, end_col_offset=39)], lineno=232, col_offset=12, end_lineno=232, end_col_offset=40), lineno=232, col_offset=12, end_lineno=232, end_col_offset=40)], returns=Constant(value=None, lineno=229, col_offset=44, end_lineno=229, end_col_offset=48), lineno=229, col_offset=8, end_lineno=232, end_col_offset=40), Assign(targets=[Name(id='result', ctx=Store(), lineno=235, col_offset=8, end_lineno=235, end_col_offset=14)], value=Call(func=Attribute(value=Name(id='benchmark', ctx=Load(), lineno=235, col_offset=17, end_lineno=235, end_col_offset=26), attr='pedantic', ctx=Load(), lineno=235, col_offset=17, end_lineno=235, end_col_offset=35), args=[Name(id='build_index', ctx=Load(), lineno=235, col_offset=36, end_lineno=235, end_col_offset=47)], keywords=[keyword(arg='rounds', value=Constant(value=1, lineno=235, col_offset=56, end_lineno=235, end_col_offset=57), lineno=235, col_offset=49, end_lineno=235, end_col_offset=57), keyword(arg='iterations', value=Constant(value=1, lineno=235, col_offset=70, end_lineno=235, end_col_offset=71), lineno=235, col_offset=59, end_lineno=235, end_col_offset=71)], lineno=235, col_offset=17, end_lineno=235, end_col_offset=72), lineno=235, col_offset=8, end_lineno=235, end_col_offset=72), Assign(targets=[Name(id='avg_time', ctx=Store(), lineno=238, col_offset=8, end_lineno=238, end_col_offset=16)], value=Attribute(value=Attribute(value=Name(id='result', ctx=Load(), lineno=238, col_offset=19, end_lineno=238, end_col_offset=25), attr='stats', ctx=Load(), lineno=238, col_offset=19, end_lineno=238, end_col_offset=31), attr='mean', ctx=Load(), lineno=238, col_offset=19, end_lineno=238, end_col_offset=36), lineno=238, col_offset=8, end_lineno=238, end_col_offset=36), Assert(test=Compare(left=Name(id='avg_time', ctx=Load(), lineno=239, col_offset=15, end_lineno=239, end_col_offset=23), ops=[Lt()], comparators=[Name(id='max_time', ctx=Load(), lineno=239, col_offset=26, end_lineno=239, end_col_offset=34)], lineno=239, col_offset=15, end_lineno=239, end_col_offset=34), msg=JoinedStr(values=[Constant(value='Training took ', lineno=239, col_offset=38, end_lineno=239, end_col_offset=52), FormattedValue(value=Name(id='avg_time', ctx=Load(), lineno=239, col_offset=53, end_lineno=239, end_col_offset=61), conversion=-1, format_spec=JoinedStr(values=[Constant(value='.2f', lineno=239, col_offset=62, end_lineno=239, end_col_offset=65)], lineno=239, col_offset=61, end_lineno=239, end_col_offset=65), lineno=239, col_offset=52, end_lineno=239, end_col_offset=66), Constant(value='s (target: <', lineno=239, col_offset=66, end_lineno=239, end_col_offset=78), FormattedValue(value=Name(id='max_time', ctx=Load(), lineno=239, col_offset=79, end_lineno=239, end_col_offset=87), conversion=-1, lineno=239, col_offset=78, end_lineno=239, end_col_offset=88), Constant(value='s)', lineno=239, col_offset=88, end_lineno=239, end_col_offset=90)], lineno=239, col_offset=36, end_lineno=239, end_col_offset=91), lineno=239, col_offset=8, end_lineno=239, end_col_offset=91), Expr(value=Call(func=Name(id='print', ctx=Load(), lineno=241, col_offset=8, end_lineno=241, end_col_offset=13), args=[JoinedStr(values=[Constant(value='\nCorpus size: ', lineno=241, col_offset=16, end_lineno=241, end_col_offset=31), FormattedValue(value=Name(id='n_vectors', ctx=Load(), lineno=241, col_offset=32, end_lineno=241, end_col_offset=41), conversion=-1, lineno=241, col_offset=31, end_lineno=241, end_col_offset=42), Constant(value=' vectors', lineno=241, col_offset=42, end_lineno=241, end_col_offset=50)], lineno=241, col_offset=14, end_lineno=241, end_col_offset=51)], lineno=241, col_offset=8, end_lineno=241, end_col_offset=52), lineno=241, col_offset=8, end_lineno=241, end_col_offset=52), Expr(value=Call(func=Name(id='print', ctx=Load(), lineno=242, col_offset=8, end_lineno=242, end_col_offset=13), args=[JoinedStr(values=[Constant(value='  Training time: ', lineno=242, col_offset=16, end_lineno=242, end_col_offset=33), FormattedValue(value=Name(id='avg_time', ctx=Load(), lineno=242, col_offset=34, end_lineno=242, end_col_offset=42), conversion=-1, format_spec=JoinedStr(values=[Constant(value='.2f', lineno=242, col_offset=43, end_lineno=242, end_col_offset=46)], lineno=242, col_offset=42, end_lineno=242, end_col_offset=46), lineno=242, col_offset=33, end_lineno=242, end_col_offset=47), Constant(value='s (target: <', lineno=242, col_offset=47, end_lineno=242, end_col_offset=59), FormattedValue(value=Name(id='max_time', ctx=Load(), lineno=242, col_offset=60, end_lineno=242, end_col_offset=68), conversion=-1, lineno=242, col_offset=59, end_lineno=242, end_col_offset=69), Constant(value='s)', lineno=242, col_offset=69, end_lineno=242, end_col_offset=71)], lineno=242, col_offset=14, end_lineno=242, end_col_offset=72)], lineno=242, col_offset=8, end_lineno=242, end_col_offset=73), lineno=242, col_offset=8, end_lineno=242, end_col_offset=73)], lineno=224, col_offset=4, end_lineno=242, end_col_offset=73)], decorator_list=[Attribute(value=Attribute(value=Name(id='pytest', ctx=Load(), lineno=206, col_offset=1, end_lineno=206, end_col_offset=7), attr='mark', ctx=Load(), lineno=206, col_offset=1, end_lineno=206, end_col_offset=12), attr='benchmark', ctx=Load(), lineno=206, col_offset=1, end_lineno=206, end_col_offset=22)], returns=Constant(value=None, lineno=207, col_offset=67, end_lineno=207, end_col_offset=71), lineno=207, col_offset=0, end_lineno=242, end_col_offset=73)])