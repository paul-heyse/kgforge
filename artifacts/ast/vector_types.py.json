Module(body=[Expr(value=Constant(value='Typed vector contracts and validation helpers for vector ingestion.\n\nThis module centralises numpy vector typing so callers can construct and validate\nvector batches without leaking ``Any`` through numpy operations. All helpers\nreturn ``float32`` matrices and raise :class:`VectorValidationError` with rich\ncontext when inputs are malformed.\n\nExamples\n--------\n>>> from kgfoundry_common.vector_types import coerce_vector_batch\n>>> payload = [\n...     {"key": "doc-1", "vector": [0.1, 0.2, 0.3]},\n...     {"key": "doc-2", "vector": [0.4, 0.5, 0.6]},\n... ]\n>>> batch = coerce_vector_batch(payload)\n>>> batch.ids\n(VectorId(\'doc-1\'), VectorId(\'doc-2\'))\n>>> batch.matrix.dtype\ndtype(\'float32\')\n>>> batch.matrix.shape\n(2, 3)\n', lineno=1, col_offset=0, end_lineno=22, end_col_offset=3), lineno=1, col_offset=0, end_lineno=22, end_col_offset=3), ImportFrom(module='__future__', names=[alias(name='annotations', lineno=26, col_offset=23, end_lineno=26, end_col_offset=34)], level=0, lineno=26, col_offset=0, end_lineno=26, end_col_offset=34), ImportFrom(module='collections.abc', names=[alias(name='Mapping', lineno=28, col_offset=28, end_lineno=28, end_col_offset=35)], level=0, lineno=28, col_offset=0, end_lineno=28, end_col_offset=35), ImportFrom(module='dataclasses', names=[alias(name='dataclass', lineno=29, col_offset=24, end_lineno=29, end_col_offset=33)], level=0, lineno=29, col_offset=0, end_lineno=29, end_col_offset=33), ImportFrom(module='typing', names=[alias(name='TYPE_CHECKING', lineno=30, col_offset=19, end_lineno=30, end_col_offset=32), alias(name='Final', lineno=30, col_offset=34, end_lineno=30, end_col_offset=39), alias(name='NewType', lineno=30, col_offset=41, end_lineno=30, end_col_offset=48), alias(name='cast', lineno=30, col_offset=50, end_lineno=30, end_col_offset=54)], level=0, lineno=30, col_offset=0, end_lineno=30, end_col_offset=54), Import(names=[alias(name='numpy', asname='np', lineno=32, col_offset=7, end_lineno=32, end_col_offset=18)], lineno=32, col_offset=0, end_lineno=32, end_col_offset=18), ImportFrom(module='kgfoundry_common.navmap_loader', names=[alias(name='load_nav_metadata', lineno=34, col_offset=43, end_lineno=34, end_col_offset=60)], level=0, lineno=34, col_offset=0, end_lineno=34, end_col_offset=60), If(test=Name(id='TYPE_CHECKING', ctx=Load(), lineno=36, col_offset=3, end_lineno=36, end_col_offset=16), body=[ImportFrom(module='collections.abc', names=[alias(name='Iterable', lineno=37, col_offset=32, end_lineno=37, end_col_offset=40), alias(name='Sequence', lineno=37, col_offset=42, end_lineno=37, end_col_offset=50)], level=0, lineno=37, col_offset=4, end_lineno=37, end_col_offset=50), Import(names=[alias(name='numpy.typing', asname='npt', lineno=39, col_offset=11, end_lineno=39, end_col_offset=30)], lineno=39, col_offset=4, end_lineno=39, end_col_offset=30), TypeAlias(name=Name(id='VectorMatrix', ctx=Store(), lineno=41, col_offset=9, end_lineno=41, end_col_offset=21), value=Subscript(value=Attribute(value=Name(id='npt', ctx=Load(), lineno=41, col_offset=24, end_lineno=41, end_col_offset=27), attr='NDArray', ctx=Load(), lineno=41, col_offset=24, end_lineno=41, end_col_offset=35), slice=Attribute(value=Name(id='np', ctx=Load(), lineno=41, col_offset=36, end_lineno=41, end_col_offset=38), attr='float32', ctx=Load(), lineno=41, col_offset=36, end_lineno=41, end_col_offset=46), ctx=Load(), lineno=41, col_offset=24, end_lineno=41, end_col_offset=47), lineno=41, col_offset=4, end_lineno=41, end_col_offset=47)], orelse=[Assign(targets=[Name(id='VectorMatrix', ctx=Store(), lineno=43, col_offset=4, end_lineno=43, end_col_offset=16)], value=Attribute(value=Name(id='np', ctx=Load(), lineno=43, col_offset=19, end_lineno=43, end_col_offset=21), attr='ndarray', ctx=Load(), lineno=43, col_offset=19, end_lineno=43, end_col_offset=29), lineno=43, col_offset=4, end_lineno=43, end_col_offset=29)], lineno=36, col_offset=0, end_lineno=43, end_col_offset=29), AnnAssign(target=Name(id='VECTOR_MATRIX_NDIM', ctx=Store(), lineno=45, col_offset=0, end_lineno=45, end_col_offset=18), annotation=Subscript(value=Name(id='Final', ctx=Load(), lineno=45, col_offset=20, end_lineno=45, end_col_offset=25), slice=Name(id='int', ctx=Load(), lineno=45, col_offset=26, end_lineno=45, end_col_offset=29), ctx=Load(), lineno=45, col_offset=20, end_lineno=45, end_col_offset=30), value=Constant(value=2, lineno=45, col_offset=33, end_lineno=45, end_col_offset=34), simple=1, lineno=45, col_offset=0, end_lineno=45, end_col_offset=34), Expr(value=Constant(value='Expected number of dimensions for vector matrices.', lineno=46, col_offset=0, end_lineno=46, end_col_offset=56), lineno=46, col_offset=0, end_lineno=46, end_col_offset=56), Assign(targets=[Name(id='VectorId', ctx=Store(), lineno=50, col_offset=0, end_lineno=50, end_col_offset=8)], value=Call(func=Name(id='NewType', ctx=Load(), lineno=50, col_offset=11, end_lineno=50, end_col_offset=18), args=[Constant(value='VectorId', lineno=50, col_offset=19, end_lineno=50, end_col_offset=29), Name(id='str', ctx=Load(), lineno=50, col_offset=31, end_lineno=50, end_col_offset=34)], lineno=50, col_offset=11, end_lineno=50, end_col_offset=35), lineno=50, col_offset=0, end_lineno=50, end_col_offset=35), Expr(value=Constant(value='Unique identifier for a vector element.', lineno=51, col_offset=0, end_lineno=51, end_col_offset=45), lineno=51, col_offset=0, end_lineno=51, end_col_offset=45), ClassDef(name='VectorValidationError', bases=[Name(id='ValueError', ctx=Load(), lineno=55, col_offset=28, end_lineno=55, end_col_offset=38)], body=[Expr(value=Constant(value='Raised when vector payloads fail dtype, shape, or schema validation.\n\n    Initializes validation error with message and optional error details.\n\n    Parameters\n    ----------\n    message : str\n        Error message describing the validation failure.\n    errors : Sequence[str] | None, optional\n        List of validation error messages. Defaults to None.\n    ', lineno=56, col_offset=4, end_lineno=66, end_col_offset=7), lineno=56, col_offset=4, end_lineno=66, end_col_offset=7), FunctionDef(name='__init__', args=arguments(args=[arg(arg='self', lineno=68, col_offset=17, end_lineno=68, end_col_offset=21), arg(arg='message', annotation=Name(id='str', ctx=Load(), lineno=68, col_offset=32, end_lineno=68, end_col_offset=35), lineno=68, col_offset=23, end_lineno=68, end_col_offset=35)], kwonlyargs=[arg(arg='errors', annotation=BinOp(left=Subscript(value=Name(id='Sequence', ctx=Load(), lineno=68, col_offset=48, end_lineno=68, end_col_offset=56), slice=Name(id='str', ctx=Load(), lineno=68, col_offset=57, end_lineno=68, end_col_offset=60), ctx=Load(), lineno=68, col_offset=48, end_lineno=68, end_col_offset=61), op=BitOr(), right=Constant(value=None, lineno=68, col_offset=64, end_lineno=68, end_col_offset=68), lineno=68, col_offset=48, end_lineno=68, end_col_offset=68), lineno=68, col_offset=40, end_lineno=68, end_col_offset=68)], kw_defaults=[Constant(value=None, lineno=68, col_offset=71, end_lineno=68, end_col_offset=75)]), body=[Expr(value=Call(func=Attribute(value=Call(func=Name(id='super', ctx=Load(), lineno=69, col_offset=8, end_lineno=69, end_col_offset=13), lineno=69, col_offset=8, end_lineno=69, end_col_offset=15), attr='__init__', ctx=Load(), lineno=69, col_offset=8, end_lineno=69, end_col_offset=24), args=[Name(id='message', ctx=Load(), lineno=69, col_offset=25, end_lineno=69, end_col_offset=32)], lineno=69, col_offset=8, end_lineno=69, end_col_offset=33), lineno=69, col_offset=8, end_lineno=69, end_col_offset=33), AnnAssign(target=Attribute(value=Name(id='self', ctx=Load(), lineno=70, col_offset=8, end_lineno=70, end_col_offset=12), attr='errors', ctx=Store(), lineno=70, col_offset=8, end_lineno=70, end_col_offset=19), annotation=Subscript(value=Name(id='tuple', ctx=Load(), lineno=70, col_offset=21, end_lineno=70, end_col_offset=26), slice=Tuple(elts=[Name(id='str', ctx=Load(), lineno=70, col_offset=27, end_lineno=70, end_col_offset=30), Constant(value=Ellipsis, lineno=70, col_offset=32, end_lineno=70, end_col_offset=35)], ctx=Load(), lineno=70, col_offset=27, end_lineno=70, end_col_offset=35), ctx=Load(), lineno=70, col_offset=21, end_lineno=70, end_col_offset=36), value=Call(func=Name(id='tuple', ctx=Load(), lineno=70, col_offset=39, end_lineno=70, end_col_offset=44), args=[BoolOp(op=Or(), values=[Name(id='errors', ctx=Load(), lineno=70, col_offset=45, end_lineno=70, end_col_offset=51), Tuple(elts=[Name(id='message', ctx=Load(), lineno=70, col_offset=56, end_lineno=70, end_col_offset=63)], ctx=Load(), lineno=70, col_offset=55, end_lineno=70, end_col_offset=65)], lineno=70, col_offset=45, end_lineno=70, end_col_offset=65)], lineno=70, col_offset=39, end_lineno=70, end_col_offset=66), simple=0, lineno=70, col_offset=8, end_lineno=70, end_col_offset=66)], returns=Constant(value=None, lineno=68, col_offset=80, end_lineno=68, end_col_offset=84), lineno=68, col_offset=4, end_lineno=70, end_col_offset=66)], lineno=55, col_offset=0, end_lineno=70, end_col_offset=66), ClassDef(name='VectorBatch', body=[Expr(value=Constant(value='Immutable collection of typed vectors with shared dimensionality.\n\n    Attributes\n    ----------\n    ids : tuple[VectorId, ...]\n        Identifiers for each vector row.\n    matrix : VectorMatrix\n        Two-dimensional ``float32`` matrix.\n\n    Raises\n    ------\n    VectorValidationError\n        If the matrix is not two dimensional, contains zero-length vectors, or\n        the identifier count does not match the number of rows.\n    ', lineno=76, col_offset=4, end_lineno=90, end_col_offset=7), lineno=76, col_offset=4, end_lineno=90, end_col_offset=7), AnnAssign(target=Name(id='ids', ctx=Store(), lineno=92, col_offset=4, end_lineno=92, end_col_offset=7), annotation=Subscript(value=Name(id='tuple', ctx=Load(), lineno=92, col_offset=9, end_lineno=92, end_col_offset=14), slice=Tuple(elts=[Name(id='VectorId', ctx=Load(), lineno=92, col_offset=15, end_lineno=92, end_col_offset=23), Constant(value=Ellipsis, lineno=92, col_offset=25, end_lineno=92, end_col_offset=28)], ctx=Load(), lineno=92, col_offset=15, end_lineno=92, end_col_offset=28), ctx=Load(), lineno=92, col_offset=9, end_lineno=92, end_col_offset=29), simple=1, lineno=92, col_offset=4, end_lineno=92, end_col_offset=29), Expr(value=Constant(value='Identifiers for each vector row.\n\n    Alias: none; name ``ids``.\n    ', lineno=93, col_offset=4, end_lineno=96, end_col_offset=7), lineno=93, col_offset=4, end_lineno=96, end_col_offset=7), AnnAssign(target=Name(id='matrix', ctx=Store(), lineno=97, col_offset=4, end_lineno=97, end_col_offset=10), annotation=Name(id='VectorMatrix', ctx=Load(), lineno=97, col_offset=12, end_lineno=97, end_col_offset=24), simple=1, lineno=97, col_offset=4, end_lineno=97, end_col_offset=24), Expr(value=Constant(value='Two-dimensional ``float32`` matrix.\n\n    Alias: none; name ``matrix``.\n    ', lineno=98, col_offset=4, end_lineno=101, end_col_offset=7), lineno=98, col_offset=4, end_lineno=101, end_col_offset=7), FunctionDef(name='__post_init__', args=arguments(args=[arg(arg='self', lineno=103, col_offset=22, end_lineno=103, end_col_offset=26)]), body=[Expr(value=Constant(value='Normalise matrix representation without enforcing ids invariants.', lineno=104, col_offset=8, end_lineno=104, end_col_offset=79), lineno=104, col_offset=8, end_lineno=104, end_col_offset=79), Assign(targets=[Name(id='matrix', ctx=Store(), lineno=105, col_offset=8, end_lineno=105, end_col_offset=14)], value=Call(func=Name(id='assert_vector_matrix', ctx=Load(), lineno=105, col_offset=17, end_lineno=105, end_col_offset=37), args=[Attribute(value=Name(id='self', ctx=Load(), lineno=105, col_offset=38, end_lineno=105, end_col_offset=42), attr='matrix', ctx=Load(), lineno=105, col_offset=38, end_lineno=105, end_col_offset=49)], lineno=105, col_offset=17, end_lineno=105, end_col_offset=50), lineno=105, col_offset=8, end_lineno=105, end_col_offset=50), Expr(value=Call(func=Attribute(value=Name(id='object', ctx=Load(), lineno=106, col_offset=8, end_lineno=106, end_col_offset=14), attr='__setattr__', ctx=Load(), lineno=106, col_offset=8, end_lineno=106, end_col_offset=26), args=[Name(id='self', ctx=Load(), lineno=106, col_offset=27, end_lineno=106, end_col_offset=31), Constant(value='matrix', lineno=106, col_offset=33, end_lineno=106, end_col_offset=41), Name(id='matrix', ctx=Load(), lineno=106, col_offset=43, end_lineno=106, end_col_offset=49)], lineno=106, col_offset=8, end_lineno=106, end_col_offset=50), lineno=106, col_offset=8, end_lineno=106, end_col_offset=50)], returns=Constant(value=None, lineno=103, col_offset=31, end_lineno=103, end_col_offset=35), lineno=103, col_offset=4, end_lineno=106, end_col_offset=50), FunctionDef(name='dimension', args=arguments(args=[arg(arg='self', lineno=109, col_offset=18, end_lineno=109, end_col_offset=22)]), body=[Expr(value=Constant(value='Return the dimensionality shared by all vectors in the batch.', lineno=110, col_offset=8, end_lineno=110, end_col_offset=75), lineno=110, col_offset=8, end_lineno=110, end_col_offset=75), Return(value=Call(func=Name(id='int', ctx=Load(), lineno=111, col_offset=15, end_lineno=111, end_col_offset=18), args=[Subscript(value=Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=111, col_offset=19, end_lineno=111, end_col_offset=23), attr='matrix', ctx=Load(), lineno=111, col_offset=19, end_lineno=111, end_col_offset=30), attr='shape', ctx=Load(), lineno=111, col_offset=19, end_lineno=111, end_col_offset=36), slice=Constant(value=1, lineno=111, col_offset=37, end_lineno=111, end_col_offset=38), ctx=Load(), lineno=111, col_offset=19, end_lineno=111, end_col_offset=39)], lineno=111, col_offset=15, end_lineno=111, end_col_offset=40), lineno=111, col_offset=8, end_lineno=111, end_col_offset=40)], decorator_list=[Name(id='property', ctx=Load(), lineno=108, col_offset=5, end_lineno=108, end_col_offset=13)], returns=Name(id='int', ctx=Load(), lineno=109, col_offset=27, end_lineno=109, end_col_offset=30), lineno=109, col_offset=4, end_lineno=111, end_col_offset=40), FunctionDef(name='count', args=arguments(args=[arg(arg='self', lineno=114, col_offset=14, end_lineno=114, end_col_offset=18)]), body=[Expr(value=Constant(value='Return the number of vectors contained in the batch.', lineno=115, col_offset=8, end_lineno=115, end_col_offset=66), lineno=115, col_offset=8, end_lineno=115, end_col_offset=66), Return(value=Call(func=Name(id='len', ctx=Load(), lineno=116, col_offset=15, end_lineno=116, end_col_offset=18), args=[Attribute(value=Name(id='self', ctx=Load(), lineno=116, col_offset=19, end_lineno=116, end_col_offset=23), attr='ids', ctx=Load(), lineno=116, col_offset=19, end_lineno=116, end_col_offset=27)], lineno=116, col_offset=15, end_lineno=116, end_col_offset=28), lineno=116, col_offset=8, end_lineno=116, end_col_offset=28)], decorator_list=[Name(id='property', ctx=Load(), lineno=113, col_offset=5, end_lineno=113, end_col_offset=13)], returns=Name(id='int', ctx=Load(), lineno=114, col_offset=23, end_lineno=114, end_col_offset=26), lineno=114, col_offset=4, end_lineno=116, end_col_offset=28)], decorator_list=[Call(func=Name(id='dataclass', ctx=Load(), lineno=73, col_offset=1, end_lineno=73, end_col_offset=10), keywords=[keyword(arg='frozen', value=Constant(value=True, lineno=73, col_offset=18, end_lineno=73, end_col_offset=22), lineno=73, col_offset=11, end_lineno=73, end_col_offset=22), keyword(arg='slots', value=Constant(value=True, lineno=73, col_offset=30, end_lineno=73, end_col_offset=34), lineno=73, col_offset=24, end_lineno=73, end_col_offset=34)], lineno=73, col_offset=1, end_lineno=73, end_col_offset=35)], lineno=75, col_offset=0, end_lineno=116, end_col_offset=28), FunctionDef(name='assert_vector_matrix', args=arguments(args=[arg(arg='arr', annotation=Name(id='object', ctx=Load(), lineno=120, col_offset=30, end_lineno=120, end_col_offset=36), lineno=120, col_offset=25, end_lineno=120, end_col_offset=36)]), body=[Expr(value=Constant(value='Return a contiguous ``float32`` matrix derived from ``arr``.\n\n    Parameters\n    ----------\n    arr : object\n        Candidate matrix to validate.\n\n    Returns\n    -------\n    VectorMatrix\n        Contiguous ``float32`` matrix with two dimensions.\n\n    Raises\n    ------\n    VectorValidationError\n        If ``arr`` cannot be coerced to a two-dimensional ``float32`` matrix\n        with a non-zero second dimension.\n    ', lineno=121, col_offset=4, end_lineno=138, end_col_offset=7), lineno=121, col_offset=4, end_lineno=138, end_col_offset=7), Try(body=[Assign(targets=[Name(id='matrix', ctx=Store(), lineno=140, col_offset=8, end_lineno=140, end_col_offset=14)], value=Call(func=Attribute(value=Name(id='np', ctx=Load(), lineno=140, col_offset=17, end_lineno=140, end_col_offset=19), attr='asarray', ctx=Load(), lineno=140, col_offset=17, end_lineno=140, end_col_offset=27), args=[Name(id='arr', ctx=Load(), lineno=140, col_offset=28, end_lineno=140, end_col_offset=31)], keywords=[keyword(arg='dtype', value=Attribute(value=Name(id='np', ctx=Load(), lineno=140, col_offset=39, end_lineno=140, end_col_offset=41), attr='float32', ctx=Load(), lineno=140, col_offset=39, end_lineno=140, end_col_offset=49), lineno=140, col_offset=33, end_lineno=140, end_col_offset=49)], lineno=140, col_offset=17, end_lineno=140, end_col_offset=50), lineno=140, col_offset=8, end_lineno=140, end_col_offset=50)], handlers=[ExceptHandler(type=Tuple(elts=[Name(id='TypeError', ctx=Load(), lineno=141, col_offset=12, end_lineno=141, end_col_offset=21), Name(id='ValueError', ctx=Load(), lineno=141, col_offset=23, end_lineno=141, end_col_offset=33)], ctx=Load(), lineno=141, col_offset=11, end_lineno=141, end_col_offset=34), name='exc', body=[Assign(targets=[Name(id='msg', ctx=Store(), lineno=142, col_offset=8, end_lineno=142, end_col_offset=11)], value=Constant(value='Matrix values must be numeric', lineno=142, col_offset=14, end_lineno=142, end_col_offset=45), lineno=142, col_offset=8, end_lineno=142, end_col_offset=45), Raise(exc=Call(func=Name(id='VectorValidationError', ctx=Load(), lineno=143, col_offset=14, end_lineno=143, end_col_offset=35), args=[Name(id='msg', ctx=Load(), lineno=143, col_offset=36, end_lineno=143, end_col_offset=39)], lineno=143, col_offset=14, end_lineno=143, end_col_offset=40), cause=Name(id='exc', ctx=Load(), lineno=143, col_offset=46, end_lineno=143, end_col_offset=49), lineno=143, col_offset=8, end_lineno=143, end_col_offset=49)], lineno=141, col_offset=4, end_lineno=143, end_col_offset=49)], lineno=139, col_offset=4, end_lineno=143, end_col_offset=49), If(test=Compare(left=Attribute(value=Name(id='matrix', ctx=Load(), lineno=145, col_offset=7, end_lineno=145, end_col_offset=13), attr='ndim', ctx=Load(), lineno=145, col_offset=7, end_lineno=145, end_col_offset=18), ops=[NotEq()], comparators=[Name(id='VECTOR_MATRIX_NDIM', ctx=Load(), lineno=145, col_offset=22, end_lineno=145, end_col_offset=40)], lineno=145, col_offset=7, end_lineno=145, end_col_offset=40), body=[Assign(targets=[Name(id='msg', ctx=Store(), lineno=146, col_offset=8, end_lineno=146, end_col_offset=11)], value=Constant(value='Vector matrix must be two-dimensional', lineno=146, col_offset=14, end_lineno=146, end_col_offset=53), lineno=146, col_offset=8, end_lineno=146, end_col_offset=53), Raise(exc=Call(func=Name(id='VectorValidationError', ctx=Load(), lineno=147, col_offset=14, end_lineno=147, end_col_offset=35), args=[Name(id='msg', ctx=Load(), lineno=147, col_offset=36, end_lineno=147, end_col_offset=39)], lineno=147, col_offset=14, end_lineno=147, end_col_offset=40), lineno=147, col_offset=8, end_lineno=147, end_col_offset=40)], lineno=145, col_offset=4, end_lineno=147, end_col_offset=40), If(test=Compare(left=Subscript(value=Attribute(value=Name(id='matrix', ctx=Load(), lineno=148, col_offset=7, end_lineno=148, end_col_offset=13), attr='shape', ctx=Load(), lineno=148, col_offset=7, end_lineno=148, end_col_offset=19), slice=Constant(value=1, lineno=148, col_offset=20, end_lineno=148, end_col_offset=21), ctx=Load(), lineno=148, col_offset=7, end_lineno=148, end_col_offset=22), ops=[Eq()], comparators=[Constant(value=0, lineno=148, col_offset=26, end_lineno=148, end_col_offset=27)], lineno=148, col_offset=7, end_lineno=148, end_col_offset=27), body=[Assign(targets=[Name(id='msg', ctx=Store(), lineno=149, col_offset=8, end_lineno=149, end_col_offset=11)], value=Constant(value='Vector dimensionality must be greater than zero', lineno=149, col_offset=14, end_lineno=149, end_col_offset=63), lineno=149, col_offset=8, end_lineno=149, end_col_offset=63), Raise(exc=Call(func=Name(id='VectorValidationError', ctx=Load(), lineno=150, col_offset=14, end_lineno=150, end_col_offset=35), args=[Name(id='msg', ctx=Load(), lineno=150, col_offset=36, end_lineno=150, end_col_offset=39)], lineno=150, col_offset=14, end_lineno=150, end_col_offset=40), lineno=150, col_offset=8, end_lineno=150, end_col_offset=40)], lineno=148, col_offset=4, end_lineno=150, end_col_offset=40), AnnAssign(target=Name(id='contiguous', ctx=Store(), lineno=152, col_offset=4, end_lineno=152, end_col_offset=14), annotation=Name(id='VectorMatrix', ctx=Load(), lineno=152, col_offset=16, end_lineno=152, end_col_offset=28), value=Call(func=Attribute(value=Name(id='np', ctx=Load(), lineno=152, col_offset=31, end_lineno=152, end_col_offset=33), attr='ascontiguousarray', ctx=Load(), lineno=152, col_offset=31, end_lineno=152, end_col_offset=51), args=[Name(id='matrix', ctx=Load(), lineno=152, col_offset=52, end_lineno=152, end_col_offset=58)], keywords=[keyword(arg='dtype', value=Attribute(value=Name(id='np', ctx=Load(), lineno=152, col_offset=66, end_lineno=152, end_col_offset=68), attr='float32', ctx=Load(), lineno=152, col_offset=66, end_lineno=152, end_col_offset=76), lineno=152, col_offset=60, end_lineno=152, end_col_offset=76)], lineno=152, col_offset=31, end_lineno=152, end_col_offset=77), simple=1, lineno=152, col_offset=4, end_lineno=152, end_col_offset=77), Return(value=Name(id='contiguous', ctx=Load(), lineno=153, col_offset=11, end_lineno=153, end_col_offset=21), lineno=153, col_offset=4, end_lineno=153, end_col_offset=21)], returns=Name(id='VectorMatrix', ctx=Load(), lineno=120, col_offset=41, end_lineno=120, end_col_offset=53), lineno=120, col_offset=0, end_lineno=153, end_col_offset=21), FunctionDef(name='validate_vector_batch', args=arguments(args=[arg(arg='batch', annotation=Name(id='VectorBatch', ctx=Load(), lineno=157, col_offset=33, end_lineno=157, end_col_offset=44), lineno=157, col_offset=26, end_lineno=157, end_col_offset=44)]), body=[Expr(value=Constant(value='Return ``batch`` after re-validating matrix invariants.\n\n    Parameters\n    ----------\n    batch : VectorBatch\n        Candidate batch to validate.\n\n    Returns\n    -------\n    VectorBatch\n        The same batch once validation succeeds.\n\n    Raises\n    ------\n    VectorValidationError\n        If the batch has mismatched ids or inconsistent vector dimensions.\n    ', lineno=158, col_offset=4, end_lineno=174, end_col_offset=7), lineno=158, col_offset=4, end_lineno=174, end_col_offset=7), Assign(targets=[Name(id='matrix', ctx=Store(), lineno=175, col_offset=4, end_lineno=175, end_col_offset=10)], value=Call(func=Name(id='assert_vector_matrix', ctx=Load(), lineno=175, col_offset=13, end_lineno=175, end_col_offset=33), args=[Attribute(value=Name(id='batch', ctx=Load(), lineno=175, col_offset=34, end_lineno=175, end_col_offset=39), attr='matrix', ctx=Load(), lineno=175, col_offset=34, end_lineno=175, end_col_offset=46)], lineno=175, col_offset=13, end_lineno=175, end_col_offset=47), lineno=175, col_offset=4, end_lineno=175, end_col_offset=47), If(test=Compare(left=Subscript(value=Attribute(value=Name(id='matrix', ctx=Load(), lineno=176, col_offset=7, end_lineno=176, end_col_offset=13), attr='shape', ctx=Load(), lineno=176, col_offset=7, end_lineno=176, end_col_offset=19), slice=Constant(value=0, lineno=176, col_offset=20, end_lineno=176, end_col_offset=21), ctx=Load(), lineno=176, col_offset=7, end_lineno=176, end_col_offset=22), ops=[NotEq()], comparators=[Call(func=Name(id='len', ctx=Load(), lineno=176, col_offset=26, end_lineno=176, end_col_offset=29), args=[Attribute(value=Name(id='batch', ctx=Load(), lineno=176, col_offset=30, end_lineno=176, end_col_offset=35), attr='ids', ctx=Load(), lineno=176, col_offset=30, end_lineno=176, end_col_offset=39)], lineno=176, col_offset=26, end_lineno=176, end_col_offset=40)], lineno=176, col_offset=7, end_lineno=176, end_col_offset=40), body=[Assign(targets=[Name(id='msg', ctx=Store(), lineno=177, col_offset=8, end_lineno=177, end_col_offset=11)], value=JoinedStr(values=[Constant(value='Vector id count must match matrix row count: ', lineno=178, col_offset=12, end_lineno=178, end_col_offset=59), FormattedValue(value=Call(func=Name(id='len', ctx=Load(), lineno=179, col_offset=15, end_lineno=179, end_col_offset=18), args=[Attribute(value=Name(id='batch', ctx=Load(), lineno=179, col_offset=19, end_lineno=179, end_col_offset=24), attr='ids', ctx=Load(), lineno=179, col_offset=19, end_lineno=179, end_col_offset=28)], lineno=179, col_offset=15, end_lineno=179, end_col_offset=29), conversion=-1, lineno=179, col_offset=14, end_lineno=179, end_col_offset=30), Constant(value=' ids vs ', lineno=179, col_offset=30, end_lineno=179, end_col_offset=38), FormattedValue(value=Subscript(value=Attribute(value=Name(id='matrix', ctx=Load(), lineno=179, col_offset=39, end_lineno=179, end_col_offset=45), attr='shape', ctx=Load(), lineno=179, col_offset=39, end_lineno=179, end_col_offset=51), slice=Constant(value=0, lineno=179, col_offset=52, end_lineno=179, end_col_offset=53), ctx=Load(), lineno=179, col_offset=39, end_lineno=179, end_col_offset=54), conversion=-1, lineno=179, col_offset=38, end_lineno=179, end_col_offset=55), Constant(value=' rows', lineno=179, col_offset=55, end_lineno=179, end_col_offset=60)], lineno=178, col_offset=12, end_lineno=179, end_col_offset=61), lineno=177, col_offset=8, end_lineno=180, end_col_offset=9), Raise(exc=Call(func=Name(id='VectorValidationError', ctx=Load(), lineno=181, col_offset=14, end_lineno=181, end_col_offset=35), args=[Name(id='msg', ctx=Load(), lineno=181, col_offset=36, end_lineno=181, end_col_offset=39)], lineno=181, col_offset=14, end_lineno=181, end_col_offset=40), lineno=181, col_offset=8, end_lineno=181, end_col_offset=40)], lineno=176, col_offset=4, end_lineno=181, end_col_offset=40), If(test=Compare(left=Subscript(value=Attribute(value=Name(id='matrix', ctx=Load(), lineno=182, col_offset=7, end_lineno=182, end_col_offset=13), attr='shape', ctx=Load(), lineno=182, col_offset=7, end_lineno=182, end_col_offset=19), slice=Constant(value=1, lineno=182, col_offset=20, end_lineno=182, end_col_offset=21), ctx=Load(), lineno=182, col_offset=7, end_lineno=182, end_col_offset=22), ops=[Eq()], comparators=[Constant(value=0, lineno=182, col_offset=26, end_lineno=182, end_col_offset=27)], lineno=182, col_offset=7, end_lineno=182, end_col_offset=27), body=[Assign(targets=[Name(id='msg', ctx=Store(), lineno=183, col_offset=8, end_lineno=183, end_col_offset=11)], value=Constant(value='Vector dimensionality must be greater than zero', lineno=183, col_offset=14, end_lineno=183, end_col_offset=63), lineno=183, col_offset=8, end_lineno=183, end_col_offset=63), Raise(exc=Call(func=Name(id='VectorValidationError', ctx=Load(), lineno=184, col_offset=14, end_lineno=184, end_col_offset=35), args=[Name(id='msg', ctx=Load(), lineno=184, col_offset=36, end_lineno=184, end_col_offset=39)], lineno=184, col_offset=14, end_lineno=184, end_col_offset=40), lineno=184, col_offset=8, end_lineno=184, end_col_offset=40)], lineno=182, col_offset=4, end_lineno=184, end_col_offset=40), If(test=Compare(left=Call(func=Name(id='len', ctx=Load(), lineno=185, col_offset=7, end_lineno=185, end_col_offset=10), args=[Call(func=Name(id='set', ctx=Load(), lineno=185, col_offset=11, end_lineno=185, end_col_offset=14), args=[Attribute(value=Name(id='batch', ctx=Load(), lineno=185, col_offset=15, end_lineno=185, end_col_offset=20), attr='ids', ctx=Load(), lineno=185, col_offset=15, end_lineno=185, end_col_offset=24)], lineno=185, col_offset=11, end_lineno=185, end_col_offset=25)], lineno=185, col_offset=7, end_lineno=185, end_col_offset=26), ops=[NotEq()], comparators=[Call(func=Name(id='len', ctx=Load(), lineno=185, col_offset=30, end_lineno=185, end_col_offset=33), args=[Attribute(value=Name(id='batch', ctx=Load(), lineno=185, col_offset=34, end_lineno=185, end_col_offset=39), attr='ids', ctx=Load(), lineno=185, col_offset=34, end_lineno=185, end_col_offset=43)], lineno=185, col_offset=30, end_lineno=185, end_col_offset=44)], lineno=185, col_offset=7, end_lineno=185, end_col_offset=44), body=[Assign(targets=[Name(id='msg', ctx=Store(), lineno=186, col_offset=8, end_lineno=186, end_col_offset=11)], value=Constant(value='Vector ids must be unique', lineno=186, col_offset=14, end_lineno=186, end_col_offset=41), lineno=186, col_offset=8, end_lineno=186, end_col_offset=41), Raise(exc=Call(func=Name(id='VectorValidationError', ctx=Load(), lineno=187, col_offset=14, end_lineno=187, end_col_offset=35), args=[Name(id='msg', ctx=Load(), lineno=187, col_offset=36, end_lineno=187, end_col_offset=39)], lineno=187, col_offset=14, end_lineno=187, end_col_offset=40), lineno=187, col_offset=8, end_lineno=187, end_col_offset=40)], lineno=185, col_offset=4, end_lineno=187, end_col_offset=40), Return(value=Name(id='batch', ctx=Load(), lineno=188, col_offset=11, end_lineno=188, end_col_offset=16), lineno=188, col_offset=4, end_lineno=188, end_col_offset=16)], returns=Name(id='VectorBatch', ctx=Load(), lineno=157, col_offset=49, end_lineno=157, end_col_offset=60), lineno=157, col_offset=0, end_lineno=188, end_col_offset=16), FunctionDef(name='coerce_vector_batch', args=arguments(args=[arg(arg='records', annotation=Subscript(value=Name(id='Iterable', ctx=Load(), lineno=192, col_offset=33, end_lineno=192, end_col_offset=41), slice=Name(id='object', ctx=Load(), lineno=192, col_offset=42, end_lineno=192, end_col_offset=48), ctx=Load(), lineno=192, col_offset=33, end_lineno=192, end_col_offset=49), lineno=192, col_offset=24, end_lineno=192, end_col_offset=49)]), body=[Expr(value=Constant(value='Construct a :class:`VectorBatch` from vector payload mappings.\n\n    Parameters\n    ----------\n    records : Iterable[object]\n        Iterable of JSON-like mappings containing ``"key"`` and ``"vector"``\n        entries. ``"vector"`` must be a one-dimensional sequence of numbers.\n\n    Returns\n    -------\n    VectorBatch\n        Immutable batch containing unique ids and a contiguous ``float32``\n        matrix.\n\n    Raises\n    ------\n    VectorValidationError\n        If a record is not a mapping, ids are missing/duplicated, vectors are\n        empty, non-numeric, or have inconsistent dimensionality.\n\n    Examples\n    --------\n    >>> from kgfoundry_common.vector_types import coerce_vector_batch\n    >>> batch = coerce_vector_batch(\n    ...     [\n    ...         {"key": "a", "vector": [1, 2]},\n    ...         {"key": "b", "vector": [3, 4]},\n    ...     ]\n    ... )\n    >>> batch.matrix.dtype\n    dtype(\'float32\')\n    >>> batch.matrix.shape\n    (2, 2)\n    ', lineno=193, col_offset=4, end_lineno=226, end_col_offset=7), lineno=193, col_offset=4, end_lineno=226, end_col_offset=7), AnnAssign(target=Name(id='ids', ctx=Store(), lineno=227, col_offset=4, end_lineno=227, end_col_offset=7), annotation=Subscript(value=Name(id='list', ctx=Load(), lineno=227, col_offset=9, end_lineno=227, end_col_offset=13), slice=Name(id='VectorId', ctx=Load(), lineno=227, col_offset=14, end_lineno=227, end_col_offset=22), ctx=Load(), lineno=227, col_offset=9, end_lineno=227, end_col_offset=23), value=List(ctx=Load(), lineno=227, col_offset=26, end_lineno=227, end_col_offset=28), simple=1, lineno=227, col_offset=4, end_lineno=227, end_col_offset=28), AnnAssign(target=Name(id='seen_ids', ctx=Store(), lineno=228, col_offset=4, end_lineno=228, end_col_offset=12), annotation=Subscript(value=Name(id='set', ctx=Load(), lineno=228, col_offset=14, end_lineno=228, end_col_offset=17), slice=Name(id='VectorId', ctx=Load(), lineno=228, col_offset=18, end_lineno=228, end_col_offset=26), ctx=Load(), lineno=228, col_offset=14, end_lineno=228, end_col_offset=27), value=Call(func=Name(id='set', ctx=Load(), lineno=228, col_offset=30, end_lineno=228, end_col_offset=33), lineno=228, col_offset=30, end_lineno=228, end_col_offset=35), simple=1, lineno=228, col_offset=4, end_lineno=228, end_col_offset=35), AnnAssign(target=Name(id='vectors', ctx=Store(), lineno=229, col_offset=4, end_lineno=229, end_col_offset=11), annotation=Subscript(value=Name(id='list', ctx=Load(), lineno=229, col_offset=13, end_lineno=229, end_col_offset=17), slice=Subscript(value=Name(id='list', ctx=Load(), lineno=229, col_offset=18, end_lineno=229, end_col_offset=22), slice=Name(id='float', ctx=Load(), lineno=229, col_offset=23, end_lineno=229, end_col_offset=28), ctx=Load(), lineno=229, col_offset=18, end_lineno=229, end_col_offset=29), ctx=Load(), lineno=229, col_offset=13, end_lineno=229, end_col_offset=30), value=List(ctx=Load(), lineno=229, col_offset=33, end_lineno=229, end_col_offset=35), simple=1, lineno=229, col_offset=4, end_lineno=229, end_col_offset=35), AnnAssign(target=Name(id='expected_dim', ctx=Store(), lineno=230, col_offset=4, end_lineno=230, end_col_offset=16), annotation=BinOp(left=Name(id='int', ctx=Load(), lineno=230, col_offset=18, end_lineno=230, end_col_offset=21), op=BitOr(), right=Constant(value=None, lineno=230, col_offset=24, end_lineno=230, end_col_offset=28), lineno=230, col_offset=18, end_lineno=230, end_col_offset=28), value=Constant(value=None, lineno=230, col_offset=31, end_lineno=230, end_col_offset=35), simple=1, lineno=230, col_offset=4, end_lineno=230, end_col_offset=35), For(target=Tuple(elts=[Name(id='idx', ctx=Store(), lineno=232, col_offset=8, end_lineno=232, end_col_offset=11), Name(id='record_obj', ctx=Store(), lineno=232, col_offset=13, end_lineno=232, end_col_offset=23)], ctx=Store(), lineno=232, col_offset=8, end_lineno=232, end_col_offset=23), iter=Call(func=Name(id='enumerate', ctx=Load(), lineno=232, col_offset=27, end_lineno=232, end_col_offset=36), args=[Name(id='records', ctx=Load(), lineno=232, col_offset=37, end_lineno=232, end_col_offset=44)], lineno=232, col_offset=27, end_lineno=232, end_col_offset=45), body=[If(test=UnaryOp(op=Not(), operand=Call(func=Name(id='isinstance', ctx=Load(), lineno=233, col_offset=15, end_lineno=233, end_col_offset=25), args=[Name(id='record_obj', ctx=Load(), lineno=233, col_offset=26, end_lineno=233, end_col_offset=36), Name(id='Mapping', ctx=Load(), lineno=233, col_offset=38, end_lineno=233, end_col_offset=45)], lineno=233, col_offset=15, end_lineno=233, end_col_offset=46), lineno=233, col_offset=11, end_lineno=233, end_col_offset=46), body=[Assign(targets=[Name(id='msg', ctx=Store(), lineno=234, col_offset=12, end_lineno=234, end_col_offset=15)], value=JoinedStr(values=[Constant(value='Record ', lineno=234, col_offset=20, end_lineno=234, end_col_offset=27), FormattedValue(value=Name(id='idx', ctx=Load(), lineno=234, col_offset=28, end_lineno=234, end_col_offset=31), conversion=-1, lineno=234, col_offset=27, end_lineno=234, end_col_offset=32), Constant(value=" is missing a non-empty 'key' string", lineno=234, col_offset=32, end_lineno=234, end_col_offset=68)], lineno=234, col_offset=18, end_lineno=234, end_col_offset=69), lineno=234, col_offset=12, end_lineno=234, end_col_offset=69), Raise(exc=Call(func=Name(id='VectorValidationError', ctx=Load(), lineno=235, col_offset=18, end_lineno=235, end_col_offset=39), args=[Name(id='msg', ctx=Load(), lineno=235, col_offset=40, end_lineno=235, end_col_offset=43)], lineno=235, col_offset=18, end_lineno=235, end_col_offset=44), lineno=235, col_offset=12, end_lineno=235, end_col_offset=44)], lineno=233, col_offset=8, end_lineno=235, end_col_offset=44), Assign(targets=[Name(id='record', ctx=Store(), lineno=236, col_offset=8, end_lineno=236, end_col_offset=14)], value=Name(id='record_obj', ctx=Load(), lineno=236, col_offset=17, end_lineno=236, end_col_offset=27), lineno=236, col_offset=8, end_lineno=236, end_col_offset=27), Assign(targets=[Name(id='raw_key', ctx=Store(), lineno=237, col_offset=8, end_lineno=237, end_col_offset=15)], value=Call(func=Attribute(value=Name(id='record', ctx=Load(), lineno=237, col_offset=18, end_lineno=237, end_col_offset=24), attr='get', ctx=Load(), lineno=237, col_offset=18, end_lineno=237, end_col_offset=28), args=[Constant(value='key', lineno=237, col_offset=29, end_lineno=237, end_col_offset=34)], lineno=237, col_offset=18, end_lineno=237, end_col_offset=35), lineno=237, col_offset=8, end_lineno=237, end_col_offset=35), If(test=BoolOp(op=Or(), values=[UnaryOp(op=Not(), operand=Call(func=Name(id='isinstance', ctx=Load(), lineno=238, col_offset=15, end_lineno=238, end_col_offset=25), args=[Name(id='raw_key', ctx=Load(), lineno=238, col_offset=26, end_lineno=238, end_col_offset=33), Name(id='str', ctx=Load(), lineno=238, col_offset=35, end_lineno=238, end_col_offset=38)], lineno=238, col_offset=15, end_lineno=238, end_col_offset=39), lineno=238, col_offset=11, end_lineno=238, end_col_offset=39), UnaryOp(op=Not(), operand=Call(func=Attribute(value=Name(id='raw_key', ctx=Load(), lineno=238, col_offset=47, end_lineno=238, end_col_offset=54), attr='strip', ctx=Load(), lineno=238, col_offset=47, end_lineno=238, end_col_offset=60), lineno=238, col_offset=47, end_lineno=238, end_col_offset=62), lineno=238, col_offset=43, end_lineno=238, end_col_offset=62)], lineno=238, col_offset=11, end_lineno=238, end_col_offset=62), body=[Assign(targets=[Name(id='msg', ctx=Store(), lineno=239, col_offset=12, end_lineno=239, end_col_offset=15)], value=JoinedStr(values=[Constant(value='Record ', lineno=239, col_offset=20, end_lineno=239, end_col_offset=27), FormattedValue(value=Name(id='idx', ctx=Load(), lineno=239, col_offset=28, end_lineno=239, end_col_offset=31), conversion=-1, lineno=239, col_offset=27, end_lineno=239, end_col_offset=32), Constant(value=" is missing a non-empty 'key' string", lineno=239, col_offset=32, end_lineno=239, end_col_offset=68)], lineno=239, col_offset=18, end_lineno=239, end_col_offset=69), lineno=239, col_offset=12, end_lineno=239, end_col_offset=69), Raise(exc=Call(func=Name(id='VectorValidationError', ctx=Load(), lineno=240, col_offset=18, end_lineno=240, end_col_offset=39), args=[Name(id='msg', ctx=Load(), lineno=240, col_offset=40, end_lineno=240, end_col_offset=43)], lineno=240, col_offset=18, end_lineno=240, end_col_offset=44), lineno=240, col_offset=12, end_lineno=240, end_col_offset=44)], lineno=238, col_offset=8, end_lineno=240, end_col_offset=44), Assign(targets=[Name(id='vector_obj', ctx=Store(), lineno=242, col_offset=8, end_lineno=242, end_col_offset=18)], value=Call(func=Attribute(value=Name(id='record', ctx=Load(), lineno=242, col_offset=21, end_lineno=242, end_col_offset=27), attr='get', ctx=Load(), lineno=242, col_offset=21, end_lineno=242, end_col_offset=31), args=[Constant(value='vector', lineno=242, col_offset=32, end_lineno=242, end_col_offset=40)], lineno=242, col_offset=21, end_lineno=242, end_col_offset=41), lineno=242, col_offset=8, end_lineno=242, end_col_offset=41), Assign(targets=[Name(id='row', ctx=Store(), lineno=243, col_offset=8, end_lineno=243, end_col_offset=11)], value=Call(func=Name(id='_coerce_vector_row', ctx=Load(), lineno=243, col_offset=14, end_lineno=243, end_col_offset=32), args=[Name(id='vector_obj', ctx=Load(), lineno=243, col_offset=33, end_lineno=243, end_col_offset=43), Name(id='idx', ctx=Load(), lineno=243, col_offset=45, end_lineno=243, end_col_offset=48)], lineno=243, col_offset=14, end_lineno=243, end_col_offset=49), lineno=243, col_offset=8, end_lineno=243, end_col_offset=49), If(test=Compare(left=Name(id='expected_dim', ctx=Load(), lineno=245, col_offset=11, end_lineno=245, end_col_offset=23), ops=[Is()], comparators=[Constant(value=None, lineno=245, col_offset=27, end_lineno=245, end_col_offset=31)], lineno=245, col_offset=11, end_lineno=245, end_col_offset=31), body=[Assign(targets=[Name(id='expected_dim', ctx=Store(), lineno=246, col_offset=12, end_lineno=246, end_col_offset=24)], value=Call(func=Name(id='len', ctx=Load(), lineno=246, col_offset=27, end_lineno=246, end_col_offset=30), args=[Name(id='row', ctx=Load(), lineno=246, col_offset=31, end_lineno=246, end_col_offset=34)], lineno=246, col_offset=27, end_lineno=246, end_col_offset=35), lineno=246, col_offset=12, end_lineno=246, end_col_offset=35)], orelse=[If(test=Compare(left=Call(func=Name(id='len', ctx=Load(), lineno=247, col_offset=13, end_lineno=247, end_col_offset=16), args=[Name(id='row', ctx=Load(), lineno=247, col_offset=17, end_lineno=247, end_col_offset=20)], lineno=247, col_offset=13, end_lineno=247, end_col_offset=21), ops=[NotEq()], comparators=[Name(id='expected_dim', ctx=Load(), lineno=247, col_offset=25, end_lineno=247, end_col_offset=37)], lineno=247, col_offset=13, end_lineno=247, end_col_offset=37), body=[Assign(targets=[Name(id='msg', ctx=Store(), lineno=248, col_offset=12, end_lineno=248, end_col_offset=15)], value=JoinedStr(values=[Constant(value='Record ', lineno=249, col_offset=18, end_lineno=249, end_col_offset=25), FormattedValue(value=Name(id='idx', ctx=Load(), lineno=249, col_offset=26, end_lineno=249, end_col_offset=29), conversion=-1, lineno=249, col_offset=25, end_lineno=249, end_col_offset=30), Constant(value=' has dimension ', lineno=249, col_offset=30, end_lineno=249, end_col_offset=45), FormattedValue(value=Call(func=Name(id='len', ctx=Load(), lineno=249, col_offset=46, end_lineno=249, end_col_offset=49), args=[Name(id='row', ctx=Load(), lineno=249, col_offset=50, end_lineno=249, end_col_offset=53)], lineno=249, col_offset=46, end_lineno=249, end_col_offset=54), conversion=-1, lineno=249, col_offset=45, end_lineno=249, end_col_offset=55), Constant(value=' which differs from the expected dimension ', lineno=249, col_offset=55, end_lineno=250, end_col_offset=37), FormattedValue(value=Name(id='expected_dim', ctx=Load(), lineno=250, col_offset=38, end_lineno=250, end_col_offset=50), conversion=-1, lineno=250, col_offset=37, end_lineno=250, end_col_offset=51)], lineno=249, col_offset=16, end_lineno=250, end_col_offset=52), lineno=248, col_offset=12, end_lineno=251, end_col_offset=13), Raise(exc=Call(func=Name(id='VectorValidationError', ctx=Load(), lineno=252, col_offset=18, end_lineno=252, end_col_offset=39), args=[Name(id='msg', ctx=Load(), lineno=252, col_offset=40, end_lineno=252, end_col_offset=43)], lineno=252, col_offset=18, end_lineno=252, end_col_offset=44), lineno=252, col_offset=12, end_lineno=252, end_col_offset=44)], lineno=247, col_offset=8, end_lineno=252, end_col_offset=44)], lineno=245, col_offset=8, end_lineno=252, end_col_offset=44), Assign(targets=[Name(id='vector_id', ctx=Store(), lineno=254, col_offset=8, end_lineno=254, end_col_offset=17)], value=Call(func=Name(id='VectorId', ctx=Load(), lineno=254, col_offset=20, end_lineno=254, end_col_offset=28), args=[Name(id='raw_key', ctx=Load(), lineno=254, col_offset=29, end_lineno=254, end_col_offset=36)], lineno=254, col_offset=20, end_lineno=254, end_col_offset=37), lineno=254, col_offset=8, end_lineno=254, end_col_offset=37), If(test=Compare(left=Name(id='vector_id', ctx=Load(), lineno=255, col_offset=11, end_lineno=255, end_col_offset=20), ops=[In()], comparators=[Name(id='seen_ids', ctx=Load(), lineno=255, col_offset=24, end_lineno=255, end_col_offset=32)], lineno=255, col_offset=11, end_lineno=255, end_col_offset=32), body=[Assign(targets=[Name(id='msg', ctx=Store(), lineno=256, col_offset=12, end_lineno=256, end_col_offset=15)], value=JoinedStr(values=[Constant(value='Record ', lineno=256, col_offset=20, end_lineno=256, end_col_offset=27), FormattedValue(value=Name(id='idx', ctx=Load(), lineno=256, col_offset=28, end_lineno=256, end_col_offset=31), conversion=-1, lineno=256, col_offset=27, end_lineno=256, end_col_offset=32), Constant(value=" reuses id '", lineno=256, col_offset=32, end_lineno=256, end_col_offset=44), FormattedValue(value=Name(id='vector_id', ctx=Load(), lineno=256, col_offset=45, end_lineno=256, end_col_offset=54), conversion=-1, lineno=256, col_offset=44, end_lineno=256, end_col_offset=55), Constant(value="'", lineno=256, col_offset=55, end_lineno=256, end_col_offset=56)], lineno=256, col_offset=18, end_lineno=256, end_col_offset=57), lineno=256, col_offset=12, end_lineno=256, end_col_offset=57), Raise(exc=Call(func=Name(id='VectorValidationError', ctx=Load(), lineno=257, col_offset=18, end_lineno=257, end_col_offset=39), args=[Name(id='msg', ctx=Load(), lineno=257, col_offset=40, end_lineno=257, end_col_offset=43)], lineno=257, col_offset=18, end_lineno=257, end_col_offset=44), lineno=257, col_offset=12, end_lineno=257, end_col_offset=44)], lineno=255, col_offset=8, end_lineno=257, end_col_offset=44), Expr(value=Call(func=Attribute(value=Name(id='seen_ids', ctx=Load(), lineno=258, col_offset=8, end_lineno=258, end_col_offset=16), attr='add', ctx=Load(), lineno=258, col_offset=8, end_lineno=258, end_col_offset=20), args=[Name(id='vector_id', ctx=Load(), lineno=258, col_offset=21, end_lineno=258, end_col_offset=30)], lineno=258, col_offset=8, end_lineno=258, end_col_offset=31), lineno=258, col_offset=8, end_lineno=258, end_col_offset=31), Expr(value=Call(func=Attribute(value=Name(id='ids', ctx=Load(), lineno=259, col_offset=8, end_lineno=259, end_col_offset=11), attr='append', ctx=Load(), lineno=259, col_offset=8, end_lineno=259, end_col_offset=18), args=[Name(id='vector_id', ctx=Load(), lineno=259, col_offset=19, end_lineno=259, end_col_offset=28)], lineno=259, col_offset=8, end_lineno=259, end_col_offset=29), lineno=259, col_offset=8, end_lineno=259, end_col_offset=29), Expr(value=Call(func=Attribute(value=Name(id='vectors', ctx=Load(), lineno=260, col_offset=8, end_lineno=260, end_col_offset=15), attr='append', ctx=Load(), lineno=260, col_offset=8, end_lineno=260, end_col_offset=22), args=[Name(id='row', ctx=Load(), lineno=260, col_offset=23, end_lineno=260, end_col_offset=26)], lineno=260, col_offset=8, end_lineno=260, end_col_offset=27), lineno=260, col_offset=8, end_lineno=260, end_col_offset=27)], lineno=232, col_offset=4, end_lineno=260, end_col_offset=27), If(test=UnaryOp(op=Not(), operand=Name(id='ids', ctx=Load(), lineno=262, col_offset=11, end_lineno=262, end_col_offset=14), lineno=262, col_offset=7, end_lineno=262, end_col_offset=14), body=[Assign(targets=[Name(id='msg', ctx=Store(), lineno=263, col_offset=8, end_lineno=263, end_col_offset=11)], value=Constant(value='Vector payload must contain at least one record', lineno=263, col_offset=14, end_lineno=263, end_col_offset=63), lineno=263, col_offset=8, end_lineno=263, end_col_offset=63), Raise(exc=Call(func=Name(id='VectorValidationError', ctx=Load(), lineno=264, col_offset=14, end_lineno=264, end_col_offset=35), args=[Name(id='msg', ctx=Load(), lineno=264, col_offset=36, end_lineno=264, end_col_offset=39)], lineno=264, col_offset=14, end_lineno=264, end_col_offset=40), lineno=264, col_offset=8, end_lineno=264, end_col_offset=40)], lineno=262, col_offset=4, end_lineno=264, end_col_offset=40), Assign(targets=[Name(id='matrix_untyped', ctx=Store(), lineno=266, col_offset=4, end_lineno=266, end_col_offset=18)], value=Call(func=Attribute(value=Name(id='np', ctx=Load(), lineno=266, col_offset=21, end_lineno=266, end_col_offset=23), attr='asarray', ctx=Load(), lineno=266, col_offset=21, end_lineno=266, end_col_offset=31), args=[Name(id='vectors', ctx=Load(), lineno=266, col_offset=32, end_lineno=266, end_col_offset=39)], keywords=[keyword(arg='dtype', value=Attribute(value=Name(id='np', ctx=Load(), lineno=266, col_offset=47, end_lineno=266, end_col_offset=49), attr='float32', ctx=Load(), lineno=266, col_offset=47, end_lineno=266, end_col_offset=57), lineno=266, col_offset=41, end_lineno=266, end_col_offset=57)], lineno=266, col_offset=21, end_lineno=266, end_col_offset=58), lineno=266, col_offset=4, end_lineno=266, end_col_offset=58), AnnAssign(target=Name(id='matrix_contiguous', ctx=Store(), lineno=267, col_offset=4, end_lineno=267, end_col_offset=21), annotation=Name(id='VectorMatrix', ctx=Load(), lineno=267, col_offset=23, end_lineno=267, end_col_offset=35), value=Call(func=Attribute(value=Name(id='np', ctx=Load(), lineno=267, col_offset=38, end_lineno=267, end_col_offset=40), attr='ascontiguousarray', ctx=Load(), lineno=267, col_offset=38, end_lineno=267, end_col_offset=58), args=[Name(id='matrix_untyped', ctx=Load(), lineno=267, col_offset=59, end_lineno=267, end_col_offset=73)], keywords=[keyword(arg='dtype', value=Attribute(value=Name(id='np', ctx=Load(), lineno=267, col_offset=81, end_lineno=267, end_col_offset=83), attr='float32', ctx=Load(), lineno=267, col_offset=81, end_lineno=267, end_col_offset=91), lineno=267, col_offset=75, end_lineno=267, end_col_offset=91)], lineno=267, col_offset=38, end_lineno=267, end_col_offset=92), simple=1, lineno=267, col_offset=4, end_lineno=267, end_col_offset=92), Return(value=Call(func=Name(id='VectorBatch', ctx=Load(), lineno=268, col_offset=11, end_lineno=268, end_col_offset=22), keywords=[keyword(arg='ids', value=Call(func=Name(id='tuple', ctx=Load(), lineno=268, col_offset=27, end_lineno=268, end_col_offset=32), args=[Name(id='ids', ctx=Load(), lineno=268, col_offset=33, end_lineno=268, end_col_offset=36)], lineno=268, col_offset=27, end_lineno=268, end_col_offset=37), lineno=268, col_offset=23, end_lineno=268, end_col_offset=37), keyword(arg='matrix', value=Name(id='matrix_contiguous', ctx=Load(), lineno=268, col_offset=46, end_lineno=268, end_col_offset=63), lineno=268, col_offset=39, end_lineno=268, end_col_offset=63)], lineno=268, col_offset=11, end_lineno=268, end_col_offset=64), lineno=268, col_offset=4, end_lineno=268, end_col_offset=64)], returns=Name(id='VectorBatch', ctx=Load(), lineno=192, col_offset=54, end_lineno=192, end_col_offset=65), lineno=192, col_offset=0, end_lineno=268, end_col_offset=64), FunctionDef(name='_coerce_vector_row', args=arguments(args=[arg(arg='vector_obj', annotation=Name(id='object', ctx=Load(), lineno=271, col_offset=35, end_lineno=271, end_col_offset=41), lineno=271, col_offset=23, end_lineno=271, end_col_offset=41), arg(arg='idx', annotation=Name(id='int', ctx=Load(), lineno=271, col_offset=48, end_lineno=271, end_col_offset=51), lineno=271, col_offset=43, end_lineno=271, end_col_offset=51)]), body=[Expr(value=Constant(value='Return a typed row extracted from ``vector_obj``.\n\n    Parameters\n    ----------\n    vector_obj : object\n        Candidate vector payload.\n    idx : int\n        Zero-based index of the record, used for diagnostic messages.\n\n    Returns\n    -------\n    list[float]\n        Row converted to ``float32`` values.\n\n    Raises\n    ------\n    VectorValidationError\n        If the object cannot be converted to a one-dimensional numeric vector.\n    ', lineno=272, col_offset=4, end_lineno=290, end_col_offset=7), lineno=272, col_offset=4, end_lineno=290, end_col_offset=7), If(test=Call(func=Name(id='isinstance', ctx=Load(), lineno=291, col_offset=7, end_lineno=291, end_col_offset=17), args=[Name(id='vector_obj', ctx=Load(), lineno=291, col_offset=18, end_lineno=291, end_col_offset=28), Name(id='Mapping', ctx=Load(), lineno=291, col_offset=30, end_lineno=291, end_col_offset=37)], lineno=291, col_offset=7, end_lineno=291, end_col_offset=38), body=[Assign(targets=[Name(id='msg', ctx=Store(), lineno=292, col_offset=8, end_lineno=292, end_col_offset=11)], value=JoinedStr(values=[Constant(value='Record ', lineno=292, col_offset=16, end_lineno=292, end_col_offset=23), FormattedValue(value=Name(id='idx', ctx=Load(), lineno=292, col_offset=24, end_lineno=292, end_col_offset=27), conversion=-1, lineno=292, col_offset=23, end_lineno=292, end_col_offset=28), Constant(value=" must provide 'vector' as a sequence, not a mapping", lineno=292, col_offset=28, end_lineno=292, end_col_offset=79)], lineno=292, col_offset=14, end_lineno=292, end_col_offset=80), lineno=292, col_offset=8, end_lineno=292, end_col_offset=80), Raise(exc=Call(func=Name(id='VectorValidationError', ctx=Load(), lineno=293, col_offset=14, end_lineno=293, end_col_offset=35), args=[Name(id='msg', ctx=Load(), lineno=293, col_offset=36, end_lineno=293, end_col_offset=39)], lineno=293, col_offset=14, end_lineno=293, end_col_offset=40), lineno=293, col_offset=8, end_lineno=293, end_col_offset=40)], lineno=291, col_offset=4, end_lineno=293, end_col_offset=40), Try(body=[Assign(targets=[Name(id='array', ctx=Store(), lineno=296, col_offset=8, end_lineno=296, end_col_offset=13)], value=Call(func=Attribute(value=Name(id='np', ctx=Load(), lineno=296, col_offset=16, end_lineno=296, end_col_offset=18), attr='asarray', ctx=Load(), lineno=296, col_offset=16, end_lineno=296, end_col_offset=26), args=[Name(id='vector_obj', ctx=Load(), lineno=296, col_offset=27, end_lineno=296, end_col_offset=37)], keywords=[keyword(arg='dtype', value=Attribute(value=Name(id='np', ctx=Load(), lineno=296, col_offset=45, end_lineno=296, end_col_offset=47), attr='float32', ctx=Load(), lineno=296, col_offset=45, end_lineno=296, end_col_offset=55), lineno=296, col_offset=39, end_lineno=296, end_col_offset=55)], lineno=296, col_offset=16, end_lineno=296, end_col_offset=56), lineno=296, col_offset=8, end_lineno=296, end_col_offset=56)], handlers=[ExceptHandler(type=Tuple(elts=[Name(id='TypeError', ctx=Load(), lineno=297, col_offset=12, end_lineno=297, end_col_offset=21), Name(id='ValueError', ctx=Load(), lineno=297, col_offset=23, end_lineno=297, end_col_offset=33)], ctx=Load(), lineno=297, col_offset=11, end_lineno=297, end_col_offset=34), name='exc', body=[Assign(targets=[Name(id='msg', ctx=Store(), lineno=298, col_offset=8, end_lineno=298, end_col_offset=11)], value=JoinedStr(values=[Constant(value='Record ', lineno=298, col_offset=16, end_lineno=298, end_col_offset=23), FormattedValue(value=Name(id='idx', ctx=Load(), lineno=298, col_offset=24, end_lineno=298, end_col_offset=27), conversion=-1, lineno=298, col_offset=23, end_lineno=298, end_col_offset=28), Constant(value=' contains non-numeric vector entries', lineno=298, col_offset=28, end_lineno=298, end_col_offset=64)], lineno=298, col_offset=14, end_lineno=298, end_col_offset=65), lineno=298, col_offset=8, end_lineno=298, end_col_offset=65), Raise(exc=Call(func=Name(id='VectorValidationError', ctx=Load(), lineno=299, col_offset=14, end_lineno=299, end_col_offset=35), args=[Name(id='msg', ctx=Load(), lineno=299, col_offset=36, end_lineno=299, end_col_offset=39)], lineno=299, col_offset=14, end_lineno=299, end_col_offset=40), cause=Name(id='exc', ctx=Load(), lineno=299, col_offset=46, end_lineno=299, end_col_offset=49), lineno=299, col_offset=8, end_lineno=299, end_col_offset=49)], lineno=297, col_offset=4, end_lineno=299, end_col_offset=49)], lineno=295, col_offset=4, end_lineno=299, end_col_offset=49), If(test=Compare(left=Attribute(value=Name(id='array', ctx=Load(), lineno=301, col_offset=7, end_lineno=301, end_col_offset=12), attr='ndim', ctx=Load(), lineno=301, col_offset=7, end_lineno=301, end_col_offset=17), ops=[NotEq()], comparators=[Constant(value=1, lineno=301, col_offset=21, end_lineno=301, end_col_offset=22)], lineno=301, col_offset=7, end_lineno=301, end_col_offset=22), body=[Assign(targets=[Name(id='msg', ctx=Store(), lineno=302, col_offset=8, end_lineno=302, end_col_offset=11)], value=JoinedStr(values=[Constant(value='Record ', lineno=302, col_offset=16, end_lineno=302, end_col_offset=23), FormattedValue(value=Name(id='idx', ctx=Load(), lineno=302, col_offset=24, end_lineno=302, end_col_offset=27), conversion=-1, lineno=302, col_offset=23, end_lineno=302, end_col_offset=28), Constant(value=' vector must be one-dimensional', lineno=302, col_offset=28, end_lineno=302, end_col_offset=59)], lineno=302, col_offset=14, end_lineno=302, end_col_offset=60), lineno=302, col_offset=8, end_lineno=302, end_col_offset=60), Raise(exc=Call(func=Name(id='VectorValidationError', ctx=Load(), lineno=303, col_offset=14, end_lineno=303, end_col_offset=35), args=[Name(id='msg', ctx=Load(), lineno=303, col_offset=36, end_lineno=303, end_col_offset=39)], lineno=303, col_offset=14, end_lineno=303, end_col_offset=40), lineno=303, col_offset=8, end_lineno=303, end_col_offset=40)], lineno=301, col_offset=4, end_lineno=303, end_col_offset=40), If(test=Compare(left=Attribute(value=Name(id='array', ctx=Load(), lineno=304, col_offset=7, end_lineno=304, end_col_offset=12), attr='size', ctx=Load(), lineno=304, col_offset=7, end_lineno=304, end_col_offset=17), ops=[Eq()], comparators=[Constant(value=0, lineno=304, col_offset=21, end_lineno=304, end_col_offset=22)], lineno=304, col_offset=7, end_lineno=304, end_col_offset=22), body=[Assign(targets=[Name(id='msg', ctx=Store(), lineno=305, col_offset=8, end_lineno=305, end_col_offset=11)], value=JoinedStr(values=[Constant(value='Record ', lineno=305, col_offset=16, end_lineno=305, end_col_offset=23), FormattedValue(value=Name(id='idx', ctx=Load(), lineno=305, col_offset=24, end_lineno=305, end_col_offset=27), conversion=-1, lineno=305, col_offset=23, end_lineno=305, end_col_offset=28), Constant(value=' vector must contain at least one element', lineno=305, col_offset=28, end_lineno=305, end_col_offset=69)], lineno=305, col_offset=14, end_lineno=305, end_col_offset=70), lineno=305, col_offset=8, end_lineno=305, end_col_offset=70), Raise(exc=Call(func=Name(id='VectorValidationError', ctx=Load(), lineno=306, col_offset=14, end_lineno=306, end_col_offset=35), args=[Name(id='msg', ctx=Load(), lineno=306, col_offset=36, end_lineno=306, end_col_offset=39)], lineno=306, col_offset=14, end_lineno=306, end_col_offset=40), lineno=306, col_offset=8, end_lineno=306, end_col_offset=40)], lineno=304, col_offset=4, end_lineno=306, end_col_offset=40), Assign(targets=[Name(id='contiguous', ctx=Store(), lineno=308, col_offset=4, end_lineno=308, end_col_offset=14)], value=Call(func=Attribute(value=Name(id='np', ctx=Load(), lineno=308, col_offset=17, end_lineno=308, end_col_offset=19), attr='ascontiguousarray', ctx=Load(), lineno=308, col_offset=17, end_lineno=308, end_col_offset=37), args=[Name(id='array', ctx=Load(), lineno=308, col_offset=38, end_lineno=308, end_col_offset=43)], keywords=[keyword(arg='dtype', value=Attribute(value=Name(id='np', ctx=Load(), lineno=308, col_offset=51, end_lineno=308, end_col_offset=53), attr='float32', ctx=Load(), lineno=308, col_offset=51, end_lineno=308, end_col_offset=61), lineno=308, col_offset=45, end_lineno=308, end_col_offset=61)], lineno=308, col_offset=17, end_lineno=308, end_col_offset=62), lineno=308, col_offset=4, end_lineno=308, end_col_offset=62), Return(value=Call(func=Name(id='cast', ctx=Load(), lineno=309, col_offset=11, end_lineno=309, end_col_offset=15), args=[Constant(value='list[float]', lineno=309, col_offset=16, end_lineno=309, end_col_offset=29), Call(func=Attribute(value=Call(func=Attribute(value=Name(id='contiguous', ctx=Load(), lineno=309, col_offset=31, end_lineno=309, end_col_offset=41), attr='astype', ctx=Load(), lineno=309, col_offset=31, end_lineno=309, end_col_offset=48), args=[Attribute(value=Name(id='np', ctx=Load(), lineno=309, col_offset=49, end_lineno=309, end_col_offset=51), attr='float32', ctx=Load(), lineno=309, col_offset=49, end_lineno=309, end_col_offset=59)], keywords=[keyword(arg='copy', value=Constant(value=False, lineno=309, col_offset=66, end_lineno=309, end_col_offset=71), lineno=309, col_offset=61, end_lineno=309, end_col_offset=71)], lineno=309, col_offset=31, end_lineno=309, end_col_offset=72), attr='tolist', ctx=Load(), lineno=309, col_offset=31, end_lineno=309, end_col_offset=79), lineno=309, col_offset=31, end_lineno=309, end_col_offset=81)], lineno=309, col_offset=11, end_lineno=309, end_col_offset=82), lineno=309, col_offset=4, end_lineno=309, end_col_offset=82)], returns=Subscript(value=Name(id='list', ctx=Load(), lineno=271, col_offset=56, end_lineno=271, end_col_offset=60), slice=Name(id='float', ctx=Load(), lineno=271, col_offset=61, end_lineno=271, end_col_offset=66), ctx=Load(), lineno=271, col_offset=56, end_lineno=271, end_col_offset=67), lineno=271, col_offset=0, end_lineno=309, end_col_offset=82), Assign(targets=[Name(id='__all__', ctx=Store(), lineno=312, col_offset=0, end_lineno=312, end_col_offset=7)], value=List(elts=[Constant(value='VectorBatch', lineno=313, col_offset=4, end_lineno=313, end_col_offset=17), Constant(value='VectorId', lineno=314, col_offset=4, end_lineno=314, end_col_offset=14), Constant(value='VectorMatrix', lineno=315, col_offset=4, end_lineno=315, end_col_offset=18), Constant(value='VectorValidationError', lineno=316, col_offset=4, end_lineno=316, end_col_offset=27), Constant(value='assert_vector_matrix', lineno=317, col_offset=4, end_lineno=317, end_col_offset=26), Constant(value='coerce_vector_batch', lineno=318, col_offset=4, end_lineno=318, end_col_offset=25), Constant(value='validate_vector_batch', lineno=319, col_offset=4, end_lineno=319, end_col_offset=27)], ctx=Load(), lineno=312, col_offset=10, end_lineno=320, end_col_offset=1), lineno=312, col_offset=0, end_lineno=320, end_col_offset=1), Assign(targets=[Name(id='__navmap__', ctx=Store(), lineno=321, col_offset=0, end_lineno=321, end_col_offset=10)], value=Call(func=Name(id='load_nav_metadata', ctx=Load(), lineno=321, col_offset=13, end_lineno=321, end_col_offset=30), args=[Name(id='__name__', ctx=Load(), lineno=321, col_offset=31, end_lineno=321, end_col_offset=39), Call(func=Name(id='tuple', ctx=Load(), lineno=321, col_offset=41, end_lineno=321, end_col_offset=46), args=[Name(id='__all__', ctx=Load(), lineno=321, col_offset=47, end_lineno=321, end_col_offset=54)], lineno=321, col_offset=41, end_lineno=321, end_col_offset=55)], lineno=321, col_offset=13, end_lineno=321, end_col_offset=56), lineno=321, col_offset=0, end_lineno=321, end_col_offset=56)])