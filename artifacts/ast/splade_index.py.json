Module(body=[Expr(value=Constant(value='Overview of splade index.\n\nThis module bundles splade index logic for the kgfoundry stack. It groups related helpers so\ndownstream packages can import a single cohesive namespace. Refer to the functions and classes below\nfor implementation specifics.\n', lineno=1, col_offset=0, end_lineno=6, end_col_offset=3), lineno=1, col_offset=0, end_lineno=6, end_col_offset=3), ImportFrom(module='__future__', names=[alias(name='annotations', lineno=10, col_offset=23, end_lineno=10, end_col_offset=34)], level=0, lineno=10, col_offset=0, end_lineno=10, end_col_offset=34), Import(names=[alias(name='re', lineno=12, col_offset=7, end_lineno=12, end_col_offset=9)], lineno=12, col_offset=0, end_lineno=12, end_col_offset=9), ImportFrom(module='dataclasses', names=[alias(name='dataclass', lineno=13, col_offset=24, end_lineno=13, end_col_offset=33)], level=0, lineno=13, col_offset=0, end_lineno=13, end_col_offset=33), ImportFrom(module='pathlib', names=[alias(name='Path', lineno=14, col_offset=20, end_lineno=14, end_col_offset=24)], level=0, lineno=14, col_offset=0, end_lineno=14, end_col_offset=24), ImportFrom(module='typing', names=[alias(name='TYPE_CHECKING', lineno=15, col_offset=19, end_lineno=15, end_col_offset=32), alias(name='Final', lineno=15, col_offset=34, end_lineno=15, end_col_offset=39)], level=0, lineno=15, col_offset=0, end_lineno=15, end_col_offset=39), Import(names=[alias(name='duckdb', lineno=17, col_offset=7, end_lineno=17, end_col_offset=13)], lineno=17, col_offset=0, end_lineno=17, end_col_offset=13), ImportFrom(module='kgfoundry_common.navmap_loader', names=[alias(name='load_nav_metadata', lineno=19, col_offset=43, end_lineno=19, end_col_offset=60)], level=0, lineno=19, col_offset=0, end_lineno=19, end_col_offset=60), If(test=Name(id='TYPE_CHECKING', ctx=Load(), lineno=21, col_offset=3, end_lineno=21, end_col_offset=16), body=[ImportFrom(module='collections.abc', names=[alias(name='Sequence', lineno=22, col_offset=32, end_lineno=22, end_col_offset=40)], level=0, lineno=22, col_offset=4, end_lineno=22, end_col_offset=40)], lineno=21, col_offset=0, end_lineno=22, end_col_offset=40), Assign(targets=[Name(id='__all__', ctx=Store(), lineno=25, col_offset=0, end_lineno=25, end_col_offset=7)], value=List(elts=[Constant(value='SpladeDoc', lineno=26, col_offset=4, end_lineno=26, end_col_offset=15), Constant(value='SpladeIndex', lineno=27, col_offset=4, end_lineno=27, end_col_offset=17), Constant(value='tok', lineno=28, col_offset=4, end_lineno=28, end_col_offset=9)], ctx=Load(), lineno=25, col_offset=10, end_lineno=29, end_col_offset=1), lineno=25, col_offset=0, end_lineno=29, end_col_offset=1), Assign(targets=[Name(id='__navmap__', ctx=Store(), lineno=30, col_offset=0, end_lineno=30, end_col_offset=10)], value=Call(func=Name(id='load_nav_metadata', ctx=Load(), lineno=30, col_offset=13, end_lineno=30, end_col_offset=30), args=[Name(id='__name__', ctx=Load(), lineno=30, col_offset=31, end_lineno=30, end_col_offset=39), Call(func=Name(id='tuple', ctx=Load(), lineno=30, col_offset=41, end_lineno=30, end_col_offset=46), args=[Name(id='__all__', ctx=Load(), lineno=30, col_offset=47, end_lineno=30, end_col_offset=54)], lineno=30, col_offset=41, end_lineno=30, end_col_offset=55)], lineno=30, col_offset=13, end_lineno=30, end_col_offset=56), lineno=30, col_offset=0, end_lineno=30, end_col_offset=56), Assign(targets=[Name(id='TOKEN', ctx=Store(), lineno=33, col_offset=0, end_lineno=33, end_col_offset=5)], value=Call(func=Attribute(value=Name(id='re', ctx=Load(), lineno=33, col_offset=8, end_lineno=33, end_col_offset=10), attr='compile', ctx=Load(), lineno=33, col_offset=8, end_lineno=33, end_col_offset=18), args=[Constant(value='[A-Za-z0-9]+', lineno=33, col_offset=19, end_lineno=33, end_col_offset=34)], lineno=33, col_offset=8, end_lineno=33, end_col_offset=35), lineno=33, col_offset=0, end_lineno=33, end_col_offset=35), AnnAssign(target=Name(id='PARQUET_ROW_WIDTH', ctx=Store(), lineno=34, col_offset=0, end_lineno=34, end_col_offset=17), annotation=Name(id='Final', ctx=Load(), lineno=34, col_offset=19, end_lineno=34, end_col_offset=24), value=Constant(value=4, lineno=34, col_offset=27, end_lineno=34, end_col_offset=28), simple=1, lineno=34, col_offset=0, end_lineno=34, end_col_offset=28), FunctionDef(name='tok', args=arguments(args=[arg(arg='text', annotation=Name(id='str', ctx=Load(), lineno=38, col_offset=14, end_lineno=38, end_col_offset=17), lineno=38, col_offset=8, end_lineno=38, end_col_offset=17)]), body=[Expr(value=Constant(value='Tokenize text into lowercase alphanumeric tokens.\n\n    Extracts alphanumeric sequences from the input text and converts them\n    to lowercase. Uses a regex pattern to match alphanumeric characters.\n\n    Parameters\n    ----------\n    text : str\n        Input text to tokenize. Empty strings are handled gracefully.\n\n    Returns\n    -------\n    list[str]\n        List of lowercase alphanumeric tokens extracted from the text.\n    ', lineno=39, col_offset=4, end_lineno=53, end_col_offset=7), lineno=39, col_offset=4, end_lineno=53, end_col_offset=7), AnnAssign(target=Name(id='matches', ctx=Store(), lineno=55, col_offset=4, end_lineno=55, end_col_offset=11), annotation=Subscript(value=Name(id='list', ctx=Load(), lineno=55, col_offset=13, end_lineno=55, end_col_offset=17), slice=Name(id='str', ctx=Load(), lineno=55, col_offset=18, end_lineno=55, end_col_offset=21), ctx=Load(), lineno=55, col_offset=13, end_lineno=55, end_col_offset=22), value=Call(func=Attribute(value=Name(id='TOKEN', ctx=Load(), lineno=55, col_offset=25, end_lineno=55, end_col_offset=30), attr='findall', ctx=Load(), lineno=55, col_offset=25, end_lineno=55, end_col_offset=38), args=[BoolOp(op=Or(), values=[Name(id='text', ctx=Load(), lineno=55, col_offset=39, end_lineno=55, end_col_offset=43), Constant(value='', lineno=55, col_offset=47, end_lineno=55, end_col_offset=49)], lineno=55, col_offset=39, end_lineno=55, end_col_offset=49)], lineno=55, col_offset=25, end_lineno=55, end_col_offset=50), simple=1, lineno=55, col_offset=4, end_lineno=55, end_col_offset=50), Return(value=ListComp(elt=Call(func=Attribute(value=Name(id='token', ctx=Load(), lineno=56, col_offset=12, end_lineno=56, end_col_offset=17), attr='lower', ctx=Load(), lineno=56, col_offset=12, end_lineno=56, end_col_offset=23), lineno=56, col_offset=12, end_lineno=56, end_col_offset=25), generators=[comprehension(target=Name(id='token', ctx=Store(), lineno=56, col_offset=30, end_lineno=56, end_col_offset=35), iter=Name(id='matches', ctx=Load(), lineno=56, col_offset=39, end_lineno=56, end_col_offset=46), is_async=0)], lineno=56, col_offset=11, end_lineno=56, end_col_offset=47), lineno=56, col_offset=4, end_lineno=56, end_col_offset=47)], returns=Subscript(value=Name(id='list', ctx=Load(), lineno=38, col_offset=22, end_lineno=38, end_col_offset=26), slice=Name(id='str', ctx=Load(), lineno=38, col_offset=27, end_lineno=38, end_col_offset=30), ctx=Load(), lineno=38, col_offset=22, end_lineno=38, end_col_offset=31), lineno=38, col_offset=0, end_lineno=56, end_col_offset=47), ClassDef(name='SpladeDoc', body=[Expr(value=Constant(value='Document fixture for SPLADE index backed by sparse retrieval data.', lineno=62, col_offset=4, end_lineno=62, end_col_offset=76), lineno=62, col_offset=4, end_lineno=62, end_col_offset=76), AnnAssign(target=Name(id='chunk_id', ctx=Store(), lineno=64, col_offset=4, end_lineno=64, end_col_offset=12), annotation=Name(id='str', ctx=Load(), lineno=64, col_offset=14, end_lineno=64, end_col_offset=17), simple=1, lineno=64, col_offset=4, end_lineno=64, end_col_offset=17), Expr(value=Constant(value='Chunk identifier.\n\n    Alias: none; name ``chunk_id``.\n    ', lineno=65, col_offset=4, end_lineno=68, end_col_offset=7), lineno=65, col_offset=4, end_lineno=68, end_col_offset=7), AnnAssign(target=Name(id='doc_id', ctx=Store(), lineno=69, col_offset=4, end_lineno=69, end_col_offset=10), annotation=Name(id='str', ctx=Load(), lineno=69, col_offset=12, end_lineno=69, end_col_offset=15), simple=1, lineno=69, col_offset=4, end_lineno=69, end_col_offset=15), Expr(value=Constant(value='Document identifier.\n\n    Alias: none; name ``doc_id``.\n    ', lineno=70, col_offset=4, end_lineno=73, end_col_offset=7), lineno=70, col_offset=4, end_lineno=73, end_col_offset=7), AnnAssign(target=Name(id='section', ctx=Store(), lineno=74, col_offset=4, end_lineno=74, end_col_offset=11), annotation=Name(id='str', ctx=Load(), lineno=74, col_offset=13, end_lineno=74, end_col_offset=16), simple=1, lineno=74, col_offset=4, end_lineno=74, end_col_offset=16), Expr(value=Constant(value='Section label within the document.\n\n    Alias: none; name ``section``.\n    ', lineno=75, col_offset=4, end_lineno=78, end_col_offset=7), lineno=75, col_offset=4, end_lineno=78, end_col_offset=7), AnnAssign(target=Name(id='text', ctx=Store(), lineno=79, col_offset=4, end_lineno=79, end_col_offset=8), annotation=Name(id='str', ctx=Load(), lineno=79, col_offset=10, end_lineno=79, end_col_offset=13), simple=1, lineno=79, col_offset=4, end_lineno=79, end_col_offset=13), Expr(value=Constant(value='Chunk text content.\n\n    Alias: none; name ``text``.\n    ', lineno=80, col_offset=4, end_lineno=83, end_col_offset=7), lineno=80, col_offset=4, end_lineno=83, end_col_offset=7)], decorator_list=[Call(func=Name(id='dataclass', ctx=Load(), lineno=60, col_offset=1, end_lineno=60, end_col_offset=10), keywords=[keyword(arg='frozen', value=Constant(value=True, lineno=60, col_offset=18, end_lineno=60, end_col_offset=22), lineno=60, col_offset=11, end_lineno=60, end_col_offset=22)], lineno=60, col_offset=1, end_lineno=60, end_col_offset=23)], lineno=61, col_offset=0, end_lineno=83, end_col_offset=7), ClassDef(name='SpladeIndex', body=[Expr(value=Constant(value='In-memory SPLADE index for tests and tutorials.\n\n    Simple in-memory search index that loads document chunks from a DuckDB\n    catalog and builds document frequency (DF) indexes for sparse retrieval.\n    Used primarily for testing and tutorials as an example SPLADE index.\n\n    Parameters\n    ----------\n    db_path : str\n        Path to DuckDB catalog database file.\n    chunks_dataset_root : str | None, optional\n        Optional override path to chunks dataset root. If None, uses the\n        latest chunks dataset from the catalog. Defaults to None.\n    sparse_root : str | None, optional\n        Optional sparse embeddings root (retained for interface compatibility).\n        Currently unused. Defaults to None.\n    ', lineno=88, col_offset=4, end_lineno=104, end_col_offset=7), lineno=88, col_offset=4, end_lineno=104, end_col_offset=7), FunctionDef(name='__init__', args=arguments(args=[arg(arg='self', lineno=107, col_offset=8, end_lineno=107, end_col_offset=12), arg(arg='db_path', annotation=Name(id='str', ctx=Load(), lineno=108, col_offset=17, end_lineno=108, end_col_offset=20), lineno=108, col_offset=8, end_lineno=108, end_col_offset=20), arg(arg='chunks_dataset_root', annotation=BinOp(left=Name(id='str', ctx=Load(), lineno=109, col_offset=29, end_lineno=109, end_col_offset=32), op=BitOr(), right=Constant(value=None, lineno=109, col_offset=35, end_lineno=109, end_col_offset=39), lineno=109, col_offset=29, end_lineno=109, end_col_offset=39), lineno=109, col_offset=8, end_lineno=109, end_col_offset=39), arg(arg='sparse_root', annotation=BinOp(left=Name(id='str', ctx=Load(), lineno=110, col_offset=21, end_lineno=110, end_col_offset=24), op=BitOr(), right=Constant(value=None, lineno=110, col_offset=27, end_lineno=110, end_col_offset=31), lineno=110, col_offset=21, end_lineno=110, end_col_offset=31), lineno=110, col_offset=8, end_lineno=110, end_col_offset=31)], defaults=[Constant(value=None, lineno=109, col_offset=42, end_lineno=109, end_col_offset=46), Constant(value=None, lineno=110, col_offset=34, end_lineno=110, end_col_offset=38)]), body=[Assign(targets=[Name(id='_', ctx=Store(), lineno=112, col_offset=8, end_lineno=112, end_col_offset=9)], value=Name(id='sparse_root', ctx=Load(), lineno=112, col_offset=12, end_lineno=112, end_col_offset=23), lineno=112, col_offset=8, end_lineno=112, end_col_offset=23), Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=113, col_offset=8, end_lineno=113, end_col_offset=12), attr='db_path', ctx=Store(), lineno=113, col_offset=8, end_lineno=113, end_col_offset=20)], value=Name(id='db_path', ctx=Load(), lineno=113, col_offset=23, end_lineno=113, end_col_offset=30), lineno=113, col_offset=8, end_lineno=113, end_col_offset=30), AnnAssign(target=Attribute(value=Name(id='self', ctx=Load(), lineno=114, col_offset=8, end_lineno=114, end_col_offset=12), attr='docs', ctx=Store(), lineno=114, col_offset=8, end_lineno=114, end_col_offset=17), annotation=Subscript(value=Name(id='list', ctx=Load(), lineno=114, col_offset=19, end_lineno=114, end_col_offset=23), slice=Name(id='SpladeDoc', ctx=Load(), lineno=114, col_offset=24, end_lineno=114, end_col_offset=33), ctx=Load(), lineno=114, col_offset=19, end_lineno=114, end_col_offset=34), value=List(ctx=Load(), lineno=114, col_offset=37, end_lineno=114, end_col_offset=39), simple=0, lineno=114, col_offset=8, end_lineno=114, end_col_offset=39), AnnAssign(target=Attribute(value=Name(id='self', ctx=Load(), lineno=115, col_offset=8, end_lineno=115, end_col_offset=12), attr='df', ctx=Store(), lineno=115, col_offset=8, end_lineno=115, end_col_offset=15), annotation=Subscript(value=Name(id='dict', ctx=Load(), lineno=115, col_offset=17, end_lineno=115, end_col_offset=21), slice=Tuple(elts=[Name(id='str', ctx=Load(), lineno=115, col_offset=22, end_lineno=115, end_col_offset=25), Name(id='int', ctx=Load(), lineno=115, col_offset=27, end_lineno=115, end_col_offset=30)], ctx=Load(), lineno=115, col_offset=22, end_lineno=115, end_col_offset=30), ctx=Load(), lineno=115, col_offset=17, end_lineno=115, end_col_offset=31), value=Dict(lineno=115, col_offset=34, end_lineno=115, end_col_offset=36), simple=0, lineno=115, col_offset=8, end_lineno=115, end_col_offset=36), Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=116, col_offset=8, end_lineno=116, end_col_offset=12), attr='N', ctx=Store(), lineno=116, col_offset=8, end_lineno=116, end_col_offset=14)], value=Constant(value=0, lineno=116, col_offset=17, end_lineno=116, end_col_offset=18), lineno=116, col_offset=8, end_lineno=116, end_col_offset=18), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load(), lineno=117, col_offset=8, end_lineno=117, end_col_offset=12), attr='_load', ctx=Load(), lineno=117, col_offset=8, end_lineno=117, end_col_offset=18), args=[Name(id='chunks_dataset_root', ctx=Load(), lineno=117, col_offset=19, end_lineno=117, end_col_offset=38)], lineno=117, col_offset=8, end_lineno=117, end_col_offset=39), lineno=117, col_offset=8, end_lineno=117, end_col_offset=39)], returns=Constant(value=None, lineno=111, col_offset=9, end_lineno=111, end_col_offset=13), lineno=106, col_offset=4, end_lineno=117, end_col_offset=39), FunctionDef(name='_load', args=arguments(args=[arg(arg='self', lineno=119, col_offset=14, end_lineno=119, end_col_offset=18), arg(arg='chunks_root', annotation=BinOp(left=Name(id='str', ctx=Load(), lineno=119, col_offset=33, end_lineno=119, end_col_offset=36), op=BitOr(), right=Constant(value=None, lineno=119, col_offset=39, end_lineno=119, end_col_offset=43), lineno=119, col_offset=33, end_lineno=119, end_col_offset=43), lineno=119, col_offset=20, end_lineno=119, end_col_offset=43)]), body=[If(test=UnaryOp(op=Not(), operand=Call(func=Attribute(value=Call(func=Name(id='Path', ctx=Load(), lineno=120, col_offset=15, end_lineno=120, end_col_offset=19), args=[Attribute(value=Name(id='self', ctx=Load(), lineno=120, col_offset=20, end_lineno=120, end_col_offset=24), attr='db_path', ctx=Load(), lineno=120, col_offset=20, end_lineno=120, end_col_offset=32)], lineno=120, col_offset=15, end_lineno=120, end_col_offset=33), attr='exists', ctx=Load(), lineno=120, col_offset=15, end_lineno=120, end_col_offset=40), lineno=120, col_offset=15, end_lineno=120, end_col_offset=42), lineno=120, col_offset=11, end_lineno=120, end_col_offset=42), body=[Return(lineno=121, col_offset=12, end_lineno=121, end_col_offset=18)], lineno=120, col_offset=8, end_lineno=121, end_col_offset=18), AnnAssign(target=Name(id='connection', ctx=Store(), lineno=123, col_offset=8, end_lineno=123, end_col_offset=18), annotation=Attribute(value=Name(id='duckdb', ctx=Load(), lineno=123, col_offset=20, end_lineno=123, end_col_offset=26), attr='DuckDBPyConnection', ctx=Load(), lineno=123, col_offset=20, end_lineno=123, end_col_offset=45), value=Call(func=Attribute(value=Name(id='duckdb', ctx=Load(), lineno=123, col_offset=48, end_lineno=123, end_col_offset=54), attr='connect', ctx=Load(), lineno=123, col_offset=48, end_lineno=123, end_col_offset=62), args=[Attribute(value=Name(id='self', ctx=Load(), lineno=123, col_offset=63, end_lineno=123, end_col_offset=67), attr='db_path', ctx=Load(), lineno=123, col_offset=63, end_lineno=123, end_col_offset=75)], lineno=123, col_offset=48, end_lineno=123, end_col_offset=76), simple=1, lineno=123, col_offset=8, end_lineno=123, end_col_offset=76), Try(body=[Assign(targets=[Name(id='root', ctx=Store(), lineno=125, col_offset=12, end_lineno=125, end_col_offset=16)], value=Call(func=Attribute(value=Name(id='self', ctx=Load(), lineno=125, col_offset=19, end_lineno=125, end_col_offset=23), attr='_resolve_chunks_root', ctx=Load(), lineno=125, col_offset=19, end_lineno=125, end_col_offset=44), args=[Name(id='connection', ctx=Load(), lineno=125, col_offset=45, end_lineno=125, end_col_offset=55), Name(id='chunks_root', ctx=Load(), lineno=125, col_offset=57, end_lineno=125, end_col_offset=68)], lineno=125, col_offset=19, end_lineno=125, end_col_offset=69), lineno=125, col_offset=12, end_lineno=125, end_col_offset=69), Assign(targets=[Name(id='rows', ctx=Store(), lineno=126, col_offset=12, end_lineno=126, end_col_offset=16)], value=IfExp(test=Compare(left=Name(id='root', ctx=Load(), lineno=126, col_offset=62, end_lineno=126, end_col_offset=66), ops=[IsNot()], comparators=[Constant(value=None, lineno=126, col_offset=74, end_lineno=126, end_col_offset=78)], lineno=126, col_offset=62, end_lineno=126, end_col_offset=78), body=Call(func=Attribute(value=Name(id='self', ctx=Load(), lineno=126, col_offset=19, end_lineno=126, end_col_offset=23), attr='_read_chunk_rows', ctx=Load(), lineno=126, col_offset=19, end_lineno=126, end_col_offset=40), args=[Name(id='connection', ctx=Load(), lineno=126, col_offset=41, end_lineno=126, end_col_offset=51), Name(id='root', ctx=Load(), lineno=126, col_offset=53, end_lineno=126, end_col_offset=57)], lineno=126, col_offset=19, end_lineno=126, end_col_offset=58), orelse=List(ctx=Load(), lineno=126, col_offset=84, end_lineno=126, end_col_offset=86), lineno=126, col_offset=19, end_lineno=126, end_col_offset=86), lineno=126, col_offset=12, end_lineno=126, end_col_offset=86)], finalbody=[Expr(value=Call(func=Attribute(value=Name(id='connection', ctx=Load(), lineno=128, col_offset=12, end_lineno=128, end_col_offset=22), attr='close', ctx=Load(), lineno=128, col_offset=12, end_lineno=128, end_col_offset=28), lineno=128, col_offset=12, end_lineno=128, end_col_offset=30), lineno=128, col_offset=12, end_lineno=128, end_col_offset=30)], lineno=124, col_offset=8, end_lineno=128, end_col_offset=30), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load(), lineno=130, col_offset=8, end_lineno=130, end_col_offset=12), attr='_populate_docs', ctx=Load(), lineno=130, col_offset=8, end_lineno=130, end_col_offset=27), args=[Name(id='rows', ctx=Load(), lineno=130, col_offset=28, end_lineno=130, end_col_offset=32)], lineno=130, col_offset=8, end_lineno=130, end_col_offset=33), lineno=130, col_offset=8, end_lineno=130, end_col_offset=33), Expr(value=Call(func=Attribute(value=Name(id='self', ctx=Load(), lineno=131, col_offset=8, end_lineno=131, end_col_offset=12), attr='_recompute_document_frequencies', ctx=Load(), lineno=131, col_offset=8, end_lineno=131, end_col_offset=44), lineno=131, col_offset=8, end_lineno=131, end_col_offset=46), lineno=131, col_offset=8, end_lineno=131, end_col_offset=46)], returns=Constant(value=None, lineno=119, col_offset=48, end_lineno=119, end_col_offset=52), lineno=119, col_offset=4, end_lineno=131, end_col_offset=46), FunctionDef(name='_resolve_chunks_root', args=arguments(args=[arg(arg='connection', annotation=Attribute(value=Name(id='duckdb', ctx=Load(), lineno=135, col_offset=20, end_lineno=135, end_col_offset=26), attr='DuckDBPyConnection', ctx=Load(), lineno=135, col_offset=20, end_lineno=135, end_col_offset=45), lineno=135, col_offset=8, end_lineno=135, end_col_offset=45), arg(arg='override', annotation=BinOp(left=Name(id='str', ctx=Load(), lineno=135, col_offset=57, end_lineno=135, end_col_offset=60), op=BitOr(), right=Constant(value=None, lineno=135, col_offset=63, end_lineno=135, end_col_offset=67), lineno=135, col_offset=57, end_lineno=135, end_col_offset=67), lineno=135, col_offset=47, end_lineno=135, end_col_offset=67)]), body=[If(test=Name(id='override', ctx=Load(), lineno=137, col_offset=11, end_lineno=137, end_col_offset=19), body=[Return(value=Name(id='override', ctx=Load(), lineno=138, col_offset=19, end_lineno=138, end_col_offset=27), lineno=138, col_offset=12, end_lineno=138, end_col_offset=27)], lineno=137, col_offset=8, end_lineno=138, end_col_offset=27), AnnAssign(target=Name(id='dataset', ctx=Store(), lineno=139, col_offset=8, end_lineno=139, end_col_offset=15), annotation=BinOp(left=Subscript(value=Name(id='tuple', ctx=Load(), lineno=139, col_offset=17, end_lineno=139, end_col_offset=22), slice=Tuple(elts=[Name(id='object', ctx=Load(), lineno=139, col_offset=23, end_lineno=139, end_col_offset=29), Constant(value=Ellipsis, lineno=139, col_offset=31, end_lineno=139, end_col_offset=34)], ctx=Load(), lineno=139, col_offset=23, end_lineno=139, end_col_offset=34), ctx=Load(), lineno=139, col_offset=17, end_lineno=139, end_col_offset=35), op=BitOr(), right=Constant(value=None, lineno=139, col_offset=38, end_lineno=139, end_col_offset=42), lineno=139, col_offset=17, end_lineno=139, end_col_offset=42), value=Call(func=Attribute(value=Call(func=Attribute(value=Name(id='connection', ctx=Load(), lineno=139, col_offset=45, end_lineno=139, end_col_offset=55), attr='execute', ctx=Load(), lineno=139, col_offset=45, end_lineno=139, end_col_offset=63), args=[Constant(value="SELECT parquet_root FROM datasets WHERE kind='chunks' ORDER BY created_at DESC LIMIT 1", lineno=140, col_offset=12, end_lineno=140, end_col_offset=100)], lineno=139, col_offset=45, end_lineno=141, end_col_offset=9), attr='fetchone', ctx=Load(), lineno=139, col_offset=45, end_lineno=141, end_col_offset=18), lineno=139, col_offset=45, end_lineno=141, end_col_offset=20), simple=1, lineno=139, col_offset=8, end_lineno=141, end_col_offset=20), If(test=Compare(left=Name(id='dataset', ctx=Load(), lineno=142, col_offset=11, end_lineno=142, end_col_offset=18), ops=[Is()], comparators=[Constant(value=None, lineno=142, col_offset=22, end_lineno=142, end_col_offset=26)], lineno=142, col_offset=11, end_lineno=142, end_col_offset=26), body=[Return(value=Constant(value=None, lineno=143, col_offset=19, end_lineno=143, end_col_offset=23), lineno=143, col_offset=12, end_lineno=143, end_col_offset=23)], lineno=142, col_offset=8, end_lineno=143, end_col_offset=23), Assign(targets=[Name(id='root_obj', ctx=Store(), lineno=144, col_offset=8, end_lineno=144, end_col_offset=16)], value=Subscript(value=Name(id='dataset', ctx=Load(), lineno=144, col_offset=19, end_lineno=144, end_col_offset=26), slice=Constant(value=0, lineno=144, col_offset=27, end_lineno=144, end_col_offset=28), ctx=Load(), lineno=144, col_offset=19, end_lineno=144, end_col_offset=29), lineno=144, col_offset=8, end_lineno=144, end_col_offset=29), If(test=UnaryOp(op=Not(), operand=Call(func=Name(id='isinstance', ctx=Load(), lineno=145, col_offset=15, end_lineno=145, end_col_offset=25), args=[Name(id='root_obj', ctx=Load(), lineno=145, col_offset=26, end_lineno=145, end_col_offset=34), Name(id='str', ctx=Load(), lineno=145, col_offset=36, end_lineno=145, end_col_offset=39)], lineno=145, col_offset=15, end_lineno=145, end_col_offset=40), lineno=145, col_offset=11, end_lineno=145, end_col_offset=40), body=[Assign(targets=[Name(id='msg', ctx=Store(), lineno=146, col_offset=12, end_lineno=146, end_col_offset=15)], value=JoinedStr(values=[Constant(value='Invalid parquet_root type: ', lineno=146, col_offset=20, end_lineno=146, end_col_offset=47), FormattedValue(value=Call(func=Name(id='type', ctx=Load(), lineno=146, col_offset=48, end_lineno=146, end_col_offset=52), args=[Name(id='root_obj', ctx=Load(), lineno=146, col_offset=53, end_lineno=146, end_col_offset=61)], lineno=146, col_offset=48, end_lineno=146, end_col_offset=62), conversion=-1, lineno=146, col_offset=47, end_lineno=146, end_col_offset=63)], lineno=146, col_offset=18, end_lineno=146, end_col_offset=64), lineno=146, col_offset=12, end_lineno=146, end_col_offset=64), Raise(exc=Call(func=Name(id='TypeError', ctx=Load(), lineno=147, col_offset=18, end_lineno=147, end_col_offset=27), args=[Name(id='msg', ctx=Load(), lineno=147, col_offset=28, end_lineno=147, end_col_offset=31)], lineno=147, col_offset=18, end_lineno=147, end_col_offset=32), lineno=147, col_offset=12, end_lineno=147, end_col_offset=32)], lineno=145, col_offset=8, end_lineno=147, end_col_offset=32), Return(value=Name(id='root_obj', ctx=Load(), lineno=148, col_offset=15, end_lineno=148, end_col_offset=23), lineno=148, col_offset=8, end_lineno=148, end_col_offset=23)], decorator_list=[Name(id='staticmethod', ctx=Load(), lineno=133, col_offset=5, end_lineno=133, end_col_offset=17)], returns=BinOp(left=Name(id='str', ctx=Load(), lineno=136, col_offset=9, end_lineno=136, end_col_offset=12), op=BitOr(), right=Constant(value=None, lineno=136, col_offset=15, end_lineno=136, end_col_offset=19), lineno=136, col_offset=9, end_lineno=136, end_col_offset=19), lineno=134, col_offset=4, end_lineno=148, end_col_offset=23), FunctionDef(name='_read_chunk_rows', args=arguments(args=[arg(arg='connection', annotation=Attribute(value=Name(id='duckdb', ctx=Load(), lineno=152, col_offset=20, end_lineno=152, end_col_offset=26), attr='DuckDBPyConnection', ctx=Load(), lineno=152, col_offset=20, end_lineno=152, end_col_offset=45), lineno=152, col_offset=8, end_lineno=152, end_col_offset=45), arg(arg='root', annotation=Name(id='str', ctx=Load(), lineno=152, col_offset=53, end_lineno=152, end_col_offset=56), lineno=152, col_offset=47, end_lineno=152, end_col_offset=56)]), body=[Assign(targets=[Name(id='root_path', ctx=Store(), lineno=154, col_offset=8, end_lineno=154, end_col_offset=17)], value=Call(func=Name(id='Path', ctx=Load(), lineno=154, col_offset=20, end_lineno=154, end_col_offset=24), args=[Name(id='root', ctx=Load(), lineno=154, col_offset=25, end_lineno=154, end_col_offset=29)], lineno=154, col_offset=20, end_lineno=154, end_col_offset=30), lineno=154, col_offset=8, end_lineno=154, end_col_offset=30), Assign(targets=[Name(id='parquet_pattern', ctx=Store(), lineno=155, col_offset=8, end_lineno=155, end_col_offset=23)], value=Call(func=Name(id='str', ctx=Load(), lineno=155, col_offset=26, end_lineno=155, end_col_offset=29), args=[BinOp(left=BinOp(left=Name(id='root_path', ctx=Load(), lineno=155, col_offset=30, end_lineno=155, end_col_offset=39), op=Div(), right=Constant(value='*', lineno=155, col_offset=42, end_lineno=155, end_col_offset=45), lineno=155, col_offset=30, end_lineno=155, end_col_offset=45), op=Div(), right=Constant(value='*.parquet', lineno=155, col_offset=48, end_lineno=155, end_col_offset=59), lineno=155, col_offset=30, end_lineno=155, end_col_offset=59)], lineno=155, col_offset=26, end_lineno=155, end_col_offset=60), lineno=155, col_offset=8, end_lineno=155, end_col_offset=60), Assign(targets=[Name(id='sql', ctx=Store(), lineno=156, col_offset=8, end_lineno=156, end_col_offset=11)], value=Constant(value="\n            SELECT c.chunk_id, c.doc_id, coalesce(c.section,''), c.text\n            FROM read_parquet(?, union_by_name=true) AS c\n        ", lineno=156, col_offset=14, end_lineno=159, end_col_offset=11), lineno=156, col_offset=8, end_lineno=159, end_col_offset=11), AnnAssign(target=Name(id='raw_rows', ctx=Store(), lineno=160, col_offset=8, end_lineno=160, end_col_offset=16), annotation=Subscript(value=Name(id='Sequence', ctx=Load(), lineno=160, col_offset=18, end_lineno=160, end_col_offset=26), slice=Subscript(value=Name(id='tuple', ctx=Load(), lineno=160, col_offset=27, end_lineno=160, end_col_offset=32), slice=Tuple(elts=[Name(id='object', ctx=Load(), lineno=160, col_offset=33, end_lineno=160, end_col_offset=39), Constant(value=Ellipsis, lineno=160, col_offset=41, end_lineno=160, end_col_offset=44)], ctx=Load(), lineno=160, col_offset=33, end_lineno=160, end_col_offset=44), ctx=Load(), lineno=160, col_offset=27, end_lineno=160, end_col_offset=45), ctx=Load(), lineno=160, col_offset=18, end_lineno=160, end_col_offset=46), value=Call(func=Attribute(value=Call(func=Attribute(value=Name(id='connection', ctx=Load(), lineno=160, col_offset=49, end_lineno=160, end_col_offset=59), attr='execute', ctx=Load(), lineno=160, col_offset=49, end_lineno=160, end_col_offset=67), args=[Name(id='sql', ctx=Load(), lineno=161, col_offset=12, end_lineno=161, end_col_offset=15), List(elts=[Name(id='parquet_pattern', ctx=Load(), lineno=161, col_offset=18, end_lineno=161, end_col_offset=33)], ctx=Load(), lineno=161, col_offset=17, end_lineno=161, end_col_offset=34)], lineno=160, col_offset=49, end_lineno=162, end_col_offset=9), attr='fetchall', ctx=Load(), lineno=160, col_offset=49, end_lineno=162, end_col_offset=18), lineno=160, col_offset=49, end_lineno=162, end_col_offset=20), simple=1, lineno=160, col_offset=8, end_lineno=162, end_col_offset=20), AnnAssign(target=Name(id='typed_rows', ctx=Store(), lineno=163, col_offset=8, end_lineno=163, end_col_offset=18), annotation=Subscript(value=Name(id='list', ctx=Load(), lineno=163, col_offset=20, end_lineno=163, end_col_offset=24), slice=Subscript(value=Name(id='tuple', ctx=Load(), lineno=163, col_offset=25, end_lineno=163, end_col_offset=30), slice=Tuple(elts=[Name(id='object', ctx=Load(), lineno=163, col_offset=31, end_lineno=163, end_col_offset=37), Name(id='object', ctx=Load(), lineno=163, col_offset=39, end_lineno=163, end_col_offset=45), Name(id='object', ctx=Load(), lineno=163, col_offset=47, end_lineno=163, end_col_offset=53), Name(id='object', ctx=Load(), lineno=163, col_offset=55, end_lineno=163, end_col_offset=61)], ctx=Load(), lineno=163, col_offset=31, end_lineno=163, end_col_offset=61), ctx=Load(), lineno=163, col_offset=25, end_lineno=163, end_col_offset=62), ctx=Load(), lineno=163, col_offset=20, end_lineno=163, end_col_offset=63), value=List(ctx=Load(), lineno=163, col_offset=66, end_lineno=163, end_col_offset=68), simple=1, lineno=163, col_offset=8, end_lineno=163, end_col_offset=68), For(target=Name(id='row', ctx=Store(), lineno=164, col_offset=12, end_lineno=164, end_col_offset=15), iter=Name(id='raw_rows', ctx=Load(), lineno=164, col_offset=19, end_lineno=164, end_col_offset=27), body=[If(test=Compare(left=Call(func=Name(id='len', ctx=Load(), lineno=165, col_offset=15, end_lineno=165, end_col_offset=18), args=[Name(id='row', ctx=Load(), lineno=165, col_offset=19, end_lineno=165, end_col_offset=22)], lineno=165, col_offset=15, end_lineno=165, end_col_offset=23), ops=[Lt()], comparators=[Name(id='PARQUET_ROW_WIDTH', ctx=Load(), lineno=165, col_offset=26, end_lineno=165, end_col_offset=43)], lineno=165, col_offset=15, end_lineno=165, end_col_offset=43), body=[Continue(lineno=166, col_offset=16, end_lineno=166, end_col_offset=24)], lineno=165, col_offset=12, end_lineno=166, end_col_offset=24), Assign(targets=[Tuple(elts=[Name(id='chunk_id_val', ctx=Store(), lineno=167, col_offset=12, end_lineno=167, end_col_offset=24), Name(id='doc_id_val', ctx=Store(), lineno=167, col_offset=26, end_lineno=167, end_col_offset=36), Name(id='section_val', ctx=Store(), lineno=167, col_offset=38, end_lineno=167, end_col_offset=49), Name(id='text_val', ctx=Store(), lineno=167, col_offset=51, end_lineno=167, end_col_offset=59)], ctx=Store(), lineno=167, col_offset=12, end_lineno=167, end_col_offset=59)], value=Subscript(value=Name(id='row', ctx=Load(), lineno=167, col_offset=62, end_lineno=167, end_col_offset=65), slice=Slice(upper=Name(id='PARQUET_ROW_WIDTH', ctx=Load(), lineno=167, col_offset=67, end_lineno=167, end_col_offset=84), lineno=167, col_offset=66, end_lineno=167, end_col_offset=84), ctx=Load(), lineno=167, col_offset=62, end_lineno=167, end_col_offset=85), lineno=167, col_offset=12, end_lineno=167, end_col_offset=85), Expr(value=Call(func=Attribute(value=Name(id='typed_rows', ctx=Load(), lineno=168, col_offset=12, end_lineno=168, end_col_offset=22), attr='append', ctx=Load(), lineno=168, col_offset=12, end_lineno=168, end_col_offset=29), args=[Tuple(elts=[Name(id='chunk_id_val', ctx=Load(), lineno=168, col_offset=31, end_lineno=168, end_col_offset=43), Name(id='doc_id_val', ctx=Load(), lineno=168, col_offset=45, end_lineno=168, end_col_offset=55), Name(id='section_val', ctx=Load(), lineno=168, col_offset=57, end_lineno=168, end_col_offset=68), Name(id='text_val', ctx=Load(), lineno=168, col_offset=70, end_lineno=168, end_col_offset=78)], ctx=Load(), lineno=168, col_offset=30, end_lineno=168, end_col_offset=79)], lineno=168, col_offset=12, end_lineno=168, end_col_offset=80), lineno=168, col_offset=12, end_lineno=168, end_col_offset=80)], lineno=164, col_offset=8, end_lineno=168, end_col_offset=80), Return(value=Name(id='typed_rows', ctx=Load(), lineno=169, col_offset=15, end_lineno=169, end_col_offset=25), lineno=169, col_offset=8, end_lineno=169, end_col_offset=25)], decorator_list=[Name(id='staticmethod', ctx=Load(), lineno=150, col_offset=5, end_lineno=150, end_col_offset=17)], returns=Subscript(value=Name(id='list', ctx=Load(), lineno=153, col_offset=9, end_lineno=153, end_col_offset=13), slice=Subscript(value=Name(id='tuple', ctx=Load(), lineno=153, col_offset=14, end_lineno=153, end_col_offset=19), slice=Tuple(elts=[Name(id='object', ctx=Load(), lineno=153, col_offset=20, end_lineno=153, end_col_offset=26), Name(id='object', ctx=Load(), lineno=153, col_offset=28, end_lineno=153, end_col_offset=34), Name(id='object', ctx=Load(), lineno=153, col_offset=36, end_lineno=153, end_col_offset=42), Name(id='object', ctx=Load(), lineno=153, col_offset=44, end_lineno=153, end_col_offset=50)], ctx=Load(), lineno=153, col_offset=20, end_lineno=153, end_col_offset=50), ctx=Load(), lineno=153, col_offset=14, end_lineno=153, end_col_offset=51), ctx=Load(), lineno=153, col_offset=9, end_lineno=153, end_col_offset=52), lineno=151, col_offset=4, end_lineno=169, end_col_offset=25), FunctionDef(name='_populate_docs', args=arguments(args=[arg(arg='self', lineno=171, col_offset=23, end_lineno=171, end_col_offset=27), arg(arg='rows', annotation=Subscript(value=Name(id='list', ctx=Load(), lineno=171, col_offset=35, end_lineno=171, end_col_offset=39), slice=Subscript(value=Name(id='tuple', ctx=Load(), lineno=171, col_offset=40, end_lineno=171, end_col_offset=45), slice=Tuple(elts=[Name(id='object', ctx=Load(), lineno=171, col_offset=46, end_lineno=171, end_col_offset=52), Name(id='object', ctx=Load(), lineno=171, col_offset=54, end_lineno=171, end_col_offset=60), Name(id='object', ctx=Load(), lineno=171, col_offset=62, end_lineno=171, end_col_offset=68), Name(id='object', ctx=Load(), lineno=171, col_offset=70, end_lineno=171, end_col_offset=76)], ctx=Load(), lineno=171, col_offset=46, end_lineno=171, end_col_offset=76), ctx=Load(), lineno=171, col_offset=40, end_lineno=171, end_col_offset=77), ctx=Load(), lineno=171, col_offset=35, end_lineno=171, end_col_offset=78), lineno=171, col_offset=29, end_lineno=171, end_col_offset=78)]), body=[For(target=Tuple(elts=[Name(id='chunk_id_val', ctx=Store(), lineno=172, col_offset=12, end_lineno=172, end_col_offset=24), Name(id='doc_id_val', ctx=Store(), lineno=172, col_offset=26, end_lineno=172, end_col_offset=36), Name(id='section_val', ctx=Store(), lineno=172, col_offset=38, end_lineno=172, end_col_offset=49), Name(id='text_val', ctx=Store(), lineno=172, col_offset=51, end_lineno=172, end_col_offset=59)], ctx=Store(), lineno=172, col_offset=12, end_lineno=172, end_col_offset=59), iter=Name(id='rows', ctx=Load(), lineno=172, col_offset=63, end_lineno=172, end_col_offset=67), body=[Assign(targets=[Name(id='doc', ctx=Store(), lineno=173, col_offset=12, end_lineno=173, end_col_offset=15)], value=Call(func=Name(id='SpladeDoc', ctx=Load(), lineno=173, col_offset=18, end_lineno=173, end_col_offset=27), keywords=[keyword(arg='chunk_id', value=Call(func=Name(id='str', ctx=Load(), lineno=174, col_offset=25, end_lineno=174, end_col_offset=28), args=[Name(id='chunk_id_val', ctx=Load(), lineno=174, col_offset=29, end_lineno=174, end_col_offset=41)], lineno=174, col_offset=25, end_lineno=174, end_col_offset=42), lineno=174, col_offset=16, end_lineno=174, end_col_offset=42), keyword(arg='doc_id', value=BoolOp(op=Or(), values=[Call(func=Name(id='str', ctx=Load(), lineno=175, col_offset=23, end_lineno=175, end_col_offset=26), args=[Name(id='doc_id_val', ctx=Load(), lineno=175, col_offset=27, end_lineno=175, end_col_offset=37)], lineno=175, col_offset=23, end_lineno=175, end_col_offset=38), Constant(value='urn:doc:fixture', lineno=175, col_offset=42, end_lineno=175, end_col_offset=59)], lineno=175, col_offset=23, end_lineno=175, end_col_offset=59), lineno=175, col_offset=16, end_lineno=175, end_col_offset=59), keyword(arg='section', value=Call(func=Name(id='str', ctx=Load(), lineno=176, col_offset=24, end_lineno=176, end_col_offset=27), args=[Name(id='section_val', ctx=Load(), lineno=176, col_offset=28, end_lineno=176, end_col_offset=39)], lineno=176, col_offset=24, end_lineno=176, end_col_offset=40), lineno=176, col_offset=16, end_lineno=176, end_col_offset=40), keyword(arg='text', value=BoolOp(op=Or(), values=[Call(func=Name(id='str', ctx=Load(), lineno=177, col_offset=21, end_lineno=177, end_col_offset=24), args=[Name(id='text_val', ctx=Load(), lineno=177, col_offset=25, end_lineno=177, end_col_offset=33)], lineno=177, col_offset=21, end_lineno=177, end_col_offset=34), Constant(value='', lineno=177, col_offset=38, end_lineno=177, end_col_offset=40)], lineno=177, col_offset=21, end_lineno=177, end_col_offset=40), lineno=177, col_offset=16, end_lineno=177, end_col_offset=40)], lineno=173, col_offset=18, end_lineno=178, end_col_offset=13), lineno=173, col_offset=12, end_lineno=178, end_col_offset=13), Expr(value=Call(func=Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=179, col_offset=12, end_lineno=179, end_col_offset=16), attr='docs', ctx=Load(), lineno=179, col_offset=12, end_lineno=179, end_col_offset=21), attr='append', ctx=Load(), lineno=179, col_offset=12, end_lineno=179, end_col_offset=28), args=[Name(id='doc', ctx=Load(), lineno=179, col_offset=29, end_lineno=179, end_col_offset=32)], lineno=179, col_offset=12, end_lineno=179, end_col_offset=33), lineno=179, col_offset=12, end_lineno=179, end_col_offset=33)], lineno=172, col_offset=8, end_lineno=179, end_col_offset=33)], returns=Constant(value=None, lineno=171, col_offset=83, end_lineno=171, end_col_offset=87), lineno=171, col_offset=4, end_lineno=179, end_col_offset=33), FunctionDef(name='_recompute_document_frequencies', args=arguments(args=[arg(arg='self', lineno=181, col_offset=40, end_lineno=181, end_col_offset=44)]), body=[Assign(targets=[Attribute(value=Name(id='self', ctx=Load(), lineno=182, col_offset=8, end_lineno=182, end_col_offset=12), attr='N', ctx=Store(), lineno=182, col_offset=8, end_lineno=182, end_col_offset=14)], value=Call(func=Name(id='len', ctx=Load(), lineno=182, col_offset=17, end_lineno=182, end_col_offset=20), args=[Attribute(value=Name(id='self', ctx=Load(), lineno=182, col_offset=21, end_lineno=182, end_col_offset=25), attr='docs', ctx=Load(), lineno=182, col_offset=21, end_lineno=182, end_col_offset=30)], lineno=182, col_offset=17, end_lineno=182, end_col_offset=31), lineno=182, col_offset=8, end_lineno=182, end_col_offset=31), Expr(value=Call(func=Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=183, col_offset=8, end_lineno=183, end_col_offset=12), attr='df', ctx=Load(), lineno=183, col_offset=8, end_lineno=183, end_col_offset=15), attr='clear', ctx=Load(), lineno=183, col_offset=8, end_lineno=183, end_col_offset=21), lineno=183, col_offset=8, end_lineno=183, end_col_offset=23), lineno=183, col_offset=8, end_lineno=183, end_col_offset=23), For(target=Name(id='doc', ctx=Store(), lineno=184, col_offset=12, end_lineno=184, end_col_offset=15), iter=Attribute(value=Name(id='self', ctx=Load(), lineno=184, col_offset=19, end_lineno=184, end_col_offset=23), attr='docs', ctx=Load(), lineno=184, col_offset=19, end_lineno=184, end_col_offset=28), body=[For(target=Name(id='term', ctx=Store(), lineno=185, col_offset=16, end_lineno=185, end_col_offset=20), iter=Call(func=Name(id='set', ctx=Load(), lineno=185, col_offset=24, end_lineno=185, end_col_offset=27), args=[Call(func=Name(id='tok', ctx=Load(), lineno=185, col_offset=28, end_lineno=185, end_col_offset=31), args=[Attribute(value=Name(id='doc', ctx=Load(), lineno=185, col_offset=32, end_lineno=185, end_col_offset=35), attr='text', ctx=Load(), lineno=185, col_offset=32, end_lineno=185, end_col_offset=40)], lineno=185, col_offset=28, end_lineno=185, end_col_offset=41)], lineno=185, col_offset=24, end_lineno=185, end_col_offset=42), body=[Assign(targets=[Subscript(value=Attribute(value=Name(id='self', ctx=Load(), lineno=186, col_offset=16, end_lineno=186, end_col_offset=20), attr='df', ctx=Load(), lineno=186, col_offset=16, end_lineno=186, end_col_offset=23), slice=Name(id='term', ctx=Load(), lineno=186, col_offset=24, end_lineno=186, end_col_offset=28), ctx=Store(), lineno=186, col_offset=16, end_lineno=186, end_col_offset=29)], value=BinOp(left=Call(func=Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=186, col_offset=32, end_lineno=186, end_col_offset=36), attr='df', ctx=Load(), lineno=186, col_offset=32, end_lineno=186, end_col_offset=39), attr='get', ctx=Load(), lineno=186, col_offset=32, end_lineno=186, end_col_offset=43), args=[Name(id='term', ctx=Load(), lineno=186, col_offset=44, end_lineno=186, end_col_offset=48), Constant(value=0, lineno=186, col_offset=50, end_lineno=186, end_col_offset=51)], lineno=186, col_offset=32, end_lineno=186, end_col_offset=52), op=Add(), right=Constant(value=1, lineno=186, col_offset=55, end_lineno=186, end_col_offset=56), lineno=186, col_offset=32, end_lineno=186, end_col_offset=56), lineno=186, col_offset=16, end_lineno=186, end_col_offset=56)], lineno=185, col_offset=12, end_lineno=186, end_col_offset=56)], lineno=184, col_offset=8, end_lineno=186, end_col_offset=56)], returns=Constant(value=None, lineno=181, col_offset=49, end_lineno=181, end_col_offset=53), lineno=181, col_offset=4, end_lineno=186, end_col_offset=56), FunctionDef(name='search', args=arguments(args=[arg(arg='self', lineno=188, col_offset=15, end_lineno=188, end_col_offset=19), arg(arg='query', annotation=Name(id='str', ctx=Load(), lineno=188, col_offset=28, end_lineno=188, end_col_offset=31), lineno=188, col_offset=21, end_lineno=188, end_col_offset=31), arg(arg='k', annotation=Name(id='int', ctx=Load(), lineno=188, col_offset=36, end_lineno=188, end_col_offset=39), lineno=188, col_offset=33, end_lineno=188, end_col_offset=39)], defaults=[Constant(value=10, lineno=188, col_offset=42, end_lineno=188, end_col_offset=44)]), body=[Expr(value=Constant(value='Search documents using TF-IDF scoring.\n\n        Tokenizes the query and scores each document using TF-IDF (term\n        frequency-inverse document frequency). Returns top-k results sorted\n        by relevance score.\n\n        Parameters\n        ----------\n        query : str\n            Search query text.\n        k : int, optional\n            Number of top results to return. Defaults to 10.\n\n        Returns\n        -------\n        list[tuple[int, float]]\n            List of (document_index, score) tuples sorted by score descending.\n            Only documents with score > 0 are included.\n        ', lineno=189, col_offset=8, end_lineno=207, end_col_offset=11), lineno=189, col_offset=8, end_lineno=207, end_col_offset=11), If(test=Compare(left=Attribute(value=Name(id='self', ctx=Load(), lineno=208, col_offset=11, end_lineno=208, end_col_offset=15), attr='N', ctx=Load(), lineno=208, col_offset=11, end_lineno=208, end_col_offset=17), ops=[Eq()], comparators=[Constant(value=0, lineno=208, col_offset=21, end_lineno=208, end_col_offset=22)], lineno=208, col_offset=11, end_lineno=208, end_col_offset=22), body=[Return(value=List(ctx=Load(), lineno=209, col_offset=19, end_lineno=209, end_col_offset=21), lineno=209, col_offset=12, end_lineno=209, end_col_offset=21)], lineno=208, col_offset=8, end_lineno=209, end_col_offset=21), Assign(targets=[Name(id='terms', ctx=Store(), lineno=210, col_offset=8, end_lineno=210, end_col_offset=13)], value=Call(func=Name(id='tok', ctx=Load(), lineno=210, col_offset=16, end_lineno=210, end_col_offset=19), args=[Name(id='query', ctx=Load(), lineno=210, col_offset=20, end_lineno=210, end_col_offset=25)], lineno=210, col_offset=16, end_lineno=210, end_col_offset=26), lineno=210, col_offset=8, end_lineno=210, end_col_offset=26), If(test=UnaryOp(op=Not(), operand=Name(id='terms', ctx=Load(), lineno=211, col_offset=15, end_lineno=211, end_col_offset=20), lineno=211, col_offset=11, end_lineno=211, end_col_offset=20), body=[Return(value=List(ctx=Load(), lineno=212, col_offset=19, end_lineno=212, end_col_offset=21), lineno=212, col_offset=12, end_lineno=212, end_col_offset=21)], lineno=211, col_offset=8, end_lineno=212, end_col_offset=21), Assign(targets=[Name(id='scores', ctx=Store(), lineno=213, col_offset=8, end_lineno=213, end_col_offset=14)], value=BinOp(left=List(elts=[Constant(value=0.0, lineno=213, col_offset=18, end_lineno=213, end_col_offset=21)], ctx=Load(), lineno=213, col_offset=17, end_lineno=213, end_col_offset=22), op=Mult(), right=Attribute(value=Name(id='self', ctx=Load(), lineno=213, col_offset=25, end_lineno=213, end_col_offset=29), attr='N', ctx=Load(), lineno=213, col_offset=25, end_lineno=213, end_col_offset=31), lineno=213, col_offset=17, end_lineno=213, end_col_offset=31), lineno=213, col_offset=8, end_lineno=213, end_col_offset=31), For(target=Tuple(elts=[Name(id='index', ctx=Store(), lineno=214, col_offset=12, end_lineno=214, end_col_offset=17), Name(id='doc', ctx=Store(), lineno=214, col_offset=19, end_lineno=214, end_col_offset=22)], ctx=Store(), lineno=214, col_offset=12, end_lineno=214, end_col_offset=22), iter=Call(func=Name(id='enumerate', ctx=Load(), lineno=214, col_offset=26, end_lineno=214, end_col_offset=35), args=[Attribute(value=Name(id='self', ctx=Load(), lineno=214, col_offset=36, end_lineno=214, end_col_offset=40), attr='docs', ctx=Load(), lineno=214, col_offset=36, end_lineno=214, end_col_offset=45)], lineno=214, col_offset=26, end_lineno=214, end_col_offset=46), body=[AnnAssign(target=Name(id='term_freq', ctx=Store(), lineno=215, col_offset=12, end_lineno=215, end_col_offset=21), annotation=Subscript(value=Name(id='dict', ctx=Load(), lineno=215, col_offset=23, end_lineno=215, end_col_offset=27), slice=Tuple(elts=[Name(id='str', ctx=Load(), lineno=215, col_offset=28, end_lineno=215, end_col_offset=31), Name(id='int', ctx=Load(), lineno=215, col_offset=33, end_lineno=215, end_col_offset=36)], ctx=Load(), lineno=215, col_offset=28, end_lineno=215, end_col_offset=36), ctx=Load(), lineno=215, col_offset=23, end_lineno=215, end_col_offset=37), value=Dict(lineno=215, col_offset=40, end_lineno=215, end_col_offset=42), simple=1, lineno=215, col_offset=12, end_lineno=215, end_col_offset=42), For(target=Name(id='term', ctx=Store(), lineno=216, col_offset=16, end_lineno=216, end_col_offset=20), iter=Call(func=Name(id='tok', ctx=Load(), lineno=216, col_offset=24, end_lineno=216, end_col_offset=27), args=[Attribute(value=Name(id='doc', ctx=Load(), lineno=216, col_offset=28, end_lineno=216, end_col_offset=31), attr='text', ctx=Load(), lineno=216, col_offset=28, end_lineno=216, end_col_offset=36)], lineno=216, col_offset=24, end_lineno=216, end_col_offset=37), body=[Assign(targets=[Subscript(value=Name(id='term_freq', ctx=Load(), lineno=217, col_offset=16, end_lineno=217, end_col_offset=25), slice=Name(id='term', ctx=Load(), lineno=217, col_offset=26, end_lineno=217, end_col_offset=30), ctx=Store(), lineno=217, col_offset=16, end_lineno=217, end_col_offset=31)], value=BinOp(left=Call(func=Attribute(value=Name(id='term_freq', ctx=Load(), lineno=217, col_offset=34, end_lineno=217, end_col_offset=43), attr='get', ctx=Load(), lineno=217, col_offset=34, end_lineno=217, end_col_offset=47), args=[Name(id='term', ctx=Load(), lineno=217, col_offset=48, end_lineno=217, end_col_offset=52), Constant(value=0, lineno=217, col_offset=54, end_lineno=217, end_col_offset=55)], lineno=217, col_offset=34, end_lineno=217, end_col_offset=56), op=Add(), right=Constant(value=1, lineno=217, col_offset=59, end_lineno=217, end_col_offset=60), lineno=217, col_offset=34, end_lineno=217, end_col_offset=60), lineno=217, col_offset=16, end_lineno=217, end_col_offset=60)], lineno=216, col_offset=12, end_lineno=217, end_col_offset=60), Assign(targets=[Name(id='score', ctx=Store(), lineno=218, col_offset=12, end_lineno=218, end_col_offset=17)], value=Constant(value=0.0, lineno=218, col_offset=20, end_lineno=218, end_col_offset=23), lineno=218, col_offset=12, end_lineno=218, end_col_offset=23), For(target=Name(id='term', ctx=Store(), lineno=219, col_offset=16, end_lineno=219, end_col_offset=20), iter=Name(id='terms', ctx=Load(), lineno=219, col_offset=24, end_lineno=219, end_col_offset=29), body=[If(test=Compare(left=Name(id='term', ctx=Load(), lineno=220, col_offset=19, end_lineno=220, end_col_offset=23), ops=[In()], comparators=[Attribute(value=Name(id='self', ctx=Load(), lineno=220, col_offset=27, end_lineno=220, end_col_offset=31), attr='df', ctx=Load(), lineno=220, col_offset=27, end_lineno=220, end_col_offset=34)], lineno=220, col_offset=19, end_lineno=220, end_col_offset=34), body=[Assign(targets=[Name(id='idf', ctx=Store(), lineno=221, col_offset=20, end_lineno=221, end_col_offset=23)], value=BinOp(left=BinOp(left=Attribute(value=Name(id='self', ctx=Load(), lineno=221, col_offset=27, end_lineno=221, end_col_offset=31), attr='N', ctx=Load(), lineno=221, col_offset=27, end_lineno=221, end_col_offset=33), op=Add(), right=Constant(value=1, lineno=221, col_offset=36, end_lineno=221, end_col_offset=37), lineno=221, col_offset=27, end_lineno=221, end_col_offset=37), op=Div(), right=BinOp(left=Subscript(value=Attribute(value=Name(id='self', ctx=Load(), lineno=221, col_offset=42, end_lineno=221, end_col_offset=46), attr='df', ctx=Load(), lineno=221, col_offset=42, end_lineno=221, end_col_offset=49), slice=Name(id='term', ctx=Load(), lineno=221, col_offset=50, end_lineno=221, end_col_offset=54), ctx=Load(), lineno=221, col_offset=42, end_lineno=221, end_col_offset=55), op=Add(), right=Constant(value=0.5, lineno=221, col_offset=58, end_lineno=221, end_col_offset=61), lineno=221, col_offset=42, end_lineno=221, end_col_offset=61), lineno=221, col_offset=26, end_lineno=221, end_col_offset=62), lineno=221, col_offset=20, end_lineno=221, end_col_offset=62), AugAssign(target=Name(id='score', ctx=Store(), lineno=222, col_offset=20, end_lineno=222, end_col_offset=25), op=Add(), value=BinOp(left=Call(func=Attribute(value=Name(id='term_freq', ctx=Load(), lineno=222, col_offset=29, end_lineno=222, end_col_offset=38), attr='get', ctx=Load(), lineno=222, col_offset=29, end_lineno=222, end_col_offset=42), args=[Name(id='term', ctx=Load(), lineno=222, col_offset=43, end_lineno=222, end_col_offset=47), Constant(value=0, lineno=222, col_offset=49, end_lineno=222, end_col_offset=50)], lineno=222, col_offset=29, end_lineno=222, end_col_offset=51), op=Mult(), right=Name(id='idf', ctx=Load(), lineno=222, col_offset=54, end_lineno=222, end_col_offset=57), lineno=222, col_offset=29, end_lineno=222, end_col_offset=57), lineno=222, col_offset=20, end_lineno=222, end_col_offset=57)], lineno=220, col_offset=16, end_lineno=222, end_col_offset=57)], lineno=219, col_offset=12, end_lineno=222, end_col_offset=57), Assign(targets=[Subscript(value=Name(id='scores', ctx=Load(), lineno=223, col_offset=12, end_lineno=223, end_col_offset=18), slice=Name(id='index', ctx=Load(), lineno=223, col_offset=19, end_lineno=223, end_col_offset=24), ctx=Store(), lineno=223, col_offset=12, end_lineno=223, end_col_offset=25)], value=Name(id='score', ctx=Load(), lineno=223, col_offset=28, end_lineno=223, end_col_offset=33), lineno=223, col_offset=12, end_lineno=223, end_col_offset=33)], lineno=214, col_offset=8, end_lineno=223, end_col_offset=33), FunctionDef(name='key_func', args=arguments(args=[arg(arg='item', annotation=Subscript(value=Name(id='tuple', ctx=Load(), lineno=226, col_offset=27, end_lineno=226, end_col_offset=32), slice=Tuple(elts=[Name(id='int', ctx=Load(), lineno=226, col_offset=33, end_lineno=226, end_col_offset=36), Name(id='float', ctx=Load(), lineno=226, col_offset=38, end_lineno=226, end_col_offset=43)], ctx=Load(), lineno=226, col_offset=33, end_lineno=226, end_col_offset=43), ctx=Load(), lineno=226, col_offset=27, end_lineno=226, end_col_offset=44), lineno=226, col_offset=21, end_lineno=226, end_col_offset=44)]), body=[Expr(value=Constant(value='Extract score from (index, score) tuple for sorting.\n\n            Parameters\n            ----------\n            item : tuple[int, float]\n                Tuple of (index, score).\n\n            Returns\n            -------\n            float\n                Score value.\n            ', lineno=227, col_offset=12, end_lineno=238, end_col_offset=15), lineno=227, col_offset=12, end_lineno=238, end_col_offset=15), Return(value=Subscript(value=Name(id='item', ctx=Load(), lineno=239, col_offset=19, end_lineno=239, end_col_offset=23), slice=Constant(value=1, lineno=239, col_offset=24, end_lineno=239, end_col_offset=25), ctx=Load(), lineno=239, col_offset=19, end_lineno=239, end_col_offset=26), lineno=239, col_offset=12, end_lineno=239, end_col_offset=26)], returns=Name(id='float', ctx=Load(), lineno=226, col_offset=49, end_lineno=226, end_col_offset=54), lineno=226, col_offset=8, end_lineno=239, end_col_offset=26), AnnAssign(target=Name(id='ranked', ctx=Store(), lineno=241, col_offset=8, end_lineno=241, end_col_offset=14), annotation=Subscript(value=Name(id='list', ctx=Load(), lineno=241, col_offset=16, end_lineno=241, end_col_offset=20), slice=Subscript(value=Name(id='tuple', ctx=Load(), lineno=241, col_offset=21, end_lineno=241, end_col_offset=26), slice=Tuple(elts=[Name(id='int', ctx=Load(), lineno=241, col_offset=27, end_lineno=241, end_col_offset=30), Name(id='float', ctx=Load(), lineno=241, col_offset=32, end_lineno=241, end_col_offset=37)], ctx=Load(), lineno=241, col_offset=27, end_lineno=241, end_col_offset=37), ctx=Load(), lineno=241, col_offset=21, end_lineno=241, end_col_offset=38), ctx=Load(), lineno=241, col_offset=16, end_lineno=241, end_col_offset=39), value=Call(func=Name(id='sorted', ctx=Load(), lineno=241, col_offset=42, end_lineno=241, end_col_offset=48), args=[Call(func=Name(id='enumerate', ctx=Load(), lineno=241, col_offset=49, end_lineno=241, end_col_offset=58), args=[Name(id='scores', ctx=Load(), lineno=241, col_offset=59, end_lineno=241, end_col_offset=65)], lineno=241, col_offset=49, end_lineno=241, end_col_offset=66)], keywords=[keyword(arg='key', value=Name(id='key_func', ctx=Load(), lineno=241, col_offset=72, end_lineno=241, end_col_offset=80), lineno=241, col_offset=68, end_lineno=241, end_col_offset=80), keyword(arg='reverse', value=Constant(value=True, lineno=241, col_offset=90, end_lineno=241, end_col_offset=94), lineno=241, col_offset=82, end_lineno=241, end_col_offset=94)], lineno=241, col_offset=42, end_lineno=241, end_col_offset=95), simple=1, lineno=241, col_offset=8, end_lineno=241, end_col_offset=95), Return(value=ListComp(elt=Tuple(elts=[Name(id='idx', ctx=Load(), lineno=242, col_offset=17, end_lineno=242, end_col_offset=20), Name(id='value', ctx=Load(), lineno=242, col_offset=22, end_lineno=242, end_col_offset=27)], ctx=Load(), lineno=242, col_offset=16, end_lineno=242, end_col_offset=28), generators=[comprehension(target=Tuple(elts=[Name(id='idx', ctx=Store(), lineno=242, col_offset=33, end_lineno=242, end_col_offset=36), Name(id='value', ctx=Store(), lineno=242, col_offset=38, end_lineno=242, end_col_offset=43)], ctx=Store(), lineno=242, col_offset=33, end_lineno=242, end_col_offset=43), iter=Subscript(value=Name(id='ranked', ctx=Load(), lineno=242, col_offset=47, end_lineno=242, end_col_offset=53), slice=Slice(upper=Name(id='k', ctx=Load(), lineno=242, col_offset=55, end_lineno=242, end_col_offset=56), lineno=242, col_offset=54, end_lineno=242, end_col_offset=56), ctx=Load(), lineno=242, col_offset=47, end_lineno=242, end_col_offset=57), ifs=[Compare(left=Name(id='value', ctx=Load(), lineno=242, col_offset=61, end_lineno=242, end_col_offset=66), ops=[Gt()], comparators=[Constant(value=0.0, lineno=242, col_offset=69, end_lineno=242, end_col_offset=72)], lineno=242, col_offset=61, end_lineno=242, end_col_offset=72)], is_async=0)], lineno=242, col_offset=15, end_lineno=242, end_col_offset=73), lineno=242, col_offset=8, end_lineno=242, end_col_offset=73)], returns=Subscript(value=Name(id='list', ctx=Load(), lineno=188, col_offset=49, end_lineno=188, end_col_offset=53), slice=Subscript(value=Name(id='tuple', ctx=Load(), lineno=188, col_offset=54, end_lineno=188, end_col_offset=59), slice=Tuple(elts=[Name(id='int', ctx=Load(), lineno=188, col_offset=60, end_lineno=188, end_col_offset=63), Name(id='float', ctx=Load(), lineno=188, col_offset=65, end_lineno=188, end_col_offset=70)], ctx=Load(), lineno=188, col_offset=60, end_lineno=188, end_col_offset=70), ctx=Load(), lineno=188, col_offset=54, end_lineno=188, end_col_offset=71), ctx=Load(), lineno=188, col_offset=49, end_lineno=188, end_col_offset=72), lineno=188, col_offset=4, end_lineno=242, end_col_offset=73), FunctionDef(name='doc', args=arguments(args=[arg(arg='self', lineno=244, col_offset=12, end_lineno=244, end_col_offset=16), arg(arg='index', annotation=Name(id='int', ctx=Load(), lineno=244, col_offset=25, end_lineno=244, end_col_offset=28), lineno=244, col_offset=18, end_lineno=244, end_col_offset=28)]), body=[Expr(value=Constant(value='Get document by index.\n\n        Retrieves the document at the specified index from the loaded\n        documents list.\n\n        Parameters\n        ----------\n        index : int\n            Document index (0-based).\n\n        Returns\n        -------\n        SpladeDoc\n            Document fixture at the specified index.\n        ', lineno=245, col_offset=8, end_lineno=259, end_col_offset=11), lineno=245, col_offset=8, end_lineno=259, end_col_offset=11), Return(value=Subscript(value=Attribute(value=Name(id='self', ctx=Load(), lineno=260, col_offset=15, end_lineno=260, end_col_offset=19), attr='docs', ctx=Load(), lineno=260, col_offset=15, end_lineno=260, end_col_offset=24), slice=Name(id='index', ctx=Load(), lineno=260, col_offset=25, end_lineno=260, end_col_offset=30), ctx=Load(), lineno=260, col_offset=15, end_lineno=260, end_col_offset=31), lineno=260, col_offset=8, end_lineno=260, end_col_offset=31)], returns=Name(id='SpladeDoc', ctx=Load(), lineno=244, col_offset=33, end_lineno=244, end_col_offset=42), lineno=244, col_offset=4, end_lineno=260, end_col_offset=31)], lineno=87, col_offset=0, end_lineno=260, end_col_offset=31)])