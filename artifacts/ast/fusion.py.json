Module(body=[Expr(value=Constant(value='Overview of fusion.\n\nThis module bundles fusion logic for the kgfoundry stack. It groups related helpers so downstream\npackages can import a single cohesive namespace. Refer to the functions and classes below for\nimplementation specifics.\n', lineno=1, col_offset=0, end_lineno=6, end_col_offset=3), lineno=1, col_offset=0, end_lineno=6, end_col_offset=3), ImportFrom(module='__future__', names=[alias(name='annotations', lineno=10, col_offset=23, end_lineno=10, end_col_offset=34)], level=0, lineno=10, col_offset=0, end_lineno=10, end_col_offset=34), ImportFrom(module='kgfoundry_common.navmap_loader', names=[alias(name='load_nav_metadata', lineno=12, col_offset=43, end_lineno=12, end_col_offset=60)], level=0, lineno=12, col_offset=0, end_lineno=12, end_col_offset=60), Assign(targets=[Name(id='__all__', ctx=Store(), lineno=14, col_offset=0, end_lineno=14, end_col_offset=7)], value=List(elts=[Constant(value='rrf_fuse', lineno=15, col_offset=4, end_lineno=15, end_col_offset=14)], ctx=Load(), lineno=14, col_offset=10, end_lineno=16, end_col_offset=1), lineno=14, col_offset=0, end_lineno=16, end_col_offset=1), Assign(targets=[Name(id='__navmap__', ctx=Store(), lineno=17, col_offset=0, end_lineno=17, end_col_offset=10)], value=Call(func=Name(id='load_nav_metadata', ctx=Load(), lineno=17, col_offset=13, end_lineno=17, end_col_offset=30), args=[Name(id='__name__', ctx=Load(), lineno=17, col_offset=31, end_lineno=17, end_col_offset=39), Call(func=Name(id='tuple', ctx=Load(), lineno=17, col_offset=41, end_lineno=17, end_col_offset=46), args=[Name(id='__all__', ctx=Load(), lineno=17, col_offset=47, end_lineno=17, end_col_offset=54)], lineno=17, col_offset=41, end_lineno=17, end_col_offset=55)], lineno=17, col_offset=13, end_lineno=17, end_col_offset=56), lineno=17, col_offset=0, end_lineno=17, end_col_offset=56), FunctionDef(name='rrf_fuse', args=arguments(args=[arg(arg='rankers', annotation=Subscript(value=Name(id='list', ctx=Load(), lineno=21, col_offset=22, end_lineno=21, end_col_offset=26), slice=Subscript(value=Name(id='list', ctx=Load(), lineno=21, col_offset=27, end_lineno=21, end_col_offset=31), slice=Subscript(value=Name(id='tuple', ctx=Load(), lineno=21, col_offset=32, end_lineno=21, end_col_offset=37), slice=Tuple(elts=[Name(id='str', ctx=Load(), lineno=21, col_offset=38, end_lineno=21, end_col_offset=41), Name(id='float', ctx=Load(), lineno=21, col_offset=43, end_lineno=21, end_col_offset=48)], ctx=Load(), lineno=21, col_offset=38, end_lineno=21, end_col_offset=48), ctx=Load(), lineno=21, col_offset=32, end_lineno=21, end_col_offset=49), ctx=Load(), lineno=21, col_offset=27, end_lineno=21, end_col_offset=50), ctx=Load(), lineno=21, col_offset=22, end_lineno=21, end_col_offset=51), lineno=21, col_offset=13, end_lineno=21, end_col_offset=51), arg(arg='k_rrf', annotation=Name(id='int', ctx=Load(), lineno=21, col_offset=60, end_lineno=21, end_col_offset=63), lineno=21, col_offset=53, end_lineno=21, end_col_offset=63)], defaults=[Constant(value=60, lineno=21, col_offset=66, end_lineno=21, end_col_offset=68)]), body=[Expr(value=Constant(value='Fuse multiple ranked lists using Reciprocal Rank Fusion (RRF).\n\n    Combines multiple ranked lists into a single fused ranking by summing\n    reciprocal rank scores across all lists. Items appearing in multiple\n    lists receive higher scores.\n\n    Parameters\n    ----------\n    rankers : list[list[tuple[str, float]]]\n        List of ranked lists, where each inner list contains (item_id, score)\n        tuples sorted by score (descending).\n    k_rrf : int, optional\n        RRF constant used to dampen the contribution of lower ranks.\n        Defaults to 60.\n\n    Returns\n    -------\n    dict[str, float]\n        Dictionary mapping item IDs to their fused RRF scores.\n    ', lineno=22, col_offset=4, end_lineno=41, end_col_offset=7), lineno=22, col_offset=4, end_lineno=41, end_col_offset=7), AnnAssign(target=Name(id='agg', ctx=Store(), lineno=42, col_offset=4, end_lineno=42, end_col_offset=7), annotation=Subscript(value=Name(id='dict', ctx=Load(), lineno=42, col_offset=9, end_lineno=42, end_col_offset=13), slice=Tuple(elts=[Name(id='str', ctx=Load(), lineno=42, col_offset=14, end_lineno=42, end_col_offset=17), Name(id='float', ctx=Load(), lineno=42, col_offset=19, end_lineno=42, end_col_offset=24)], ctx=Load(), lineno=42, col_offset=14, end_lineno=42, end_col_offset=24), ctx=Load(), lineno=42, col_offset=9, end_lineno=42, end_col_offset=25), value=Dict(lineno=42, col_offset=28, end_lineno=42, end_col_offset=30), simple=1, lineno=42, col_offset=4, end_lineno=42, end_col_offset=30), For(target=Name(id='ranked', ctx=Store(), lineno=43, col_offset=8, end_lineno=43, end_col_offset=14), iter=Name(id='rankers', ctx=Load(), lineno=43, col_offset=18, end_lineno=43, end_col_offset=25), body=[For(target=Tuple(elts=[Name(id='r', ctx=Store(), lineno=44, col_offset=12, end_lineno=44, end_col_offset=13), Tuple(elts=[Name(id='key', ctx=Store(), lineno=44, col_offset=16, end_lineno=44, end_col_offset=19), Name(id='_score', ctx=Store(), lineno=44, col_offset=21, end_lineno=44, end_col_offset=27)], ctx=Store(), lineno=44, col_offset=15, end_lineno=44, end_col_offset=28)], ctx=Store(), lineno=44, col_offset=12, end_lineno=44, end_col_offset=28), iter=Call(func=Name(id='enumerate', ctx=Load(), lineno=44, col_offset=32, end_lineno=44, end_col_offset=41), args=[Name(id='ranked', ctx=Load(), lineno=44, col_offset=42, end_lineno=44, end_col_offset=48)], keywords=[keyword(arg='start', value=Constant(value=1, lineno=44, col_offset=56, end_lineno=44, end_col_offset=57), lineno=44, col_offset=50, end_lineno=44, end_col_offset=57)], lineno=44, col_offset=32, end_lineno=44, end_col_offset=58), body=[Assign(targets=[Subscript(value=Name(id='agg', ctx=Load(), lineno=45, col_offset=12, end_lineno=45, end_col_offset=15), slice=Name(id='key', ctx=Load(), lineno=45, col_offset=16, end_lineno=45, end_col_offset=19), ctx=Store(), lineno=45, col_offset=12, end_lineno=45, end_col_offset=20)], value=BinOp(left=Call(func=Attribute(value=Name(id='agg', ctx=Load(), lineno=45, col_offset=23, end_lineno=45, end_col_offset=26), attr='get', ctx=Load(), lineno=45, col_offset=23, end_lineno=45, end_col_offset=30), args=[Name(id='key', ctx=Load(), lineno=45, col_offset=31, end_lineno=45, end_col_offset=34), Constant(value=0.0, lineno=45, col_offset=36, end_lineno=45, end_col_offset=39)], lineno=45, col_offset=23, end_lineno=45, end_col_offset=40), op=Add(), right=BinOp(left=Constant(value=1.0, lineno=45, col_offset=43, end_lineno=45, end_col_offset=46), op=Div(), right=BinOp(left=Name(id='k_rrf', ctx=Load(), lineno=45, col_offset=50, end_lineno=45, end_col_offset=55), op=Add(), right=Name(id='r', ctx=Load(), lineno=45, col_offset=58, end_lineno=45, end_col_offset=59), lineno=45, col_offset=50, end_lineno=45, end_col_offset=59), lineno=45, col_offset=43, end_lineno=45, end_col_offset=60), lineno=45, col_offset=23, end_lineno=45, end_col_offset=60), lineno=45, col_offset=12, end_lineno=45, end_col_offset=60)], lineno=44, col_offset=8, end_lineno=45, end_col_offset=60)], lineno=43, col_offset=4, end_lineno=45, end_col_offset=60), Return(value=Name(id='agg', ctx=Load(), lineno=46, col_offset=11, end_lineno=46, end_col_offset=14), lineno=46, col_offset=4, end_lineno=46, end_col_offset=14)], returns=Subscript(value=Name(id='dict', ctx=Load(), lineno=21, col_offset=73, end_lineno=21, end_col_offset=77), slice=Tuple(elts=[Name(id='str', ctx=Load(), lineno=21, col_offset=78, end_lineno=21, end_col_offset=81), Name(id='float', ctx=Load(), lineno=21, col_offset=83, end_lineno=21, end_col_offset=88)], ctx=Load(), lineno=21, col_offset=78, end_lineno=21, end_col_offset=88), ctx=Load(), lineno=21, col_offset=73, end_lineno=21, end_col_offset=89), lineno=21, col_offset=0, end_lineno=46, end_col_offset=14)])