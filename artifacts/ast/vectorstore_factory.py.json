Module(body=[Expr(value=Constant(value='Dependency-injected factory for FAISS vectorstore adapters with observability.\n\nThis module provides configuration models and a factory abstraction for building\nand managing FAISS indexes with structured logging, Prometheus metrics, and\nRFC 9457 Problem Details error handling.\n\nExamples\n--------\n>>> from search_api.vectorstore_factory import FaissAdapterSettings, FaissVectorstoreFactory\n>>> import tempfile\n>>> with tempfile.TemporaryDirectory() as tmpdir:\n...     settings = FaissAdapterSettings(\n...         db_path="vectors.parquet",\n...         index_path=f"{tmpdir}/index.idx",\n...         factory="Flat",\n...         metric="ip",\n...     )\n...     factory = FaissVectorstoreFactory(settings)\n...     adapter = factory.build_adapter()\n', lineno=1, col_offset=0, end_lineno=20, end_col_offset=3), lineno=1, col_offset=0, end_lineno=20, end_col_offset=3), ImportFrom(module='__future__', names=[alias(name='annotations', lineno=24, col_offset=23, end_lineno=24, end_col_offset=34)], level=0, lineno=24, col_offset=0, end_lineno=24, end_col_offset=34), Import(names=[alias(name='logging', lineno=26, col_offset=7, end_lineno=26, end_col_offset=14)], lineno=26, col_offset=0, end_lineno=26, end_col_offset=14), Import(names=[alias(name='time', lineno=27, col_offset=7, end_lineno=27, end_col_offset=11)], lineno=27, col_offset=0, end_lineno=27, end_col_offset=11), ImportFrom(module='dataclasses', names=[alias(name='dataclass', lineno=28, col_offset=24, end_lineno=28, end_col_offset=33), alias(name='field', lineno=28, col_offset=35, end_lineno=28, end_col_offset=40)], level=0, lineno=28, col_offset=0, end_lineno=28, end_col_offset=40), ImportFrom(module='typing', names=[alias(name='TYPE_CHECKING', lineno=29, col_offset=19, end_lineno=29, end_col_offset=32), alias(name='Final', lineno=29, col_offset=34, end_lineno=29, end_col_offset=39)], level=0, lineno=29, col_offset=0, end_lineno=29, end_col_offset=39), ImportFrom(module='kgfoundry_common.errors', names=[alias(name='IndexBuildError', lineno=31, col_offset=36, end_lineno=31, end_col_offset=51)], level=0, lineno=31, col_offset=0, end_lineno=31, end_col_offset=51), ImportFrom(module='kgfoundry_common.navmap_loader', names=[alias(name='load_nav_metadata', lineno=32, col_offset=43, end_lineno=32, end_col_offset=60)], level=0, lineno=32, col_offset=0, end_lineno=32, end_col_offset=60), ImportFrom(module='kgfoundry_common.prometheus', names=[alias(name='build_counter', lineno=33, col_offset=40, end_lineno=33, end_col_offset=53), alias(name='build_histogram', lineno=33, col_offset=55, end_lineno=33, end_col_offset=70)], level=0, lineno=33, col_offset=0, end_lineno=33, end_col_offset=70), ImportFrom(module='search_api.faiss_adapter', names=[alias(name='FaissAdapter', lineno=34, col_offset=37, end_lineno=34, end_col_offset=49)], level=0, lineno=34, col_offset=0, end_lineno=34, end_col_offset=49), If(test=Name(id='TYPE_CHECKING', ctx=Load(), lineno=36, col_offset=3, end_lineno=36, end_col_offset=16), body=[ImportFrom(module='kgfoundry_common.prometheus', names=[alias(name='CounterLike', lineno=37, col_offset=44, end_lineno=37, end_col_offset=55), alias(name='HistogramLike', lineno=37, col_offset=57, end_lineno=37, end_col_offset=70)], level=0, lineno=37, col_offset=4, end_lineno=37, end_col_offset=70)], lineno=36, col_offset=0, end_lineno=37, end_col_offset=70), Assign(targets=[Name(id='__all__', ctx=Store(), lineno=40, col_offset=0, end_lineno=40, end_col_offset=7)], value=List(elts=[Constant(value='FaissAdapterSettings', lineno=41, col_offset=4, end_lineno=41, end_col_offset=26), Constant(value='FaissVectorstoreFactory', lineno=42, col_offset=4, end_lineno=42, end_col_offset=29)], ctx=Load(), lineno=40, col_offset=10, end_lineno=43, end_col_offset=1), lineno=40, col_offset=0, end_lineno=43, end_col_offset=1), Assign(targets=[Name(id='__navmap__', ctx=Store(), lineno=44, col_offset=0, end_lineno=44, end_col_offset=10)], value=Call(func=Name(id='load_nav_metadata', ctx=Load(), lineno=44, col_offset=13, end_lineno=44, end_col_offset=30), args=[Name(id='__name__', ctx=Load(), lineno=44, col_offset=31, end_lineno=44, end_col_offset=39), Call(func=Name(id='tuple', ctx=Load(), lineno=44, col_offset=41, end_lineno=44, end_col_offset=46), args=[Name(id='__all__', ctx=Load(), lineno=44, col_offset=47, end_lineno=44, end_col_offset=54)], lineno=44, col_offset=41, end_lineno=44, end_col_offset=55)], lineno=44, col_offset=13, end_lineno=44, end_col_offset=56), lineno=44, col_offset=0, end_lineno=44, end_col_offset=56), Assign(targets=[Name(id='logger', ctx=Store(), lineno=47, col_offset=0, end_lineno=47, end_col_offset=6)], value=Call(func=Attribute(value=Name(id='logging', ctx=Load(), lineno=47, col_offset=9, end_lineno=47, end_col_offset=16), attr='getLogger', ctx=Load(), lineno=47, col_offset=9, end_lineno=47, end_col_offset=26), args=[Name(id='__name__', ctx=Load(), lineno=47, col_offset=27, end_lineno=47, end_col_offset=35)], lineno=47, col_offset=9, end_lineno=47, end_col_offset=36), lineno=47, col_offset=0, end_lineno=47, end_col_offset=36), AnnAssign(target=Name(id='DEFAULT_INDEX_TIMEOUT_SECONDS', ctx=Store(), lineno=49, col_offset=0, end_lineno=49, end_col_offset=29), annotation=Subscript(value=Name(id='Final', ctx=Load(), lineno=49, col_offset=31, end_lineno=49, end_col_offset=36), slice=Name(id='int', ctx=Load(), lineno=49, col_offset=37, end_lineno=49, end_col_offset=40), ctx=Load(), lineno=49, col_offset=31, end_lineno=49, end_col_offset=41), value=Constant(value=3600, lineno=49, col_offset=44, end_lineno=49, end_col_offset=48), simple=1, lineno=49, col_offset=0, end_lineno=49, end_col_offset=48), Expr(value=Constant(value='Default timeout for index build operations (1 hour).', lineno=50, col_offset=0, end_lineno=50, end_col_offset=58), lineno=50, col_offset=0, end_lineno=50, end_col_offset=58), AnnAssign(target=Name(id='DEFAULT_NPROBE', ctx=Store(), lineno=52, col_offset=0, end_lineno=52, end_col_offset=14), annotation=Subscript(value=Name(id='Final', ctx=Load(), lineno=52, col_offset=16, end_lineno=52, end_col_offset=21), slice=Name(id='int', ctx=Load(), lineno=52, col_offset=22, end_lineno=52, end_col_offset=25), ctx=Load(), lineno=52, col_offset=16, end_lineno=52, end_col_offset=26), value=Constant(value=64, lineno=52, col_offset=29, end_lineno=52, end_col_offset=31), simple=1, lineno=52, col_offset=0, end_lineno=52, end_col_offset=31), Expr(value=Constant(value='Default nprobe parameter for IVF indexes.', lineno=53, col_offset=0, end_lineno=53, end_col_offset=47), lineno=53, col_offset=0, end_lineno=53, end_col_offset=47), AnnAssign(target=Name(id='VALID_METRICS', ctx=Store(), lineno=55, col_offset=0, end_lineno=55, end_col_offset=13), annotation=Subscript(value=Name(id='Final', ctx=Load(), lineno=55, col_offset=15, end_lineno=55, end_col_offset=20), slice=Subscript(value=Name(id='set', ctx=Load(), lineno=55, col_offset=21, end_lineno=55, end_col_offset=24), slice=Name(id='str', ctx=Load(), lineno=55, col_offset=25, end_lineno=55, end_col_offset=28), ctx=Load(), lineno=55, col_offset=21, end_lineno=55, end_col_offset=29), ctx=Load(), lineno=55, col_offset=15, end_lineno=55, end_col_offset=30), value=Set(elts=[Constant(value='ip', lineno=55, col_offset=34, end_lineno=55, end_col_offset=38), Constant(value='l2', lineno=55, col_offset=40, end_lineno=55, end_col_offset=44)], lineno=55, col_offset=33, end_lineno=55, end_col_offset=45), simple=1, lineno=55, col_offset=0, end_lineno=55, end_col_offset=45), Expr(value=Constant(value='Valid metric types for FAISS indexes.', lineno=56, col_offset=0, end_lineno=56, end_col_offset=43), lineno=56, col_offset=0, end_lineno=56, end_col_offset=43), Assign(targets=[Name(id='_METRIC_STAGE_LABEL', ctx=Store(), lineno=58, col_offset=0, end_lineno=58, end_col_offset=19)], value=Constant(value='ingestion', lineno=58, col_offset=22, end_lineno=58, end_col_offset=33), lineno=58, col_offset=0, end_lineno=58, end_col_offset=33), AnnAssign(target=Name(id='_BUILD_COUNTER', ctx=Store(), lineno=60, col_offset=0, end_lineno=60, end_col_offset=14), annotation=Name(id='CounterLike', ctx=Load(), lineno=60, col_offset=16, end_lineno=60, end_col_offset=27), value=Call(func=Name(id='build_counter', ctx=Load(), lineno=60, col_offset=30, end_lineno=60, end_col_offset=43), args=[Constant(value='kgfoundry_vector_ingestion_total', lineno=61, col_offset=4, end_lineno=61, end_col_offset=38), Constant(value='Total FAISS vector ingestion operations', lineno=62, col_offset=4, end_lineno=62, end_col_offset=45), Tuple(elts=[Constant(value='stage', lineno=63, col_offset=5, end_lineno=63, end_col_offset=12), Constant(value='operation', lineno=63, col_offset=14, end_lineno=63, end_col_offset=25), Constant(value='status', lineno=63, col_offset=27, end_lineno=63, end_col_offset=35)], ctx=Load(), lineno=63, col_offset=4, end_lineno=63, end_col_offset=36)], lineno=60, col_offset=30, end_lineno=64, end_col_offset=1), simple=1, lineno=60, col_offset=0, end_lineno=64, end_col_offset=1), AnnAssign(target=Name(id='_BUILD_DURATION', ctx=Store(), lineno=66, col_offset=0, end_lineno=66, end_col_offset=15), annotation=Name(id='HistogramLike', ctx=Load(), lineno=66, col_offset=17, end_lineno=66, end_col_offset=30), value=Call(func=Name(id='build_histogram', ctx=Load(), lineno=66, col_offset=33, end_lineno=66, end_col_offset=48), args=[Constant(value='kgfoundry_vector_ingestion_duration_seconds', lineno=67, col_offset=4, end_lineno=67, end_col_offset=49), Constant(value='FAISS vector ingestion duration in seconds', lineno=68, col_offset=4, end_lineno=68, end_col_offset=48), Tuple(elts=[Constant(value='stage', lineno=69, col_offset=5, end_lineno=69, end_col_offset=12), Constant(value='operation', lineno=69, col_offset=14, end_lineno=69, end_col_offset=25)], ctx=Load(), lineno=69, col_offset=4, end_lineno=69, end_col_offset=26)], lineno=66, col_offset=33, end_lineno=70, end_col_offset=1), simple=1, lineno=66, col_offset=0, end_lineno=70, end_col_offset=1), FunctionDef(name='_ingestion_extra', args=arguments(kwonlyargs=[arg(arg='correlation_id', annotation=BinOp(left=Name(id='str', ctx=Load(), lineno=74, col_offset=23, end_lineno=74, end_col_offset=26), op=BitOr(), right=Constant(value=None, lineno=74, col_offset=29, end_lineno=74, end_col_offset=33), lineno=74, col_offset=23, end_lineno=74, end_col_offset=33), lineno=74, col_offset=7, end_lineno=74, end_col_offset=33)], kw_defaults=[Constant(value=None, lineno=74, col_offset=36, end_lineno=74, end_col_offset=40)], kwarg=arg(arg='extra_fields', annotation=Name(id='object', ctx=Load(), lineno=74, col_offset=58, end_lineno=74, end_col_offset=64), lineno=74, col_offset=44, end_lineno=74, end_col_offset=64)), body=[Assign(targets=[Name(id='base', ctx=Store(), lineno=76, col_offset=4, end_lineno=76, end_col_offset=8)], value=Call(func=Name(id='dict', ctx=Load(), lineno=76, col_offset=11, end_lineno=76, end_col_offset=15), args=[Name(id='extra_fields', ctx=Load(), lineno=76, col_offset=16, end_lineno=76, end_col_offset=28)], lineno=76, col_offset=11, end_lineno=76, end_col_offset=29), lineno=76, col_offset=4, end_lineno=76, end_col_offset=29), If(test=Name(id='correlation_id', ctx=Load(), lineno=77, col_offset=7, end_lineno=77, end_col_offset=21), body=[Assign(targets=[Subscript(value=Name(id='base', ctx=Load(), lineno=78, col_offset=8, end_lineno=78, end_col_offset=12), slice=Constant(value='correlation_id', lineno=78, col_offset=13, end_lineno=78, end_col_offset=29), ctx=Store(), lineno=78, col_offset=8, end_lineno=78, end_col_offset=30)], value=Name(id='correlation_id', ctx=Load(), lineno=78, col_offset=33, end_lineno=78, end_col_offset=47), lineno=78, col_offset=8, end_lineno=78, end_col_offset=47)], lineno=77, col_offset=4, end_lineno=78, end_col_offset=47), Expr(value=Call(func=Attribute(value=Name(id='base', ctx=Load(), lineno=79, col_offset=4, end_lineno=79, end_col_offset=8), attr='setdefault', ctx=Load(), lineno=79, col_offset=4, end_lineno=79, end_col_offset=19), args=[Constant(value='stage', lineno=79, col_offset=20, end_lineno=79, end_col_offset=27), Name(id='_METRIC_STAGE_LABEL', ctx=Load(), lineno=79, col_offset=29, end_lineno=79, end_col_offset=48)], lineno=79, col_offset=4, end_lineno=79, end_col_offset=49), lineno=79, col_offset=4, end_lineno=79, end_col_offset=49), Return(value=Name(id='base', ctx=Load(), lineno=80, col_offset=11, end_lineno=80, end_col_offset=15), lineno=80, col_offset=4, end_lineno=80, end_col_offset=15)], returns=Subscript(value=Name(id='dict', ctx=Load(), lineno=75, col_offset=5, end_lineno=75, end_col_offset=9), slice=Tuple(elts=[Name(id='str', ctx=Load(), lineno=75, col_offset=10, end_lineno=75, end_col_offset=13), Name(id='object', ctx=Load(), lineno=75, col_offset=15, end_lineno=75, end_col_offset=21)], ctx=Load(), lineno=75, col_offset=10, end_lineno=75, end_col_offset=21), ctx=Load(), lineno=75, col_offset=5, end_lineno=75, end_col_offset=22), lineno=73, col_offset=0, end_lineno=80, end_col_offset=15), FunctionDef(name='_observe_metrics', args=arguments(args=[arg(arg='operation', annotation=Name(id='str', ctx=Load(), lineno=83, col_offset=32, end_lineno=83, end_col_offset=35), lineno=83, col_offset=21, end_lineno=83, end_col_offset=35), arg(arg='status', annotation=Name(id='str', ctx=Load(), lineno=83, col_offset=45, end_lineno=83, end_col_offset=48), lineno=83, col_offset=37, end_lineno=83, end_col_offset=48), arg(arg='duration_seconds', annotation=Name(id='float', ctx=Load(), lineno=83, col_offset=68, end_lineno=83, end_col_offset=73), lineno=83, col_offset=50, end_lineno=83, end_col_offset=73)]), body=[Assign(targets=[Name(id='labels', ctx=Store(), lineno=84, col_offset=4, end_lineno=84, end_col_offset=10)], value=Dict(keys=[Constant(value='stage', lineno=84, col_offset=14, end_lineno=84, end_col_offset=21), Constant(value='operation', lineno=84, col_offset=44, end_lineno=84, end_col_offset=55), Constant(value='status', lineno=84, col_offset=68, end_lineno=84, end_col_offset=76)], values=[Name(id='_METRIC_STAGE_LABEL', ctx=Load(), lineno=84, col_offset=23, end_lineno=84, end_col_offset=42), Name(id='operation', ctx=Load(), lineno=84, col_offset=57, end_lineno=84, end_col_offset=66), Name(id='status', ctx=Load(), lineno=84, col_offset=78, end_lineno=84, end_col_offset=84)], lineno=84, col_offset=13, end_lineno=84, end_col_offset=85), lineno=84, col_offset=4, end_lineno=84, end_col_offset=85), Expr(value=Call(func=Attribute(value=Call(func=Attribute(value=Name(id='_BUILD_COUNTER', ctx=Load(), lineno=85, col_offset=4, end_lineno=85, end_col_offset=18), attr='labels', ctx=Load(), lineno=85, col_offset=4, end_lineno=85, end_col_offset=25), keywords=[keyword(value=Name(id='labels', ctx=Load(), lineno=85, col_offset=28, end_lineno=85, end_col_offset=34), lineno=85, col_offset=26, end_lineno=85, end_col_offset=34)], lineno=85, col_offset=4, end_lineno=85, end_col_offset=35), attr='inc', ctx=Load(), lineno=85, col_offset=4, end_lineno=85, end_col_offset=39), lineno=85, col_offset=4, end_lineno=85, end_col_offset=41), lineno=85, col_offset=4, end_lineno=85, end_col_offset=41), Expr(value=Call(func=Attribute(value=Call(func=Attribute(value=Name(id='_BUILD_DURATION', ctx=Load(), lineno=86, col_offset=4, end_lineno=86, end_col_offset=19), attr='labels', ctx=Load(), lineno=86, col_offset=4, end_lineno=86, end_col_offset=26), keywords=[keyword(arg='stage', value=Name(id='_METRIC_STAGE_LABEL', ctx=Load(), lineno=86, col_offset=33, end_lineno=86, end_col_offset=52), lineno=86, col_offset=27, end_lineno=86, end_col_offset=52), keyword(arg='operation', value=Name(id='operation', ctx=Load(), lineno=86, col_offset=64, end_lineno=86, end_col_offset=73), lineno=86, col_offset=54, end_lineno=86, end_col_offset=73)], lineno=86, col_offset=4, end_lineno=86, end_col_offset=74), attr='observe', ctx=Load(), lineno=86, col_offset=4, end_lineno=86, end_col_offset=82), args=[Name(id='duration_seconds', ctx=Load(), lineno=86, col_offset=83, end_lineno=86, end_col_offset=99)], lineno=86, col_offset=4, end_lineno=86, end_col_offset=100), lineno=86, col_offset=4, end_lineno=86, end_col_offset=100)], returns=Constant(value=None, lineno=83, col_offset=78, end_lineno=83, end_col_offset=82), lineno=83, col_offset=0, end_lineno=86, end_col_offset=100), ClassDef(name='FaissAdapterSettings', body=[Expr(value=Constant(value='Configuration for FAISS adapter instances.\n\n    This immutable dataclass captures all parameters needed to construct\n    a :class:`FaissAdapter` with consistent defaults and validation. Inline\n    attribute docstrings describe alias usage for documentation alignment.\n\n    Attributes\n    ----------\n    db_path : str\n        DuckDB registry or Parquet vector path.\n    index_path : str\n        Filesystem path for the built index.\n    factory : str\n        FAISS factory string (e.g., ``"OPQ64,IVF8192,PQ64"``).\n    metric : str\n        Similarity metric (``"ip"`` or ``"l2"``).\n    nprobe : int\n        IVF search parameter ``nprobe``.\n    use_gpu : bool\n        Enable GPU acceleration flag.\n    use_cuvs : bool\n        Enable cuVS acceleration flag.\n    gpu_devices : tuple[int, ...]\n        GPU device identifiers.\n    timeout_seconds : int\n        Build timeout in seconds.\n\n    Raises\n    ------\n    ValueError\n        If metric is not ``"ip"`` or ``"l2"``.\n    ', lineno=92, col_offset=4, end_lineno=123, end_col_offset=7), lineno=92, col_offset=4, end_lineno=123, end_col_offset=7), AnnAssign(target=Name(id='db_path', ctx=Store(), lineno=125, col_offset=4, end_lineno=125, end_col_offset=11), annotation=Name(id='str', ctx=Load(), lineno=125, col_offset=13, end_lineno=125, end_col_offset=16), simple=1, lineno=125, col_offset=4, end_lineno=125, end_col_offset=16), Expr(value=Constant(value='DuckDB registry or Parquet vector path.\n\n    Alias: none; name ``db_path``.\n    ', lineno=126, col_offset=4, end_lineno=129, end_col_offset=7), lineno=126, col_offset=4, end_lineno=129, end_col_offset=7), AnnAssign(target=Name(id='index_path', ctx=Store(), lineno=130, col_offset=4, end_lineno=130, end_col_offset=14), annotation=Name(id='str', ctx=Load(), lineno=130, col_offset=16, end_lineno=130, end_col_offset=19), simple=1, lineno=130, col_offset=4, end_lineno=130, end_col_offset=19), Expr(value=Constant(value='Filesystem path for the built index.\n\n    Alias: none; name ``index_path``.\n    ', lineno=131, col_offset=4, end_lineno=134, end_col_offset=7), lineno=131, col_offset=4, end_lineno=134, end_col_offset=7), AnnAssign(target=Name(id='factory', ctx=Store(), lineno=135, col_offset=4, end_lineno=135, end_col_offset=11), annotation=Name(id='str', ctx=Load(), lineno=135, col_offset=13, end_lineno=135, end_col_offset=16), value=Constant(value='Flat', lineno=135, col_offset=19, end_lineno=135, end_col_offset=25), simple=1, lineno=135, col_offset=4, end_lineno=135, end_col_offset=25), Expr(value=Constant(value='FAISS factory string (e.g., ``"OPQ64,IVF8192,PQ64"``).\n\n    Alias: none; name ``factory``.\n    ', lineno=136, col_offset=4, end_lineno=139, end_col_offset=7), lineno=136, col_offset=4, end_lineno=139, end_col_offset=7), AnnAssign(target=Name(id='metric', ctx=Store(), lineno=140, col_offset=4, end_lineno=140, end_col_offset=10), annotation=Name(id='str', ctx=Load(), lineno=140, col_offset=12, end_lineno=140, end_col_offset=15), value=Constant(value='ip', lineno=140, col_offset=18, end_lineno=140, end_col_offset=22), simple=1, lineno=140, col_offset=4, end_lineno=140, end_col_offset=22), Expr(value=Constant(value='Similarity metric (``"ip"`` or ``"l2"``).\n\n    Alias: none; name ``metric``.\n    ', lineno=141, col_offset=4, end_lineno=144, end_col_offset=7), lineno=141, col_offset=4, end_lineno=144, end_col_offset=7), AnnAssign(target=Name(id='nprobe', ctx=Store(), lineno=145, col_offset=4, end_lineno=145, end_col_offset=10), annotation=Name(id='int', ctx=Load(), lineno=145, col_offset=12, end_lineno=145, end_col_offset=15), value=Name(id='DEFAULT_NPROBE', ctx=Load(), lineno=145, col_offset=18, end_lineno=145, end_col_offset=32), simple=1, lineno=145, col_offset=4, end_lineno=145, end_col_offset=32), Expr(value=Constant(value='IVF search parameter ``nprobe``.\n\n    Alias: none; name ``nprobe``.\n    ', lineno=146, col_offset=4, end_lineno=149, end_col_offset=7), lineno=146, col_offset=4, end_lineno=149, end_col_offset=7), AnnAssign(target=Name(id='use_gpu', ctx=Store(), lineno=150, col_offset=4, end_lineno=150, end_col_offset=11), annotation=Name(id='bool', ctx=Load(), lineno=150, col_offset=13, end_lineno=150, end_col_offset=17), value=Constant(value=True, lineno=150, col_offset=20, end_lineno=150, end_col_offset=24), simple=1, lineno=150, col_offset=4, end_lineno=150, end_col_offset=24), Expr(value=Constant(value='Enable GPU acceleration flag.\n\n    Alias: none; name ``use_gpu``.\n    ', lineno=151, col_offset=4, end_lineno=154, end_col_offset=7), lineno=151, col_offset=4, end_lineno=154, end_col_offset=7), AnnAssign(target=Name(id='use_cuvs', ctx=Store(), lineno=155, col_offset=4, end_lineno=155, end_col_offset=12), annotation=Name(id='bool', ctx=Load(), lineno=155, col_offset=14, end_lineno=155, end_col_offset=18), value=Constant(value=True, lineno=155, col_offset=21, end_lineno=155, end_col_offset=25), simple=1, lineno=155, col_offset=4, end_lineno=155, end_col_offset=25), Expr(value=Constant(value='Enable cuVS acceleration flag.\n\n    Alias: none; name ``use_cuvs``.\n    ', lineno=156, col_offset=4, end_lineno=159, end_col_offset=7), lineno=156, col_offset=4, end_lineno=159, end_col_offset=7), AnnAssign(target=Name(id='gpu_devices', ctx=Store(), lineno=160, col_offset=4, end_lineno=160, end_col_offset=15), annotation=Subscript(value=Name(id='tuple', ctx=Load(), lineno=160, col_offset=17, end_lineno=160, end_col_offset=22), slice=Tuple(elts=[Name(id='int', ctx=Load(), lineno=160, col_offset=23, end_lineno=160, end_col_offset=26), Constant(value=Ellipsis, lineno=160, col_offset=28, end_lineno=160, end_col_offset=31)], ctx=Load(), lineno=160, col_offset=23, end_lineno=160, end_col_offset=31), ctx=Load(), lineno=160, col_offset=17, end_lineno=160, end_col_offset=32), value=Call(func=Name(id='field', ctx=Load(), lineno=160, col_offset=35, end_lineno=160, end_col_offset=40), keywords=[keyword(arg='default_factory', value=Lambda(args=arguments(), body=Tuple(elts=[Constant(value=0, lineno=160, col_offset=66, end_lineno=160, end_col_offset=67)], ctx=Load(), lineno=160, col_offset=65, end_lineno=160, end_col_offset=69), lineno=160, col_offset=57, end_lineno=160, end_col_offset=69), lineno=160, col_offset=41, end_lineno=160, end_col_offset=69)], lineno=160, col_offset=35, end_lineno=160, end_col_offset=70), simple=1, lineno=160, col_offset=4, end_lineno=160, end_col_offset=70), Expr(value=Constant(value='GPU device identifiers.\n\n    Alias: none; name ``gpu_devices``.\n    ', lineno=161, col_offset=4, end_lineno=164, end_col_offset=7), lineno=161, col_offset=4, end_lineno=164, end_col_offset=7), AnnAssign(target=Name(id='timeout_seconds', ctx=Store(), lineno=165, col_offset=4, end_lineno=165, end_col_offset=19), annotation=Name(id='int', ctx=Load(), lineno=165, col_offset=21, end_lineno=165, end_col_offset=24), value=Name(id='DEFAULT_INDEX_TIMEOUT_SECONDS', ctx=Load(), lineno=165, col_offset=27, end_lineno=165, end_col_offset=56), simple=1, lineno=165, col_offset=4, end_lineno=165, end_col_offset=56), Expr(value=Constant(value='Build timeout in seconds.\n\n    Alias: none; name ``timeout_seconds``.\n    ', lineno=166, col_offset=4, end_lineno=169, end_col_offset=7), lineno=166, col_offset=4, end_lineno=169, end_col_offset=7), FunctionDef(name='__post_init__', args=arguments(args=[arg(arg='self', lineno=171, col_offset=22, end_lineno=171, end_col_offset=26)]), body=[Expr(value=Constant(value='Validate settings.\n\n        Raises\n        ------\n        ValueError\n            If ``metric`` is not one of ``{"ip", "l2"}``.\n        ', lineno=172, col_offset=8, end_lineno=178, end_col_offset=11), lineno=172, col_offset=8, end_lineno=178, end_col_offset=11), If(test=Compare(left=Attribute(value=Name(id='self', ctx=Load(), lineno=179, col_offset=11, end_lineno=179, end_col_offset=15), attr='metric', ctx=Load(), lineno=179, col_offset=11, end_lineno=179, end_col_offset=22), ops=[NotIn()], comparators=[Name(id='VALID_METRICS', ctx=Load(), lineno=179, col_offset=30, end_lineno=179, end_col_offset=43)], lineno=179, col_offset=11, end_lineno=179, end_col_offset=43), body=[Assign(targets=[Name(id='msg', ctx=Store(), lineno=180, col_offset=12, end_lineno=180, end_col_offset=15)], value=JoinedStr(values=[Constant(value="metric must be 'ip' or 'l2', got ", lineno=180, col_offset=20, end_lineno=180, end_col_offset=53), FormattedValue(value=Attribute(value=Name(id='self', ctx=Load(), lineno=180, col_offset=54, end_lineno=180, end_col_offset=58), attr='metric', ctx=Load(), lineno=180, col_offset=54, end_lineno=180, end_col_offset=65), conversion=114, lineno=180, col_offset=53, end_lineno=180, end_col_offset=68)], lineno=180, col_offset=18, end_lineno=180, end_col_offset=69), lineno=180, col_offset=12, end_lineno=180, end_col_offset=69), Raise(exc=Call(func=Name(id='ValueError', ctx=Load(), lineno=181, col_offset=18, end_lineno=181, end_col_offset=28), args=[Name(id='msg', ctx=Load(), lineno=181, col_offset=29, end_lineno=181, end_col_offset=32)], lineno=181, col_offset=18, end_lineno=181, end_col_offset=33), lineno=181, col_offset=12, end_lineno=181, end_col_offset=33)], lineno=179, col_offset=8, end_lineno=181, end_col_offset=33)], returns=Constant(value=None, lineno=171, col_offset=31, end_lineno=171, end_col_offset=35), lineno=171, col_offset=4, end_lineno=181, end_col_offset=33)], decorator_list=[Call(func=Name(id='dataclass', ctx=Load(), lineno=89, col_offset=1, end_lineno=89, end_col_offset=10), keywords=[keyword(arg='frozen', value=Constant(value=True, lineno=89, col_offset=18, end_lineno=89, end_col_offset=22), lineno=89, col_offset=11, end_lineno=89, end_col_offset=22), keyword(arg='slots', value=Constant(value=True, lineno=89, col_offset=30, end_lineno=89, end_col_offset=34), lineno=89, col_offset=24, end_lineno=89, end_col_offset=34)], lineno=89, col_offset=1, end_lineno=89, end_col_offset=35)], lineno=91, col_offset=0, end_lineno=181, end_col_offset=33), ClassDef(name='FaissVectorstoreFactory', body=[Expr(value=Constant(value='Factory for building FAISS adapters with observability and error handling.\n\n    This factory manages the lifecycle of FAISS adapter instances, emitting\n    structured logs, Prometheus metrics, and Problem Details on error.\n\n    Attributes\n    ----------\n    settings : FaissAdapterSettings\n        Configuration for adapter instances.\n\n    Examples\n    --------\n    >>> from search_api.vectorstore_factory import FaissAdapterSettings, FaissVectorstoreFactory\n    >>> settings = FaissAdapterSettings(db_path="vectors.db", index_path="index.idx")\n    >>> factory = FaissVectorstoreFactory(settings)\n    ', lineno=187, col_offset=4, end_lineno=202, end_col_offset=7), lineno=187, col_offset=4, end_lineno=202, end_col_offset=7), AnnAssign(target=Name(id='settings', ctx=Store(), lineno=204, col_offset=4, end_lineno=204, end_col_offset=12), annotation=Name(id='FaissAdapterSettings', ctx=Load(), lineno=204, col_offset=14, end_lineno=204, end_col_offset=34), simple=1, lineno=204, col_offset=4, end_lineno=204, end_col_offset=34), FunctionDef(name='build_adapter', args=arguments(args=[arg(arg='self', lineno=206, col_offset=22, end_lineno=206, end_col_offset=26)]), body=[Expr(value=Constant(value='Build and return a configured FAISS adapter.\n\n        Returns\n        -------\n        FaissAdapter\n            Configured FaissAdapter instance.\n\n        Raises\n        ------\n        IndexBuildError\n            If adapter construction fails.\n        ', lineno=207, col_offset=8, end_lineno=218, end_col_offset=11), lineno=207, col_offset=8, end_lineno=218, end_col_offset=11), Expr(value=Call(func=Attribute(value=Name(id='logger', ctx=Load(), lineno=219, col_offset=8, end_lineno=219, end_col_offset=14), attr='debug', ctx=Load(), lineno=219, col_offset=8, end_lineno=219, end_col_offset=20), args=[Constant(value='Building FAISS adapter', lineno=220, col_offset=12, end_lineno=220, end_col_offset=36)], keywords=[keyword(arg='extra', value=Dict(keys=[Constant(value='operation', lineno=222, col_offset=16, end_lineno=222, end_col_offset=27), Constant(value='factory', lineno=223, col_offset=16, end_lineno=223, end_col_offset=25), Constant(value='metric', lineno=224, col_offset=16, end_lineno=224, end_col_offset=24), Constant(value='gpu_enabled', lineno=225, col_offset=16, end_lineno=225, end_col_offset=29)], values=[Constant(value='build_adapter', lineno=222, col_offset=29, end_lineno=222, end_col_offset=44), Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=223, col_offset=27, end_lineno=223, end_col_offset=31), attr='settings', ctx=Load(), lineno=223, col_offset=27, end_lineno=223, end_col_offset=40), attr='factory', ctx=Load(), lineno=223, col_offset=27, end_lineno=223, end_col_offset=48), Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=224, col_offset=26, end_lineno=224, end_col_offset=30), attr='settings', ctx=Load(), lineno=224, col_offset=26, end_lineno=224, end_col_offset=39), attr='metric', ctx=Load(), lineno=224, col_offset=26, end_lineno=224, end_col_offset=46), Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=225, col_offset=31, end_lineno=225, end_col_offset=35), attr='settings', ctx=Load(), lineno=225, col_offset=31, end_lineno=225, end_col_offset=44), attr='use_gpu', ctx=Load(), lineno=225, col_offset=31, end_lineno=225, end_col_offset=52)], lineno=221, col_offset=18, end_lineno=226, end_col_offset=13), lineno=221, col_offset=12, end_lineno=226, end_col_offset=13)], lineno=219, col_offset=8, end_lineno=227, end_col_offset=9), lineno=219, col_offset=8, end_lineno=227, end_col_offset=9), Try(body=[Return(value=Call(func=Name(id='FaissAdapter', ctx=Load(), lineno=230, col_offset=19, end_lineno=230, end_col_offset=31), keywords=[keyword(arg='db_path', value=Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=231, col_offset=24, end_lineno=231, end_col_offset=28), attr='settings', ctx=Load(), lineno=231, col_offset=24, end_lineno=231, end_col_offset=37), attr='db_path', ctx=Load(), lineno=231, col_offset=24, end_lineno=231, end_col_offset=45), lineno=231, col_offset=16, end_lineno=231, end_col_offset=45), keyword(arg='factory', value=Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=232, col_offset=24, end_lineno=232, end_col_offset=28), attr='settings', ctx=Load(), lineno=232, col_offset=24, end_lineno=232, end_col_offset=37), attr='factory', ctx=Load(), lineno=232, col_offset=24, end_lineno=232, end_col_offset=45), lineno=232, col_offset=16, end_lineno=232, end_col_offset=45), keyword(arg='metric', value=Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=233, col_offset=23, end_lineno=233, end_col_offset=27), attr='settings', ctx=Load(), lineno=233, col_offset=23, end_lineno=233, end_col_offset=36), attr='metric', ctx=Load(), lineno=233, col_offset=23, end_lineno=233, end_col_offset=43), lineno=233, col_offset=16, end_lineno=233, end_col_offset=43), keyword(arg='nprobe', value=Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=234, col_offset=23, end_lineno=234, end_col_offset=27), attr='settings', ctx=Load(), lineno=234, col_offset=23, end_lineno=234, end_col_offset=36), attr='nprobe', ctx=Load(), lineno=234, col_offset=23, end_lineno=234, end_col_offset=43), lineno=234, col_offset=16, end_lineno=234, end_col_offset=43), keyword(arg='use_gpu', value=Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=235, col_offset=24, end_lineno=235, end_col_offset=28), attr='settings', ctx=Load(), lineno=235, col_offset=24, end_lineno=235, end_col_offset=37), attr='use_gpu', ctx=Load(), lineno=235, col_offset=24, end_lineno=235, end_col_offset=45), lineno=235, col_offset=16, end_lineno=235, end_col_offset=45), keyword(arg='use_cuvs', value=Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=236, col_offset=25, end_lineno=236, end_col_offset=29), attr='settings', ctx=Load(), lineno=236, col_offset=25, end_lineno=236, end_col_offset=38), attr='use_cuvs', ctx=Load(), lineno=236, col_offset=25, end_lineno=236, end_col_offset=47), lineno=236, col_offset=16, end_lineno=236, end_col_offset=47), keyword(arg='gpu_devices', value=Call(func=Name(id='list', ctx=Load(), lineno=237, col_offset=28, end_lineno=237, end_col_offset=32), args=[Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=237, col_offset=33, end_lineno=237, end_col_offset=37), attr='settings', ctx=Load(), lineno=237, col_offset=33, end_lineno=237, end_col_offset=46), attr='gpu_devices', ctx=Load(), lineno=237, col_offset=33, end_lineno=237, end_col_offset=58)], lineno=237, col_offset=28, end_lineno=237, end_col_offset=59), lineno=237, col_offset=16, end_lineno=237, end_col_offset=59)], lineno=230, col_offset=19, end_lineno=238, end_col_offset=13), lineno=230, col_offset=12, end_lineno=238, end_col_offset=13)], handlers=[ExceptHandler(type=Name(id='Exception', ctx=Load(), lineno=239, col_offset=15, end_lineno=239, end_col_offset=24), name='exc', body=[Assign(targets=[Name(id='msg', ctx=Store(), lineno=240, col_offset=12, end_lineno=240, end_col_offset=15)], value=JoinedStr(values=[Constant(value='Failed to construct FAISS adapter: ', lineno=240, col_offset=20, end_lineno=240, end_col_offset=55), FormattedValue(value=Name(id='exc', ctx=Load(), lineno=240, col_offset=56, end_lineno=240, end_col_offset=59), conversion=-1, lineno=240, col_offset=55, end_lineno=240, end_col_offset=60)], lineno=240, col_offset=18, end_lineno=240, end_col_offset=61), lineno=240, col_offset=12, end_lineno=240, end_col_offset=61), Raise(exc=Call(func=Name(id='IndexBuildError', ctx=Load(), lineno=241, col_offset=18, end_lineno=241, end_col_offset=33), args=[Name(id='msg', ctx=Load(), lineno=241, col_offset=34, end_lineno=241, end_col_offset=37)], lineno=241, col_offset=18, end_lineno=241, end_col_offset=38), cause=Name(id='exc', ctx=Load(), lineno=241, col_offset=44, end_lineno=241, end_col_offset=47), lineno=241, col_offset=12, end_lineno=241, end_col_offset=47)], lineno=239, col_offset=8, end_lineno=241, end_col_offset=47)], lineno=229, col_offset=8, end_lineno=241, end_col_offset=47)], returns=Name(id='FaissAdapter', ctx=Load(), lineno=206, col_offset=31, end_lineno=206, end_col_offset=43), lineno=206, col_offset=4, end_lineno=241, end_col_offset=47), FunctionDef(name='build_index', args=arguments(args=[arg(arg='self', lineno=243, col_offset=20, end_lineno=243, end_col_offset=24)], kwonlyargs=[arg(arg='correlation_id', annotation=BinOp(left=Name(id='str', ctx=Load(), lineno=243, col_offset=45, end_lineno=243, end_col_offset=48), op=BitOr(), right=Constant(value=None, lineno=243, col_offset=51, end_lineno=243, end_col_offset=55), lineno=243, col_offset=45, end_lineno=243, end_col_offset=55), lineno=243, col_offset=29, end_lineno=243, end_col_offset=55)], kw_defaults=[Constant(value=None, lineno=243, col_offset=58, end_lineno=243, end_col_offset=62)]), body=[Expr(value=Constant(value='Build a FAISS index with timeout enforcement.\n\n        Returns\n        -------\n        FaissAdapter\n            Configured FaissAdapter with built index.\n\n        Raises\n        ------\n        IndexBuildError\n            If build exceeds timeout or fails.\n\n        Parameters\n        ----------\n        correlation_id : str | None, optional\n            Correlation identifier propagated to logs and metrics. Defaults to ``None``.\n        ', lineno=244, col_offset=8, end_lineno=260, end_col_offset=11), lineno=244, col_offset=8, end_lineno=260, end_col_offset=11), Assign(targets=[Name(id='adapter', ctx=Store(), lineno=261, col_offset=8, end_lineno=261, end_col_offset=15)], value=Call(func=Attribute(value=Name(id='self', ctx=Load(), lineno=261, col_offset=18, end_lineno=261, end_col_offset=22), attr='build_adapter', ctx=Load(), lineno=261, col_offset=18, end_lineno=261, end_col_offset=36), lineno=261, col_offset=18, end_lineno=261, end_col_offset=38), lineno=261, col_offset=8, end_lineno=261, end_col_offset=38), Assign(targets=[Name(id='start_time', ctx=Store(), lineno=262, col_offset=8, end_lineno=262, end_col_offset=18)], value=Call(func=Attribute(value=Name(id='time', ctx=Load(), lineno=262, col_offset=21, end_lineno=262, end_col_offset=25), attr='monotonic', ctx=Load(), lineno=262, col_offset=21, end_lineno=262, end_col_offset=35), lineno=262, col_offset=21, end_lineno=262, end_col_offset=37), lineno=262, col_offset=8, end_lineno=262, end_col_offset=37), Assign(targets=[Name(id='operation', ctx=Store(), lineno=263, col_offset=8, end_lineno=263, end_col_offset=17)], value=Constant(value='build', lineno=263, col_offset=20, end_lineno=263, end_col_offset=27), lineno=263, col_offset=8, end_lineno=263, end_col_offset=27), Expr(value=Call(func=Attribute(value=Name(id='logger', ctx=Load(), lineno=265, col_offset=8, end_lineno=265, end_col_offset=14), attr='info', ctx=Load(), lineno=265, col_offset=8, end_lineno=265, end_col_offset=19), args=[Constant(value='Starting FAISS index build', lineno=266, col_offset=12, end_lineno=266, end_col_offset=40)], keywords=[keyword(arg='extra', value=Dict(keys=[Constant(value='operation', lineno=268, col_offset=16, end_lineno=268, end_col_offset=27), Constant(value='index_path', lineno=269, col_offset=16, end_lineno=269, end_col_offset=28), Constant(value='timeout_seconds', lineno=270, col_offset=16, end_lineno=270, end_col_offset=33), Constant(value='stage', lineno=271, col_offset=16, end_lineno=271, end_col_offset=23), Constant(value='correlation_id', lineno=272, col_offset=16, end_lineno=272, end_col_offset=32)], values=[Constant(value='index_build', lineno=268, col_offset=29, end_lineno=268, end_col_offset=42), Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=269, col_offset=30, end_lineno=269, end_col_offset=34), attr='settings', ctx=Load(), lineno=269, col_offset=30, end_lineno=269, end_col_offset=43), attr='index_path', ctx=Load(), lineno=269, col_offset=30, end_lineno=269, end_col_offset=54), Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=270, col_offset=35, end_lineno=270, end_col_offset=39), attr='settings', ctx=Load(), lineno=270, col_offset=35, end_lineno=270, end_col_offset=48), attr='timeout_seconds', ctx=Load(), lineno=270, col_offset=35, end_lineno=270, end_col_offset=64), Name(id='_METRIC_STAGE_LABEL', ctx=Load(), lineno=271, col_offset=25, end_lineno=271, end_col_offset=44), Name(id='correlation_id', ctx=Load(), lineno=272, col_offset=34, end_lineno=272, end_col_offset=48)], lineno=267, col_offset=18, end_lineno=273, end_col_offset=13), lineno=267, col_offset=12, end_lineno=273, end_col_offset=13)], lineno=265, col_offset=8, end_lineno=274, end_col_offset=9), lineno=265, col_offset=8, end_lineno=274, end_col_offset=9), Try(body=[Expr(value=Call(func=Attribute(value=Name(id='adapter', ctx=Load(), lineno=277, col_offset=12, end_lineno=277, end_col_offset=19), attr='build', ctx=Load(), lineno=277, col_offset=12, end_lineno=277, end_col_offset=25), lineno=277, col_offset=12, end_lineno=277, end_col_offset=27), lineno=277, col_offset=12, end_lineno=277, end_col_offset=27)], handlers=[ExceptHandler(type=Name(id='Exception', ctx=Load(), lineno=278, col_offset=15, end_lineno=278, end_col_offset=24), name='exc', body=[Assign(targets=[Name(id='elapsed', ctx=Store(), lineno=279, col_offset=12, end_lineno=279, end_col_offset=19)], value=BinOp(left=Call(func=Attribute(value=Name(id='time', ctx=Load(), lineno=279, col_offset=22, end_lineno=279, end_col_offset=26), attr='monotonic', ctx=Load(), lineno=279, col_offset=22, end_lineno=279, end_col_offset=36), lineno=279, col_offset=22, end_lineno=279, end_col_offset=38), op=Sub(), right=Name(id='start_time', ctx=Load(), lineno=279, col_offset=41, end_lineno=279, end_col_offset=51), lineno=279, col_offset=22, end_lineno=279, end_col_offset=51), lineno=279, col_offset=12, end_lineno=279, end_col_offset=51), Expr(value=Call(func=Attribute(value=Name(id='logger', ctx=Load(), lineno=280, col_offset=12, end_lineno=280, end_col_offset=18), attr='exception', ctx=Load(), lineno=280, col_offset=12, end_lineno=280, end_col_offset=28), args=[Constant(value='FAISS index build failed', lineno=281, col_offset=16, end_lineno=281, end_col_offset=42)], keywords=[keyword(arg='extra', value=Dict(keys=[Constant(value='operation', lineno=283, col_offset=20, end_lineno=283, end_col_offset=31), Constant(value='status', lineno=284, col_offset=20, end_lineno=284, end_col_offset=28), Constant(value='duration_seconds', lineno=285, col_offset=20, end_lineno=285, end_col_offset=38), Constant(value='error_type', lineno=286, col_offset=20, end_lineno=286, end_col_offset=32), Constant(value='stage', lineno=287, col_offset=20, end_lineno=287, end_col_offset=27), Constant(value='correlation_id', lineno=288, col_offset=20, end_lineno=288, end_col_offset=36)], values=[Constant(value='index_build', lineno=283, col_offset=33, end_lineno=283, end_col_offset=46), Constant(value='error', lineno=284, col_offset=30, end_lineno=284, end_col_offset=37), Name(id='elapsed', ctx=Load(), lineno=285, col_offset=40, end_lineno=285, end_col_offset=47), Attribute(value=Call(func=Name(id='type', ctx=Load(), lineno=286, col_offset=34, end_lineno=286, end_col_offset=38), args=[Name(id='exc', ctx=Load(), lineno=286, col_offset=39, end_lineno=286, end_col_offset=42)], lineno=286, col_offset=34, end_lineno=286, end_col_offset=43), attr='__name__', ctx=Load(), lineno=286, col_offset=34, end_lineno=286, end_col_offset=52), Name(id='_METRIC_STAGE_LABEL', ctx=Load(), lineno=287, col_offset=29, end_lineno=287, end_col_offset=48), Name(id='correlation_id', ctx=Load(), lineno=288, col_offset=38, end_lineno=288, end_col_offset=52)], lineno=282, col_offset=22, end_lineno=289, end_col_offset=17), lineno=282, col_offset=16, end_lineno=289, end_col_offset=17)], lineno=280, col_offset=12, end_lineno=290, end_col_offset=13), lineno=280, col_offset=12, end_lineno=290, end_col_offset=13), Expr(value=Call(func=Name(id='_observe_metrics', ctx=Load(), lineno=291, col_offset=12, end_lineno=291, end_col_offset=28), args=[Name(id='operation', ctx=Load(), lineno=291, col_offset=29, end_lineno=291, end_col_offset=38), Constant(value='error', lineno=291, col_offset=40, end_lineno=291, end_col_offset=47), Name(id='elapsed', ctx=Load(), lineno=291, col_offset=49, end_lineno=291, end_col_offset=56)], lineno=291, col_offset=12, end_lineno=291, end_col_offset=57), lineno=291, col_offset=12, end_lineno=291, end_col_offset=57), Assign(targets=[Name(id='msg', ctx=Store(), lineno=292, col_offset=12, end_lineno=292, end_col_offset=15)], value=JoinedStr(values=[Constant(value='Failed to build FAISS index: ', lineno=292, col_offset=20, end_lineno=292, end_col_offset=49), FormattedValue(value=Name(id='exc', ctx=Load(), lineno=292, col_offset=50, end_lineno=292, end_col_offset=53), conversion=-1, lineno=292, col_offset=49, end_lineno=292, end_col_offset=54)], lineno=292, col_offset=18, end_lineno=292, end_col_offset=55), lineno=292, col_offset=12, end_lineno=292, end_col_offset=55), Raise(exc=Call(func=Name(id='IndexBuildError', ctx=Load(), lineno=293, col_offset=18, end_lineno=293, end_col_offset=33), args=[Name(id='msg', ctx=Load(), lineno=293, col_offset=34, end_lineno=293, end_col_offset=37)], keywords=[keyword(arg='cause', value=Name(id='exc', ctx=Load(), lineno=293, col_offset=45, end_lineno=293, end_col_offset=48), lineno=293, col_offset=39, end_lineno=293, end_col_offset=48)], lineno=293, col_offset=18, end_lineno=293, end_col_offset=49), cause=Name(id='exc', ctx=Load(), lineno=293, col_offset=55, end_lineno=293, end_col_offset=58), lineno=293, col_offset=12, end_lineno=293, end_col_offset=58)], lineno=278, col_offset=8, end_lineno=293, end_col_offset=58)], lineno=276, col_offset=8, end_lineno=293, end_col_offset=58), Assign(targets=[Name(id='elapsed', ctx=Store(), lineno=295, col_offset=8, end_lineno=295, end_col_offset=15)], value=BinOp(left=Call(func=Attribute(value=Name(id='time', ctx=Load(), lineno=295, col_offset=18, end_lineno=295, end_col_offset=22), attr='monotonic', ctx=Load(), lineno=295, col_offset=18, end_lineno=295, end_col_offset=32), lineno=295, col_offset=18, end_lineno=295, end_col_offset=34), op=Sub(), right=Name(id='start_time', ctx=Load(), lineno=295, col_offset=37, end_lineno=295, end_col_offset=47), lineno=295, col_offset=18, end_lineno=295, end_col_offset=47), lineno=295, col_offset=8, end_lineno=295, end_col_offset=47), If(test=Compare(left=Name(id='elapsed', ctx=Load(), lineno=297, col_offset=11, end_lineno=297, end_col_offset=18), ops=[Gt()], comparators=[Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=297, col_offset=21, end_lineno=297, end_col_offset=25), attr='settings', ctx=Load(), lineno=297, col_offset=21, end_lineno=297, end_col_offset=34), attr='timeout_seconds', ctx=Load(), lineno=297, col_offset=21, end_lineno=297, end_col_offset=50)], lineno=297, col_offset=11, end_lineno=297, end_col_offset=50), body=[Assign(targets=[Name(id='msg', ctx=Store(), lineno=298, col_offset=12, end_lineno=298, end_col_offset=15)], value=JoinedStr(values=[Constant(value='Index build exceeded timeout: ', lineno=298, col_offset=20, end_lineno=298, end_col_offset=50), FormattedValue(value=Name(id='elapsed', ctx=Load(), lineno=298, col_offset=51, end_lineno=298, end_col_offset=58), conversion=-1, format_spec=JoinedStr(values=[Constant(value='.1f', lineno=298, col_offset=59, end_lineno=298, end_col_offset=62)], lineno=298, col_offset=58, end_lineno=298, end_col_offset=62), lineno=298, col_offset=50, end_lineno=298, end_col_offset=63), Constant(value='s > ', lineno=298, col_offset=63, end_lineno=298, end_col_offset=67), FormattedValue(value=Attribute(value=Attribute(value=Name(id='self', ctx=Load(), lineno=298, col_offset=68, end_lineno=298, end_col_offset=72), attr='settings', ctx=Load(), lineno=298, col_offset=68, end_lineno=298, end_col_offset=81), attr='timeout_seconds', ctx=Load(), lineno=298, col_offset=68, end_lineno=298, end_col_offset=97), conversion=-1, lineno=298, col_offset=67, end_lineno=298, end_col_offset=98), Constant(value='s', lineno=298, col_offset=98, end_lineno=298, end_col_offset=99)], lineno=298, col_offset=18, end_lineno=298, end_col_offset=100), lineno=298, col_offset=12, end_lineno=298, end_col_offset=100), Raise(exc=Call(func=Name(id='IndexBuildError', ctx=Load(), lineno=299, col_offset=18, end_lineno=299, end_col_offset=33), args=[Name(id='msg', ctx=Load(), lineno=299, col_offset=34, end_lineno=299, end_col_offset=37)], lineno=299, col_offset=18, end_lineno=299, end_col_offset=38), lineno=299, col_offset=12, end_lineno=299, end_col_offset=38)], lineno=297, col_offset=8, end_lineno=299, end_col_offset=38), Assign(targets=[Name(id='vector_count', ctx=Store(), lineno=301, col_offset=8, end_lineno=301, end_col_offset=20)], value=IfExp(test=Attribute(value=Name(id='adapter', ctx=Load(), lineno=301, col_offset=45, end_lineno=301, end_col_offset=52), attr='idmap', ctx=Load(), lineno=301, col_offset=45, end_lineno=301, end_col_offset=58), body=Call(func=Name(id='len', ctx=Load(), lineno=301, col_offset=23, end_lineno=301, end_col_offset=26), args=[Attribute(value=Name(id='adapter', ctx=Load(), lineno=301, col_offset=27, end_lineno=301, end_col_offset=34), attr='idmap', ctx=Load(), lineno=301, col_offset=27, end_lineno=301, end_col_offset=40)], lineno=301, col_offset=23, end_lineno=301, end_col_offset=41), orelse=Constant(value=0, lineno=301, col_offset=64, end_lineno=301, end_col_offset=65), lineno=301, col_offset=23, end_lineno=301, end_col_offset=65), lineno=301, col_offset=8, end_lineno=301, end_col_offset=65), Assign(targets=[Name(id='matrix', ctx=Store(), lineno=302, col_offset=8, end_lineno=302, end_col_offset=14)], value=Attribute(value=Name(id='adapter', ctx=Load(), lineno=302, col_offset=17, end_lineno=302, end_col_offset=24), attr='cpu_matrix', ctx=Load(), lineno=302, col_offset=17, end_lineno=302, end_col_offset=35), lineno=302, col_offset=8, end_lineno=302, end_col_offset=35), Assign(targets=[Name(id='vector_dimension', ctx=Store(), lineno=303, col_offset=8, end_lineno=303, end_col_offset=24)], value=IfExp(test=Compare(left=Name(id='matrix', ctx=Load(), lineno=303, col_offset=46, end_lineno=303, end_col_offset=52), ops=[IsNot()], comparators=[Constant(value=None, lineno=303, col_offset=60, end_lineno=303, end_col_offset=64)], lineno=303, col_offset=46, end_lineno=303, end_col_offset=64), body=Subscript(value=Attribute(value=Name(id='matrix', ctx=Load(), lineno=303, col_offset=27, end_lineno=303, end_col_offset=33), attr='shape', ctx=Load(), lineno=303, col_offset=27, end_lineno=303, end_col_offset=39), slice=Constant(value=1, lineno=303, col_offset=40, end_lineno=303, end_col_offset=41), ctx=Load(), lineno=303, col_offset=27, end_lineno=303, end_col_offset=42), orelse=Constant(value=None, lineno=303, col_offset=70, end_lineno=303, end_col_offset=74), lineno=303, col_offset=27, end_lineno=303, end_col_offset=74), lineno=303, col_offset=8, end_lineno=303, end_col_offset=74), Expr(value=Call(func=Attribute(value=Name(id='logger', ctx=Load(), lineno=304, col_offset=8, end_lineno=304, end_col_offset=14), attr='info', ctx=Load(), lineno=304, col_offset=8, end_lineno=304, end_col_offset=19), args=[Constant(value='FAISS index build completed', lineno=305, col_offset=12, end_lineno=305, end_col_offset=41)], keywords=[keyword(arg='extra', value=Dict(keys=[Constant(value='operation', lineno=307, col_offset=16, end_lineno=307, end_col_offset=27), Constant(value='status', lineno=308, col_offset=16, end_lineno=308, end_col_offset=24), Constant(value='duration_seconds', lineno=309, col_offset=16, end_lineno=309, end_col_offset=34), Constant(value='vector_count', lineno=310, col_offset=16, end_lineno=310, end_col_offset=30), Constant(value='vector_dimension', lineno=311, col_offset=16, end_lineno=311, end_col_offset=34), Constant(value='stage', lineno=312, col_offset=16, end_lineno=312, end_col_offset=23), Constant(value='correlation_id', lineno=313, col_offset=16, end_lineno=313, end_col_offset=32)], values=[Constant(value='index_build', lineno=307, col_offset=29, end_lineno=307, end_col_offset=42), Constant(value='success', lineno=308, col_offset=26, end_lineno=308, end_col_offset=35), Name(id='elapsed', ctx=Load(), lineno=309, col_offset=36, end_lineno=309, end_col_offset=43), Name(id='vector_count', ctx=Load(), lineno=310, col_offset=32, end_lineno=310, end_col_offset=44), Name(id='vector_dimension', ctx=Load(), lineno=311, col_offset=36, end_lineno=311, end_col_offset=52), Name(id='_METRIC_STAGE_LABEL', ctx=Load(), lineno=312, col_offset=25, end_lineno=312, end_col_offset=44), Name(id='correlation_id', ctx=Load(), lineno=313, col_offset=34, end_lineno=313, end_col_offset=48)], lineno=306, col_offset=18, end_lineno=314, end_col_offset=13), lineno=306, col_offset=12, end_lineno=314, end_col_offset=13)], lineno=304, col_offset=8, end_lineno=315, end_col_offset=9), lineno=304, col_offset=8, end_lineno=315, end_col_offset=9), Expr(value=Call(func=Name(id='_observe_metrics', ctx=Load(), lineno=316, col_offset=8, end_lineno=316, end_col_offset=24), args=[Name(id='operation', ctx=Load(), lineno=316, col_offset=25, end_lineno=316, end_col_offset=34), Constant(value='success', lineno=316, col_offset=36, end_lineno=316, end_col_offset=45), Name(id='elapsed', ctx=Load(), lineno=316, col_offset=47, end_lineno=316, end_col_offset=54)], lineno=316, col_offset=8, end_lineno=316, end_col_offset=55), lineno=316, col_offset=8, end_lineno=316, end_col_offset=55), Return(value=Name(id='adapter', ctx=Load(), lineno=318, col_offset=15, end_lineno=318, end_col_offset=22), lineno=318, col_offset=8, end_lineno=318, end_col_offset=22)], returns=Name(id='FaissAdapter', ctx=Load(), lineno=243, col_offset=67, end_lineno=243, end_col_offset=79), lineno=243, col_offset=4, end_lineno=318, end_col_offset=22), FunctionDef(name='load_or_build', args=arguments(args=[arg(arg='self', lineno=321, col_offset=8, end_lineno=321, end_col_offset=12), arg(arg='cpu_index_path', annotation=BinOp(left=Name(id='str', ctx=Load(), lineno=321, col_offset=30, end_lineno=321, end_col_offset=33), op=BitOr(), right=Constant(value=None, lineno=321, col_offset=36, end_lineno=321, end_col_offset=40), lineno=321, col_offset=30, end_lineno=321, end_col_offset=40), lineno=321, col_offset=14, end_lineno=321, end_col_offset=40)], kwonlyargs=[arg(arg='correlation_id', annotation=BinOp(left=Name(id='str', ctx=Load(), lineno=321, col_offset=68, end_lineno=321, end_col_offset=71), op=BitOr(), right=Constant(value=None, lineno=321, col_offset=74, end_lineno=321, end_col_offset=78), lineno=321, col_offset=68, end_lineno=321, end_col_offset=78), lineno=321, col_offset=52, end_lineno=321, end_col_offset=78)], kw_defaults=[Constant(value=None, lineno=321, col_offset=81, end_lineno=321, end_col_offset=85)], defaults=[Constant(value=None, lineno=321, col_offset=43, end_lineno=321, end_col_offset=47)]), body=[Expr(value=Constant(value='Load an existing index or build from scratch.\n\n        Parameters\n        ----------\n        cpu_index_path : str | None, optional\n            Path to existing CPU-format index. If provided and exists, will\n            be loaded instead of rebuilding.\n        correlation_id : str | None, optional\n            Correlation identifier propagated to logs and metrics. Defaults to ``None``.\n\n        Returns\n        -------\n        FaissAdapter\n            Configured FaissAdapter with index ready for search.\n\n        Raises\n        ------\n        IndexBuildError\n            If loading or building fails.\n        ', lineno=323, col_offset=8, end_lineno=342, end_col_offset=11), lineno=323, col_offset=8, end_lineno=342, end_col_offset=11), Assign(targets=[Name(id='adapter', ctx=Store(), lineno=343, col_offset=8, end_lineno=343, end_col_offset=15)], value=Call(func=Attribute(value=Name(id='self', ctx=Load(), lineno=343, col_offset=18, end_lineno=343, end_col_offset=22), attr='build_adapter', ctx=Load(), lineno=343, col_offset=18, end_lineno=343, end_col_offset=36), lineno=343, col_offset=18, end_lineno=343, end_col_offset=38), lineno=343, col_offset=8, end_lineno=343, end_col_offset=38), Assign(targets=[Name(id='operation', ctx=Store(), lineno=345, col_offset=8, end_lineno=345, end_col_offset=17)], value=Constant(value='load_or_build', lineno=345, col_offset=20, end_lineno=345, end_col_offset=35), lineno=345, col_offset=8, end_lineno=345, end_col_offset=35), Assign(targets=[Name(id='start_time', ctx=Store(), lineno=346, col_offset=8, end_lineno=346, end_col_offset=18)], value=Call(func=Attribute(value=Name(id='time', ctx=Load(), lineno=346, col_offset=21, end_lineno=346, end_col_offset=25), attr='monotonic', ctx=Load(), lineno=346, col_offset=21, end_lineno=346, end_col_offset=35), lineno=346, col_offset=21, end_lineno=346, end_col_offset=37), lineno=346, col_offset=8, end_lineno=346, end_col_offset=37), Expr(value=Call(func=Attribute(value=Name(id='logger', ctx=Load(), lineno=347, col_offset=8, end_lineno=347, end_col_offset=14), attr='info', ctx=Load(), lineno=347, col_offset=8, end_lineno=347, end_col_offset=19), args=[Constant(value='Loading or building FAISS index', lineno=348, col_offset=12, end_lineno=348, end_col_offset=45)], keywords=[keyword(arg='extra', value=Dict(keys=[Constant(value='operation', lineno=350, col_offset=16, end_lineno=350, end_col_offset=27), Constant(value='cpu_index_path', lineno=351, col_offset=16, end_lineno=351, end_col_offset=32), Constant(value='stage', lineno=352, col_offset=16, end_lineno=352, end_col_offset=23), Constant(value='correlation_id', lineno=353, col_offset=16, end_lineno=353, end_col_offset=32)], values=[Constant(value='load_or_build', lineno=350, col_offset=29, end_lineno=350, end_col_offset=44), Name(id='cpu_index_path', ctx=Load(), lineno=351, col_offset=34, end_lineno=351, end_col_offset=48), Name(id='_METRIC_STAGE_LABEL', ctx=Load(), lineno=352, col_offset=25, end_lineno=352, end_col_offset=44), Name(id='correlation_id', ctx=Load(), lineno=353, col_offset=34, end_lineno=353, end_col_offset=48)], lineno=349, col_offset=18, end_lineno=354, end_col_offset=13), lineno=349, col_offset=12, end_lineno=354, end_col_offset=13)], lineno=347, col_offset=8, end_lineno=355, end_col_offset=9), lineno=347, col_offset=8, end_lineno=355, end_col_offset=9), Try(body=[Expr(value=Call(func=Attribute(value=Name(id='adapter', ctx=Load(), lineno=358, col_offset=12, end_lineno=358, end_col_offset=19), attr='load_or_build', ctx=Load(), lineno=358, col_offset=12, end_lineno=358, end_col_offset=33), keywords=[keyword(arg='cpu_index_path', value=Name(id='cpu_index_path', ctx=Load(), lineno=358, col_offset=49, end_lineno=358, end_col_offset=63), lineno=358, col_offset=34, end_lineno=358, end_col_offset=63)], lineno=358, col_offset=12, end_lineno=358, end_col_offset=64), lineno=358, col_offset=12, end_lineno=358, end_col_offset=64)], handlers=[ExceptHandler(type=Name(id='Exception', ctx=Load(), lineno=359, col_offset=15, end_lineno=359, end_col_offset=24), name='exc', body=[Expr(value=Call(func=Attribute(value=Name(id='logger', ctx=Load(), lineno=360, col_offset=12, end_lineno=360, end_col_offset=18), attr='exception', ctx=Load(), lineno=360, col_offset=12, end_lineno=360, end_col_offset=28), args=[Constant(value='Index load or build failed', lineno=361, col_offset=16, end_lineno=361, end_col_offset=44)], keywords=[keyword(arg='extra', value=Dict(keys=[Constant(value='operation', lineno=363, col_offset=20, end_lineno=363, end_col_offset=31), Constant(value='status', lineno=364, col_offset=20, end_lineno=364, end_col_offset=28), Constant(value='error_type', lineno=365, col_offset=20, end_lineno=365, end_col_offset=32), Constant(value='stage', lineno=366, col_offset=20, end_lineno=366, end_col_offset=27), Constant(value='correlation_id', lineno=367, col_offset=20, end_lineno=367, end_col_offset=36)], values=[Constant(value='load_or_build', lineno=363, col_offset=33, end_lineno=363, end_col_offset=48), Constant(value='error', lineno=364, col_offset=30, end_lineno=364, end_col_offset=37), Attribute(value=Call(func=Name(id='type', ctx=Load(), lineno=365, col_offset=34, end_lineno=365, end_col_offset=38), args=[Name(id='exc', ctx=Load(), lineno=365, col_offset=39, end_lineno=365, end_col_offset=42)], lineno=365, col_offset=34, end_lineno=365, end_col_offset=43), attr='__name__', ctx=Load(), lineno=365, col_offset=34, end_lineno=365, end_col_offset=52), Name(id='_METRIC_STAGE_LABEL', ctx=Load(), lineno=366, col_offset=29, end_lineno=366, end_col_offset=48), Name(id='correlation_id', ctx=Load(), lineno=367, col_offset=38, end_lineno=367, end_col_offset=52)], lineno=362, col_offset=22, end_lineno=368, end_col_offset=17), lineno=362, col_offset=16, end_lineno=368, end_col_offset=17)], lineno=360, col_offset=12, end_lineno=369, end_col_offset=13), lineno=360, col_offset=12, end_lineno=369, end_col_offset=13), Assign(targets=[Name(id='msg', ctx=Store(), lineno=370, col_offset=12, end_lineno=370, end_col_offset=15)], value=JoinedStr(values=[Constant(value='Failed to load or build FAISS index: ', lineno=370, col_offset=20, end_lineno=370, end_col_offset=57), FormattedValue(value=Name(id='exc', ctx=Load(), lineno=370, col_offset=58, end_lineno=370, end_col_offset=61), conversion=-1, lineno=370, col_offset=57, end_lineno=370, end_col_offset=62)], lineno=370, col_offset=18, end_lineno=370, end_col_offset=63), lineno=370, col_offset=12, end_lineno=370, end_col_offset=63), Raise(exc=Call(func=Name(id='IndexBuildError', ctx=Load(), lineno=371, col_offset=18, end_lineno=371, end_col_offset=33), args=[Name(id='msg', ctx=Load(), lineno=371, col_offset=34, end_lineno=371, end_col_offset=37)], lineno=371, col_offset=18, end_lineno=371, end_col_offset=38), cause=Name(id='exc', ctx=Load(), lineno=371, col_offset=44, end_lineno=371, end_col_offset=47), lineno=371, col_offset=12, end_lineno=371, end_col_offset=47)], lineno=359, col_offset=8, end_lineno=371, end_col_offset=47)], lineno=357, col_offset=8, end_lineno=371, end_col_offset=47), Assign(targets=[Name(id='elapsed', ctx=Store(), lineno=373, col_offset=8, end_lineno=373, end_col_offset=15)], value=BinOp(left=Call(func=Attribute(value=Name(id='time', ctx=Load(), lineno=373, col_offset=18, end_lineno=373, end_col_offset=22), attr='monotonic', ctx=Load(), lineno=373, col_offset=18, end_lineno=373, end_col_offset=32), lineno=373, col_offset=18, end_lineno=373, end_col_offset=34), op=Sub(), right=Name(id='start_time', ctx=Load(), lineno=373, col_offset=37, end_lineno=373, end_col_offset=47), lineno=373, col_offset=18, end_lineno=373, end_col_offset=47), lineno=373, col_offset=8, end_lineno=373, end_col_offset=47), Expr(value=Call(func=Attribute(value=Name(id='logger', ctx=Load(), lineno=374, col_offset=8, end_lineno=374, end_col_offset=14), attr='info', ctx=Load(), lineno=374, col_offset=8, end_lineno=374, end_col_offset=19), args=[Constant(value='Index load or build completed', lineno=375, col_offset=12, end_lineno=375, end_col_offset=43)], keywords=[keyword(arg='extra', value=Dict(keys=[Constant(value='operation', lineno=377, col_offset=16, end_lineno=377, end_col_offset=27), Constant(value='status', lineno=378, col_offset=16, end_lineno=378, end_col_offset=24), Constant(value='duration_seconds', lineno=379, col_offset=16, end_lineno=379, end_col_offset=34), Constant(value='stage', lineno=380, col_offset=16, end_lineno=380, end_col_offset=23), Constant(value='correlation_id', lineno=381, col_offset=16, end_lineno=381, end_col_offset=32)], values=[Constant(value='load_or_build', lineno=377, col_offset=29, end_lineno=377, end_col_offset=44), Constant(value='success', lineno=378, col_offset=26, end_lineno=378, end_col_offset=35), Name(id='elapsed', ctx=Load(), lineno=379, col_offset=36, end_lineno=379, end_col_offset=43), Name(id='_METRIC_STAGE_LABEL', ctx=Load(), lineno=380, col_offset=25, end_lineno=380, end_col_offset=44), Name(id='correlation_id', ctx=Load(), lineno=381, col_offset=34, end_lineno=381, end_col_offset=48)], lineno=376, col_offset=18, end_lineno=382, end_col_offset=13), lineno=376, col_offset=12, end_lineno=382, end_col_offset=13)], lineno=374, col_offset=8, end_lineno=383, end_col_offset=9), lineno=374, col_offset=8, end_lineno=383, end_col_offset=9), Expr(value=Call(func=Name(id='_observe_metrics', ctx=Load(), lineno=384, col_offset=8, end_lineno=384, end_col_offset=24), args=[Name(id='operation', ctx=Load(), lineno=384, col_offset=25, end_lineno=384, end_col_offset=34), Constant(value='success', lineno=384, col_offset=36, end_lineno=384, end_col_offset=45), Name(id='elapsed', ctx=Load(), lineno=384, col_offset=47, end_lineno=384, end_col_offset=54)], lineno=384, col_offset=8, end_lineno=384, end_col_offset=55), lineno=384, col_offset=8, end_lineno=384, end_col_offset=55), Return(value=Name(id='adapter', ctx=Load(), lineno=385, col_offset=15, end_lineno=385, end_col_offset=22), lineno=385, col_offset=8, end_lineno=385, end_col_offset=22)], returns=Name(id='FaissAdapter', ctx=Load(), lineno=322, col_offset=9, end_lineno=322, end_col_offset=21), lineno=320, col_offset=4, end_lineno=385, end_col_offset=22), FunctionDef(name='save_index', args=arguments(args=[arg(arg='adapter', annotation=Name(id='FaissAdapter', ctx=Load(), lineno=389, col_offset=17, end_lineno=389, end_col_offset=29), lineno=389, col_offset=8, end_lineno=389, end_col_offset=29), arg(arg='index_uri', annotation=Name(id='str', ctx=Load(), lineno=390, col_offset=19, end_lineno=390, end_col_offset=22), lineno=390, col_offset=8, end_lineno=390, end_col_offset=22), arg(arg='idmap_uri', annotation=BinOp(left=Name(id='str', ctx=Load(), lineno=391, col_offset=19, end_lineno=391, end_col_offset=22), op=BitOr(), right=Constant(value=None, lineno=391, col_offset=25, end_lineno=391, end_col_offset=29), lineno=391, col_offset=19, end_lineno=391, end_col_offset=29), lineno=391, col_offset=8, end_lineno=391, end_col_offset=29)], kwonlyargs=[arg(arg='correlation_id', annotation=BinOp(left=Name(id='str', ctx=Load(), lineno=393, col_offset=24, end_lineno=393, end_col_offset=27), op=BitOr(), right=Constant(value=None, lineno=393, col_offset=30, end_lineno=393, end_col_offset=34), lineno=393, col_offset=24, end_lineno=393, end_col_offset=34), lineno=393, col_offset=8, end_lineno=393, end_col_offset=34)], kw_defaults=[Constant(value=None, lineno=393, col_offset=37, end_lineno=393, end_col_offset=41)], defaults=[Constant(value=None, lineno=391, col_offset=32, end_lineno=391, end_col_offset=36)]), body=[Expr(value=Constant(value='Save adapter index and ID mapping to disk.\n\n        Parameters\n        ----------\n        adapter : FaissAdapter\n            FaissAdapter instance with built index.\n        index_uri : str\n            Path where index will be saved.\n        idmap_uri : str | None, optional\n            Path where ID mapping will be saved.\n        correlation_id : str | None, optional\n            Correlation identifier propagated to logs and metrics. Defaults to ``None``.\n\n        Raises\n        ------\n        IndexBuildError\n            Raised when persisting the FAISS index fails. The underlying\n            exception is chained for diagnostics.\n\n        Notes\n        -----\n        Exceptions raised by :meth:`FaissAdapter.save` (for example I/O errors\n        or FAISS errors) propagate after logging and metrics collection complete.\n        ', lineno=395, col_offset=8, end_lineno=418, end_col_offset=11), lineno=395, col_offset=8, end_lineno=418, end_col_offset=11), Expr(value=Call(func=Attribute(value=Name(id='logger', ctx=Load(), lineno=419, col_offset=8, end_lineno=419, end_col_offset=14), attr='info', ctx=Load(), lineno=419, col_offset=8, end_lineno=419, end_col_offset=19), args=[Constant(value='Saving FAISS index', lineno=420, col_offset=12, end_lineno=420, end_col_offset=32)], keywords=[keyword(arg='extra', value=Dict(keys=[Constant(value='operation', lineno=422, col_offset=16, end_lineno=422, end_col_offset=27), Constant(value='index_uri', lineno=423, col_offset=16, end_lineno=423, end_col_offset=27), Constant(value='idmap_uri', lineno=424, col_offset=16, end_lineno=424, end_col_offset=27), Constant(value='stage', lineno=425, col_offset=16, end_lineno=425, end_col_offset=23), Constant(value='correlation_id', lineno=426, col_offset=16, end_lineno=426, end_col_offset=32)], values=[Constant(value='save_index', lineno=422, col_offset=29, end_lineno=422, end_col_offset=41), Name(id='index_uri', ctx=Load(), lineno=423, col_offset=29, end_lineno=423, end_col_offset=38), Name(id='idmap_uri', ctx=Load(), lineno=424, col_offset=29, end_lineno=424, end_col_offset=38), Name(id='_METRIC_STAGE_LABEL', ctx=Load(), lineno=425, col_offset=25, end_lineno=425, end_col_offset=44), Name(id='correlation_id', ctx=Load(), lineno=426, col_offset=34, end_lineno=426, end_col_offset=48)], lineno=421, col_offset=18, end_lineno=427, end_col_offset=13), lineno=421, col_offset=12, end_lineno=427, end_col_offset=13)], lineno=419, col_offset=8, end_lineno=428, end_col_offset=9), lineno=419, col_offset=8, end_lineno=428, end_col_offset=9), Assign(targets=[Name(id='start_time', ctx=Store(), lineno=430, col_offset=8, end_lineno=430, end_col_offset=18)], value=Call(func=Attribute(value=Name(id='time', ctx=Load(), lineno=430, col_offset=21, end_lineno=430, end_col_offset=25), attr='monotonic', ctx=Load(), lineno=430, col_offset=21, end_lineno=430, end_col_offset=35), lineno=430, col_offset=21, end_lineno=430, end_col_offset=37), lineno=430, col_offset=8, end_lineno=430, end_col_offset=37), Assign(targets=[Name(id='operation', ctx=Store(), lineno=431, col_offset=8, end_lineno=431, end_col_offset=17)], value=Constant(value='save', lineno=431, col_offset=20, end_lineno=431, end_col_offset=26), lineno=431, col_offset=8, end_lineno=431, end_col_offset=26), Try(body=[Expr(value=Call(func=Attribute(value=Name(id='adapter', ctx=Load(), lineno=433, col_offset=12, end_lineno=433, end_col_offset=19), attr='save', ctx=Load(), lineno=433, col_offset=12, end_lineno=433, end_col_offset=24), args=[Name(id='index_uri', ctx=Load(), lineno=433, col_offset=25, end_lineno=433, end_col_offset=34), Name(id='idmap_uri', ctx=Load(), lineno=433, col_offset=36, end_lineno=433, end_col_offset=45)], lineno=433, col_offset=12, end_lineno=433, end_col_offset=46), lineno=433, col_offset=12, end_lineno=433, end_col_offset=46)], handlers=[ExceptHandler(type=Name(id='Exception', ctx=Load(), lineno=434, col_offset=15, end_lineno=434, end_col_offset=24), name='error', body=[Expr(value=Call(func=Attribute(value=Name(id='logger', ctx=Load(), lineno=435, col_offset=12, end_lineno=435, end_col_offset=18), attr='exception', ctx=Load(), lineno=435, col_offset=12, end_lineno=435, end_col_offset=28), args=[Constant(value='Index save failed', lineno=436, col_offset=16, end_lineno=436, end_col_offset=35)], keywords=[keyword(arg='extra', value=Dict(keys=[Constant(value='operation', lineno=438, col_offset=20, end_lineno=438, end_col_offset=31), Constant(value='status', lineno=439, col_offset=20, end_lineno=439, end_col_offset=28), Constant(value='error_type', lineno=440, col_offset=20, end_lineno=440, end_col_offset=32), Constant(value='stage', lineno=441, col_offset=20, end_lineno=441, end_col_offset=27), Constant(value='correlation_id', lineno=442, col_offset=20, end_lineno=442, end_col_offset=36)], values=[Constant(value='save_index', lineno=438, col_offset=33, end_lineno=438, end_col_offset=45), Constant(value='error', lineno=439, col_offset=30, end_lineno=439, end_col_offset=37), Attribute(value=Call(func=Name(id='type', ctx=Load(), lineno=440, col_offset=34, end_lineno=440, end_col_offset=38), args=[Name(id='error', ctx=Load(), lineno=440, col_offset=39, end_lineno=440, end_col_offset=44)], lineno=440, col_offset=34, end_lineno=440, end_col_offset=45), attr='__name__', ctx=Load(), lineno=440, col_offset=34, end_lineno=440, end_col_offset=54), Name(id='_METRIC_STAGE_LABEL', ctx=Load(), lineno=441, col_offset=29, end_lineno=441, end_col_offset=48), Name(id='correlation_id', ctx=Load(), lineno=442, col_offset=38, end_lineno=442, end_col_offset=52)], lineno=437, col_offset=22, end_lineno=443, end_col_offset=17), lineno=437, col_offset=16, end_lineno=443, end_col_offset=17)], lineno=435, col_offset=12, end_lineno=444, end_col_offset=13), lineno=435, col_offset=12, end_lineno=444, end_col_offset=13), Assign(targets=[Name(id='elapsed', ctx=Store(), lineno=445, col_offset=12, end_lineno=445, end_col_offset=19)], value=BinOp(left=Call(func=Attribute(value=Name(id='time', ctx=Load(), lineno=445, col_offset=22, end_lineno=445, end_col_offset=26), attr='monotonic', ctx=Load(), lineno=445, col_offset=22, end_lineno=445, end_col_offset=36), lineno=445, col_offset=22, end_lineno=445, end_col_offset=38), op=Sub(), right=Name(id='start_time', ctx=Load(), lineno=445, col_offset=41, end_lineno=445, end_col_offset=51), lineno=445, col_offset=22, end_lineno=445, end_col_offset=51), lineno=445, col_offset=12, end_lineno=445, end_col_offset=51), Expr(value=Call(func=Name(id='_observe_metrics', ctx=Load(), lineno=446, col_offset=12, end_lineno=446, end_col_offset=28), args=[Name(id='operation', ctx=Load(), lineno=446, col_offset=29, end_lineno=446, end_col_offset=38), Constant(value='error', lineno=446, col_offset=40, end_lineno=446, end_col_offset=47), Name(id='elapsed', ctx=Load(), lineno=446, col_offset=49, end_lineno=446, end_col_offset=56)], lineno=446, col_offset=12, end_lineno=446, end_col_offset=57), lineno=446, col_offset=12, end_lineno=446, end_col_offset=57), Assign(targets=[Name(id='message', ctx=Store(), lineno=447, col_offset=12, end_lineno=447, end_col_offset=19)], value=Constant(value='Failed to persist FAISS index artifacts', lineno=447, col_offset=22, end_lineno=447, end_col_offset=63), lineno=447, col_offset=12, end_lineno=447, end_col_offset=63), Raise(exc=Call(func=Name(id='IndexBuildError', ctx=Load(), lineno=448, col_offset=18, end_lineno=448, end_col_offset=33), args=[Name(id='message', ctx=Load(), lineno=448, col_offset=34, end_lineno=448, end_col_offset=41)], lineno=448, col_offset=18, end_lineno=448, end_col_offset=42), cause=Name(id='error', ctx=Load(), lineno=448, col_offset=48, end_lineno=448, end_col_offset=53), lineno=448, col_offset=12, end_lineno=448, end_col_offset=53)], lineno=434, col_offset=8, end_lineno=448, end_col_offset=53)], lineno=432, col_offset=8, end_lineno=448, end_col_offset=53), Assign(targets=[Name(id='elapsed', ctx=Store(), lineno=450, col_offset=8, end_lineno=450, end_col_offset=15)], value=BinOp(left=Call(func=Attribute(value=Name(id='time', ctx=Load(), lineno=450, col_offset=18, end_lineno=450, end_col_offset=22), attr='monotonic', ctx=Load(), lineno=450, col_offset=18, end_lineno=450, end_col_offset=32), lineno=450, col_offset=18, end_lineno=450, end_col_offset=34), op=Sub(), right=Name(id='start_time', ctx=Load(), lineno=450, col_offset=37, end_lineno=450, end_col_offset=47), lineno=450, col_offset=18, end_lineno=450, end_col_offset=47), lineno=450, col_offset=8, end_lineno=450, end_col_offset=47), Expr(value=Call(func=Attribute(value=Name(id='logger', ctx=Load(), lineno=451, col_offset=8, end_lineno=451, end_col_offset=14), attr='info', ctx=Load(), lineno=451, col_offset=8, end_lineno=451, end_col_offset=19), args=[Constant(value='Index saved successfully', lineno=452, col_offset=12, end_lineno=452, end_col_offset=38)], keywords=[keyword(arg='extra', value=Dict(keys=[Constant(value='operation', lineno=454, col_offset=16, end_lineno=454, end_col_offset=27), Constant(value='status', lineno=455, col_offset=16, end_lineno=455, end_col_offset=24), Constant(value='duration_seconds', lineno=456, col_offset=16, end_lineno=456, end_col_offset=34), Constant(value='stage', lineno=457, col_offset=16, end_lineno=457, end_col_offset=23), Constant(value='correlation_id', lineno=458, col_offset=16, end_lineno=458, end_col_offset=32)], values=[Constant(value='save_index', lineno=454, col_offset=29, end_lineno=454, end_col_offset=41), Constant(value='success', lineno=455, col_offset=26, end_lineno=455, end_col_offset=35), Name(id='elapsed', ctx=Load(), lineno=456, col_offset=36, end_lineno=456, end_col_offset=43), Name(id='_METRIC_STAGE_LABEL', ctx=Load(), lineno=457, col_offset=25, end_lineno=457, end_col_offset=44), Name(id='correlation_id', ctx=Load(), lineno=458, col_offset=34, end_lineno=458, end_col_offset=48)], lineno=453, col_offset=18, end_lineno=459, end_col_offset=13), lineno=453, col_offset=12, end_lineno=459, end_col_offset=13)], lineno=451, col_offset=8, end_lineno=460, end_col_offset=9), lineno=451, col_offset=8, end_lineno=460, end_col_offset=9), Expr(value=Call(func=Name(id='_observe_metrics', ctx=Load(), lineno=461, col_offset=8, end_lineno=461, end_col_offset=24), args=[Name(id='operation', ctx=Load(), lineno=461, col_offset=25, end_lineno=461, end_col_offset=34), Constant(value='success', lineno=461, col_offset=36, end_lineno=461, end_col_offset=45), Name(id='elapsed', ctx=Load(), lineno=461, col_offset=47, end_lineno=461, end_col_offset=54)], lineno=461, col_offset=8, end_lineno=461, end_col_offset=55), lineno=461, col_offset=8, end_lineno=461, end_col_offset=55)], decorator_list=[Name(id='staticmethod', ctx=Load(), lineno=387, col_offset=5, end_lineno=387, end_col_offset=17)], returns=Constant(value=None, lineno=394, col_offset=9, end_lineno=394, end_col_offset=13), lineno=388, col_offset=4, end_lineno=461, end_col_offset=55)], decorator_list=[Call(func=Name(id='dataclass', ctx=Load(), lineno=184, col_offset=1, end_lineno=184, end_col_offset=10), keywords=[keyword(arg='slots', value=Constant(value=True, lineno=184, col_offset=17, end_lineno=184, end_col_offset=21), lineno=184, col_offset=11, end_lineno=184, end_col_offset=21), keyword(arg='frozen', value=Constant(value=True, lineno=184, col_offset=30, end_lineno=184, end_col_offset=34), lineno=184, col_offset=23, end_lineno=184, end_col_offset=34)], lineno=184, col_offset=1, end_lineno=184, end_col_offset=35)], lineno=186, col_offset=0, end_lineno=461, end_col_offset=55)])