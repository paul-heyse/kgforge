Module(body=[ImportFrom(module='__future__', names=[alias(name='annotations', lineno=1, col_offset=23, end_lineno=1, end_col_offset=34)], level=0, lineno=1, col_offset=0, end_lineno=1, end_col_offset=34), ImportFrom(module='codeintel_rev.retrieval.gating', names=[alias(name='StageGateConfig', lineno=3, col_offset=43, end_lineno=3, end_col_offset=58), alias(name='should_run_secondary_stage', lineno=3, col_offset=60, end_lineno=3, end_col_offset=86)], level=0, lineno=3, col_offset=0, end_lineno=3, end_col_offset=86), ImportFrom(module='codeintel_rev.retrieval.types', names=[alias(name='StageSignals', lineno=4, col_offset=42, end_lineno=4, end_col_offset=54)], level=0, lineno=4, col_offset=0, end_lineno=4, end_col_offset=54), FunctionDef(name='test_stage_gating_blocks_on_candidate_shortfall', args=arguments(), body=[Assign(targets=[Name(id='signals', ctx=Store(), lineno=8, col_offset=4, end_lineno=8, end_col_offset=11)], value=Call(func=Name(id='StageSignals', ctx=Load(), lineno=8, col_offset=14, end_lineno=8, end_col_offset=26), keywords=[keyword(arg='candidate_count', value=Constant(value=5, lineno=9, col_offset=24, end_lineno=9, end_col_offset=25), lineno=9, col_offset=8, end_lineno=9, end_col_offset=25), keyword(arg='elapsed_ms', value=Constant(value=10.0, lineno=9, col_offset=38, end_lineno=9, end_col_offset=42), lineno=9, col_offset=27, end_lineno=9, end_col_offset=42), keyword(arg='best_score', value=Constant(value=0.2, lineno=9, col_offset=55, end_lineno=9, end_col_offset=58), lineno=9, col_offset=44, end_lineno=9, end_col_offset=58), keyword(arg='second_best_score', value=Constant(value=0.18, lineno=9, col_offset=78, end_lineno=9, end_col_offset=82), lineno=9, col_offset=60, end_lineno=9, end_col_offset=82)], lineno=8, col_offset=14, end_lineno=10, end_col_offset=5), lineno=8, col_offset=4, end_lineno=10, end_col_offset=5), Assign(targets=[Name(id='decision', ctx=Store(), lineno=11, col_offset=4, end_lineno=11, end_col_offset=12)], value=Call(func=Name(id='should_run_secondary_stage', ctx=Load(), lineno=11, col_offset=15, end_lineno=11, end_col_offset=41), args=[Name(id='signals', ctx=Load(), lineno=12, col_offset=8, end_lineno=12, end_col_offset=15), Call(func=Name(id='StageGateConfig', ctx=Load(), lineno=13, col_offset=8, end_lineno=13, end_col_offset=23), keywords=[keyword(arg='min_candidates', value=Constant(value=10, lineno=13, col_offset=39, end_lineno=13, end_col_offset=41), lineno=13, col_offset=24, end_lineno=13, end_col_offset=41), keyword(arg='margin_threshold', value=Constant(value=0.05, lineno=13, col_offset=60, end_lineno=13, end_col_offset=64), lineno=13, col_offset=43, end_lineno=13, end_col_offset=64), keyword(arg='budget_ms', value=Constant(value=120, lineno=13, col_offset=76, end_lineno=13, end_col_offset=79), lineno=13, col_offset=66, end_lineno=13, end_col_offset=79)], lineno=13, col_offset=8, end_lineno=13, end_col_offset=80)], lineno=11, col_offset=15, end_lineno=14, end_col_offset=5), lineno=11, col_offset=4, end_lineno=14, end_col_offset=5), Assert(test=UnaryOp(op=Not(), operand=Attribute(value=Name(id='decision', ctx=Load(), lineno=15, col_offset=15, end_lineno=15, end_col_offset=23), attr='should_run', ctx=Load(), lineno=15, col_offset=15, end_lineno=15, end_col_offset=34), lineno=15, col_offset=11, end_lineno=15, end_col_offset=34), lineno=15, col_offset=4, end_lineno=15, end_col_offset=34), Assert(test=Compare(left=Attribute(value=Name(id='decision', ctx=Load(), lineno=16, col_offset=11, end_lineno=16, end_col_offset=19), attr='reason', ctx=Load(), lineno=16, col_offset=11, end_lineno=16, end_col_offset=26), ops=[Eq()], comparators=[Constant(value='insufficient_candidates', lineno=16, col_offset=30, end_lineno=16, end_col_offset=55)], lineno=16, col_offset=11, end_lineno=16, end_col_offset=55), lineno=16, col_offset=4, end_lineno=16, end_col_offset=55)], returns=Constant(value=None, lineno=7, col_offset=57, end_lineno=7, end_col_offset=61), lineno=7, col_offset=0, end_lineno=16, end_col_offset=55), FunctionDef(name='test_stage_gating_runs_when_within_budget_and_low_margin', args=arguments(), body=[Assign(targets=[Name(id='signals', ctx=Store(), lineno=20, col_offset=4, end_lineno=20, end_col_offset=11)], value=Call(func=Name(id='StageSignals', ctx=Load(), lineno=20, col_offset=14, end_lineno=20, end_col_offset=26), keywords=[keyword(arg='candidate_count', value=Constant(value=100, lineno=21, col_offset=24, end_lineno=21, end_col_offset=27), lineno=21, col_offset=8, end_lineno=21, end_col_offset=27), keyword(arg='elapsed_ms', value=Constant(value=80.0, lineno=21, col_offset=40, end_lineno=21, end_col_offset=44), lineno=21, col_offset=29, end_lineno=21, end_col_offset=44), keyword(arg='best_score', value=Constant(value=0.31, lineno=21, col_offset=57, end_lineno=21, end_col_offset=61), lineno=21, col_offset=46, end_lineno=21, end_col_offset=61), keyword(arg='second_best_score', value=Constant(value=0.3, lineno=21, col_offset=81, end_lineno=21, end_col_offset=85), lineno=21, col_offset=63, end_lineno=21, end_col_offset=85)], lineno=20, col_offset=14, end_lineno=22, end_col_offset=5), lineno=20, col_offset=4, end_lineno=22, end_col_offset=5), Assign(targets=[Name(id='decision', ctx=Store(), lineno=23, col_offset=4, end_lineno=23, end_col_offset=12)], value=Call(func=Name(id='should_run_secondary_stage', ctx=Load(), lineno=23, col_offset=15, end_lineno=23, end_col_offset=41), args=[Name(id='signals', ctx=Load(), lineno=24, col_offset=8, end_lineno=24, end_col_offset=15), Call(func=Name(id='StageGateConfig', ctx=Load(), lineno=25, col_offset=8, end_lineno=25, end_col_offset=23), keywords=[keyword(arg='min_candidates', value=Constant(value=10, lineno=25, col_offset=39, end_lineno=25, end_col_offset=41), lineno=25, col_offset=24, end_lineno=25, end_col_offset=41), keyword(arg='margin_threshold', value=Constant(value=0.05, lineno=25, col_offset=60, end_lineno=25, end_col_offset=64), lineno=25, col_offset=43, end_lineno=25, end_col_offset=64), keyword(arg='budget_ms', value=Constant(value=120, lineno=25, col_offset=76, end_lineno=25, end_col_offset=79), lineno=25, col_offset=66, end_lineno=25, end_col_offset=79)], lineno=25, col_offset=8, end_lineno=25, end_col_offset=80)], lineno=23, col_offset=15, end_lineno=26, end_col_offset=5), lineno=23, col_offset=4, end_lineno=26, end_col_offset=5), Assert(test=Attribute(value=Name(id='decision', ctx=Load(), lineno=27, col_offset=11, end_lineno=27, end_col_offset=19), attr='should_run', ctx=Load(), lineno=27, col_offset=11, end_lineno=27, end_col_offset=30), lineno=27, col_offset=4, end_lineno=27, end_col_offset=30), Assert(test=Compare(left=Attribute(value=Name(id='decision', ctx=Load(), lineno=28, col_offset=11, end_lineno=28, end_col_offset=19), attr='reason', ctx=Load(), lineno=28, col_offset=11, end_lineno=28, end_col_offset=26), ops=[Eq()], comparators=[Constant(value='within_budget', lineno=28, col_offset=30, end_lineno=28, end_col_offset=45)], lineno=28, col_offset=11, end_lineno=28, end_col_offset=45), lineno=28, col_offset=4, end_lineno=28, end_col_offset=45)], returns=Constant(value=None, lineno=19, col_offset=66, end_lineno=19, end_col_offset=70), lineno=19, col_offset=0, end_lineno=28, end_col_offset=45)])